import{Q as Kt,R as Yt,_ as Wt,E as Zt,G as Jt,H as Qt,O as Q,U as er,J as tr}from"./main-fb075e9a.js";import{S as rr}from"./SessionBase-eb081a42.js";import{L as nr}from"./LedgerDialog-07f1912d.js";import"./taquito.es6-1a402db8.js";import"./DAppClient-5ba412e0.js";const k=r=>{class e extends Error{constructor(n,s,o){if(super(n||r,o),Object.setPrototypeOf(this,e.prototype),this.name=r,s)for(const i in s)this[i]=s[i];if(o&&sr(o)&&"cause"in o&&!("cause"in this)){const i=o.cause;this.cause=i,"stack"in i&&(this.stack=this.stack+`
CAUSE: `+i.stack)}}}return e};function sr(r){return typeof r=="object"}const ir=k("LockedDeviceError"),St=k("DisconnectedDevice"),Tt=k("DisconnectedDeviceDuringOperation"),Le=k("TransportOpenUserCancelled"),qe=k("TransportInterfaceNotAvailable"),or=k("TransportRaceCondition"),ar=k("TransportWebUSBGestureRequired");var He;(function(r){r.Unknown="Unknown",r.LocationServicesDisabled="LocationServicesDisabled",r.LocationServicesUnauthorized="LocationServicesUnauthorized",r.BluetoothScanStartFailed="BluetoothScanStartFailed"})(He||(He={}));class M extends Error{constructor(e,t){const n="TransportError";super(e||n),this.name=n,this.message=e,this.stack=new Error().stack,this.id=t}}const re={ACCESS_CONDITION_NOT_FULFILLED:38916,ALGORITHM_NOT_SUPPORTED:38020,CLA_NOT_SUPPORTED:28160,CODE_BLOCKED:38976,CODE_NOT_INITIALIZED:38914,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,CONDITIONS_OF_USE_NOT_SATISFIED:27013,CONTRADICTION_INVALIDATION:38928,CONTRADICTION_SECRET_CODE_STATUS:38920,CUSTOM_IMAGE_BOOTLOADER:26159,CUSTOM_IMAGE_EMPTY:26158,FILE_ALREADY_EXISTS:27273,FILE_NOT_FOUND:37892,GP_AUTH_FAILED:25344,HALTED:28586,INCONSISTENT_FILE:37896,INCORRECT_DATA:27264,INCORRECT_LENGTH:26368,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,DEVICE_NOT_ONBOARDED:27911,DEVICE_NOT_ONBOARDED_2:26129,INVALID_KCV:38021,INVALID_OFFSET:37890,LICENSING:28482,LOCKED_DEVICE:21781,MAX_VALUE_REACHED:38992,MEMORY_PROBLEM:37440,MISSING_CRITICAL_PARAMETER:26624,NO_EF_SELECTED:37888,NOT_ENOUGH_MEMORY_SPACE:27268,OK:36864,PIN_REMAINING_ATTEMPTS:25536,REFERENCED_DATA_NOT_FOUND:27272,SECURITY_STATUS_NOT_SATISFIED:27010,TECHNICAL_PROBLEM:28416,UNKNOWN_APDU:27906,USER_REFUSED_ON_DEVICE:21761,NOT_ENOUGH_SPACE:20738};function cr(r){switch(r){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received";case 21781:return"Locked device"}if(28416<=r&&r<=28671)return"Internal error, please report"}function _e(r){const e=Object.keys(re).find(o=>re[o]===r)||"UNKNOWN_ERROR",t=cr(r)||e,n=r.toString(16),s=`Ledger device: ${t} (0x${n})`;if(r===re.LOCKED_DEVICE)throw new ir(s);this.name="TransportStatusError",this.message=s,this.stack=new Error().stack,this.statusCode=r,this.statusText=e}_e.prototype=new Error;var ie=globalThis&&globalThis.__awaiter||function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(c){try{l(n.next(c))}catch(f){i(f)}}function u(c){try{l(n.throw(c))}catch(f){i(f)}}function l(c){c.done?o(c.value):s(c.value).then(a,u)}l((n=n.apply(r,e||[])).next())})};class de{constructor(){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new Kt,this.send=(e,t,n,s,o=Buffer.alloc(0),i=[re.OK])=>ie(this,void 0,void 0,function*(){if(o.length>=256)throw new M("data.length exceed 256 bytes limit. Got: "+o.length,"DataLengthTooBig");const a=yield this.exchange(Buffer.concat([Buffer.from([e,t,n,s]),Buffer.from([o.length]),o])),u=a.readUInt16BE(a.length-2);if(!i.some(l=>l===u))throw new _e(u);return a}),this.exchangeAtomicImpl=e=>ie(this,void 0,void 0,function*(){if(this.exchangeBusyPromise)throw new or("An action was already pending on the Ledger device. Please deny or reconnect.");let t;const n=new Promise(i=>{t=i});this.exchangeBusyPromise=n;let s=!1;const o=setTimeout(()=>{s=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const i=yield e();return s&&this.emit("responsive"),i}finally{clearTimeout(o),t&&t(),this.exchangeBusyPromise=null}}),this._appAPIlock=null}exchange(e){throw new Error("exchange not implemented")}exchangeBulk(e,t){let n=!1;const s=()=>{n=!0};return(()=>ie(this,void 0,void 0,function*(){if(!n)for(const i of e){const a=yield this.exchange(i);if(n)return;const u=a.readUInt16BE(a.length-2);if(u!==re.OK)throw new _e(u);t.next(a)}}))().then(()=>!n&&t.complete(),i=>!n&&t.error(i)),{unsubscribe:s}}setScrambleKey(e){}close(){return Promise.resolve()}on(e,t){this._events.on(e,t)}off(e,t){this._events.removeListener(e,t)}emit(e,...t){this._events.emit(e,...t)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(e){this.exchangeTimeout=e}setExchangeUnresponsiveTimeout(e){this.unresponsiveTimeout=e}static create(e=3e3,t){return new Promise((n,s)=>{let o=!1;const i=this.listen({next:u=>{o=!0,i&&i.unsubscribe(),a&&clearTimeout(a),this.open(u.descriptor,e).then(n,s)},error:u=>{a&&clearTimeout(a),s(u)},complete:()=>{a&&clearTimeout(a),o||s(new M(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),a=t?setTimeout(()=>{i.unsubscribe(),s(new M(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},t):null})}decorateAppAPIMethods(e,t,n){for(const s of t)e[s]=this.decorateAppAPIMethod(s,e[s],e,n)}decorateAppAPIMethod(e,t,n,s){return(...o)=>ie(this,void 0,void 0,function*(){const{_appAPIlock:i}=this;if(i)return Promise.reject(new M("Ledger Device is busy (lock "+i+")","TransportLocked"));try{return this._appAPIlock=e,this.setScrambleKey(s),yield t.apply(n,o)}finally{this._appAPIlock=null}})}}de.ErrorMessage_ListenTimeout="No Ledger device found (timeout)";de.ErrorMessage_NoDeviceFound="No Ledger device found";const ke=5;function lr(r){const e=Buffer.alloc(2);return e.writeUInt16BE(r,0),e}const ur={data:Buffer.alloc(0),dataLength:0,sequence:0},wt=(r,e)=>({makeBlocks(t){let n=Buffer.concat([lr(t.length),t]);const s=e-5,o=Math.ceil(n.length/s);n=Buffer.concat([n,Buffer.alloc(o*s-n.length+1).fill(0)]);const i=[];for(let a=0;a<o;a++){const u=Buffer.alloc(5);u.writeUInt16BE(r,0),u.writeUInt8(ke,2),u.writeUInt16BE(a,3);const l=n.slice(a*s,(a+1)*s);i.push(Buffer.concat([u,l]))}return i},reduceResponse(t,n){let{data:s,dataLength:o,sequence:i}=t||ur;if(n.readUInt16BE(0)!==r)throw new M("Invalid channel","InvalidChannel");if(n.readUInt8(2)!==ke)throw new M("Invalid tag","InvalidTag");if(n.readUInt16BE(3)!==i)throw new M("Invalid sequence","InvalidSequence");t||(o=n.readUInt16BE(5)),i++;const a=n.slice(t?5:7);return s=Buffer.concat([s,a]),s.length>o&&(s=s.slice(0,o)),{data:s,dataLength:o,sequence:i}},getReducedResult(t){if(t&&t.dataLength===t.data.length)return t.data}});var xe={exports:{}};const hr="2.0.0",fr=256,dr=Number.MAX_SAFE_INTEGER||9007199254740991,pr=16,Er=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var pe={MAX_LENGTH:fr,MAX_SAFE_COMPONENT_LENGTH:pr,MAX_SAFE_INTEGER:dr,RELEASE_TYPES:Er,SEMVER_SPEC_VERSION:hr,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const vr=typeof process=="object"&&{}&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};var Ee=vr;(function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t}=pe,n=Ee;e=r.exports={};const s=e.re=[],o=e.safeRe=[],i=e.src=[],a=e.t={};let u=0;const l=(c,f,S)=>{const E=f.split("\\s*").join("\\s{0,1}").split("\\s+").join("\\s"),C=u++;n(c,C,f),a[c]=C,i[C]=f,s[C]=new RegExp(f,S?"g":void 0),o[C]=new RegExp(E,S?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION",`(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})`),l("MAINVERSIONLOOSE",`(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})`),l("PRERELEASEIDENTIFIER",`(?:${i[a.NUMERICIDENTIFIER]}|${i[a.NONNUMERICIDENTIFIER]})`),l("PRERELEASEIDENTIFIERLOOSE",`(?:${i[a.NUMERICIDENTIFIERLOOSE]}|${i[a.NONNUMERICIDENTIFIER]})`),l("PRERELEASE",`(?:-(${i[a.PRERELEASEIDENTIFIER]}(?:\\.${i[a.PRERELEASEIDENTIFIER]})*))`),l("PRERELEASELOOSE",`(?:-?(${i[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[a.PRERELEASEIDENTIFIERLOOSE]})*))`),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD",`(?:\\+(${i[a.BUILDIDENTIFIER]}(?:\\.${i[a.BUILDIDENTIFIER]})*))`),l("FULLPLAIN",`v?${i[a.MAINVERSION]}${i[a.PRERELEASE]}?${i[a.BUILD]}?`),l("FULL",`^${i[a.FULLPLAIN]}$`),l("LOOSEPLAIN",`[v=\\s]*${i[a.MAINVERSIONLOOSE]}${i[a.PRERELEASELOOSE]}?${i[a.BUILD]}?`),l("LOOSE",`^${i[a.LOOSEPLAIN]}$`),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE",`${i[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),l("XRANGEIDENTIFIER",`${i[a.NUMERICIDENTIFIER]}|x|X|\\*`),l("XRANGEPLAIN",`[v=\\s]*(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:${i[a.PRERELEASE]})?${i[a.BUILD]}?)?)?`),l("XRANGEPLAINLOOSE",`[v=\\s]*(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:${i[a.PRERELEASELOOSE]})?${i[a.BUILD]}?)?)?`),l("XRANGE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAIN]}$`),l("XRANGELOOSE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAINLOOSE]}$`),l("COERCE",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?(?:$|[^\\d])`),l("COERCERTL",i[a.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM",`(\\s*)${i[a.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",l("TILDE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAIN]}$`),l("TILDELOOSE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAINLOOSE]}$`),l("LONECARET","(?:\\^)"),l("CARETTRIM",`(\\s*)${i[a.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",l("CARET",`^${i[a.LONECARET]}${i[a.XRANGEPLAIN]}$`),l("CARETLOOSE",`^${i[a.LONECARET]}${i[a.XRANGEPLAINLOOSE]}$`),l("COMPARATORLOOSE",`^${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]})$|^$`),l("COMPARATOR",`^${i[a.GTLT]}\\s*(${i[a.FULLPLAIN]})$|^$`),l("COMPARATORTRIM",`(\\s*)${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]}|${i[a.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE",`^\\s*(${i[a.XRANGEPLAIN]})\\s+-\\s+(${i[a.XRANGEPLAIN]})\\s*$`),l("HYPHENRANGELOOSE",`^\\s*(${i[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[a.XRANGEPLAINLOOSE]})\\s*$`),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(xe,xe.exports);var se=xe.exports;const mr=Object.freeze({loose:!0}),gr=Object.freeze({}),Ir=r=>r?typeof r!="object"?mr:r:gr;var be=Ir;const Ke=/^[0-9]+$/,Nt=(r,e)=>{const t=Ke.test(r),n=Ke.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},$r=(r,e)=>Nt(e,r);var Ot={compareIdentifiers:Nt,rcompareIdentifiers:$r};const oe=Ee,{MAX_LENGTH:Ye,MAX_SAFE_INTEGER:ae}=pe,{safeRe:We,t:Ze}=se,Rr=be,{compareIdentifiers:K}=Ot;let yr=class P{constructor(e,t){if(t=Rr(t),e instanceof P){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Ye)throw new TypeError(`version is longer than ${Ye} characters`);oe("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?We[Ze.LOOSE]:We[Ze.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>ae||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ae||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ae||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const o=+s;if(o>=0&&o<ae)return o}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(oe("SemVer.compare",this.version,this.options,e),!(e instanceof P)){if(typeof e=="string"&&e===this.version)return 0;e=new P(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof P||(e=new P(e,this.options)),K(this.major,e.major)||K(this.minor,e.minor)||K(this.patch,e.patch)}comparePre(e){if(e instanceof P||(e=new P(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],s=e.prerelease[t];if(oe("prerelease compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return K(n,s)}while(++t)}compareBuild(e){e instanceof P||(e=new P(e,this.options));let t=0;do{const n=this.build[t],s=e.build[t];if(oe("prerelease compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return K(n,s)}while(++t)}inc(e,t,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(n)?1:0;if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[s];else{let o=this.prerelease.length;for(;--o>=0;)typeof this.prerelease[o]=="number"&&(this.prerelease[o]++,o=-2);if(o===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let o=[t,s];n===!1&&(o=[t]),K(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=o):this.prerelease=o}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var L=yr;const Je=L,Sr=(r,e,t=!1)=>{if(r instanceof Je)return r;try{return new Je(r,e)}catch(n){if(!t)return null;throw n}};var Z=Sr;const Tr=Z,wr=(r,e)=>{const t=Tr(r,e);return t?t.version:null};var Nr=wr;const Or=Z,Ar=(r,e)=>{const t=Or(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};var Lr=Ar;const Qe=L,_r=(r,e,t,n,s)=>{typeof t=="string"&&(s=n,n=t,t=void 0);try{return new Qe(r instanceof Qe?r.version:r,t).inc(e,n,s).version}catch{return null}};var xr=_r;const et=Z,Dr=(r,e)=>{const t=et(r,null,!0),n=et(e,null,!0),s=t.compare(n);if(s===0)return null;const o=s>0,i=o?t:n,a=o?n:t,u=!!i.prerelease.length;if(!!a.prerelease.length&&!u)return!a.patch&&!a.minor?"major":i.patch?"patch":i.minor?"minor":"major";const c=u?"pre":"";return t.major!==n.major?c+"major":t.minor!==n.minor?c+"minor":t.patch!==n.patch?c+"patch":"prerelease"};var br=Dr;const Cr=L,Pr=(r,e)=>new Cr(r,e).major;var Ur=Pr;const Gr=L,Fr=(r,e)=>new Gr(r,e).minor;var Br=Fr;const Mr=L,jr=(r,e)=>new Mr(r,e).patch;var Vr=jr;const Xr=Z,zr=(r,e)=>{const t=Xr(r,e);return t&&t.prerelease.length?t.prerelease:null};var qr=zr;const tt=L,Hr=(r,e,t)=>new tt(r,t).compare(new tt(e,t));var D=Hr;const kr=D,Kr=(r,e,t)=>kr(e,r,t);var Yr=Kr;const Wr=D,Zr=(r,e)=>Wr(r,e,!0);var Jr=Zr;const rt=L,Qr=(r,e,t)=>{const n=new rt(r,t),s=new rt(e,t);return n.compare(s)||n.compareBuild(s)};var Ce=Qr;const en=Ce,tn=(r,e)=>r.sort((t,n)=>en(t,n,e));var rn=tn;const nn=Ce,sn=(r,e)=>r.sort((t,n)=>nn(n,t,e));var on=sn;const an=D,cn=(r,e,t)=>an(r,e,t)>0;var ve=cn;const ln=D,un=(r,e,t)=>ln(r,e,t)<0;var Pe=un;const hn=D,fn=(r,e,t)=>hn(r,e,t)===0;var At=fn;const dn=D,pn=(r,e,t)=>dn(r,e,t)!==0;var Lt=pn;const En=D,vn=(r,e,t)=>En(r,e,t)>=0;var Ue=vn;const mn=D,gn=(r,e,t)=>mn(r,e,t)<=0;var Ge=gn;const In=At,$n=Lt,Rn=ve,yn=Ue,Sn=Pe,Tn=Ge,wn=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return In(r,t,n);case"!=":return $n(r,t,n);case">":return Rn(r,t,n);case">=":return yn(r,t,n);case"<":return Sn(r,t,n);case"<=":return Tn(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};var _t=wn;const Nn=L,On=Z,{safeRe:ce,t:le}=se,An=(r,e)=>{if(r instanceof Nn)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(ce[le.COERCE]);else{let n;for(;(n=ce[le.COERCERTL].exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||n.index+n[0].length!==t.index+t[0].length)&&(t=n),ce[le.COERCERTL].lastIndex=n.index+n[1].length+n[2].length;ce[le.COERCERTL].lastIndex=-1}return t===null?null:On(`${t[2]}.${t[3]||"0"}.${t[4]||"0"}`,e)};var Ln=An,Re,nt;function _n(){return nt||(nt=1,Re=function(r){r.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}),Re}var xn=R;R.Node=H;R.create=R;function R(r){var e=this;if(e instanceof R||(e=new R),e.tail=null,e.head=null,e.length=0,r&&typeof r.forEach=="function")r.forEach(function(s){e.push(s)});else if(arguments.length>0)for(var t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);return e}R.prototype.removeNode=function(r){if(r.list!==this)throw new Error("removing node which does not belong to this list");var e=r.next,t=r.prev;return e&&(e.prev=t),t&&(t.next=e),r===this.head&&(this.head=e),r===this.tail&&(this.tail=t),r.list.length--,r.next=null,r.prev=null,r.list=null,e};R.prototype.unshiftNode=function(r){if(r!==this.head){r.list&&r.list.removeNode(r);var e=this.head;r.list=this,r.next=e,e&&(e.prev=r),this.head=r,this.tail||(this.tail=r),this.length++}};R.prototype.pushNode=function(r){if(r!==this.tail){r.list&&r.list.removeNode(r);var e=this.tail;r.list=this,r.prev=e,e&&(e.next=r),this.tail=r,this.head||(this.head=r),this.length++}};R.prototype.push=function(){for(var r=0,e=arguments.length;r<e;r++)bn(this,arguments[r]);return this.length};R.prototype.unshift=function(){for(var r=0,e=arguments.length;r<e;r++)Cn(this,arguments[r]);return this.length};R.prototype.pop=function(){if(this.tail){var r=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,r}};R.prototype.shift=function(){if(this.head){var r=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,r}};R.prototype.forEach=function(r,e){e=e||this;for(var t=this.head,n=0;t!==null;n++)r.call(e,t.value,n,this),t=t.next};R.prototype.forEachReverse=function(r,e){e=e||this;for(var t=this.tail,n=this.length-1;t!==null;n--)r.call(e,t.value,n,this),t=t.prev};R.prototype.get=function(r){for(var e=0,t=this.head;t!==null&&e<r;e++)t=t.next;if(e===r&&t!==null)return t.value};R.prototype.getReverse=function(r){for(var e=0,t=this.tail;t!==null&&e<r;e++)t=t.prev;if(e===r&&t!==null)return t.value};R.prototype.map=function(r,e){e=e||this;for(var t=new R,n=this.head;n!==null;)t.push(r.call(e,n.value,this)),n=n.next;return t};R.prototype.mapReverse=function(r,e){e=e||this;for(var t=new R,n=this.tail;n!==null;)t.push(r.call(e,n.value,this)),n=n.prev;return t};R.prototype.reduce=function(r,e){var t,n=this.head;if(arguments.length>1)t=e;else if(this.head)n=this.head.next,t=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=0;n!==null;s++)t=r(t,n.value,s),n=n.next;return t};R.prototype.reduceReverse=function(r,e){var t,n=this.tail;if(arguments.length>1)t=e;else if(this.tail)n=this.tail.prev,t=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=this.length-1;n!==null;s--)t=r(t,n.value,s),n=n.prev;return t};R.prototype.toArray=function(){for(var r=new Array(this.length),e=0,t=this.head;t!==null;e++)r[e]=t.value,t=t.next;return r};R.prototype.toArrayReverse=function(){for(var r=new Array(this.length),e=0,t=this.tail;t!==null;e++)r[e]=t.value,t=t.prev;return r};R.prototype.slice=function(r,e){e=e||this.length,e<0&&(e+=this.length),r=r||0,r<0&&(r+=this.length);var t=new R;if(e<r||e<0)return t;r<0&&(r=0),e>this.length&&(e=this.length);for(var n=0,s=this.head;s!==null&&n<r;n++)s=s.next;for(;s!==null&&n<e;n++,s=s.next)t.push(s.value);return t};R.prototype.sliceReverse=function(r,e){e=e||this.length,e<0&&(e+=this.length),r=r||0,r<0&&(r+=this.length);var t=new R;if(e<r||e<0)return t;r<0&&(r=0),e>this.length&&(e=this.length);for(var n=this.length,s=this.tail;s!==null&&n>e;n--)s=s.prev;for(;s!==null&&n>r;n--,s=s.prev)t.push(s.value);return t};R.prototype.splice=function(r,e,...t){r>this.length&&(r=this.length-1),r<0&&(r=this.length+r);for(var n=0,s=this.head;s!==null&&n<r;n++)s=s.next;for(var o=[],n=0;s&&n<e;n++)o.push(s.value),s=this.removeNode(s);s===null&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev);for(var n=0;n<t.length;n++)s=Dn(this,s,t[n]);return o};R.prototype.reverse=function(){for(var r=this.head,e=this.tail,t=r;t!==null;t=t.prev){var n=t.prev;t.prev=t.next,t.next=n}return this.head=e,this.tail=r,this};function Dn(r,e,t){var n=e===r.head?new H(t,null,e,r):new H(t,e,e.next,r);return n.next===null&&(r.tail=n),n.prev===null&&(r.head=n),r.length++,n}function bn(r,e){r.tail=new H(e,r.tail,null,r),r.head||(r.head=r.tail),r.length++}function Cn(r,e){r.head=new H(e,null,r.head,r),r.tail||(r.tail=r.head),r.length++}function H(r,e,t,n){if(!(this instanceof H))return new H(r,e,t,n);this.list=n,this.value=r,e?(e.next=this,this.prev=e):this.prev=null,t?(t.prev=this,this.next=t):this.next=null}try{_n()(R)}catch{}const Pn=xn,z=Symbol("max"),G=Symbol("length"),Y=Symbol("lengthCalculator"),ne=Symbol("allowStale"),q=Symbol("maxAge"),U=Symbol("dispose"),st=Symbol("noDisposeOnSet"),N=Symbol("lruList"),x=Symbol("cache"),xt=Symbol("updateAgeOnGet"),ye=()=>1;class Un{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");this[z]=e.max||1/0;const t=e.length||ye;if(this[Y]=typeof t!="function"?ye:t,this[ne]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[q]=e.maxAge||0,this[U]=e.dispose,this[st]=e.noDisposeOnSet||!1,this[xt]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[z]=e||1/0,ee(this)}get max(){return this[z]}set allowStale(e){this[ne]=!!e}get allowStale(){return this[ne]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[q]=e,ee(this)}get maxAge(){return this[q]}set lengthCalculator(e){typeof e!="function"&&(e=ye),e!==this[Y]&&(this[Y]=e,this[G]=0,this[N].forEach(t=>{t.length=this[Y](t.value,t.key),this[G]+=t.length})),ee(this)}get lengthCalculator(){return this[Y]}get length(){return this[G]}get itemCount(){return this[N].length}rforEach(e,t){t=t||this;for(let n=this[N].tail;n!==null;){const s=n.prev;it(this,e,n,t),n=s}}forEach(e,t){t=t||this;for(let n=this[N].head;n!==null;){const s=n.next;it(this,e,n,t),n=s}}keys(){return this[N].toArray().map(e=>e.key)}values(){return this[N].toArray().map(e=>e.value)}reset(){this[U]&&this[N]&&this[N].length&&this[N].forEach(e=>this[U](e.key,e.value)),this[x]=new Map,this[N]=new Pn,this[G]=0}dump(){return this[N].map(e=>ue(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[N]}set(e,t,n){if(n=n||this[q],n&&typeof n!="number")throw new TypeError("maxAge must be a number");const s=n?Date.now():0,o=this[Y](t,e);if(this[x].has(e)){if(o>this[z])return W(this,this[x].get(e)),!1;const u=this[x].get(e).value;return this[U]&&(this[st]||this[U](e,u.value)),u.now=s,u.maxAge=n,u.value=t,this[G]+=o-u.length,u.length=o,this.get(e),ee(this),!0}const i=new Gn(e,t,o,s,n);return i.length>this[z]?(this[U]&&this[U](e,t),!1):(this[G]+=i.length,this[N].unshift(i),this[x].set(e,this[N].head),ee(this),!0)}has(e){if(!this[x].has(e))return!1;const t=this[x].get(e).value;return!ue(this,t)}get(e){return Se(this,e,!0)}peek(e){return Se(this,e,!1)}pop(){const e=this[N].tail;return e?(W(this,e),e.value):null}del(e){W(this,this[x].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const s=e[n],o=s.e||0;if(o===0)this.set(s.k,s.v);else{const i=o-t;i>0&&this.set(s.k,s.v,i)}}}prune(){this[x].forEach((e,t)=>Se(this,t,!1))}}const Se=(r,e,t)=>{const n=r[x].get(e);if(n){const s=n.value;if(ue(r,s)){if(W(r,n),!r[ne])return}else t&&(r[xt]&&(n.value.now=Date.now()),r[N].unshiftNode(n));return s.value}},ue=(r,e)=>{if(!e||!e.maxAge&&!r[q])return!1;const t=Date.now()-e.now;return e.maxAge?t>e.maxAge:r[q]&&t>r[q]},ee=r=>{if(r[G]>r[z])for(let e=r[N].tail;r[G]>r[z]&&e!==null;){const t=e.prev;W(r,e),e=t}},W=(r,e)=>{if(e){const t=e.value;r[U]&&r[U](t.key,t.value),r[G]-=t.length,r[x].delete(t.key),r[N].removeNode(e)}};class Gn{constructor(e,t,n,s,o){this.key=e,this.value=t,this.length=n,this.now=s,this.maxAge=o||0}}const it=(r,e,t,n)=>{let s=t.value;ue(r,s)&&(W(r,t),r[ne]||(s=void 0)),s&&e.call(n,s.value,s.key,r)};var Fn=Un,Te,ot;function b(){if(ot)return Te;ot=1;class r{constructor(h,g){if(g=n(g),h instanceof r)return h.loose===!!g.loose&&h.includePrerelease===!!g.includePrerelease?h:new r(h.raw,g);if(h instanceof s)return this.raw=h.value,this.set=[[h]],this.format(),this;if(this.options=g,this.loose=!!g.loose,this.includePrerelease=!!g.includePrerelease,this.raw=h.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(v=>this.parseRange(v)).filter(v=>v.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const v=this.set[0];if(this.set=this.set.filter(m=>!C(m[0])),this.set.length===0)this.set=[v];else if(this.set.length>1){for(const m of this.set)if(m.length===1&&Ut(m[0])){this.set=[m];break}}}this.format()}format(){return this.range=this.set.map(h=>h.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(h){const v=((this.options.includePrerelease&&S)|(this.options.loose&&E))+":"+h,m=t.get(v);if(m)return m;const p=this.options.loose,I=p?a[u.HYPHENRANGELOOSE]:a[u.HYPHENRANGE];h=h.replace(I,Ht(this.options.includePrerelease)),o("hyphen replace",h),h=h.replace(a[u.COMPARATORTRIM],l),o("comparator trim",h),h=h.replace(a[u.TILDETRIM],c),h=h.replace(a[u.CARETTRIM],f);let y=h.split(" ").map(w=>Gt(w,this.options)).join(" ").split(/\s+/).map(w=>qt(w,this.options));p&&(y=y.filter(w=>(o("loose invalid filter",w,this.options),!!w.match(a[u.COMPARATORLOOSE])))),o("range list",y);const $=new Map,T=y.map(w=>new s(w,this.options));for(const w of T){if(C(w))return[w];$.set(w.value,w)}$.size>1&&$.has("")&&$.delete("");const _=[...$.values()];return t.set(v,_),_}intersects(h,g){if(!(h instanceof r))throw new TypeError("a Range is required");return this.set.some(v=>ze(v,g)&&h.set.some(m=>ze(m,g)&&v.every(p=>m.every(I=>p.intersects(I,g)))))}test(h){if(!h)return!1;if(typeof h=="string")try{h=new i(h,this.options)}catch{return!1}for(let g=0;g<this.set.length;g++)if(kt(this.set[g],h,this.options))return!0;return!1}}Te=r;const e=Fn,t=new e({max:1e3}),n=be,s=me(),o=Ee,i=L,{safeRe:a,t:u,comparatorTrimReplace:l,tildeTrimReplace:c,caretTrimReplace:f}=se,{FLAG_INCLUDE_PRERELEASE:S,FLAG_LOOSE:E}=pe,C=d=>d.value==="<0.0.0-0",Ut=d=>d.value==="",ze=(d,h)=>{let g=!0;const v=d.slice();let m=v.pop();for(;g&&v.length;)g=v.every(p=>m.intersects(p,h)),m=v.pop();return g},Gt=(d,h)=>(o("comp",d,h),d=Mt(d,h),o("caret",d),d=Ft(d,h),o("tildes",d),d=Vt(d,h),o("xrange",d),d=zt(d,h),o("stars",d),d),A=d=>!d||d.toLowerCase()==="x"||d==="*",Ft=(d,h)=>d.trim().split(/\s+/).map(g=>Bt(g,h)).join(" "),Bt=(d,h)=>{const g=h.loose?a[u.TILDELOOSE]:a[u.TILDE];return d.replace(g,(v,m,p,I,y)=>{o("tilde",d,v,m,p,I,y);let $;return A(m)?$="":A(p)?$=`>=${m}.0.0 <${+m+1}.0.0-0`:A(I)?$=`>=${m}.${p}.0 <${m}.${+p+1}.0-0`:y?(o("replaceTilde pr",y),$=`>=${m}.${p}.${I}-${y} <${m}.${+p+1}.0-0`):$=`>=${m}.${p}.${I} <${m}.${+p+1}.0-0`,o("tilde return",$),$})},Mt=(d,h)=>d.trim().split(/\s+/).map(g=>jt(g,h)).join(" "),jt=(d,h)=>{o("caret",d,h);const g=h.loose?a[u.CARETLOOSE]:a[u.CARET],v=h.includePrerelease?"-0":"";return d.replace(g,(m,p,I,y,$)=>{o("caret",d,m,p,I,y,$);let T;return A(p)?T="":A(I)?T=`>=${p}.0.0${v} <${+p+1}.0.0-0`:A(y)?p==="0"?T=`>=${p}.${I}.0${v} <${p}.${+I+1}.0-0`:T=`>=${p}.${I}.0${v} <${+p+1}.0.0-0`:$?(o("replaceCaret pr",$),p==="0"?I==="0"?T=`>=${p}.${I}.${y}-${$} <${p}.${I}.${+y+1}-0`:T=`>=${p}.${I}.${y}-${$} <${p}.${+I+1}.0-0`:T=`>=${p}.${I}.${y}-${$} <${+p+1}.0.0-0`):(o("no pr"),p==="0"?I==="0"?T=`>=${p}.${I}.${y}${v} <${p}.${I}.${+y+1}-0`:T=`>=${p}.${I}.${y}${v} <${p}.${+I+1}.0-0`:T=`>=${p}.${I}.${y} <${+p+1}.0.0-0`),o("caret return",T),T})},Vt=(d,h)=>(o("replaceXRanges",d,h),d.split(/\s+/).map(g=>Xt(g,h)).join(" ")),Xt=(d,h)=>{d=d.trim();const g=h.loose?a[u.XRANGELOOSE]:a[u.XRANGE];return d.replace(g,(v,m,p,I,y,$)=>{o("xRange",d,v,m,p,I,y,$);const T=A(p),_=T||A(I),w=_||A(y),J=w;return m==="="&&J&&(m=""),$=h.includePrerelease?"-0":"",T?m===">"||m==="<"?v="<0.0.0-0":v="*":m&&J?(_&&(I=0),y=0,m===">"?(m=">=",_?(p=+p+1,I=0,y=0):(I=+I+1,y=0)):m==="<="&&(m="<",_?p=+p+1:I=+I+1),m==="<"&&($="-0"),v=`${m+p}.${I}.${y}${$}`):_?v=`>=${p}.0.0${$} <${+p+1}.0.0-0`:w&&(v=`>=${p}.${I}.0${$} <${p}.${+I+1}.0-0`),o("xRange return",v),v})},zt=(d,h)=>(o("replaceStars",d,h),d.trim().replace(a[u.STAR],"")),qt=(d,h)=>(o("replaceGTE0",d,h),d.trim().replace(a[h.includePrerelease?u.GTE0PRE:u.GTE0],"")),Ht=d=>(h,g,v,m,p,I,y,$,T,_,w,J,wi)=>(A(v)?g="":A(m)?g=`>=${v}.0.0${d?"-0":""}`:A(p)?g=`>=${v}.${m}.0${d?"-0":""}`:I?g=`>=${g}`:g=`>=${g}${d?"-0":""}`,A(T)?$="":A(_)?$=`<${+T+1}.0.0-0`:A(w)?$=`<${T}.${+_+1}.0-0`:J?$=`<=${T}.${_}.${w}-${J}`:d?$=`<${T}.${_}.${+w+1}-0`:$=`<=${$}`,`${g} ${$}`.trim()),kt=(d,h,g)=>{for(let v=0;v<d.length;v++)if(!d[v].test(h))return!1;if(h.prerelease.length&&!g.includePrerelease){for(let v=0;v<d.length;v++)if(o(d[v].semver),d[v].semver!==s.ANY&&d[v].semver.prerelease.length>0){const m=d[v].semver;if(m.major===h.major&&m.minor===h.minor&&m.patch===h.patch)return!0}return!1}return!0};return Te}var we,at;function me(){if(at)return we;at=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(c,f){if(f=t(f),c instanceof e){if(c.loose===!!f.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),i("comparator",c,f),this.options=f,this.loose=!!f.loose,this.parse(c),this.semver===r?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(c){const f=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],S=c.match(f);if(!S)throw new TypeError(`Invalid comparator: ${c}`);this.operator=S[1]!==void 0?S[1]:"",this.operator==="="&&(this.operator=""),S[2]?this.semver=new a(S[2],this.options.loose):this.semver=r}toString(){return this.value}test(c){if(i("Comparator.test",c,this.options.loose),this.semver===r||c===r)return!0;if(typeof c=="string")try{c=new a(c,this.options)}catch{return!1}return o(c,this.operator,this.semver,this.options)}intersects(c,f){if(!(c instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(c.value,f).test(this.value):c.operator===""?c.value===""?!0:new u(this.value,f).test(c.semver):(f=t(f),f.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||o(this.semver,"<",c.semver,f)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||o(this.semver,">",c.semver,f)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}we=e;const t=be,{safeRe:n,t:s}=se,o=_t,i=Ee,a=L,u=b();return we}const Bn=b(),Mn=(r,e,t)=>{try{e=new Bn(e,t)}catch{return!1}return e.test(r)};var ge=Mn;const jn=b(),Vn=(r,e)=>new jn(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));var Xn=Vn;const zn=L,qn=b(),Hn=(r,e,t)=>{let n=null,s=null,o=null;try{o=new qn(e,t)}catch{return null}return r.forEach(i=>{o.test(i)&&(!n||s.compare(i)===-1)&&(n=i,s=new zn(n,t))}),n};var kn=Hn;const Kn=L,Yn=b(),Wn=(r,e,t)=>{let n=null,s=null,o=null;try{o=new Yn(e,t)}catch{return null}return r.forEach(i=>{o.test(i)&&(!n||s.compare(i)===1)&&(n=i,s=new Kn(n,t))}),n};var Zn=Wn;const Ne=L,Jn=b(),ct=ve,Qn=(r,e)=>{r=new Jn(r,e);let t=new Ne("0.0.0");if(r.test(t)||(t=new Ne("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){const s=r.set[n];let o=null;s.forEach(i=>{const a=new Ne(i.semver.version);switch(i.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!o||ct(a,o))&&(o=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${i.operator}`)}}),o&&(!t||ct(t,o))&&(t=o)}return t&&r.test(t)?t:null};var es=Qn;const ts=b(),rs=(r,e)=>{try{return new ts(r,e).range||"*"}catch{return null}};var ns=rs;const ss=L,Dt=me(),{ANY:is}=Dt,os=b(),as=ge,lt=ve,ut=Pe,cs=Ge,ls=Ue,us=(r,e,t,n)=>{r=new ss(r,n),e=new os(e,n);let s,o,i,a,u;switch(t){case">":s=lt,o=cs,i=ut,a=">",u=">=";break;case"<":s=ut,o=ls,i=lt,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(as(r,e,n))return!1;for(let l=0;l<e.set.length;++l){const c=e.set[l];let f=null,S=null;if(c.forEach(E=>{E.semver===is&&(E=new Dt(">=0.0.0")),f=f||E,S=S||E,s(E.semver,f.semver,n)?f=E:i(E.semver,S.semver,n)&&(S=E)}),f.operator===a||f.operator===u||(!S.operator||S.operator===a)&&o(r,S.semver))return!1;if(S.operator===u&&i(r,S.semver))return!1}return!0};var Fe=us;const hs=Fe,fs=(r,e,t)=>hs(r,e,">",t);var ds=fs;const ps=Fe,Es=(r,e,t)=>ps(r,e,"<",t);var vs=Es;const ht=b(),ms=(r,e,t)=>(r=new ht(r,t),e=new ht(e,t),r.intersects(e,t));var gs=ms;const Is=ge,$s=D;var Rs=(r,e,t)=>{const n=[];let s=null,o=null;const i=r.sort((c,f)=>$s(c,f,t));for(const c of i)Is(c,e,t)?(o=c,s||(s=c)):(o&&n.push([s,o]),o=null,s=null);s&&n.push([s,null]);const a=[];for(const[c,f]of n)c===f?a.push(c):!f&&c===i[0]?a.push("*"):f?c===i[0]?a.push(`<=${f}`):a.push(`${c} - ${f}`):a.push(`>=${c}`);const u=a.join(" || "),l=typeof e.raw=="string"?e.raw:String(e);return u.length<l.length?u:e};const ft=b(),Be=me(),{ANY:Oe}=Be,te=ge,Me=D,ys=(r,e,t={})=>{if(r===e)return!0;r=new ft(r,t),e=new ft(e,t);let n=!1;e:for(const s of r.set){for(const o of e.set){const i=Ts(s,o,t);if(n=n||i!==null,i)continue e}if(n)return!1}return!0},Ss=[new Be(">=0.0.0-0")],dt=[new Be(">=0.0.0")],Ts=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Oe){if(e.length===1&&e[0].semver===Oe)return!0;t.includePrerelease?r=Ss:r=dt}if(e.length===1&&e[0].semver===Oe){if(t.includePrerelease)return!0;e=dt}const n=new Set;let s,o;for(const E of r)E.operator===">"||E.operator===">="?s=pt(s,E,t):E.operator==="<"||E.operator==="<="?o=Et(o,E,t):n.add(E.semver);if(n.size>1)return null;let i;if(s&&o){if(i=Me(s.semver,o.semver,t),i>0)return null;if(i===0&&(s.operator!==">="||o.operator!=="<="))return null}for(const E of n){if(s&&!te(E,String(s),t)||o&&!te(E,String(o),t))return null;for(const C of e)if(!te(E,String(C),t))return!1;return!0}let a,u,l,c,f=o&&!t.includePrerelease&&o.semver.prerelease.length?o.semver:!1,S=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;f&&f.prerelease.length===1&&o.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const E of e){if(c=c||E.operator===">"||E.operator===">=",l=l||E.operator==="<"||E.operator==="<=",s){if(S&&E.semver.prerelease&&E.semver.prerelease.length&&E.semver.major===S.major&&E.semver.minor===S.minor&&E.semver.patch===S.patch&&(S=!1),E.operator===">"||E.operator===">="){if(a=pt(s,E,t),a===E&&a!==s)return!1}else if(s.operator===">="&&!te(s.semver,String(E),t))return!1}if(o){if(f&&E.semver.prerelease&&E.semver.prerelease.length&&E.semver.major===f.major&&E.semver.minor===f.minor&&E.semver.patch===f.patch&&(f=!1),E.operator==="<"||E.operator==="<="){if(u=Et(o,E,t),u===E&&u!==o)return!1}else if(o.operator==="<="&&!te(o.semver,String(E),t))return!1}if(!E.operator&&(o||s)&&i!==0)return!1}return!(s&&l&&!o&&i!==0||o&&c&&!s&&i!==0||S||f)},pt=(r,e,t)=>{if(!r)return e;const n=Me(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},Et=(r,e,t)=>{if(!r)return e;const n=Me(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};var ws=ys;const Ae=se,vt=pe,Ns=L,mt=Ot,Os=Z,As=Nr,Ls=Lr,_s=xr,xs=br,Ds=Ur,bs=Br,Cs=Vr,Ps=qr,Us=D,Gs=Yr,Fs=Jr,Bs=Ce,Ms=rn,js=on,Vs=ve,Xs=Pe,zs=At,qs=Lt,Hs=Ue,ks=Ge,Ks=_t,Ys=Ln,Ws=me(),Zs=b(),Js=ge,Qs=Xn,ei=kn,ti=Zn,ri=es,ni=ns,si=Fe,ii=ds,oi=vs,ai=gs,ci=Rs,li=ws;var ui={parse:Os,valid:As,clean:Ls,inc:_s,diff:xs,major:Ds,minor:bs,patch:Cs,prerelease:Ps,compare:Us,rcompare:Gs,compareLoose:Fs,compareBuild:Bs,sort:Ms,rsort:js,gt:Vs,lt:Xs,eq:zs,neq:qs,gte:Hs,lte:ks,cmp:Ks,coerce:Ys,Comparator:Ws,Range:Zs,satisfies:Js,toComparators:Qs,maxSatisfying:ei,minSatisfying:ti,minVersion:ri,validRange:ni,outside:si,gtr:ii,ltr:oi,intersects:ai,simplifyRange:ci,subset:li,SemVer:Ns,re:Ae.re,src:Ae.src,tokens:Ae.t,SEMVER_SPEC_VERSION:vt.SEMVER_SPEC_VERSION,RELEASE_TYPES:vt.RELEASE_TYPES,compareIdentifiers:mt.compareIdentifiers,rcompareIdentifiers:mt.rcompareIdentifiers};const gt=Yt(ui);var O;(function(r){r.blue="blue",r.nanoS="nanoS",r.nanoSP="nanoSP",r.nanoX="nanoX",r.stax="stax"})(O||(O={}));const De={[O.blue]:{id:O.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:r=>4*1024},[O.nanoS]:{id:O.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:r=>{var e;return gt.lt((e=gt.coerce(r))!==null&&e!==void 0?e:"","2.0.0")?4*1024:2*1024}},[O.nanoSP]:{id:O.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1536*1024,masks:[856686592],getBlockSize:r=>32},[O.nanoX]:{id:O.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:r=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[O.stax]:{id:O.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1536*1024,masks:[857735168],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]}};O.blue,O.nanoS,O.nanoSP,O.nanoX,O.stax;const It=Object.values(De),Ie=11415,$e=r=>{const e=It.find(s=>s.legacyUsbProductId===r);if(e)return e;const t=r>>8;return It.find(s=>s.productIdMM===t)},hi=[],$t={};for(const r in De){const e=De[r],{bluetoothSpec:t}=e;if(t)for(let n=0;n<t.length;n++){const s=t[n];hi.push(s.serviceUuid),$t[s.serviceUuid]=$t[s.serviceUuid.replace(/-/g,"")]=Object.assign({deviceModel:e},s)}}var fi=0,B=[],he=function(r,e,t){var n={type:r,id:String(++fi),date:new Date};e&&(n.message=e),t&&(n.data=t),pi(n)},di=function(r){return B.push(r),function(){var e=B.indexOf(r);e!==-1&&(B[e]=B[B.length-1],B.pop())}};function pi(r){for(var e=0;e<B.length;e++)try{B[e](r)}catch(t){console.error(t)}}typeof window<"u"&&(window.__ledgerLogsListen=di);var F=globalThis&&globalThis.__awaiter||function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(c){try{l(n.next(c))}catch(f){i(f)}}function u(c){try{l(n.throw(c))}catch(f){i(f)}}function l(c){c.done?o(c.value):s(c.value).then(a,u)}l((n=n.apply(r,e||[])).next())})};const Ei=[{vendorId:Ie}],vi=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),fe=()=>{const{hid:r}=navigator;if(!r)throw new M("navigator.hid is not supported","HIDNotSupported");return r};function bt(){return F(this,void 0,void 0,function*(){const r=yield fe().requestDevice({filters:Ei});return Array.isArray(r)?r:[r]})}function je(){return F(this,void 0,void 0,function*(){return(yield fe().getDevices()).filter(e=>e.vendorId===Ie)})}function mi(){return F(this,void 0,void 0,function*(){const r=yield je();return r.length>0?r[0]:(yield bt())[0]})}class j extends de{constructor(e){super(),this.channel=Math.floor(Math.random()*65535),this.packetSize=64,this.inputs=[],this.read=()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(t=>{this.inputCallback=t}),this.onInputReport=t=>{const n=Buffer.from(t.data.buffer);this.inputCallback?(this.inputCallback(n),this.inputCallback=null):this.inputs.push(n)},this._disconnectEmitted=!1,this._emitDisconnect=t=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",t))},this.exchange=t=>F(this,void 0,void 0,function*(){return yield this.exchangeAtomicImpl(()=>F(this,void 0,void 0,function*(){const{channel:s,packetSize:o}=this;he("apdu","=> "+t.toString("hex"));const i=wt(s,o),a=i.makeBlocks(t);for(let c=0;c<a.length;c++)yield this.device.sendReport(0,a[c]);let u,l;for(;!(u=i.getReducedResult(l));){const c=yield this.read();l=i.reduceResponse(l,c)}return he("apdu","<= "+u.toString("hex")),u})).catch(s=>{throw s&&s.message&&s.message.includes("write")?(this._emitDisconnect(s),new Tt(s.message)):s})}),this.device=e,this.deviceModel=typeof e.productId=="number"?$e(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static request(){return F(this,void 0,void 0,function*(){const[e]=yield bt();return j.open(e)})}static openConnected(){return F(this,void 0,void 0,function*(){const e=yield je();return e.length===0?null:j.open(e[0])})}static open(e){return F(this,void 0,void 0,function*(){yield e.open();const t=new j(e),n=s=>{e===s.device&&(fe().removeEventListener("disconnect",n),t._emitDisconnect(new St))};return fe().addEventListener("disconnect",n),t})}close(){return F(this,void 0,void 0,function*(){yield this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),yield this.device.close()})}setScrambleKey(){}}j.isSupported=vi;j.list=je;j.listen=r=>{let e=!1;mi().then(n=>{if(!n)r.error(new Le("Access denied to use Ledger device"));else if(!e){const s=typeof n.productId=="number"?$e(n.productId):void 0;r.next({type:"add",descriptor:n,deviceModel:s}),r.complete()}},n=>{r.error(new Le(n.message))});function t(){e=!0}return{unsubscribe:t}};var Ve=globalThis&&globalThis.__awaiter||function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(c){try{l(n.next(c))}catch(f){i(f)}}function u(c){try{l(n.throw(c))}catch(f){i(f)}}function l(c){c.done?o(c.value):s(c.value).then(a,u)}l((n=n.apply(r,e||[])).next())})};const gi=[{vendorId:Ie}];function Ct(){return Ve(this,void 0,void 0,function*(){return yield navigator.usb.requestDevice({filters:gi})})}function Xe(){return Ve(this,void 0,void 0,function*(){return(yield navigator.usb.getDevices()).filter(e=>e.vendorId===Ie)})}function Ii(){return Ve(this,void 0,void 0,function*(){const r=yield Xe();return r.length>0?r[0]:Ct()})}const $i=()=>Promise.resolve(!!navigator&&!!navigator.usb&&typeof navigator.usb.getDevices=="function");var X=globalThis&&globalThis.__awaiter||function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(c){try{l(n.next(c))}catch(f){i(f)}}function u(c){try{l(n.throw(c))}catch(f){i(f)}}function l(c){c.done?o(c.value):s(c.value).then(a,u)}l((n=n.apply(r,e||[])).next())})};const Ri=1,Rt=3;class V extends de{constructor(e,t){super(),this.channel=Math.floor(Math.random()*65535),this.packetSize=64,this._disconnectEmitted=!1,this._emitDisconnect=n=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",n))},this.device=e,this.interfaceNumber=t,this.deviceModel=$e(e.productId)}static request(){return X(this,void 0,void 0,function*(){const e=yield Ct();return V.open(e)})}static openConnected(){return X(this,void 0,void 0,function*(){const e=yield Xe();return e.length===0?null:V.open(e[0])})}static open(e){return X(this,void 0,void 0,function*(){yield e.open(),e.configuration===null&&(yield e.selectConfiguration(Ri)),yield yt(e);const t=e.configurations[0].interfaces.find(({alternates:i})=>i.some(a=>a.interfaceClass===255));if(!t)throw new qe("No WebUSB interface found for your Ledger device. Please upgrade firmware or contact techsupport.");const n=t.interfaceNumber;try{yield e.claimInterface(n)}catch(i){throw yield e.close(),new qe(i.message)}const s=new V(e,n),o=i=>{e===i.device&&(navigator.usb.removeEventListener("disconnect",o),s._emitDisconnect(new St))};return navigator.usb.addEventListener("disconnect",o),s})}close(){return X(this,void 0,void 0,function*(){yield this.exchangeBusyPromise,yield this.device.releaseInterface(this.interfaceNumber),yield yt(this.device),yield this.device.close()})}exchange(e){return X(this,void 0,void 0,function*(){return yield this.exchangeAtomicImpl(()=>X(this,void 0,void 0,function*(){const{channel:n,packetSize:s}=this;he("apdu","=> "+e.toString("hex"));const o=wt(n,s),i=o.makeBlocks(e);for(let l=0;l<i.length;l++)yield this.device.transferOut(Rt,i[l]);let a,u;for(;!(a=o.getReducedResult(u));){const l=yield this.device.transferIn(Rt,s),c=Buffer.from(l.data.buffer);u=o.reduceResponse(u,c)}return he("apdu","<= "+a.toString("hex")),a})).catch(n=>{throw n&&n.message&&n.message.includes("disconnected")?(this._emitDisconnect(n),new Tt(n.message)):n})})}setScrambleKey(){}}V.isSupported=$i;V.list=Xe;V.listen=r=>{let e=!1;Ii().then(n=>{if(!e){const s=$e(n.productId);r.next({type:"add",descriptor:n,deviceModel:s}),r.complete()}},n=>{window.DOMException&&n instanceof window.DOMException&&n.code===18?r.error(new ar(n.message)):r.error(new Le(n.message))});function t(){e=!0}return{unsubscribe:t}};function yt(r){return X(this,void 0,void 0,function*(){try{yield r.reset()}catch(e){console.warn(e)}})}const yi=async()=>{try{return await V.create()}catch(r){return navigator.hid||alert("Error: "+r),console.log(r),await j.create()}},Si=async(r,e)=>{const{create_toolkit:t}=await Wt(()=>import("./taquito-83ec16dc.js"),["assets/taquito-83ec16dc.js","assets/taquito.es6-1a402db8.js","assets/main-fb075e9a.js","assets/index-64bbceaa.css","assets/DAppClient-5ba412e0.js"]),{tezos:n,forger:s}=await t(e.rpc),o=new nr(r,e.derivationPath,void 0,e.derivationType);n.setSignerProvider(o);const i=await n.signer.publicKeyHash(),a=i?await n.rpc.getManagerKey(i):void 0;return{account:i,tezos:n,forger:s,managerKey:a==null?void 0:a.toString()}},{request_ledger_setup:Ti}=er();class Pt extends rr{constructor(e,t,n,s,o){super(e,n,s,o),this.transport=t}get AccountType(){return Zt.Ledger}get Icon(){return new Jt("/assets/svg/ledger-wallet-icon.svg",Qt.raw)}get IsAccountSwitchSupported(){return!1}static async create(e,t,n){const s=tr[t];if(!s)throw new Error("Invalid network specification!");const{account:o,tezos:i,forger:a,managerKey:u}=await Si(e,{...n,rpc:(n==null?void 0:n.rpc)??s.rpc});return new Pt(o??"",e,i,a,{networkId:t,managerKey:u})}static async create_transport(){return yi()}static async create_from_cache(){}logout(){this.transport.close()}async switch_wallet(){const e=await Ti({networkId:this.NetworkId,rpc:this.Tezos.rpc.getRpcUrl()});if(!e)throw new Error("Aborted.");return e}async vote(e){const t=await this.forge_ballot_op(e),n=async()=>{const s=this.Tezos.wallet.context,o=await this.Tezos.signer.sign(t,new Uint8Array([3])),i=await this.Tezos.rpc.injectOperation(o.sbytes);return s.operationFactory.createOperation(i)};return new Q(n,"Vote",{account:this.Account,ballot:e})}async propose(e){const t=await this.forge_proposals_op(e),n=async()=>{const s=this.Tezos.wallet.context,o=await this.Tezos.signer.sign(t,new Uint8Array([3])),i=await this.Tezos.rpc.injectOperation(o.sbytes);return s.operationFactory.createOperation(i)};return new Q(n,"Propose",{account:this.Account,proposals:e})}async set_deposits_limit(e){const t=await this.forge_set_deposit_op(e),n=async()=>{const s=this.Tezos.wallet.context,o=await this.Tezos.signer.sign(t,new Uint8Array([3])),i=await this.Tezos.rpc.injectOperation(o.sbytes);return s.operationFactory.createOperation(i)};return new Q(n,"Set deposit limit",{account:this.Account,limit:e.toString()})}async update_consensus_key(e){const t=await this.forge_update_consensus_key_op(e),n=async()=>{const s=this.Tezos.wallet.context,o=await this.Tezos.signer.sign(t,new Uint8Array([3])),i=await this.Tezos.rpc.injectOperation(o.sbytes);return s.operationFactory.createOperation(i)};return new Q(n,"Update consensus key",{account:this.Account,"Consensus Key":e})}async restore_consensus_key(){const e=await this.Tezos.signer.publicKey(),t=await this.forge_update_consensus_key_op(e),n=async()=>{const s=this.Tezos.wallet.context,o=await this.Tezos.signer.sign(t,new Uint8Array([3])),i=await this.Tezos.rpc.injectOperation(o.sbytes);return s.operationFactory.createOperation(i)};return new Q(n,"Restore consensus key",{account:this.Account,"Consensus Key":e})}}export{Pt as LedgerSession};
