function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/LedgerSession-CMCr10Rh.js","assets/main-BG0ee8p3.js","assets/main-CJpwEAG2.css","assets/SessionBase-CLBIlJ9v.js","assets/taquito.es6-CZA_0qd1.js","assets/WalletConnectCommunicationClient-CwWhMaOS.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{I as G,i as H,V as M,p as v,P as E,a as O,b as I,c as F,d as Q,T as w,e as z,u as W,r as y,w as Z,f as j,s as Y,o as L,g as $,h as f,j as S,C as X,k as C,S as q,l as J,m as ee,n as K,t as te,F as B,q as D,L as ie,v as se,_ as re,x as ne,y as oe,z as ae,A as le}from"./main-BG0ee8p3.js";function P(t,e,i,s){function r(n){return n instanceof i?n:new i(function(a){a(n)})}return new(i||(i=Promise))(function(n,a){function c(l){try{u(s.next(l))}catch(d){a(d)}}function g(l){try{u(s.throw(l))}catch(d){a(d)}}function u(l){l.done?n(l.value):r(l.value).then(c,g)}u((s=s.apply(t,e||[])).next())})}const k=230;function N(t){const e=[];t.split("/").forEach(r=>{let n=parseInt(r,10);Number.isNaN(n)||(r.length>1&&r[r.length-1]==="'"&&(n+=2147483648),e.push(n))});const s=Buffer.alloc(1+e.length*4);return s[0]=e.length,e.forEach((r,n)=>{s.writeUInt32BE(r,1+4*n)}),s}function ce(t,e){return e===0||e===3?t=t.slice(1):(t[0]=2+(t[64]&1),t=t.slice(0,33)),t}function ue(t,e){let i=t;return typeof e<"u"&&(i=Buffer.from(e).toString("hex").concat(t)),i}function de(t,e){let i=0;for(;i!==e.length;){const s=i+k>=e.length?e.length-i:k,r=Buffer.alloc(s);e.copy(r,0,i,i+s),t.push(r),i+=s}return t}function he(t){let e=!0;t[0]!==49&&t[0]!==48&&(e=!1),t[1]+4!==t.length&&(e=!1),t[2]!==2&&(e=!1);const i=t[3];t[4+i]!==2&&(e=!1);const s=5+i,r=t[s];return s+1+r+2!==t.length&&(e=!1),e}function V(t,e){const i=Buffer.alloc(32);i.fill(0);let s=e[t],r=t+1;return s>32&&(r+=s-32,s=32),e.copy(i,32-s,r,r+s),{buffer:i,idxValueStart:r,length:s}}class fe extends w{constructor(e){super(),this.message=e,this.name="InvalidLedgerResponseError"}}class pe extends w{constructor(e){super(),this.cause=e,this.name="PublicKeyRetrievalError",this.message="Unable to retrieve Public Key from Ledger"}}class ve extends w{constructor(){super(),this.name="PublicKeyHashRetrievalError",this.message="Unable to retrieve Public Key Hash from Ledger"}}class Ee extends O{constructor(e){super(),this.derivationType=e,this.name="InvalidDerivationTypeError",this.message=`Invalid derivation type ${e} expecting one of the following: DerivationType.ED25519, DerivationType.SECP256K1, DerivationType.P256 or DerivationType.BIP32_ED25519`}}var o;(function(t){t[t.ED25519=0]="ED25519",t[t.SECP256K1=1]="SECP256K1",t[t.P256=2]="P256",t[t.BIP32_ED25519=3]="BIP32_ED25519"})(o||(o={}));class Ce{constructor(e,i="44'/1729'/0'/0'",s=!0,r=o.ED25519){if(this.transport=e,this.path=i,this.prompt=s,this.derivationType=r,this.CLA=128,this.INS_GET_PUBLIC_KEY=2,this.INS_PROMPT_PUBLIC_KEY=3,this.INS_SIGN=4,this.FIRST_MESSAGE_SEQUENCE=0,this.LAST_MESSAGE_SEQUENCE=129,this.OTHER_MESSAGE_SEQUENCE=1,this.transport.setScrambleKey("XTZ"),!i.startsWith("44'/1729'"))throw new G(i,`${H(M.NO_PREFIX_MATCHED)} expecting prefix "44'/1729'".`);if(!Object.values(o).includes(r))throw new Ee(r.toString())}publicKeyHash(){return P(this,void 0,void 0,function*(){if(this._publicKeyHash||(yield this.publicKey()),this._publicKeyHash)return this._publicKeyHash;throw new ve})}publicKey(){return P(this,void 0,void 0,function*(){if(this._publicKey)return this._publicKey;const e=yield this.getLedgerPublicKey(),i=e[0],s=e.slice(1,1+i),r=ce(s,this.derivationType),n=this.getPrefixes(),a=I(r,n.prefPk),c=I(F.hash(r,20),n.prefPkh);return this._publicKey=a,this._publicKeyHash=c,a})}getLedgerPublicKey(){return P(this,void 0,void 0,function*(){try{let e=this.INS_PROMPT_PUBLIC_KEY;return this.prompt===!1&&(e=this.INS_GET_PUBLIC_KEY),yield this.transport.send(this.CLA,e,this.FIRST_MESSAGE_SEQUENCE,this.derivationType,N(this.path))}catch(e){throw new pe(e)}})}secretKey(){return P(this,void 0,void 0,function*(){throw new Q("Secret key cannot be exposed")})}sign(e,i){return P(this,void 0,void 0,function*(){const s=ue(e,i),r=Buffer.from(s,"hex");let n=[];n.push(N(this.path)),n=de(n,r);const a=yield this.signWithLedger(n);let c;if(this.derivationType===o.ED25519||this.derivationType===o.BIP32_ED25519)c=a.slice(0,a.length-2).toString("hex");else{if(!he(a))throw new fe("Invalid signature return by ledger unable to parse the response");const u=V(3,a),l=u.idxValueStart+u.length+1,d=V(l,a);c=Buffer.concat([u.buffer,d.buffer]).toString("hex")}return{bytes:e,sig:I(c,v[E.SIG]),prefixSig:I(c,this.getPrefixes().prefSig),sbytes:e+c}})}signWithLedger(e){return P(this,void 0,void 0,function*(){let i=yield this.transport.send(this.CLA,this.INS_SIGN,this.FIRST_MESSAGE_SEQUENCE,this.derivationType,e[0]);for(let s=1;s<e.length;s++){const r=s===e.length-1?this.LAST_MESSAGE_SEQUENCE:this.OTHER_MESSAGE_SEQUENCE;i=yield this.transport.send(this.CLA,this.INS_SIGN,r,this.derivationType,e[s])}return i})}getPrefixes(){return this.derivationType===o.ED25519||this.derivationType===o.BIP32_ED25519?{prefPk:v[E.EDPK],prefPkh:v[E.TZ1],prefSig:v[E.EDSIG]}:this.derivationType===o.SECP256K1?{prefPk:v[E.SPPK],prefPkh:v[E.TZ2],prefSig:v[E.SPSIG]}:{prefPk:v[E.P2PK],prefPkh:v[E.TZ3],prefSig:v[E.P2SIG]}}}const x=t=>(ne("data-v-b9bc9fad"),t=t(),oe(),t),_e={class:"center"},ge={class:"card z-depth-2"},Se={class:"content"},Pe=x(()=>f("div",{class:"icon-wrap center pv-2"},[f("img",{src:ae,width:"50"})],-1)),me=x(()=>f("div",{class:"headline pv-3"},"Connect your Ledger",-1)),ye={key:0,class:"deriv-path"},be=x(()=>f("div",{class:"pt-1 space-1"},null,-1)),Ie={key:1,class:"error-text pt-2"},xe=x(()=>f("div",{class:"pv-2 space-2",style:{"grid-row":"9","grid-colum":"1"}},null,-1)),Le={class:"buttons pt-0 pb-2"},T="44'/1729'/0'/0'",De=z({__name:"LedgerDialog",props:{context:{}},emits:["cancel","confirm"],setup(t,{emit:e}){const i=t,s=e,r=W("Derivation Path"),n=[{id:o.ED25519,label:o[o.ED25519]},{id:o.SECP256K1,label:o[o.SECP256K1]},{id:o.P256,label:o[o.P256]},{id:o.BIP32_ED25519,label:o[o.BIP32_ED25519]}],a=y(!1),c=n[0],g=y(c),u=y(T),l=y(void 0),d=y(!1);let b=!1;Z(()=>i.context.active,p=>{if(p)b=!1;else{d.value=!1,l.value=void 0;return}});const R=j(()=>d.value||Y(r.value,p=>p(a.value?u.value:T)!==!0));let _;const U=async()=>{try{d.value=!0;const{LedgerSession:p}=await re(()=>import("./LedgerSession-CMCr10Rh.js"),__vite__mapDeps([0,1,2,3,4,5]));_=await p.create_transport();const h=await p.create(_,i.context.networkId,{rpc:i.context.rpc,derivationType:a.value?g.value.id:c.id,derivationPath:a.value?u.value:T});if(b&&h){h.logout();return}typeof i.context.confirm=="function"&&i.context.confirm(h),s("confirm",h)}catch(p){l.value=`Failed to login with ledger!
Error: ${p.message}`,_==null||_.close()}finally{d.value=!1}},A=()=>{b=!0,_==null||_.close(),typeof i.context.cancel=="function"&&i.context.cancel(),s("cancel")};return(p,h)=>(L(),$(se,{to:"#dialog"},[f("div",{class:D(["modal",{"modal-active":p.context.active}]),key:"ledgerDialog"},[f("div",_e,[f("div",ge,[f("div",Se,[Pe,me,S(X,{class:"custom-hd pb-2",label:"Use custom HD derivation path",modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=m=>a.value=m)},null,8,["modelValue"]),a.value?(L(),C("div",ye,[S(q,{portaled:"",label:"Derivation Type",items:n,modelValue:g.value,"onUpdate:modelValue":h[1]||(h[1]=m=>g.value=m)},null,8,["modelValue"]),S(ee,{modelValue:u.value,"onUpdate:modelValue":h[2]||(h[2]=m=>u.value=m),label:"Derivation Path",rules:J(r),"capitalize-label":!0},null,8,["modelValue","rules"])])):K("",!0),be,l.value?(L(),C("div",Ie,te(l.value),1)):K("",!0),xe,f("div",Le,[S(B,{onClick:A,label:"Cancel"}),S(B,{class:D(["confirm-btn",{disabled:R.value}]),onClick:U,label:"Connect"},null,8,["class"])])]),f("div",{class:D(["loader-wrap",{"loader-hidden":!d.value}])},[S(ie,{class:"loader","is-indeterminate":!0,label:"Please confirm operation on your ledger..."})],2)])])],2)]))}}),Te=le(De,[["__scopeId","data-v-b9bc9fad"]]),Ke=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{Ce as L,Ke as a};
