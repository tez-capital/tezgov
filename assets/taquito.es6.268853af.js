import{H as zo,a as vr,S as Vi}from"./taquito-http-utils.es6.757d12df.js";import{v as z,V as I,k as Y,l as ge,B as w,n as Wo,o as Oi,q as qo,r as Pn,s as Tn,u as Jo,w as Yo,P as T,c as Ss,p as Ui,x as Rn,e as Hi,y as Zo,z as _s,f as Xo,A as Qo,b as ta,I as Ki,C as As,D as me,E as Ne,F as ea,G as Gi,H as ra,J as Os,K as Ps,L as Ts,M as ia}from"./taquito-utils.es6.27f0fb74.js";function Rr(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}function N(r,t,e,i){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(p){try{h(i.next(p))}catch(m){o(m)}}function c(p){try{h(i.throw(p))}catch(m){o(m)}}function h(p){p.done?s(p.value):n(p.value).then(a,c)}h((i=i.apply(r,t||[])).next())})}const na="main",L={block:"head"};var In;(function(r){r.GET_BAKING_RIGHTS="getBakingRights",r.GET_BALLOTS="getBallots",r.GET_BALLOT_LIST="getBallotList",r.GET_BIG_MAP_KEY="getBigMapKey",r.GET_BIG_MAP_EXPR="getBigMapExpr",r.GET_BLOCK_HASH="getBlockHash",r.GET_BLOCK="getBlock",r.GET_BLOCK_HEADER="getBlockHeader",r.GET_BLOCK_METADATA="getBlockMetadata",r.GET_BALANCE="getBalance",r.GET_CHAIN_ID="getChainId",r.GET_CONSTANTS="getConstants",r.GET_CONTRACT="getContract",r.GET_CURRENT_PERIOD="getCurrentPeriod",r.GET_CURRENT_PROPOSAL="getCurrentProposal",r.GET_CURRENT_QUORUM="getCurrentQuorum",r.GET_DELEGATE="getDelegate",r.GET_DELEGATES="getDelegates",r.GET_VOTING_INFO="getVotingInfo",r.GET_ENDORSING_RIGHTS="getEndorsingRights",r.GET_ENTRYPOINTS="getEntrypoints",r.GET_LIVE_BLOCKS="getLiveBlocks",r.GET_MANAGER_KEY="getManagerKey",r.GET_NORMALIZED_SCRIPT="getNormalizedScript",r.GET_PROPOSALS="getProposals",r.GET_PROTOCOLS="getProtocols",r.GET_SAPLING_DIFF_BY_CONTRACT="getSaplingDiffByContract",r.GET_SAPLING_DIFF_BY_ID="getSaplingDiffById",r.GET_SCRIPT="getScript",r.GET_STORAGE="getStorage",r.GET_SUCCESSOR_PERIOD="getSuccessorPeriod",r.GET_TX_ROLLUP_INBOX="getTxRollupInbox",r.GET_TX_ROLLUP_STATE="getTxRollupState",r.GET_VOTES_LISTINGS="getVotesListings",r.PACK_DATA="packData"})(In||(In={}));function pr(r,t){const e=Array.isArray(r);typeof t>"u"&&(t=Object.keys(r));const i=e?[]:{};return t.forEach(n=>{const s=r[n];let o;if(!(typeof s>"u")){if(Array.isArray(s)){o=pr(s),i[n]=o;return}o=new w(s),i[n]=o}}),i}var xn;(function(r){r.TOO_LARGE="too large"})(xn||(xn={}));var Nn;(function(r){r.BAKING_REWARDS="baking rewards",r.REWARDS="rewards",r.FEES="fees",r.DEPOSITS="deposits",r.LEGACY_REWARDS="legacy_rewards",r.LEGACY_FEES="legacy_fees",r.LEGACY_DEPOSITS="legacy_deposits",r.BLOCK_FEES="block fees",r.NONCE_REVELATION_REWARDS="nonce revelation rewards",r.DOUBLE_SIGNING_EVIDENCE_REWARDS="double signing evidence rewards",r.ENDORSING_REWARDS="endorsing rewards",r.BAKING_BONUSES="baking bonuses",r.STORAGE_FEES="storage fees",r.PUNISHMENTS="punishments",r.LOST_ENDORSING_REWARDS="lost endorsing rewards",r.SUBSIDY="subsidy",r.BURNED="burned",r.COMMITMENT="commitment",r.BOOTSTRAP="bootstrap",r.INVOICE="invoice",r.MINTED="minted",r.TX_ROLLUP_REJECTION_REWARDS="tx_rollup_rejection_rewards",r.TX_ROLLUP_REJECTION_PUNISHMENTS="tx_rollup_rejection_punishments",r.BONDS="bonds"})(Nn||(Nn={}));var b;(function(r){r.ORIGINATION="origination",r.DELEGATION="delegation",r.REVEAL="reveal",r.TRANSACTION="transaction",r.ACTIVATION="activate_account",r.ENDORSEMENT="endorsement",r.PREENDORSEMENT="preendorsement",r.SET_DEPOSITS_LIMIT="set_deposits_limit",r.DOUBLE_PREENDORSEMENT_EVIDENCE="double_preendorsement_evidence",r.ENDORSEMENT_WITH_SLOT="endorsement_with_slot",r.SEED_NONCE_REVELATION="seed_nonce_revelation",r.DOUBLE_ENDORSEMENT_EVIDENCE="double_endorsement_evidence",r.DOUBLE_BAKING_EVIDENCE="double_baking_evidence",r.PROPOSALS="proposals",r.BALLOT="ballot",r.FAILING_NOOP="failing_noop",r.REGISTER_GLOBAL_CONSTANT="register_global_constant",r.TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.TX_ROLLUP_COMMIT="tx_rollup_commit",r.TX_ROLLUP_RETURN_BOND="tx_rollup_return_bond",r.TX_ROLLUP_FINALIZE_COMMITMENT="tx_rollup_finalize_commitment",r.TX_ROLLUP_REMOVE_COMMITMENT="tx_rollup_remove_commitment",r.TX_ROLLUP_REJECTION="tx_rollup_rejection",r.TX_ROLLUP_DISPATCH_TICKETS="tx_rollup_dispatch_tickets",r.TRANSFER_TICKET="transfer_ticket",r.INCREASE_PAID_STORAGE="increase_paid_storage",r.VDF_REVELATION="vdf_revelation",r.EVENT="event"})(b||(b={}));class Mr{constructor(t,e=na,i=new zo){this.url=t,this.chain=e,this.httpBackend=i}createURL(t){return`${this.url.replace(/\/+$/g,"")}${t}`}validateAddress(t){if(z(t)!==I.VALID)throw new Y(t)}validateContract(t){if(ge(t)!==I.VALID)throw new Y(t)}getBlockHash({block:t}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/hash`),method:"GET"})})}getLiveBlocks({block:t}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/live_blocks`),method:"GET"})})}getBalance(t,{block:e}=L){return N(this,void 0,void 0,function*(){this.validateAddress(t);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/balance`),method:"GET"});return new w(i)})}getStorage(t,{block:e}=L){return N(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage`),method:"GET"})})}getScript(t,{block:e}=L){return N(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/script`),method:"GET"})})}getNormalizedScript(t,e={unparsing_mode:"Readable"},{block:i}=L){return N(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/contracts/${t}/script/normalized`),method:"POST"},e)})}getContract(t,{block:e}=L){return N(this,void 0,void 0,function*(){this.validateAddress(t);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}`),method:"GET"});return Object.assign(Object.assign({},i),{balance:new w(i.balance)})})}getManagerKey(t,{block:e}=L){return N(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/manager_key`),method:"GET"})})}getDelegate(t,{block:e}=L){return N(this,void 0,void 0,function*(){this.validateAddress(t);let i;try{i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/delegate`),method:"GET"})}catch(n){if(n instanceof vr&&n.status===Vi.NOT_FOUND)i=null;else throw n}return i})}getBigMapKey(t,e,{block:i}=L){return N(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/contracts/${t}/big_map_get`),method:"POST"},e)})}getBigMapExpr(t,e,{block:i}=L){return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/big_maps/${t}/${e}`),method:"GET"})})}getDelegates(t,{block:e}=L){return N(this,void 0,void 0,function*(){this.validateAddress(t);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}`),method:"GET"}),n=pr(i,["balance","full_balance","current_frozen_deposits","frozen_deposits","frozen_balance","frozen_deposits_limit","staking_balance","delegated_balance","voting_power"]);return Object.assign(Object.assign(Object.assign({},i),n),{frozen_balance_by_cycle:i.frozen_balance_by_cycle?i.frozen_balance_by_cycle.map(s=>{var{deposit:o,deposits:a,fees:c,rewards:h}=s,p=Rr(s,["deposit","deposits","fees","rewards"]);const m=pr({deposit:o,deposits:a,fees:c,rewards:h},["deposit","deposits","fees","rewards"]);return Object.assign(Object.assign({},p),{deposit:m.deposit,deposits:m.deposits,fees:m.fees,rewards:m.rewards})}):void 0})})}getVotingInfo(t,{block:e}=L){return N(this,void 0,void 0,function*(){return this.validateAddress(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}/voting_info`),method:"GET"})})}getConstants({block:t}=L){return N(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/context/constants`),method:"GET"}),i=pr(e,["time_between_blocks","hard_gas_limit_per_operation","hard_gas_limit_per_block","proof_of_work_threshold","tokens_per_roll","seed_nonce_revelation_tip","block_security_deposit","endorsement_security_deposit","block_reward","endorsement_reward","cost_per_byte","hard_storage_limit_per_operation","test_chain_duration","baking_reward_per_endorsement","delay_per_missing_endorsement","minimal_block_delay","liquidity_baking_subsidy","cache_layout","baking_reward_fixed_portion","baking_reward_bonus_per_slot","endorsing_reward_per_slot","double_baking_punishment","delay_increment_per_round","tx_rollup_commitment_bond","vdf_difficulty","sc_rollup_stake_amount"]);return Object.assign(Object.assign({},e),i)})}getBlock({block:t}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}`),method:"GET"})})}getBlockHeader({block:t}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/header`),method:"GET"})})}getBlockMetadata({block:t}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/metadata`),method:"GET"})})}getBakingRights(t={},{block:e}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/baking_rights`),method:"GET",query:t})})}getEndorsingRights(t={},{block:e}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/endorsing_rights`),method:"GET",query:t})})}getBallotList({block:t}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballot_list`),method:"GET"})})}getBallots({block:t}=L){return N(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballots`),method:"GET"});return pr(e,["yay","nay","pass"])})}getCurrentProposal({block:t}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_proposal`),method:"GET"})})}getCurrentQuorum({block:t}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_quorum`),method:"GET"})})}getVotesListings({block:t}=L){return N(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/listings`),method:"GET"});return e.map(i=>(i.voting_power&&(i.voting_power=new w(i.voting_power)),i)),e})}getProposals({block:t}=L){return N(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/proposals`),method:"GET"});return e.map(i=>i[1]=new w(i[1])),e})}forgeOperations(t,{block:e}=L){return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/forge/operations`),method:"POST"},t)})}injectOperation(t){return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL("/injection/operation"),method:"POST"},t)})}preapplyOperations(t,{block:e}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/preapply/operations`),method:"POST"},t)})}getEntrypoints(t,{block:e}=L){return N(this,void 0,void 0,function*(){return this.validateContract(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/entrypoints`),method:"GET"})})}runOperation(t,{block:e}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_operation`),method:"POST"},t)})}runCode(t,{block:e}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_code`),method:"POST"},t)})}runScriptView(t,{block:e}=L){var{unparsing_mode:i="Readable"}=t,n=Rr(t,["unparsing_mode"]);return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_script_view`),method:"POST"},Object.assign({unparsing_mode:i},n))})}runView(t,{block:e}=L){var{unparsing_mode:i="Readable"}=t,n=Rr(t,["unparsing_mode"]);return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_view`),method:"POST"},Object.assign({unparsing_mode:i},n))})}getChainId(){return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/chain_id`),method:"GET"})})}packData(t,{block:e}=L){return N(this,void 0,void 0,function*(){const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/pack_data`),method:"POST"},t),{gas:n}=i,s=Rr(i,["gas"]);let o=n;const a=new w(n||"");return a.isNaN()||(o=a),Object.assign({gas:o},s)})}getRpcUrl(){return this.url}getCurrentPeriod({block:t}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_period`),method:"GET"})})}getSuccessorPeriod({block:t}=L){return N(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/successor_period`),method:"GET"})})}getSaplingDiffById(t,{block:e}=L){return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/sapling/${t}/get_diff`),method:"GET"})})}getSaplingDiffByContract(t,{block:e}=L){return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/single_sapling_get_diff`),method:"GET"})})}getProtocols({block:t}=L){return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/protocols`),method:"GET"})})}getTxRollupState(t,{block:e}=L){return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/tx_rollup/${t}/state`),method:"GET"})})}getTxRollupInbox(t,e,{block:i}=L){return N(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/tx_rollup/${t}/inbox/${e}`),method:"GET"})})}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Pi=function(r,t){return Pi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},Pi(r,t)};function D(r,t){Pi(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function $r(r){return typeof r=="function"}var Ln=!1,xt={Promise:void 0,set useDeprecatedSynchronousErrorHandling(r){if(r){var t=new Error;""+t.stack}Ln=r},get useDeprecatedSynchronousErrorHandling(){return Ln}};function qe(r){setTimeout(function(){throw r},0)}var Vr={closed:!0,next:function(r){},error:function(r){if(xt.useDeprecatedSynchronousErrorHandling)throw r;qe(r)},complete:function(){}},Fi=function(){return Array.isArray||function(r){return r&&typeof r.length=="number"}}();function Rs(r){return r!==null&&typeof r=="object"}var sa=function(){function r(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(e,i){return i+1+") "+e.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return r.prototype=Object.create(Error.prototype),r}(),kr=sa,At=function(){function r(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return r.prototype.unsubscribe=function(){var t;if(!this.closed){var e=this,i=e._parentOrParents,n=e._ctorUnsubscribe,s=e._unsubscribe,o=e._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,i instanceof r)i.remove(this);else if(i!==null)for(var a=0;a<i.length;++a){var c=i[a];c.remove(this)}if($r(s)){n&&(this._unsubscribe=void 0);try{s.call(this)}catch(m){t=m instanceof kr?Cn(m.errors):[m]}}if(Fi(o))for(var a=-1,h=o.length;++a<h;){var p=o[a];if(Rs(p))try{p.unsubscribe()}catch(E){t=t||[],E instanceof kr?t=t.concat(Cn(E.errors)):t.push(E)}}if(t)throw new kr(t)}},r.prototype.add=function(t){var e=t;if(!t)return r.EMPTY;switch(typeof t){case"function":e=new r(t);case"object":if(e===this||e.closed||typeof e.unsubscribe!="function")return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof r)){var i=e;e=new r,e._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var n=e._parentOrParents;if(n===null)e._parentOrParents=this;else if(n instanceof r){if(n===this)return e;e._parentOrParents=[n,this]}else if(n.indexOf(this)===-1)n.push(this);else return e;var s=this._subscriptions;return s===null?this._subscriptions=[e]:s.push(e),e},r.prototype.remove=function(t){var e=this._subscriptions;if(e){var i=e.indexOf(t);i!==-1&&e.splice(i,1)}},r.EMPTY=function(t){return t.closed=!0,t}(new r),r}();function Cn(r){return r.reduce(function(t,e){return t.concat(e instanceof kr?e.errors:e)},[])}var Ur=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),Q=function(r){D(t,r);function t(e,i,n){var s=r.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=Vr;break;case 1:if(!e){s.destination=Vr;break}if(typeof e=="object"){e instanceof t?(s.syncErrorThrowable=e.syncErrorThrowable,s.destination=e,e.add(s)):(s.syncErrorThrowable=!0,s.destination=new Dn(s,e));break}default:s.syncErrorThrowable=!0,s.destination=new Dn(s,e,i,n);break}return s}return t.prototype[Ur]=function(){return this},t.create=function(e,i,n){var s=new t(e,i,n);return s.syncErrorThrowable=!1,s},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(At),Dn=function(r){D(t,r);function t(e,i,n,s){var o=r.call(this)||this;o._parentSubscriber=e;var a,c=o;return $r(i)?a=i:i&&(a=i.next,n=i.error,s=i.complete,i!==Vr&&(c=Object.create(i),$r(c.unsubscribe)&&o.add(c.unsubscribe.bind(c)),c.unsubscribe=o.unsubscribe.bind(o))),o._context=c,o._next=a,o._error=n,o._complete=s,o}return t.prototype.next=function(e){if(!this.isStopped&&this._next){var i=this._parentSubscriber;!xt.useDeprecatedSynchronousErrorHandling||!i.syncErrorThrowable?this.__tryOrUnsub(this._next,e):this.__tryOrSetError(i,this._next,e)&&this.unsubscribe()}},t.prototype.error=function(e){if(!this.isStopped){var i=this._parentSubscriber,n=xt.useDeprecatedSynchronousErrorHandling;if(this._error)!n||!i.syncErrorThrowable?(this.__tryOrUnsub(this._error,e),this.unsubscribe()):(this.__tryOrSetError(i,this._error,e),this.unsubscribe());else if(i.syncErrorThrowable)n?(i.syncErrorValue=e,i.syncErrorThrown=!0):qe(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;qe(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var i=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};!xt.useDeprecatedSynchronousErrorHandling||!i.syncErrorThrowable?(this.__tryOrUnsub(n),this.unsubscribe()):(this.__tryOrSetError(i,n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,i){try{e.call(this._context,i)}catch(n){if(this.unsubscribe(),xt.useDeprecatedSynchronousErrorHandling)throw n;qe(n)}},t.prototype.__tryOrSetError=function(e,i,n){if(!xt.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{i.call(this._context,n)}catch(s){return xt.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=s,e.syncErrorThrown=!0,!0):(qe(s),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(Q);function oa(r){for(;r;){var t=r,e=t.closed,i=t.destination,n=t.isStopped;if(e||n)return!1;i&&i instanceof Q?r=i:r=null}return!0}function aa(r,t,e){if(r){if(r instanceof Q)return r;if(r[Ur])return r[Ur]()}return!r&&!t&&!e?new Q(Vr):new Q(r,t,e)}var wr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function zi(r){return r}function ca(r){return r.length===0?zi:r.length===1?r[0]:function(e){return r.reduce(function(i,n){return n(i)},e)}}var Z=function(){function r(t){this._isScalar=!1,t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,i){var n=this.operator,s=aa(t,e,i);if(n?s.add(n.call(s,this.source)):s.add(this.source||xt.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),xt.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){xt.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),oa(t)?t.error(e):console.warn(e)}},r.prototype.forEach=function(t,e){var i=this;return e=Mn(e),new e(function(n,s){var o;o=i.subscribe(function(a){try{t(a)}catch(c){s(c),o&&o.unsubscribe()}},s,n)})},r.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},r.prototype[wr]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length===0?this:ca(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=Mn(t),new t(function(i,n){var s;e.subscribe(function(o){return s=o},function(o){return n(o)},function(){return i(s)})})},r.create=function(t){return new r(t)},r}();function Mn(r){if(r||(r=xt.Promise||Promise),!r)throw new Error("no Promise impl found");return r}var ua=function(){function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return r.prototype=Object.create(Error.prototype),r}(),Be=ua,Is=function(r){D(t,r);function t(e,i){var n=r.call(this)||this;return n.subject=e,n.subscriber=i,n.closed=!1,n}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,i=e.observers;if(this.subject=null,!(!i||i.length===0||e.isStopped||e.closed)){var n=i.indexOf(this.subscriber);n!==-1&&i.splice(n,1)}}},t}(At),xs=function(r){D(t,r);function t(e){var i=r.call(this,e)||this;return i.destination=e,i}return t}(Q),tr=function(r){D(t,r);function t(){var e=r.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype[Ur]=function(){return new xs(this)},t.prototype.lift=function(e){var i=new kn(this,this);return i.operator=e,i},t.prototype.next=function(e){if(this.closed)throw new Be;if(!this.isStopped)for(var i=this.observers,n=i.length,s=i.slice(),o=0;o<n;o++)s[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new Be;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var i=this.observers,n=i.length,s=i.slice(),o=0;o<n;o++)s[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Be;this.isStopped=!0;for(var e=this.observers,i=e.length,n=e.slice(),s=0;s<i;s++)n[s].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(e){if(this.closed)throw new Be;return r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){if(this.closed)throw new Be;return this.hasError?(e.error(this.thrownError),At.EMPTY):this.isStopped?(e.complete(),At.EMPTY):(this.observers.push(e),new Is(this,e))},t.prototype.asObservable=function(){var e=new Z;return e.source=this,e},t.create=function(e,i){return new kn(e,i)},t}(Z),kn=function(r){D(t,r);function t(e,i){var n=r.call(this)||this;return n.destination=e,n.source=i,n}return t.prototype.next=function(e){var i=this.destination;i&&i.next&&i.next(e)},t.prototype.error=function(e){var i=this.destination;i&&i.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){var i=this.source;return i?this.source.subscribe(e):At.EMPTY},t}(tr);function gr(){return function(t){return t.lift(new ha(t))}}var ha=function(){function r(t){this.connectable=t}return r.prototype.call=function(t,e){var i=this.connectable;i._refCount++;var n=new la(t,i),s=e.subscribe(n);return n.closed||(n.connection=i.connect()),s},r}(),la=function(r){D(t,r);function t(e,i){var n=r.call(this,e)||this;return n.connectable=i,n}return t.prototype._unsubscribe=function(){var e=this.connectable;if(!e){this.connection=null;return}this.connectable=null;var i=e._refCount;if(i<=0){this.connection=null;return}if(e._refCount=i-1,i>1){this.connection=null;return}var n=this.connection,s=e._connection;this.connection=null,s&&(!n||s===n)&&s.unsubscribe()},t}(Q),pa=function(r){D(t,r);function t(e,i){var n=r.call(this)||this;return n.source=e,n.subjectFactory=i,n._refCount=0,n._isComplete=!1,n}return t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,e=this._connection=new At,e.add(this.source.subscribe(new fa(this.getSubject(),this))),e.closed&&(this._connection=null,e=At.EMPTY)),e},t.prototype.refCount=function(){return gr()(this)},t}(Z),da=function(){var r=pa.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:r._subscribe},_isComplete:{value:r._isComplete,writable:!0},getSubject:{value:r.getSubject},connect:{value:r.connect},refCount:{value:r.refCount}}}(),fa=function(r){D(t,r);function t(e,i){var n=r.call(this,e)||this;return n.connectable=i,n}return t.prototype._error=function(e){this._unsubscribe(),r.prototype._error.call(this,e)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),r.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var i=e._connection;e._refCount=0,e._subject=null,e._connection=null,i&&i.unsubscribe()}},t}(xs),oi=function(r){D(t,r);function t(e){var i=r.call(this)||this;return i._value=e,i}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(e){var i=r.prototype._subscribe.call(this,e);return i&&!i.closed&&e.next(this._value),i},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Be;return this._value},t.prototype.next=function(e){r.prototype.next.call(this,this._value=e)},t}(tr),ga=function(r){D(t,r);function t(e,i){return r.call(this)||this}return t.prototype.schedule=function(e,i){return this},t}(At),Ns=function(r){D(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.scheduler=e,n.work=i,n.pending=!1,n}return t.prototype.schedule=function(e,i){if(i===void 0&&(i=0),this.closed)return this;this.state=e;var n=this.id,s=this.scheduler;return n!=null&&(this.id=this.recycleAsyncId(s,n,i)),this.pending=!0,this.delay=i,this.id=this.id||this.requestAsyncId(s,this.id,i),this},t.prototype.requestAsyncId=function(e,i,n){return n===void 0&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,i,n){if(n===void 0&&(n=0),n!==null&&this.delay===n&&this.pending===!1)return i;clearInterval(i)},t.prototype.execute=function(e,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,i);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,i){var n=!1,s=void 0;try{this.work(e)}catch(o){n=!0,s=!!o&&o||new Error(o)}if(n)return this.unsubscribe(),s},t.prototype._unsubscribe=function(){var e=this.id,i=this.scheduler,n=i.actions,s=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,s!==-1&&n.splice(s,1),e!=null&&(this.id=this.recycleAsyncId(i,e,null)),this.delay=null},t}(ga),ma=function(r){D(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.scheduler=e,n.work=i,n}return t.prototype.schedule=function(e,i){return i===void 0&&(i=0),i>0?r.prototype.schedule.call(this,e,i):(this.delay=i,this.state=e,this.scheduler.flush(this),this)},t.prototype.execute=function(e,i){return i>0||this.closed?r.prototype.execute.call(this,e,i):this._execute(e,i)},t.prototype.requestAsyncId=function(e,i,n){return n===void 0&&(n=0),n!==null&&n>0||n===null&&this.delay>0?r.prototype.requestAsyncId.call(this,e,i,n):e.flush(this)},t}(Ns),Bn=function(){function r(t,e){e===void 0&&(e=r.now),this.SchedulerAction=t,this.now=e}return r.prototype.schedule=function(t,e,i){return e===void 0&&(e=0),new this.SchedulerAction(this,t).schedule(i,e)},r.now=function(){return Date.now()},r}(),Ls=function(r){D(t,r);function t(e,i){i===void 0&&(i=Bn.now);var n=r.call(this,e,function(){return t.delegate&&t.delegate!==n?t.delegate.now():i()})||this;return n.actions=[],n.active=!1,n.scheduled=void 0,n}return t.prototype.schedule=function(e,i,n){return i===void 0&&(i=0),t.delegate&&t.delegate!==this?t.delegate.schedule(e,i,n):r.prototype.schedule.call(this,e,i,n)},t.prototype.flush=function(e){var i=this.actions;if(this.active){i.push(e);return}var n;this.active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=i.shift());if(this.active=!1,n){for(;e=i.shift();)e.unsubscribe();throw n}},t}(Bn),ya=function(r){D(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(Ls),ba=new ya(ma),Ea=ba,Cs=new Z(function(r){return r.complete()});function Wi(r){return r?va(r):Cs}function va(r){return new Z(function(t){return r.schedule(function(){return t.complete()})})}function mr(r){return r&&typeof r.schedule=="function"}var Ds=function(r){return function(t){for(var e=0,i=r.length;e<i&&!t.closed;e++)t.next(r[e]);t.complete()}};function qi(r,t){return new Z(function(e){var i=new At,n=0;return i.add(t.schedule(function(){if(n===r.length){e.complete();return}e.next(r[n++]),e.closed||i.add(this.schedule())})),i})}function Ms(r,t){return t?qi(r,t):new Z(Ds(r))}function ar(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r[r.length-1];return mr(e)?(r.pop(),qi(r,e)):Ms(r)}function Ji(r,t){return t?new Z(function(e){return t.schedule(wa,0,{error:r,subscriber:e})}):new Z(function(e){return e.error(r)})}function wa(r){var t=r.error,e=r.subscriber;e.error(t)}var fi=function(){function r(t,e,i){this.kind=t,this.value=e,this.error=i,this.hasValue=t==="N"}return r.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},r.prototype.do=function(t,e,i){var n=this.kind;switch(n){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}},r.prototype.accept=function(t,e,i){return t&&typeof t.next=="function"?this.observe(t):this.do(t,e,i)},r.prototype.toObservable=function(){var t=this.kind;switch(t){case"N":return ar(this.value);case"E":return Ji(this.error);case"C":return Wi()}throw new Error("unexpected notification kind value")},r.createNext=function(t){return typeof t<"u"?new r("N",t):r.undefinedValueNotification},r.createError=function(t){return new r("E",void 0,t)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r.undefinedValueNotification=new r("N",void 0),r}(),Sa=function(r){D(t,r);function t(e,i,n){n===void 0&&(n=0);var s=r.call(this,e)||this;return s.scheduler=i,s.delay=n,s}return t.dispatch=function(e){var i=e.notification,n=e.destination;i.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){var i=this.destination;i.add(this.scheduler.schedule(t.dispatch,this.delay,new _a(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(fi.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(fi.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(fi.createComplete()),this.unsubscribe()},t}(Q),_a=function(){function r(t,e){this.notification=t,this.destination=e}return r}(),yr=function(r){D(t,r);function t(e,i,n){e===void 0&&(e=Number.POSITIVE_INFINITY),i===void 0&&(i=Number.POSITIVE_INFINITY);var s=r.call(this)||this;return s.scheduler=n,s._events=[],s._infiniteTimeWindow=!1,s._bufferSize=e<1?1:e,s._windowTime=i<1?1:i,i===Number.POSITIVE_INFINITY?(s._infiniteTimeWindow=!0,s.next=s.nextInfiniteTimeWindow):s.next=s.nextTimeWindow,s}return t.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var i=this._events;i.push(e),i.length>this._bufferSize&&i.shift()}r.prototype.next.call(this,e)},t.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new Aa(this._getNow(),e)),this._trimBufferThenGetEvents()),r.prototype.next.call(this,e)},t.prototype._subscribe=function(e){var i=this._infiniteTimeWindow,n=i?this._events:this._trimBufferThenGetEvents(),s=this.scheduler,o=n.length,a;if(this.closed)throw new Be;if(this.isStopped||this.hasError?a=At.EMPTY:(this.observers.push(e),a=new Is(this,e)),s&&e.add(e=new Sa(e,s)),i)for(var c=0;c<o&&!e.closed;c++)e.next(n[c]);else for(var c=0;c<o&&!e.closed;c++)e.next(n[c].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),a},t.prototype._getNow=function(){return(this.scheduler||Ea).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),i=this._bufferSize,n=this._windowTime,s=this._events,o=s.length,a=0;a<o&&!(e-s[a].time<n);)a++;return o>i&&(a=Math.max(a,o-i)),a>0&&s.splice(0,a),s},t}(tr),Aa=function(){function r(t,e){this.time=t,this.value=e}return r}(),Oa=new Ls(Ns),ks=Oa;function te(){}var Pa=function(){function r(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return r.prototype=Object.create(Error.prototype),r}(),Ta=Pa,Ra=function(){function r(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return r.prototype=Object.create(Error.prototype),r}(),Bs=Ra;function Ke(r,t){return function(i){if(typeof r!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new Ia(r,t))}}var Ia=function(){function r(t,e){this.project=t,this.thisArg=e}return r.prototype.call=function(t,e){return e.subscribe(new xa(t,this.project,this.thisArg))},r}(),xa=function(r){D(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.project=i,s.count=0,s.thisArg=n||s,s}return t.prototype._next=function(e){var i;try{i=this.project.call(this.thisArg,e,this.count++)}catch(n){this.destination.error(n);return}this.destination.next(i)},t}(Q),Na=function(r){D(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.notifyNext=function(e,i,n,s,o){this.destination.next(i)},t.prototype.notifyError=function(e,i){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(Q),La=function(r){D(t,r);function t(e,i,n){var s=r.call(this)||this;return s.parent=e,s.outerValue=i,s.outerIndex=n,s.index=0,s}return t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(Q),Ca=function(r){return function(t){return r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,qe),t}};function Da(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ai=Da(),Ma=function(r){return function(t){var e=r[ai]();do{var i=void 0;try{i=e.next()}catch(n){return t.error(n),t}if(i.done){t.complete();break}if(t.next(i.value),t.closed)break}while(!0);return typeof e.return=="function"&&t.add(function(){e.return&&e.return()}),t}},ka=function(r){return function(t){var e=r[wr]();if(typeof e.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)}},js=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function $s(r){return!!r&&typeof r.subscribe!="function"&&typeof r.then=="function"}var Yi=function(r){if(!!r&&typeof r[wr]=="function")return ka(r);if(js(r))return Ds(r);if($s(r))return Ca(r);if(!!r&&typeof r[ai]=="function")return Ma(r);var t=Rs(r)?"an invalid object":"'"+r+"'",e="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(e)};function Ba(r,t,e,i,n){if(n===void 0&&(n=new La(r,e,i)),!n.closed)return t instanceof Z?t.subscribe(n):Yi(t)(n)}var jn={};function $n(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=void 0,i=void 0;return mr(r[r.length-1])&&(i=r.pop()),typeof r[r.length-1]=="function"&&(e=r.pop()),r.length===1&&Fi(r[0])&&(r=r[0]),Ms(r,i).lift(new ja(e))}var ja=function(){function r(t){this.resultSelector=t}return r.prototype.call=function(t,e){return e.subscribe(new $a(t,this.resultSelector))},r}(),$a=function(r){D(t,r);function t(e,i){var n=r.call(this,e)||this;return n.resultSelector=i,n.active=0,n.values=[],n.observables=[],n}return t.prototype._next=function(e){this.values.push(jn),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,i=e.length;if(i===0)this.destination.complete();else{this.active=i,this.toRespond=i;for(var n=0;n<i;n++){var s=e[n];this.add(Ba(this,s,void 0,n))}}},t.prototype.notifyComplete=function(e){(this.active-=1)===0&&this.destination.complete()},t.prototype.notifyNext=function(e,i,n){var s=this.values,o=s[n],a=this.toRespond?o===jn?--this.toRespond:this.toRespond:0;s[n]=i,a===0&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},t.prototype._tryResultSelector=function(e){var i;try{i=this.resultSelector.apply(this,e)}catch(n){this.destination.error(n);return}this.destination.next(i)},t}(Na);function Va(r,t){return new Z(function(e){var i=new At;return i.add(t.schedule(function(){var n=r[wr]();i.add(n.subscribe({next:function(s){i.add(t.schedule(function(){return e.next(s)}))},error:function(s){i.add(t.schedule(function(){return e.error(s)}))},complete:function(){i.add(t.schedule(function(){return e.complete()}))}}))})),i})}function Ua(r,t){return new Z(function(e){var i=new At;return i.add(t.schedule(function(){return r.then(function(n){i.add(t.schedule(function(){e.next(n),i.add(t.schedule(function(){return e.complete()}))}))},function(n){i.add(t.schedule(function(){return e.error(n)}))})})),i})}function Ha(r,t){if(!r)throw new Error("Iterable cannot be null");return new Z(function(e){var i=new At,n;return i.add(function(){n&&typeof n.return=="function"&&n.return()}),i.add(t.schedule(function(){n=r[ai](),i.add(t.schedule(function(){if(!e.closed){var s,o;try{var a=n.next();s=a.value,o=a.done}catch(c){e.error(c);return}o?e.complete():(e.next(s),this.schedule())}}))})),i})}function Ka(r){return r&&typeof r[wr]=="function"}function Ga(r){return r&&typeof r[ai]=="function"}function Fa(r,t){if(r!=null){if(Ka(r))return Va(r,t);if($s(r))return Ua(r,t);if(js(r))return qi(r,t);if(Ga(r)||typeof r=="string")return Ha(r,t)}throw new TypeError((r!==null&&typeof r||r)+" is not observable")}function Fe(r,t){return t?Fa(r,t):r instanceof Z?r:new Z(Yi(r))}var Sr=function(r){D(t,r);function t(e){var i=r.call(this)||this;return i.parent=e,i}return t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(Q),_r=function(r){D(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(Q);function Ar(r,t){if(!t.closed){if(r instanceof Z)return r.subscribe(t);var e;try{e=Yi(r)(t)}catch(i){t.error(i)}return e}}function ci(r,t,e){return e===void 0&&(e=Number.POSITIVE_INFINITY),typeof t=="function"?function(i){return i.pipe(ci(function(n,s){return Fe(r(n,s)).pipe(Ke(function(o,a){return t(n,o,s,a)}))},e))}:(typeof t=="number"&&(e=t),function(i){return i.lift(new za(r,e))})}var za=function(){function r(t,e){e===void 0&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return r.prototype.call=function(t,e){return e.subscribe(new Wa(t,this.project,this.concurrent))},r}(),Wa=function(r){D(t,r);function t(e,i,n){n===void 0&&(n=Number.POSITIVE_INFINITY);var s=r.call(this,e)||this;return s.project=i,s.concurrent=n,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var i,n=this.index++;try{i=this.project(e,n)}catch(s){this.destination.error(s);return}this.active++,this._innerSub(i)},t.prototype._innerSub=function(e){var i=new Sr(this),n=this.destination;n.add(i);var s=Ar(e,i);s!==i&&n.add(s)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(_r);function qa(r){return r===void 0&&(r=Number.POSITIVE_INFINITY),ci(zi,r)}function Ja(){return qa(1)}function Hr(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return Ja()(ar.apply(void 0,r))}function Vs(r){return new Z(function(t){var e;try{e=r()}catch(n){t.error(n);return}var i=e?Fe(e):Wi();return i.subscribe(t)})}function Vn(r){return!Fi(r)&&r-parseFloat(r)+1>=0}var Ya=new Z(te);function Kr(r,t){return function(i){return i.lift(new Za(r,t))}}var Za=function(){function r(t,e){this.predicate=t,this.thisArg=e}return r.prototype.call=function(t,e){return e.subscribe(new Xa(t,this.predicate,this.thisArg))},r}(),Xa=function(r){D(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.predicate=i,s.thisArg=n,s.count=0,s}return t.prototype._next=function(e){var i;try{i=this.predicate.call(this.thisArg,e,this.count++)}catch(n){this.destination.error(n);return}i&&this.destination.next(e)},t}(Q);function Zi(r,t,e){return r===void 0&&(r=0),new Z(function(i){t===void 0&&(t=r,r=0);var n=0,s=r;if(e)return e.schedule(Qa,0,{index:n,count:t,start:r,subscriber:i});do{if(n++>=t){i.complete();break}if(i.next(s++),i.closed)break}while(!0)})}function Qa(r){var t=r.start,e=r.index,i=r.count,n=r.subscriber;if(e>=i){n.complete();return}n.next(t),!n.closed&&(r.index=e+1,r.start=t+1,this.schedule(r))}function Un(r,t,e){r===void 0&&(r=0);var i=-1;return Vn(t)?i=Number(t)<1&&1||Number(t):mr(t)&&(e=t),mr(e)||(e=ks),new Z(function(n){var s=Vn(r)?r:+r-e.now();return e.schedule(tc,s,{index:0,period:i,subscriber:n})})}function tc(r){var t=r.index,e=r.period,i=r.subscriber;if(i.next(t),!i.closed){if(e===-1)return i.complete();r.index=t+1,this.schedule(r,e)}}function Xi(r){return function(e){var i=new ec(r),n=e.lift(i);return i.caught=n}}var ec=function(){function r(t){this.selector=t}return r.prototype.call=function(t,e){return e.subscribe(new rc(t,this.selector,this.caught))},r}(),rc=function(r){D(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.selector=i,s.caught=n,s}return t.prototype.error=function(e){if(!this.isStopped){var i=void 0;try{i=this.selector(e,this.caught)}catch(o){r.prototype.error.call(this,o);return}this._unsubscribeAndRecycle();var n=new Sr(this);this.add(n);var s=Ar(i,n);s!==n&&this.add(s)}},t}(_r);function Or(r,t){return ci(r,t,1)}function ic(r){return r===void 0&&(r=null),function(t){return t.lift(new nc(r))}}var nc=function(){function r(t){this.defaultValue=t}return r.prototype.call=function(t,e){return e.subscribe(new sc(t,this.defaultValue))},r}(),sc=function(r){D(t,r);function t(e,i){var n=r.call(this,e)||this;return n.defaultValue=i,n.isEmpty=!0,n}return t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(Q);function oc(r){return r instanceof Date&&!isNaN(+r)}function Us(r,t){return function(e){return e.lift(new ac(r,t))}}var ac=function(){function r(t,e){this.compare=t,this.keySelector=e}return r.prototype.call=function(t,e){return e.subscribe(new cc(t,this.compare,this.keySelector))},r}(),cc=function(r){D(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.keySelector=n,s.hasKey=!1,typeof i=="function"&&(s.compare=i),s}return t.prototype.compare=function(e,i){return e===i},t.prototype._next=function(e){var i;try{var n=this.keySelector;i=n?n(e):e}catch(a){return this.destination.error(a)}var s=!1;if(this.hasKey)try{var o=this.compare;s=o(this.key,i)}catch(a){return this.destination.error(a)}else this.hasKey=!0;s||(this.key=i,this.destination.next(e))},t}(Q);function uc(r,t){return Us(function(e,i){return t?t(e[r],i[r]):e[r]===i[r]})}function hc(r){return r===void 0&&(r=dc),function(t){return t.lift(new lc(r))}}var lc=function(){function r(t){this.errorFactory=t}return r.prototype.call=function(t,e){return e.subscribe(new pc(t,this.errorFactory))},r}(),pc=function(r){D(t,r);function t(e,i){var n=r.call(this,e)||this;return n.errorFactory=i,n.hasValue=!1,n}return t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(i){e=i}this.destination.error(e)},t}(Q);function dc(){return new Bs}function fc(r){return function(t){return r===0?Wi():t.lift(new gc(r))}}var gc=function(){function r(t){if(this.total=t,this.total<0)throw new Ta}return r.prototype.call=function(t,e){return e.subscribe(new mc(t,this.total))},r}(),mc=function(r){D(t,r);function t(e,i){var n=r.call(this,e)||this;return n.total=i,n.count=0,n}return t.prototype._next=function(e){var i=this.total,n=++this.count;n<=i&&(this.destination.next(e),n===i&&(this.destination.complete(),this.unsubscribe()))},t}(Q);function Hs(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(e){return Hr(e,ar.apply(void 0,r))}}function le(r,t){var e=arguments.length>=2;return function(i){return i.pipe(r?Kr(function(n,s){return r(n,s,i)}):zi,fc(1),e?ic(t):hc(function(){return new Bs}))}}function Ti(r,t){return function(i){var n;if(typeof r=="function"?n=r:n=function(){return r},typeof t=="function")return i.lift(new yc(n,t));var s=Object.create(i,da);return s.source=i,s.subjectFactory=n,s}}var yc=function(){function r(t,e){this.subjectFactory=t,this.selector=e}return r.prototype.call=function(t,e){var i=this.selector,n=this.subjectFactory(),s=i(n).subscribe(t);return s.add(e.subscribe(n)),s},r}();function Hn(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r.length;if(e===0)throw new Error("list of properties cannot be empty.");return function(i){return Ke(bc(r,e))(i)}}function bc(r,t){var e=function(i){for(var n=i,s=0;s<t;s++){var o=n!=null?n[r[s]]:void 0;if(o!==void 0)n=o;else return}return n};return e}function Ec(r){return r?Ti(function(){return new tr},r):Ti(new tr)}function Ri(r,t,e,i){e&&typeof e!="function"&&(i=e);var n=typeof e=="function"?e:void 0,s=new yr(r,t,i);return function(o){return Ti(function(){return s},n)(o)}}function Ks(r){return r===void 0&&(r=-1),function(t){return t.lift(new vc(r,t))}}var vc=function(){function r(t,e){this.count=t,this.source=e}return r.prototype.call=function(t,e){return e.subscribe(new wc(t,this.count,this.source))},r}(),wc=function(r){D(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.count=i,s.source=n,s}return t.prototype.error=function(e){if(!this.isStopped){var i=this,n=i.source,s=i.count;if(s===0)return r.prototype.error.call(this,e);s>-1&&(this.count=s-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(Q);function Kn(r,t,e){var i;return r&&typeof r=="object"?i=r:i={bufferSize:r,windowTime:t,refCount:!1,scheduler:e},function(n){return n.lift(Sc(i))}}function Sc(r){var t=r.bufferSize,e=t===void 0?Number.POSITIVE_INFINITY:t,i=r.windowTime,n=i===void 0?Number.POSITIVE_INFINITY:i,s=r.refCount,o=r.scheduler,a,c=0,h,p=!1,m=!1;return function(S){c++;var M;!a||p?(p=!1,a=new yr(e,n,o),M=a.subscribe(this),h=S.subscribe({next:function(W){a.next(W)},error:function(W){p=!0,a.error(W)},complete:function(){m=!0,h=void 0,a.complete()}}),m&&(h=void 0)):M=a.subscribe(this),this.add(function(){c--,M.unsubscribe(),M=void 0,h&&!m&&s&&c===0&&(h.unsubscribe(),h=void 0,a=void 0)})}}function _c(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r[r.length-1];return mr(e)?(r.pop(),function(i){return Hr(r,i,e)}):function(i){return Hr(r,i)}}function Yt(r,t){return typeof t=="function"?function(e){return e.pipe(Yt(function(i,n){return Fe(r(i,n)).pipe(Ke(function(s,o){return t(i,s,n,o)}))}))}:function(e){return e.lift(new Ac(r))}}var Ac=function(){function r(t){this.project=t}return r.prototype.call=function(t,e){return e.subscribe(new Oc(t,this.project))},r}(),Oc=function(r){D(t,r);function t(e,i){var n=r.call(this,e)||this;return n.project=i,n.index=0,n}return t.prototype._next=function(e){var i,n=this.index++;try{i=this.project(e,n)}catch(s){this.destination.error(s);return}this._innerSub(i)},t.prototype._innerSub=function(e){var i=this.innerSubscription;i&&i.unsubscribe();var n=new Sr(this),s=this.destination;s.add(n),this.innerSubscription=Ar(e,n),this.innerSubscription!==n&&s.add(this.innerSubscription)},t.prototype._complete=function(){var e=this.innerSubscription;(!e||e.closed)&&r.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&r.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(_r);function Pc(r){return function(t){return t.lift(new Tc(r))}}var Tc=function(){function r(t){this.notifier=t}return r.prototype.call=function(t,e){var i=new Rc(t),n=Ar(this.notifier,new Sr(i));return n&&!i.seenValue?(i.add(n),e.subscribe(i)):i},r}(),Rc=function(r){D(t,r);function t(e){var i=r.call(this,e)||this;return i.seenValue=!1,i}return t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(_r);function Ic(r,t){return t===void 0&&(t=!1),function(e){return e.lift(new xc(r,t))}}var xc=function(){function r(t,e){this.predicate=t,this.inclusive=e}return r.prototype.call=function(t,e){return e.subscribe(new Nc(t,this.predicate,this.inclusive))},r}(),Nc=function(r){D(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.predicate=i,s.inclusive=n,s.index=0,s}return t.prototype._next=function(e){var i=this.destination,n;try{n=this.predicate(e,this.index++)}catch(s){i.error(s);return}this.nextOrComplete(e,n)},t.prototype.nextOrComplete=function(e,i){var n=this.destination;Boolean(i)?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(Q);function Gr(r,t,e){return function(n){return n.lift(new Lc(r,t,e))}}var Lc=function(){function r(t,e,i){this.nextOrObserver=t,this.error=e,this.complete=i}return r.prototype.call=function(t,e){return e.subscribe(new Cc(t,this.nextOrObserver,this.error,this.complete))},r}(),Cc=function(r){D(t,r);function t(e,i,n,s){var o=r.call(this,e)||this;return o._tapNext=te,o._tapError=te,o._tapComplete=te,o._tapError=n||te,o._tapComplete=s||te,$r(i)?(o._context=o,o._tapNext=i):i&&(o._context=i,o._tapNext=i.next||te,o._tapError=i.error||te,o._tapComplete=i.complete||te),o}return t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(i){this.destination.error(i);return}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(i){this.destination.error(i);return}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){this.destination.error(e);return}return this.destination.complete()},t}(Q);function Gs(r,t,e){return e===void 0&&(e=ks),function(i){var n=oc(r),s=n?+r-e.now():Math.abs(r);return i.lift(new Dc(s,n,t,e))}}var Dc=function(){function r(t,e,i,n){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=i,this.scheduler=n}return r.prototype.call=function(t,e){return e.subscribe(new Mc(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},r}(),Mc=function(r){D(t,r);function t(e,i,n,s,o){var a=r.call(this,e)||this;return a.absoluteTimeout=i,a.waitFor=n,a.withObservable=s,a.scheduler=o,a.scheduleTimeout(),a}return t.dispatchTimeout=function(e){var i=e.withObservable;e._unsubscribeAndRecycle(),e.add(Ar(i,new Sr(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),r.prototype._next.call(this,e)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(_r),kc=function(r,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var e=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(s){return function(o){return function(a,c){var h={key:a,value:o[a]},p={key:c,value:o[c]};return s(h,p)}}}(t.cmp),n=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,c;if(Array.isArray(o)){for(c="[",a=0;a<o.length;a++)a&&(c+=","),c+=s(o[a])||"null";return c+"]"}if(o===null)return"null";if(n.indexOf(o)!==-1){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var h=n.push(o)-1,p=Object.keys(o).sort(i&&i(o));for(c="",a=0;a<p.length;a++){var m=p[a],E=s(o[m]);!E||(c&&(c+=","),c+=JSON.stringify(m)+":"+E)}return n.splice(h,1),"{"+c+"}"}}(r)},Fs;class Bc extends Error{constructor(t){super(`The map type '${t}' is invalid`),this.mapType=t,this.name="InvalidMapTypeError"}}const zs=Symbol.for("taquito-michelson-map-type-symbol"),jc=r=>"args"in r&&Array.isArray(r.args)&&r.args.length===2;class Gn extends Error{constructor(t,e,i){super(`${i} not compliant with underlying michelson type`),this.value=t,this.type=e,this.name="MapTypecheckError"}}class bt{constructor(t){this.valueMap=new Map,this.keyMap=new Map,this[Fs]=!0,t&&this.setType(t)}static isMichelsonMap(t){return t&&t[zs]===!0}setType(t){if(!jc(t))throw new Bc(t.toString());this.keySchema=new Et(t.args[0]),this.valueSchema=new Et(t.args[1])}removeType(){this.keySchema=void 0,this.valueSchema=void 0}static fromLiteral(t,e){const i=new bt(e);return Object.keys(t).forEach(n=>{i.set(n,t[n])}),i}typecheckKey(t){return this.keySchema?this.keySchema.Typecheck(t):!0}typecheckValue(t){return this.valueSchema?this.valueSchema.Typecheck(t):!0}assertTypecheckValue(t){if(!this.typecheckValue(t))throw new Gn(t,this.valueSchema,"value")}assertTypecheckKey(t){if(!this.typecheckKey(t))throw new Gn(t,this.keySchema,"key")}serializeDeterministically(t){return kc(t)}*keys(){for(const[t]of this.entries())yield t}*values(){for(const[,t]of this.entries())yield t}*entries(){for(const t of this.valueMap.keys())yield[this.keyMap.get(t),this.valueMap.get(t)]}get(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.valueMap.get(e)}set(t,e){this.assertTypecheckKey(t),this.assertTypecheckValue(e);const i=this.serializeDeterministically(t);this.keyMap.set(i,t),this.valueMap.set(i,e)}delete(t){this.assertTypecheckKey(t),this.keyMap.delete(this.serializeDeterministically(t)),this.valueMap.delete(this.serializeDeterministically(t))}has(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.keyMap.has(e)&&this.valueMap.has(e)}clear(){this.keyMap.clear(),this.valueMap.clear()}get size(){return this.keyMap.size}forEach(t){for(const[e,i]of this.entries())t(i,e,this)}}Fs=zs;class G extends Error{constructor(t,e,i){super(),this.value=t,this.token=e,this.name="ValidationError";const n=this.token.annot(),s=n?`[${n}] `:"";this.message=`${s}${i}`}}class st{constructor(t,e,i){this.val=t,this.idx=e,this.fac=i,this.createToken=this.fac}typeWithoutAnnotations(){const t=i=>{if(typeof i=="object"){if(Array.isArray(i))return i.map(o=>t(o));const n=i;return n.args?{prim:n.prim,args:n.args.map(s=>t(s))}:{prim:n.prim}}return i};return(i=>i.args?{prim:i.prim,args:i.args.map(n=>t(n))}:{prim:i.prim})(this.val)}annot(){return(Array.isArray(this.val.annots)&&this.val.annots.length>0?this.val.annots[0]:String(this.idx)).replace(/(%|:)(_Liq_entry_)?/,"")}hasAnnotations(){return Array.isArray(this.val.annots)&&this.val.annots.length}get tokenVal(){return this.val}ExtractSignature(){return[[this.ExtractSchema()]]}}class X extends st{compare(t,e){return t===e?0:t<e?-1:1}}class Fn extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="BigMapValidationError"}}class Pt extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}ExtractSchema(){return{big_map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:Pt.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}isValid(t){return bt.isMichelsonMap(t)?null:new Fn(t,this,"Value must be a MichelsonMap")}objLitToMichelsonMap(t){return t instanceof bt?t:typeof t=="object"?Object.keys(t).length===0?new bt:bt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop()),i=this.isValid(e);if(i)throw i;return Array.from(e.keys()).sort((n,s)=>this.KeySchema.compare(n,s)).map(n=>({prim:"Elt",args:[this.KeySchema.EncodeObject(n),this.ValueSchema.EncodeObject(e.get(n))]}))}EncodeObject(t,e){const i=this.objLitToMichelsonMap(t),n=this.isValid(i);if(n)throw n;return e&&e[Pt.prim]?e[Pt.prim](i,this.val):Array.from(i.keys()).sort((s,o)=>this.KeySchema.compare(s,o)).map(s=>({prim:"Elt",args:[this.KeySchema.EncodeObject(s),this.ValueSchema.EncodeObject(i.get(s))]}))}Execute(t,e){if(e&&e[Pt.prim])return e[Pt.prim](t,this.val);if(Array.isArray(t)){const i=new bt(this.val);return t.forEach(n=>{i.set(this.KeySchema.ToKey(n.args[0]),this.ValueSchema.Execute(n.args[1]))}),i}else{if("int"in t)return t.int;throw new Fn(t,this,`Big map is expecting either an array (Athens) or an object with an int property (Babylon). Got ${JSON.stringify(t)}`)}}findAndReturnTokens(t,e){return Pt.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}Pt.prim="big_map";class $c extends Error{constructor(t){super(t),this.message=t,this.name="OrTokenDecodingError"}}class k extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Encode(t){const e=t[t.length-1],i=this.createToken(this.val.args[0],this.idx);let n=1;i instanceof k&&(n=Object.keys(i.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+n);if(String(i.annot())===String(e)&&!(i instanceof k))return t.pop(),{prim:"Left",args:[i.Encode(t)]};if(String(s.annot())===String(e)&&!(s instanceof k))return t.pop(),{prim:"Right",args:[s.Encode(t)]};if(i instanceof k){const o=i.Encode(t);if(o)return{prim:"Left",args:[o]}}if(s instanceof k){const o=s.Encode(t);if(o)return{prim:"Right",args:[o]}}return null}ExtractSignature(){const t=this.createToken(this.val.args[0],this.idx);let e=1;t instanceof k&&(e=Object.keys(t.ExtractSchema()).length);const i=this.createToken(this.val.args[1],this.idx+e),n=[];if(t instanceof k)n.push(...t.ExtractSignature());else for(const s of t.ExtractSignature())n.push([t.annot(),...s]);if(i instanceof k)n.push(...i.ExtractSignature());else for(const s of i.ExtractSignature())n.push([i.annot(),...s]);return n}EncodeObject(t,e){const i=Object.keys(t)[0],n=this.createToken(this.val.args[0],this.idx);let s=1;n instanceof k&&(s=Object.keys(n.ExtractSchema()).length);const o=this.createToken(this.val.args[1],this.idx+s);if(String(n.annot())===String(i)&&!(n instanceof k))return{prim:"Left",args:[n.EncodeObject(t[i],e)]};if(String(o.annot())===String(i)&&!(o instanceof k))return{prim:"Right",args:[o.EncodeObject(t[i],e)]};if(n instanceof k){const a=n.EncodeObject(t,e);if(a)return{prim:"Left",args:[a]}}if(o instanceof k){const a=o.EncodeObject(t,e);if(a)return{prim:"Right",args:[a]}}return null}Execute(t,e){const i=this.createToken(this.val.args[0],this.idx);let n=1;i instanceof k&&(n=Object.keys(i.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+n);if(t.prim==="Right")return s instanceof k?s.Execute(t.args[0],e):{[s.annot()]:s.Execute(t.args[0],e)};if(t.prim==="Left")return i instanceof k?i.Execute(t.args[0],e):{[i.annot()]:i.Execute(t.args[0],e)};throw new $c(`Was expecting Left or Right prim but got: ${t.prim}`)}traversal(t,e,i){const n=this.createToken(this.val.args[0],this.idx);let s=1,o;n instanceof k&&!n.hasAnnotations()?(o=t(n),s=Object.keys(n.ExtractSchema()).length):o={[n.annot()]:t(n)};const a=this.createToken(this.val.args[1],this.idx+s);let c;return a instanceof k&&!a.hasAnnotations()?c=e(a):c={[a.annot()]:e(a)},i(o,c)}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}generateSchema(){return{__michelsonType:k.prim,schema:this.traversal(t=>t instanceof k&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof k&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}}findToken(t){const e=this.createToken(this.val.args[0],this.idx);let i=1;e instanceof k&&(i=Object.keys(e.ExtractSchema()).length);const n=this.createToken(this.val.args[1],this.idx+i);if(String(e.annot())===String(t)&&!(e instanceof k)&&e instanceof X)return e;if(String(n.annot())===String(t)&&!(n instanceof k)&&n instanceof X)return n;if(e instanceof k){const s=e.findToken(t);if(s)return s}if(n instanceof k){const s=n.findToken(t);if(s)return s}return null}compare(t,e){const i=Object.keys(t)[0],n=Object.keys(e)[0];if(i===n){const s=this.findToken(i);if(s instanceof X)return s.compare(t[i],e[i])}else{const s=JSON.stringify(this.EncodeObject(t)),o=JSON.stringify(this.EncodeObject(e));return s<o?-1:1}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return k.prim===t&&e.push(this),this.traversal(i=>i.findAndReturnTokens(t,e),i=>i.findAndReturnTokens(t,e),(i,n)=>Object.assign(Object.assign({},i),n)),e}}k.prim="or";class Vc extends Error{constructor(t){super(t),this.message=t,this.name="TokenArgumentValidationError"}}class Uc extends Error{constructor(t,e){super(`Tokens ${t} and ${e} are not comparable`),this.val1=t,this.val2=e,this.name="TokenComparisonError"}}function Ii(r,t=tt.prim){if(Array.isArray(r))return Ii({prim:t,args:r},t);if(r.args===void 0)throw new Vc("Encountered an invalid PairToken with no arguments, a pair must have two or more arguments");return r.args.length>2?[r.args[0],{prim:t,args:r.args.slice(1)}]:[r.args[0],r.args[1]]}class tt extends X{constructor(t,e,i){super(Array.isArray(t)?{prim:tt.prim,args:t}:t.prim?t:{prim:tt.prim,args:t},e,i)}args(){return Ii(this.val)}tokens(){let t=0;return this.args().map(e=>{const i=this.createToken(e,this.idx+t);return i instanceof tt?t+=Object.keys(i.ExtractSchema()).length:t++,i})}Encode(t){return{prim:"Pair",args:this.tokens().map(e=>e.Encode(t))}}ExtractSignature(){const t=this.args(),e=this.createToken(t[0],this.idx);let i=1;e instanceof k&&(i=Object.keys(e.ExtractSchema()).length);const n=this.createToken(t[1],this.idx+i),s=[];for(const o of e.ExtractSignature())for(const a of n.ExtractSignature())s.push([...o,...a]);return s}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}ToKey(t){return this.Execute(t)}EncodeObject(t,e){const[i,n]=this.tokens();let s;i instanceof tt&&!i.hasAnnotations()?s=t:s=t[i.annot()];let o;return n instanceof tt&&!n.hasAnnotations()?o=t:o=t[n.annot()],{prim:"Pair",args:[i.EncodeObject(s,e),n.EncodeObject(o,e)]}}traversal(t,e){const i=this.args(),n=this.createToken(i[0],this.idx);let s=1,o;n instanceof tt&&(s=Object.keys(n.ExtractSchema()).length),n instanceof tt&&!n.hasAnnotations()?o=t(n):o={[n.annot()]:t(n)};const a=this.createToken(i[1],this.idx+s);let c;return a instanceof tt&&!a.hasAnnotations()?c=e(a):c={[a.annot()]:e(a)},Object.assign(Object.assign({},o),c)}Execute(t,e){const i=Ii(t,"Pair");return this.traversal(n=>n.Execute(i[0],e),n=>n.Execute(i[1],e))}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema())}generateSchema(){return{__michelsonType:tt.prim,schema:this.traversal(t=>t instanceof tt&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof tt&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema())}}compare(t,e){const[i,n]=this.tokens(),s=(o,a)=>o instanceof tt&&!o.hasAnnotations()?a:a[o.annot()];if(i instanceof X&&n instanceof X){const o=i.compare(s(i,t),s(i,e));return o===0?n.compare(s(n,t),s(n,e)):o}throw new Uc(t,e)}findAndReturnTokens(t,e){return tt.prim===t&&e.push(this),this.tokens().map(i=>i.findAndReturnTokens(t,e)),e}}tt.prim="pair";class zn extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="NatValidationError"}}class kt extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return new w(t[Object.keys(t)[0]])}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{int:new w(e).toFixed()}}isValid(t){const e=new w(t);return e.isNaN()?new zn(t,this,`Value is not a number: ${t}`):e.isNegative()?new zn(t,this,`Value cannot be negative: ${t}`):null}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[kt.prim]?e[kt.prim](t):{int:new w(t).toFixed()}}ExtractSchema(){return kt.prim}generateSchema(){return{__michelsonType:kt.prim,schema:kt.prim}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:kt.prim}}}ToKey({int:t}){return new w(t)}compare(t,e){const i=Number(t),n=Number(e);return i===n?0:i<n?-1:1}findAndReturnTokens(t,e){return kt.prim===t&&e.push(this),e}}kt.prim="nat";class Bt extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return Bt.prim}generateSchema(){return{__michelsonType:Bt.prim,schema:Bt.prim}}Encode(t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[Bt.prim]?e[Bt.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Bt.prim}}}findAndReturnTokens(t,e){return Bt.prim===t&&e.push(this),e}}Bt.prim="string";class gi extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="AddressValidationError"}}class re extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}ToBigMapKey(t){return{key:{bytes:Wo(t)},type:{prim:"bytes"}}}isValid(t){return z(t)!==I.VALID?new gi(t,this,`Address is not valid: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[re.prim]?e[re.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new gi(t,this,`cannot be missing both string and bytes: ${t}`);return Oi(t.bytes)}ExtractSchema(){return re.prim}generateSchema(){return{__michelsonType:re.prim,schema:re.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new gi({bytes:t,string:e},this,`cannot be missing both string and bytes ${{string:e,bytes:t}}`);return Oi(t)}compare(t,e){const i=o=>o.startsWith("tz"),n=i(t),s=i(e);return n&&!s?-1:s&&!n?1:super.compare(t,e)}findAndReturnTokens(t,e){return re.prim===t&&e.push(this),e}}re.prim="address";class Hc extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="MapValidationError"}}class Ue extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}isValid(t){return bt.isMichelsonMap(t)?null:new Hc(t,this,"Value must be a MichelsonMap")}Execute(t,e){const i=new bt(this.val);return t.forEach(n=>{i.set(this.KeySchema.ToKey(n.args[0]),this.ValueSchema.Execute(n.args[1],e))}),i}objLitToMichelsonMap(t){return t instanceof bt?t:typeof t=="object"?Object.keys(t).length===0?new bt:bt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop()),i=this.isValid(e);if(i)throw i;return Array.from(e.keys()).sort((n,s)=>this.KeySchema.compare(n,s)).map(n=>({prim:"Elt",args:[this.KeySchema.EncodeObject(n),this.ValueSchema.EncodeObject(e.get(n))]}))}EncodeObject(t,e){const i=this.objLitToMichelsonMap(t),n=this.isValid(i);if(n)throw n;return e&&e[Ue.prim]?e[Ue.prim](i):Array.from(i.keys()).sort((s,o)=>this.KeySchema.compare(s,o)).map(s=>({prim:"Elt",args:[this.KeySchema.EncodeObject(s),this.ValueSchema.EncodeObject(i.get(s))]}))}ExtractSchema(){return{map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:Ue.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}findAndReturnTokens(t,e){return Ue.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}Ue.prim="map";class jt extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return String(t.prim).toLowerCase()==="true"}Encode(t){return{prim:t.pop()?"True":"False"}}EncodeObject(t,e){return e&&e[jt.prim]?e[jt.prim](t):{prim:t?"True":"False"}}ExtractSchema(){return jt.prim}generateSchema(){return{__michelsonType:jt.prim,schema:jt.prim}}ToBigMapKey(t){return{key:this.EncodeObject(t),type:{prim:jt.prim}}}ToKey(t){return this.EncodeObject(t)}compare(t,e){return t&&e||!t&&!e?0:t?1:-1}findAndReturnTokens(t,e){return jt.prim===t&&e.push(this),e}}jt.prim="bool";class Ir extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="TxRollupL2AddressValidationError"}}class ie extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}ToBigMapKey(t){return{key:{bytes:qo(t)},type:{prim:"bytes"}}}isValid(t){if(z(t)!==I.VALID)throw new Ir(t,this,`tx_rollup_l2_address is not valid: ${t}`);return null}Encode(t){const e=t.pop();if(!e)throw new Ir(e,this,`arg missing to encode: this -> "${e}"`);return this.isValid(e),{string:e}}EncodeObject(t,e){return this.isValid(t),e&&e[ie.prim]?e[ie.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Ir(t,this,`value cannot be missing string and byte value. must have one ${JSON.stringify(t)}`);return Pn(t.bytes)}ExtractSchema(){return ie.prim}generateSchema(){return{__michelsonType:ie.prim,schema:ie.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new Ir(t,this,`value cannot be missing string and byte value. must have one: bytes = ${t}`);return Pn(t)}findAndReturnTokens(t,e){return ie.prim===t&&e.push(this),e}}ie.prim="tx_rollup_l2_address";class Wn extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ContractValidationError"}}class Nt extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return z(t)!==I.VALID?new Wn(t,this,"Contract address is not valid"):null}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Wn(t,this,"must contain bytes or string");return Oi(t.bytes)}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Nt.prim]?e[Nt.prim](t):{string:t}}ExtractSchema(){return Nt.prim}generateSchema(){const t=this.createToken(this.val.args[0],0);return{__michelsonType:Nt.prim,schema:{parameter:this.val.args[0]?t.generateSchema():{}}}}findAndReturnTokens(t,e){return Nt.prim===t&&e.push(this),e}}Nt.prim="contract";class Kc extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ListValidationError"}}class Se extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get valueSchema(){return this.createToken(this.val.args[0],this.idx)}isValid(t){return Array.isArray(t)?null:new Kc(t,this,"Value must be an array")}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;const n=this.createToken(this.val.args[0],0);return e.reduce((s,o)=>[...s,n.EncodeObject(o)],[])}Execute(t,e){const i=this.createToken(this.val.args[0],0),n=this.isValid(t);if(n)throw n;return t.reduce((s,o)=>[...s,i.Execute(o,e)],[])}EncodeObject(t,e){const i=this.createToken(this.val.args[0],0),n=this.isValid(t);if(n)throw n;return e&&e[Se.prim]?e[Se.prim](t):t.reduce((s,o)=>[...s,i.EncodeObject(o)],[])}ExtractSchema(){return{[Se.prim]:this.valueSchema.ExtractSchema()}}generateSchema(){return{__michelsonType:Se.prim,schema:this.valueSchema.generateSchema()}}findAndReturnTokens(t,e){return Se.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),e}}Se.prim="list";class Gc extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="MutezValidationError"}}class $t extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return new w(t[Object.keys(t)[0]])}ExtractSchema(){return $t.prim}generateSchema(){return{__michelsonType:$t.prim,schema:$t.prim}}isValid(t){return new w(t).isNaN()?new Gc(t,this,`Value is not a number: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{int:String(e).toString()}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[$t.prim]?e[$t.prim](t):{int:String(t).toString()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:$t.prim}}}ToKey({int:t}){return t}compare(t,e){const i=Number(t),n=Number(e);return i===n?0:i<n?-1:1}findAndReturnTokens(t,e){return $t.prim===t&&e.push(this),e}}$t.prim="mutez";class Fc extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="BytesValidationError"}}class Vt extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}ToBigMapKey(t){return{key:{bytes:t},type:{prim:Vt.prim}}}isValid(t){return typeof t=="string"&&/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Fc(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=Tn(this.convertUint8ArrayToHexString(e));const i=this.isValid(e);if(i)throw i;return{bytes:String(e).toString()}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t),typeof t=="string"&&(t=Tn(t));const i=this.isValid(t);if(i)throw i;return e&&e[Vt.prim]?e[Vt.prim](t):{bytes:String(t).toString()}}Execute(t){return t.bytes}ExtractSchema(){return Vt.prim}generateSchema(){return{__michelsonType:Vt.prim,schema:Vt.prim}}ToKey({bytes:t,string:e}){return e||t}findAndReturnTokens(t,e){return Vt.prim===t&&e.push(this),e}}Vt.prim="bytes";class er extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}subToken(){return this.createToken(this.val.args[0],this.idx)}schema(){return this.createToken(this.val.args[0],0)}annot(){return Array.isArray(this.val.annots)?super.annot():this.createToken(this.val.args[0],this.idx).annot()}Encode(t){const e=t;return e==null?{prim:"None"}:Array.isArray(e)&&(e[e.length-1]===void 0||e[e.length-1]===null)?(e.pop(),{prim:"None"}):{prim:"Some",args:[this.schema().Encode(t)]}}EncodeObject(t,e){const i=t;return i==null?{prim:"None"}:{prim:"Some",args:[this.schema().EncodeObject(i,e)]}}Execute(t,e){return t.prim==="None"?null:this.schema().Execute(t.args[0],e)}ExtractSchema(){return this.schema().ExtractSchema()}generateSchema(){return{__michelsonType:er.prim,schema:this.schema().generateSchema()}}ExtractSignature(){return[...this.schema().ExtractSignature(),[]]}get KeySchema(){return this.schema()}compare(t,e){if(t){if(!e)return 1}else return-1;return this.KeySchema.compare(t,e)}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return er.prim===t&&e.push(this),this.subToken().findAndReturnTokens(t,e),e}}er.prim="option";class Ut extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){if(t.string&&/^\d+$/.test(t.string))return new Date(Number(t.string)*1e3).toISOString();if(t.string)return new Date(t.string).toISOString();if(t.int)return new Date(Number(t.int)*1e3).toISOString()}Encode(t){const e=t.pop();return typeof e=="number"?{int:String(e)}:{string:e}}EncodeObject(t,e){return e&&e[Ut.prim]?e[Ut.prim](t):typeof t=="number"?{int:String(t)}:{string:t}}ExtractSchema(){return Ut.prim}generateSchema(){return{__michelsonType:Ut.prim,schema:Ut.prim}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Ut.prim}}}findAndReturnTokens(t,e){return Ut.prim===t&&e.push(this),e}}Ut.prim="timestamp";class zc extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="IntValidationError"}}class mt extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return new w(t[Object.keys(t)[0]])}ExtractSchema(){return mt.prim}generateSchema(){return{__michelsonType:mt.prim,schema:mt.prim}}isValid(t){return new w(t).isNaN()?new zc(t,this,`Value is not a number: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{int:new w(e).toFixed()}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[mt.prim]?e[mt.prim](t):{int:new w(t).toFixed()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:mt.prim}}}ToKey({int:t}){return t}compare(t,e){const i=Number(t),n=Number(e);return i===n?0:i<n?-1:1}findAndReturnTokens(t,e){return mt.prim===t&&e.push(this),e}}mt.prim="int";class Ht extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Encode(t){return t.pop(),{prim:"Unit"}}EncodeObject(t,e){return e&&e[Ht.prim]?e[Ht.prim](t):{prim:"Unit"}}Execute(t){return ts}ExtractSchema(){return Ht.prim}generateSchema(){return{__michelsonType:Ht.prim,schema:Ht.prim}}compare(t,e){return 0}ToKey(t){return ts}ToBigMapKey(t){return{key:{prim:"Unit"},type:{prim:Ht.prim}}}findAndReturnTokens(t,e){return Ht.prim===t&&e.push(this),e}}Ht.prim="unit";const Wc=4;class qc extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="KeyValidationError"}}class Kt extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string?t.string:Jo(t.bytes)}isValid(t){return Yo(t)!==I.VALID?new qc(t,this,"Key is not valid"):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Kt.prim]?e[Kt.prim](t):{string:t}}ExtractSchema(){return Kt.prim}generateSchema(){return{__michelsonType:Kt.prim,schema:Kt.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:Kt.prim}}}compare(t,e){const i=this.getPrefix(t),n=this.getPrefix(e);if(i===T.EDPK&&n!==T.EDPK)return-1;if(i===T.SPPK&&n!==T.SPPK)return n===T.EDPK?1:-1;if(i===T.P2PK){if(n!==T.P2PK)return 1;const s=this.getP256PublicKeyComparableBytes(t),o=this.getP256PublicKeyComparableBytes(e);return Buffer.compare(s,o)}return super.compare(t,e)}getPrefix(t){return t.substring(0,Wc)}getP256PublicKeyComparableBytes(t){return Ss(t,Ui[T.P2PK]).slice(1)}findAndReturnTokens(t,e){return Kt.prim===t&&e.push(this),e}}Kt.prim="key";class Jc extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="KeyHashValidationError"}}class Gt extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string?t.string:Rn(t.bytes)}isValid(t){return Hi(t)!==I.VALID?new Jc(t,this,`KeyHash is not valid: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Gt.prim]?e[Gt.prim](t):{string:t}}ExtractSchema(){return Gt.prim}generateSchema(){return{__michelsonType:Gt.prim,schema:Gt.prim}}ToKey({string:t,bytes:e}){return t||Rn(e)}ToBigMapKey(t){return{key:{string:t},type:{prim:Gt.prim}}}findAndReturnTokens(t,e){return Gt.prim===t&&e.push(this),e}}Gt.prim="key_hash";class Yc extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SignatureValidationError"}}class Ft extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string?t.string:t.bytes}isValid(t){return Zo(t)!==I.VALID?new Yc(t,this,"Signature is not valid"):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Ft.prim]?e[Ft.prim](t):{string:t}}ExtractSchema(){return Ft.prim}generateSchema(){return{__michelsonType:Ft.prim,schema:Ft.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:Ft.prim}}}findAndReturnTokens(t,e){return Ft.prim===t&&e.push(this),e}}Ft.prim="signature";class _e extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get paramSchema(){return this.createToken(this.val.args[0],this.idx)}get returnSchema(){return this.createToken(this.val.args[1],this.idx+1)}Execute(t){return t.string?t.string:t}Encode(t){return t.pop()}EncodeObject(t,e){return e&&e[_e.prim]?e[_e.prim](t):t}ExtractSchema(){return{[_e.prim]:{parameters:this.paramSchema.ExtractSchema(),returns:this.returnSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:_e.prim,schema:{parameters:this.paramSchema.generateSchema(),returns:this.returnSchema.generateSchema()}}}findAndReturnTokens(t,e){return _e.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),this.createToken(this.val.args[1],this.idx).findAndReturnTokens(t,e),e}}_e.prim="lambda";class ne extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string}Encode(...t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[ne.prim]?e[ne.prim](t):{string:t}}ExtractSchema(){return ne.prim}generateSchema(){return{__michelsonType:ne.prim,schema:ne.prim}}findAndReturnTokens(t,e){return ne.prim===t&&e.push(this),e}}ne.prim="operation";class Zc extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SetValidationError"}}class Ae extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get KeySchema(){return this.createToken(this.val.args[0],0)}isValid(t){return Array.isArray(t)?null:new Zc(t,this,"Value must be an array")}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return e.sort((n,s)=>this.KeySchema.compare(n,s)).reduce((n,s)=>[...n,this.KeySchema.EncodeObject(s)],[])}Execute(t,e){return t.reduce((i,n)=>[...i,this.KeySchema.Execute(n,e)],[])}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Ae.prim]?e[Ae.prim](t):t.sort((n,s)=>this.KeySchema.compare(n,s)).reduce((n,s)=>[...n,this.KeySchema.EncodeObject(s)],[])}ExtractSchema(){return Ae.prim}generateSchema(){return{__michelsonType:Ae.prim,schema:this.KeySchema.generateSchema()}}findAndReturnTokens(t,e){return Ae.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),e}}Ae.prim="set";class Xc extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ChainIDValidationError"}}class zt extends X{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return _s(t)!==I.VALID?new Xc(t,this,"ChainID is not valid"):null}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return zt.prim}generateSchema(){return{__michelsonType:zt.prim,schema:zt.prim}}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[zt.prim]?e[zt.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:zt.prim}}}findAndReturnTokens(t,e){return zt.prim===t&&e.push(this),e}}zt.prim="chain_id";class qn extends Error{constructor(){super("Tickets cannot be sent to the blockchain; they are created on-chain"),this.name="TicketEncodeError"}}const Qc={prim:"contract"},tu={prim:"int"};class Jt extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new qn}EncodeObject(t,e){if(e&&e[Jt.prim])return e[Jt.prim](t,this.val);throw new qn}Execute(t,e){if(e&&e[Jt.prim])return e[Jt.prim](t,this.val);const i=this.createToken(Qc,this.idx),n=this.valueToken,s=this.createToken(tu,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:i.Execute(t.args[0],e),value:n.Execute(t.args[1].args[0],e),amount:s.Execute(t.args[1].args[1],e)}:{ticketer:i.Execute(t.args[0],e),value:n.Execute(t.args[1],e),amount:s.Execute(t.args[2],e)}}ExtractSchema(){return{ticketer:Nt.prim,value:this.valueToken.ExtractSchema(),amount:mt.prim}}generateSchema(){return{__michelsonType:Jt.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:Nt.prim,schema:Nt.prim},amount:{__michelsonType:mt.prim,schema:mt.prim}}}}findAndReturnTokens(t,e){return Jt.prim===t&&e.push(this),this.valueToken.findAndReturnTokens(t,e),e}}Jt.prim="ticket";class mi extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="NeverTokenError"}}class se extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Encode(t){const e=t.pop();throw new mi(e,this,"Assigning a value to the type never is forbidden.")}EncodeObject(t,e){if(e&&e[se.prim])return e[se.prim](t);throw new mi(t,this,"Assigning a value to the type never is forbidden.")}Execute(t){throw new mi(t,this,"There is no literal value for the type never.")}ExtractSchema(){return se.prim}generateSchema(){return{__michelsonType:se.prim,schema:se.prim}}findAndReturnTokens(t,e){return se.prim===t&&e.push(this),e}}se.prim="never";class yi extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SaplingStateValidationError"}}class Wt extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return typeof t=="object"&&Object.keys(t).length===0}Execute(t,e){if(e&&e[Wt.prim])return e[Wt.prim](t,this.val);if("int"in t)return t.int;throw new yi(t,this,`Sapling state is expecting an object with an int property. Got ${JSON.stringify(t)}`)}Encode(t){const e=t.pop();if(this.isValid(e))return[];throw new yi(e,this,`Invalid sapling_state. Received: ${e} while expecting: {}`)}EncodeObject(t,e){if(e&&e[Wt.prim])return e[Wt.prim](t);if(this.isValid(t))return[];throw new yi(t,this,`Invalid sapling_state. Received: ${t} while expecting: {}`)}ExtractSchema(){return{[Wt.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:Wt.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return Wt.prim===t&&e.push(this),e}}Wt.prim="sapling_state";class Jn extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SaplingTransactionValidationError"}}class Oe extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){throw new Jn(t,this,"There is no literal value for the sapling_transaction type.")}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new Jn(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[Oe.prim]?e[Oe.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[Oe.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:Oe.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return Oe.prim===t&&e.push(this),e}}Oe.prim="sapling_transaction";class Yn extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SaplingTransactionDeprecatedValidationError"}}class Pe extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){throw new Yn(t,this,"There is no literal value for the sapling_transaction_deprecated type.")}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new Yn(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[Pe.prim]?e[Pe.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[Pe.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:Pe.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return Pe.prim===t&&e.push(this),e}}Pe.prim="sapling_transaction_deprecated";class eu extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="Bls12381frValidationError"}}class oe extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new eu(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();if(typeof e=="number")return{int:e.toString()};{e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}}EncodeObject(t,e){if(e&&e[oe.prim])return e[oe.prim](t);if(typeof t=="number")return{int:t.toString()};{t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return{bytes:t}}}Execute(t){return t.bytes}ExtractSchema(){return oe.prim}generateSchema(){return{__michelsonType:oe.prim,schema:oe.prim}}findAndReturnTokens(t,e){return oe.prim===t&&e.push(this),e}}oe.prim="bls12_381_fr";class ru extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="Bls12381g1ValidationError"}}class ae extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new ru(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[ae.prim]?e[ae.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return ae.prim}generateSchema(){return{__michelsonType:ae.prim,schema:ae.prim}}findAndReturnTokens(t,e){return ae.prim===t&&e.push(this),e}}ae.prim="bls12_381_g1";class iu extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="Bls12381g2ValidationError"}}class ce extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new iu(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[ce.prim]?e[ce.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return ce.prim}generateSchema(){return{__michelsonType:ce.prim,schema:ce.prim}}findAndReturnTokens(t,e){return ce.prim===t&&e.push(this),e}}ce.prim="bls12_381_g2";class nu extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ChestValidationError"}}class ue extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new nu(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[ue.prim]?e[ue.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return ue.prim}generateSchema(){return{__michelsonType:ue.prim,schema:ue.prim}}findAndReturnTokens(t,e){return ue.prim===t&&e.push(this),e}}ue.prim="chest";class su extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ChestKeyValidationError"}}class he extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new su(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[he.prim]?e[he.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return he.prim}generateSchema(){return{__michelsonType:he.prim,schema:he.prim}}findAndReturnTokens(t,e){return he.prim===t&&e.push(this),e}}he.prim="chest_key";class Zn extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="GlobalConstantEncodingError"}}class ou extends G{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="GlobalConstantDecodingError"}}class qt extends st{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t,e){if(e&&e[qt.prim])return e[qt.prim](t,this.val);throw new ou(t,this,`Unable to decode a value represented by a globalThis constants. Please provide an expanded script to the Michelson-Encoder or semantics for the decoding. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}Encode(t){throw new Zn(t,this,`Unable to encode a script containing globalThis constants. Please provide an expanded script to the Michelson-Encoder. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}EncodeObject(t,e){if(e&&e[qt.prim])return e[qt.prim](t);throw new Zn(t,this,`Unable to encode a script containing globalThis constants. Please provide an expanded script to the Michelson-Encoder. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}ExtractSchema(){return qt.prim}generateSchema(){return{__michelsonType:qt.prim,schema:{hash:this.val.args[0].string}}}findAndReturnTokens(t,e){return qt.prim===t&&e.push(this),e}}qt.prim="constant";const au=[tt,kt,Bt,Pt,re,ie,Ue,jt,k,Nt,Se,$t,Vt,er,Ut,mt,Ht,Kt,Gt,Ft,_e,ne,Ae,zt,Jt,se,Wt,Oe,Pe,oe,ae,ce,ue,he,qt];class cu extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="Invalid token error"}}function Ge(r,t){if(Array.isArray(r))return new tt(r,t,Ge);const e=au.find(i=>i.prim===r.prim);if(!e)throw new cu("Malformed data expected a value with a valid prim property",r);return new e(r,t,Ge)}class uu extends Error{constructor(t,e){super(`Unable to encode the parameter of the view: ${t}.`),this.smartContractViewName=t,this.originalError=e,this.name="ViewEncodingError"}}class Xn extends Error{constructor(t){super(t),this.message=t,this.name="InvalidScriptError"}}class Ws extends Error{constructor(t){super("Invalid RPC response passed as argument(s)"),this.script=t,this.name="InvalidRpcResponseError"}}class Qn extends Error{constructor(t,e,i){super(`
      ${t}. Error encountered when trying to encode arguments: 

      [${e}]
    `),this.message=t,this.args=e,this.originalError=i,this.name="ParameterEncodingError"}}class xr extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBigMapSchema"}}class hu extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBigMapDiff"}}class lu extends Error{constructor(t,e){super(`Unable to encode ${t}. ${e}`),this.obj=t,this.details=e,this.name="BigMapEncodingError"}}class pu extends Error{constructor(t,e){super(`Unable to encode ${t}. ${e}`),this.obj=t,this.details=e,this.name="StorageEncodingError"}}class du extends Error{constructor(t){super(t),this.message=t,this.name="MissingArgumentError"}}var qs;const Js=Symbol.for("taquito-schema-type-symbol");function br(r,t=tt.prim){var e,i;if(Array.isArray(r))return br({prim:t,args:r},t);const n=r;return n.prim===t&&n.args&&n.args.length>2?Object.assign(Object.assign({},n),{args:[(e=n.args)===null||e===void 0?void 0:e[0],{prim:t,args:(i=n.args)===null||i===void 0?void 0:i.slice(1)}]}):n}function Ys(r,t){const e=br(r),i=br(t);return e.prim===i.prim&&(e.args===void 0&&i.args===void 0||e.args!==void 0&&i.args!==void 0&&e.args.length===i.args.length&&e.args.every((n,s)=>{var o,a;return Ys(n,(a=(o=i.args)===null||o===void 0?void 0:o[s])!==null&&a!==void 0?a:{})}))&&(e.annots===void 0&&i.annots===void 0||e.annots!==void 0&&i.annots!==void 0&&e.annots.length===i.annots.length&&e.annots.every((n,s)=>{var o;return n===((o=i.annots)===null||o===void 0?void 0:o[s])}))}class Et{constructor(t){if(this.val=t,this[qs]=!0,this.root=Ge(t,0),this.root instanceof Pt)this.bigMap=this.root;else if(this.isExpressionExtended(t)&&t.prim==="pair"){const e=t.args[0];this.isExpressionExtended(e)&&e.prim==="big_map"&&(this.bigMap=new Pt(e,0,Ge))}}static isSchema(t){return t&&t[Js]===!0}static fromRPCResponse(t){const e=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.find(i=>{if(Array.isArray(i))this.fromRPCResponse({script:{code:i,storage:t.script.storage}});else{const n=i;return n.prim?n.prim==="storage":!1}});if(!e||!Array.isArray(e.args))throw new Ws(t.script);return new Et(e.args[0])}isExpressionExtended(t){return"prim"in t&&Array.isArray(t.args)}removeTopLevelAnnotation(t){return(this.root instanceof tt||this.root instanceof k)&&this.root.hasAnnotations()&&typeof t=="object"&&Object.keys(t).length===1?t[Object.keys(t)[0]]:t}Execute(t,e){const i=this.root.Execute(t,e);return this.removeTopLevelAnnotation(i)}Typecheck(t){if(this.root instanceof Pt&&Number.isInteger(Number(t))||this.root instanceof Jt&&t.ticketer&&t.value&&t.amount)return!0;try{return this.root.EncodeObject(t),!0}catch{return!1}}ExecuteOnBigMapDiff(t,e){if(!this.bigMap)throw new xr("Big map schema is undefined");if(!Array.isArray(t))throw new hu("Big map diff must be an array");const i=t.map(({key:n,value:s})=>({args:[n,s]}));return this.bigMap.Execute(i,e)}ExecuteOnBigMapValue(t,e){if(!this.bigMap)throw new xr("No big map schema");return this.bigMap.ValueSchema.Execute(t,e)}EncodeBigMapKey(t){if(!this.bigMap)throw new xr("Big map schema is undefined");try{return this.bigMap.KeySchema.ToBigMapKey(t)}catch(e){throw new lu("big map key",e)}}Encode(t,e){try{return this.root.EncodeObject(t,e)}catch(i){throw i instanceof G?i:new pu("storage object",i)}}ExtractSchema(){return this.removeTopLevelAnnotation(this.root.ExtractSchema())}generateSchema(){return this.removeTopLevelAnnotation(this.root.generateSchema())}ComputeState(t,e){if(!this.bigMap)throw new xr("Big map schema is undefined");const i=t.reduce((n,s)=>Object.assign(Object.assign({},n),this.ExecuteOnBigMapDiff(s.contents[0].metadata.operation_result.big_map_diff)),{});return Object.assign(Object.assign({},this.Execute(e)),{[this.bigMap.annot()]:i})}FindFirstInTopLevelPair(t,e){return this.findValue(this.root.val,t,e)}findValue(t,e,i){if(Ys(i,t))return e;if(Array.isArray(t)||t.prim==="pair"){const n=br(t),s=br(e,"Pair");if(n.args===void 0||s.args===void 0)throw new du("Tokens have no arguments");if(n.args[0])return this.findValue(n.args[0],s.args[0],i)||this.findValue(n.args[1],s.args[1],i)}}findToken(t){const e=[];return this.root.findAndReturnTokens(t,e)}}qs=Js;class Je{constructor(t){this.root=Ge(t,0)}static fromRPCResponse(t){const e=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.find(i=>i.prim==="parameter");if(!e||!Array.isArray(e.args))throw new Ws(t.script);return new Je(e.args[0])}get isMultipleEntryPoint(){return this.root instanceof k||this.root instanceof er&&this.root.subToken()instanceof k}get hasAnnotation(){return this.isMultipleEntryPoint?Object.keys(this.ExtractSchema())[0]!=="0":!0}Execute(t,e){return this.root.Execute(t,e)}Encode(...t){try{return this.root.Encode(t.reverse())}catch(e){throw e instanceof G?e:new Qn("Unable to encode parameter",t.toString(),e)}}EncodeObject(t,e){try{return this.root.EncodeObject(t,e)}catch(i){throw i instanceof G?i:new Qn("Unable to encode parameter object",t,i)}}ExtractSchema(){return this.root.ExtractSchema()}generateSchema(){return this.root.generateSchema()}ExtractSignatures(){return this.root.ExtractSignature()}}class Qi{constructor(t){if(t.length!==4||!("string"in t[0]))throw new Xn(`Invalid on-chain view: ${JSON.stringify(t)}`);this.viewName=t[0].string,this.viewArgsType=t[1],this.viewReturnType=t[2],this.instructions=t[3],this.rootArgsType=Ge(this.viewArgsType,0),this.rootReturnType=Ge(this.viewReturnType,0)}static fromRPCResponse(t){const e=[],i=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.filter(n=>n.prim==="view");return i&&i.forEach(n=>{if(!n.args||n.args.length!==4)throw new Xn(`Invalid on-chain view found in the script: ${JSON.stringify(n)}`);e.push(new Qi(n.args))}),e}encodeViewArgs(t){try{return this.rootArgsType.EncodeObject(t)}catch(e){throw new uu(this.viewName,e)}}decodeViewResult(t,e){return this.rootReturnType.Execute(t,e)}extractArgsSchema(){return this.rootArgsType.ExtractSchema()}extractResultSchema(){return this.rootReturnType.ExtractSchema()}}const ts=Symbol(),ht=Symbol("source_reference");class je extends Error{constructor(t,e,i){super(i),this.src=t,this.idx=e,Object.setPrototypeOf(this,je.prototype)}}var lt;(function(r){r[r.Comment=0]="Comment",r[r.Number=1]="Number",r[r.String=2]="String",r[r.Bytes=3]="Bytes",r[r.Ident=4]="Ident"})(lt||(lt={}));const fu=new RegExp("\\s"),gu=new RegExp("[:@%_A-Za-z]"),mu=new RegExp("[@%_\\.A-Za-z0-9]"),es=new RegExp("[0-9]"),yu=new RegExp("[0-9a-fA-F]");function*bi(r,t=!1){let e=0;for(;e<r.length;){for(;e<r.length&&fu.test(r[e]);)e++;if(e===r.length)return;const i=r[e],n=e;if(gu.test(i)){for(e++;e<r.length&&mu.test(r[e]);)e++;yield{t:lt.Ident,v:r.slice(n,e),first:n,last:e}}else if(r.length-e>1&&r.substr(e,2)==="0x"){for(e+=2;e<r.length&&yu.test(r[e]);)e++;if((e-n&1)!==0)throw new je(r,e,"Bytes literal length is expected to be power of two");yield{t:lt.Bytes,v:r.slice(n,e),first:n,last:e}}else if(es.test(i)||i==="-"){i==="-"&&e++;const s=e;for(;e<r.length&&es.test(r[e]);)e++;if(s===e)throw new je(r,e,"Number literal is too short");yield{t:lt.Number,v:r.slice(n,e),first:n,last:e}}else if(i==='"'){e++;let s=!1;for(;e<r.length&&(s||r[e]!=='"');e++)!s&&r[e]==="\\"?s=!0:s=!1;if(e===r.length)throw new je(r,e,"Unterminated string literal");e++,yield{t:lt.String,v:r.slice(n,e),first:n,last:e}}else if(i==="#"){for(e++;e<r.length&&r[e]!==`
`;)e++;t&&(yield{t:lt.Comment,v:r.slice(n,e),first:n,last:e})}else if(r.length-e>1&&r.substr(e,2)==="/*"){for(e+=2;e<r.length&&!(r.length-e>1&&r.substr(e,2)==="*/");)e++;if(e===r.length)throw new je(r,e,"Unterminated C style comment");e+=2,t&&(yield{t:lt.Comment,v:r.slice(n,e),first:n,last:e})}else if(i==="("||i===")"||i==="{"||i==="}"||i===";")e++,yield{t:i,v:i,first:n,last:e};else throw new je(r,e,`Invalid character at offset ${e}: \`${i}'`)}}const Nr=Symbol("ref_contract");var Re;(function(r){r.Ps9mPmXa="Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P",r.PtCJ7pwo="PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY",r.PsYLVpVv="PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt",r.PsddFKi3="PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP",r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdoTez="PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLoren="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANAD="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangzH="PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakarta="PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(Re||(Re={}));const Zs=Re.Psithaca2,rs={Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P:0,PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY:1,PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt:2,PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP:3,Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd:4,PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU:5,PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS:5,PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb:6,PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo:7,PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq:8,PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA:8,PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i:9,PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV:10,PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r:11,PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx:11,PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP:12,Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A:12,PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw:13,PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY:13,PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg:14,ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK:15};function dr(r,t){return rs[r]<rs[t]}class vt extends Error{constructor(t,e){super(e),this.prim=t,Object.setPrototypeOf(this,vt.prototype)}}function q(r,t){var e,i;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new vt(r,`macro ${r.prim} expects ${t} arguments, was given ${(i=r.args)===null||i===void 0?void 0:i.length}`)}function lr(r){if(r.annots===void 0)return!0;throw new vt(r,`unexpected annotation on macro ${r.prim}: ${r.annots}`)}function is(r,t){if("int"in t)return!0;throw new vt(r,`macro ${r.prim} expects int argument`)}function fr(r,t,e,i){let n=0,s=0;const o=[null,null];let a;if(n===t.length)throw new vt(r,`unexpected end: ${r.prim}`);let c=t[n++];switch(c){case"P":{const{r:p,n:m,an:E}=fr(r,t.slice(n),e.slice(s),i);a=p,n+=m,s+=E;break}case"A":s!==e.length&&(o[0]=e[s++]);break;default:throw new vt(r,`${r.prim}: unexpected character: ${c}`)}let h;if(n===t.length)throw new vt(r,`unexpected end: ${r.prim}`);switch(c=t[n++],c){case"P":{const{r:p,n:m,an:E}=fr(r,t.slice(n),e.slice(s),i);h=p.map(([S,M])=>[S+1,M]),n+=m,s+=E;break}case"I":s!==e.length&&(o[1]=e[s++]);break;default:throw new vt(r,`${r.prim}: unexpected character: ${c}`)}return{r:i(a,h,[0,o]),n,an:s}}function Fr(r,t,e,i){const n=t[0];switch(n){case"A":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CAR",annots:["@%%"]},Fr(r,t.slice(1),[],i)]]},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%@","%@",...e]}]:i.a;case"D":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CDR",annots:["@%%"]},Fr(r,t.slice(1),[],i)]]},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%@",...e]}]:i.d;default:throw new vt(r,`${r.prim}: unexpected character: ${n}`)}}function bu(r,t){let e=r.length;for(;e>0&&r[e-1]===t;)e--;return r.slice(0,e)}function Ei(r){const t=[],e=[];if(r!==void 0)for(const i of r)(i.length!==0&&i[0]==="%"?t:e).push(i);return{fields:t,rest:e}}function et({prim:r,annots:t,args:e}){return Object.assign(Object.assign({prim:r},t&&{annots:t}),e&&{args:e})}const Eu=/^P[PAI]{3,}R$/,vu=/^UNP[PAI]{2,}R$/,wu=/^C[AD]{2,}R$/,Su=/^SET_C[AD]+R$/,_u=/^MAP_C[AD]+R$/,Au=/^DI{2,}P$/,Ou=/^DU+P$/;function Pu(r,t){const e=(t==null?void 0:t.protocol)||Zs;function i(n){return n!==void 0?[{prim:"RENAME",annots:n}]:[]}switch(r.prim){case"CMPEQ":case"CMPNEQ":case"CMPLT":case"CMPGT":case"CMPLE":case"CMPGE":if(q(r,0))return[{prim:"COMPARE"},et({prim:r.prim.slice(3),annots:r.annots})];break;case"IFEQ":case"IFNEQ":case"IFLT":case"IFGT":case"IFLE":case"IFGE":if(q(r,2))return[{prim:r.prim.slice(2)},et({prim:"IF",annots:r.annots,args:r.args})];break;case"IFCMPEQ":case"IFCMPNEQ":case"IFCMPLT":case"IFCMPGT":case"IFCMPLE":case"IFCMPGE":if(q(r,2))return[{prim:"COMPARE"},{prim:r.prim.slice(5)},et({prim:"IF",annots:r.annots,args:r.args})];break;case"FAIL":if(q(r,0)&&lr(r))return[{prim:"UNIT"},{prim:"FAILWITH"}];break;case"ASSERT":if(q(r,0)&&lr(r))return[{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_EQ":case"ASSERT_NEQ":case"ASSERT_LT":case"ASSERT_GT":case"ASSERT_LE":case"ASSERT_GE":if(q(r,0)&&lr(r))return[{prim:r.prim.slice(7)},{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_CMPEQ":case"ASSERT_CMPNEQ":case"ASSERT_CMPLT":case"ASSERT_CMPGT":case"ASSERT_CMPLE":case"ASSERT_CMPGE":if(q(r,0)&&lr(r))return[[{prim:"COMPARE"},{prim:r.prim.slice(10)}],{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_NONE":if(q(r,0)&&lr(r))return[{prim:"IF_NONE",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_SOME":if(q(r,0))return[{prim:"IF_NONE",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],i(r.annots)]}];break;case"ASSERT_LEFT":if(q(r,0))return[{prim:"IF_LEFT",args:[i(r.annots),[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_RIGHT":if(q(r,0))return[{prim:"IF_LEFT",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],i(r.annots)]}];break;case"IF_SOME":if(q(r,2))return[et({prim:"IF_NONE",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"IF_RIGHT":if(q(r,2))return[et({prim:"IF_LEFT",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"CAR":case"CDR":if(r.args!==void 0){if(q(r,1)&&is(r,r.args[0])){const n=parseInt(r.args[0].int,10);return et({prim:"GET",args:[{int:r.prim==="CAR"?String(n*2+1):String(n*2)}],annots:r.annots})}}else return r}if(Eu.test(r.prim)&&q(r,0)){const{fields:n,rest:s}=Ei(r.annots),{r:o}=fr(r,r.prim.slice(1),n,(a,c,h)=>[...a||[],...c||[],h]);return o.map(([a,c],h)=>{const p=[...bu(c,null).map(E=>E===null?"%":E),...a===0&&h===o.length-1?s:[]],m=et({prim:"PAIR",annots:p.length!==0?p:void 0});return a===0?m:{prim:"DIP",args:a===1?[[m]]:[{int:String(a)},[m]]}})}if(vu.test(r.prim))if(dr(e,Re.PtEdo2Zk)&&q(r,0)){const{r:n}=fr(r,r.prim.slice(3),r.annots||[],(s,o,a)=>[a,...o||[],...s||[]]);return n.map(([s,o])=>{const a=[{prim:"DUP"},et({prim:"CAR",annots:o[0]!==null?[o[0]]:void 0}),{prim:"DIP",args:[[et({prim:"CDR",annots:o[1]!==null?[o[1]]:void 0})]]}];return s===0?a:{prim:"DIP",args:s===1?[[a]]:[{int:String(s)},[a]]}})}else{if(r.prim==="UNPAIR")return r;if(q(r,0)){const{r:n}=fr(r,r.prim.slice(3),[],(s,o,a)=>[a,...o||[],...s||[]]);return n.map(([s])=>{const o=et({prim:"UNPAIR"});return s===0?o:{prim:"DIP",args:s===1?[[o]]:[{int:String(s)},[o]]}})}}if(wu.test(r.prim)&&q(r,0)){const n=[...r.prim.slice(1,r.prim.length-1)];return n.map((s,o)=>{const a=o===n.length-1?r.annots:void 0;switch(s){case"A":return et({prim:"CAR",annots:a});case"D":return et({prim:"CDR",annots:a});default:throw new vt(r,`unexpected character: ${s}`)}})}if(Su.test(r.prim)&&q(r,0)){const{fields:n,rest:s}=Ei(r.annots);if(n.length>1)throw new vt(r,`unexpected annotation on macro ${r.prim}: ${n}`);const o=n.length!==0?{a:[{prim:"DUP"},{prim:"CAR",annots:n},{prim:"DROP"},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:[n[0],"%@"]}],d:[{prim:"DUP"},{prim:"CDR",annots:n},{prim:"DROP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",n[0]]}]}:{a:[{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%","%@"]}],d:[{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%"]}]};return Fr(r,r.prim.slice(5,r.prim.length-1),s,o)}if(_u.test(r.prim)&&q(r,1)){const{fields:n}=Ei(r.annots);if(n.length>1)throw new vt(r,`unexpected annotation on macro ${r.prim}: ${n}`);const s={a:[{prim:"DUP"},{prim:"CDR",annots:["@%%"]},{prim:"DIP",args:[[et({prim:"CAR",annots:n.length!==0?["@"+n[0].slice(1)]:void 0}),r.args[0]]]},{prim:"SWAP"},{prim:"PAIR",annots:[n.length!==0?n[0]:"%","%@"]}],d:[{prim:"DUP"},et({prim:"CDR",annots:n.length!==0?["@"+n[0].slice(1)]:void 0}),r.args[0],{prim:"SWAP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",n.length!==0?n[0]:"%"]}]};return Fr(r,r.prim.slice(5,r.prim.length-1),[],s)}if(Au.test(r.prim)&&q(r,1)){let n=0;for(;r.prim[1+n]==="I";)n++;return et({prim:"DIP",args:[{int:String(n)},r.args[0]]})}if(Ou.test(r.prim)){let n=0;for(;r.prim[1+n]==="U";)n++;if(dr(e,Re.PtEdo2Zk)){if(n===1){if(r.args===void 0)return r;q(r,1)&&is(r,r.args[0])&&(n=parseInt(r.args[0].int,10))}else q(r,0);return n===1?[et({prim:"DUP",annots:r.annots})]:n===2?[{prim:"DIP",args:[[et({prim:"DUP",annots:r.annots})]]},{prim:"SWAP"}]:[{prim:"DIP",args:[{int:String(n-1)},[et({prim:"DUP",annots:r.annots})]]},{prim:"DIG",args:[{int:String(n)}]}]}else{if(n===1)return r;if(q(r,0))return et({prim:"DUP",args:[{int:String(n)}],annots:r.annots})}}return r}function Tu(r,t){return r.args!==void 0&&r.args.length===1&&"string"in r.args[0]&&r.args[0].string in t?t[r.args[0].string]:r}class Ze extends Error{constructor(t,e){super(e),this.token=t,Object.setPrototypeOf(this,Ze.prototype)}}class Mt extends Error{constructor(t,e){super(e),this.node=t,Object.setPrototypeOf(this,Mt.prototype)}}const vi=new Ze(null,"Unexpected EOF");function ns(r){return r.t===lt.Ident&&(r.v[0]==="@"||r.v[0]==="%"||r.v[0]===":")}const Ru=new RegExp("^-?[0-9]+$"),Iu=new RegExp("^([0-9a-fA-F]{2})*$");class He{constructor(t){this.opt=t}expand(t){var e,i,n;if(((e=this.opt)===null||e===void 0?void 0:e.expandGlobalConstant)!==void 0&&t.prim==="constant"){const s=Tu(t,this.opt.expandGlobalConstant);return s!==t&&(s[ht]=Object.assign(Object.assign({},t[ht]||{first:0,last:0}),{globalConstant:t})),s}if(((i=this.opt)===null||i===void 0?void 0:i.expandMacros)===void 0||((n=this.opt)===null||n===void 0?void 0:n.expandMacros)){const s=Pu(t,this.opt);return s!==t&&(s[ht]=Object.assign(Object.assign({},t[ht]||{first:0,last:0}),{macro:t})),s}else return t}parseListExpr(t,e){var i;const n={first:e.first,last:e.last},s=e.t==="(";let o;if(s){if(o=t.next(),o.done)throw vi;n.last=o.value.last}else o={value:e};if(o.value.t!==lt.Ident)throw new Ze(o.value,`not an identifier: ${o.value.v}`);const a={prim:o.value.v,[ht]:n};for(;;){const c=t.next();if(c.done){if(s)throw vi;break}else if(c.value.t===")"){if(!s)throw new Ze(c.value,"unexpected closing bracket");n.last=c.value.last;break}else if(ns(c.value))a.annots=a.annots||[],a.annots.push(c.value.v),n.last=c.value.last;else{a.args=a.args||[];const h=this.parseExpr(t,c.value);n.last=((i=h[ht])===null||i===void 0?void 0:i.last)||n.last,a.args.push(h)}}return this.expand(a)}parseArgs(t,e){var i;const n={first:e.first,last:e.last},s={prim:e.v,[ht]:n};for(;;){const o=t.next();if(o.done||o.value.t==="}"||o.value.t===";")return[s,o];if(ns(o.value))n.last=o.value.last,s.annots=s.annots||[],s.annots.push(o.value.v);else{const a=this.parseExpr(t,o.value);n.last=((i=a[ht])===null||i===void 0?void 0:i.last)||n.last,s.args=s.args||[],s.args.push(a)}}}parseSequenceExpr(t,e){var i,n;const s={first:e.first,last:e.last},o=[];o[ht]=s;const a=e.t==="{";let c=e.t==="{"?null:{value:e};for(;;){if(c===null&&(c=t.next(),c.done||(s.last=c.value.last)),c.done){if(a)throw vi;return o}if(c.value.t==="}"){if(a)return o;throw new Ze(c.value,"unexpected closing bracket")}else if(c.value.t===lt.Ident){const[h,p]=this.parseArgs(t,c.value);s.last=((i=h[ht])===null||i===void 0?void 0:i.last)||s.last,o.push(this.expand(h)),c=p}else{const h=this.parseExpr(t,c.value);s.last=((n=h[ht])===null||n===void 0?void 0:n.last)||s.last,o.push(h),c=null}c===null&&(c=t.next(),c.done||(s.last=c.value.last)),!c.done&&c.value.t===";"&&(c=null)}}parseExpr(t,e){switch(e.t){case lt.Ident:return this.expand({prim:e.v,[ht]:{first:e.first,last:e.last}});case lt.Number:return{int:e.v,[ht]:{first:e.first,last:e.last}};case lt.String:return{string:JSON.parse(e.v),[ht]:{first:e.first,last:e.last}};case lt.Bytes:return{bytes:e.v.slice(2),[ht]:{first:e.first,last:e.last}};case"{":return this.parseSequenceExpr(t,e);default:return this.parseListExpr(t,e)}}parseSequence(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=bi(t),i=e.next();return i.done?null:this.parseSequenceExpr(e,i.value)}parseList(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=bi(t),i=e.next();return i.done?null:this.parseListExpr(e,i.value)}parseMichelineExpression(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=bi(t),i=e.next();return i.done?null:this.parseExpr(e,i.value)}parseScript(t){return this.parseSequence(t)}parseData(t){return this.parseList(t)}parseJSON(t){if(typeof t!="object")throw new TypeError(`object type was expected, got ${typeof t} instead`);if(Array.isArray(t)){const e=[];for(const i of t){if(i===null||typeof i!="object")throw new Mt(i,`unexpected sequence element: ${i}`);e.push(this.parseJSON(i))}return e}else if("prim"in t){const e=t;if(typeof e.prim=="string"&&(e.annots===void 0||Array.isArray(e.annots))&&(e.args===void 0||Array.isArray(e.args))){const i={prim:e.prim};if(e.annots!==void 0){for(const n of e.annots)if(typeof n!="string")throw new Mt(n,`string expected: ${n}`);i.annots=e.annots}if(e.args!==void 0){i.args=[];for(const n of e.args){if(n===null||typeof n!="object")throw new Mt(n,`unexpected argument: ${n}`);i.args.push(this.parseJSON(n))}}return this.expand(i)}throw new Mt(t,`malformed prim expression: ${t}`)}else if("string"in t){if(typeof t.string=="string")return{string:t.string};throw new Mt(t,`malformed string literal: ${t}`)}else if("int"in t){if(typeof t.int=="string"&&Ru.test(t.int))return{int:t.int};throw new Mt(t,`malformed int literal: ${t}`)}else if("bytes"in t){if(typeof t.bytes=="string"&&Iu.test(t.bytes))return{bytes:t.bytes};throw new Mt(t,`malformed bytes literal: ${t}`)}else throw new Mt(t,`unexpected object: ${t}`)}}const xu=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Nu=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];class xi extends Error{constructor(t){super(t),this.message=t,this.name="Base58DecodingError"}}class Lu extends Error{constructor(t){super(t),this.message=t,this.name="InvalidMessageError"}}function ss(r){const t=(r.length+9)%64,e=t===0?0:64-t;if(r.length>268435455)throw new Lu(`SHA-256 -- message length is too big: ${r.length}`);const i=r.length<<3,n=[...r,128,...new Array(e).fill(0),0,0,0,0,i>>24&255,i>>16&255,i>>8&255,i&255];function s(p,m){return p>>>m|p<<32-m}const o=[...xu],a=new Array(64),c=new Array(8);for(let p=0;p<n.length;p+=64){let m=p,E=0;for(;E<16;)a[E]=n[m]<<24|n[m+1]<<16|n[m+2]<<8|n[m+3],m+=4,E++;for(;E<64;){const S=s(a[E-15],7)^s(a[E-15],18)^a[E-15]>>>3,M=s(a[E-2],17)^s(a[E-2],19)^a[E-2]>>>10;a[E]=(M|0)+a[E-7]+S+a[E-16]|0,E++}for(let S=0;S<8;S++)c[S]=o[S];for(let S=0;S<64;S++){const M=s(c[0],2)^s(c[0],13)^s(c[0],22),W=s(c[4],6)^s(c[4],11)^s(c[4],25),x=c[7]+W+(c[4]&c[5]^~c[4]&c[6])+Nu[S]+a[S]|0,A=M+(c[0]&c[1]^c[0]&c[2]^c[1]&c[2])|0;c[7]=c[6],c[6]=c[5],c[5]=c[4],c[4]=c[3]+x|0,c[3]=c[2],c[2]=c[1],c[1]=c[0],c[0]=x+A|0}for(let S=0;S<8;S++)o[S]=o[S]+c[S]|0}const h=[];for(const p of o)h.push(p>>24&255),h.push(p>>16&255),h.push(p>>8&255),h.push(p&255);return h}const wi=[0,1,2,3,4,5,6,7,8,-1,-1,-1,-1,-1,-1,-1,9,10,11,12,13,14,15,16,-1,17,18,19,20,21,-1,22,23,24,25,26,27,28,29,30,31,32,-1,-1,-1,-1,-1,-1,33,34,35,36,37,38,39,40,41,42,43,-1,44,45,46,47,48,49,50,51,52,53,54,55,56,57];function os(r,t){const e=r.charCodeAt(t)-49;if(e>=wi.length||wi[e]===-1)throw new xi(`Unexpected character at position ${t}: ${r[t]}`);return wi[e]}function Cu(r){const t=[];let e=0;for(;e<r.length&&os(r,e)===0;)e++;let i=e;for(;e<r.length;){let n=os(r,e++),s=0;for(;n!==0||s<t.length;){const o=(t[s]||0)*58+n;t[s++]=o%256,n=Math.floor(o/256)}}for(;i-- >0;)t.push(0);return t.reverse()}function Xs(r){const t=Cu(r);if(t.length<4)throw new xi(`Data is too short ${t.length}`);const e=t.slice(0,t.length-4),i=t.slice(t.length-4),n=ss(ss(e));if(i[0]!==n[0]||i[1]!==n[1]||i[2]!==n[2]||i[3]!==n[3])throw new xi("Invalid checksum");return e}class Du extends Error{constructor(t){super(t),this.message=t,this.name="InvalidContractError"}}class Mu extends Error{constructor(t){super(t),this.message=t,this.name="InvalidTypeExpressionError"}}class ku extends Error{constructor(t){super(t),this.message=t,this.name="InvalidDataExpressionError"}}class Bu extends Error{constructor(t){super(`Contract has no entrypoint named: '${t}'`),this.entrypoint=t,this.name="InvalidEntrypointError"}}class ju extends Error{constructor(t){super(t),this.message=t,this.name="LongIntegerError"}}class $u extends Error{constructor(t){super(`Unable to parse hex byte: ${t}`),this.hexByte=t,this.name="HexParseError"}}class wt extends Error{constructor(t,e){super(e),this.val=t,Object.setPrototypeOf(this,wt.prototype)}}class O extends wt{constructor(t,e,i){super(t,i),e!==void 0&&(this.data=e),Object.setPrototypeOf(this,O.prototype)}}class Qs{constructor(t){if(this.neg=!1,this.buf=[],t!==void 0)if(typeof t=="string")for(let e=0;e<t.length;e++){const i=t.charCodeAt(e);if(e===0&&i===45)this.neg=!0;else{if(i<48||i>57)throw new ju(`unexpected character in integer constant: ${t[e]}`);this.append(i-48)}}else t<0?(this.neg=!0,this.append(-t)):this.append(t)}append(t){let e=0;for(;t!==0||e<this.buf.length;){const i=(this.buf[e]||0)*10+t;this.buf[e++]=i%256,t=Math.floor(i/256)}}cmp(t){if(this.neg!==t.neg)return(t.neg?1:0)-(this.neg?1:0);{let e=0;if(this.buf.length!==t.buf.length)e=this.buf.length<t.buf.length?-1:1;else if(this.buf.length!==0){let i=t.buf.length-1;for(;i>=0&&this.buf[i]===t.buf[i];)i--;e=i<0?0:this.buf[i]<t.buf[i]?-1:1}return this.neg?e===0?0:-e:e}}get sign(){return this.buf.length===0?0:this.neg?-1:1}}function Xe(r){const t=[];for(let e=0;e<r.length;e+=2){const i=parseInt(r.slice(e,e+2),16);if(Number.isNaN(i))return null;t.push(i)}return t}function Ni(r){try{return new Qs(r),!0}catch{return!1}}function to(r){try{return new Qs(r).sign>=0}catch{return!1}}const Vu=/^(@%|@%%|%@|[@:%]([_0-9a-zA-Z][_0-9a-zA-Z.%@]*)?)$/;function rr(r,t){if(Array.isArray(r))return{};let e,i,n;if(r.annots!==void 0){for(const s of r.annots)if(s.length!==0){if(!Vu.test(s)||!(t!=null&&t.specialVar)&&(s==="@%"||s==="@%%")||!(t!=null&&t.specialFields)&&s==="%@")throw new wt(r,`${r.prim}: unexpected annotation: ${s}`);switch(s[0]){case"%":((t==null?void 0:t.emptyFields)||s.length>1)&&(e=e||[],e.push(s));break;case":":s.length>1&&(i=i||[],i.push(s));break;case"@":((t==null?void 0:t.emptyVar)||s.length>1)&&(n=n||[],n.push(s));break}}}return{f:e,t:i,v:n}}const Uu={BlockHash:[32,[1,52]],OperationHash:[32,[5,116]],OperationListHash:[32,[133,233]],OperationListListHash:[32,[29,159,109]],ProtocolHash:[32,[2,170]],ContextHash:[32,[79,199]],ED25519PublicKeyHash:[20,[6,161,159]],SECP256K1PublicKeyHash:[20,[6,161,161]],P256PublicKeyHash:[20,[6,161,164]],ContractHash:[20,[2,90,121]],CryptoboxPublicKeyHash:[16,[153,103]],ED25519Seed:[32,[13,15,58,7]],ED25519PublicKey:[32,[13,15,37,217]],SECP256K1SecretKey:[32,[17,162,224,201]],P256SecretKey:[32,[16,81,238,189]],ED25519EncryptedSeed:[56,[7,90,60,179,41]],SECP256K1EncryptedSecretKey:[56,[9,237,241,174,150]],P256EncryptedSecretKey:[56,[9,48,57,115,171]],SECP256K1PublicKey:[33,[3,254,226,86]],P256PublicKey:[33,[3,178,139,127]],SECP256K1Scalar:[33,[38,248,136]],SECP256K1Element:[33,[5,92,0]],ED25519SecretKey:[64,[43,246,78,7]],ED25519Signature:[64,[9,245,205,134,18]],SECP256K1Signature:[64,[13,115,101,19,63]],P256Signature:[64,[54,240,44,52]],GenericSignature:[64,[4,130,43]],ChainID:[4,[87,82,0]],RollupAddress:[20,[1,128,120,31]],TxRollupL2Address:[20,[6,161,166]]};function pe(r,...t){const e=Xs(r);for(const i of t){const[n,s]=Uu[i];if(e.length===n+s.length){let o=0;for(;o<s.length&&e[o]===s[o];)o++;if(o===s.length)return[i,e.slice(s.length)]}}return null}function yt(r,t){const e=t,i=Array.isArray(e)?e:e.args;return i.length===2?r==="pair"?{prim:"pair",args:i}:{prim:"Pair",args:i}:Object.assign(Object.assign({},Array.isArray(e)?{prim:r}:e),{args:[i[0],{prim:r,args:i.slice(1)}]})}function de(r){return Array.isArray(r)||r.prim==="pair"}function eo(r){return Array.isArray(r)||"prim"in r&&r.prim==="Pair"}const Hu=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])[T ]([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):([0-5][0-9]))$/;function ro(r){if("string"in r){if(to(r.string))return new Date(parseInt(r.string,10));if(Hu.test(r.string)){const t=new Date(r.string);if(!Number.isNaN(t.valueOf))return t}}else if(Ni(r.int))return new Date(parseInt(r.int,10));return null}function Ku(r){const t=[];for(let e=0;e<r.length;e+=2){const i=r.slice(e,e+2),n=parseInt(i,16);if(Number.isNaN(n))throw new $u(i);t.push(n)}return t}function We(r){return r.map(t=>(t>>4&15).toString(16)+(t&15).toString(16)).join("")}const Gu=31,io={ABS:!0,ADD:!0,ADDRESS:!0,AMOUNT:!0,AND:!0,APPLY:!0,BALANCE:!0,BLAKE2B:!0,CAR:!0,CDR:!0,CHAIN_ID:!0,CHECK_SIGNATURE:!0,COMPARE:!0,CONCAT:!0,CONS:!0,EDIV:!0,EQ:!0,EXEC:!0,FAILWITH:!0,GE:!0,GET_AND_UPDATE:!0,GT:!0,HASH_KEY:!0,IMPLICIT_ACCOUNT:!0,INT:!0,ISNAT:!0,JOIN_TICKETS:!0,KECCAK:!0,LE:!0,LEVEL:!0,LSL:!0,LSR:!0,LT:!0,MEM:!0,MUL:!0,NEG:!0,NEQ:!0,NEVER:!0,NOT:!0,NOW:!0,OR:!0,PACK:!0,PAIRING_CHECK:!0,READ_TICKET:!0,SAPLING_VERIFY_UPDATE:!0,SELF:!0,SELF_ADDRESS:!0,SENDER:!0,SET_DELEGATE:!0,SHA256:!0,SHA3:!0,SHA512:!0,SIZE:!0,SLICE:!0,SOME:!0,SOURCE:!0,SPLIT_TICKET:!0,SUB:!0,SWAP:!0,TICKET:!0,TOTAL_VOTING_POWER:!0,TRANSFER_TOKENS:!0,UNIT:!0,VOTING_POWER:!0,XOR:!0,RENAME:!0,OPEN_CHEST:!0,SUB_MUTEZ:!0,MIN_BLOCK_TIME:!0},no=Object.assign({},io,{CONTRACT:!0,CREATE_CONTRACT:!0,DIG:!0,DIP:!0,DROP:!0,DUG:!0,DUP:!0,EMIT:!0,EMPTY_BIG_MAP:!0,EMPTY_MAP:!0,EMPTY_SET:!0,GET:!0,IF:!0,IF_CONS:!0,IF_LEFT:!0,IF_NONE:!0,ITER:!0,LAMBDA:!0,LEFT:!0,LOOP:!0,LOOP_LEFT:!0,MAP:!0,NIL:!0,NONE:!0,PAIR:!0,PUSH:!0,RIGHT:!0,SAPLING_EMPTY_STATE:!0,UNPACK:!0,UNPAIR:!0,UPDATE:!0,CAST:!0,VIEW:!0}),so={unit:!0,never:!0,bool:!0,int:!0,nat:!0,string:!0,chain_id:!0,bytes:!0,mutez:!0,key_hash:!0,key:!0,signature:!0,timestamp:!0,address:!0,tx_rollup_l2_address:!0},cr=Object.assign({},so,{or:!0,pair:!0,set:!0,big_map:!0,contract:!0,lambda:!0,list:!0,map:!0,operation:!0,option:!0,bls12_381_g1:!0,bls12_381_g2:!0,bls12_381_fr:!0,sapling_transaction:!0,sapling_state:!0,ticket:!0,chest_key:!0,chest:!0});class H extends wt{constructor(t,e){super(t,e),this.val=t,Object.setPrototypeOf(this,H.prototype)}}function Qt(r){return"prim"in r}function Fu(r){return Array.isArray(r)||"prim"in r}function oo(r){if(Qt(r))return!0;throw new H(r,"prim expression expected")}function Te(r){if(Array.isArray(r))return!0;throw new H(r,"sequence expression expected")}function ct(r){if(Fu(r))return!0;throw new H(r,"prim or sequence expression expected")}function Si(r){if(r.int[0]==="-")throw new H(r,"natural number expected")}function Br(r){if("int"in r)return!0;throw new H(r,"int literal expected")}function ao(r){if("string"in r)return!0;throw new H(r,"string literal expected")}function B(r,t){var e;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new H(r,`${t} arguments expected`)}function Rt(r){var t,e;if(Array.isArray(r)){for(const i of r){if(!Array.isArray(i)&&!Qt(i))throw new H(r,"sequence or prim expected");Rt(i)}return!0}if(oo(r)){if(Object.prototype.hasOwnProperty.call(io,r.prim))return B(r,0),!0;switch(r.prim){case"DROP":case"PAIR":case"UNPAIR":case"DUP":case"UPDATE":case"GET":r.args!==void 0&&B(r,1)&&Br(r.args[0])&&Si(r.args[0]);break;case"DIG":case"DUG":case"SAPLING_EMPTY_STATE":B(r,1)&&Br(r.args[0])&&Si(r.args[0]);break;case"NONE":case"LEFT":case"RIGHT":case"NIL":case"CAST":B(r,1)&&fe(r.args[0]);break;case"UNPACK":B(r,1)&&tn(r.args[0]);break;case"CONTRACT":B(r,1)&&ui(r.args[0]);break;case"IF_NONE":case"IF_LEFT":case"IF_CONS":case"IF":B(r,2)&&(Te(r.args[0])&&Rt(r.args[0]),Te(r.args[1])&&Rt(r.args[1]));break;case"MAP":case"ITER":case"LOOP":case"LOOP_LEFT":B(r,1)&&Rt(r.args[0]);break;case"CREATE_CONTRACT":B(r,1)&&uo(r.args[0]);break;case"DIP":if(((t=r.args)===null||t===void 0?void 0:t.length)===2)Br(r.args[0])&&Si(r.args[0]),Te(r.args[1])&&Rt(r.args[1]);else if(((e=r.args)===null||e===void 0?void 0:e.length)===1)Te(r.args[0])&&Rt(r.args[0]);else throw new H(r,"1 or 2 arguments expected");break;case"PUSH":B(r,2)&&(ir(r.args[0]),$e(r.args[1]));break;case"EMPTY_SET":B(r,1)&&ye(r.args[0]);break;case"EMPTY_MAP":B(r,2)&&(ye(r.args[0]),fe(r.args[1]));break;case"EMPTY_BIG_MAP":B(r,2)&&(ye(r.args[0]),hi(r.args[1]));break;case"LAMBDA":B(r,3)&&(fe(r.args[0]),fe(r.args[1]),Te(r.args[2])&&Rt(r.args[2]));break;case"VIEW":B(r,2)&&(ao(r.args[0])&&co(r.args[0]),fe(r.args[1])&&ir(r.args[1]));break;case"EMIT":r.args&&r.args.length>0?B(r,1):B(r,0);break;default:throw new H(r,"instruction expected")}}return!0}function ye(r){if(ct(r)){if(Array.isArray(r)||r.prim==="pair"||r.prim==="or"||r.prim==="option")ze(r,t=>ye(t));else if(!Object.prototype.hasOwnProperty.call(so,r.prim))throw new H(r,`${r.prim}: type is not comparable`)}return!0}function tn(r){if(ct(r)&&Qt(r)){if(!Object.prototype.hasOwnProperty.call(cr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket")throw new H(r,`${r.prim}: type can't be used inside PACK/UNPACK instructions`);ze(r,t=>tn(t))}return!0}function ir(r){if(ct(r)&&Qt(r)){if(!Object.prototype.hasOwnProperty.call(cr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket"||r.prim==="contract")throw new H(r,`${r.prim}: type can't be pushed`);ze(r,t=>ir(t))}return!0}function en(r){if(ct(r)&&Qt(r)){if(!Object.prototype.hasOwnProperty.call(cr,r.prim)||r.prim==="operation"||r.prim==="contract")throw new H(r,`${r.prim}: type can't be used as part of a storage`);ze(r,t=>en(t))}return!0}function ui(r){if(ct(r)&&Qt(r)){if(!Object.prototype.hasOwnProperty.call(cr,r.prim)||r.prim==="operation")throw new H(r,`${r.prim}: type can't be used as part of a parameter`);ze(r,t=>ui(t))}return!0}function hi(r){if(ct(r)&&Qt(r)){if(!Object.prototype.hasOwnProperty.call(cr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state")throw new H(r,`${r.prim}: type can't be used inside a big_map`);ze(r,t=>hi(t))}return!0}const zu=new RegExp("^[a-zA-Z0-9_.%@]*$");function co(r){if(r.string.length>Gu)throw new H(r,`view name too long: ${r.string}`);if(!zu.test(r.string))throw new H(r,`invalid character(s) in view name: ${r.string}`)}function fe(r){if(ct(r)&&Qt(r)){if(!Object.prototype.hasOwnProperty.call(cr,r.prim))throw new H(r,"type expected");ze(r,t=>fe(t))}return!0}function ze(r,t){if(Array.isArray(r)||r.prim==="pair"){const e=Array.isArray(r)?r:r.args;if(e===void 0||e.length<2)throw new H(r,"at least 2 arguments expected");return e.forEach(i=>{ct(i)&&t(i)}),!0}switch(r.prim){case"option":case"list":B(r,1)&&ct(r.args[0])&&t(r.args[0]);break;case"contract":B(r,1)&&ui(r.args[0]);break;case"or":B(r,2)&&ct(r.args[0])&&ct(r.args[1])&&(t(r.args[0]),t(r.args[1]));break;case"lambda":B(r,2)&&(fe(r.args[0]),fe(r.args[1]));break;case"set":B(r,1)&&ye(r.args[0]);break;case"map":B(r,2)&&ct(r.args[0])&&ct(r.args[1])&&(ye(r.args[0]),t(r.args[1]));break;case"big_map":B(r,2)&&ct(r.args[0])&&ct(r.args[1])&&(ye(r.args[0]),hi(r.args[1]),t(r.args[1]));break;case"ticket":B(r,1)&&ct(r.args[0])&&ye(r.args[0]);break;case"sapling_state":case"sapling_transaction":B(r,1)&&Br(r.args[0]);break;default:B(r,0)}return!0}function $e(r){if("int"in r||"string"in r||"bytes"in r)return!0;if(Array.isArray(r)){let t=0;for(const e of r)Qt(e)&&e.prim==="Elt"?(B(e,2)&&($e(e.args[0]),$e(e.args[1])),t++):$e(e);if(t!==0&&t!==r.length)throw new H(r,"data entries and map elements can't be intermixed");return!0}if(Qt(r))switch(r.prim){case"Unit":case"True":case"False":case"None":B(r,0);break;case"Pair":if(r.args===void 0||r.args.length<2)throw new H(r,"at least 2 arguments expected");for(const t of r.args)$e(t);break;case"Left":case"Right":case"Some":B(r,1)&&$e(r.args[0]);break;default:if(Object.prototype.hasOwnProperty.call(no,r.prim))Rt(r);else throw new H(r,"data entry or instruction expected")}else throw new H(r,"data entry expected");return!0}function uo(r){if(Te(r)){const t={},e={};for(const i of r)if(oo(i)){if(i.prim!=="view"){if(i.prim in t)throw new H(r,`duplicate contract section: ${i.prim}`);t[i.prim]=!0}switch(i.prim){case"code":B(i,1)&&Te(i.args[0])&&Rt(i.args[0]);break;case"parameter":if(B(i,1)&&ui(i.args[0]),i.annots)throw new H(i,"Annotation must be part of the parameter type");break;case"storage":B(i,1)&&en(i.args[0]);break;case"view":if(B(i,4)){if(ao(i.args[0])){const n=i.args[0];if(n.string in e)throw new H(r,`duplicate view name: ${n.string}`);e[n.string]=!0,co(n)}ir(i.args[1]),ir(i.args[2]),Te(i.args[3])&&Rt(i.args[3])}break;default:throw new H(r,`unexpected contract section: ${i.prim}`)}}}return!0}function ho(r){return Object.prototype.hasOwnProperty.call(no,r.prim)}function Li(r){if(!Array.isArray(r))return!1;for(const t of r)if("prim"in t){if(ho(t))throw new wt(r,`Instruction outside of a lambda: ${JSON.stringify(r)}`);if(t.prim==="Elt")throw new wt(r,`Elt item outside of a map literal: ${JSON.stringify(r)}`)}return!0}function Wu(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}const qu=["parameter","storage","code","False","Elt","Left","None","Pair","Right","Some","True","Unit","PACK","UNPACK","BLAKE2B","SHA256","SHA512","ABS","ADD","AMOUNT","AND","BALANCE","CAR","CDR","CHECK_SIGNATURE","COMPARE","CONCAT","CONS","CREATE_ACCOUNT","CREATE_CONTRACT","IMPLICIT_ACCOUNT","DIP","DROP","DUP","EDIV","EMPTY_MAP","EMPTY_SET","EQ","EXEC","FAILWITH","GE","GET","GT","HASH_KEY","IF","IF_CONS","IF_LEFT","IF_NONE","INT","LAMBDA","LE","LEFT","LOOP","LSL","LSR","LT","MAP","MEM","MUL","NEG","NEQ","NIL","NONE","NOT","NOW","OR","PAIR","PUSH","RIGHT","SIZE","SOME","SOURCE","SENDER","SELF","STEPS_TO_QUOTA","SUB","SWAP","TRANSFER_TOKENS","SET_DELEGATE","UNIT","UPDATE","XOR","ITER","LOOP_LEFT","ADDRESS","CONTRACT","ISNAT","CAST","RENAME","bool","contract","int","key","key_hash","lambda","list","map","big_map","nat","option","or","pair","set","signature","string","bytes","mutez","timestamp","unit","operation","address","SLICE","DIG","DUG","EMPTY_BIG_MAP","APPLY","chain_id","CHAIN_ID","LEVEL","SELF_ADDRESS","never","NEVER","UNPAIR","VOTING_POWER","TOTAL_VOTING_POWER","KECCAK","SHA3","PAIRING_CHECK","bls12_381_g1","bls12_381_g2","bls12_381_fr","sapling_state","sapling_transaction","SAPLING_EMPTY_STATE","SAPLING_VERIFY_UPDATE","ticket","TICKET","READ_TICKET","SPLIT_TICKET","JOIN_TICKETS","GET_AND_UPDATE","chest","chest_key","OPEN_CHEST","VIEW","view","constant","SUB_MUTEZ","EMIT"],Ju=Object.assign({},...qu.map((r,t)=>({[r]:t})));var ve;(function(r){r[r.Int=0]="Int",r[r.String=1]="String",r[r.Sequence=2]="Sequence",r[r.Prim0=3]="Prim0",r[r.Prim0Annot=4]="Prim0Annot",r[r.Prim1=5]="Prim1",r[r.Prim1Annot=6]="Prim1Annot",r[r.Prim2=7]="Prim2",r[r.Prim2Annot=8]="Prim2Annot",r[r.Prim=9]="Prim",r[r.Bytes=10]="Bytes"})(ve||(ve={}));class Qe{constructor(){this.buffer=[]}get length(){return this.buffer.length}writeBytes(t){this.buffer.push(...t.map(e=>e&255))}writeUint8(t){const e=t|0;this.buffer.push(e&255)}writeUint16(t){const e=t|0;this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeUint32(t){const e=t|0;this.buffer.push(e>>24&255),this.buffer.push(e>>16&255),this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeInt8(t){this.writeUint8(t)}writeInt16(t){this.writeUint16(t)}writeInt32(t){this.writeUint32(t)}}const Ee=new Error("bounds out of range");class nr{constructor(t,e=0,i=t.length){this.buffer=t,this.idx=e,this.cap=i}get length(){return this.cap-this.idx}readBytes(t){if(this.cap-this.idx<t)throw Ee;const e=this.buffer.slice(this.idx,this.idx+t);return this.idx+=t,e}reader(t){if(this.cap-this.idx<t)throw Ee;const e=new nr(this.buffer,this.idx,this.idx+t);return this.idx+=t,e}copy(){return new nr(this.buffer,this.idx,this.cap)}readUint8(){if(this.cap-this.idx<1)throw Ee;return this.buffer[this.idx++]>>>0}readUint16(){if(this.cap-this.idx<2)throw Ee;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)>>>0}readUint32(){if(this.cap-this.idx<4)throw Ee;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],i=this.buffer[this.idx++],n=this.buffer[this.idx++];return(t<<24|e<<16|i<<8|n)>>>0}readInt8(){if(this.cap-this.idx<1)throw Ee;return this.buffer[this.idx++]<<24>>24}readInt16(){if(this.cap-this.idx<2)throw Ee;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)<<16>>16}readInt32(){if(this.cap-this.idx<4)throw Ee;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],i=this.buffer[this.idx++],n=this.buffer[this.idx++];return t<<24|e<<16|i<<8|n}}var sr;(function(r){r[r.Implicit=0]="Implicit",r[r.Originated=1]="Originated"})(sr||(sr={}));var Ie;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(Ie||(Ie={}));function lo(r){let t;const e=r.readUint8();switch(e){case Ie.ED25519:t="ED25519PublicKeyHash";break;case Ie.SECP256K1:t="SECP256K1PublicKeyHash";break;case Ie.P256:t="P256PublicKeyHash";break;default:throw new Error(`unknown public key hash tag: ${e}`)}return{type:t,hash:r.readBytes(20)}}function Yu(r){let t;const e=r.readUint8();switch(e){case sr.Implicit:t=lo(r);break;case sr.Originated:t={type:"ContractHash",hash:r.readBytes(20)},r.readBytes(1);break;default:throw new Error(`unknown address tag: ${e}`)}if(r.length!==0){const i=new TextDecoder;t.entryPoint=i.decode(new Uint8Array(r.readBytes(r.length)))}return t}function po(r,t){let e;switch(r.type){case"ED25519PublicKeyHash":e=Ie.ED25519;break;case"SECP256K1PublicKeyHash":e=Ie.SECP256K1;break;case"P256PublicKeyHash":e=Ie.P256;break;default:throw new Error(`unexpected address type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.hash))}function Zu(r,t){if(r.type==="ContractHash"?(t.writeUint8(sr.Originated),t.writeBytes(Array.from(r.hash)),t.writeUint8(0)):(t.writeUint8(sr.Implicit),po(r,t)),r.entryPoint!==void 0&&r.entryPoint!==""&&r.entryPoint!=="default"){const i=new TextEncoder().encode(r.entryPoint);t.writeBytes(Array.from(i))}}var xe;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(xe||(xe={}));function Xu(r){let t,e;const i=r.readUint8();switch(i){case xe.ED25519:e="ED25519PublicKey",t=32;break;case xe.SECP256K1:e="SECP256K1PublicKey",t=33;break;case xe.P256:e="P256PublicKey",t=33;break;default:throw new Error(`unknown public key tag: ${i}`)}return{type:e,publicKey:r.readBytes(t)}}function Qu(r,t){let e;switch(r.type){case"ED25519PublicKey":e=xe.ED25519;break;case"SECP256K1PublicKey":e=xe.SECP256K1;break;case"P256PublicKey":e=xe.P256;break;default:throw new Error(`unexpected public key type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.publicKey))}function jr(r,t,e){var i,n;const[s,o]=e(r);if(Array.isArray(s)){const h=new Qe;for(const p of s){const m=o.next();if(m.done)throw new Error("REPORT ME: iterator is done");jr(p,h,m.value)}t.writeUint8(ve.Sequence),t.writeUint32(h.length),t.writeBytes(h.buffer);return}if("string"in s){const p=new TextEncoder().encode(s.string);t.writeUint8(ve.String),t.writeUint32(p.length),t.writeBytes(Array.from(p));return}if("int"in s){t.writeUint8(ve.Int);let h=BigInt(s.int);const p=h<0;p&&(h=-h);let m=0;do{const E=BigInt(m===0?6:7);let S=h&(BigInt(1)<<E)-BigInt(1);h>>=E,h&&(S|=BigInt(128)),m===0&&p&&(S|=BigInt(64)),t.writeUint8(Number(S)),m++}while(h);return}if("bytes"in s){const h=Ku(s.bytes);t.writeUint8(ve.Bytes),t.writeUint32(h.length),t.writeBytes(h);return}const a=Ju[s.prim];if(a===void 0)throw new TypeError(`Can't encode primary: ${s.prim}`);const c=(((i=s.args)===null||i===void 0?void 0:i.length)||0)<3?ve.Prim0+(((n=s.args)===null||n===void 0?void 0:n.length)||0)*2+(s.annots===void 0||s.annots.length===0?0:1):ve.Prim;if(t.writeUint8(c),t.writeUint8(a),s.args!==void 0)if(s.args.length<3)for(const h of s.args){const p=o.next();if(p.done)throw new Error("REPORT ME: iterator is done");jr(h,t,p.value)}else{const h=new Qe;for(const p of s.args){const m=o.next();if(m.done)throw new Error("REPORT ME: iterator is done");jr(p,h,m.value)}t.writeUint32(h.length),t.writeBytes(h.buffer)}if(s.annots!==void 0&&s.annots.length!==0){const p=new TextEncoder().encode(s.annots.join(" "));t.writeUint32(p.length),t.writeBytes(Array.from(p))}else s.args!==void 0&&s.args.length>=3&&t.writeUint32(0)}const th=r=>"prim"in r&&(r.prim==="Left"||r.prim==="Right"),eh=r=>"prim"in r&&(r.prim==="Some"||r.prim==="None"),Ve=r=>{if(de(r))return t=>{if(!eo(t))throw new O(r,t,`pair expected: ${JSON.stringify(t)}`);Li(t);const e=yt("pair",r);return[yt("Pair",t),function*(){for(const n of e.args)yield Ve(n)}()]};switch(r.prim){case"or":return t=>{if(!th(t))throw new O(r,t,`or expected: ${JSON.stringify(t)}`);return[t,function*(){yield Ve(r.args[t.prim==="Left"?0:1])}()]};case"option":return t=>{if(!eh(t))throw new O(r,t,`option expected: ${JSON.stringify(t)}`);return[t,function*(){t.prim==="Some"&&(yield Ve(r.args[0]))}()]};case"list":case"set":return t=>{if(!Array.isArray(t))throw new O(r,t,`${r.prim} expected: ${JSON.stringify(t)}`);return[t,function*(){for(const e of t)yield Ve(r.args[0])}()]};case"map":return t=>{if(!Array.isArray(t))throw new O(r,t,`map expected: ${JSON.stringify(t)}`);return[t,function*(){for(const e of t)yield i=>{if(!("prim"in i)||i.prim!=="Elt")throw new O(r,i,`map element expected: ${JSON.stringify(i)}`);return[i,function*(){for(const n of r.args)yield Ve(n)}()]}}()]};case"chain_id":return t=>{if(!("bytes"in t)&&!("string"in t))throw new O(r,t,`chain id expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=pe(t.string,"ChainID");if(i===null)throw new O(r,t,`chain id base58 expected: ${t.string}`);e={bytes:We(i[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"signature":return t=>{if(!("bytes"in t)&&!("string"in t))throw new O(r,t,`signature expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=pe(t.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature");if(i===null)throw new O(r,t,`signature base58 expected: ${t.string}`);e={bytes:We(i[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"key_hash":return t=>{if(!("bytes"in t)&&!("string"in t))throw new O(r,t,`key hash expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=pe(t.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash");if(i===null)throw new O(r,t,`key hash base58 expected: ${t.string}`);const n=new Qe;po({type:i[0],hash:i[1]},n),e={bytes:We(n.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"key":return t=>{if(!("bytes"in t)&&!("string"in t))throw new O(r,t,`public key expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=pe(t.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey");if(i===null)throw new O(r,t,`public key base58 expected: ${t.string}`);const n=new Qe;Qu({type:i[0],publicKey:i[1]},n),e={bytes:We(n.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"address":return t=>{if(!("bytes"in t)&&!("string"in t))throw new O(r,t,`address expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=t.string.split("%"),n=pe(i[0],"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash");if(n===null)throw new O(r,t,`address base58 expected: ${t.string}`);const s=new Qe;Zu({type:n[0],hash:n[1],entryPoint:i.length>1?i[1]:void 0},s),e={bytes:We(s.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"timestamp":return t=>{if(!("string"in t)&&!("int"in t))throw new O(r,t,`timestamp expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=ro(t);if(i===null)throw new O(r,t,`can't parse date: ${t.string}`);e={int:String(Math.floor(i.getTime()/1e3))}}else e=t;return[e,[][Symbol.iterator]()]};default:return zr}},rh=r=>"prim"in r&&r.prim==="PUSH",zr=r=>rh(r)?(Rt(r),[r,function*(){yield zr,yield Ve(r.args[0])}()]):[r,function*(){for(;;)yield zr}()];function ih(r,t){const e=new Qe;return e.writeUint8(5),jr(r,e,t!==void 0?Ve(t):zr),e.buffer}function nh(r,t){return{bytes:We(ih(r,t))}}function sh(r){const t=Xe(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new nr(new Uint8Array(t));return Yu(e)}function oh(r){const t=Xe(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new nr(new Uint8Array(t));return lo(e)}function ah(r){const t=Xe(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new nr(new Uint8Array(t));return Xu(e)}class C extends wt{constructor(t,e,i){super(t,i),this.stackState=e,Object.setPrototypeOf(this,C.prototype)}}function K(r){return Array.isArray(r)?"pair":r.prim}function Wr(r){return"prim"in r?r.args:r}function It(r,t,e=!1){if(K(r)!==K(t))throw new O(r,void 0,`types mismatch: ${K(r)} != ${K(t)}`);const i=[rr(r),rr(t)];if(i[0].t&&i[1].t&&i[0].t[0]!==i[1].t[0])throw new O(r,void 0,`${K(r)}: type names mismatch: ${i[0].t[0]} != ${i[1].t[0]}`);if(e&&i[0].f&&i[1].f&&i[0].f[0]!==i[1].f[0])throw new O(r,void 0,`${K(r)}: field names mismatch: ${i[0].f[0]} != ${i[1].f}`);if(de(r)){const n=yt("pair",r),s=yt("pair",t);It(n.args[0],s.args[0],!0),It(n.args[1],s.args[1],!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":case"ticket":It(r.args[0],t.args[0]);break;case"or":It(r.args[0],t.args[0],!0),It(r.args[1],t.args[1],!0);break;case"lambda":case"map":case"big_map":It(r.args[0],t.args[0]),It(r.args[1],t.args[1]);break;case"sapling_state":case"sapling_transaction":if(parseInt(r.args[0].int,10)!==parseInt(t.args[0].int,10))throw new O(r,void 0,`${K(r)}: type argument mismatch: ${r.args[0].int} != ${t.args[0].int}`)}}function fo(r,t){if(r.length!==t.length)throw new O(r,void 0,`stack length mismatch: ${r.length} != ${t.length}`);for(let e=0;e<r.length;e++)It(r[e],t[e])}function J(r,t=!1){var e,i,n;if(!Array.isArray(r)){const s=rr(r);if((((e=s.t)===null||e===void 0?void 0:e.length)||0)>1)throw new O(r,void 0,`${r.prim}: at most one type annotation allowed: ${r.annots}`);if(t){if((((i=s.f)===null||i===void 0?void 0:i.length)||0)>1)throw new O(r,void 0,`${r.prim}: at most one field annotation allowed: ${r.annots}`)}else if((((n=s.f)===null||n===void 0?void 0:n.length)||0)>0)throw new O(r,void 0,`${r.prim}: field annotations aren't allowed: ${r.annots}`)}if(de(r)){const s=Wr(r);for(const o of s)J(o,!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":J(r.args[0]);break;case"or":for(const s of r.args)J(s,!0);break;case"lambda":case"map":case"big_map":J(r.args[0]),J(r.args[1])}}function go(r){if(!Array.isArray(r))return!1;for(const t of r)if(!(Array.isArray(t)&&go(t)||"prim"in t&&ho(t)))return!1;return!0}function Tt(r,t,e){if(de(t)){if(eo(r)){Li(r);const i=yt("Pair",r),n=yt("pair",t);Tt(i.args[0],n.args[0],e),Tt(i.args[1],n.args[1],e);return}throw new O(t,r,`pair expected: ${JSON.stringify(r)}`)}switch(t.prim){case"int":if("int"in r&&Ni(r.int))return;throw new O(t,r,`integer value expected: ${JSON.stringify(r)}`);case"nat":case"mutez":if("int"in r&&to(r.int))return;throw new O(t,r,`natural value expected: ${JSON.stringify(r)}`);case"string":if("string"in r)return;throw new O(t,r,`string value expected: ${JSON.stringify(r)}`);case"bytes":case"bls12_381_g1":case"bls12_381_g2":if("bytes"in r&&Xe(r.bytes)!==null)return;throw new O(t,r,`bytes value expected: ${JSON.stringify(r)}`);case"bool":if("prim"in r&&(r.prim==="True"||r.prim==="False"))return;throw new O(t,r,`boolean value expected: ${JSON.stringify(r)}`);case"key_hash":if("string"in r&&pe(r.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash")!==null)return;if("bytes"in r)try{oh(r);return}catch{}throw new O(t,r,`key hash expected: ${JSON.stringify(r)}`);case"timestamp":if(("string"in r||"int"in r)&&ro(r)!==null)return;throw new O(t,r,`timestamp expected: ${JSON.stringify(r)}`);case"address":if("string"in r){let i=r.string;const n=r.string.indexOf("%");if(n>=0&&(i=r.string.slice(0,n)),pe(i,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash","TxRollupL2Address","RollupAddress")!==null)return}else if("bytes"in r)try{sh(r);return}catch{}throw new O(t,r,`address expected: ${JSON.stringify(r)}`);case"key":if("string"in r&&pe(r.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey")!==null)return;if("bytes"in r)try{ah(r);return}catch{}throw new O(t,r,`public key expected: ${JSON.stringify(r)}`);case"unit":if("prim"in r&&r.prim==="Unit")return;throw new O(t,r,`unit value expected: ${JSON.stringify(r)}`);case"signature":if("bytes"in r||"string"in r&&pe(r.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature")!==null)return;throw new O(t,r,`signature expected: ${JSON.stringify(r)}`);case"chain_id":if(("bytes"in r||"string"in r)&&("string"in r?Xs(r.string):Xe(r.bytes))!==null)return;throw new O(t,r,`chain id expected: ${JSON.stringify(r)}`);case"option":if("prim"in r){if(r.prim==="None")return;if(r.prim==="Some"){Tt(r.args[0],t.args[0],e);return}}throw new O(t,r,`option expected: ${JSON.stringify(r)}`);case"list":case"set":if(Li(r)){for(const i of r)Tt(i,t.args[0],e);return}throw new O(t,r,`${t.prim} expected: ${JSON.stringify(r)}`);case"or":if("prim"in r){if(r.prim==="Left"){Tt(r.args[0],t.args[0],e);return}else if(r.prim==="Right"){Tt(r.args[0],t.args[1],e);return}}throw new O(t,r,`union (or) expected: ${JSON.stringify(r)}`);case"lambda":if(go(r)){const i=rt(r,[t.args[0]],e);if("failed"in i)throw new O(t,r,`function is failed with error type: ${i.failed}`);if(i.length!==1)throw new O(t,r,"function must return a value");It(t.args[1],i[0]);return}throw new O(t,r,`function expected: ${JSON.stringify(r)}`);case"map":case"big_map":if(Array.isArray(r)){for(const i of r){if(!("prim"in i)||i.prim!=="Elt")throw new O(t,r,`map elements expected: ${JSON.stringify(r)}`);Tt(i.args[0],t.args[0],e),Tt(i.args[1],t.args[1],e)}return}throw new O(t,r,`${t.prim} expected: ${JSON.stringify(r)}`);case"bls12_381_fr":if("int"in r&&Ni(r.int)||"bytes"in r&&Xe(r.bytes)!==null)return;throw new O(t,r,`BLS12-381 element expected: ${JSON.stringify(r)}`);case"sapling_state":if(Array.isArray(r))return;throw new O(t,r,`sapling state expected: ${JSON.stringify(r)}`);case"ticket":Tt(r,{prim:"pair",args:[{prim:"address"},t.args[0],{prim:"nat"}]},e);return;default:throw new O(t,r,`type ${K(t)} don't have Michelson literal representation`)}}function ch(r,t,e){let i=t,n=t,s=0;for(const o of r){const a=rt(o,n,e);if(i=a,"failed"in a)break;n=a,s++}if("failed"in i&&i.level==0&&(!("prim"in i.failed)||i.failed.prim!=="never")&&s!==r.length-1)throw new C(r,i,"FAIL must appear in a tail position");if((e==null?void 0:e.traceCallback)!==void 0){const o={op:r,in:t,out:i};e.traceCallback(o)}return"failed"in i?{failed:i.failed,level:i.level+1}:i}function rt(r,t,e){const i=(e==null?void 0:e.protocol)||Zs;if(Array.isArray(r))return ch(r,t,e);const n=r;function s(l,...P){if(t.length<P.length+l)throw new C(n,t,`${n.prim}: stack must have at least ${P.length} element(s)`);let R=l;for(const j of P){if(j!==null&&j.length!==0){let U=0;for(;U<j.length&&j[U]!==K(t[R]);)U++;if(U===j.length)throw new C(n,t,`${n.prim}: stack type mismatch: [${R}] expected to be ${j}, got ${K(t[R])} instead`)}R++}return t.slice(l,P.length+l)}function o(l){return(...P)=>{try{return l(...P)}catch(R){throw R instanceof wt?new C(n,t,R.message):R}}}function a(l){return P=>{try{return l(P)}catch(R){throw R instanceof wt?new C(n,t,R.message):R}}}const c=o(rr),h=o(fo),p=o(It),m=a(ye),E=a(tn),S=a(en),M=a(ir),W=a(hi);function x(l,P){const R=c(n,Object.assign(Object.assign({},P),{emptyFields:l.f!==void 0&&l.f>1,emptyVar:l.v!==void 0&&l.v>1})),j=(U,ot,u)=>{if(U&&U.length>(ot||0))throw new C(n,t,`${n.prim}: at most ${ot||0} ${u} annotations allowed`)};return j(R.f,l.f,"field"),j(R.t,l.t,"type"),j(R.v,l.v,"variable"),R}function A(l,P){const R=l,j=Array.isArray(R)?{prim:"pair",args:R}:R,U=c(j),ot=P.v!==void 0||P.t!==void 0||P.f!==void 0?[...(P.v===null?U.v:P.v)||[],...(P.t===null?U.t:P.t)||[],...(P.f===null?U.f:P.f)||[]]:void 0,u=Wu(j,["annots"]);return Object.assign(Object.assign({},u),ot&&ot.length!==0&&{annots:ot})}function y(l,P){const R=x({v:1});return A(l,{v:R.v!==void 0?R.v:P!==void 0?[P]:null,t:null})}function F(l,P,R,j,U){var ot,u,g,v;const _=(ot=c(P).f)===null||ot===void 0?void 0:ot[0],gt=(u=R.f)===null||u===void 0?void 0:u[j];if(gt!==void 0&&gt!=="%"&&_!==void 0&&gt!==_)throw new C(n,t,`${n.prim}: field names doesn't match: ${gt} !== ${_}`);const ut=(g=R.v)===null||g===void 0?void 0:g[j],Ot=(v=c(l).v)===null||v===void 0?void 0:v[0];return A(P,{t:null,v:ut?ut==="@%"?_?["@"+_.slice(1)]:void 0:ut==="@%%"?Ot?["@"+Ot.slice(1)+"."+(_?_.slice(1):U)]:_?["@"+_.slice(1)]:void 0:[ut]:null})}function hr(l,P,R=P){const j=yt("pair",l);if(R===1)return[j.args[0]];if(R===2)return j.args;const U=j.args[1];if(de(U))return[j.args[0],...hr(U,P,R-1)];throw new C(n,t,`${n.prim}: at least ${P} fields are expected`)}function Sn(l,P,R=P){if(R===0)return l;const j=yt("pair",l);if(R===1)return j.args[0];const U=j.args[1];if(de(U))return Sn(U,P,R-2);if(R===2)return U;throw new C(n,t,`${n.prim}: at least ${P+1} fields are expected`)}function _n(l,P,R,j=R){if(j===0)return P;const U=yt("pair",l);if(j===1)return Object.assign(Object.assign({},U),{args:[P,U.args[1]]});const ot=U.args[1];if(de(ot))return Object.assign(Object.assign({},U),{args:[U.args[0],_n(ot,P,R,j-2)]});if(j===2)return Object.assign(Object.assign({},U),{args:[U.args[0],P]});throw new C(n,t,`${n.prim}: at least ${R+1} fields are expected`)}const Dt=(l,P)=>["@"+(l.v?l.v[0].slice(1)+".":"")+P];function Tr(l,P){return"failed"in l||"failed"in P?"failed"in l?P:l:(h(l,P),l)}const An=(l=>{var P,R,j,U,ot;switch(l.prim){case"DUP":{const u=l.args?parseInt(l.args[0].int,10):1;if(u===0)throw new C(l,t,"DUP 0 is forbidden");const g=s(u-1,null)[0];if(K(g)==="ticket")throw new C(l,t,"ticket can't be DUPed");return[g,...t]}case"SWAP":{const u=s(0,null,null);return x({}),[u[1],u[0],...t.slice(2)]}case"SOME":return[A({prim:"option",args:[s(0,null)[0]]},x({t:1,v:1})),...t.slice(1)];case"UNIT":return[A({prim:"unit"},x({v:1,t:1})),...t];case"PAIR":{const u=l.args?parseInt(l.args[0].int,10):2;if(u<2)throw new C(l,t,`PAIR ${u} is forbidden`);const g=s(0,...new Array(u).fill(null)),v=x({f:u,t:1,v:1},{specialFields:!0}),_=ut=>{const Ot=ut.lastIndexOf(".");return ut.slice(Ot>0?Ot+1:1)},gt=g.map((ut,Ot)=>{var di;const On=c(ut),Fo=v.f&&v.f.length>Ot&&v.f[Ot]!=="%"?v.f[Ot]==="%@"?On.v?["%"+_(((di=On.v)===null||di===void 0?void 0:di[0])||"")]:void 0:[v.f[Ot]]:void 0;return A(ut,{v:null,t:null,f:Fo})});return[A({prim:"pair",args:gt},{t:v.t,v:v.v}),...t.slice(u)]}case"UNPAIR":{const u=l.args?parseInt(l.args[0].int,10):2;if(u<2)throw new C(l,t,`UNPAIR ${u} is forbidden`);const g=s(0,["pair"])[0],v=x({f:2,v:2},{specialVar:!0});return[...hr(g,u).map((gt,ut)=>F(g,gt,v,ut,ut===0?"car":"cdr")),...t.slice(1)]}case"CAR":case"CDR":{const u=yt("pair",s(0,["pair"])[0]),g=u.args[l.prim==="CAR"?0:1],v=x({f:1,v:1},{specialVar:!0});return[F(u,g,v,0,l.prim.toLocaleLowerCase()),...t.slice(1)]}case"CONS":{const u=s(0,null,["list"]);return p(u[0],u[1].args[0]),[y({prim:"list",args:[u[1].args[0]]}),...t.slice(2)]}case"SIZE":return s(0,["string","list","set","map","bytes"]),[y({prim:"nat"}),...t.slice(1)];case"MEM":{const u=s(0,null,["set","map","big_map"]);return m(u[0]),p(u[0],u[1].args[0]),[y({prim:"bool"}),...t.slice(2)]}case"GET":if(l.args){const u=parseInt(l.args[0].int,10),g=s(0,["pair"])[0];return[y(Sn(g,u)),...t.slice(1)]}else{const u=s(0,null,["map","big_map"]);return m(u[0]),p(u[0],u[1].args[0]),[y({prim:"option",args:[u[1].args[1]]}),...t.slice(2)]}case"UPDATE":if(l.args){const u=parseInt(l.args[0].int,10),g=s(0,null,["pair"]);return[y(_n(g[1],g[0],u)),...t.slice(2)]}else{const u=s(0,null,["bool","option"]);if(m(u[0]),u[1].prim==="bool"){const v=s(2,["set"]);return p(u[0],v[0].args[0]),[y({prim:"set",args:[A(u[0],{t:null})]}),...t.slice(3)]}const g=s(2,["map","big_map"]);return p(u[0],g[0].args[0]),g[0].prim==="map"?[y({prim:"map",args:[A(u[0],{t:null}),A(u[1].args[0],{t:null})]}),...t.slice(3)]:(W(u[1].args[0]),[y({prim:"big_map",args:[A(u[0],{t:null}),A(u[1].args[0],{t:null})]}),...t.slice(3)])}case"GET_AND_UPDATE":{const u=x({v:2}),g=s(0,null,["option"],["map","big_map"]);m(g[0]),p(g[0],g[2].args[0]),p(g[1].args[0],g[2].args[1]);const v=(P=u.v)===null||P===void 0?void 0:P.map(_=>_!=="@"?[_]:void 0);return g[2].prim==="map"?[A({prim:"option",args:[g[2].args[1]]},{v:v==null?void 0:v[0]}),A({prim:"map",args:[A(g[0],{t:null}),A(g[1].args[0],{t:null})]},{v:v==null?void 0:v[1]}),...t.slice(3)]:(W(g[1].args[0]),[A({prim:"option",args:[g[2].args[1]]},{v:v==null?void 0:v[0]}),A({prim:"big_map",args:[A(g[0],{t:null}),A(g[1].args[0],{t:null})]},{v:v==null?void 0:v[1]}),...t.slice(3)])}case"EXEC":{const u=s(0,null,["lambda"]);return p(u[0],u[1].args[0]),[y(u[1].args[1]),...t.slice(2)]}case"APPLY":{const u=s(0,null,["lambda"]);if(S(u[0]),M(u[0]),!de(u[1].args[0]))throw new C(l,t,`${l.prim}: function's argument must be a pair: ${K(u[1].args[0])}`);const g=u[1].args[0];return p(u[0],Wr(g)[0]),[y({prim:"lambda",args:[Wr(g)[1],u[1].args[1]]}),...t.slice(2)]}case"FAILWITH":{const u=s(0,null)[0];return dr(i,Re.PtEdo2Zk)||E(u),{failed:u,level:0}}case"NEVER":return s(0,["never"]),{failed:{prim:"never"},level:0};case"RENAME":return[y(s(0,null)[0]),...t.slice(1)];case"CONCAT":{const u=s(0,["string","list","bytes"]);if(u[0].prim==="list"){if(K(u[0].args[0])!=="string"&&K(u[0].args[0])!=="bytes")throw new C(l,t,`${l.prim}: can't concatenate list of ${K(u[0].args[0])}'s`);return[y(u[0].args[0]),...t.slice(1)]}const g=s(1,["string","bytes"]);if(u[0].prim!==g[0].prim)throw new C(l,t,`${l.prim}: can't concatenate ${u[0].prim} with ${g[0].prim}`);return[y(g[0]),...t.slice(2)]}case"SLICE":return[y({prim:"option",args:[s(0,["nat"],["nat"],["string","bytes"])[2]]},"@slice"),...t.slice(3)];case"PACK":{const u=s(0,null)[0];return E(u),[y({prim:"bytes"},"@packed"),...t.slice(1)]}case"ADD":{const u=s(0,["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(u[0].prim==="nat"&&u[1].prim==="int"||u[0].prim==="int"&&u[1].prim==="nat")return[y({prim:"int"}),...t.slice(2)];if(u[0].prim==="int"&&u[1].prim==="timestamp"||u[0].prim==="timestamp"&&u[1].prim==="int")return[y({prim:"timestamp"}),...t.slice(2)];if((u[0].prim==="int"||u[0].prim==="nat"||u[0].prim==="mutez"||u[0].prim==="bls12_381_g1"||u[0].prim==="bls12_381_g2"||u[0].prim==="bls12_381_fr")&&u[0].prim===u[1].prim)return[y(u[0]),...t.slice(2)];throw new C(l,t,`${l.prim}: can't add ${u[0].prim} to ${u[1].prim}`)}case"SUB":{const u=dr(i,Re.PsiThaCa)?s(0,["nat","int","timestamp","mutez"],["nat","int","timestamp","mutez"]):s(0,["nat","int","timestamp"],["nat","int","timestamp"]);if((u[0].prim==="nat"||u[0].prim==="int")&&(u[1].prim==="nat"||u[1].prim==="int")||u[0].prim==="timestamp"&&u[1].prim==="timestamp")return[y({prim:"int"}),...t.slice(2)];if(u[0].prim==="timestamp"&&u[1].prim==="int")return[y({prim:"timestamp"}),...t.slice(2)];if(u[0].prim==="mutez"&&u[1].prim==="mutez")return[y({prim:"mutez"}),...t.slice(2)];throw new C(l,t,`${l.prim}: can't subtract ${u[0].prim} from ${u[1].prim}`)}case"SUB_MUTEZ":return s(0,["mutez"],["mutez"]),[y({prim:"option",args:[{prim:"mutez"}]}),...t.slice(2)];case"MUL":{const u=s(0,["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(u[0].prim==="nat"&&u[1].prim==="int"||u[0].prim==="int"&&u[1].prim==="nat")return[y({prim:"int"}),...t.slice(2)];if(u[0].prim==="nat"&&u[1].prim==="mutez"||u[0].prim==="mutez"&&u[1].prim==="nat")return[y({prim:"mutez"}),...t.slice(2)];if((u[0].prim==="bls12_381_g1"||u[0].prim==="bls12_381_g2"||u[0].prim==="bls12_381_fr")&&u[1].prim==="bls12_381_fr"||(u[0].prim==="nat"||u[0].prim==="int")&&u[0].prim===u[1].prim)return[y(u[0]),...t.slice(2)];if((u[0].prim==="nat"||u[0].prim==="int")&&u[1].prim==="bls12_381_fr"||(u[1].prim==="nat"||u[1].prim==="int")&&u[0].prim==="bls12_381_fr")return[y({prim:"bls12_381_fr"}),...t.slice(2)];throw new C(l,t,`${l.prim}: can't multiply ${u[0].prim} by ${u[1].prim}`)}case"EDIV":{const u=(v,_)=>({prim:"option",args:[{prim:"pair",args:[{prim:v},{prim:_}]}]}),g=s(0,["nat","int","mutez"],["nat","int","mutez"]);if(g[0].prim==="nat"&&g[1].prim==="nat")return[y(u("nat","nat")),...t.slice(2)];if((g[0].prim==="nat"||g[0].prim==="int")&&(g[1].prim==="nat"||g[1].prim==="int"))return[y(u("int","nat")),...t.slice(2)];if(g[0].prim==="mutez"&&g[1].prim==="nat")return[y(u("mutez","mutez")),...t.slice(2)];if(g[0].prim==="mutez"&&g[1].prim==="mutez")return[y(u("nat","mutez")),...t.slice(2)];throw new C(l,t,`${l.prim}: can't euclideally divide ${g[0].prim} by ${g[1].prim}`)}case"ABS":return s(0,["int"]),[y({prim:"nat"}),...t.slice(1)];case"ISNAT":return s(0,["int"]),[y({prim:"option",args:[{prim:"nat"}]}),...t.slice(1)];case"INT":return s(0,["nat","bls12_381_fr"]),[y({prim:"int"}),...t.slice(1)];case"NEG":{const u=s(0,["nat","int","bls12_381_g1","bls12_381_g2","bls12_381_fr"])[0];return u.prim==="nat"||u.prim==="int"?[y({prim:"int"}),...t.slice(1)]:[y(u),...t.slice(1)]}case"LSL":case"LSR":return s(0,["nat"],["nat"]),[y({prim:"nat"}),...t.slice(2)];case"OR":case"XOR":{const u=s(0,["nat","bool"],["nat","bool"]);if(u[0].prim!==u[1].prim)throw new C(l,t,`${l.prim}: both arguments must be of the same type: ${u[0].prim}, ${u[1].prim}`);return[y(u[1]),...t.slice(2)]}case"AND":{const u=s(0,["nat","bool","int"],["nat","bool"]);if((u[0].prim!=="int"||u[1].prim!=="nat")&&u[0].prim!==u[1].prim)throw new C(l,t,`${l.prim}: both arguments must be of the same type: ${u[0].prim}, ${u[1].prim}`);return[y(u[1]),...t.slice(2)]}case"NOT":return s(0,["nat","bool","int"])[0].prim==="bool"?[y({prim:"bool"}),...t.slice(1)]:[y({prim:"int"}),...t.slice(1)];case"COMPARE":{const u=s(0,null,null);return m(u[0]),m(u[1]),[y({prim:"int"}),...t.slice(2)]}case"EQ":case"NEQ":case"LT":case"GT":case"LE":case"GE":return s(0,["int"]),[y({prim:"bool"}),...t.slice(1)];case"SELF":{if((e==null?void 0:e.contract)===void 0)throw new C(l,t,`${l.prim}: contract required`);const u=x({f:1,v:1}),g=Ci(e.contract,(R=u.f)===null||R===void 0?void 0:R[0]);if(g===null)throw new C(l,t,`${l.prim}: contract has no entrypoint ${g}`);return[A({prim:"contract",args:[g]},{v:u.v?u.v:["@self"]}),...t]}case"TRANSFER_TOKENS":{const u=s(0,null,["mutez"],["contract"]);return p(u[0],u[2].args[0]),[y({prim:"operation"}),...t.slice(3)]}case"SET_DELEGATE":{const u=s(0,["option"])[0];if(K(u.args[0])!=="key_hash")throw new C(l,t,`${l.prim}: key hash expected: ${K(u.args[0])}`);return[y({prim:"operation"}),...t.slice(1)]}case"IMPLICIT_ACCOUNT":return s(0,["key_hash"]),[y({prim:"contract",args:[{prim:"unit"}]}),...t.slice(1)];case"NOW":return[y({prim:"timestamp"},"@now"),...t];case"AMOUNT":return[y({prim:"mutez"},"@amount"),...t];case"BALANCE":return[y({prim:"mutez"},"@balance"),...t];case"CHECK_SIGNATURE":return s(0,["key"],["signature"],["bytes"]),[y({prim:"bool"}),...t.slice(3)];case"BLAKE2B":case"SHA256":case"SHA512":case"KECCAK":case"SHA3":return s(0,["bytes"]),[y({prim:"bytes"}),...t.slice(1)];case"HASH_KEY":return s(0,["key"]),[y({prim:"key_hash"}),...t.slice(1)];case"SOURCE":return[y({prim:"address"},"@source"),...t];case"SENDER":return[y({prim:"address"},"@sender"),...t];case"ADDRESS":{const u=s(0,["contract"])[0],g=x({v:1});return[A({prim:"address",[Nr]:u},{v:g.v?g.v:Dt(c(u),"address")}),...t.slice(1)]}case"SELF_ADDRESS":{const u={prim:"address"};return(e==null?void 0:e.contract)!==void 0&&(u[Nr]={prim:"contract",args:[Zt(e.contract,"parameter").args[0]]}),[y(u,"@address"),...t]}case"CHAIN_ID":return[y({prim:"chain_id"}),...t];case"DROP":{x({});const u=l.args!==void 0?parseInt(l.args[0].int,10):1;return s(u-1,null),t.slice(u)}case"DIG":{x({});const u=parseInt(l.args[0].int,10);return[s(u,null)[0],...t.slice(0,u),...t.slice(u+1)]}case"DUG":{x({});const u=parseInt(l.args[0].int,10);return[...t.slice(1,u+1),s(0,null)[0],...t.slice(u+1)]}case"NONE":return J(l.args[0]),[A({prim:"option",args:[l.args[0]]},x({t:1,v:1})),...t];case"LEFT":case"RIGHT":{const u=s(0,null)[0],g=x({f:2,t:1,v:1},{specialFields:!0}),v=c(u),_=[A(u,{t:null,v:null,f:g.f&&g.f.length>0&&g.f[0]!=="%"?g.f[0]==="%@"?v.v?["%"+v.v[0].slice(1)]:void 0:g.f:void 0}),A(l.args[0],{t:null,f:g.f&&g.f.length>1&&g.f[1]!=="%"?g.f:void 0})];return[A({prim:"or",args:l.prim==="LEFT"?_:[_[1],_[0]]},{t:g.t,v:g.v}),...t.slice(1)]}case"NIL":return J(l.args[0]),[A({prim:"list",args:[l.args[0]]},x({t:1,v:1})),...t];case"UNPACK":return s(0,["bytes"]),J(l.args[0]),[y({prim:"option",args:[l.args[0]]},"@unpacked"),...t.slice(1)];case"CONTRACT":{const u=s(0,["address"])[0];J(l.args[0]);const g=x({v:1,f:1}),v=u[Nr];if(v!==void 0){const _=Ci(v,(j=g.f)===null||j===void 0?void 0:j[0]);if(_===null)throw new C(l,t,`${l.prim}: contract has no entrypoint ${_}`);p(_,l.args[0])}return[A({prim:"option",args:[{prim:"contract",args:[l.args[0]]}]},{v:g.v?g.v:Dt(c(u),"contract")}),...t.slice(1)]}case"CAST":{x({});const u=s(0,null)[0];return J(l.args[0]),p(l.args[0],u),[l.args[0],...t.slice(1)]}case"IF_NONE":{x({});const u=s(0,["option"])[0],g=t.slice(1),v=rt(l.args[0],g,e),_=rt(l.args[1],[A(u.args[0],{t:null,v:Dt(c(u),"some")}),...g],e);return Tr(v,_)}case"IF_LEFT":{x({});const u=s(0,["or"])[0],g=c(u),v=c(u.args[0]),_=c(u.args[1]),gt=t.slice(1),ut=rt(l.args[0],[A(u.args[0],{t:null,v:Dt(g,v.f?v.f[0].slice(1):"left")}),...gt],e),Ot=rt(l.args[1],[A(u.args[1],{t:null,v:Dt(g,_.f?_.f[0].slice(1):"right")}),...gt],e);return Tr(ut,Ot)}case"IF_CONS":{x({});const u=s(0,["list"])[0],g=c(u),v=t.slice(1),_=rt(l.args[0],[A(u.args[0],{t:null,v:Dt(g,"hd")}),A(u,{t:null,v:Dt(g,"tl")}),...v],e),gt=rt(l.args[1],v,e);return Tr(_,gt)}case"IF":{x({}),s(0,["bool"]);const u=t.slice(1),g=rt(l.args[0],u,e),v=rt(l.args[1],u,e);return Tr(g,v)}case"MAP":{const u=s(0,["list","map","option"])[0],g=t.slice(1),v=u.prim==="map"?{prim:"pair",args:u.args}:u.args[0],_=rt(l.args[0],[A(v,{t:null,v:Dt(c(u),"elt")}),...g],e);if("failed"in _){if(!("prim"in _.failed)||_.failed.prim!=="never")throw new C(l,t,`${l.prim}: FAIL is not allowed in MAP`);return{failed:_.failed,level:_.level+1}}if(_.length<1)throw new C(l,t,`${l.prim}: function must return a value`);return h(_.slice(1),g),u.prim==="list"?[y({prim:"list",args:[_[0]]}),...g]:u.prim==="map"?[y({prim:"map",args:[u.args[0],_[0]]}),...g]:[y({prim:"option",args:[_[0]]}),...g]}case"ITER":{x({});const u=s(0,["set","list","map"])[0],g=t.slice(1),v=u.prim==="map"?{prim:"pair",args:u.args}:u.args[0],_=rt(l.args[0],[A(v,{t:null,v:Dt(c(u),"elt")}),...g],e);return"failed"in _?{failed:_.failed,level:_.level+1}:(h(_,g),g)}case"LOOP":{x({}),s(0,["bool"]);const u=t.slice(1),g=rt(l.args[0],u,e);return"failed"in g?{failed:g.failed,level:g.level+1}:(h(g,[{prim:"bool"},...u]),u)}case"LOOP_LEFT":{x({});const u=s(0,["or"])[0],g=t.slice(1),v=rt(l.args[0],[A(u.args[0],{t:null,v:Dt(c(u),"left")}),...g],e);return"failed"in v?{failed:v.failed,level:v.level+1}:(h(v,[u,...g]),[A(u.args[1],{t:null,v:x({v:1}).v}),...g])}case"DIP":{x({});const u=l.args.length===2?parseInt(l.args[0].int,10):1;s(u-1,null);const g=t.slice(0,u),v=t.slice(u),_=l.args.length===2?rt(l.args[1],v,e):rt(l.args[0],v,e);return"failed"in _?{failed:_.failed,level:_.level+1}:[...g,..._]}case"CREATE_CONTRACT":{const u=x({v:2}),g=s(0,["option"],["mutez"],null);if(K(g[0].args[0])!=="key_hash")throw new C(l,t,`${l.prim}: key hash expected: ${K(g[0].args[0])}`);S(g[2])&&(yo(l.args[0]),It(Zt(l.args[0],"storage").args[0],g[2]));const v=(U=u.v)===null||U===void 0?void 0:U.map(_=>_!=="@"?[_]:void 0);return[A({prim:"operation"},{v:v==null?void 0:v[0]}),A({prim:"address",[Nr]:{prim:"contract",args:[Zt(l.args[0],"parameter").args[0]]}},{v:v==null?void 0:v[1]}),...t.slice(3)]}case"PUSH":return J(l.args[0]),Tt(l.args[1],l.args[0],Object.assign(Object.assign({},e),{contract:void 0})),[y(l.args[0]),...t];case"EMPTY_SET":return J(l.args[0]),m(l.args[0]),[A({prim:"set",args:l.args},x({t:1,v:1})),...t];case"EMPTY_MAP":return J(l.args[0]),m(l.args[0]),J(l.args[1]),[A({prim:"map",args:l.args},x({t:1,v:1})),...t];case"EMPTY_BIG_MAP":return J(l.args[0]),m(l.args[0]),J(l.args[1]),W(l.args[0]),[A({prim:"big_map",args:l.args},x({t:1,v:1})),...t];case"LAMBDA":{J(l.args[0]),J(l.args[1]);const u=rt(l.args[2],[l.args[0]],Object.assign(Object.assign({},e),{contract:void 0}));if("failed"in u)return{failed:u.failed,level:u.level+1};if(u.length!==1)throw new C(l,t,`${l.prim}: function must return a value`);return p(l.args[1],u[0]),[y({prim:"lambda",args:[l.args[0],l.args[1]]}),...t]}case"LEVEL":return[y({prim:"nat"},"@level"),...t];case"TOTAL_VOTING_POWER":return[y({prim:"nat"}),...t];case"VOTING_POWER":return s(0,["key_hash"]),[y({prim:"nat"}),...t.slice(1)];case"TICKET":{const u=s(0,null,["nat"])[0];return m(u),[A({prim:"ticket",args:[u]},x({t:1,v:1})),...t.slice(2)]}case"JOIN_TICKETS":{const u=yt("pair",s(0,["pair"])[0]);if(K(u.args[0])!=="ticket")throw new C(l,t,`${l.prim}: ticket expected: ${K(u.args[0])}`);return p(u.args[0],u.args[1]),[y({prim:"option",args:[A(u.args[0],{t:null})]}),...t.slice(1)]}case"SPLIT_TICKET":{const u=s(0,["ticket"],["pair"]),g=yt("pair",u[1]);if(K(g.args[0])!=="nat")throw new C(l,t,`${l.prim}: nat expected: ${K(g.args[0])}`);return p(g.args[0],g.args[1]),[y({prim:"option",args:[{prim:"pair",args:[A(u[0],{t:null}),A(u[0],{t:null})]}]}),...t.slice(2)]}case"READ_TICKET":{const u=x({v:2}),g=s(0,["ticket"])[0],v=(ot=u.v)===null||ot===void 0?void 0:ot.map(_=>_!=="@"?[_]:void 0);return[A({prim:"pair",args:[{prim:"address"},A(g.args[0],{t:null}),{prim:"nat"}]},{v:v==null?void 0:v[0]}),A(g,{v:v==null?void 0:v[1],t:null}),...t.slice(1)]}case"PAIRING_CHECK":{const u=s(0,["list"])[0].args[0];if(!de(u))throw new C(l,t,`${l.prim}: pair expected: ${K(u)}`);const g=yt("pair",u);if(K(g.args[0])!=="bls12_381_g1")throw new C(l,t,`${l.prim}: bls12_381_g1 expected: ${K(g.args[0])}`);if(K(g.args[1])!=="bls12_381_g2")throw new C(l,t,`${l.prim}: bls12_381_g2 expected: ${K(g.args[1])}`);return[y({prim:"bool"}),...t.slice(1)]}case"SAPLING_EMPTY_STATE":return[A({prim:"sapling_state",args:[l.args[0]]},x({v:1,t:1})),...t];case"SAPLING_VERIFY_UPDATE":{const u=s(0,["sapling_transaction"],["sapling_state"]);if(parseInt(u[0].args[0].int,10)!==parseInt(u[1].args[0].int,10))throw new C(l,t,`${l.prim}: sapling memo size mismatch: ${u[0].args[0].int} != ${u[1].args[0].int}`);return dr(i,Re.PtJakarta)?[y({prim:"option",args:[{prim:"pair",args:[{prim:"int"},A(u[1],{t:null})]}]}),...t.slice(2)]:[y({prim:"option",args:[{prim:"pair",args:[{prim:"bytes"},{prim:"pair",args:[{prim:"int"},A(u[1],{t:null})]}]}]}),...t.slice(2)]}case"OPEN_CHEST":return s(0,["chest_key"],["chest"],["nat"]),[y({prim:"or",args:[{prim:"bytes"},{prim:"bool"}]}),...t.slice(3)];case"VIEW":{const u=s(0,null,["address"]);return M(u[0]),[y({prim:"option",args:[l.args[1]]}),...t.slice(2)]}case"MIN_BLOCK_TIME":return[y({prim:"nat"}),...t];case"EMIT":{const u=x({f:1,t:1});if(l.args){const g=s(0,null);return p(g[0],l.args[0]),[A({prim:"operation"},u),...t.slice(1)]}return[A({prim:"operation"},u),...t.slice(1)]}default:throw new wt(l,`unexpected instruction: ${l.prim}`)}})(n);if((e==null?void 0:e.traceCallback)!==void 0){const l={op:n,in:t,out:An};e.traceCallback(l)}return An}function Zt(r,t){for(const e of r)if(e.prim===t)return e;throw new wt(r,`missing contract section: ${t}`)}function uh(r){const t={};for(const e of r)e.prim==="view"&&(t[e.args[0].string]=e);return t}function mo(r){if(Array.isArray(r)){for(const t of r)if("prim"in t&&(t.prim==="parameter"||t.prim==="storage"||t.prim==="code"))return!0}return!1}function Ci(r,t){t=t||"%default";const e=qr(r).find(i=>i[0]===t);return e!==void 0?e[1]:t==="%default"?mo(r)?Zt(r,"parameter").args[0]:r:null}function hh(r){return Array.isArray(r)||r.prim==="or"}function qr(r){if(mo(r)){const t=Zt(r,"parameter"),e=qr(t.args[0]),i=rr(t);return i.f?[[i.f[0],t.args[0]],...e]:e}if(hh(r)){const t=Wr(r),e=i=>{const n=rr(t[i]);if(K(t[i])==="or"){const s=qr(t[i]);return n.f?[[n.f[0],t[i]],...s]:s}return n.f?[[n.f[0],t[i]]]:[]};return[...e(0),...e(1)]}return[]}function yo(r,t){const e=(c,h,p,m)=>{J(c,!0),J(h);const E={prim:"pair",args:[Object.assign(Object.assign({},c),{annots:["@parameter"]}),Object.assign(Object.assign({},h),{annots:["@storage"]})]},S=rt(m,[E],Object.assign(Object.assign({},t),{contract:r}));if("failed"in S)return S;try{fo(S,[p])}catch(M){throw M instanceof wt?new C(m,S,M.message):M}return S},i=Zt(r,"parameter").args[0],n=Zt(r,"storage").args[0],s=Zt(r,"code").args[0],a=e(i,n,{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},n]},s);for(const c of Object.values(uh(r)))e(c.args[1],n,c.args[2],c.args[3]);return a}function bo(r,t,e){J(t),Tt(r,t,e||null)}function lh(r,t,e){for(const i of t)J(i);if((e==null?void 0:e.contract)!==void 0)for(const i of["parameter","storage"]){const n=Zt(e.contract,i).args[0];J(n)}return rt(r,t,e||null)}function ph(r,t,e){try{return bo(r,t,e),!0}catch{return!1}}class rn{constructor(t,e){this.contract=t,this.ctx=Object.assign({contract:t},e),this.output=yo(t,this.ctx)}static parse(t,e){const i=new He(e),n=typeof t=="string"?i.parseScript(t):i.parseJSON(t);if(n===null)throw new Du("empty contract");if(uo(n))return new rn(n,e)}static parseTypeExpression(t,e){const i=new He(e),n=typeof t=="string"?i.parseScript(t):i.parseJSON(t);if(n===null)throw new Mu("empty type expression");if(fe(n))return J(n),n}static parseDataExpression(t,e){const i=new He(e),n=typeof t=="string"?i.parseScript(t):i.parseJSON(t);if(n===null)throw new ku("empty data expression");if($e(n))return n;throw void 0}section(t){return Zt(this.contract,t)}entryPoints(){return qr(this.contract)}entryPoint(t){return Ci(this.contract,t)}assertDataValid(t,e){bo(t,e,this.ctx)}isDataValid(t,e){return ph(t,e,this.ctx)}assertParameterValid(t,e){const i=this.entryPoint(t||void 0);if(i===null)throw new Bu(t==null?void 0:t.toString());this.assertDataValid(e,i)}isParameterValid(t,e){try{return this.assertParameterValid(t,e),!0}catch{return!1}}functionType(t,e){return lh(t,e,this.ctx)}}new rn([{prim:"parameter",args:[{prim:"unit"}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}]);const as=r=>r.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),nt=(r,t=8)=>r.toString(16).padStart(t,"0"),nn=31;var d;(function(r){r.SECRET="secret",r.RAW="raw",r.TZ1="tz1",r.BRANCH="branch",r.ZARITH="zarith",r.PUBLIC_KEY="public_key",r.PKH="pkh",r.DELEGATE="delegate",r.SCRIPT="script",r.BALLOT_STATEMENT="ballotStmt",r.PROPOSAL="proposal",r.PROPOSAL_ARR="proposalArr",r.INT32="int32",r.INT16="int16",r.PARAMETERS="parameters",r.ADDRESS="address",r.SMART_CONTRACT_ADDRESS="smart_contract_address",r.VALUE="value",r.MANAGER="manager",r.BLOCK_PAYLOAD_HASH="blockPayloadHash",r.ENTRYPOINT="entrypoint",r.OPERATION="operation",r.OP_ACTIVATE_ACCOUNT="activate_account",r.OP_DELEGATION="delegation",r.OP_TRANSACTION="transaction",r.OP_ORIGINATION="origination",r.OP_BALLOT="ballot",r.OP_ENDORSEMENT="endorsement",r.OP_SEED_NONCE_REVELATION="seed_nonce_revelation",r.OP_REVEAL="reveal",r.OP_PROPOSALS="proposals",r.OP_REGISTER_GLOBAL_CONSTANT="register_global_constant",r.OP_TRANSFER_TICKET="transfer_ticket",r.OP_TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.OP_TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.BURN_LIMIT="burn_limit",r.TX_ROLLUP_ORIGINATION_PARAM="tx_rollup_origination_param",r.TX_ROLLUP_ID="tx_rollup_id",r.TX_ROLLUP_BATCH_CONTENT="tx_rollup_batch_content",r.OP_INCREASE_PAID_STORAGE="increase_paid_storage"})(d||(d={}));const we={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0a":"True","0b":"Unit","0c":"PACK","0d":"UNPACK","0e":"BLAKE2B","0f":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1a":"CONCAT","1b":"CONS","1c":"CREATE_ACCOUNT","1d":"CREATE_CONTRACT","1e":"IMPLICIT_ACCOUNT","1f":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2a":"GT","2b":"HASH_KEY","2c":"IF","2d":"IF_CONS","2e":"IF_LEFT","2f":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3a":"MUL","3b":"NEG","3c":"NEQ","3d":"NIL","3e":"NONE","3f":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4a":"STEPS_TO_QUOTA","4b":"SUB","4c":"SWAP","4d":"TRANSFER_TOKENS","4e":"SET_DELEGATE","4f":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5a":"contract","5b":"int","5c":"key","5d":"key_hash","5e":"lambda","5f":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6a":"mutez","6b":"timestamp","6c":"unit","6d":"operation","6e":"address","6f":"SLICE",70:"DIG",71:"DUG",72:"EMPTY_BIG_MAP",73:"APPLY",74:"chain_id",75:"CHAIN_ID",76:"LEVEL",77:"SELF_ADDRESS",78:"never",79:"NEVER","7a":"UNPAIR","7b":"VOTING_POWER","7c":"TOTAL_VOTING_POWER","7d":"KECCAK","7e":"SHA3","7f":"PAIRING_CHECK",80:"bls12_381_g1",81:"bls12_381_g2",82:"bls12_381_fr",83:"sapling_state",84:"sapling_transaction_deprecated",85:"SAPLING_EMPTY_STATE",86:"SAPLING_VERIFY_UPDATE",87:"ticket",88:"TICKET",89:"READ_TICKET","8a":"SPLIT_TICKET","8b":"JOIN_TICKETS","8c":"GET_AND_UPDATE","8d":"chest","8e":"chest_key","8f":"OPEN_CHEST",90:"VIEW",91:"view",92:"constant",93:"SUB_MUTEZ",94:"tx_rollup_l2_address",95:"MIN_BLOCK_TIME",96:"sapling_transaction",97:"EMIT"},dh=(()=>{const r={};return Object.keys(we).forEach(t=>{r[we[t]]=t}),r})(),Di={4:"activate_account",107:"reveal",110:"delegation",108:"transaction",109:"origination",6:"ballot",21:"endorsement",1:"seed_nonce_revelation",5:"proposals",111:"register_global_constant",150:"tx_rollup_origination",151:"tx_rollup_submit_batch",158:"transfer_ticket",113:"increase_paid_storage"},cs=(()=>{const r={};return Object.keys(Di).forEach(t=>{const e=typeof t=="string"?parseInt(t,10):t;r[Di[e]]=nt(e,2)}),r})(),Jr={"00":"default","01":"root","02":"do","03":"set_delegate","04":"remove_delegate"},us=(()=>{const r={};return Object.keys(Jr).forEach(t=>{r[Jr[t]]=t}),r})();class fh extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBlockHashError"}}class hs extends Error{constructor(t){super(t),this.message=t,this.name="InvalidOperationSchemaError"}}class Eo extends Error{constructor(t){super(`Oversized entrypoint: ${t}. The maximum length of entrypoint is ${nn}`),this.entrypoint=t,this.name="OversizedEntryPointError"}}class gh extends Error{constructor(t){super(`The ballot value '${t}' is invalid`),this.ballotValue=t,this.name="InvalidBallotValueError"}}class mh extends Error{constructor(t){super(`Failed to decode ballot value ${t}`),this.ballotValue=t,this.name="DecodeBallotValueError"}}class vo extends Error{constructor(t){super(`The hex string '${t}' is invalid`),this.hexString=t,this.name="InvalidHexStringError"}}class yh extends Error{constructor(t){super(`Failed to encode michelson value '${t}'`),this.value=t,this.name="UnexpectedMichelsonValueError"}}class wo extends Error{constructor(t){super(t),this.message=t,this.name="OperationDecodingError"}}class bh extends Error{constructor(t){super(t),this.message=t,this.name="OperationEncodingError"}}class Eh extends Error{constructor(t){super(`The operation '${t}' is unsupported`),this.op=t,this.name="UnsupportedOperationError"}}class be{constructor(t,e=0){this.arr=t,this.offset=e}static fromHexString(t){const e=t.toLowerCase();if(/^(([a-f]|\d){2})*$/.test(e)){const i=new Uint8Array((e.match(/([a-z]|\d){2}/g)||[]).map(n=>parseInt(n,16)));return new be(i)}else throw new vo(e)}consume(t){const e=this.arr.subarray(this.offset,this.offset+t);return this.offset+=t,e}get(t){return this.arr[this.offset+t]}length(){return this.arr.length-this.offset}}const vh=r=>"prim"in r,wh=r=>"bytes"in r&&typeof r.bytes=="string",Sh=r=>"string"in r&&typeof r.string=="string",_h=r=>"int"in r&&typeof r.int=="string",Ah=r=>{const t=Le(r.code),e=Le(r.storage);return`${nt(t.length/2,8)}${t}${nt(e.length/2,8)}${e}`},Oh=r=>{const t=Lt(r),e=Lt(r);return{code:Ce(new be(t)),storage:Ce(new be(e))}},Le=r=>{if(Array.isArray(r)){const t=r.map(i=>Le(i)).join(""),e=t.length/2;return`02${nt(e)}${t}`}else{if(vh(r))return Lh(r);if(wh(r))return Ph(r);if(Sh(r))return Rh(r);if(_h(r))return xh(r)}throw new yh(JSON.stringify(r))},Ce=r=>{const t=r.consume(1);switch(t[0]){case 10:return Th(r);case 1:return Ih(r);case 0:return Nh(r);case 2:{const e=new be(Lt(r)),i=[];for(;e.length()>0;)i.push(Ce(e));return i}default:return Ch(r,t)}},Lt=(r,t=4)=>{const e=r.consume(t),i=parseInt(Buffer.from(e).toString("hex"),16);return r.consume(i)},Ph=r=>{if(!/^([A-Fa-f0-9]{2})*$/.test(r.bytes))throw new vo(r.bytes);const t=r.bytes.length/2;return`0a${nt(t)}${r.bytes}`},Th=r=>{const t=Lt(r);return{bytes:Buffer.from(t).toString("hex")}},Rh=r=>{const t=Buffer.from(r.string,"utf8").toString("hex"),e=t.length/2;return`01${nt(e)}${t}`},Ih=r=>{const t=Lt(r);return{string:Buffer.from(t).toString("utf8")}},xh=({int:r})=>{const t=new w(r,10),e=t.toString(2)[0]==="-"?"1":"0",i=t.toString(2).replace(/-/g,""),n=i.length<=6?6:(i.length-6)%7?i.length+7-(i.length-6)%7:i.length,o=i.padStart(n,"0").match(/\d{6,7}/g).reverse();return o[0]=e+o[0],`00${o.map((c,h)=>parseInt((h===o.length-1?"0":"1")+c,2).toString(16).padStart(2,"0")).join("")}`},Nh=r=>{let t=r.consume(1)[0];const e=[],i=1<<7;for(;t&i;)e.push(t),t=r.consume(1)[0];e.push(t);const n=!!(1<<6&e[0]);e[0]=e[0]&127;const s=e.map((a,c)=>a.toString(2).slice(c===0?-6:-7).padStart(c===0?6:7,"0")).reverse();let o=new w(s.join(""),2);return n&&(o=o.times(-1)),{int:o.toFixed()}},Lh=r=>{const t=+Array.isArray(r.annots),e=Array.isArray(r.args)?r.args.length:0,i=nt(Math.min(2*e+t+3,9),2),n=dh[r.prim];let s=(r.args||[]).map(a=>Le(a)).join("");const o=Array.isArray(r.annots)?kh(r.annots):"";return r.prim==="LAMBDA"&&e&&(s=nt(s.length/2)+s+nt(0)),(r.prim==="pair"||r.prim==="Pair")&&e>2&&(s=o===""?nt(s.length/2)+s+nt(0):nt(s.length/2)+s),r.prim==="view"&&r.args&&(s=nt(s.length/2)+s+nt(0)),`${i}${n}${s}${o}`},Ch=(r,t)=>{const e=(t[0]-3)%2===1;let i=Math.floor((t[0]-3)/2);const n=r.consume(1)[0].toString(16).padStart(2,"0"),s={prim:we[n]};if(we[n]==="LAMBDA"&&r.consume(4),we[n]==="view")return i!=0?Dh(r,s):s;let o,a;(we[n]==="pair"||we[n]==="Pair")&&i>2&&(o=Mh(r),i=0,a=ls(r));const c=new Array(i).fill(0).map(()=>Ce(r));return we[n]==="LAMBDA"&&r.consume(4),o?s.args=o:c.length&&(s.args=c),a&&a[0]!==""?s.annots=a:e&&(s.annots=ls(r)),s},Dh=(r,t)=>(r.consume(4),t.args=new Array(4).fill(0).map(()=>Ce(r)),r.consume(4),t),Mh=r=>{const t=new be(Lt(r)),e=[];for(;t.length()>0;)e.push(Ce(t));return e},kh=r=>{const t=r.map(i=>Buffer.from(i,"utf8").toString("hex")).join("20"),e=t.length/2;return`${nt(e)}${t}`},ls=r=>{const t=r.consume(4),e=parseInt(Buffer.from(t).toString("hex"),16),i=r.consume(e);return Buffer.from(i).toString("hex").split("20").map(s=>Buffer.from(s,"hex").toString("utf8"))},St=r=>t=>Xo(Buffer.from(Ss(t,Ui[r]))),_t=r=>t=>{const e=t.consume(Qo[r]);return ta(e,Ui[r])},Bh=_t(T.TZ1),jh=_t(T.B),sn=r=>{const t=r.consume(1);if(t[0]===0)return _t(T.TZ1)(r);if(t[0]===1)return _t(T.TZ2)(r);if(t[0]===2)return _t(T.TZ3)(r)},$h=St(T.B),Vh=St(T.TZ1),ps=r=>r?"ff":"00",So=r=>St(T.P)(r),_o=r=>_t(T.P)(r),Uh=r=>{const t=[];for(r.consume(4);r.length()>0;)t.push(_o(r));return t},Hh=r=>nt(32*r.length)+r.map(t=>So(t)).join(""),Kh=r=>{switch(r){case"yay":return"00";case"nay":return"01";case"pass":return"02";default:throw new gh(r)}},Gh=r=>{const t=r.consume(1);switch(t[0]){case 0:return"yay";case 1:return"nay";case 2:return"pass";default:throw new mh(t[0].toString())}},Fh=r=>r?ps(!0)+on(r):ps(!1),zh=r=>{const t=parseInt(String(r),10),e=[];for(let i=0;i<4;i++){const n=(4-(i+1))*8;e.push((t&255<<n)>>n)}return Buffer.from(e).toString("hex")},Wh=r=>{const t=r.consume(4);let e=0;for(let i=0;i<t.length;i++)e=e|t[i]<<(t.length-(i+1))*8;return e},qh=r=>{const t=parseInt(String(r),10),e=[];for(let i=0;i<2;i++){const n=(2-(i+1))*8;e.push((t&255<<n)>>n)}return Buffer.from(e).toString("hex")},Jh=r=>{const t=r.consume(2);let e=0;for(let i=0;i<t.length;i++)e=e|t[i]<<(t.length-(i+1))*8;return e},Yh=r=>r.consume(1)[0]===255,Zh=r=>{if(Yh(r))return sn(r)},on=r=>{switch(r.substr(0,3)){case T.TZ1:return"00"+St(T.TZ1)(r);case T.TZ2:return"01"+St(T.TZ2)(r);case T.TZ3:return"02"+St(T.TZ3)(r);default:throw new Ki(r)}},Xh=r=>{switch(r.substr(0,4)){case T.EDPK:return"00"+St(T.EDPK)(r);case T.SPPK:return"01"+St(T.SPPK)(r);case T.P2PK:return"02"+St(T.P2PK)(r);default:throw new As(r)}},Qh=r=>{switch(r.substr(0,3)){case T.TZ1:case T.TZ2:case T.TZ3:return"00"+on(r);case T.KT1:return"01"+St(T.KT1)(r)+"00";default:throw new Y(r)}},tl=r=>{if(r.substring(0,3)===T.KT1)return"01"+St(T.KT1)(r)+"00";throw new me(r)},el=r=>{switch(r.consume(1)[0]){case 0:return _t(T.EDPK)(r);case 1:return _t(T.SPPK)(r);case 2:return _t(T.P2PK)(r);default:throw new As(r.toString())}},rl=r=>{switch(r.consume(1)[0]){case 0:return sn(r);case 1:{const e=_t(T.KT1)(r);return r.consume(1),e}default:throw new Y(r.toString())}},il=r=>{if(r.consume(1)[0]===1){const e=_t(T.KT1)(r);return r.consume(1),e}throw new me(r.toString())},Ao=r=>{const t=[];let e=new w(r,10);if(e.isNaN())throw new TypeError(`Invalid zarith number ${r}`);for(;;)if(e.lt(128)){e.lt(16)&&t.push("0"),t.push(e.toString(16));break}else{let i=e.mod(128);e=e.minus(i),e=e.dividedBy(128),i=i.plus(128),t.push(i.toString(16))}return t.join("")},Oo=r=>{let t=0;for(;t<r.length()&&(r.get(t)&128)!==0;)t+=1;let e=new w(0);for(let i=t;i>=0;i-=1){const n=r.get(i)&127;e=e.multipliedBy(128),e=e.plus(n)}return r.consume(t+1),new w(e).toString()},nl=r=>{const t=nt(r.consume(1)[0],2);if(t in Jr)return Jr[t];{const e=Lt(r,1),i=Buffer.from(e).toString("utf8");if(i.length>nn)throw new Eo(i);return i}},sl=r=>{if(r.consume(1)[0]!==0){const e=nl(r),i=Lt(r),n=Ce(new be(i));return{entrypoint:e,value:n}}},ol=r=>{if(r in us)return`${us[r]}`;if(r.length>nn)throw new Eo(r);return`ff${Le({string:r}).slice(8)}`},al=r=>{if(!r||r.entrypoint==="default"&&"prim"in r.value&&r.value.prim==="Unit")return"00";const t=ol(r.entrypoint),e=Le(r.value),i=(e.length/2).toString(16).padStart(8,"0");return`ff${t}${i}${e}`},cl=r=>{const t=Le(r);return`${nt(t.length/2)}${t}`},ul=r=>{const t=Lt(r);return Ce(new be(t))},hl=St(T.VH),ll=_t(T.VH),pl=r=>`${Le({string:r}).slice(2)}`,dl=r=>{const t=Lt(r);return Buffer.from(t).toString("utf8")},fl=r=>"",gl=r=>({}),ml=St(T.TXR1),yl=_t(T.TXR1),bl=r=>`${nt(r.length/2)}${r}`,El=r=>{const t=Lt(r);return Buffer.from(t).toString("hex")},vl=r=>r?`ff${Ao(r)}`:"00",wl=r=>{const t=r.consume(1);if(Buffer.from(t).toString("hex")!=="00")return Oo(r)},Po={branch:d.BRANCH,contents:[d.OPERATION]},an={pkh:d.TZ1,secret:d.SECRET},cn={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,public_key:d.PUBLIC_KEY},un={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,delegate:d.DELEGATE},hn={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,amount:d.ZARITH,destination:d.ADDRESS,parameters:d.PARAMETERS},ln={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,balance:d.ZARITH,delegate:d.DELEGATE,script:d.SCRIPT},pn={source:d.PKH,period:d.INT32,proposal:d.PROPOSAL,ballot:d.BALLOT_STATEMENT},dn={slot:d.INT16,level:d.INT32,round:d.INT32,block_payload_hash:d.BLOCK_PAYLOAD_HASH},fn={level:d.INT32,nonce:d.RAW},gn={source:d.PKH,period:d.INT32,proposals:d.PROPOSAL_ARR},mn={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,value:d.VALUE},yn={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,ticket_contents:d.VALUE,ticket_ty:d.VALUE,ticket_ticketer:d.ADDRESS,ticket_amount:d.ZARITH,destination:d.ADDRESS,entrypoint:d.ENTRYPOINT},bn={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,tx_rollup_origination:d.TX_ROLLUP_ORIGINATION_PARAM},En={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,rollup:d.TX_ROLLUP_ID,content:d.TX_ROLLUP_BATCH_CONTENT,burn_limit:d.BURN_LIMIT},vn={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,amount:d.ZARITH,destination:d.SMART_CONTRACT_ADDRESS},Sl=r=>t=>{if(!(t.kind in r)||!(t.kind in cs))throw new Ne(t.kind);return cs[t.kind]+r[t.kind](t)},_l=r=>t=>{const e=t.consume(1),i=Di[e[0]];if(i===void 0)throw new Eh(e[0].toString());const n=r[i](t);if(typeof n!="object")throw new wo("Decoded invalid operation");return Object.assign({kind:i},n)},pt=r=>t=>e=>Object.keys(t).reduce((n,s)=>{const o=t[s];if(e&&Array.isArray(o)){const a=r[o[0]],c=e[s];if(!Array.isArray(c))throw new bh(`Expected value to be Array ${JSON.stringify(c)}`);return n+c.reduce((h,p)=>h+a(p),"")}else{const a=r[o];return n+a(e[s])}},""),dt=r=>t=>e=>Object.keys(t).reduce((n,s)=>{const o=t[s];if(Array.isArray(o)){const a=r[o[0]],c=[],h=e.length();for(;e.length()>0;)if(c.push(a(e)),h===e.length())throw new wo("Unable to decode value");return Object.assign(Object.assign({},n),{[s]:c})}else{const a=r[o],c=a(e);return typeof c<"u"?Object.assign(Object.assign({},n),{[s]:c}):Object.assign({},n)}},{}),$={[d.SECRET]:r=>as(r.consume(20)),[d.RAW]:r=>as(r.consume(32)),[d.TZ1]:Bh,[d.BRANCH]:jh,[d.ZARITH]:Oo,[d.PUBLIC_KEY]:el,[d.PKH]:sn,[d.DELEGATE]:Zh,[d.INT32]:Wh,[d.SCRIPT]:Oh,[d.BALLOT_STATEMENT]:Gh,[d.PROPOSAL]:_o,[d.PROPOSAL_ARR]:Uh,[d.PARAMETERS]:sl,[d.ADDRESS]:rl,[d.SMART_CONTRACT_ADDRESS]:il,[d.VALUE]:ul,[d.INT16]:Jh,[d.BLOCK_PAYLOAD_HASH]:ll,[d.ENTRYPOINT]:dl,[d.TX_ROLLUP_ORIGINATION_PARAM]:gl,[d.TX_ROLLUP_ID]:yl,[d.TX_ROLLUP_BATCH_CONTENT]:El,[d.BURN_LIMIT]:wl};$[d.OPERATION]=_l($);$[d.OP_ACTIVATE_ACCOUNT]=r=>dt($)(an)(r);$[d.OP_DELEGATION]=r=>dt($)(un)(r);$[d.OP_TRANSACTION]=r=>dt($)(hn)(r);$[d.OP_ORIGINATION]=r=>dt($)(ln)(r);$[d.OP_BALLOT]=r=>dt($)(pn)(r);$[d.OP_ENDORSEMENT]=r=>dt($)(dn)(r);$[d.OP_SEED_NONCE_REVELATION]=r=>dt($)(fn)(r);$[d.OP_PROPOSALS]=r=>dt($)(gn)(r);$[d.OP_REVEAL]=r=>dt($)(cn)(r);$[d.OP_REGISTER_GLOBAL_CONSTANT]=r=>dt($)(mn)(r);$[d.OP_TRANSFER_TICKET]=r=>dt($)(yn)(r);$[d.OP_TX_ROLLUP_ORIGINATION]=r=>dt($)(bn)(r);$[d.OP_TX_ROLLUP_SUBMIT_BATCH]=r=>dt($)(En)(r);$[d.OP_INCREASE_PAID_STORAGE]=r=>dt($)(vn)(r);$[d.MANAGER]=dt($)(Po);const V={[d.SECRET]:r=>r,[d.RAW]:r=>r,[d.TZ1]:Vh,[d.BRANCH]:$h,[d.ZARITH]:Ao,[d.PUBLIC_KEY]:Xh,[d.PKH]:on,[d.DELEGATE]:Fh,[d.SCRIPT]:Ah,[d.BALLOT_STATEMENT]:Kh,[d.PROPOSAL]:So,[d.PROPOSAL_ARR]:Hh,[d.INT32]:zh,[d.PARAMETERS]:al,[d.ADDRESS]:Qh,[d.SMART_CONTRACT_ADDRESS]:tl,[d.VALUE]:cl,[d.INT16]:qh,[d.BLOCK_PAYLOAD_HASH]:hl,[d.ENTRYPOINT]:pl,[d.TX_ROLLUP_ORIGINATION_PARAM]:fl,[d.TX_ROLLUP_ID]:ml,[d.TX_ROLLUP_BATCH_CONTENT]:bl,[d.BURN_LIMIT]:vl};V[d.OPERATION]=Sl(V);V[d.OP_ACTIVATE_ACCOUNT]=r=>pt(V)(an)(r);V[d.OP_DELEGATION]=r=>pt(V)(un)(r);V[d.OP_TRANSACTION]=r=>pt(V)(hn)(r);V[d.OP_ORIGINATION]=r=>pt(V)(ln)(r);V[d.OP_BALLOT]=r=>pt(V)(pn)(r);V[d.OP_ENDORSEMENT]=r=>pt(V)(dn)(r);V[d.OP_SEED_NONCE_REVELATION]=r=>pt(V)(fn)(r);V[d.OP_PROPOSALS]=r=>pt(V)(gn)(r);V[d.OP_REVEAL]=r=>pt(V)(cn)(r);V[d.OP_REGISTER_GLOBAL_CONSTANT]=r=>pt(V)(mn)(r);V[d.OP_TRANSFER_TICKET]=r=>pt(V)(yn)(r);V[d.OP_TX_ROLLUP_ORIGINATION]=r=>pt(V)(bn)(r);V[d.OP_TX_ROLLUP_SUBMIT_BATCH]=r=>pt(V)(En)(r);V[d.OP_INCREASE_PAID_STORAGE]=r=>pt(V)(vn)(r);V[d.MANAGER]=pt(V)(Po);const To={activate_account:an,reveal:cn,delegation:un,transaction:hn,origination:ln,ballot:pn,endorsement:dn,seed_nonce_revelation:fn,proposals:gn,register_global_constant:mn,transfer_ticket:yn,tx_rollup_origination:bn,tx_rollup_submit_batch:En,increase_paid_storage:vn},Al=(r,t)=>t.filter(e=>!r.includes(e)),Ol=(r,t)=>r.filter(e=>e!==t),Pl=r=>Object.keys(To).includes(r),Tl=r=>{const t=r.kind,e=Object.keys(r),i=Ol(e,"kind"),n=Object.keys(To[t]);return Al(i,n)};var Mi;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(Mi||(Mi={}));const Rl=Mi.Psithaca2;function Il(r,t){return{encoder:V[r],decoder:e=>{const i=be.fromHexString(e);return $[r](i)}}}class Ro{constructor(t=Rl){this.protocolHash=t,this.codec=Il(d.MANAGER,this.protocolHash)}forge(t){if(ea(t.branch)!==I.VALID)throw new fh(`The block hash ${t.branch} is invalid`);for(const i of t.contents){if(!Pl(i.kind))throw new Ne(i.kind);const n=Tl(i);if(n.length===1){if(i.kind==="delegation"&&n[0]==="delegate")continue;if(i.kind==="origination"&&n[0]==="delegate")continue;if(i.kind==="transaction"&&n[0]==="parameters")continue;if(i.kind==="tx_rollup_submit_batch"&&n[0]==="burn_limit")continue;throw new hs(`Missing properties: ${n.join(", ").toString()}`)}else if(n.length>1)throw new hs(`Missing properties: ${n.join(", ").toString()}`)}const e=this.codec.encoder(t).toLowerCase();return Promise.resolve(e)}parse(t){return Promise.resolve(this.codec.decoder(t))}}const Gp=new Ro;function ee(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}function f(r,t,e,i){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(p){try{h(i.next(p))}catch(m){o(m)}}function c(p){try{h(i.throw(p))}catch(m){o(m)}}function h(p){p.done?s(p.value):n(p.value).then(a,c)}h((i=i.apply(r,t||[])).next())})}function xl(r,t){const e=JSON.parse(r.body);if(e[0]&&e[0].kind&&e[0].msg){const i=JSON.stringify({kind:e[0].kind,id:e[0].id,msg:e[0].msg.replace(t,"")});return new vr(`Http error response: (${r.status}) ${i}`,r.status,r.statusText,i,r.url)}else return r}class Nl{constructor(t){this.context=t}inject(t){return f(this,void 0,void 0,function*(){let e;try{e=yield this.context.rpc.injectOperation(t)}catch(i){const n=". You may want to use --replace to provide adequate fee and replace it";throw i instanceof vr&&i.message.includes(n)?xl(i,n):i}return e})}}class Lr extends Error{constructor(){super("No signer has been configured. Please configure one by calling setProvider({signer}) on your TezosToolkit instance."),this.name="UnconfiguredSignerError"}}class ki{publicKey(){return f(this,void 0,void 0,function*(){throw new Lr})}publicKeyHash(){return f(this,void 0,void 0,function*(){throw new Lr})}secretKey(){return f(this,void 0,void 0,function*(){throw new Lr})}sign(t,e){return f(this,void 0,void 0,function*(){throw new Lr})}}function Io(r){return new Z(t=>(r.on("data",e=>{t.next(e)}),r.on("error",e=>{t.error(e)}),r.on("close",()=>{t.complete()}),()=>{r.close()}))}var De;(function(r){r[r.DELEGATION=10600]="DELEGATION",r[r.ORIGINATION=10600]="ORIGINATION",r[r.TRANSFER=10600]="TRANSFER",r[r.REVEAL=1100]="REVEAL"})(De||(De={}));var Me;(function(r){r[r.DELEGATION=1257]="DELEGATION",r[r.ORIGINATION=1e4]="ORIGINATION",r[r.TRANSFER=1e4]="TRANSFER",r[r.REVEAL=374]="REVEAL"})(Me||(Me={}));var ke;(function(r){r[r.DELEGATION=0]="DELEGATION",r[r.ORIGINATION=257]="ORIGINATION",r[r.TRANSFER=257]="TRANSFER",r[r.REVEAL=0]="REVEAL"})(ke||(ke={}));const Ll=250;var it;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(it||(it={}));it.Pt24m4xi,it.PsBABY5H,it.PsBabyM1,it.PsCARTHA,it.PsDELPH1,it.PtEdo2Zk,it.PsFLorena,it.PtGRANADs,it.PtHangz2,it.PsiThaCa,it.Psithaca2,it.PtJakart2,it.PtKathman,it.ProtoALpha;var ds;(function(r){r.MAINNET="NetXdQprcVkpaWU",r.CARTHAGENET="NetXjD3HPJJjmcd",r.DELPHINET="NetXm8tYqnMWky1",r.EDONET="NetXSgo1ZT2DRUG",r.FLORENCENET="NetXxkAx4woPLyu",r.GRANADANET="NetXz969SFaFn8k",r.HANGZHOUNET="NetXZSsxBpMQeAT",r.ITHACANET="NetXbhmtAbMukLc",r.ITHACANET2="NetXnHfVqm9iesp",r.JAKARTANET2="NetXLH1uAxK7CCh",r.KATHMANDUNET="NetXazhm4yetmff"})(ds||(ds={}));class xo extends Error{constructor(t,e,i){super(`${t} Received ${i.length} arguments while expecting one of the following signatures (${JSON.stringify(e)})`),this.smartContractMethodName=t,this.sigs=e,this.args=i,this.name="Invalid parameters error"}}class Cl extends Error{constructor(t){super(`Since Babylon delegation source can no longer be a contract address ${t}. Please use the smart contract abstraction to set your delegate.`),this.source=t,this.name="Invalid delegation source error"}}class Yr extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="InvalidCodeParameter"}}class No extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="InvalidInitParameter"}}class Dl extends Error{constructor(t,e,i,n){super(`Unable to encode the parameter of the view: ${t}. Received ${i} as parameter while expecting one of the following signatures (${JSON.stringify(e)})`),this.smartContractViewName=t,this.sigs=e,this.args=i,this.originalError=n,this.name="Invalid view parameters error",this.cause=n}}class _i extends Error{constructor(t,e,i,n){super(t),this.message=t,this.viewName=e,this.failWith=i,this.originalError=n,this.name="ViewSimulationError"}}const fs=r=>{if(Ml(r.body)){const t=JSON.parse(r.body);if(Array.isArray(t)&&"with"in t[t.length-1])return t[t.length-1].with}},Ml=r=>{try{JSON.parse(r)}catch{return!1}return!0};class gs extends Error{constructor(t){super(`${t} Please configure the context of the view execution in the executeView method.`),this.info=t,this.name="InvalidViewSimulationContext"}}class kl extends Error{constructor(t){super(t),this.message=t,this.name="RevealOperationError"}}class Bl extends Error{constructor(t){super(t),this.message=t,this.name="OriginationParameterError"}}class jl extends Error{constructor(t){super(t),this.message=t,this.name="IntegerError"}}const Zr=({code:r,init:t,balance:e="0",delegate:i,storage:n,fee:s=Me.ORIGINATION,gasLimit:o=De.ORIGINATION,storageLimit:a=ke.ORIGINATION,mutez:c=!1})=>f(void 0,void 0,void 0,function*(){if(n!==void 0&&t!==void 0)throw new Bl("Storage and Init cannot be set a the same time. Please either use storage or init but not both.");if(!Array.isArray(r))throw new Yr("Wrong code parameter type, expected an array",r);let h;if(n!==void 0){const E=r.find(M=>"prim"in M&&M.prim==="storage");if((E==null?void 0:E.args)===void 0)throw new Yr("The storage section is missing from the script",r);h=new Et(E.args[0]).Encode(n)}else if(t!==void 0&&typeof t=="object")h=t;else throw new No("Wrong init parameter type, expected JSON Michelson",t);const p={code:r,storage:h};if(isNaN(Number(e)))throw new jl(`Unexpected Invalid Integer ${e}`);const m={kind:b.ORIGINATION,fee:s,gas_limit:o,storage_limit:a,balance:c?e.toString():Gi("tz","mutez",e).toString(),script:p};return i&&(m.delegate=i),m}),Xr=({to:r,amount:t,parameter:e,fee:i=Me.TRANSFER,gasLimit:n=De.TRANSFER,storageLimit:s=ke.TRANSFER,mutez:o=!1})=>f(void 0,void 0,void 0,function*(){return{kind:b.TRANSACTION,fee:i,gas_limit:n,storage_limit:s,amount:o?t.toString():Gi("tz","mutez",t).toString(),destination:r,parameters:e}}),Qr=({delegate:r,source:t,fee:e=Me.DELEGATION,gasLimit:i=De.DELEGATION,storageLimit:n=ke.DELEGATION})=>f(void 0,void 0,void 0,function*(){return{kind:b.DELEGATION,source:t,fee:e,gas_limit:i,storage_limit:n,delegate:r}}),Lo=({fee:r=Me.DELEGATION,gasLimit:t=De.DELEGATION,storageLimit:e=ke.DELEGATION},i)=>f(void 0,void 0,void 0,function*(){return{kind:b.DELEGATION,fee:r,gas_limit:t,storage_limit:e,delegate:i}}),Er=({fee:r=Me.REVEAL,gasLimit:t=De.REVEAL,storageLimit:e=ke.REVEAL},i,n)=>f(void 0,void 0,void 0,function*(){return{kind:b.REVEAL,fee:r,public_key:n,source:i,gas_limit:t,storage_limit:e}}),ti=({value:r,source:t,fee:e,gasLimit:i,storageLimit:n})=>f(void 0,void 0,void 0,function*(){return{kind:b.REGISTER_GLOBAL_CONSTANT,value:r,fee:e,gas_limit:i,storage_limit:n,source:t}}),ei=({source:r,fee:t,gasLimit:e,storageLimit:i})=>f(void 0,void 0,void 0,function*(){return{kind:b.TX_ROLLUP_ORIGINATION,fee:t,gas_limit:e,storage_limit:i,source:r,tx_rollup_origination:{}}}),ri=({content:r,rollup:t,source:e,fee:i,gasLimit:n,storageLimit:s})=>f(void 0,void 0,void 0,function*(){return{kind:b.TX_ROLLUP_SUBMIT_BATCH,fee:i,gas_limit:n,storage_limit:s,source:e,content:r,rollup:t}}),ii=({ticketContents:r,ticketTy:t,ticketTicketer:e,ticketAmount:i,destination:n,entrypoint:s,source:o,fee:a,gasLimit:c,storageLimit:h})=>f(void 0,void 0,void 0,function*(){return{kind:b.TRANSFER_TICKET,fee:a,gas_limit:c,storage_limit:h,source:o,ticket_contents:r,ticket_ty:t,ticket_ticketer:e,ticket_amount:i,destination:n,entrypoint:s}}),ni=({source:r,fee:t,gasLimit:e,storageLimit:i,amount:n,destination:s})=>f(void 0,void 0,void 0,function*(){return{kind:b.INCREASE_PAID_STORAGE,source:r,fee:t,gas_limit:e,storage_limit:i,amount:n,destination:s}}),Ai=(r,t)=>Object.assign(Object.assign({},r),{kind:t}),ms=(r,t)=>{if(Array.isArray(r)){const e=r.find(i=>i.kind===t);if(e&&$l(e,t))return e}},$l=(r,t)=>r.kind===t,Co=r=>["transaction","delegation","origination","reveal","register_global_constant","increase_paid_storage","tx_rollup_origination","tx_rollup_submit_batch","transfer_ticket"].indexOf(r.kind)!==-1,Bi=r=>["transaction","delegation","origination","register_global_constant","increase_paid_storage","tx_rollup_origination","tx_rollup_submit_batch","transfer_ticket"].indexOf(r.kind)!==-1,wn=r=>"metadata"in r,ur=r=>wn(r)&&"operation_result"in r.metadata,Vl=r=>wn(r)&&"internal_operation_results"in r.metadata,Ul=r=>"with"in r;class Do extends Error{constructor(t,e){super(),this.errors=t,this.errorDetails=e,this.name="TezosOperationError";const i=t[t.length-1];this.id=i.id,this.kind=i.kind,this.message=`(${this.kind}) ${this.id}`,Ul(i)&&(i.with.string?this.message=i.with.string:i.with.int?this.message=i.with.int:this.message=JSON.stringify(i.with))}}class Hl extends Error{constructor(t){super("Preapply returned an unexpected result"),this.result=t,this.name="TezosPreapplyFailureError"}}const Xt=r=>{const t=Array.isArray(r)?r:[r],e=[];for(let i=0;i<t.length;i++)for(let n=0;n<t[i].contents.length;n++){const s=t[i].contents[n];ur(s)&&(e.push(Object.assign({fee:s.fee},s.metadata.operation_result)),Array.isArray(s.metadata.internal_operation_results)&&s.metadata.internal_operation_results.forEach(o=>e.push(o.result)))}return e},or=(r,t="failed")=>{const e=Array.isArray(r)?r:[r];let i=[];for(let n=0;n<e.length;n++)for(let s=0;s<e[n].contents.length;s++){const o=e[n].contents[s];if(wn(o)&&(ur(o)&&o.metadata.operation_result.status===t&&(i=i.concat(o.metadata.operation_result.errors||[])),Vl(o)&&Array.isArray(o.metadata.internal_operation_results)))for(const a of o.metadata.internal_operation_results)"result"in a&&a.result.status===t&&(i=i.concat(a.result.errors||[]))}return i};class Kl extends Error{constructor(t){super(t),this.message=t,this.name="OriginationOperationError"}}class Mo extends Error{constructor(t){super(t),this.message=t,this.name="InvalidConfirmationCountError"}}class Gl extends Error{constructor(t){super(t),this.message=t,this.name="ConfirmationUndefinedError"}}class Fl extends Error{constructor(t){super(t),this.message=t,this.name="InvalidFilterExpressionError"}}class Ct{constructor(t,e,i,n){if(this.hash=t,this.raw=e,this.results=i,this.context=n,this._pollingConfig$=new yr(1),this.currentHead$=this._pollingConfig$.pipe(Yt(s=>new oi(s).pipe(Gs(s.timeout*1e3,Ji(new Error("Confirmation polling timed out"))))),Yt(()=>Vs(()=>Io(this.context.stream.subscribeBlock("head"))).pipe(Yt(s=>{var o,a;const c=(a=(o=this.lastHead)===null||o===void 0?void 0:o.header.level)!==null&&a!==void 0?a:s.header.level-1;return Zi(c+1,s.header.level-c-1).pipe(Or(h=>this.context.readProvider.getBlock(h)),Hs(s))}),Gr(s=>this.lastHead=s))),Kn({refCount:!0})),this.confirmed$=this.currentHead$.pipe(Ke(s=>{for(let o=3;o>=0;o--)s.operations[o].forEach(a=>{a.hash===this.hash&&(this._foundAt=s.header.level)});if(s.header.level-this._foundAt>=0)return this._foundAt}),Kr(s=>s!==void 0),le(),Kn()),this._foundAt=Number.POSITIVE_INFINITY,Os(this.hash)!==I.VALID)throw new Ps(this.hash);this.confirmed$.pipe(le(),Xi(()=>ar(Cs))).subscribe()}get includedInBlock(){return this._foundAt}get revealOperation(){return Array.isArray(this.results)&&this.results.find(t=>t.kind==="reveal")}get revealStatus(){return this.revealOperation?this.revealOperation.metadata.operation_result.status:"unknown"}get status(){return this.results.map(t=>ur(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}confirmation(t,e){return f(this,void 0,void 0,function*(){if(typeof t<"u"&&t<1)throw new Mo("Confirmation count must be at least 1");const{defaultConfirmationCount:i,confirmationPollingTimeoutSecond:n}=this.context.config;this._pollingConfig$.next({timeout:e||n});const s=t!==void 0?t:i;return new Promise((o,a)=>{this.confirmed$.pipe(Yt(()=>this.currentHead$),Kr(c=>c.header.level-this._foundAt>=s-1),le()).subscribe(c=>{o(this._foundAt+(s-1))},a)})})}}class zl extends Ct{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}sumProp(t,e){return t.reduce((i,n)=>e in n?Number(n[e])+i:i,0)}getOriginatedContractAddresses(){const t=this.results.filter(i=>i.kind==="origination");let e=[];for(const i of t)i.metadata.operation_result.originated_contracts&&(e=[...e,...i.metadata.operation_result.originated_contracts]);return e}get status(){return this.results.filter(t=>ko.indexOf(t.kind)!==-1).map(t=>ur(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}get fee(){return this.sumProp(this.params,"fee")}get gasLimit(){return this.sumProp(this.params,"gas_limit")}get storageLimit(){return this.sumProp(this.params,"storage_limit")}get consumedGas(){return w.config({DECIMAL_PLACES:0,ROUNDING_MODE:w.ROUND_UP}),new w(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(Xt({contents:this.results}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(Xt({contents:this.results}),"paid_storage_size_diff"))}get errors(){return or({contents:this.results})}}class li{constructor(t){this.context=t}get rpc(){return this.context.rpc}get signer(){return this.context.signer}isRevealOpNeeded(t,e){return f(this,void 0,void 0,function*(){return!(!(yield this.isAccountRevealRequired(e))||!this.isRevealRequiredForOpType(t))})}isAccountRevealRequired(t){return f(this,void 0,void 0,function*(){return!(yield this.context.readProvider.isAccountRevealed(t,"head"))})}isRevealRequiredForOpType(t){let e=!1;for(const i of t)Bi(i)&&(e=!0);return e}prepareOperation({operation:t,source:e},i){return f(this,void 0,void 0,function*(){const n={};let s=[];const o=this.context.readProvider.getBlockHash("head~2"),a=this.context.readProvider.getNextProtocol("head");Array.isArray(t)?s=[...t]:s=[t];const c=i||(yield this.signer.publicKeyHash());let h=Promise.resolve(void 0);for(let y=0;y<s.length;y++)if(Bi(s[y])||s[y].kind==="reveal"){h=this.context.readProvider.getCounter(c,"head");break}const[p,m,E]=yield Promise.all([o,a,h]),S=parseInt(E||"0",10);(!n[c]||n[c]<S)&&(n[c]=S);const M=y=>({counter:`${++n[c]}`,fee:typeof y.fee>"u"?"0":`${y.fee}`,gas_limit:typeof y.gas_limit>"u"?"0":`${y.gas_limit}`,storage_limit:typeof y.storage_limit>"u"?"0":`${y.storage_limit}`}),W=y=>({source:typeof y.source>"u"?e||c:y.source}),A=(y=>y.map(F=>{switch(F.kind){case b.ACTIVATION:return Object.assign({},F);case b.ORIGINATION:return Object.assign(Object.assign(Object.assign(Object.assign({},F),{balance:typeof F.balance<"u"?`${F.balance}`:"0"}),W(F)),M(F));case b.TRANSACTION:{const hr=Object.assign(Object.assign(Object.assign(Object.assign({},F),{amount:typeof F.amount<"u"?`${F.amount}`:"0"}),W(F)),M(F));if(hr.source.toLowerCase().startsWith("kt1"))throw new Ts(`KT1 addresses are not supported as source since ${it.PsBabyM1}`);return hr}case b.REVEAL:case b.DELEGATION:case b.REGISTER_GLOBAL_CONSTANT:case b.TX_ROLLUP_ORIGINATION:case b.TX_ROLLUP_SUBMIT_BATCH:return Object.assign(Object.assign(Object.assign({},F),W(F)),M(F));case b.TRANSFER_TICKET:return Object.assign(Object.assign(Object.assign(Object.assign({},F),{ticket_amount:`${F.ticket_amount}`}),W(F)),M(F));case b.INCREASE_PAID_STORAGE:return Object.assign(Object.assign(Object.assign(Object.assign({},F),{amount:`${F.amount}`}),W(F)),M(F));default:throw new Ne(F.kind)}}))(s);return{opOb:{branch:p,contents:A,protocol:m},counter:S}})}forge({opOb:{branch:t,contents:e,protocol:i},counter:n}){return f(this,void 0,void 0,function*(){return{opbytes:yield this.context.forger.forge({branch:t,contents:e}),opOb:{branch:t,contents:e,protocol:i},counter:n}})}simulate(t){return f(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.runOperation(t),op:t,context:this.context.clone()}})}estimate(t,e){var{fee:i,gasLimit:n,storageLimit:s}=t,o=ee(t,["fee","gasLimit","storageLimit"]);return f(this,void 0,void 0,function*(){let a=i,c=n,h=s;if(i===void 0||n===void 0||s===void 0){const p=yield e(Object.assign({fee:i,gasLimit:n,storageLimit:s},o));a===void 0&&(a=p.suggestedFeeMutez),c===void 0&&(c=p.gasLimit),h===void 0&&(h=p.storageLimit)}return{fee:a,gasLimit:c,storageLimit:h}})}signAndInject(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.sign(t.opbytes,new Uint8Array([3]));t.opbytes=e.sbytes,t.opOb.signature=e.prefixSig;const i=[],n=yield this.rpc.preapplyOperations([t.opOb]);if(!Array.isArray(n))throw new Hl(n);for(let o=0;o<n.length;o++)for(let a=0;a<n[o].contents.length;a++)i.push(n[o].contents[a]);const s=or(n);if(s.length)throw new Do(s,"Error occurred during validation simulation of operation");return{hash:yield this.context.injector.inject(t.opbytes),forgedBytes:t,opResponse:i,context:this.context.clone()}})}}const ko=[b.ACTIVATION,b.ORIGINATION,b.TRANSACTION,b.DELEGATION];class Bo extends li{constructor(t,e){super(t),this.estimator=e,this.operations=[]}withTransfer(t){if(z(t.to)!==I.VALID)throw new Y(t.to);return this.operations.push(Object.assign({kind:b.TRANSACTION},t)),this}withTransferTicket(t){if(ge(t.destination)!==I.VALID)throw new me(t.destination);return this.operations.push(Object.assign({kind:b.TRANSFER_TICKET},t)),this}withContractCall(t,e={}){return this.withTransfer(t.toTransferParams(e))}withDelegation(t){if(t.source&&z(t.source)!==I.VALID)throw new Y(t.source);if(t.delegate&&z(t.delegate)!==I.VALID)throw new Y(t.delegate);return this.operations.push(Object.assign({kind:b.DELEGATION},t)),this}withActivation({pkh:t,secret:e}){if(Hi(t)!==I.VALID)throw new Ki(t);return this.operations.push({kind:b.ACTIVATION,pkh:t,secret:e}),this}withOrigination(t){return this.operations.push(Object.assign({kind:b.ORIGINATION},t)),this}withRegisterGlobalConstant(t){return this.operations.push(Object.assign({kind:b.REGISTER_GLOBAL_CONSTANT},t)),this}withIncreasePaidStorage(t){return this.operations.push(Object.assign({kind:b.INCREASE_PAID_STORAGE},t)),this}withTxRollupOrigination(t){return this.operations.push(Object.assign({kind:b.TX_ROLLUP_ORIGINATION},t)),this}withTxRollupSubmitBatch(t){return this.operations.push(Object.assign({kind:b.TX_ROLLUP_SUBMIT_BATCH},t)),this}getRPCOp(t){return f(this,void 0,void 0,function*(){switch(t.kind){case b.TRANSACTION:return Xr(Object.assign({},t));case b.ORIGINATION:return Zr(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case b.DELEGATION:return Qr(Object.assign({},t));case b.ACTIVATION:return Object.assign({},t);case b.REGISTER_GLOBAL_CONSTANT:return ti(Object.assign({},t));case b.INCREASE_PAID_STORAGE:return ni(Object.assign({},t));case b.TX_ROLLUP_ORIGINATION:return ei(Object.assign({},t));case b.TX_ROLLUP_SUBMIT_BATCH:return ri(Object.assign({},t));case b.TRANSFER_TICKET:return ii(Object.assign({},t));default:throw new Ne(t.kind)}})}with(t){for(const e of t)switch(e.kind){case b.TRANSACTION:this.withTransfer(e);break;case b.ORIGINATION:this.withOrigination(e);break;case b.DELEGATION:this.withDelegation(e);break;case b.ACTIVATION:this.withActivation(e);break;case b.REGISTER_GLOBAL_CONSTANT:this.withRegisterGlobalConstant(e);break;case b.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;case b.TX_ROLLUP_ORIGINATION:this.withTxRollupOrigination(e);break;case b.TX_ROLLUP_SUBMIT_BATCH:this.withTxRollupSubmitBatch(e);break;case b.TRANSFER_TICKET:this.withTransferTicket(e);break;default:throw new Ne(e.kind)}return this}send(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.signer.publicKey(),n=yield this.estimator.batch(this.operations),s=yield this.isRevealOpNeeded(this.operations,e);let o=s?1:0;const a=[];for(const W of this.operations){if(Co(W)){const x=yield this.estimate(W,()=>f(this,void 0,void 0,function*(){return n[o]}));a.push(yield this.getRPCOp(Object.assign(Object.assign({},W),x)))}else a.push(Object.assign({},W));o++}if(s){const W={kind:b.REVEAL},x=yield this.estimate(W,()=>f(this,void 0,void 0,function*(){return n[0]}));a.unshift(yield Er(Object.assign({},x),e,i))}const c=t&&t.source||e,h=yield this.prepareOperation({operation:a,source:c}),p=yield this.forge(h),{hash:m,context:E,forgedBytes:S,opResponse:M}=yield this.signAndInject(p);return new zl(m,a,c,S,M,E)})}}class Wl{constructor(t,e){this.context=t,this.estimator=e}batch(t){const e=new Bo(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}const ql=(r,{ALLOCATION_BURN:t,ORIGINATION_BURN:e}={ALLOCATION_BURN:257,ORIGINATION_BURN:257})=>{w.config({DECIMAL_PLACES:0,ROUNDING_MODE:w.ROUND_UP});const i=Xt({contents:r});let n=new w(0),s=new w(0),o=new w(0),a=new w(0),c=new w(0),h=new w(0);return i.forEach(p=>{o=o.plus(p.fee||0),a=a.plus(Array.isArray(p.originated_contracts)?p.originated_contracts.length*e:0),c=c.plus("allocated_destination_contract"in p?t:0),n=n.plus(p.consumed_milligas||0),h=h.plus("paid_storage_size_diff"in p&&Number(p.paid_storage_size_diff)||0)}),s=s.plus(c).plus(a).plus(h),{totalFee:o,totalMilliGas:n,totalGas:n.dividedBy(1e3),totalStorage:s,totalAllocationBurn:c,totalOriginationBurn:a,totalPaidStorageDiff:h,totalStorageBurn:new w(s.multipliedBy(Ll))}},Jl=60;class Pr{constructor(t,e,i){if(this.opHash=t,this.context=e,this._newHead$=i,this._operationResult=new yr(1),this._includedInBlock=new yr(1),this._included=!1,this.newHead$=this._newHead$.pipe(Yt(n=>{var s,o;const a=(o=(s=this.lastHead)===null||s===void 0?void 0:s.header.level)!==null&&o!==void 0?o:n.header.level-1;return Zi(a+1,n.header.level-a-1).pipe(Or(c=>this.context.readProvider.getBlock(c)),Hs(n))}),Gr(n=>this.lastHead=n),Ri(1),gr()),this.confirmed$=this.newHead$.pipe(Ke(n=>{for(const s of n.operations)for(const o of s)if(o.hash===this.opHash)return this._included=!0,this._includedInBlock.next(n),this._operationResult.next(o.contents),n}),Kr(n=>typeof n<"u"),le(),Ri(1),gr()),Os(this.opHash)!==I.VALID)throw new Ps(this.opHash);this.confirmed$.pipe(le(),Xi(()=>ar(void 0))).subscribe()}operationResults(){return f(this,void 0,void 0,function*(){return this._operationResult.pipe(le()).toPromise()})}receipt(){return f(this,void 0,void 0,function*(){return ql(yield this.operationResults())})}getCurrentConfirmation(){return f(this,void 0,void 0,function*(){return this._included?$n([this._includedInBlock,Fe(this.context.readProvider.getBlock("head"))]).pipe(Ke(([t,e])=>e.header.level-t.header.level+1),le()).toPromise():0})}isInCurrentBranch(t="head"){return f(this,void 0,void 0,function*(){if(!this._included)return!0;const e=yield this.context.readProvider.getBlockLevel(t),i=yield this._includedInBlock.pipe(le()).toPromise(),n=e-i.header.level;if(n<=0)return!0;const s=Math.min(i.header.level+n,i.header.level+Jl);return new Set(yield this.context.readProvider.getLiveBlocks(s)).has(i.hash)})}confirmationObservable(t){if(typeof t<"u"&&t<1)throw new Mo("Confirmation count must be at least 1");const{defaultConfirmationCount:e}=this.context.config,i=t!==void 0?t:e;if(i===void 0)throw new Gl("Default confirmation count can not be undefined!");return $n([this._includedInBlock,this.newHead$]).pipe(Us(([,n],[,s])=>n.hash===s.hash),Ke(([n,s])=>({block:s,expectedConfirmation:i,currentConfirmation:s.header.level-n.header.level+1,completed:s.header.level-n.header.level>=i-1,isInCurrentBranch:()=>this.isInCurrentBranch(s.hash)})),Ic(({completed:n})=>!n,!0))}confirmation(t){return this.confirmationObservable(t).toPromise()}}class Yl extends Pr{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e,this.getOriginatedContractAddresses=()=>f(this,void 0,void 0,function*(){const s=(yield this.operationResults()).filter(a=>a.kind==="origination");let o=[];for(const a of s)a.metadata.operation_result.originated_contracts&&(o=[...o,...a.metadata.operation_result.originated_contracts]);return o})}revealOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.REVEAL)})}status(){return f(this,void 0,void 0,function*(){return this._included?(yield this.operationResults()).filter(e=>ko.indexOf(e.kind)!==-1).map(e=>ur(e)?e.metadata.operation_result.status:"unknown")[0]||"unknown":"pending"})}}class Zl extends Pr{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}revealOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.REVEAL)})}delegationOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.DELEGATION)})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.delegationOperation();return t?t.metadata.operation_result.status:"unknown"})}}class Xl extends Pr{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}originationOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();return ms(t,b.ORIGINATION)})}revealOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();return ms(t,b.REVEAL)})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.originationOperation();return t?t.metadata.operation_result.status:"unknown"})}contract(){return f(this,void 0,void 0,function*(){const t=yield this.originationOperation(),e=((t==null?void 0:t.metadata.operation_result.originated_contracts)||[])[0];return this.context.wallet.at(e)})}}class Ql extends Pr{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}revealOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.REVEAL)})}transactionOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.TRANSACTION)})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.transactionOperation();return t?t.metadata.operation_result.status:"unknown"})}}function tp(r){return function(e){return new oi(null).pipe(Gs(r,Ji(new Error("Confirmation polling timed out"))),ci(()=>e))}}const ep=(r,t,e)=>r.pipe(tp(t.config.confirmationPollingTimeoutSecond*1e3),Ri(1),gr());class rp{constructor(t){this.context=t,this.sharedHeadObs=Vs(()=>Io(this.context.stream.subscribeBlock("head")))}createNewHeadObservable(){return f(this,void 0,void 0,function*(){return ep(this.sharedHeadObs,this.context)})}createPastBlockWalker(t,e=1){return Fe(this.context.readProvider.getBlock(t)).pipe(Yt(i=>e===1?ar(i):Zi(i.header.level,e-1).pipe(_c(i),Or(n=>f(this,void 0,void 0,function*(){return this.context.readProvider.getBlock(typeof n=="number"?n:n.header.level)})))))}createHeadObservableFromConfig({blockIdentifier:t}){return f(this,void 0,void 0,function*(){const e=[];return t&&e.push(this.createPastBlockWalker(t)),e.push(yield this.createNewHeadObservable()),Hr(...e)})}createOperation(t,e={}){return f(this,void 0,void 0,function*(){return new Pr(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createBatchOperation(t,e={}){return f(this,void 0,void 0,function*(){return new Yl(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createTransactionOperation(t,e={}){return f(this,void 0,void 0,function*(){return new Ql(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createDelegationOperation(t,e={}){return f(this,void 0,void 0,function*(){return new Zl(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createOriginationOperation(t,e={}){return f(this,void 0,void 0,function*(){return new Xl(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}}class ip extends li{constructor(t){super(t)}getBalance(t){return f(this,void 0,void 0,function*(){if(z(t)!==I.VALID)throw new Y(t);return this.context.readProvider.getBalance(t,"head")})}getDelegate(t){return f(this,void 0,void 0,function*(){if(z(t)!==I.VALID)throw new Y(t);return this.context.readProvider.getDelegate(t,"head")})}activate(t,e){return f(this,void 0,void 0,function*(){if(Hi(t)!==I.VALID)throw new Ki(t);const i={kind:b.ACTIVATION,pkh:t,secret:e},n=yield this.prepareOperation({operation:[i],source:t}),s=yield this.forge(n),o=`${s.opbytes}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`;return new Ct(yield this.rpc.injectOperation(o),Object.assign(Object.assign({},s),{opbytes:o}),[],this.context.clone())})}}const Cr=100,np=1,sp=.1,ys=100;class ft{constructor(t,e,i,n,s=Cr){this._milligasLimit=t,this._storageLimit=e,this.opSize=i,this.minimalFeePerStorageByteMutez=n,this.baseFeeMutez=s}get burnFeeMutez(){return this.roundUp(Number(this.storageLimit)*Number(this.minimalFeePerStorageByteMutez))}get storageLimit(){const t=Math.max(Number(this._storageLimit),0);return t>0?t:0}get gasLimit(){return this.roundUp(Number(this._milligasLimit)/1e3+ys)}get operationFeeMutez(){return(Number(this._milligasLimit)/1e3+ys)*sp+Number(this.opSize)*np}roundUp(t){return Math.ceil(Number(t))}get minimalFeeMutez(){return this.roundUp(Cr+this.operationFeeMutez)}get suggestedFeeMutez(){return this.roundUp(this.operationFeeMutez+Cr*2)}get usingBaseFeeMutez(){return Math.max(Number(this.baseFeeMutez),Cr)+this.roundUp(this.operationFeeMutez)}get totalCost(){return this.minimalFeeMutez+this.burnFeeMutez}get consumedMilligas(){return Number(this._milligasLimit)}static createEstimateInstanceFromProperties(t){let e=0,i=0,n=0,s=0,o;return t.forEach(a=>{e+=a.milligasLimit,i+=a.storageLimit,n+=a.opSize,s=Math.max(a.minimalFeePerStorageByteMutez,s),a.baseFeeMutez&&(o=o?o+a.baseFeeMutez:a.baseFeeMutez)}),new ft(e,i,n,s,o)}static createArrayEstimateInstancesFromProperties(t){return t.map(e=>new ft(e.milligasLimit,e.storageLimit,e.opSize,e.minimalFeePerStorageByteMutez,e.baseFeeMutez))}}class bs extends Error{constructor(){super("Unable to estimate the reveal operation, the public key is unknown"),this.name="Reveal Estimate Error"}}const at=(r,t)=>({fee:typeof r.fee>"u"?t.fee:r.fee,gasLimit:typeof r.gasLimit>"u"?t.gasLimit:r.gasLimit,storageLimit:typeof r.storageLimit>"u"?t.storageLimit:r.storageLimit}),op="edsigtkpiSSschcaCt9pUVrpNPf7TTcgvgDEDD6NCEHMy8NNQJCGnMfLZzYoQj74yLjo9wx6MPVV29CvVzgi7qEcEUok3k7AuMg";class ap extends li{constructor(){super(...arguments),this.ALLOCATION_STORAGE=257,this.ORIGINATION_STORAGE=257,this.OP_SIZE_REVEAL=128}getKeys(){return f(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{publicKeyHash:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}getAccountLimits(t,e,i){return f(this,void 0,void 0,function*(){const n=yield this.context.readProvider.getBalance(t,"head"),{hard_gas_limit_per_operation:s,hard_gas_limit_per_block:o,hard_storage_limit_per_operation:a,cost_per_byte:c}=e;return{fee:0,gasLimit:i?Math.floor(this.ajustGasForBatchOperation(o,s,i).toNumber()):s.toNumber(),storageLimit:Math.floor(w.min(n.dividedBy(c),a).toNumber())}})}ajustGasForBatchOperation(t,e,i){return w.min(e,t.div(i+1))}getEstimationPropertiesFromOperationContent(t,e,i,n){const s=Xt({contents:[t]});let o=0,a=0;return s.forEach(c=>{a+="originated_contracts"in c&&typeof c.originated_contracts<"u"?c.originated_contracts.length*this.ORIGINATION_STORAGE:0,a+="allocated_destination_contract"in c?this.ALLOCATION_STORAGE:0,o+=Number(c.consumed_milligas)||0,a+="paid_storage_size_diff"in c&&Number(c.paid_storage_size_diff)||0,a+="storage_size"in c&&"global_address"in c&&Number(c.storage_size)||0,a+="originated_rollup"in c?n:0}),Co(t)?{milligasLimit:o||0,storageLimit:Number(a||0),opSize:e,minimalFeePerStorageByteMutez:i.toNumber()}:{milligasLimit:0,storageLimit:0,opSize:e,minimalFeePerStorageByteMutez:i.toNumber(),baseFeeMutez:0}}prepareEstimate(t,e,i){return f(this,void 0,void 0,function*(){const n=yield this.prepareOperation(t,i),{opbytes:s,opOb:{branch:o,contents:a}}=yield this.forge(n),c={operation:{branch:o,contents:a,signature:op},chain_id:yield this.context.readProvider.getChainId()},{opResponse:h}=yield this.simulate(c),{cost_per_byte:p,tx_rollup_origination_size:m}=e,E=[...or(h,"backtracked"),...or(h)];if(E.length)throw new Do(E,"Error occurred during estimation");let S=1;return Array.isArray(t.operation)&&t.operation.length>1&&(S=h.contents[0].kind==="reveal"?t.operation.length-1:t.operation.length),h.contents.map(M=>this.getEstimationPropertiesFromOperationContent(M,M.kind==="reveal"?this.OP_SIZE_REVEAL/2:s.length/2/S,p,m!=null?m:0))})}originate(t){var{fee:e,storageLimit:i,gasLimit:n}=t,s=ee(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{publicKeyHash:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield Zr(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},s),at({fee:e,storageLimit:i,gasLimit:n},c)))),p=yield this.isRevealOpNeeded([h],o),m=p?yield this.addRevealOp([h],o):h,E=yield this.prepareEstimate({operation:m,source:o},a,o);return p&&E.shift(),ft.createEstimateInstanceFromProperties(E)})}transfer(t){var{fee:e,storageLimit:i,gasLimit:n}=t,s=ee(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){if(z(s.to)!==I.VALID)throw new Y(s.to);if(s.source&&z(s.source)!==I.VALID)throw new Y(s.source);const o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield Xr(Object.assign(Object.assign({},s),at({fee:e,storageLimit:i,gasLimit:n},c))),p=yield this.isRevealOpNeeded([h],o),m=p?yield this.addRevealOp([h],o):h,E=yield this.prepareEstimate({operation:m,source:o},a,o);return p&&E.shift(),ft.createEstimateInstanceFromProperties(E)})}transferTicket(t){var e,{fee:i,storageLimit:n,gasLimit:s}=t,o=ee(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){if(ge(o.destination)!==I.VALID)throw new me(o.destination);if(o.source&&z(o.source)!==I.VALID)throw new Y((e=o.source)!==null&&e!==void 0?e:"");const a=(yield this.getKeys()).publicKeyHash,c=yield this.context.readProvider.getProtocolConstants("head"),h=yield this.getAccountLimits(a,c),p=yield ii(Object.assign(Object.assign({},o),at({fee:i,storageLimit:n,gasLimit:s},h))),m=yield this.isRevealOpNeeded([p],a),E=m?yield this.addRevealOp([p],a):p,S=yield this.prepareEstimate({operation:E,source:a},c,a);return m&&S.shift(),ft.createEstimateInstanceFromProperties(S)})}setDelegate(t){var{fee:e,gasLimit:i,storageLimit:n}=t,s=ee(t,["fee","gasLimit","storageLimit"]);return f(this,void 0,void 0,function*(){if(s.source&&z(s.source)!==I.VALID)throw new Y(s.source);if(s.delegate&&z(s.delegate)!==I.VALID)throw new Y(s.delegate);const o=(yield this.getKeys()).publicKeyHash,a=s.source||o,c=yield this.context.readProvider.getProtocolConstants("head"),h=yield this.getAccountLimits(a,c),p=yield Qr(Object.assign(Object.assign({},s),at({fee:e,storageLimit:n,gasLimit:i},h))),m=yield this.isRevealOpNeeded([p],o),E=m?yield this.addRevealOp([p],o):p,S=yield this.prepareEstimate({operation:E,source:o},c,o);return m&&S.shift(),ft.createEstimateInstanceFromProperties(S)})}batch(t){return f(this,void 0,void 0,function*(){const{publicKeyHash:e}=yield this.getKeys();let i=[];const n=yield this.context.readProvider.getProtocolConstants("head"),s=yield this.getAccountLimits(e,n,t.length);for(const c of t)switch(c.kind){case b.TRANSACTION:i.push(yield Xr(Object.assign(Object.assign({},c),at(c,s))));break;case b.ORIGINATION:i.push(yield Zr(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},c),at(c,s)))));break;case b.DELEGATION:i.push(yield Qr(Object.assign(Object.assign({},c),at(c,s))));break;case b.ACTIVATION:i.push(Object.assign(Object.assign({},c),s));break;case b.REGISTER_GLOBAL_CONSTANT:i.push(yield ti(Object.assign(Object.assign({},c),at(c,s))));break;case b.TX_ROLLUP_ORIGINATION:i.push(yield ei(Object.assign(Object.assign({},c),at(c,s))));break;case b.TX_ROLLUP_SUBMIT_BATCH:i.push(yield ri(Object.assign(Object.assign({},c),at(c,s))));break;case b.TRANSFER_TICKET:i.push(yield ii(Object.assign(Object.assign({},c),at(c,s))));break;case b.INCREASE_PAID_STORAGE:i.push(yield ni(Object.assign(Object.assign({},c),at(c,s))));break;default:throw new Ne(t.kind)}i=(yield this.isRevealOpNeeded(i,e))?yield this.addRevealOp(i,e):i;const a=yield this.prepareEstimate({operation:i,source:e},n,e);return ft.createArrayEstimateInstancesFromProperties(a)})}registerDelegate(t){return f(this,void 0,void 0,function*(){const e=(yield this.getKeys()).publicKeyHash,i=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.getAccountLimits(e,i),s=yield Lo(Object.assign(Object.assign({},t),n),e),o=yield this.isRevealOpNeeded([s],e),a=o?yield this.addRevealOp([s],e):s,c=yield this.prepareEstimate({operation:a,source:e},i,e);return o&&c.shift(),ft.createEstimateInstanceFromProperties(c)})}reveal(t){return f(this,void 0,void 0,function*(){const{publicKeyHash:e,publicKey:i}=yield this.getKeys();if(!i)throw new bs;if(yield this.isAccountRevealRequired(e)){const n=yield this.context.readProvider.getProtocolConstants("head"),s=yield this.getAccountLimits(e,n),o=yield Er(Object.assign(Object.assign({},t),s),e,i),a=yield this.prepareEstimate({operation:o,source:e},n,e);return ft.createEstimateInstanceFromProperties(a)}})}registerGlobalConstant(t){var{fee:e,storageLimit:i,gasLimit:n}=t,s=ee(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield ti(Object.assign(Object.assign({},s),at({fee:e,storageLimit:i,gasLimit:n},c))),p=yield this.isRevealOpNeeded([h],o),m=p?yield this.addRevealOp([h],o):h,E=yield this.prepareEstimate({operation:m,source:o},a,o);return p&&E.shift(),ft.createEstimateInstanceFromProperties(E)})}increasePaidStorage(t){return f(this,void 0,void 0,function*(){const{fee:e,storageLimit:i,gasLimit:n}=t,s=ee(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield ni(Object.assign(Object.assign({},s),at({fee:e,storageLimit:i,gasLimit:n},c))),p=yield this.isRevealOpNeeded([h],o),m=p?yield this.addRevealOp([h],o):h,E=yield this.prepareEstimate({operation:m,source:o},a,o);return p&&E.shift(),ft.createEstimateInstanceFromProperties(E)})}txRollupOriginate(t){return f(this,void 0,void 0,function*(){t=t||{};const{fee:e,storageLimit:i,gasLimit:n}=t,s=ee(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield ei(Object.assign(Object.assign({},s),at({fee:e,storageLimit:i,gasLimit:n},c))),p=yield this.isRevealOpNeeded([h],o),m=p?yield this.addRevealOp([h],o):h,E=yield this.prepareEstimate({operation:m,source:o},a,o);return p&&E.shift(),ft.createEstimateInstanceFromProperties(E)})}txRollupSubmitBatch(t){return f(this,void 0,void 0,function*(){const{fee:e,storageLimit:i,gasLimit:n}=t,s=ee(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield ri(Object.assign(Object.assign({},s),at({fee:e,storageLimit:i,gasLimit:n},c))),p=yield this.isRevealOpNeeded([h],o),m=p?yield this.addRevealOp([h],o):h,E=yield this.prepareEstimate({operation:m,source:o},a,o);return p&&E.shift(),ft.createEstimateInstanceFromProperties(E)})}addRevealOp(t,e){return f(this,void 0,void 0,function*(){const{publicKey:i}=yield this.getKeys();if(!i)throw new bs;return t.unshift(yield Er(Object.assign({fee:Me.REVEAL,gasLimit:De.REVEAL,storageLimit:ke.REVEAL}),e,yield this.signer.publicKey())),t})}}class Es extends Ct{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="delegation"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get delegate(){return this.params.delegate}get isRegisterOperation(){return this.delegate===this.source}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get consumedGas(){return w.config({DECIMAL_PLACES:0,ROUNDING_MODE:w.ROUND_UP}),this.consumedMilliGas?new w(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class cp extends Ct{constructor(t,e,i,n,s,o){super(t,i,n,s),this.params=e,this.contractProvider=o;const a=this.operationResults&&this.operationResults.originated_contracts;Array.isArray(a)&&(this.contractAddress=a[0])}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="origination"),e=t&&ur(t)&&t.metadata.operation_result;return e||void 0}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get consumedGas(){return w.config({DECIMAL_PLACES:0,ROUNDING_MODE:w.ROUND_UP}),this.consumedMilliGas?new w(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get storageDiff(){const t=this.operationResults&&this.operationResults.paid_storage_size_diff;return t||void 0}get storageSize(){const t=this.operationResults&&this.operationResults.storage_size;return t||void 0}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}contract(t,e){return f(this,void 0,void 0,function*(){if(!this.contractAddress)throw new Kl("No contract was originated in this operation");return yield this.confirmation(t,e),this.contractProvider.at(this.contractAddress)})}}class up extends Ct{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i,this.globalConstantHash=this.operationResults&&this.operationResults.global_address}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="register_global_constant"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get registeredExpression(){return this.params.value}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedGas(){return w.config({DECIMAL_PLACES:0,ROUNDING_MODE:w.ROUND_UP}),this.consumedMilliGas?new w(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class hp extends Ct{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="reveal");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get publicKey(){return this.params.public_key}sumProp(t,e){return t.reduce((i,n)=>e in n?Number(n[e])+i:i,0)}get consumedGas(){return w.config({DECIMAL_PLACES:0,ROUNDING_MODE:w.ROUND_UP}),new w(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(Xt({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(Xt({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(Xt({contents:this.operationResults}),"storage_size"))}get errors(){return or({contents:this.operationResults})}}class lp extends Ct{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="transaction");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get amount(){return new w(this.params.amount)}get destination(){return this.params.destination}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}sumProp(t,e){return t.reduce((i,n)=>e in n?Number(n[e])+i:i,0)}get consumedGas(){return w.config({DECIMAL_PLACES:0,ROUNDING_MODE:w.ROUND_UP}),new w(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(Xt({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(Xt({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(Xt({contents:this.operationResults}),"storage_size"))}get errors(){return or({contents:this.operationResults})}}class pp{constructor(t,e,i,n,s,o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=i,this.name=n,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}validateArgs(t,e,i){const n=e.ExtractSignatures();if(!n.find(s=>s.length===t.length))throw new xo(i,n,t)}get schema(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}getSignature(){if(this.isAnonymous){const t=this.parameterSchema.ExtractSignatures().find(e=>e[0]===this.name);if(t)return t.shift(),t}else{const t=this.parameterSchema.ExtractSignatures();return t.length==1?t[0]:t}}send(t={}){return this.provider instanceof pi?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:i,source:n,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:n,gasLimit:e,storageLimit:i,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:Ye,value:this.isAnonymous?this.parameterSchema.Encode(this.name,...this.args):this.parameterSchema.Encode(...this.args)}}}}class dp{constructor(t,e){this.id=t,this.provider=e}getSaplingDiff(t){return f(this,void 0,void 0,function*(){return this.provider.getSaplingDiffByID(this.id.toString(),t)})}getId(){return this.id.toString()}}class fp{constructor(t,e){this.walletProvider=t,this.context=e,this.operations=[]}withTransfer(t){if(z(t.to)!==I.VALID)throw new Y(t.to);return this.operations.push(Object.assign({kind:b.TRANSACTION},t)),this}withContractCall(t,e={}){return this.withTransfer(t.toTransferParams(e))}withDelegation(t){if(t.delegate&&z(t.delegate)!==I.VALID)throw new Y(t.delegate);return this.operations.push(Object.assign({kind:b.DELEGATION},t)),this}withOrigination(t){return this.operations.push(Object.assign({kind:b.ORIGINATION},t)),this}mapOperation(t){return f(this,void 0,void 0,function*(){switch(t.kind){case b.TRANSACTION:return this.walletProvider.mapTransferParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t}));case b.ORIGINATION:return this.walletProvider.mapOriginateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return this.context.parser.prepareCodeOrigination(Object.assign({},t))}));case b.DELEGATION:return this.walletProvider.mapDelegateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t}));default:throw new Ne(t.kind)}})}with(t){for(const e of t)switch(e.kind){case b.TRANSACTION:this.withTransfer(e);break;case b.ORIGINATION:this.withOrigination(e);break;case b.DELEGATION:this.withDelegation(e);break;default:throw new Ne(e.kind)}return this}send(){return f(this,void 0,void 0,function*(){const t=[];for(const i of this.operations)t.push(yield this.mapOperation(i));const e=yield this.walletProvider.sendOperations(t);return this.context.operationFactory.createBatchOperation(e)})}}class pi{constructor(t){this.context=t,this.walletCommand=e=>({send:e})}get walletProvider(){return this.context.walletProvider}pkh({forceRefetch:t}={}){return f(this,void 0,void 0,function*(){return(!this._pkh||t)&&(this._pkh=yield this.walletProvider.getPKH()),this._pkh})}originate(t){return this.walletCommand(()=>f(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapOriginateParamsToWalletParams(()=>this.context.parser.prepareCodeOrigination(Object.assign({},t))),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createOriginationOperation(i)}))}setDelegate(t){if(t.delegate&&z(t.delegate)!==I.VALID)throw new Y(t.delegate);return this.walletCommand(()=>f(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createDelegationOperation(i)}))}registerDelegate(){return this.walletCommand(()=>f(this,void 0,void 0,function*(){const t=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return{delegate:yield this.pkh()}})),e=yield this.walletProvider.sendOperations([t]);return this.context.operationFactory.createDelegationOperation(e)}))}transfer(t){if(z(t.to)!==I.VALID)throw new Y(t.to);return this.walletCommand(()=>f(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapTransferParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createTransactionOperation(i)}))}batch(t){const e=new fp(this.walletProvider,this.context);return Array.isArray(t)&&e.with(t),e}at(t,e=i=>i){return f(this,void 0,void 0,function*(){if(ge(t)!==I.VALID)throw new me(t);const i=this.context.withExtensions().rpc,n=this.context.withExtensions().readProvider,s=yield n.getScript(t,"head"),o=yield n.getEntrypoints(t),a=new $o(t,s,this,this.context.contract,o,i,n);return e(a,this.context)})}}class jo{constructor(t){this.context=t}getPKH(){return f(this,void 0,void 0,function*(){return this.context.signer.publicKeyHash()})}mapTransferParamsToWalletParams(t){return f(this,void 0,void 0,function*(){return Ai(yield t(),b.TRANSACTION)})}mapOriginateParamsToWalletParams(t){return f(this,void 0,void 0,function*(){return Ai(yield t(),b.ORIGINATION)})}mapDelegateParamsToWalletParams(t){return f(this,void 0,void 0,function*(){return Ai(yield t(),b.DELEGATION)})}sendOperations(t){return f(this,void 0,void 0,function*(){return(yield this.context.batch.batch(t).send()).hash})}}class gp{constructor(t,e,i,n,s="unit",o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=i,this.name=n,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}getSignature(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}send(t={}){return this.provider instanceof pi?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:i,source:n,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:n,gasLimit:e,storageLimit:i,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:Ye,value:this.isAnonymous?this.parameterSchema.EncodeObject({[this.name]:this.args}):this.parameterSchema.EncodeObject(this.args)}}}}const mp=(r,t,e,i,n,s,o,a,c,h="0")=>({script:[{prim:"parameter",args:[{prim:"pair",args:[r,e]}]},{prim:"storage",args:[{prim:"option",args:[t]}]},{prim:"code",args:[[{prim:"CAR"},i,{prim:"SOME"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}],storage:{prim:"None"},input:{prim:"Pair",args:[n,s]},amount:h,balance:o,chain_id:a,source:c});class yp{constructor(t,e,i,n,s,o="Unit"){this._rpc=t,this._readProvider=e,this._contractAddress=i,this._smartContractViewSchema=n,this._contractStorageType=s,this._args=o}getSignature(){return{parameter:this._smartContractViewSchema.extractArgsSchema(),result:this._smartContractViewSchema.extractResultSchema()}}executeView(t){return f(this,void 0,void 0,function*(){const e=(yield this._rpc.getProtocols()).protocol;if(e===it.PtJakart2){this.verifyContextExecution(t);const i=(yield this._readProvider.getBalance(this._contractAddress,"head")).toString(),n=yield this._readProvider.getChainId(),s=yield this._readProvider.getStorage(this._contractAddress,"head");return this.executeViewAndDecodeResult(mp(this._smartContractViewSchema.viewArgsType,this._smartContractViewSchema.viewReturnType,this._contractStorageType,this.adaptViewCodeToContext(this._smartContractViewSchema.instructions,t.viewCaller,i),this.transformArgsToMichelson(),s,i,n,t.source),e)}else{this.verifyContextExecution(t);const i=yield this._readProvider.getChainId(),n=this.transformArgsToMichelson(),s={contract:this._contractAddress,view:this._smartContractViewSchema.viewName,input:n,chain_id:i,source:t.viewCaller};return t.source&&(s.payer=t.source),this.executeViewAndDecodeResult(s,e)}})}verifyContextExecution(t){if(t.source&&z(t.source)!==I.VALID)throw new gs(`The source account who initialized the view execution is invalid: ${t.source}.`);if(!t.viewCaller||z(t.viewCaller)!==I.VALID)throw new gs(`The contract which is the caller of view is invalid: ${t.viewCaller}.`)}transformArgsToMichelson(){try{return this._smartContractViewSchema.encodeViewArgs(this._args)}catch(t){throw new Dl(this._smartContractViewSchema.viewName,this.getSignature(),this._args,t)}}adaptViewCodeToContext(t,e,i){const n={BALANCE:[{prim:"PUSH",args:[{prim:"mutez"},{int:i}]}],SENDER:[{prim:"PUSH",args:[{prim:"address"},{string:e}]}],SELF_ADDRESS:[{prim:"PUSH",args:[{prim:"address"},{string:this._contractAddress}]}],AMOUNT:[{prim:"PUSH",args:[{prim:"mutez"},{int:"0"}]}]};return t.forEach((s,o)=>{s.prim in n&&(t[o]=Object(n)[s.prim]),s.args&&s.args.length!==0?this.adaptViewCodeToContext(s.args,e,i):Array.isArray(s)&&this.adaptViewCodeToContext(s,e,i)}),t}executeViewAndDecodeResult(t,e){return f(this,void 0,void 0,function*(){if(e===it.PtJakart2){let i;try{i=(yield this._rpc.runCode(t)).storage}catch(n){const s=fs(n);throw s?new _i(`The simulation of the on-chain view named ${this._smartContractViewSchema.viewName} failed with: ${JSON.stringify(s)}`,this._smartContractViewSchema.viewName,s,n):n}if(!i.args)throw new _i(`View simulation failed with an invalid result: ${i}`,this._smartContractViewSchema.viewName);return this._smartContractViewSchema.decodeViewResult(i.args[0])}else{let i;try{i=(yield this._rpc.runScriptView(t)).data}catch(n){const s=fs(n);throw s?new _i(`The simulation of the on-chain view named ${this._smartContractViewSchema.viewName} failed with: ${JSON.stringify(s)}`,this._smartContractViewSchema.viewName,s,n):n}return this._smartContractViewSchema.decodeViewResult(i)}})}}class bp{constructor(t,e){this.provider=t,this.contractAddress=e}createContractMethodFlatParams(t,e,i,n=!0,s=!1){return new pp(this.provider,this.contractAddress,t,e,i,n,s)}createContractMethodObjectParam(t,e,i,n=!0,s=!1){return new gp(this.provider,this.contractAddress,t,e,i,n,s)}createContractViewObjectParam(t,e,i,n,s){return new yp(t,e,this.contractAddress,i,n,s)}}const Ye="default";class Ep{constructor(t,e,i,n,s,o,a){this.currentContract=t,this.name=e,this.callbackParametersSchema=i,this.parameterSchema=n,this.args=s,this.rpc=o,this.readProvider=a}read(t){return f(this,void 0,void 0,function*(){if(ge(t!=null?t:"")==I.VALID)throw new Ts("Since version 12, the lambda view no longer depends on a lambda contract. The read method no longer accepts a contract address as a parameter.");if(t&&_s(t)!==I.VALID)throw new ia(t);const e=this.parameterSchema.Encode(...this.args),i=yield this.rpc.runView({contract:this.currentContract.address,entrypoint:this.name,input:e,chain_id:t||(yield this.readProvider.getChainId())});return this.callbackParametersSchema.Execute(i.data)})}}const vp=(r,t,e)=>{const i=t.ExtractSignatures();if(!i.find(n=>n.length===r.length))throw new xo(e,i,r)},wp=r=>{let t=!1;if("prim"in r&&r.prim==="pair"&&r.args){const e=r.args[r.args.length-1];"prim"in e&&e.prim==="contract"&&(t=!0)}return t};class $o{constructor(t,e,i,n,s,o,a){this.address=t,this.script=e,this.storageProvider=n,this.entrypoints=s,this.rpc=o,this.readProvider=a,this.methods={},this.methodsObject={},this.views={},this.contractViews={},this.contractMethodFactory=new bp(i,t),this.schema=Et.fromRPCResponse({script:this.script}),this.parameterSchema=Je.fromRPCResponse({script:this.script}),this.viewSchema=Qi.fromRPCResponse({script:this.script}),this.viewSchema.length!==0&&this._initializeOnChainViews(this,o,this.readProvider,this.viewSchema),this._initializeMethods(this,this.entrypoints.entrypoints,this.rpc,this.readProvider)}_initializeMethods(t,e,i,n){const s=this.parameterSchema,o=Object.keys(e);if(s.isMultipleEntryPoint)o.forEach(c=>{const h=new Je(e[c]);if(this.methods[c]=function(...p){return t.contractMethodFactory.createContractMethodFlatParams(h,c,p)},this.methodsObject[c]=function(p){return t.contractMethodFactory.createContractMethodObjectParam(h,c,p)},wp(e[c])){const p=function(...m){const E=e[c].args[0],S=new Je(E),M=e[c].args[1].args[0],W=new Je(M);return vp(m,S,c),new Ep(t,c,W,S,m,i,n)};this.views[c]=p}}),Object.keys(s.ExtractSchema()).filter(c=>Object.keys(e).indexOf(c)===-1).forEach(c=>{this.methods[c]=function(...h){return t.contractMethodFactory.createContractMethodFlatParams(s,c,h,!1,!0)},this.methodsObject[c]=function(h){return t.contractMethodFactory.createContractMethodObjectParam(s,c,h,!1,!0)}});else{const a=this.parameterSchema;this.methods[Ye]=function(...c){return t.contractMethodFactory.createContractMethodFlatParams(a,Ye,c,!1)},this.methodsObject[Ye]=function(c){return t.contractMethodFactory.createContractMethodObjectParam(a,Ye,c,!1)}}}_initializeOnChainViews(t,e,i,n){const s=this.schema.val;n.forEach(o=>{this.contractViews[o.viewName]=function(a){return t.contractMethodFactory.createContractViewObjectParam(e,i,o,s,a)}})}storage(){return this.storageProvider.getStorage(this.address,this.schema)}bigMap(t){return this.storageProvider.getBigMapKey(this.address,t,this.schema)}}class Sp{constructor(t,e,i){this.id=t,this.schema=e,this.provider=i}get(t,e){return f(this,void 0,void 0,function*(){try{return yield this.provider.getBigMapKeyByID(this.id.toString(),t,this.schema,e)}catch(i){if(i instanceof vr&&i.status===Vi.NOT_FOUND)return;throw i}})}getMultipleValues(t,e,i=5){return f(this,void 0,void 0,function*(){return this.provider.getBigMapKeysByID(this.id.toString(),t,this.schema,e,i)})}toJSON(){return this.id.toString()}toString(){return this.id.toString()}}const vs=r=>({big_map:(t,e)=>{if(!t||!("int"in t)||t.int===void 0)return{};{const i=new Et(e);return new Sp(new w(t.int),i,r)}},sapling_state:t=>!t||!("int"in t)||t.int===void 0?{}:new dp(new w(t.int),r)});class _p extends Ct{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i,this.originatedRollup=this.operationResults&&this.operationResults.originated_rollup}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="tx_rollup_origination"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedGas(){return w.config({DECIMAL_PLACES:0,ROUNDING_MODE:w.ROUND_UP}),this.consumedMilliGas?new w(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class Ap extends Ct{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="tx_rollup_submit_batch"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get content(){return this.params.content}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedGas(){return w.config({DECIMAL_PLACES:0,ROUNDING_MODE:w.ROUND_UP}),this.consumedMilliGas?new w(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class Op extends Ct{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind===b.TRANSFER_TICKET),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get consumedGas(){return w.config({DECIMAL_PLACES:0,ROUNDING_MODE:w.ROUND_UP}),this.consumedMilliGas?new w(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class Pp extends Ct{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="increase_paid_storage"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get amount(){return this.params.amount}get destination(){return this.params.destination}}class Tp extends li{constructor(t,e){super(t),this.estimator=e,this.contractProviderTypeSymbol=Symbol.for("taquito--provider-type-symbol")}getStorage(t,e){return f(this,void 0,void 0,function*(){if(ge(t)!==I.VALID)throw new me(t);const i=yield this.context.readProvider.getScript(t,"head");e||(e=i);let n;return Et.isSchema(e)?n=e:n=Et.fromRPCResponse({script:e}),n.Execute(i.storage,vs(this))})}getBigMapKey(t,e,i){return f(this,void 0,void 0,function*(){if(ge(t)!==I.VALID)throw new me(t);i||(i=(yield this.rpc.getContract(t)).script);let n;Et.isSchema(i)?n=i:n=Et.fromRPCResponse({script:i});const s=n.EncodeBigMapKey(e),o=yield this.rpc.getBigMapKey(t,s);return n.ExecuteOnBigMapValue(o)})}getBigMapKeyByID(t,e,i,n){return f(this,void 0,void 0,function*(){const{key:s,type:o}=i.EncodeBigMapKey(e),{packed:a}=yield this.context.packer.packData({data:s,type:o}),c=ra(a),h=n?yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},n):yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},"head");return i.ExecuteOnBigMapValue(h,vs(this))})}getBigMapKeysByID(t,e,i,n,s=5){return f(this,void 0,void 0,function*(){const o=yield this.getBlockForRequest(e,n),a=new bt;let c=0,h=[];for(;c<e.length;){const m=e.slice(c,c+s).map(E=>this.getBigMapValueOrUndefined(E,t,i,o));h=[...h,...yield Promise.all(m)],c+=s}for(let p=0;p<h.length;p++)a.set(e[p],h[p]);return a})}getBlockForRequest(t,e){return f(this,void 0,void 0,function*(){return t.length===1||typeof e<"u"?e:yield this.context.readProvider.getBlockLevel("head")})}getBigMapValueOrUndefined(t,e,i,n){return f(this,void 0,void 0,function*(){try{return yield this.getBigMapKeyByID(e,t,i,n)}catch(s){if(s instanceof vr&&s.status===Vi.NOT_FOUND)return;throw s}})}getSaplingDiffByID(t,e){return f(this,void 0,void 0,function*(){return e?yield this.context.readProvider.getSaplingDiffById({id:t.toString()},e):yield this.context.readProvider.getSaplingDiffById({id:t.toString()},"head")})}addRevealOperationIfNeeded(t,e){return f(this,void 0,void 0,function*(){if(Bi(t)){const i=[t],n=yield this.signer.publicKey(),s=yield this.estimator.reveal();if(s){const o={kind:b.REVEAL},a=yield this.estimate(o,()=>f(this,void 0,void 0,function*(){return s}));return i.unshift(yield Er(Object.assign({},a),e,n)),i}}return t})}originate(t){return f(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.originate.bind(this.estimator)),i=yield this.signer.publicKeyHash(),n=yield Zr(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},t),e))),s=yield this.addRevealOperationIfNeeded(n,i),o=yield this.prepareOperation({operation:s,source:i}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:p,opResponse:m}=yield this.signAndInject(a);return new cp(c,n,p,m,h,this)})}setDelegate(t){return f(this,void 0,void 0,function*(){if(t.source&&z(t.source)!==I.VALID)throw new Y(t.source);if(t.delegate&&z(t.delegate)!==I.VALID)throw new Y(t.delegate);if(/kt1/i.test(t.source))throw new Cl(t.source);const e=yield this.estimate(t,this.estimator.setDelegate.bind(this.estimator)),i=yield this.signer.publicKeyHash(),n=yield Qr(Object.assign(Object.assign({},t),e)),s=t.source||i,o=yield this.addRevealOperationIfNeeded(n,i),a=yield this.prepareOperation({operation:o,source:s}),c=yield this.forge(a),{hash:h,context:p,forgedBytes:m,opResponse:E}=yield this.signAndInject(c);return new Es(h,n,s,m,E,p)})}registerDelegate(t){return f(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.registerDelegate.bind(this.estimator)),i=yield this.signer.publicKeyHash(),n=yield Lo(Object.assign(Object.assign({},t),e),i),s=yield this.addRevealOperationIfNeeded(n,i),o=yield this.prepareOperation({operation:s}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:p,opResponse:m}=yield this.signAndInject(a);return new Es(c,n,i,p,m,h)})}transfer(t){return f(this,void 0,void 0,function*(){if(z(t.to)!==I.VALID)throw new Y(t.to);if(t.source&&z(t.source)!==I.VALID)throw new Y(t.source);const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.transfer.bind(this.estimator)),n=yield Xr(Object.assign(Object.assign({},t),i)),s=t.source||e,o=yield this.addRevealOperationIfNeeded(n,e),a=yield this.prepareOperation({operation:o,source:t.source}),c=yield this.forge(a),{hash:h,context:p,forgedBytes:m,opResponse:E}=yield this.signAndInject(c);return new lp(h,n,s,m,E,p)})}transferTicket(t){var e;return f(this,void 0,void 0,function*(){if(ge(t.destination)!==I.VALID)throw new me(t.destination);if(t.source&&z(t.source)!==I.VALID)throw new Y(t.source);const i=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.transferTicket.bind(this.estimator)),s=yield ii(Object.assign(Object.assign({},t),n)),o=(e=t.source)!==null&&e!==void 0?e:i,a=yield this.addRevealOperationIfNeeded(s,i),c=yield this.prepareOperation({operation:a,source:t.source}),h=yield this.forge(c),{hash:p,context:m,forgedBytes:E,opResponse:S}=yield this.signAndInject(h);return new Op(p,s,o,E,S,m)})}reveal(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimator.reveal(t);if(i){const n=yield this.estimate(t,()=>f(this,void 0,void 0,function*(){return i})),s=yield Er(Object.assign({},n),e,yield this.signer.publicKey()),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:p,opResponse:m}=yield this.signAndInject(a);return new hp(c,s,e,p,m,h)}else throw new kl(`The publicKeyHash '${e}' has already been revealed.`)})}registerGlobalConstant(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.registerGlobalConstant.bind(this.estimator)),n=yield ti(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:p,opResponse:m}=yield this.signAndInject(a);return new up(c,n,e,p,m,h)})}increasePaidStorage(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.increasePaidStorage.bind(this.estimator)),n=yield ni(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:p,opResponse:m}=yield this.signAndInject(a);return new Pp(c,n,e,p,m,h)})}txRollupOriginate(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t||{},this.estimator.txRollupOriginate.bind(this.estimator)),n=yield ei(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:p,opResponse:m}=yield this.signAndInject(a);return new _p(c,n,e,p,m,h)})}txRollupSubmitBatch(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.txRollupSubmitBatch.bind(this.estimator)),n=yield ri(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:p,opResponse:m}=yield this.signAndInject(a);return new Ap(c,n,e,p,m,h)})}at(t,e=i=>i){return f(this,void 0,void 0,function*(){if(ge(t)!==I.VALID)throw new me(t);const i=this.context.withExtensions().rpc,n=this.context.withExtensions().readProvider,s=yield n.getScript(t,"head"),o=yield n.getEntrypoints(t),a=new $o(t,s,this,this,o,i,n);return e(a,this.context)})}batch(t){const e=new Bo(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}class Vo{constructor(t){this.context=t}getNextProto(){return f(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}parseScript(t){return f(this,void 0,void 0,function*(){return new He({protocol:yield this.getNextProto()}).parseScript(t)})}parseMichelineExpression(t){return f(this,void 0,void 0,function*(){return new He({protocol:yield this.getNextProto()}).parseMichelineExpression(t)})}parseJSON(t){return f(this,void 0,void 0,function*(){return new He({protocol:yield this.getNextProto()}).parseJSON(t)})}prepareCodeOrigination(t){return f(this,void 0,void 0,function*(){const e=t;if(e.code=yield this.formatCodeParam(t.code),t.init)e.init=yield this.formatInitParam(t.init);else if(t.storage){const i=e.code.find(o=>"prim"in o&&o.prim==="storage");if(!(i!=null&&i.args))throw new Yr("The storage section is missing from the script",t.code);const n=new Et(i.args[0]),s=yield this.findGlobalConstantsHashAndValue(n);if(Object.keys(s).length!==0){const a=new He({expandGlobalConstant:s}).parseJSON(i.args[0]),c=new Et(a);e.init=c.Encode(t.storage)}else e.init=n.Encode(t.storage);delete e.storage}return e})}formatCodeParam(t){return f(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const i=yield this.parseScript(t);if(i===null)throw new Yr("Invalid code parameter",t);e=i}else{const i=yield this.parseJSON(t),n=["parameter","storage","code"];e=i.sort((s,o)=>n.indexOf(s.prim)-n.indexOf(o.prim))}return e})}formatInitParam(t){return f(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const i=yield this.parseMichelineExpression(t);if(i===null)throw new No("Invalid init parameter",t);e=i}else e=yield this.parseJSON(t);return e})}findGlobalConstantsHashAndValue(t){return f(this,void 0,void 0,function*(){const e=t.findToken("constant"),i={};if(e.length!==0)for(const n of e){const s=n.tokenVal.args;if(s){const o=s[0];if(o.string){const a=o.string,c=yield this.context.globalConstantsProvider.getGlobalConstantByHash(a);Object.assign(i,{[a]:c})}}}return i})}}class Uo{constructor(t){this.context=t}packData(t){return f(this,void 0,void 0,function*(){return this.context.rpc.packData(t)})}}class Rp extends Error{constructor(){super("No globalThis constants provider has been configured. Please configure one by calling setGlobalConstantsProvider({globalConstantsProvider}) on your TezosToolkit instance."),this.name="UnconfiguredGlobalConstantsProviderError"}}class Ho{getGlobalConstantByHash(t){return f(this,void 0,void 0,function*(){throw new Rp})}}class Ko{constructor(t){this.rpc=t}getBalance(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getBalance(t,{block:String(e)})})}getDelegate(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getDelegate(t,{block:String(e)})})}getNextProtocol(t){return f(this,void 0,void 0,function*(){return(yield this.rpc.getProtocols({block:String(t)})).next_protocol})}getProtocolConstants(t){return f(this,void 0,void 0,function*(){const{time_between_blocks:e,minimal_block_delay:i,hard_gas_limit_per_operation:n,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:c}=yield this.rpc.getConstants({block:String(t)});return{time_between_blocks:e,minimal_block_delay:i,hard_gas_limit_per_operation:n,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:c}})}getScript(t,e){return f(this,void 0,void 0,function*(){const{script:i}=yield this.rpc.getContract(t,{block:String(e)});return i})}getStorage(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getStorage(t,{block:String(e)})})}getBlockHash(t){return f(this,void 0,void 0,function*(){const{hash:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBlockLevel(t){return f(this,void 0,void 0,function*(){const{level:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getCounter(t,e){return f(this,void 0,void 0,function*(){const{counter:i}=yield this.rpc.getContract(t,{block:String(e)});return i||"0"})}getBlockTimestamp(t){return f(this,void 0,void 0,function*(){const{timestamp:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBigMapValue(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getBigMapExpr(t.id,t.expr,{block:String(e)})})}getSaplingDiffById(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffById(t.id,{block:String(e)})})}getSaplingDiffByContract(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffByContract(t,{block:String(e)})})}getEntrypoints(t){return f(this,void 0,void 0,function*(){return this.rpc.getEntrypoints(t)})}getChainId(){return f(this,void 0,void 0,function*(){return this.rpc.getChainId()})}isAccountRevealed(t,e){return f(this,void 0,void 0,function*(){const i=yield this.rpc.getManagerKey(t,{block:String(e)});return i&&typeof i=="object"?!!i.key:!!i})}getBlock(t){return f(this,void 0,void 0,function*(){return this.rpc.getBlock({block:String(t)})})}getLiveBlocks(t){return this.rpc.getLiveBlocks({block:String(t)})}}const Ip=(r,t)=>r.hash===t.opHash,xp=(r,t)=>{switch(r.kind){case"endorsement":return"metadata"in r&&r.metadata.delegate===t.source;case"activate_account":return"metadata"in r&&r.pkh===t.source;default:return"source"in r&&r.source===t.source}},Np=(r,t)=>"kind"in r&&r.kind===t.kind,Lp=(r,t)=>{switch(r.kind){case"delegation":return r.delegate===t.destination;case"origination":if("metadata"in r&&"operation_result"in r.metadata&&"originated_contracts"in r.metadata.operation_result&&Array.isArray(r.metadata.operation_result.originated_contracts))return r.metadata.operation_result.originated_contracts.some(e=>e===t.destination);break;case"transaction":return r.destination===t.destination;default:return!1}},Cp=(r,t,e)=>r.kind==="event"?t&&e?r.source===t&&r.tag===e:t&&!e?r.source===t:e?r.tag===e:!0:!1,Dp=(r,t)=>"opHash"in t?Ip(r,t):"source"in t?xp(r,t):"kind"in t?Np(r,t):"destination"in t?Lp(r,t):!1,Mp=(r,t)=>{if(Array.isArray(t.and))return t.and.every(e=>ji(r,e));if(Array.isArray(t.or))return t.or.some(e=>ji(r,e));throw new Fl("Filter expression must contain either and/or property")},ji=(r,t)=>{const e=[];return Array.isArray(t)?e.push(...t):e.push(t),e.every(i=>"and"in i||"or"in i?Mp(r,i):Dp(r,i))};class ws extends Error{constructor(t){super(t),this.message=t,this.name="UnsupportedEventError"}}class Dr{constructor(t,e=!1,i=Ks()){this.shouldRetry=e,this.operatorFunction=i,this.errorListeners=[],this.messageListeners=[],this.closeListeners=[],this.completed$=new tr,t.pipe(Pc(this.completed$),Gr(n=>{this.call(this.messageListeners,n)},n=>{this.call(this.errorListeners,n)},()=>{this.call(this.closeListeners)}),this.shouldRetry?i:Gr(),Xi(()=>Ya)).subscribe()}call(t,e){for(const i of t)try{i(e)}catch(n){console.error(n)}}remove(t,e){const i=t.indexOf(e);i!==-1&&t.splice(i,1)}on(t,e){switch(t){case"data":this.messageListeners.push(e);break;case"error":this.errorListeners.push(e);break;case"close":this.closeListeners.push(e);break;default:throw new ws(`Trying to register on an unsupported event: ${t}`)}}off(t,e){switch(t){case"data":this.remove(this.messageListeners,e);break;case"error":this.remove(this.errorListeners,e);break;case"close":this.remove(this.closeListeners,e);break;default:throw new ws(`Trying to unregister on an unsupported event: ${t}`)}}close(){this.completed$.next()}}const kp={shouldObservableSubscriptionRetry:!1,observableSubscriptionRetryFunction:Ks()},Bp=r=>Fe(r.rpc.getBlock()).pipe(le()),jp=r=>Or(t=>new Z(e=>{for(const i of t.operations)for(const n of i)for(const s of n.contents)ji(Object.assign({hash:n.hash},s),r)&&e.next(Object.assign({hash:n.hash},s));e.complete()})),$p=r=>Or(t=>new Z(e=>{for(const i of t.operations)for(const n of i)for(const s of n.contents){const a=s.metadata.internal_operation_results;if(a)for(const c of a)Cp(c,r==null?void 0:r.address,r==null?void 0:r.tag)&&e.next(Object.assign({opHash:n.hash,blockHash:t.hash,level:t.header.level},c))}e.complete()}));class $i{constructor(t,e={}){this.context=t,this._config$=new oi(Object.assign(Object.assign({},kp),e)),this.timer$=this._config$.pipe(Hn("pollingIntervalMilliseconds"),Yt(i=>i?Un(0,i):Fe(this.getConfirmationPollingInterval()).pipe(Yt(n=>Un(0,n))))),this.newBlock$=this.timer$.pipe(Yt(()=>Bp(this.context)),uc("hash"),Ec(),gr())}get config(){return this._config$.getValue()}getConfirmationPollingInterval(){return f(this,void 0,void 0,function*(){if(!this.config.pollingIntervalMilliseconds)try{const i=yield this.context.readProvider.getProtocolConstants("head"),s=(i.minimal_block_delay?i.minimal_block_delay.multipliedBy(1e3):i.time_between_blocks?i.time_between_blocks[0].multipliedBy(1e3):new w(5e3)).dividedBy(3);this.config.pollingIntervalMilliseconds=s.toNumber()===0?1e3:s.toNumber()}catch{return 5e3}return this.config.pollingIntervalMilliseconds})}subscribeBlock(t){return new Dr(this.newBlock$,this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribe(t){return new Dr(this.newBlock$.pipe(Hn("hash")),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeOperation(t){return new Dr(this.newBlock$.pipe(jp(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeEvent(t){return new Dr(this.newBlock$.pipe($p(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}}class Go{constructor(t){this.context=t}getNextProto(){return f(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}forge({branch:t,contents:e}){return f(this,void 0,void 0,function*(){return new Ro(yield this.getNextProto()).forge({branch:t,contents:e})})}}const Vp={defaultConfirmationCount:1,confirmationPollingTimeoutSecond:180};class si{constructor(t,e=new ki,i,n=new oi(Object.assign({},Vp)),s,o,a,c,h,p,m,E){this._rpc=t,this._signer=e,this._proto=i,this._config=n,this.providerDecorator=[],this.tz=new ip(this),this.estimate=new ap(this),this.contract=new Tp(this,this.estimate),this.batch=new Wl(this,this.estimate),this.wallet=new pi(this),this.withExtensions=()=>{let S=this.clone();return this.providerDecorator.forEach(M=>{S=M(S)}),S},typeof this._rpc=="string"?this._rpcClient=new Mr(this._rpc):this._rpcClient=this._rpc,this._forger=s||new Go(this),this._injector=o||new Nl(this),this.operationFactory=new rp(this),this._walletProvider=c||new jo(this),this._parser=h||new Vo(this),this._packer=a||new Uo(this),this._globalConstantsProvider=p||new Ho,this._readProvider=m||new Ko(this._rpcClient),this._stream=E||new $i(this)}get config(){return this._config.getValue()}set config(t){this._config.next(Object.assign({},t))}setPartialConfig(t){this._config.next(Object.assign(Object.assign({},this._config.getValue()),t))}get rpc(){return this._rpcClient}set rpc(t){this._rpcClient=t}get injector(){return this._injector}set injector(t){this._injector=t}get forger(){return this._forger}set forger(t){this._forger=t}get signer(){return this._signer}set signer(t){this._signer=t}get walletProvider(){return this._walletProvider}set walletProvider(t){this._walletProvider=t}set proto(t){this._proto=t}get proto(){return this._proto}get parser(){return this._parser}set parser(t){this._parser=t}get packer(){return this._packer}set packer(t){this._packer=t}get globalConstantsProvider(){return this._globalConstantsProvider}set globalConstantsProvider(t){this._globalConstantsProvider=t}get readProvider(){return this._readProvider}set readProvider(t){this._readProvider=t}get stream(){return this._stream}set stream(t){this._stream=t}isAnyProtocolActive(t=[]){return f(this,void 0,void 0,function*(){if(this._proto)return t.includes(this._proto);{const e=yield this.readProvider.getNextProtocol("head");return t.includes(e)}})}isAnySignerConfigured(){return!(this.signer instanceof ki)}clone(){return new si(this.rpc,this.signer,this.proto,this._config,this.forger,this._injector,this.packer,this._walletProvider,this._parser,this._globalConstantsProvider,this._readProvider,this._stream)}registerProviderDecorator(t){this.providerDecorator.push(t)}}const Up={commitHash:"232709b09cd380c4a70183a7e0b506d6bf2c2626",version:"14.1.0"};class Fp{constructor(t){this.context=t}forge({branch:t,contents:e}){return this.context.rpc.forgeOperations({branch:t,contents:e})}}class zp{packData(t){return f(this,void 0,void 0,function*(){const{bytes:e}=nh(t.data,t.type);return{packed:e}})}}class Wp{constructor(t){this._rpc=t,this._options={},this.format=Gi,typeof this._rpc=="string"?this._rpcClient=new Mr(this._rpc):this._rpcClient=this._rpc,this._context=new si(t),this._wallet=new pi(this._context),this.setProvider({rpc:this._rpcClient}),this.batch=this._context.batch.batch.bind(this._context.batch)}setProvider({rpc:t,stream:e,signer:i,protocol:n,config:s,forger:o,wallet:a,packer:c,globalConstantsProvider:h,readProvider:p,parserProvider:m}){this.setRpcProvider(t),this.setStreamProvider(e),this.setSignerProvider(i),this.setForgerProvider(o),this.setWalletProvider(a),this.setPackerProvider(c),this.setGlobalConstantsProvider(h),this.setReadProvider(p),this.setParserProvider(m),this._context.proto=n,s&&this._context.setPartialConfig(s)}setSignerProvider(t){!this._options.signer&&typeof t>"u"?(this._context.signer=new ki,this._options.signer=t):typeof t<"u"&&(this._context.signer=t,this._options.signer=t)}setRpcProvider(t){typeof t=="string"?this._rpcClient=new Mr(t):t===void 0||(this._rpcClient=t),this._options.rpc=this._rpcClient,this._context.rpc=this._rpcClient}setForgerProvider(t){if(typeof t<"u")this._options.forger=t,this._context.forger=t;else if(this._options.forger===void 0){const e=this.getFactory(Go)();this._options.forger=e,this._context.forger=e}}setStreamProvider(t){if(typeof t=="string"){const e=new $i(new si(new Mr(t)));this._options.stream=e,this._context.stream=e}else if(typeof t<"u")this._options.stream=t,this._context.stream=t;else if(this._options.stream===void 0){const e=this.getFactory($i)();this._options.stream=e,this._context.stream=e}}setWalletProvider(t){if(!this._options.wallet&&typeof t>"u"){const e=this.getFactory(jo)();this._options.wallet=e,this._context.walletProvider=e}else typeof t<"u"&&(this._options.wallet=t,this._context.walletProvider=t)}setPackerProvider(t){if(!this._options.packer&&typeof t>"u"){const e=this.getFactory(Uo)();this._context.packer=e,this._options.packer=e}else typeof t<"u"&&(this._context.packer=t,this._options.packer=t)}setGlobalConstantsProvider(t){if(!this._options.globalConstantsProvider&&typeof t>"u"){const e=new Ho;this._context.globalConstantsProvider=e,this._options.globalConstantsProvider=e}else typeof t<"u"&&(this._context.globalConstantsProvider=t,this._options.globalConstantsProvider=t)}setReadProvider(t){const e=t||new Ko(this._context.rpc);this._options.readProvider=e,this._context.readProvider=e}setParserProvider(t){if(!this._options.parserProvider&&typeof t>"u"){const e=new Vo(this._context);this._context.parser=e,this._options.parserProvider=e}else typeof t<"u"&&(this._context.parser=t,this._options.parserProvider=t)}get tz(){return this._context.tz}get contract(){return this._context.contract}get wallet(){return this._wallet}get operation(){return this._context.operationFactory}get estimate(){return this._context.estimate}get stream(){return this._context.stream}get rpc(){return this._context.rpc}get signer(){return this._context.signer}get globalConstants(){return this._context.globalConstantsProvider}addExtension(t){Array.isArray(t)?t.forEach(e=>e.configureContext(this._context)):t.configureContext(this._context)}getFactory(t){return(...e)=>new t(this._context,...e)}getVersionInfo(){return Up}}export{zp as M,Fp as R,Et as S,Wp as T,Zr as a,Qr as b,Xr as c,Gp as l};
