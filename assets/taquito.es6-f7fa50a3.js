import{aa as Mc,_ as Dc,ag as G,V as L,ah as F,ai as dr,a2 as A,aj as kc,ak as dn,al as jc,am as Rs,an as Ss,ao as Bc,ap as Hc,P,Z as Jo,p as In,aq as Ps,M as Nn,ar as $c,as as Zo,U as Uc,at as Vc,b as Kc,N as xn,au as Xo,av as pr,aw as Pe,ax as Gc,ay as Ln,az as Fc,aA as Cn,aB as Qo,aC as ta,aD as zc}from"./main-e89bcb8e.js";import{_ as H}from"./DAppClient-4c6461c3.js";var pn={},qc={get exports(){return pn},set exports(r){pn=r}},gi={},Wc={get exports(){return gi},set exports(r){gi=r}},ea=function(t,e){return function(){for(var n=new Array(arguments.length),s=0;s<n.length;s++)n[s]=arguments[s];return t.apply(e,n)}},Yc=ea,Fe=Object.prototype.toString;function Mn(r){return Array.isArray(r)}function fn(r){return typeof r>"u"}function Jc(r){return r!==null&&!fn(r)&&r.constructor!==null&&!fn(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function ra(r){return Fe.call(r)==="[object ArrayBuffer]"}function Zc(r){return Fe.call(r)==="[object FormData]"}function Xc(r){var t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&ra(r.buffer),t}function Qc(r){return typeof r=="string"}function tu(r){return typeof r=="number"}function ia(r){return r!==null&&typeof r=="object"}function ui(r){if(Fe.call(r)!=="[object Object]")return!1;var t=Object.getPrototypeOf(r);return t===null||t===Object.prototype}function eu(r){return Fe.call(r)==="[object Date]"}function ru(r){return Fe.call(r)==="[object File]"}function iu(r){return Fe.call(r)==="[object Blob]"}function na(r){return Fe.call(r)==="[object Function]"}function nu(r){return ia(r)&&na(r.pipe)}function su(r){return Fe.call(r)==="[object URLSearchParams]"}function ou(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function au(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function Dn(r,t){if(!(r===null||typeof r>"u"))if(typeof r!="object"&&(r=[r]),Mn(r))for(var e=0,i=r.length;e<i;e++)t.call(null,r[e],e,r);else for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.call(null,r[n],n,r)}function gn(){var r={};function t(n,s){ui(r[s])&&ui(n)?r[s]=gn(r[s],n):ui(n)?r[s]=gn({},n):Mn(n)?r[s]=n.slice():r[s]=n}for(var e=0,i=arguments.length;e<i;e++)Dn(arguments[e],t);return r}function cu(r,t,e){return Dn(t,function(n,s){e&&typeof n=="function"?r[s]=Yc(n,e):r[s]=n}),r}function uu(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var Ot={isArray:Mn,isArrayBuffer:ra,isBuffer:Jc,isFormData:Zc,isArrayBufferView:Xc,isString:Qc,isNumber:tu,isObject:ia,isPlainObject:ui,isUndefined:fn,isDate:eu,isFile:ru,isBlob:iu,isFunction:na,isStream:nu,isURLSearchParams:su,isStandardBrowserEnv:au,forEach:Dn,merge:gn,extend:cu,trim:ou,stripBOM:uu},sr=Ot;function Ts(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var sa=function(t,e,i){if(!e)return t;var n;if(i)n=i(e);else if(sr.isURLSearchParams(e))n=e.toString();else{var s=[];sr.forEach(e,function(c,h){c===null||typeof c>"u"||(sr.isArray(c)?h=h+"[]":c=[c],sr.forEach(c,function(d){sr.isDate(d)?d=d.toISOString():sr.isObject(d)&&(d=JSON.stringify(d)),s.push(Ts(h)+"="+Ts(d))}))}),n=s.join("&")}if(n){var o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+n}return t},lu=Ot;function xi(){this.handlers=[]}xi.prototype.use=function(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1};xi.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)};xi.prototype.forEach=function(t){lu.forEach(this.handlers,function(i){i!==null&&t(i)})};var hu=xi,du=Ot,pu=function(t,e){du.forEach(t,function(n,s){s!==e&&s.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[s])})},oa=function(t,e,i,n,s){return t.config=e,i&&(t.code=i),t.request=n,t.response=s,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t},aa={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fu=oa,ca=function(t,e,i,n,s){var o=new Error(t);return fu(o,e,i,n,s)},gu=ca,mu=function(t,e,i){var n=i.config.validateStatus;!i.status||!n||n(i.status)?t(i):e(gu("Request failed with status code "+i.status,i.config,null,i.request,i))},Ki,Is;function yu(){if(Is)return Ki;Is=1;var r=Ot;return Ki=r.isStandardBrowserEnv()?function(){return{write:function(i,n,s,o,a,c){var h=[];h.push(i+"="+encodeURIComponent(n)),r.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),r.isString(o)&&h.push("path="+o),r.isString(a)&&h.push("domain="+a),c===!0&&h.push("secure"),document.cookie=h.join("; ")},read:function(i){var n=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Ki}var bu=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)},Eu=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t},vu=bu,_u=Eu,wu=function(t,e){return t&&!vu(e)?_u(t,e):e},Gi,Ns;function Au(){if(Ns)return Gi;Ns=1;var r=Ot,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Gi=function(i){var n={},s,o,a;return i&&r.forEach(i.split(`
`),function(h){if(a=h.indexOf(":"),s=r.trim(h.substr(0,a)).toLowerCase(),o=r.trim(h.substr(a+1)),s){if(n[s]&&t.indexOf(s)>=0)return;s==="set-cookie"?n[s]=(n[s]?n[s]:[]).concat([o]):n[s]=n[s]?n[s]+", "+o:o}}),n},Gi}var Fi,xs;function Ou(){if(xs)return Fi;xs=1;var r=Ot;return Fi=r.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a"),n;function s(o){var a=o;return e&&(i.setAttribute("href",a),a=i.href),i.setAttribute("href",a),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return n=s(window.location.href),function(a){var c=r.isString(a)?s(a):a;return c.protocol===n.protocol&&c.host===n.host}}():function(){return function(){return!0}}(),Fi}var zi,Ls;function Li(){if(Ls)return zi;Ls=1;function r(t){this.message=t}return r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,zi=r,zi}var qi,Cs;function Ms(){if(Cs)return qi;Cs=1;var r=Ot,t=mu,e=yu(),i=sa,n=wu,s=Au(),o=Ou(),a=ca,c=aa,h=Li();return qi=function(d){return new Promise(function(v,k){var Y=d.data,T=d.headers,w=d.responseType,E;function ze(){d.cancelToken&&d.cancelToken.unsubscribe(E),d.signal&&d.signal.removeEventListener("abort",E)}r.isFormData(Y)&&delete T["Content-Type"];var O=new XMLHttpRequest;if(d.auth){var U=d.auth.username||"",qe=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";T.Authorization="Basic "+btoa(U+":"+qe)}var Rt=n(d.baseURL,d.url);O.open(d.method.toUpperCase(),i(Rt,d.params,d.paramsSerializer),!0),O.timeout=d.timeout;function We(){if(O){var g="getAllResponseHeaders"in O?s(O.getAllResponseHeaders()):null,S=!w||w==="text"||w==="json"?O.responseText:O.response,I={data:S,status:O.status,statusText:O.statusText,headers:g,config:d,request:O};t(function(B){v(B),ze()},function(B){k(B),ze()},I),O=null}}if("onloadend"in O?O.onloadend=We:O.onreadystatechange=function(){!O||O.readyState!==4||O.status===0&&!(O.responseURL&&O.responseURL.indexOf("file:")===0)||setTimeout(We)},O.onabort=function(){O&&(k(a("Request aborted",d,"ECONNABORTED",O)),O=null)},O.onerror=function(){k(a("Network Error",d,null,O)),O=null},O.ontimeout=function(){var S=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",I=d.transitional||c;d.timeoutErrorMessage&&(S=d.timeoutErrorMessage),k(a(S,d,I.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",O)),O=null},r.isStandardBrowserEnv()){var Nr=(d.withCredentials||o(Rt))&&d.xsrfCookieName?e.read(d.xsrfCookieName):void 0;Nr&&(T[d.xsrfHeaderName]=Nr)}"setRequestHeader"in O&&r.forEach(T,function(S,I){typeof Y>"u"&&I.toLowerCase()==="content-type"?delete T[I]:O.setRequestHeader(I,S)}),r.isUndefined(d.withCredentials)||(O.withCredentials=!!d.withCredentials),w&&w!=="json"&&(O.responseType=d.responseType),typeof d.onDownloadProgress=="function"&&O.addEventListener("progress",d.onDownloadProgress),typeof d.onUploadProgress=="function"&&O.upload&&O.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(E=function(g){O&&(k(!g||g&&g.type?new h("canceled"):g),O.abort(),O=null)},d.cancelToken&&d.cancelToken.subscribe(E),d.signal&&(d.signal.aborted?E():d.signal.addEventListener("abort",E))),Y||(Y=null),O.send(Y)})},qi}var ft=Ot,Ds=pu,Ru=oa,Su=aa,Pu={"Content-Type":"application/x-www-form-urlencoded"};function ks(r,t){!ft.isUndefined(r)&&ft.isUndefined(r["Content-Type"])&&(r["Content-Type"]=t)}function Tu(){var r;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(r=Ms()),r}function Iu(r,t,e){if(ft.isString(r))try{return(t||JSON.parse)(r),ft.trim(r)}catch(i){if(i.name!=="SyntaxError")throw i}return(e||JSON.stringify)(r)}var Ci={transitional:Su,adapter:Tu(),transformRequest:[function(t,e){return Ds(e,"Accept"),Ds(e,"Content-Type"),ft.isFormData(t)||ft.isArrayBuffer(t)||ft.isBuffer(t)||ft.isStream(t)||ft.isFile(t)||ft.isBlob(t)?t:ft.isArrayBufferView(t)?t.buffer:ft.isURLSearchParams(t)?(ks(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):ft.isObject(t)||e&&e["Content-Type"]==="application/json"?(ks(e,"application/json"),Iu(t)):t}],transformResponse:[function(t){var e=this.transitional||Ci.transitional,i=e&&e.silentJSONParsing,n=e&&e.forcedJSONParsing,s=!i&&this.responseType==="json";if(s||n&&ft.isString(t)&&t.length)try{return JSON.parse(t)}catch(o){if(s)throw o.name==="SyntaxError"?Ru(o,this,"E_JSON_PARSE"):o}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ft.forEach(["delete","get","head"],function(t){Ci.headers[t]={}});ft.forEach(["post","put","patch"],function(t){Ci.headers[t]=ft.merge(Pu)});var kn=Ci,Nu=Ot,xu=kn,Lu=function(t,e,i){var n=this||xu;return Nu.forEach(i,function(o){t=o.call(n,t,e)}),t},Wi,js;function ua(){return js||(js=1,Wi=function(t){return!!(t&&t.__CANCEL__)}),Wi}var Bs=Ot,Yi=Lu,Cu=ua(),Mu=kn,Du=Li();function Ji(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Du("canceled")}var ku=function(t){Ji(t),t.headers=t.headers||{},t.data=Yi.call(t,t.data,t.headers,t.transformRequest),t.headers=Bs.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),Bs.forEach(["delete","get","head","post","put","patch","common"],function(n){delete t.headers[n]});var e=t.adapter||Mu.adapter;return e(t).then(function(n){return Ji(t),n.data=Yi.call(t,n.data,n.headers,t.transformResponse),n},function(n){return Cu(n)||(Ji(t),n&&n.response&&(n.response.data=Yi.call(t,n.response.data,n.response.headers,t.transformResponse))),Promise.reject(n)})},Pt=Ot,la=function(t,e){e=e||{};var i={};function n(l,d){return Pt.isPlainObject(l)&&Pt.isPlainObject(d)?Pt.merge(l,d):Pt.isPlainObject(d)?Pt.merge({},d):Pt.isArray(d)?d.slice():d}function s(l){if(Pt.isUndefined(e[l])){if(!Pt.isUndefined(t[l]))return n(void 0,t[l])}else return n(t[l],e[l])}function o(l){if(!Pt.isUndefined(e[l]))return n(void 0,e[l])}function a(l){if(Pt.isUndefined(e[l])){if(!Pt.isUndefined(t[l]))return n(void 0,t[l])}else return n(void 0,e[l])}function c(l){if(l in e)return n(t[l],e[l]);if(l in t)return n(void 0,t[l])}var h={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return Pt.forEach(Object.keys(t).concat(Object.keys(e)),function(d){var y=h[d]||s,v=y(d);Pt.isUndefined(v)&&y!==c||(i[d]=v)}),i},Zi,Hs;function ha(){return Hs||(Hs=1,Zi={version:"0.26.1"}),Zi}var ju=ha().version,jn={};["object","boolean","number","function","string","symbol"].forEach(function(r,t){jn[r]=function(i){return typeof i===r||"a"+(t<1?"n ":" ")+r}});var $s={};jn.transitional=function(t,e,i){function n(s,o){return"[Axios v"+ju+"] Transitional option '"+s+"'"+o+(i?". "+i:"")}return function(s,o,a){if(t===!1)throw new Error(n(o," has been removed"+(e?" in "+e:"")));return e&&!$s[o]&&($s[o]=!0,console.warn(n(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,o,a):!0}};function Bu(r,t,e){if(typeof r!="object")throw new TypeError("options must be an object");for(var i=Object.keys(r),n=i.length;n-- >0;){var s=i[n],o=t[s];if(o){var a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new TypeError("option "+s+" must be "+c);continue}if(e!==!0)throw Error("Unknown option "+s)}}var Hu={assertOptions:Bu,validators:jn},da=Ot,$u=sa,Us=hu,Vs=ku,Mi=la,pa=Hu,or=pa.validators;function Wr(r){this.defaults=r,this.interceptors={request:new Us,response:new Us}}Wr.prototype.request=function(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Mi(this.defaults,e),e.method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var i=e.transitional;i!==void 0&&pa.assertOptions(i,{silentJSONParsing:or.transitional(or.boolean),forcedJSONParsing:or.transitional(or.boolean),clarifyTimeoutError:or.transitional(or.boolean)},!1);var n=[],s=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(e)===!1||(s=s&&v.synchronous,n.unshift(v.fulfilled,v.rejected))});var o=[];this.interceptors.response.forEach(function(v){o.push(v.fulfilled,v.rejected)});var a;if(!s){var c=[Vs,void 0];for(Array.prototype.unshift.apply(c,n),c=c.concat(o),a=Promise.resolve(e);c.length;)a=a.then(c.shift(),c.shift());return a}for(var h=e;n.length;){var l=n.shift(),d=n.shift();try{h=l(h)}catch(y){d(y);break}}try{a=Vs(h)}catch(y){return Promise.reject(y)}for(;o.length;)a=a.then(o.shift(),o.shift());return a};Wr.prototype.getUri=function(t){return t=Mi(this.defaults,t),$u(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")};da.forEach(["delete","get","head","options"],function(t){Wr.prototype[t]=function(e,i){return this.request(Mi(i||{},{method:t,url:e,data:(i||{}).data}))}});da.forEach(["post","put","patch"],function(t){Wr.prototype[t]=function(e,i,n){return this.request(Mi(n||{},{method:t,url:e,data:i}))}});var Uu=Wr,Xi,Ks;function Vu(){if(Ks)return Xi;Ks=1;var r=Li();function t(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var i;this.promise=new Promise(function(o){i=o});var n=this;this.promise.then(function(s){if(n._listeners){var o,a=n._listeners.length;for(o=0;o<a;o++)n._listeners[o](s);n._listeners=null}}),this.promise.then=function(s){var o,a=new Promise(function(c){n.subscribe(c),o=c}).then(s);return a.cancel=function(){n.unsubscribe(o)},a},e(function(o){n.reason||(n.reason=new r(o),i(n.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]},t.prototype.unsubscribe=function(i){if(this._listeners){var n=this._listeners.indexOf(i);n!==-1&&this._listeners.splice(n,1)}},t.source=function(){var i,n=new t(function(o){i=o});return{token:n,cancel:i}},Xi=t,Xi}var Qi,Gs;function Ku(){return Gs||(Gs=1,Qi=function(t){return function(i){return t.apply(null,i)}}),Qi}var tn,Fs;function Gu(){if(Fs)return tn;Fs=1;var r=Ot;return tn=function(e){return r.isObject(e)&&e.isAxiosError===!0},tn}var zs=Ot,Fu=ea,li=Uu,zu=la,qu=kn;function fa(r){var t=new li(r),e=Fu(li.prototype.request,t);return zs.extend(e,li.prototype,t),zs.extend(e,t),e.create=function(n){return fa(zu(r,n))},e}var le=fa(qu);le.Axios=li;le.Cancel=Li();le.CancelToken=Vu();le.isCancel=ua();le.VERSION=ha().version;le.all=function(t){return Promise.all(t)};le.spread=Ku();le.isAxiosError=Gu();Wc.exports=le;gi.default=le;(function(r){r.exports=gi})(qc);const qs=Mc(pn);function Wu(r,t,e,i){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(l){try{h(i.next(l))}catch(d){o(d)}}function c(l){try{h(i.throw(l))}catch(d){o(d)}}function h(l){l.done?s(l.value):n(l.value).then(a,c)}h((i=i.apply(r,t||[])).next())})}var Mr;(function(r){r[r.CONTINUE=100]="CONTINUE",r[r.SWITCHING_PROTOCOLS=101]="SWITCHING_PROTOCOLS",r[r.PROCESSING=102]="PROCESSING",r[r.OK=200]="OK",r[r.CREATED=201]="CREATED",r[r.ACCEPTED=202]="ACCEPTED",r[r.NON_AUTHORITATIVE_INFORMATION=203]="NON_AUTHORITATIVE_INFORMATION",r[r.NO_CONTENT=204]="NO_CONTENT",r[r.RESET_CONTENT=205]="RESET_CONTENT",r[r.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",r[r.MULTI_STATUS=207]="MULTI_STATUS",r[r.ALREADY_REPORTED=208]="ALREADY_REPORTED",r[r.IM_USED=226]="IM_USED",r[r.MULTIPLE_CHOICES=300]="MULTIPLE_CHOICES",r[r.MOVED_PERMANENTLY=301]="MOVED_PERMANENTLY",r[r.FOUND=302]="FOUND",r[r.SEE_OTHER=303]="SEE_OTHER",r[r.NOT_MODIFIED=304]="NOT_MODIFIED",r[r.USE_PROXY=305]="USE_PROXY",r[r.SWITCH_PROXY=306]="SWITCH_PROXY",r[r.TEMPORARY_REDIRECT=307]="TEMPORARY_REDIRECT",r[r.PERMANENT_REDIRECT=308]="PERMANENT_REDIRECT",r[r.BAD_REQUEST=400]="BAD_REQUEST",r[r.UNAUTHORIZED=401]="UNAUTHORIZED",r[r.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",r[r.FORBIDDEN=403]="FORBIDDEN",r[r.NOT_FOUND=404]="NOT_FOUND",r[r.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",r[r.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",r[r.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",r[r.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",r[r.CONFLICT=409]="CONFLICT",r[r.GONE=410]="GONE",r[r.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",r[r.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",r[r.PAYLOAD_TOO_LARGE=413]="PAYLOAD_TOO_LARGE",r[r.URI_TOO_LONG=414]="URI_TOO_LONG",r[r.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",r[r.RANGE_NOT_SATISFIABLE=416]="RANGE_NOT_SATISFIABLE",r[r.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",r[r.I_AM_A_TEAPOT=418]="I_AM_A_TEAPOT",r[r.MISDIRECTED_REQUEST=421]="MISDIRECTED_REQUEST",r[r.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",r[r.LOCKED=423]="LOCKED",r[r.FAILED_DEPENDENCY=424]="FAILED_DEPENDENCY",r[r.UPGRADE_REQUIRED=426]="UPGRADE_REQUIRED",r[r.PRECONDITION_REQUIRED=428]="PRECONDITION_REQUIRED",r[r.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",r[r.REQUEST_HEADER_FIELDS_TOO_LARGE=431]="REQUEST_HEADER_FIELDS_TOO_LARGE",r[r.UNAVAILABLE_FOR_LEGAL_REASONS=451]="UNAVAILABLE_FOR_LEGAL_REASONS",r[r.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",r[r.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",r[r.BAD_GATEWAY=502]="BAD_GATEWAY",r[r.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",r[r.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",r[r.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED",r[r.VARIANT_ALSO_NEGOTIATES=506]="VARIANT_ALSO_NEGOTIATES",r[r.INSUFFICIENT_STORAGE=507]="INSUFFICIENT_STORAGE",r[r.LOOP_DETECTED=508]="LOOP_DETECTED",r[r.NOT_EXTENDED=510]="NOT_EXTENDED",r[r.NETWORK_AUTHENTICATION_REQUIRED=511]="NETWORK_AUTHENTICATION_REQUIRED"})(Mr||(Mr={}));const ga=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,Ws=ga?void 0:Dc(()=>import("./index-3bbb6136.js"),["assets/index-3bbb6136.js","assets/main-e89bcb8e.js","assets/index-381a223a.css","assets/DAppClient-4c6461c3.js"]).then(r=>r.default).catch(()=>{});var mi;(function(r){r.TEXT="text",r.JSON="json"})(mi||(mi={}));class Rr extends Error{constructor(t,e,i,n,s){super(t),this.message=t,this.status=e,this.statusText=i,this.body=n,this.url=s,this.name="HttpResponse"}}class Yu extends Error{constructor(t){super(t),this.message=t,this.name="HttpRequestFailed"}}class Ju{constructor(t=3e4){this.timeout=t}serialize(t){if(!t)return"";const e=[];for(const n in t)if(t.hasOwnProperty(n)&&typeof t[n]<"u"){const s=typeof t[n].toJSON=="function"?t[n].toJSON():t[n];if(s===null){e.push(encodeURIComponent(n));continue}if(Array.isArray(s)){s.forEach(o=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(o))});continue}e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}const i=e.join("&");return i?`?${i}`:""}createRequest({url:t,method:e,timeout:i=this.timeout,query:n,headers:s={},json:o=!0},a){return Wu(this,void 0,void 0,function*(){let c,h;s["Content-Type"]||(s["Content-Type"]="application/json"),o?c=mi.JSON:(c=mi.TEXT,h=[l=>l]);try{const l=Ws&&(yield Ws);return(yield qs.request({url:t+this.serialize(n),method:e??"GET",headers:s,responseType:c,transformResponse:h,timeout:i,data:a,adapter:l})).data}catch(l){if(qs.isAxiosError(l)&&l.response||!ga&&l.response){let d;throw typeof l.response.data=="object"?d=JSON.stringify(l.response.data):d=l.response.data,new Rr(`Http error response: (${l.response.status}) ${d}`,l.response.status,l.response.statusText,d,t+this.serialize(n))}else throw new Yu(`${e} ${t+this.serialize(n)} ${String(l)}`)}})}}function ti(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}function x(r,t,e,i){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(l){try{h(i.next(l))}catch(d){o(d)}}function c(l){try{h(i.throw(l))}catch(d){o(d)}}function h(l){l.done?s(l.value):n(l.value).then(a,c)}h((i=i.apply(r,t||[])).next())})}const Zu="main",C={block:"head"};var Ys;(function(r){r.GET_BAKING_RIGHTS="getBakingRights",r.GET_BALLOTS="getBallots",r.GET_BALLOT_LIST="getBallotList",r.GET_BIG_MAP_KEY="getBigMapKey",r.GET_BIG_MAP_EXPR="getBigMapExpr",r.GET_BLOCK_HASH="getBlockHash",r.GET_BLOCK="getBlock",r.GET_BLOCK_HEADER="getBlockHeader",r.GET_BLOCK_METADATA="getBlockMetadata",r.GET_BALANCE="getBalance",r.GET_CHAIN_ID="getChainId",r.GET_CONSTANTS="getConstants",r.GET_CONTRACT="getContract",r.GET_CURRENT_PERIOD="getCurrentPeriod",r.GET_CURRENT_PROPOSAL="getCurrentProposal",r.GET_CURRENT_QUORUM="getCurrentQuorum",r.GET_DELEGATE="getDelegate",r.GET_DELEGATES="getDelegates",r.GET_VOTING_INFO="getVotingInfo",r.GET_ENDORSING_RIGHTS="getEndorsingRights",r.GET_ENTRYPOINTS="getEntrypoints",r.GET_LIVE_BLOCKS="getLiveBlocks",r.GET_MANAGER_KEY="getManagerKey",r.GET_NORMALIZED_SCRIPT="getNormalizedScript",r.GET_PROPOSALS="getProposals",r.GET_PROTOCOLS="getProtocols",r.GET_SAPLING_DIFF_BY_CONTRACT="getSaplingDiffByContract",r.GET_SAPLING_DIFF_BY_ID="getSaplingDiffById",r.GET_SCRIPT="getScript",r.GET_STORAGE="getStorage",r.GET_SUCCESSOR_PERIOD="getSuccessorPeriod",r.GET_TX_ROLLUP_INBOX="getTxRollupInbox",r.GET_TX_ROLLUP_STATE="getTxRollupState",r.GET_VOTES_LISTINGS="getVotesListings",r.PACK_DATA="packData",r.GET_STORAGE_USED_SPACE="getStorageUsedSpace",r.GET_STORAGE_PAID_SPACE="getStoragePaidSpace",r.GET_TICKET_BALANCE="getTicketBalance",r.GET_ALL_TICKET_BALANCES="getAllTicketBalances",r.GET_PENDING_OPERATIONS="getPendingOperations",r.GET_ORIGINATION_PROOF="getOriginationProof"})(Ys||(Ys={}));function Lr(r,t){const e=Array.isArray(r);typeof t>"u"&&(t=Object.keys(r));const i=e?[]:{};return t.forEach(n=>{const s=r[n];let o;if(!(typeof s>"u")){if(Array.isArray(s)){o=Lr(s),i[n]=o;return}o=new A(s),i[n]=o}}),i}var Js;(function(r){r.TOO_LARGE="too large"})(Js||(Js={}));var Zs;(function(r){r.BAKING_REWARDS="baking rewards",r.REWARDS="rewards",r.FEES="fees",r.DEPOSITS="deposits",r.LEGACY_REWARDS="legacy_rewards",r.LEGACY_FEES="legacy_fees",r.LEGACY_DEPOSITS="legacy_deposits",r.BLOCK_FEES="block fees",r.NONCE_REVELATION_REWARDS="nonce revelation rewards",r.DOUBLE_SIGNING_EVIDENCE_REWARDS="double signing evidence rewards",r.ENDORSING_REWARDS="endorsing rewards",r.BAKING_BONUSES="baking bonuses",r.STORAGE_FEES="storage fees",r.PUNISHMENTS="punishments",r.LOST_ENDORSING_REWARDS="lost endorsing rewards",r.SUBSIDY="subsidy",r.BURNED="burned",r.COMMITMENT="commitment",r.BOOTSTRAP="bootstrap",r.INVOICE="invoice",r.MINTED="minted",r.TX_ROLLUP_REJECTION_REWARDS="tx_rollup_rejection_rewards",r.TX_ROLLUP_REJECTION_PUNISHMENTS="tx_rollup_rejection_punishments",r.BONDS="bonds"})(Zs||(Zs={}));var Xs;(function(r){r.WASM2="wasm_2_0_0",r.ARITH="arith"})(Xs||(Xs={}));var Qs;(function(r){r.START="start",r.MOVE="move"})(Qs||(Qs={}));var to;(function(r){r.INBOX_PROOF="inbox_proof",r.REVEAL_PROOF="reveal_proof",r.FIRST_INPUT="first_input"})(to||(to={}));var eo;(function(r){r.RAW_DATA_PROOF="raw_data_proof",r.METADATA_PROOF="metadata_proof",r.DAL_PAGE_PROOF="dal_page_proof"})(eo||(eo={}));var ro;(function(r){r.ONGOING="ongoing",r.ENDED="ended"})(ro||(ro={}));var io;(function(r){r.LOSER="loser",r.DRAW="draw"})(io||(io={}));var no;(function(r){r.CONFLICT_RESOLVED="conflict_resolved",r.TIMEOUT="timeout"})(no||(no={}));var b;(function(r){r.ORIGINATION="origination",r.DELEGATION="delegation",r.REVEAL="reveal",r.TRANSACTION="transaction",r.ACTIVATION="activate_account",r.ENDORSEMENT="endorsement",r.PREENDORSEMENT="preendorsement",r.SET_DEPOSITS_LIMIT="set_deposits_limit",r.DOUBLE_PREENDORSEMENT_EVIDENCE="double_preendorsement_evidence",r.ENDORSEMENT_WITH_SLOT="endorsement_with_slot",r.SEED_NONCE_REVELATION="seed_nonce_revelation",r.DOUBLE_ENDORSEMENT_EVIDENCE="double_endorsement_evidence",r.DOUBLE_BAKING_EVIDENCE="double_baking_evidence",r.PROPOSALS="proposals",r.BALLOT="ballot",r.FAILING_NOOP="failing_noop",r.REGISTER_GLOBAL_CONSTANT="register_global_constant",r.TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.TX_ROLLUP_COMMIT="tx_rollup_commit",r.TX_ROLLUP_RETURN_BOND="tx_rollup_return_bond",r.TX_ROLLUP_FINALIZE_COMMITMENT="tx_rollup_finalize_commitment",r.TX_ROLLUP_REMOVE_COMMITMENT="tx_rollup_remove_commitment",r.TX_ROLLUP_REJECTION="tx_rollup_rejection",r.TX_ROLLUP_DISPATCH_TICKETS="tx_rollup_dispatch_tickets",r.TRANSFER_TICKET="transfer_ticket",r.INCREASE_PAID_STORAGE="increase_paid_storage",r.UPDATE_CONSENSUS_KEY="update_consensus_key",r.DRAIN_DELEGATE="drain_delegate",r.VDF_REVELATION="vdf_revelation",r.EVENT="event",r.TICKET_UPDATES="ticket_updates",r.SMART_ROLLUP_ORIGINATE="smart_rollup_originate",r.SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",r.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message",r.SMART_ROLLUP_PUBLISH="smart_rollup_publish",r.SMART_ROLLUP_CEMENT="smart_rollup_cement",r.SMART_ROLLUP_RECOVER_BOND="smart_rollup_recover_bond",r.SMART_ROLLUP_REFUTE="smart_rollup_refute",r.SMART_ROLLUP_TIMEOUT="smart_rollup_timeout"})(b||(b={}));class hi{constructor(t,e=Zu,i=new Ju){this.url=t,this.chain=e,this.httpBackend=i}createURL(t){return`${this.url.replace(/\/+$/g,"")}${t}`}validateAddress(t){if(G(t)!==L.VALID)throw new F(t)}validateContract(t){if(dr(t)!==L.VALID)throw new F(t)}getBlockHash({block:t}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/hash`),method:"GET"})})}getLiveBlocks({block:t}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/live_blocks`),method:"GET"})})}getBalance(t,{block:e}=C){return x(this,void 0,void 0,function*(){this.validateAddress(t);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/balance`),method:"GET"});return new A(i)})}getStorage(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage`),method:"GET"})})}getScript(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/script`),method:"GET"})})}getNormalizedScript(t,e={unparsing_mode:"Readable"},{block:i}=C){return x(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/contracts/${t}/script/normalized`),method:"POST"},e)})}getContract(t,{block:e}=C){return x(this,void 0,void 0,function*(){this.validateAddress(t);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}`),method:"GET"});return Object.assign(Object.assign({},i),{balance:new A(i.balance)})})}getManagerKey(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/manager_key`),method:"GET"})})}getDelegate(t,{block:e}=C){return x(this,void 0,void 0,function*(){this.validateAddress(t);let i;try{i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/delegate`),method:"GET"})}catch(n){if(n instanceof Rr&&n.status===Mr.NOT_FOUND)i=null;else throw n}return i})}getBigMapKey(t,e,{block:i}=C){return x(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/contracts/${t}/big_map_get`),method:"POST"},e)})}getBigMapExpr(t,e,{block:i}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/big_maps/${t}/${e}`),method:"GET"})})}getDelegates(t,{block:e}=C){return x(this,void 0,void 0,function*(){this.validateAddress(t);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}`),method:"GET"}),n=Lr(i,["balance","full_balance","current_frozen_deposits","frozen_deposits","frozen_balance","frozen_deposits_limit","staking_balance","delegated_balance","voting_power"]);return Object.assign(Object.assign(Object.assign({},i),n),{frozen_balance_by_cycle:i.frozen_balance_by_cycle?i.frozen_balance_by_cycle.map(s=>{var{deposit:o,deposits:a,fees:c,rewards:h}=s,l=ti(s,["deposit","deposits","fees","rewards"]);const d=Lr({deposit:o,deposits:a,fees:c,rewards:h},["deposit","deposits","fees","rewards"]);return Object.assign(Object.assign({},l),{deposit:d.deposit,deposits:d.deposits,fees:d.fees,rewards:d.rewards})}):void 0})})}getVotingInfo(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.validateAddress(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}/voting_info`),method:"GET"})})}getConstants({block:t}=C){return x(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/context/constants`),method:"GET"}),i=Lr(e,["time_between_blocks","hard_gas_limit_per_operation","hard_gas_limit_per_block","proof_of_work_threshold","tokens_per_roll","seed_nonce_revelation_tip","block_security_deposit","endorsement_security_deposit","block_reward","endorsement_reward","cost_per_byte","hard_storage_limit_per_operation","test_chain_duration","baking_reward_per_endorsement","delay_per_missing_endorsement","minimal_block_delay","liquidity_baking_subsidy","cache_layout","baking_reward_fixed_portion","baking_reward_bonus_per_slot","endorsing_reward_per_slot","double_baking_punishment","delay_increment_per_round","tx_rollup_commitment_bond","vdf_difficulty","sc_rollup_stake_amount","minimal_stake"]);return Object.assign(Object.assign({},e),i)})}getBlock({block:t}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}`),method:"GET"})})}getBlockHeader({block:t}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/header`),method:"GET"})})}getBlockMetadata({block:t}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/metadata`),method:"GET"})})}getBakingRights(t={},{block:e}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/baking_rights`),method:"GET",query:t})})}getEndorsingRights(t={},{block:e}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/endorsing_rights`),method:"GET",query:t})})}getBallotList({block:t}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballot_list`),method:"GET"})})}getBallots({block:t}=C){return x(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballots`),method:"GET"});return Lr(e,["yay","nay","pass"])})}getCurrentProposal({block:t}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_proposal`),method:"GET"})})}getCurrentQuorum({block:t}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_quorum`),method:"GET"})})}getVotesListings({block:t}=C){return x(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/listings`),method:"GET"});return e.map(i=>(i.voting_power&&(i.voting_power=new A(i.voting_power)),i)),e})}getProposals({block:t}=C){return x(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/proposals`),method:"GET"});return e.map(i=>i[1]=new A(i[1])),e})}forgeOperations(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/forge/operations`),method:"POST"},t)})}injectOperation(t){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL("/injection/operation"),method:"POST"},t)})}preapplyOperations(t,{block:e}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/preapply/operations`),method:"POST"},t)})}getEntrypoints(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.validateContract(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/entrypoints`),method:"GET"})})}runOperation(t,{block:e}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_operation`),method:"POST"},t)})}runCode(t,{block:e}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_code`),method:"POST"},t)})}runScriptView(t,{block:e}=C){var{unparsing_mode:i="Readable"}=t,n=ti(t,["unparsing_mode"]);return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_script_view`),method:"POST"},Object.assign({unparsing_mode:i},n))})}runView(t,{block:e}=C){var{unparsing_mode:i="Readable"}=t,n=ti(t,["unparsing_mode"]);return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_view`),method:"POST"},Object.assign({unparsing_mode:i},n))})}getChainId(){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/chain_id`),method:"GET"})})}packData(t,{block:e}=C){return x(this,void 0,void 0,function*(){const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/pack_data`),method:"POST"},t),{gas:n}=i,s=ti(i,["gas"]);let o=n;const a=new A(n||"");return a.isNaN()||(o=a),Object.assign({gas:o},s)})}getRpcUrl(){return this.url}getCurrentPeriod({block:t}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_period`),method:"GET"})})}getSuccessorPeriod({block:t}=C){return x(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/successor_period`),method:"GET"})})}getSaplingDiffById(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/sapling/${t}/get_diff`),method:"GET"})})}getSaplingDiffByContract(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/single_sapling_get_diff`),method:"GET"})})}getProtocols({block:t}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/protocols`),method:"GET"})})}getTxRollupState(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/tx_rollup/${t}/state`),method:"GET"})})}getTxRollupInbox(t,e,{block:i}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/tx_rollup/${t}/inbox/${e}`),method:"GET"})})}getStorageUsedSpace(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage/used_space`),method:"GET"})})}getStoragePaidSpace(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage/paid_space`),method:"GET"})})}getTicketBalance(t,e,{block:i}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/contracts/${t}/ticket_balance`),method:"POST"},e)})}getAllTicketBalances(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/all_ticket_balances`),method:"GET"})})}getPendingOperations(t={}){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/mempool/pending_operations`),method:"GET",query:t})})}getOriginationProof(t,{block:e}=C){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/smart_rollups/all/origination_proof`),method:"POST"},t)})}}function yi(r){return typeof r=="function"}var so=!1,ie={Promise:void 0,set useDeprecatedSynchronousErrorHandling(r){if(r){var t=new Error;""+t.stack}so=r},get useDeprecatedSynchronousErrorHandling(){return so}};function cr(r){setTimeout(function(){throw r},0)}var bi={closed:!0,next:function(r){},error:function(r){if(ie.useDeprecatedSynchronousErrorHandling)throw r;cr(r)},complete:function(){}},Bn=function(){return Array.isArray||function(r){return r&&typeof r.length=="number"}}();function ma(r){return r!==null&&typeof r=="object"}var Xu=function(){function r(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(e,i){return i+1+") "+e.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return r.prototype=Object.create(Error.prototype),r}(),di=Xu,Dt=function(){function r(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return r.prototype.unsubscribe=function(){var t;if(!this.closed){var e=this,i=e._parentOrParents,n=e._ctorUnsubscribe,s=e._unsubscribe,o=e._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,i instanceof r)i.remove(this);else if(i!==null)for(var a=0;a<i.length;++a){var c=i[a];c.remove(this)}if(yi(s)){n&&(this._unsubscribe=void 0);try{s.call(this)}catch(d){t=d instanceof di?oo(d.errors):[d]}}if(Bn(o))for(var a=-1,h=o.length;++a<h;){var l=o[a];if(ma(l))try{l.unsubscribe()}catch(y){t=t||[],y instanceof di?t=t.concat(oo(y.errors)):t.push(y)}}if(t)throw new di(t)}},r.prototype.add=function(t){var e=t;if(!t)return r.EMPTY;switch(typeof t){case"function":e=new r(t);case"object":if(e===this||e.closed||typeof e.unsubscribe!="function")return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof r)){var i=e;e=new r,e._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var n=e._parentOrParents;if(n===null)e._parentOrParents=this;else if(n instanceof r){if(n===this)return e;e._parentOrParents=[n,this]}else if(n.indexOf(this)===-1)n.push(this);else return e;var s=this._subscriptions;return s===null?this._subscriptions=[e]:s.push(e),e},r.prototype.remove=function(t){var e=this._subscriptions;if(e){var i=e.indexOf(t);i!==-1&&e.splice(i,1)}},r.EMPTY=function(t){return t.closed=!0,t}(new r),r}();function oo(r){return r.reduce(function(t,e){return t.concat(e instanceof di?e.errors:e)},[])}var Ei=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),it=function(r){H(t,r);function t(e,i,n){var s=r.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=bi;break;case 1:if(!e){s.destination=bi;break}if(typeof e=="object"){e instanceof t?(s.syncErrorThrowable=e.syncErrorThrowable,s.destination=e,e.add(s)):(s.syncErrorThrowable=!0,s.destination=new ao(s,e));break}default:s.syncErrorThrowable=!0,s.destination=new ao(s,e,i,n);break}return s}return t.prototype[Ei]=function(){return this},t.create=function(e,i,n){var s=new t(e,i,n);return s.syncErrorThrowable=!1,s},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(Dt),ao=function(r){H(t,r);function t(e,i,n,s){var o=r.call(this)||this;o._parentSubscriber=e;var a,c=o;return yi(i)?a=i:i&&(a=i.next,n=i.error,s=i.complete,i!==bi&&(c=Object.create(i),yi(c.unsubscribe)&&o.add(c.unsubscribe.bind(c)),c.unsubscribe=o.unsubscribe.bind(o))),o._context=c,o._next=a,o._error=n,o._complete=s,o}return t.prototype.next=function(e){if(!this.isStopped&&this._next){var i=this._parentSubscriber;!ie.useDeprecatedSynchronousErrorHandling||!i.syncErrorThrowable?this.__tryOrUnsub(this._next,e):this.__tryOrSetError(i,this._next,e)&&this.unsubscribe()}},t.prototype.error=function(e){if(!this.isStopped){var i=this._parentSubscriber,n=ie.useDeprecatedSynchronousErrorHandling;if(this._error)!n||!i.syncErrorThrowable?(this.__tryOrUnsub(this._error,e),this.unsubscribe()):(this.__tryOrSetError(i,this._error,e),this.unsubscribe());else if(i.syncErrorThrowable)n?(i.syncErrorValue=e,i.syncErrorThrown=!0):cr(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;cr(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var i=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};!ie.useDeprecatedSynchronousErrorHandling||!i.syncErrorThrowable?(this.__tryOrUnsub(n),this.unsubscribe()):(this.__tryOrSetError(i,n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,i){try{e.call(this._context,i)}catch(n){if(this.unsubscribe(),ie.useDeprecatedSynchronousErrorHandling)throw n;cr(n)}},t.prototype.__tryOrSetError=function(e,i,n){if(!ie.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{i.call(this._context,n)}catch(s){return ie.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=s,e.syncErrorThrown=!0,!0):(cr(s),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(it);function Qu(r){for(;r;){var t=r,e=t.closed,i=t.destination,n=t.isStopped;if(e||n)return!1;i&&i instanceof it?r=i:r=null}return!0}function tl(r,t,e){if(r){if(r instanceof it)return r;if(r[Ei])return r[Ei]()}return!r&&!t&&!e?new it(bi):new it(r,t,e)}var Yr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Hn(r){return r}function el(r){return r.length===0?Hn:r.length===1?r[0]:function(e){return r.reduce(function(i,n){return n(i)},e)}}var Q=function(){function r(t){this._isScalar=!1,t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,i){var n=this.operator,s=tl(t,e,i);if(n?s.add(n.call(s,this.source)):s.add(this.source||ie.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),ie.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){ie.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),Qu(t)?t.error(e):console.warn(e)}},r.prototype.forEach=function(t,e){var i=this;return e=co(e),new e(function(n,s){var o;o=i.subscribe(function(a){try{t(a)}catch(c){s(c),o&&o.unsubscribe()}},s,n)})},r.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},r.prototype[Yr]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length===0?this:el(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=co(t),new t(function(i,n){var s;e.subscribe(function(o){return s=o},function(o){return n(o)},function(){return i(s)})})},r.create=function(t){return new r(t)},r}();function co(r){if(r||(r=Promise),!r)throw new Error("no Promise impl found");return r}var rl=function(){function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return r.prototype=Object.create(Error.prototype),r}(),Ye=rl,ya=function(r){H(t,r);function t(e,i){var n=r.call(this)||this;return n.subject=e,n.subscriber=i,n.closed=!1,n}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,i=e.observers;if(this.subject=null,!(!i||i.length===0||e.isStopped||e.closed)){var n=i.indexOf(this.subscriber);n!==-1&&i.splice(n,1)}}},t}(Dt),ba=function(r){H(t,r);function t(e){var i=r.call(this,e)||this;return i.destination=e,i}return t}(it),br=function(r){H(t,r);function t(){var e=r.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype[Ei]=function(){return new ba(this)},t.prototype.lift=function(e){var i=new uo(this,this);return i.operator=e,i},t.prototype.next=function(e){if(this.closed)throw new Ye;if(!this.isStopped)for(var i=this.observers,n=i.length,s=i.slice(),o=0;o<n;o++)s[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new Ye;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var i=this.observers,n=i.length,s=i.slice(),o=0;o<n;o++)s[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Ye;this.isStopped=!0;for(var e=this.observers,i=e.length,n=e.slice(),s=0;s<i;s++)n[s].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(e){if(this.closed)throw new Ye;return r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){if(this.closed)throw new Ye;return this.hasError?(e.error(this.thrownError),Dt.EMPTY):this.isStopped?(e.complete(),Dt.EMPTY):(this.observers.push(e),new ya(this,e))},t.prototype.asObservable=function(){var e=new Q;return e.source=this,e},t.create=function(e,i){return new uo(e,i)},t}(Q),uo=function(r){H(t,r);function t(e,i){var n=r.call(this)||this;return n.destination=e,n.source=i,n}return t.prototype.next=function(e){var i=this.destination;i&&i.next&&i.next(e)},t.prototype.error=function(e){var i=this.destination;i&&i.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){var i=this.source;return i?this.source.subscribe(e):Dt.EMPTY},t}(br);function Dr(){return function(t){return t.lift(new il(t))}}var il=function(){function r(t){this.connectable=t}return r.prototype.call=function(t,e){var i=this.connectable;i._refCount++;var n=new nl(t,i),s=e.subscribe(n);return n.closed||(n.connection=i.connect()),s},r}(),nl=function(r){H(t,r);function t(e,i){var n=r.call(this,e)||this;return n.connectable=i,n}return t.prototype._unsubscribe=function(){var e=this.connectable;if(!e){this.connection=null;return}this.connectable=null;var i=e._refCount;if(i<=0){this.connection=null;return}if(e._refCount=i-1,i>1){this.connection=null;return}var n=this.connection,s=e._connection;this.connection=null,s&&(!n||s===n)&&s.unsubscribe()},t}(it),sl=function(r){H(t,r);function t(e,i){var n=r.call(this)||this;return n.source=e,n.subjectFactory=i,n._refCount=0,n._isComplete=!1,n}return t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,e=this._connection=new Dt,e.add(this.source.subscribe(new al(this.getSubject(),this))),e.closed&&(this._connection=null,e=Dt.EMPTY)),e},t.prototype.refCount=function(){return Dr()(this)},t}(Q),ol=function(){var r=sl.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:r._subscribe},_isComplete:{value:r._isComplete,writable:!0},getSubject:{value:r.getSubject},connect:{value:r.connect},refCount:{value:r.refCount}}}(),al=function(r){H(t,r);function t(e,i){var n=r.call(this,e)||this;return n.connectable=i,n}return t.prototype._error=function(e){this._unsubscribe(),r.prototype._error.call(this,e)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),r.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var i=e._connection;e._refCount=0,e._subject=null,e._connection=null,i&&i.unsubscribe()}},t}(ba),Di=function(r){H(t,r);function t(e){var i=r.call(this)||this;return i._value=e,i}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(e){var i=r.prototype._subscribe.call(this,e);return i&&!i.closed&&e.next(this._value),i},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ye;return this._value},t.prototype.next=function(e){r.prototype.next.call(this,this._value=e)},t}(br),cl=function(r){H(t,r);function t(e,i){return r.call(this)||this}return t.prototype.schedule=function(e,i){return this},t}(Dt),Ea=function(r){H(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.scheduler=e,n.work=i,n.pending=!1,n}return t.prototype.schedule=function(e,i){if(i===void 0&&(i=0),this.closed)return this;this.state=e;var n=this.id,s=this.scheduler;return n!=null&&(this.id=this.recycleAsyncId(s,n,i)),this.pending=!0,this.delay=i,this.id=this.id||this.requestAsyncId(s,this.id,i),this},t.prototype.requestAsyncId=function(e,i,n){return n===void 0&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,i,n){if(n===void 0&&(n=0),n!==null&&this.delay===n&&this.pending===!1)return i;clearInterval(i)},t.prototype.execute=function(e,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,i);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,i){var n=!1,s=void 0;try{this.work(e)}catch(o){n=!0,s=!!o&&o||new Error(o)}if(n)return this.unsubscribe(),s},t.prototype._unsubscribe=function(){var e=this.id,i=this.scheduler,n=i.actions,s=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,s!==-1&&n.splice(s,1),e!=null&&(this.id=this.recycleAsyncId(i,e,null)),this.delay=null},t}(cl),ul=function(r){H(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.scheduler=e,n.work=i,n}return t.prototype.schedule=function(e,i){return i===void 0&&(i=0),i>0?r.prototype.schedule.call(this,e,i):(this.delay=i,this.state=e,this.scheduler.flush(this),this)},t.prototype.execute=function(e,i){return i>0||this.closed?r.prototype.execute.call(this,e,i):this._execute(e,i)},t.prototype.requestAsyncId=function(e,i,n){return n===void 0&&(n=0),n!==null&&n>0||n===null&&this.delay>0?r.prototype.requestAsyncId.call(this,e,i,n):e.flush(this)},t}(Ea),lo=function(){function r(t,e){e===void 0&&(e=r.now),this.SchedulerAction=t,this.now=e}return r.prototype.schedule=function(t,e,i){return e===void 0&&(e=0),new this.SchedulerAction(this,t).schedule(i,e)},r.now=function(){return Date.now()},r}(),va=function(r){H(t,r);function t(e,i){i===void 0&&(i=lo.now);var n=r.call(this,e,function(){return t.delegate&&t.delegate!==n?t.delegate.now():i()})||this;return n.actions=[],n.active=!1,n.scheduled=void 0,n}return t.prototype.schedule=function(e,i,n){return i===void 0&&(i=0),t.delegate&&t.delegate!==this?t.delegate.schedule(e,i,n):r.prototype.schedule.call(this,e,i,n)},t.prototype.flush=function(e){var i=this.actions;if(this.active){i.push(e);return}var n;this.active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=i.shift());if(this.active=!1,n){for(;e=i.shift();)e.unsubscribe();throw n}},t}(lo),ll=function(r){H(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(va),hl=new ll(ul),dl=hl,_a=new Q(function(r){return r.complete()});function $n(r){return r?pl(r):_a}function pl(r){return new Q(function(t){return r.schedule(function(){return t.complete()})})}function kr(r){return r&&typeof r.schedule=="function"}var wa=function(r){return function(t){for(var e=0,i=r.length;e<i&&!t.closed;e++)t.next(r[e]);t.complete()}};function Un(r,t){return new Q(function(e){var i=new Dt,n=0;return i.add(t.schedule(function(){if(n===r.length){e.complete();return}e.next(r[n++]),e.closed||i.add(this.schedule())})),i})}function Aa(r,t){return t?Un(r,t):new Q(wa(r))}function Sr(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r[r.length-1];return kr(e)?(r.pop(),Un(r,e)):Aa(r)}function Vn(r,t){return t?new Q(function(e){return t.schedule(fl,0,{error:r,subscriber:e})}):new Q(function(e){return e.error(r)})}function fl(r){var t=r.error,e=r.subscriber;e.error(t)}var en=function(){function r(t,e,i){this.kind=t,this.value=e,this.error=i,this.hasValue=t==="N"}return r.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},r.prototype.do=function(t,e,i){var n=this.kind;switch(n){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}},r.prototype.accept=function(t,e,i){return t&&typeof t.next=="function"?this.observe(t):this.do(t,e,i)},r.prototype.toObservable=function(){var t=this.kind;switch(t){case"N":return Sr(this.value);case"E":return Vn(this.error);case"C":return $n()}throw new Error("unexpected notification kind value")},r.createNext=function(t){return typeof t<"u"?new r("N",t):r.undefinedValueNotification},r.createError=function(t){return new r("E",void 0,t)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r.undefinedValueNotification=new r("N",void 0),r}(),gl=function(r){H(t,r);function t(e,i,n){n===void 0&&(n=0);var s=r.call(this,e)||this;return s.scheduler=i,s.delay=n,s}return t.dispatch=function(e){var i=e.notification,n=e.destination;i.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){var i=this.destination;i.add(this.scheduler.schedule(t.dispatch,this.delay,new ml(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(en.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(en.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(en.createComplete()),this.unsubscribe()},t}(it),ml=function(){function r(t,e){this.notification=t,this.destination=e}return r}(),jr=function(r){H(t,r);function t(e,i,n){e===void 0&&(e=Number.POSITIVE_INFINITY),i===void 0&&(i=Number.POSITIVE_INFINITY);var s=r.call(this)||this;return s.scheduler=n,s._events=[],s._infiniteTimeWindow=!1,s._bufferSize=e<1?1:e,s._windowTime=i<1?1:i,i===Number.POSITIVE_INFINITY?(s._infiniteTimeWindow=!0,s.next=s.nextInfiniteTimeWindow):s.next=s.nextTimeWindow,s}return t.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var i=this._events;i.push(e),i.length>this._bufferSize&&i.shift()}r.prototype.next.call(this,e)},t.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new yl(this._getNow(),e)),this._trimBufferThenGetEvents()),r.prototype.next.call(this,e)},t.prototype._subscribe=function(e){var i=this._infiniteTimeWindow,n=i?this._events:this._trimBufferThenGetEvents(),s=this.scheduler,o=n.length,a;if(this.closed)throw new Ye;if(this.isStopped||this.hasError?a=Dt.EMPTY:(this.observers.push(e),a=new ya(this,e)),s&&e.add(e=new gl(e,s)),i)for(var c=0;c<o&&!e.closed;c++)e.next(n[c]);else for(var c=0;c<o&&!e.closed;c++)e.next(n[c].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),a},t.prototype._getNow=function(){return(this.scheduler||dl).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),i=this._bufferSize,n=this._windowTime,s=this._events,o=s.length,a=0;a<o&&!(e-s[a].time<n);)a++;return o>i&&(a=Math.max(a,o-i)),a>0&&s.splice(0,a),s},t}(br),yl=function(){function r(t,e){this.time=t,this.value=e}return r}(),bl=new va(Ea),Oa=bl;function he(){}var El=function(){function r(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return r.prototype=Object.create(Error.prototype),r}(),vl=El,_l=function(){function r(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return r.prototype=Object.create(Error.prototype),r}(),Ra=_l;function er(r,t){return function(i){if(typeof r!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new wl(r,t))}}var wl=function(){function r(t,e){this.project=t,this.thisArg=e}return r.prototype.call=function(t,e){return e.subscribe(new Al(t,this.project,this.thisArg))},r}(),Al=function(r){H(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.project=i,s.count=0,s.thisArg=n||s,s}return t.prototype._next=function(e){var i;try{i=this.project.call(this.thisArg,e,this.count++)}catch(n){this.destination.error(n);return}this.destination.next(i)},t}(it),Ol=function(r){H(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.notifyNext=function(e,i,n,s,o){this.destination.next(i)},t.prototype.notifyError=function(e,i){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(it),Rl=function(r){H(t,r);function t(e,i,n){var s=r.call(this)||this;return s.parent=e,s.outerValue=i,s.outerIndex=n,s.index=0,s}return t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(it),Sl=function(r){return function(t){return r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,cr),t}};function Pl(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ki=Pl(),Tl=function(r){return function(t){var e=r[ki]();do{var i=void 0;try{i=e.next()}catch(n){return t.error(n),t}if(i.done){t.complete();break}if(t.next(i.value),t.closed)break}while(!0);return typeof e.return=="function"&&t.add(function(){e.return&&e.return()}),t}},Il=function(r){return function(t){var e=r[Yr]();if(typeof e.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)}},Sa=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function Pa(r){return!!r&&typeof r.subscribe!="function"&&typeof r.then=="function"}var Kn=function(r){if(r&&typeof r[Yr]=="function")return Il(r);if(Sa(r))return wa(r);if(Pa(r))return Sl(r);if(r&&typeof r[ki]=="function")return Tl(r);var t=ma(r)?"an invalid object":"'"+r+"'",e="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(e)};function Nl(r,t,e,i,n){if(n===void 0&&(n=new Rl(r,e,i)),!n.closed)return t instanceof Q?t.subscribe(n):Kn(t)(n)}var ho={};function po(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=void 0,i=void 0;return kr(r[r.length-1])&&(i=r.pop()),typeof r[r.length-1]=="function"&&(e=r.pop()),r.length===1&&Bn(r[0])&&(r=r[0]),Aa(r,i).lift(new xl(e))}var xl=function(){function r(t){this.resultSelector=t}return r.prototype.call=function(t,e){return e.subscribe(new Ll(t,this.resultSelector))},r}(),Ll=function(r){H(t,r);function t(e,i){var n=r.call(this,e)||this;return n.resultSelector=i,n.active=0,n.values=[],n.observables=[],n}return t.prototype._next=function(e){this.values.push(ho),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,i=e.length;if(i===0)this.destination.complete();else{this.active=i,this.toRespond=i;for(var n=0;n<i;n++){var s=e[n];this.add(Nl(this,s,void 0,n))}}},t.prototype.notifyComplete=function(e){(this.active-=1)===0&&this.destination.complete()},t.prototype.notifyNext=function(e,i,n){var s=this.values,o=s[n],a=this.toRespond?o===ho?--this.toRespond:this.toRespond:0;s[n]=i,a===0&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},t.prototype._tryResultSelector=function(e){var i;try{i=this.resultSelector.apply(this,e)}catch(n){this.destination.error(n);return}this.destination.next(i)},t}(Ol);function Cl(r,t){return new Q(function(e){var i=new Dt;return i.add(t.schedule(function(){var n=r[Yr]();i.add(n.subscribe({next:function(s){i.add(t.schedule(function(){return e.next(s)}))},error:function(s){i.add(t.schedule(function(){return e.error(s)}))},complete:function(){i.add(t.schedule(function(){return e.complete()}))}}))})),i})}function Ml(r,t){return new Q(function(e){var i=new Dt;return i.add(t.schedule(function(){return r.then(function(n){i.add(t.schedule(function(){e.next(n),i.add(t.schedule(function(){return e.complete()}))}))},function(n){i.add(t.schedule(function(){return e.error(n)}))})})),i})}function Dl(r,t){if(!r)throw new Error("Iterable cannot be null");return new Q(function(e){var i=new Dt,n;return i.add(function(){n&&typeof n.return=="function"&&n.return()}),i.add(t.schedule(function(){n=r[ki](),i.add(t.schedule(function(){if(!e.closed){var s,o;try{var a=n.next();s=a.value,o=a.done}catch(c){e.error(c);return}o?e.complete():(e.next(s),this.schedule())}}))})),i})}function kl(r){return r&&typeof r[Yr]=="function"}function jl(r){return r&&typeof r[ki]=="function"}function Bl(r,t){if(r!=null){if(kl(r))return Cl(r,t);if(Pa(r))return Ml(r,t);if(Sa(r))return Un(r,t);if(jl(r)||typeof r=="string")return Dl(r,t)}throw new TypeError((r!==null&&typeof r||r)+" is not observable")}function ir(r,t){return t?Bl(r,t):r instanceof Q?r:new Q(Kn(r))}var Jr=function(r){H(t,r);function t(e){var i=r.call(this)||this;return i.parent=e,i}return t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(it),Zr=function(r){H(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(it);function Xr(r,t){if(!t.closed){if(r instanceof Q)return r.subscribe(t);var e;try{e=Kn(r)(t)}catch(i){t.error(i)}return e}}function ji(r,t,e){return e===void 0&&(e=Number.POSITIVE_INFINITY),typeof t=="function"?function(i){return i.pipe(ji(function(n,s){return ir(r(n,s)).pipe(er(function(o,a){return t(n,o,s,a)}))},e))}:(typeof t=="number"&&(e=t),function(i){return i.lift(new Hl(r,e))})}var Hl=function(){function r(t,e){e===void 0&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return r.prototype.call=function(t,e){return e.subscribe(new $l(t,this.project,this.concurrent))},r}(),$l=function(r){H(t,r);function t(e,i,n){n===void 0&&(n=Number.POSITIVE_INFINITY);var s=r.call(this,e)||this;return s.project=i,s.concurrent=n,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var i,n=this.index++;try{i=this.project(e,n)}catch(s){this.destination.error(s);return}this.active++,this._innerSub(i)},t.prototype._innerSub=function(e){var i=new Jr(this),n=this.destination;n.add(i);var s=Xr(e,i);s!==i&&n.add(s)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(Zr);function Ul(r){return r===void 0&&(r=Number.POSITIVE_INFINITY),ji(Hn,r)}function Vl(){return Ul(1)}function vi(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return Vl()(Sr.apply(void 0,r))}function Ta(r){return new Q(function(t){var e;try{e=r()}catch(n){t.error(n);return}var i=e?ir(e):$n();return i.subscribe(t)})}function fo(r){return!Bn(r)&&r-parseFloat(r)+1>=0}var Kl=new Q(he);function _i(r,t){return function(i){return i.lift(new Gl(r,t))}}var Gl=function(){function r(t,e){this.predicate=t,this.thisArg=e}return r.prototype.call=function(t,e){return e.subscribe(new Fl(t,this.predicate,this.thisArg))},r}(),Fl=function(r){H(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.predicate=i,s.thisArg=n,s.count=0,s}return t.prototype._next=function(e){var i;try{i=this.predicate.call(this.thisArg,e,this.count++)}catch(n){this.destination.error(n);return}i&&this.destination.next(e)},t}(it);function Gn(r,t,e){return r===void 0&&(r=0),new Q(function(i){t===void 0&&(t=r,r=0);var n=0,s=r;if(e)return e.schedule(zl,0,{index:n,count:t,start:r,subscriber:i});do{if(n++>=t){i.complete();break}if(i.next(s++),i.closed)break}while(!0)})}function zl(r){var t=r.start,e=r.index,i=r.count,n=r.subscriber;if(e>=i){n.complete();return}n.next(t),!n.closed&&(r.index=e+1,r.start=t+1,this.schedule(r))}function go(r,t,e){r===void 0&&(r=0);var i=-1;return fo(t)?i=Number(t)<1&&1||Number(t):kr(t)&&(e=t),kr(e)||(e=Oa),new Q(function(n){var s=fo(r)?r:+r-e.now();return e.schedule(ql,s,{index:0,period:i,subscriber:n})})}function ql(r){var t=r.index,e=r.period,i=r.subscriber;if(i.next(t),!i.closed){if(e===-1)return i.complete();r.index=t+1,this.schedule(r,e)}}function Fn(r){return function(e){var i=new Wl(r),n=e.lift(i);return i.caught=n}}var Wl=function(){function r(t){this.selector=t}return r.prototype.call=function(t,e){return e.subscribe(new Yl(t,this.selector,this.caught))},r}(),Yl=function(r){H(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.selector=i,s.caught=n,s}return t.prototype.error=function(e){if(!this.isStopped){var i=void 0;try{i=this.selector(e,this.caught)}catch(o){r.prototype.error.call(this,o);return}this._unsubscribeAndRecycle();var n=new Jr(this);this.add(n);var s=Xr(i,n);s!==n&&this.add(s)}},t}(Zr);function Qr(r,t){return ji(r,t,1)}function Jl(r){return r===void 0&&(r=null),function(t){return t.lift(new Zl(r))}}var Zl=function(){function r(t){this.defaultValue=t}return r.prototype.call=function(t,e){return e.subscribe(new Xl(t,this.defaultValue))},r}(),Xl=function(r){H(t,r);function t(e,i){var n=r.call(this,e)||this;return n.defaultValue=i,n.isEmpty=!0,n}return t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(it);function Ql(r){return r instanceof Date&&!isNaN(+r)}function Ia(r,t){return function(e){return e.lift(new th(r,t))}}var th=function(){function r(t,e){this.compare=t,this.keySelector=e}return r.prototype.call=function(t,e){return e.subscribe(new eh(t,this.compare,this.keySelector))},r}(),eh=function(r){H(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.keySelector=n,s.hasKey=!1,typeof i=="function"&&(s.compare=i),s}return t.prototype.compare=function(e,i){return e===i},t.prototype._next=function(e){var i;try{var n=this.keySelector;i=n?n(e):e}catch(a){return this.destination.error(a)}var s=!1;if(this.hasKey)try{var o=this.compare;s=o(this.key,i)}catch(a){return this.destination.error(a)}else this.hasKey=!0;s||(this.key=i,this.destination.next(e))},t}(it);function rh(r,t){return Ia(function(e,i){return t?t(e[r],i[r]):e[r]===i[r]})}function ih(r){return r===void 0&&(r=oh),function(t){return t.lift(new nh(r))}}var nh=function(){function r(t){this.errorFactory=t}return r.prototype.call=function(t,e){return e.subscribe(new sh(t,this.errorFactory))},r}(),sh=function(r){H(t,r);function t(e,i){var n=r.call(this,e)||this;return n.errorFactory=i,n.hasValue=!1,n}return t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(i){e=i}this.destination.error(e)},t}(it);function oh(){return new Ra}function ah(r){return function(t){return r===0?$n():t.lift(new ch(r))}}var ch=function(){function r(t){if(this.total=t,this.total<0)throw new vl}return r.prototype.call=function(t,e){return e.subscribe(new uh(t,this.total))},r}(),uh=function(r){H(t,r);function t(e,i){var n=r.call(this,e)||this;return n.total=i,n.count=0,n}return t.prototype._next=function(e){var i=this.total,n=++this.count;n<=i&&(this.destination.next(e),n===i&&(this.destination.complete(),this.unsubscribe()))},t}(it);function Na(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(e){return vi(e,Sr.apply(void 0,r))}}function _e(r,t){var e=arguments.length>=2;return function(i){return i.pipe(r?_i(function(n,s){return r(n,s,i)}):Hn,ah(1),e?Jl(t):ih(function(){return new Ra}))}}function mn(r,t){return function(i){var n;if(typeof r=="function"?n=r:n=function(){return r},typeof t=="function")return i.lift(new lh(n,t));var s=Object.create(i,ol);return s.source=i,s.subjectFactory=n,s}}var lh=function(){function r(t,e){this.subjectFactory=t,this.selector=e}return r.prototype.call=function(t,e){var i=this.selector,n=this.subjectFactory(),s=i(n).subscribe(t);return s.add(e.subscribe(n)),s},r}();function mo(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r.length;if(e===0)throw new Error("list of properties cannot be empty.");return function(i){return er(hh(r,e))(i)}}function hh(r,t){var e=function(i){for(var n=i,s=0;s<t;s++){var o=n!=null?n[r[s]]:void 0;if(o!==void 0)n=o;else return}return n};return e}function dh(r){return r?mn(function(){return new br},r):mn(new br)}function yn(r,t,e,i){e&&typeof e!="function"&&(i=e);var n=typeof e=="function"?e:void 0,s=new jr(r,t,i);return function(o){return mn(function(){return s},n)(o)}}function xa(r){return r===void 0&&(r=-1),function(t){return t.lift(new ph(r,t))}}var ph=function(){function r(t,e){this.count=t,this.source=e}return r.prototype.call=function(t,e){return e.subscribe(new fh(t,this.count,this.source))},r}(),fh=function(r){H(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.count=i,s.source=n,s}return t.prototype.error=function(e){if(!this.isStopped){var i=this,n=i.source,s=i.count;if(s===0)return r.prototype.error.call(this,e);s>-1&&(this.count=s-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(it);function yo(r,t,e){var i;return r&&typeof r=="object"?i=r:i={bufferSize:r,windowTime:t,refCount:!1,scheduler:e},function(n){return n.lift(gh(i))}}function gh(r){var t=r.bufferSize,e=t===void 0?Number.POSITIVE_INFINITY:t,i=r.windowTime,n=i===void 0?Number.POSITIVE_INFINITY:i,s=r.refCount,o=r.scheduler,a,c=0,h,l=!1,d=!1;return function(v){c++;var k;!a||l?(l=!1,a=new jr(e,n,o),k=a.subscribe(this),h=v.subscribe({next:function(Y){a.next(Y)},error:function(Y){l=!0,a.error(Y)},complete:function(){d=!0,h=void 0,a.complete()}}),d&&(h=void 0)):k=a.subscribe(this),this.add(function(){c--,k.unsubscribe(),k=void 0,h&&!d&&s&&c===0&&(h.unsubscribe(),h=void 0,a=void 0)})}}function mh(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r[r.length-1];return kr(e)?(r.pop(),function(i){return vi(r,i,e)}):function(i){return vi(r,i)}}function oe(r,t){return typeof t=="function"?function(e){return e.pipe(oe(function(i,n){return ir(r(i,n)).pipe(er(function(s,o){return t(i,s,n,o)}))}))}:function(e){return e.lift(new yh(r))}}var yh=function(){function r(t){this.project=t}return r.prototype.call=function(t,e){return e.subscribe(new bh(t,this.project))},r}(),bh=function(r){H(t,r);function t(e,i){var n=r.call(this,e)||this;return n.project=i,n.index=0,n}return t.prototype._next=function(e){var i,n=this.index++;try{i=this.project(e,n)}catch(s){this.destination.error(s);return}this._innerSub(i)},t.prototype._innerSub=function(e){var i=this.innerSubscription;i&&i.unsubscribe();var n=new Jr(this),s=this.destination;s.add(n),this.innerSubscription=Xr(e,n),this.innerSubscription!==n&&s.add(this.innerSubscription)},t.prototype._complete=function(){var e=this.innerSubscription;(!e||e.closed)&&r.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&r.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(Zr);function Eh(r){return function(t){return t.lift(new vh(r))}}var vh=function(){function r(t){this.notifier=t}return r.prototype.call=function(t,e){var i=new _h(t),n=Xr(this.notifier,new Jr(i));return n&&!i.seenValue?(i.add(n),e.subscribe(i)):i},r}(),_h=function(r){H(t,r);function t(e){var i=r.call(this,e)||this;return i.seenValue=!1,i}return t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(Zr);function wh(r,t){return t===void 0&&(t=!1),function(e){return e.lift(new Ah(r,t))}}var Ah=function(){function r(t,e){this.predicate=t,this.inclusive=e}return r.prototype.call=function(t,e){return e.subscribe(new Oh(t,this.predicate,this.inclusive))},r}(),Oh=function(r){H(t,r);function t(e,i,n){var s=r.call(this,e)||this;return s.predicate=i,s.inclusive=n,s.index=0,s}return t.prototype._next=function(e){var i=this.destination,n;try{n=this.predicate(e,this.index++)}catch(s){i.error(s);return}this.nextOrComplete(e,n)},t.prototype.nextOrComplete=function(e,i){var n=this.destination;i?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(it);function wi(r,t,e){return function(n){return n.lift(new Rh(r,t,e))}}var Rh=function(){function r(t,e,i){this.nextOrObserver=t,this.error=e,this.complete=i}return r.prototype.call=function(t,e){return e.subscribe(new Sh(t,this.nextOrObserver,this.error,this.complete))},r}(),Sh=function(r){H(t,r);function t(e,i,n,s){var o=r.call(this,e)||this;return o._tapNext=he,o._tapError=he,o._tapComplete=he,o._tapError=n||he,o._tapComplete=s||he,yi(i)?(o._context=o,o._tapNext=i):i&&(o._context=i,o._tapNext=i.next||he,o._tapError=i.error||he,o._tapComplete=i.complete||he),o}return t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(i){this.destination.error(i);return}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(i){this.destination.error(i);return}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){this.destination.error(e);return}return this.destination.complete()},t}(it);function La(r,t,e){return e===void 0&&(e=Oa),function(i){var n=Ql(r),s=n?+r-e.now():Math.abs(r);return i.lift(new Ph(s,n,t,e))}}var Ph=function(){function r(t,e,i,n){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=i,this.scheduler=n}return r.prototype.call=function(t,e){return e.subscribe(new Th(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},r}(),Th=function(r){H(t,r);function t(e,i,n,s,o){var a=r.call(this,e)||this;return a.absoluteTimeout=i,a.waitFor=n,a.withObservable=s,a.scheduler=o,a.scheduleTimeout(),a}return t.dispatchTimeout=function(e){var i=e.withObservable;e._unsubscribeAndRecycle(),e.add(Xr(i,new Jr(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),r.prototype._next.call(this,e)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(Zr),Ih=function(r,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var e=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(s){return function(o){return function(a,c){var h={key:a,value:o[a]},l={key:c,value:o[c]};return s(h,l)}}}(t.cmp),n=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,c;if(Array.isArray(o)){for(c="[",a=0;a<o.length;a++)a&&(c+=","),c+=s(o[a])||"null";return c+"]"}if(o===null)return"null";if(n.indexOf(o)!==-1){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var h=n.push(o)-1,l=Object.keys(o).sort(i&&i(o));for(c="",a=0;a<l.length;a++){var d=l[a],y=s(o[d]);y&&(c&&(c+=","),c+=JSON.stringify(d)+":"+y)}return n.splice(h,1),"{"+c+"}"}}(r)},Ca;class Nh extends Error{constructor(t){super(`The map type '${t}' is invalid`),this.mapType=t,this.name="InvalidMapTypeError"}}const Ma=Symbol.for("taquito-michelson-map-type-symbol"),xh=r=>"args"in r&&Array.isArray(r.args)&&r.args.length===2;class bo extends Error{constructor(t,e,i){super(`${i} not compliant with underlying michelson type`),this.value=t,this.type=e,this.name="MapTypecheckError"}}class xt{constructor(t){this.valueMap=new Map,this.keyMap=new Map,this[Ca]=!0,t&&this.setType(t)}static isMichelsonMap(t){return t&&t[Ma]===!0}setType(t){if(!xh(t))throw new Nh(t.toString());this.keySchema=new Lt(t.args[0]),this.valueSchema=new Lt(t.args[1])}removeType(){this.keySchema=void 0,this.valueSchema=void 0}static fromLiteral(t,e){const i=new xt(e);return Object.keys(t).forEach(n=>{i.set(n,t[n])}),i}typecheckKey(t){return this.keySchema?this.keySchema.Typecheck(t):!0}typecheckValue(t){return this.valueSchema?this.valueSchema.Typecheck(t):!0}assertTypecheckValue(t){if(!this.typecheckValue(t))throw new bo(t,this.valueSchema,"value")}assertTypecheckKey(t){if(!this.typecheckKey(t))throw new bo(t,this.keySchema,"key")}serializeDeterministically(t){return Ih(t)}*keys(){for(const[t]of this.entries())yield t}*values(){for(const[,t]of this.entries())yield t}*entries(){for(const t of this.valueMap.keys())yield[this.keyMap.get(t),this.valueMap.get(t)]}get(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.valueMap.get(e)}set(t,e){this.assertTypecheckKey(t),this.assertTypecheckValue(e);const i=this.serializeDeterministically(t);this.keyMap.set(i,t),this.valueMap.set(i,e)}delete(t){this.assertTypecheckKey(t),this.keyMap.delete(this.serializeDeterministically(t)),this.valueMap.delete(this.serializeDeterministically(t))}has(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.keyMap.has(e)&&this.valueMap.has(e)}clear(){this.keyMap.clear(),this.valueMap.clear()}get size(){return this.keyMap.size}forEach(t){for(const[e,i]of this.entries())t(i,e,this)}}Ca=Ma;class W extends Error{constructor(t,e,i){super(),this.value=t,this.token=e,this.name="ValidationError";const n=this.token.annot(),s=n?`[${n}] `:"";this.message=`${s}${i}`}}class ct{constructor(t,e,i){this.val=t,this.idx=e,this.fac=i,this.createToken=this.fac}typeWithoutAnnotations(){const t=i=>{if(typeof i=="object"){if(Array.isArray(i))return i.map(o=>t(o));const n=i;return n.args?{prim:n.prim,args:n.args.map(s=>t(s))}:{prim:n.prim}}return i};return(i=>i.args?{prim:i.prim,args:i.args.map(n=>t(n))}:{prim:i.prim})(this.val)}annot(){return(Array.isArray(this.val.annots)&&this.val.annots.length>0?this.val.annots[0]:String(this.idx)).replace(/(%|:)(_Liq_entry_)?/,"")}hasAnnotations(){return Array.isArray(this.val.annots)&&this.val.annots.length}get tokenVal(){return this.val}ExtractSignature(){return[[this.ExtractSchema()]]}}class rt extends ct{compare(t,e){return t===e?0:t<e?-1:1}}class Eo extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="BigMapValidationError"}}class Nt extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}ExtractSchema(){return{big_map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:Nt.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}isValid(t){return xt.isMichelsonMap(t)?null:new Eo(t,this,"Value must be a MichelsonMap")}objLitToMichelsonMap(t){return t instanceof xt?t:typeof t=="object"?Object.keys(t).length===0?new xt:xt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop()),i=this.isValid(e);if(i)throw i;return Array.from(e.keys()).sort((n,s)=>this.KeySchema.compare(n,s)).map(n=>({prim:"Elt",args:[this.KeySchema.EncodeObject(n),this.ValueSchema.EncodeObject(e.get(n))]}))}EncodeObject(t,e){const i=this.objLitToMichelsonMap(t),n=this.isValid(i);if(n)throw n;return e&&e[Nt.prim]?e[Nt.prim](i,this.val):Array.from(i.keys()).sort((s,o)=>this.KeySchema.compare(s,o)).map(s=>({prim:"Elt",args:[this.KeySchema.EncodeObject(s),this.ValueSchema.EncodeObject(i.get(s))]}))}Execute(t,e){if(e&&e[Nt.prim])return e[Nt.prim](t,this.val);if(Array.isArray(t)){const i=new xt(this.val);return t.forEach(n=>{i.set(this.KeySchema.ToKey(n.args[0]),this.ValueSchema.Execute(n.args[1]))}),i}else{if("int"in t)return t.int;throw new Eo(t,this,`Big map is expecting either an array (Athens) or an object with an int property (Babylon). Got ${JSON.stringify(t)}`)}}findAndReturnTokens(t,e){return Nt.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}Nt.prim="big_map";class Lh extends Error{constructor(t){super(t),this.message=t,this.name="OrTokenDecodingError"}}class V extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Encode(t){const e=t[t.length-1],i=this.createToken(this.val.args[0],this.idx);let n=1;i instanceof V&&(n=Object.keys(i.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+n);if(String(i.annot())===String(e)&&!(i instanceof V))return t.pop(),{prim:"Left",args:[i.Encode(t)]};if(String(s.annot())===String(e)&&!(s instanceof V))return t.pop(),{prim:"Right",args:[s.Encode(t)]};if(i instanceof V){const o=i.Encode(t);if(o)return{prim:"Left",args:[o]}}if(s instanceof V){const o=s.Encode(t);if(o)return{prim:"Right",args:[o]}}return null}ExtractSignature(){const t=this.createToken(this.val.args[0],this.idx);let e=1;t instanceof V&&(e=Object.keys(t.ExtractSchema()).length);const i=this.createToken(this.val.args[1],this.idx+e),n=[];if(t instanceof V)n.push(...t.ExtractSignature());else for(const s of t.ExtractSignature())n.push([t.annot(),...s]);if(i instanceof V)n.push(...i.ExtractSignature());else for(const s of i.ExtractSignature())n.push([i.annot(),...s]);return n}EncodeObject(t,e){const i=Object.keys(t)[0],n=this.createToken(this.val.args[0],this.idx);let s=1;n instanceof V&&(s=Object.keys(n.ExtractSchema()).length);const o=this.createToken(this.val.args[1],this.idx+s);if(String(n.annot())===String(i)&&!(n instanceof V))return{prim:"Left",args:[n.EncodeObject(t[i],e)]};if(String(o.annot())===String(i)&&!(o instanceof V))return{prim:"Right",args:[o.EncodeObject(t[i],e)]};if(n instanceof V){const a=n.EncodeObject(t,e);if(a)return{prim:"Left",args:[a]}}if(o instanceof V){const a=o.EncodeObject(t,e);if(a)return{prim:"Right",args:[a]}}return null}Execute(t,e){const i=this.createToken(this.val.args[0],this.idx);let n=1;i instanceof V&&(n=Object.keys(i.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+n);if(t.prim==="Right")return s instanceof V?s.Execute(t.args[0],e):{[s.annot()]:s.Execute(t.args[0],e)};if(t.prim==="Left")return i instanceof V?i.Execute(t.args[0],e):{[i.annot()]:i.Execute(t.args[0],e)};throw new Lh(`Was expecting Left or Right prim but got: ${t.prim}`)}traversal(t,e,i){const n=this.createToken(this.val.args[0],this.idx);let s=1,o;n instanceof V&&!n.hasAnnotations()?(o=t(n),s=Object.keys(n.ExtractSchema()).length):o={[n.annot()]:t(n)};const a=this.createToken(this.val.args[1],this.idx+s);let c;return a instanceof V&&!a.hasAnnotations()?c=e(a):c={[a.annot()]:e(a)},i(o,c)}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}generateSchema(){return{__michelsonType:V.prim,schema:this.traversal(t=>t instanceof V&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof V&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}}findToken(t){const e=this.createToken(this.val.args[0],this.idx);let i=1;e instanceof V&&(i=Object.keys(e.ExtractSchema()).length);const n=this.createToken(this.val.args[1],this.idx+i);if(String(e.annot())===String(t)&&!(e instanceof V)&&e instanceof rt)return e;if(String(n.annot())===String(t)&&!(n instanceof V)&&n instanceof rt)return n;if(e instanceof V){const s=e.findToken(t);if(s)return s}if(n instanceof V){const s=n.findToken(t);if(s)return s}return null}compare(t,e){const i=Object.keys(t)[0],n=Object.keys(e)[0];if(i===n){const s=this.findToken(i);if(s instanceof rt)return s.compare(t[i],e[i])}else{const s=JSON.stringify(this.EncodeObject(t)),o=JSON.stringify(this.EncodeObject(e));return s<o?-1:1}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return V.prim===t&&e.push(this),this.traversal(i=>i.findAndReturnTokens(t,e),i=>i.findAndReturnTokens(t,e),(i,n)=>Object.assign(Object.assign({},i),n)),e}}V.prim="or";class Ch extends Error{constructor(t){super(t),this.message=t,this.name="TokenArgumentValidationError"}}class Mh extends Error{constructor(t,e){super(`Tokens ${t} and ${e} are not comparable`),this.val1=t,this.val2=e,this.name="TokenComparisonError"}}function bn(r,t=at.prim){if(Array.isArray(r))return bn({prim:t,args:r},t);if(r.args===void 0)throw new Ch("Encountered an invalid PairToken with no arguments, a pair must have two or more arguments");return r.args.length>2?[r.args[0],{prim:t,args:r.args.slice(1)}]:[r.args[0],r.args[1]]}class at extends rt{constructor(t,e,i){super(Array.isArray(t)?{prim:at.prim,args:t}:t.prim?t:{prim:at.prim,args:t},e,i)}args(){return bn(this.val)}tokens(){let t=0;return this.args().map(e=>{const i=this.createToken(e,this.idx+t);return i instanceof at?t+=Object.keys(i.ExtractSchema()).length:t++,i})}Encode(t){return{prim:"Pair",args:this.tokens().map(e=>e.Encode(t))}}ExtractSignature(){const t=this.args(),e=this.createToken(t[0],this.idx);let i=1;e instanceof V&&(i=Object.keys(e.ExtractSchema()).length);const n=this.createToken(t[1],this.idx+i),s=[];for(const o of e.ExtractSignature())for(const a of n.ExtractSignature())s.push([...o,...a]);return s}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}ToKey(t){return this.Execute(t)}EncodeObject(t,e){const[i,n]=this.tokens();let s;i instanceof at&&!i.hasAnnotations()?s=t:s=t[i.annot()];let o;return n instanceof at&&!n.hasAnnotations()?o=t:o=t[n.annot()],{prim:"Pair",args:[i.EncodeObject(s,e),n.EncodeObject(o,e)]}}traversal(t,e){const i=this.args(),n=this.createToken(i[0],this.idx);let s=1,o;n instanceof at&&(s=Object.keys(n.ExtractSchema()).length),n instanceof at&&!n.hasAnnotations()?o=t(n):o={[n.annot()]:t(n)};const a=this.createToken(i[1],this.idx+s);let c;return a instanceof at&&!a.hasAnnotations()?c=e(a):c={[a.annot()]:e(a)},Object.assign(Object.assign({},o),c)}Execute(t,e){const i=bn(t,"Pair");return this.traversal(n=>n.Execute(i[0],e),n=>n.Execute(i[1],e))}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema())}generateSchema(){return{__michelsonType:at.prim,schema:this.traversal(t=>t instanceof at&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof at&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema())}}compare(t,e){const[i,n]=this.tokens(),s=(o,a)=>o instanceof at&&!o.hasAnnotations()?a:a[o.annot()];if(i instanceof rt&&n instanceof rt){const o=i.compare(s(i,t),s(i,e));return o===0?n.compare(s(n,t),s(n,e)):o}throw new Mh(t,e)}findAndReturnTokens(t,e){return at.prim===t&&e.push(this),this.tokens().map(i=>i.findAndReturnTokens(t,e)),e}}at.prim="pair";class vo extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="NatValidationError"}}class Gt extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return new A(t[Object.keys(t)[0]])}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{int:new A(e).toFixed()}}isValid(t){const e=new A(t);return e.isNaN()?new vo(t,this,`Value is not a number: ${t}`):e.isNegative()?new vo(t,this,`Value cannot be negative: ${t}`):null}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Gt.prim]?e[Gt.prim](t):{int:new A(t).toFixed()}}ExtractSchema(){return Gt.prim}generateSchema(){return{__michelsonType:Gt.prim,schema:Gt.prim}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:Gt.prim}}}ToKey({int:t}){return new A(t)}compare(t,e){const i=Number(t),n=Number(e);return i===n?0:i<n?-1:1}findAndReturnTokens(t,e){return Gt.prim===t&&e.push(this),e}}Gt.prim="nat";class Ft extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return Ft.prim}generateSchema(){return{__michelsonType:Ft.prim,schema:Ft.prim}}Encode(t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[Ft.prim]?e[Ft.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Ft.prim}}}findAndReturnTokens(t,e){return Ft.prim===t&&e.push(this),e}}Ft.prim="string";class rn extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="AddressValidationError"}}class de extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}ToBigMapKey(t){return{key:{bytes:kc(t)},type:{prim:"bytes"}}}isValid(t){return G(t)!==L.VALID?new rn(t,this,`Address is not valid: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[de.prim]?e[de.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new rn(t,this,`cannot be missing both string and bytes: ${t}`);return dn(t.bytes)}ExtractSchema(){return de.prim}generateSchema(){return{__michelsonType:de.prim,schema:de.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new rn({bytes:t,string:e},this,`cannot be missing both string and bytes ${{string:e,bytes:t}}`);return dn(t)}compare(t,e){const i=o=>o.startsWith("tz"),n=i(t),s=i(e);return n&&!s?-1:s&&!n?1:super.compare(t,e)}findAndReturnTokens(t,e){return de.prim===t&&e.push(this),e}}de.prim="address";class Dh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="MapValidationError"}}class ke extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}isValid(t){return xt.isMichelsonMap(t)?null:new Dh(t,this,"Value must be a MichelsonMap")}Execute(t,e){const i=new xt(this.val);return t.forEach(n=>{i.set(this.KeySchema.ToKey(n.args[0]),this.ValueSchema.Execute(n.args[1],e))}),i}objLitToMichelsonMap(t){return t instanceof xt?t:typeof t=="object"?Object.keys(t).length===0?new xt:xt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop()),i=this.isValid(e);if(i)throw i;return Array.from(e.keys()).sort((n,s)=>this.KeySchema.compare(n,s)).map(n=>({prim:"Elt",args:[this.KeySchema.EncodeObject(n),this.ValueSchema.EncodeObject(e.get(n))]}))}EncodeObject(t,e){const i=this.objLitToMichelsonMap(t),n=this.isValid(i);if(n)throw n;return e&&e[ke.prim]?e[ke.prim](i):Array.from(i.keys()).sort((s,o)=>this.KeySchema.compare(s,o)).map(s=>({prim:"Elt",args:[this.KeySchema.EncodeObject(s),this.ValueSchema.EncodeObject(i.get(s))]}))}ExtractSchema(){return{map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:ke.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}findAndReturnTokens(t,e){return ke.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}ke.prim="map";class zt extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return String(t.prim).toLowerCase()==="true"}Encode(t){return{prim:t.pop()?"True":"False"}}EncodeObject(t,e){return e&&e[zt.prim]?e[zt.prim](t):{prim:t?"True":"False"}}ExtractSchema(){return zt.prim}generateSchema(){return{__michelsonType:zt.prim,schema:zt.prim}}ToBigMapKey(t){return{key:this.EncodeObject(t),type:{prim:zt.prim}}}ToKey(t){return this.EncodeObject(t)}compare(t,e){return t&&e||!t&&!e?0:t?1:-1}findAndReturnTokens(t,e){return zt.prim===t&&e.push(this),e}}zt.prim="bool";class ei extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="TxRollupL2AddressValidationError"}}class pe extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}ToBigMapKey(t){return{key:{bytes:jc(t)},type:{prim:"bytes"}}}isValid(t){if(G(t)!==L.VALID)throw new ei(t,this,`tx_rollup_l2_address is not valid: ${t}`);return null}Encode(t){const e=t.pop();if(!e)throw new ei(e,this,`arg missing to encode: this -> "${e}"`);return this.isValid(e),{string:e}}EncodeObject(t,e){return this.isValid(t),e&&e[pe.prim]?e[pe.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new ei(t,this,`value cannot be missing string and byte value. must have one ${JSON.stringify(t)}`);return Rs(t.bytes)}ExtractSchema(){return pe.prim}generateSchema(){return{__michelsonType:pe.prim,schema:pe.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new ei(t,this,`value cannot be missing string and byte value. must have one: bytes = ${t}`);return Rs(t)}findAndReturnTokens(t,e){return pe.prim===t&&e.push(this),e}}pe.prim="tx_rollup_l2_address";class _o extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ContractValidationError"}}class At extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return G(t)!==L.VALID?new _o(t,this,"Contract address is not valid"):null}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new _o(t,this,"must contain bytes or string");return dn(t.bytes)}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[At.prim]?e[At.prim](t):{string:t}}ExtractSchema(){return At.prim}generateSchema(){const t=this.createToken(this.val.args[0],0);return{__michelsonType:At.prim,schema:{parameter:this.val.args[0]?t.generateSchema():{}}}}findAndReturnTokens(t,e){return At.prim===t&&e.push(this),e}}At.prim="contract";class kh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ListValidationError"}}class Ne extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get valueSchema(){return this.createToken(this.val.args[0],this.idx)}isValid(t){return Array.isArray(t)?null:new kh(t,this,"Value must be an array")}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;const n=this.createToken(this.val.args[0],0);return e.reduce((s,o)=>[...s,n.EncodeObject(o)],[])}Execute(t,e){const i=this.createToken(this.val.args[0],0),n=this.isValid(t);if(n)throw n;return t.reduce((s,o)=>[...s,i.Execute(o,e)],[])}EncodeObject(t,e){const i=this.createToken(this.val.args[0],0),n=this.isValid(t);if(n)throw n;return e&&e[Ne.prim]?e[Ne.prim](t):t.reduce((s,o)=>[...s,i.EncodeObject(o)],[])}ExtractSchema(){return{[Ne.prim]:this.valueSchema.ExtractSchema()}}generateSchema(){return{__michelsonType:Ne.prim,schema:this.valueSchema.generateSchema()}}findAndReturnTokens(t,e){return Ne.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),e}}Ne.prim="list";class jh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="MutezValidationError"}}class qt extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return new A(t[Object.keys(t)[0]])}ExtractSchema(){return qt.prim}generateSchema(){return{__michelsonType:qt.prim,schema:qt.prim}}isValid(t){return new A(t).isNaN()?new jh(t,this,`Value is not a number: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{int:String(e).toString()}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[qt.prim]?e[qt.prim](t):{int:String(t).toString()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:qt.prim}}}ToKey({int:t}){return t}compare(t,e){const i=Number(t),n=Number(e);return i===n?0:i<n?-1:1}findAndReturnTokens(t,e){return qt.prim===t&&e.push(this),e}}qt.prim="mutez";class Bh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="BytesValidationError"}}class Wt extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}ToBigMapKey(t){return{key:{bytes:t},type:{prim:Wt.prim}}}isValid(t){return typeof t=="string"&&/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Bh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=Ss(this.convertUint8ArrayToHexString(e));const i=this.isValid(e);if(i)throw i;return{bytes:String(e).toString()}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t),typeof t=="string"&&(t=Ss(t));const i=this.isValid(t);if(i)throw i;return e&&e[Wt.prim]?e[Wt.prim](t):{bytes:String(t).toString()}}Execute(t){return t.bytes}ExtractSchema(){return Wt.prim}generateSchema(){return{__michelsonType:Wt.prim,schema:Wt.prim}}ToKey({bytes:t,string:e}){return e||t}findAndReturnTokens(t,e){return Wt.prim===t&&e.push(this),e}}Wt.prim="bytes";class Er extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}subToken(){return this.createToken(this.val.args[0],this.idx)}schema(){return this.createToken(this.val.args[0],0)}annot(){return Array.isArray(this.val.annots)?super.annot():this.createToken(this.val.args[0],this.idx).annot()}Encode(t){const e=t;return e==null?{prim:"None"}:Array.isArray(e)&&(e[e.length-1]===void 0||e[e.length-1]===null)?(e.pop(),{prim:"None"}):{prim:"Some",args:[this.schema().Encode(t)]}}EncodeObject(t,e){const i=t;return i==null?{prim:"None"}:{prim:"Some",args:[this.schema().EncodeObject(i,e)]}}Execute(t,e){return t.prim==="None"?null:this.schema().Execute(t.args[0],e)}ExtractSchema(){return this.schema().ExtractSchema()}generateSchema(){return{__michelsonType:Er.prim,schema:this.schema().generateSchema()}}ExtractSignature(){return[...this.schema().ExtractSignature(),[]]}get KeySchema(){return this.schema()}compare(t,e){if(t){if(!e)return 1}else return-1;return this.KeySchema.compare(t,e)}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return Er.prim===t&&e.push(this),this.subToken().findAndReturnTokens(t,e),e}}Er.prim="option";class Yt extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){if(t.string&&/^\d+$/.test(t.string))return new Date(Number(t.string)*1e3).toISOString();if(t.string)return new Date(t.string).toISOString();if(t.int)return new Date(Number(t.int)*1e3).toISOString()}Encode(t){const e=t.pop();return typeof e=="number"?{int:String(e)}:{string:e}}EncodeObject(t,e){return e&&e[Yt.prim]?e[Yt.prim](t):typeof t=="number"?{int:String(t)}:{string:t}}ExtractSchema(){return Yt.prim}generateSchema(){return{__michelsonType:Yt.prim,schema:Yt.prim}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Yt.prim}}}findAndReturnTokens(t,e){return Yt.prim===t&&e.push(this),e}}Yt.prim="timestamp";class Hh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="IntValidationError"}}class yt extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return new A(t[Object.keys(t)[0]])}ExtractSchema(){return yt.prim}generateSchema(){return{__michelsonType:yt.prim,schema:yt.prim}}isValid(t){return new A(t).isNaN()?new Hh(t,this,`Value is not a number: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{int:new A(e).toFixed()}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[yt.prim]?e[yt.prim](t):{int:new A(t).toFixed()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:yt.prim}}}ToKey({int:t}){return t}compare(t,e){const i=Number(t),n=Number(e);return i===n?0:i<n?-1:1}findAndReturnTokens(t,e){return yt.prim===t&&e.push(this),e}}yt.prim="int";class Jt extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Encode(t){return t.pop(),{prim:"Unit"}}EncodeObject(t,e){return e&&e[Jt.prim]?e[Jt.prim](t):{prim:"Unit"}}Execute(t){return Io}ExtractSchema(){return Jt.prim}generateSchema(){return{__michelsonType:Jt.prim,schema:Jt.prim}}compare(t,e){return 0}ToKey(t){return Io}ToBigMapKey(t){return{key:{prim:"Unit"},type:{prim:Jt.prim}}}findAndReturnTokens(t,e){return Jt.prim===t&&e.push(this),e}}Jt.prim="unit";const $h=4;class Uh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="KeyValidationError"}}class Zt extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string?t.string:Bc(t.bytes)}isValid(t){return Hc(t)!==L.VALID?new Uh(t,this,"Key is not valid"):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Zt.prim]?e[Zt.prim](t):{string:t}}ExtractSchema(){return Zt.prim}generateSchema(){return{__michelsonType:Zt.prim,schema:Zt.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:Zt.prim}}}compare(t,e){const i=this.getPrefix(t),n=this.getPrefix(e);if(i===P.EDPK&&n!==P.EDPK)return-1;if(i===P.SPPK&&n!==P.SPPK)return n===P.EDPK?1:-1;if(i===P.P2PK){if(n!==P.P2PK)return 1;const s=this.getP256PublicKeyComparableBytes(t),o=this.getP256PublicKeyComparableBytes(e);return Buffer.compare(s,o)}return super.compare(t,e)}getPrefix(t){return t.substring(0,$h)}getP256PublicKeyComparableBytes(t){return Jo(t,In[P.P2PK]).slice(1)}findAndReturnTokens(t,e){return Zt.prim===t&&e.push(this),e}}Zt.prim="key";class Vh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="KeyHashValidationError"}}class Xt extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string?t.string:Ps(t.bytes)}isValid(t){return Nn(t)!==L.VALID?new Vh(t,this,`KeyHash is not valid: ${t}`):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Xt.prim]?e[Xt.prim](t):{string:t}}ExtractSchema(){return Xt.prim}generateSchema(){return{__michelsonType:Xt.prim,schema:Xt.prim}}ToKey({string:t,bytes:e}){return t||Ps(e)}ToBigMapKey(t){return{key:{string:t},type:{prim:Xt.prim}}}findAndReturnTokens(t,e){return Xt.prim===t&&e.push(this),e}}Xt.prim="key_hash";class Kh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SignatureValidationError"}}class Qt extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string?t.string:t.bytes}isValid(t){return $c(t)!==L.VALID?new Kh(t,this,"Signature is not valid"):null}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Qt.prim]?e[Qt.prim](t):{string:t}}ExtractSchema(){return Qt.prim}generateSchema(){return{__michelsonType:Qt.prim,schema:Qt.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:Qt.prim}}}findAndReturnTokens(t,e){return Qt.prim===t&&e.push(this),e}}Qt.prim="signature";class xe extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get paramSchema(){return this.createToken(this.val.args[0],this.idx)}get returnSchema(){return this.createToken(this.val.args[1],this.idx+1)}Execute(t){return t.string?t.string:t}Encode(t){return t.pop()}EncodeObject(t,e){return e&&e[xe.prim]?e[xe.prim](t):t}ExtractSchema(){return{[xe.prim]:{parameters:this.paramSchema.ExtractSchema(),returns:this.returnSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:xe.prim,schema:{parameters:this.paramSchema.generateSchema(),returns:this.returnSchema.generateSchema()}}}findAndReturnTokens(t,e){return xe.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),this.createToken(this.val.args[1],this.idx).findAndReturnTokens(t,e),e}}xe.prim="lambda";class fe extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){return t.string}Encode(...t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[fe.prim]?e[fe.prim](t):{string:t}}ExtractSchema(){return fe.prim}generateSchema(){return{__michelsonType:fe.prim,schema:fe.prim}}findAndReturnTokens(t,e){return fe.prim===t&&e.push(this),e}}fe.prim="operation";class Gh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SetValidationError"}}class Le extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get KeySchema(){return this.createToken(this.val.args[0],0)}isValid(t){return Array.isArray(t)?null:new Gh(t,this,"Value must be an array")}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return e.sort((n,s)=>this.KeySchema.compare(n,s)).reduce((n,s)=>[...n,this.KeySchema.EncodeObject(s)],[])}Execute(t,e){return t.reduce((i,n)=>[...i,this.KeySchema.Execute(n,e)],[])}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[Le.prim]?e[Le.prim](t):t.sort((n,s)=>this.KeySchema.compare(n,s)).reduce((n,s)=>[...n,this.KeySchema.EncodeObject(s)],[])}ExtractSchema(){return Le.prim}generateSchema(){return{__michelsonType:Le.prim,schema:this.KeySchema.generateSchema()}}findAndReturnTokens(t,e){return Le.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),e}}Le.prim="set";class Fh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ChainIDValidationError"}}class te extends rt{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return Zo(t)!==L.VALID?new Fh(t,this,"ChainID is not valid"):null}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return te.prim}generateSchema(){return{__michelsonType:te.prim,schema:te.prim}}Encode(t){const e=t.pop(),i=this.isValid(e);if(i)throw i;return{string:e}}EncodeObject(t,e){const i=this.isValid(t);if(i)throw i;return e&&e[te.prim]?e[te.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:te.prim}}}findAndReturnTokens(t,e){return te.prim===t&&e.push(this),e}}te.prim="chain_id";class wo extends Error{constructor(){super("Tickets cannot be sent to the blockchain; they are created on-chain"),this.name="TicketEncodeError"}}const zh={prim:"contract"},qh={prim:"int"};class ne extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new wo}EncodeObject(t,e){if(e&&e[ne.prim])return e[ne.prim](t,this.val);throw new wo}Execute(t,e){if(e&&e[ne.prim])return e[ne.prim](t,this.val);const i=this.createToken(zh,this.idx),n=this.valueToken,s=this.createToken(qh,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:i.Execute(t.args[0],e),value:n.Execute(t.args[1].args[0],e),amount:s.Execute(t.args[1].args[1],e)}:{ticketer:i.Execute(t.args[0],e),value:n.Execute(t.args[1],e),amount:s.Execute(t.args[2],e)}}ExtractSchema(){return{ticketer:At.prim,value:this.valueToken.ExtractSchema(),amount:yt.prim}}generateSchema(){return{__michelsonType:ne.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:At.prim,schema:At.prim},amount:{__michelsonType:yt.prim,schema:yt.prim}}}}findAndReturnTokens(t,e){return ne.prim===t&&e.push(this),this.valueToken.findAndReturnTokens(t,e),e}}ne.prim="ticket";class Ao extends Error{constructor(){super("Ticket_deprecated cannot be sent to the blockchain; they are created on-chain"),this.name="TicketDeprecatedEncodeError"}}const Wh={prim:"contract"},Yh={prim:"int"};class se extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new Ao}EncodeObject(t,e){if(e&&e[se.prim])return e[se.prim](t,this.val);throw new Ao}Execute(t,e){if(e&&e[se.prim])return e[se.prim](t,this.val);const i=this.createToken(Wh,this.idx),n=this.valueToken,s=this.createToken(Yh,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:i.Execute(t.args[0],e),value:n.Execute(t.args[1].args[0],e),amount:s.Execute(t.args[1].args[1],e)}:{ticketer:i.Execute(t.args[0],e),value:n.Execute(t.args[1],e),amount:s.Execute(t.args[2],e)}}ExtractSchema(){return{ticketer:At.prim,value:this.valueToken.ExtractSchema(),amount:yt.prim}}generateSchema(){return{__michelsonType:se.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:At.prim,schema:At.prim},amount:{__michelsonType:yt.prim,schema:yt.prim}}}}findAndReturnTokens(t,e){return se.prim===t&&e.push(this),this.valueToken.findAndReturnTokens(t,e),e}}se.prim="ticket_deprecated";class nn extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="NeverTokenError"}}class ge extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Encode(t){const e=t.pop();throw new nn(e,this,"Assigning a value to the type never is forbidden.")}EncodeObject(t,e){if(e&&e[ge.prim])return e[ge.prim](t);throw new nn(t,this,"Assigning a value to the type never is forbidden.")}Execute(t){throw new nn(t,this,"There is no literal value for the type never.")}ExtractSchema(){return ge.prim}generateSchema(){return{__michelsonType:ge.prim,schema:ge.prim}}findAndReturnTokens(t,e){return ge.prim===t&&e.push(this),e}}ge.prim="never";class sn extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SaplingStateValidationError"}}class ee extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return typeof t=="object"&&Object.keys(t).length===0}Execute(t,e){if(e&&e[ee.prim])return e[ee.prim](t,this.val);if("int"in t)return t.int;throw new sn(t,this,`Sapling state is expecting an object with an int property. Got ${JSON.stringify(t)}`)}Encode(t){const e=t.pop();if(this.isValid(e))return[];throw new sn(e,this,`Invalid sapling_state. Received: ${e} while expecting: {}`)}EncodeObject(t,e){if(e&&e[ee.prim])return e[ee.prim](t);if(this.isValid(t))return[];throw new sn(t,this,`Invalid sapling_state. Received: ${t} while expecting: {}`)}ExtractSchema(){return{[ee.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:ee.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return ee.prim===t&&e.push(this),e}}ee.prim="sapling_state";class Oo extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SaplingTransactionValidationError"}}class Ce extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){throw new Oo(t,this,"There is no literal value for the sapling_transaction type.")}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new Oo(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[Ce.prim]?e[Ce.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[Ce.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:Ce.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return Ce.prim===t&&e.push(this),e}}Ce.prim="sapling_transaction";class Ro extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="SaplingTransactionDeprecatedValidationError"}}class Me extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t){throw new Ro(t,this,"There is no literal value for the sapling_transaction_deprecated type.")}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new Ro(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[Me.prim]?e[Me.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[Me.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:Me.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return Me.prim===t&&e.push(this),e}}Me.prim="sapling_transaction_deprecated";class Jh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="Bls12381frValidationError"}}class me extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Jh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();if(typeof e=="number")return{int:e.toString()};{e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}}EncodeObject(t,e){if(e&&e[me.prim])return e[me.prim](t);if(typeof t=="number")return{int:t.toString()};{t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return{bytes:t}}}Execute(t){return t.bytes}ExtractSchema(){return me.prim}generateSchema(){return{__michelsonType:me.prim,schema:me.prim}}findAndReturnTokens(t,e){return me.prim===t&&e.push(this),e}}me.prim="bls12_381_fr";class Zh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="Bls12381g1ValidationError"}}class ye extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Zh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[ye.prim]?e[ye.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return ye.prim}generateSchema(){return{__michelsonType:ye.prim,schema:ye.prim}}findAndReturnTokens(t,e){return ye.prim===t&&e.push(this),e}}ye.prim="bls12_381_g1";class Xh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="Bls12381g2ValidationError"}}class be extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Xh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[be.prim]?e[be.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return be.prim}generateSchema(){return{__michelsonType:be.prim,schema:be.prim}}findAndReturnTokens(t,e){return be.prim===t&&e.push(this),e}}be.prim="bls12_381_g2";class Qh extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ChestValidationError"}}class Ee extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Qh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[Ee.prim]?e[Ee.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Ee.prim}generateSchema(){return{__michelsonType:Ee.prim,schema:Ee.prim}}findAndReturnTokens(t,e){return Ee.prim===t&&e.push(this),e}}Ee.prim="chest";class td extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="ChestKeyValidationError"}}class ve extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new td(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const i=this.isValid(e);if(i)throw i;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const i=this.isValid(t);if(i)throw i;return e&&e[ve.prim]?e[ve.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return ve.prim}generateSchema(){return{__michelsonType:ve.prim,schema:ve.prim}}findAndReturnTokens(t,e){return ve.prim===t&&e.push(this),e}}ve.prim="chest_key";class So extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="GlobalConstantEncodingError"}}class ed extends W{constructor(t,e,i){super(t,e,i),this.value=t,this.token=e,this.name="GlobalConstantDecodingError"}}class re extends ct{constructor(t,e,i){super(t,e,i),this.val=t,this.idx=e,this.fac=i}Execute(t,e){if(e&&e[re.prim])return e[re.prim](t,this.val);throw new ed(t,this,`Unable to decode a value represented by a globalThis constants. Please provide an expanded script to the Michelson-Encoder or semantics for the decoding. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}Encode(t){throw new So(t,this,`Unable to encode a script containing globalThis constants. Please provide an expanded script to the Michelson-Encoder. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}EncodeObject(t,e){if(e&&e[re.prim])return e[re.prim](t);throw new So(t,this,`Unable to encode a script containing globalThis constants. Please provide an expanded script to the Michelson-Encoder. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}ExtractSchema(){return re.prim}generateSchema(){return{__michelsonType:re.prim,schema:{hash:this.val.args[0].string}}}findAndReturnTokens(t,e){return re.prim===t&&e.push(this),e}}re.prim="constant";const rd=[at,Gt,Ft,Nt,de,pe,ke,zt,V,At,Ne,qt,Wt,Er,Yt,yt,Jt,Zt,Xt,Qt,xe,fe,Le,te,ne,se,ge,ee,Ce,Me,me,ye,be,Ee,ve,re];class id extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="Invalid token error"}}function rr(r,t){if(Array.isArray(r))return new at(r,t,rr);const e=rd.find(i=>i.prim===r.prim);if(!e)throw new id("Malformed data expected a value with a valid prim property",r);return new e(r,t,rr)}class nd extends Error{constructor(t,e){super(`Unable to encode the parameter of the view: ${t}.`),this.smartContractViewName=t,this.originalError=e,this.name="ViewEncodingError"}}class Po extends Error{constructor(t){super(t),this.message=t,this.name="InvalidScriptError"}}class Da extends Error{constructor(t){super("Invalid RPC response passed as argument(s)"),this.script=t,this.name="InvalidRpcResponseError"}}class To extends Error{constructor(t,e,i){super(`
      ${t}. Error encountered when trying to encode arguments: 

      [${e}]
    `),this.message=t,this.args=e,this.originalError=i,this.name="ParameterEncodingError"}}class ri extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBigMapSchema"}}class sd extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBigMapDiff"}}class od extends Error{constructor(t,e){super(`Unable to encode ${t}. ${e}`),this.obj=t,this.details=e,this.name="BigMapEncodingError"}}class ad extends Error{constructor(t,e){super(`Unable to encode ${t}. ${e}`),this.obj=t,this.details=e,this.name="StorageEncodingError"}}class cd extends Error{constructor(t){super(t),this.message=t,this.name="MissingArgumentError"}}var ka;const ja=Symbol.for("taquito-schema-type-symbol");function Br(r,t=at.prim){var e,i;if(Array.isArray(r))return Br({prim:t,args:r},t);const n=r;return n.prim===t&&n.args&&n.args.length>2?Object.assign(Object.assign({},n),{args:[(e=n.args)===null||e===void 0?void 0:e[0],{prim:t,args:(i=n.args)===null||i===void 0?void 0:i.slice(1)}]}):n}function Ba(r,t){const e=Br(r),i=Br(t);return e.prim===i.prim&&(e.args===void 0&&i.args===void 0||e.args!==void 0&&i.args!==void 0&&e.args.length===i.args.length&&e.args.every((n,s)=>{var o,a;return Ba(n,(a=(o=i.args)===null||o===void 0?void 0:o[s])!==null&&a!==void 0?a:{})}))&&(e.annots===void 0&&i.annots===void 0||e.annots!==void 0&&i.annots!==void 0&&e.annots.length===i.annots.length&&e.annots.every((n,s)=>{var o;return n===((o=i.annots)===null||o===void 0?void 0:o[s])}))}class Lt{constructor(t){if(this.val=t,this[ka]=!0,this.root=rr(t,0),this.root instanceof Nt)this.bigMap=this.root;else if(this.isExpressionExtended(t)&&t.prim==="pair"){const e=t.args[0];this.isExpressionExtended(e)&&e.prim==="big_map"&&(this.bigMap=new Nt(e,0,rr))}}static isSchema(t){return t&&t[ja]===!0}static fromRPCResponse(t){const e=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.find(i=>{if(Array.isArray(i))this.fromRPCResponse({script:{code:i,storage:t.script.storage}});else{const n=i;return n.prim?n.prim==="storage":!1}});if(!e||!Array.isArray(e.args))throw new Da(t.script);return new Lt(e.args[0])}isExpressionExtended(t){return"prim"in t&&Array.isArray(t.args)}removeTopLevelAnnotation(t){return(this.root instanceof at||this.root instanceof V)&&this.root.hasAnnotations()&&typeof t=="object"&&Object.keys(t).length===1?t[Object.keys(t)[0]]:t}Execute(t,e){const i=this.root.Execute(t,e);return this.removeTopLevelAnnotation(i)}Typecheck(t){if(this.root instanceof Nt&&Number.isInteger(Number(t))||this.root instanceof ne&&t.ticketer&&t.value&&t.amount||this.root instanceof se&&t.ticketer&&t.value&&t.amount||this.root instanceof ke&&this.root.ValueSchema instanceof Nt)return!0;try{return this.root.EncodeObject(t),!0}catch{return!1}}ExecuteOnBigMapDiff(t,e){if(!this.bigMap)throw new ri("Big map schema is undefined");if(!Array.isArray(t))throw new sd("Big map diff must be an array");const i=t.map(({key:n,value:s})=>({args:[n,s]}));return this.bigMap.Execute(i,e)}ExecuteOnBigMapValue(t,e){if(!this.bigMap)throw new ri("No big map schema");return this.bigMap.ValueSchema.Execute(t,e)}EncodeBigMapKey(t){if(!this.bigMap)throw new ri("Big map schema is undefined");try{return this.bigMap.KeySchema.ToBigMapKey(t)}catch(e){throw new od("big map key",e)}}Encode(t,e){try{return this.root.EncodeObject(t,e)}catch(i){throw i instanceof W?i:new ad("storage object",i)}}ExtractSchema(){return this.removeTopLevelAnnotation(this.root.ExtractSchema())}generateSchema(){return this.removeTopLevelAnnotation(this.root.generateSchema())}ComputeState(t,e){if(!this.bigMap)throw new ri("Big map schema is undefined");const i=t.reduce((n,s)=>Object.assign(Object.assign({},n),this.ExecuteOnBigMapDiff(s.contents[0].metadata.operation_result.big_map_diff)),{});return Object.assign(Object.assign({},this.Execute(e)),{[this.bigMap.annot()]:i})}FindFirstInTopLevelPair(t,e){return this.findValue(this.root.val,t,e)}findValue(t,e,i){if(Ba(i,t))return e;if(Array.isArray(t)||t.prim==="pair"){const n=Br(t),s=Br(e,"Pair");if(n.args===void 0||s.args===void 0)throw new cd("Tokens have no arguments");if(n.args[0])return this.findValue(n.args[0],s.args[0],i)||this.findValue(n.args[1],s.args[1],i)}}findToken(t){const e=[];return this.root.findAndReturnTokens(t,e)}}ka=ja;class ur{constructor(t){this.root=rr(t,0)}static fromRPCResponse(t){const e=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.find(i=>i.prim==="parameter");if(!e||!Array.isArray(e.args))throw new Da(t.script);return new ur(e.args[0])}get isMultipleEntryPoint(){return this.root instanceof V||this.root instanceof Er&&this.root.subToken()instanceof V}get hasAnnotation(){return this.isMultipleEntryPoint?Object.keys(this.ExtractSchema())[0]!=="0":!0}Execute(t,e){return this.root.Execute(t,e)}Encode(...t){try{return this.root.Encode(t.reverse())}catch(e){throw e instanceof W?e:new To("Unable to encode parameter",t.toString(),e)}}EncodeObject(t,e){try{return this.root.EncodeObject(t,e)}catch(i){throw i instanceof W?i:new To("Unable to encode parameter object",t,i)}}ExtractSchema(){return this.root.ExtractSchema()}generateSchema(){return this.root.generateSchema()}ExtractSignatures(){return this.root.ExtractSignature()}}class zn{constructor(t){if(t.length!==4||!("string"in t[0]))throw new Po(`Invalid on-chain view: ${JSON.stringify(t)}`);this.viewName=t[0].string,this.viewArgsType=t[1],this.viewReturnType=t[2],this.instructions=t[3],this.rootArgsType=rr(this.viewArgsType,0),this.rootReturnType=rr(this.viewReturnType,0)}static fromRPCResponse(t){const e=[],i=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.filter(n=>n.prim==="view");return i&&i.forEach(n=>{if(!n.args||n.args.length!==4)throw new Po(`Invalid on-chain view found in the script: ${JSON.stringify(n)}`);e.push(new zn(n.args))}),e}encodeViewArgs(t){try{return this.rootArgsType.EncodeObject(t)}catch(e){throw new nd(this.viewName,e)}}decodeViewResult(t,e){return this.rootReturnType.Execute(t,e)}extractArgsSchema(){return this.rootArgsType.ExtractSchema()}extractResultSchema(){return this.rootReturnType.ExtractSchema()}}const Io=Symbol(),vt=Symbol("source_reference");class Je extends Error{constructor(t,e,i){super(i),this.src=t,this.idx=e,Object.setPrototypeOf(this,Je.prototype)}}var _t;(function(r){r[r.Comment=0]="Comment",r[r.Number=1]="Number",r[r.String=2]="String",r[r.Bytes=3]="Bytes",r[r.Ident=4]="Ident"})(_t||(_t={}));const ud=new RegExp("\\s"),ld=new RegExp("[:@%_A-Za-z]"),hd=new RegExp("[@%_\\.A-Za-z0-9]"),No=new RegExp("[0-9]"),dd=new RegExp("[0-9a-fA-F]");function*on(r,t=!1){let e=0;for(;e<r.length;){for(;e<r.length&&ud.test(r[e]);)e++;if(e===r.length)return;const i=r[e],n=e;if(ld.test(i)){for(e++;e<r.length&&hd.test(r[e]);)e++;yield{t:_t.Ident,v:r.slice(n,e),first:n,last:e}}else if(r.length-e>1&&r.substr(e,2)==="0x"){for(e+=2;e<r.length&&dd.test(r[e]);)e++;if(e-n&1)throw new Je(r,e,"Bytes literal length is expected to be power of two");yield{t:_t.Bytes,v:r.slice(n,e),first:n,last:e}}else if(No.test(i)||i==="-"){i==="-"&&e++;const s=e;for(;e<r.length&&No.test(r[e]);)e++;if(s===e)throw new Je(r,e,"Number literal is too short");yield{t:_t.Number,v:r.slice(n,e),first:n,last:e}}else if(i==='"'){e++;let s=!1;for(;e<r.length&&(s||r[e]!=='"');e++)!s&&r[e]==="\\"?s=!0:s=!1;if(e===r.length)throw new Je(r,e,"Unterminated string literal");e++,yield{t:_t.String,v:r.slice(n,e),first:n,last:e}}else if(i==="#"){for(e++;e<r.length&&r[e]!==`
`;)e++;t&&(yield{t:_t.Comment,v:r.slice(n,e),first:n,last:e})}else if(r.length-e>1&&r.substr(e,2)==="/*"){for(e+=2;e<r.length&&!(r.length-e>1&&r.substr(e,2)==="*/");)e++;if(e===r.length)throw new Je(r,e,"Unterminated C style comment");e+=2,t&&(yield{t:_t.Comment,v:r.slice(n,e),first:n,last:e})}else if(i==="("||i===")"||i==="{"||i==="}"||i===";")e++,yield{t:i,v:i,first:n,last:e};else throw new Je(r,e,`Invalid character at offset ${e}: \`${i}'`)}}const ii=Symbol("ref_contract");var Re;(function(r){r.Ps9mPmXa="Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P",r.PtCJ7pwo="PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY",r.PsYLVpVv="PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt",r.PsddFKi3="PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP",r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdoTez="PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLoren="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANAD="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangzH="PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakarta="PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(Re||(Re={}));const Ha=Re.Psithaca2,xo={Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P:0,PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY:1,PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt:2,PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP:3,Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd:4,PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU:5,PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS:5,PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb:6,PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo:7,PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq:8,PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA:8,PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i:9,PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV:10,PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r:11,PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx:11,PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP:12,Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A:12,PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw:13,PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY:13,PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg:14,PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW:15,PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc:16,PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1:16,ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK:17};function lr(r,t){return xo[r]<xo[t]}class Ct extends Error{constructor(t,e){super(e),this.prim=t,Object.setPrototypeOf(this,Ct.prototype)}}function J(r,t){var e,i;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new Ct(r,`macro ${r.prim} expects ${t} arguments, was given ${(i=r.args)===null||i===void 0?void 0:i.length}`)}function xr(r){if(r.annots===void 0)return!0;throw new Ct(r,`unexpected annotation on macro ${r.prim}: ${r.annots}`)}function Lo(r,t){if("int"in t)return!0;throw new Ct(r,`macro ${r.prim} expects int argument`)}function Cr(r,t,e,i){let n=0,s=0;const o=[null,null];let a;if(n===t.length)throw new Ct(r,`unexpected end: ${r.prim}`);let c=t[n++];switch(c){case"P":{const{r:l,n:d,an:y}=Cr(r,t.slice(n),e.slice(s),i);a=l,n+=d,s+=y;break}case"A":s!==e.length&&(o[0]=e[s++]);break;default:throw new Ct(r,`${r.prim}: unexpected character: ${c}`)}let h;if(n===t.length)throw new Ct(r,`unexpected end: ${r.prim}`);switch(c=t[n++],c){case"P":{const{r:l,n:d,an:y}=Cr(r,t.slice(n),e.slice(s),i);h=l.map(([v,k])=>[v+1,k]),n+=d,s+=y;break}case"I":s!==e.length&&(o[1]=e[s++]);break;default:throw new Ct(r,`${r.prim}: unexpected character: ${c}`)}return{r:i(a,h,[0,o]),n,an:s}}function Ai(r,t,e,i){const n=t[0];switch(n){case"A":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CAR",annots:["@%%"]},Ai(r,t.slice(1),[],i)]]},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%@","%@",...e]}]:i.a;case"D":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CDR",annots:["@%%"]},Ai(r,t.slice(1),[],i)]]},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%@",...e]}]:i.d;default:throw new Ct(r,`${r.prim}: unexpected character: ${n}`)}}function pd(r,t){let e=r.length;for(;e>0&&r[e-1]===t;)e--;return r.slice(0,e)}function an(r){const t=[],e=[];if(r!==void 0)for(const i of r)(i.length!==0&&i[0]==="%"?t:e).push(i);return{fields:t,rest:e}}function ut({prim:r,annots:t,args:e}){return Object.assign(Object.assign({prim:r},t&&{annots:t}),e&&{args:e})}const fd=/^P[PAI]{3,}R$/,gd=/^UNP[PAI]{2,}R$/,md=/^C[AD]{2,}R$/,yd=/^SET_C[AD]+R$/,bd=/^MAP_C[AD]+R$/,Ed=/^DI{2,}P$/,vd=/^DU+P$/;function _d(r,t){const e=(t==null?void 0:t.protocol)||Ha;function i(n){return n!==void 0?[{prim:"RENAME",annots:n}]:[]}switch(r.prim){case"CMPEQ":case"CMPNEQ":case"CMPLT":case"CMPGT":case"CMPLE":case"CMPGE":if(J(r,0))return[{prim:"COMPARE"},ut({prim:r.prim.slice(3),annots:r.annots})];break;case"IFEQ":case"IFNEQ":case"IFLT":case"IFGT":case"IFLE":case"IFGE":if(J(r,2))return[{prim:r.prim.slice(2)},ut({prim:"IF",annots:r.annots,args:r.args})];break;case"IFCMPEQ":case"IFCMPNEQ":case"IFCMPLT":case"IFCMPGT":case"IFCMPLE":case"IFCMPGE":if(J(r,2))return[{prim:"COMPARE"},{prim:r.prim.slice(5)},ut({prim:"IF",annots:r.annots,args:r.args})];break;case"FAIL":if(J(r,0)&&xr(r))return[{prim:"UNIT"},{prim:"FAILWITH"}];break;case"ASSERT":if(J(r,0)&&xr(r))return[{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_EQ":case"ASSERT_NEQ":case"ASSERT_LT":case"ASSERT_GT":case"ASSERT_LE":case"ASSERT_GE":if(J(r,0)&&xr(r))return[{prim:r.prim.slice(7)},{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_CMPEQ":case"ASSERT_CMPNEQ":case"ASSERT_CMPLT":case"ASSERT_CMPGT":case"ASSERT_CMPLE":case"ASSERT_CMPGE":if(J(r,0)&&xr(r))return[[{prim:"COMPARE"},{prim:r.prim.slice(10)}],{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_NONE":if(J(r,0)&&xr(r))return[{prim:"IF_NONE",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_SOME":if(J(r,0))return[{prim:"IF_NONE",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],i(r.annots)]}];break;case"ASSERT_LEFT":if(J(r,0))return[{prim:"IF_LEFT",args:[i(r.annots),[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_RIGHT":if(J(r,0))return[{prim:"IF_LEFT",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],i(r.annots)]}];break;case"IF_SOME":if(J(r,2))return[ut({prim:"IF_NONE",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"IF_RIGHT":if(J(r,2))return[ut({prim:"IF_LEFT",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"CAR":case"CDR":if(r.args!==void 0){if(J(r,1)&&Lo(r,r.args[0])){const n=parseInt(r.args[0].int,10);return ut({prim:"GET",args:[{int:r.prim==="CAR"?String(n*2+1):String(n*2)}],annots:r.annots})}}else return r}if(fd.test(r.prim)&&J(r,0)){const{fields:n,rest:s}=an(r.annots),{r:o}=Cr(r,r.prim.slice(1),n,(a,c,h)=>[...a||[],...c||[],h]);return o.map(([a,c],h)=>{const l=[...pd(c,null).map(y=>y===null?"%":y),...a===0&&h===o.length-1?s:[]],d=ut({prim:"PAIR",annots:l.length!==0?l:void 0});return a===0?d:{prim:"DIP",args:a===1?[[d]]:[{int:String(a)},[d]]}})}if(gd.test(r.prim))if(lr(e,Re.PtEdo2Zk)&&J(r,0)){const{r:n}=Cr(r,r.prim.slice(3),r.annots||[],(s,o,a)=>[a,...o||[],...s||[]]);return n.map(([s,o])=>{const a=[{prim:"DUP"},ut({prim:"CAR",annots:o[0]!==null?[o[0]]:void 0}),{prim:"DIP",args:[[ut({prim:"CDR",annots:o[1]!==null?[o[1]]:void 0})]]}];return s===0?a:{prim:"DIP",args:s===1?[[a]]:[{int:String(s)},[a]]}})}else{if(r.prim==="UNPAIR")return r;if(J(r,0)){const{r:n}=Cr(r,r.prim.slice(3),[],(s,o,a)=>[a,...o||[],...s||[]]);return n.map(([s])=>{const o=ut({prim:"UNPAIR"});return s===0?o:{prim:"DIP",args:s===1?[[o]]:[{int:String(s)},[o]]}})}}if(md.test(r.prim)&&J(r,0)){const n=[...r.prim.slice(1,r.prim.length-1)];return n.map((s,o)=>{const a=o===n.length-1?r.annots:void 0;switch(s){case"A":return ut({prim:"CAR",annots:a});case"D":return ut({prim:"CDR",annots:a});default:throw new Ct(r,`unexpected character: ${s}`)}})}if(yd.test(r.prim)&&J(r,0)){const{fields:n,rest:s}=an(r.annots);if(n.length>1)throw new Ct(r,`unexpected annotation on macro ${r.prim}: ${n}`);const o=n.length!==0?{a:[{prim:"DUP"},{prim:"CAR",annots:n},{prim:"DROP"},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:[n[0],"%@"]}],d:[{prim:"DUP"},{prim:"CDR",annots:n},{prim:"DROP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",n[0]]}]}:{a:[{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%","%@"]}],d:[{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%"]}]};return Ai(r,r.prim.slice(5,r.prim.length-1),s,o)}if(bd.test(r.prim)&&J(r,1)){const{fields:n}=an(r.annots);if(n.length>1)throw new Ct(r,`unexpected annotation on macro ${r.prim}: ${n}`);const s={a:[{prim:"DUP"},{prim:"CDR",annots:["@%%"]},{prim:"DIP",args:[[ut({prim:"CAR",annots:n.length!==0?["@"+n[0].slice(1)]:void 0}),r.args[0]]]},{prim:"SWAP"},{prim:"PAIR",annots:[n.length!==0?n[0]:"%","%@"]}],d:[{prim:"DUP"},ut({prim:"CDR",annots:n.length!==0?["@"+n[0].slice(1)]:void 0}),r.args[0],{prim:"SWAP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",n.length!==0?n[0]:"%"]}]};return Ai(r,r.prim.slice(5,r.prim.length-1),[],s)}if(Ed.test(r.prim)&&J(r,1)){let n=0;for(;r.prim[1+n]==="I";)n++;return ut({prim:"DIP",args:[{int:String(n)},r.args[0]]})}if(vd.test(r.prim)){let n=0;for(;r.prim[1+n]==="U";)n++;if(lr(e,Re.PtEdo2Zk)){if(n===1){if(r.args===void 0)return r;J(r,1)&&Lo(r,r.args[0])&&(n=parseInt(r.args[0].int,10))}else J(r,0);return n===1?[ut({prim:"DUP",annots:r.annots})]:n===2?[{prim:"DIP",args:[[ut({prim:"DUP",annots:r.annots})]]},{prim:"SWAP"}]:[{prim:"DIP",args:[{int:String(n-1)},[ut({prim:"DUP",annots:r.annots})]]},{prim:"DIG",args:[{int:String(n)}]}]}else{if(n===1)return r;if(J(r,0))return ut({prim:"DUP",args:[{int:String(n)}],annots:r.annots})}}return r}function wd(r,t){return r.args!==void 0&&r.args.length===1&&"string"in r.args[0]&&r.args[0].string in t?t[r.args[0].string]:r}class fr extends Error{constructor(t,e){super(e),this.token=t,Object.setPrototypeOf(this,fr.prototype)}}class Vt extends Error{constructor(t,e){super(e),this.node=t,Object.setPrototypeOf(this,Vt.prototype)}}const cn=new fr(null,"Unexpected EOF");function Co(r){return r.t===_t.Ident&&(r.v[0]==="@"||r.v[0]==="%"||r.v[0]===":")}const Ad=new RegExp("^-?[0-9]+$"),Od=new RegExp("^([0-9a-fA-F]{2})*$");class Qe{constructor(t){this.opt=t}expand(t){var e,i,n;if(((e=this.opt)===null||e===void 0?void 0:e.expandGlobalConstant)!==void 0&&t.prim==="constant"){const s=wd(t,this.opt.expandGlobalConstant);return s!==t&&(s[vt]=Object.assign(Object.assign({},t[vt]||{first:0,last:0}),{globalConstant:t})),s}if(((i=this.opt)===null||i===void 0?void 0:i.expandMacros)===void 0||!((n=this.opt)===null||n===void 0)&&n.expandMacros){const s=_d(t,this.opt);return s!==t&&(s[vt]=Object.assign(Object.assign({},t[vt]||{first:0,last:0}),{macro:t})),s}else return t}parseListExpr(t,e){var i;const n={first:e.first,last:e.last},s=e.t==="(";let o;if(s){if(o=t.next(),o.done)throw cn;n.last=o.value.last}else o={value:e};if(o.value.t!==_t.Ident)throw new fr(o.value,`not an identifier: ${o.value.v}`);const a={prim:o.value.v,[vt]:n};for(;;){const c=t.next();if(c.done){if(s)throw cn;break}else if(c.value.t===")"){if(!s)throw new fr(c.value,"unexpected closing bracket");n.last=c.value.last;break}else if(Co(c.value))a.annots=a.annots||[],a.annots.push(c.value.v),n.last=c.value.last;else{a.args=a.args||[];const h=this.parseExpr(t,c.value);n.last=((i=h[vt])===null||i===void 0?void 0:i.last)||n.last,a.args.push(h)}}return this.expand(a)}parseArgs(t,e){var i;const n={first:e.first,last:e.last},s={prim:e.v,[vt]:n};for(;;){const o=t.next();if(o.done||o.value.t==="}"||o.value.t===";")return[s,o];if(Co(o.value))n.last=o.value.last,s.annots=s.annots||[],s.annots.push(o.value.v);else{const a=this.parseExpr(t,o.value);n.last=((i=a[vt])===null||i===void 0?void 0:i.last)||n.last,s.args=s.args||[],s.args.push(a)}}}parseSequenceExpr(t,e){var i,n;const s={first:e.first,last:e.last},o=[];o[vt]=s;const a=e.t==="{";let c=e.t==="{"?null:{value:e};for(;;){if(c===null&&(c=t.next(),c.done||(s.last=c.value.last)),c.done){if(a)throw cn;return o}if(c.value.t==="}"){if(a)return o;throw new fr(c.value,"unexpected closing bracket")}else if(c.value.t===_t.Ident){const[h,l]=this.parseArgs(t,c.value);s.last=((i=h[vt])===null||i===void 0?void 0:i.last)||s.last,o.push(this.expand(h)),c=l}else{const h=this.parseExpr(t,c.value);s.last=((n=h[vt])===null||n===void 0?void 0:n.last)||s.last,o.push(h),c=null}c===null&&(c=t.next(),c.done||(s.last=c.value.last)),!c.done&&c.value.t===";"&&(c=null)}}parseExpr(t,e){switch(e.t){case _t.Ident:return this.expand({prim:e.v,[vt]:{first:e.first,last:e.last}});case _t.Number:return{int:e.v,[vt]:{first:e.first,last:e.last}};case _t.String:return{string:JSON.parse(e.v),[vt]:{first:e.first,last:e.last}};case _t.Bytes:return{bytes:e.v.slice(2),[vt]:{first:e.first,last:e.last}};case"{":return this.parseSequenceExpr(t,e);default:return this.parseListExpr(t,e)}}parseSequence(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=on(t),i=e.next();return i.done?null:this.parseSequenceExpr(e,i.value)}parseList(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=on(t),i=e.next();return i.done?null:this.parseListExpr(e,i.value)}parseMichelineExpression(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=on(t),i=e.next();return i.done?null:this.parseExpr(e,i.value)}parseScript(t){return this.parseSequence(t)}parseData(t){return this.parseList(t)}parseJSON(t){if(typeof t!="object")throw new TypeError(`object type was expected, got ${typeof t} instead`);if(Array.isArray(t)){const e=[];for(const i of t){if(i===null||typeof i!="object")throw new Vt(i,`unexpected sequence element: ${i}`);e.push(this.parseJSON(i))}return e}else if("prim"in t){const e=t;if(typeof e.prim=="string"&&(e.annots===void 0||Array.isArray(e.annots))&&(e.args===void 0||Array.isArray(e.args))){const i={prim:e.prim};if(e.annots!==void 0){for(const n of e.annots)if(typeof n!="string")throw new Vt(n,`string expected: ${n}`);i.annots=e.annots}if(e.args!==void 0){i.args=[];for(const n of e.args){if(n===null||typeof n!="object")throw new Vt(n,`unexpected argument: ${n}`);i.args.push(this.parseJSON(n))}}return this.expand(i)}throw new Vt(t,`malformed prim expression: ${t}`)}else if("string"in t){if(typeof t.string=="string")return{string:t.string};throw new Vt(t,`malformed string literal: ${t}`)}else if("int"in t){if(typeof t.int=="string"&&Ad.test(t.int))return{int:t.int};throw new Vt(t,`malformed int literal: ${t}`)}else if("bytes"in t){if(typeof t.bytes=="string"&&Od.test(t.bytes))return{bytes:t.bytes};throw new Vt(t,`malformed bytes literal: ${t}`)}else throw new Vt(t,`unexpected object: ${t}`)}}const Rd=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Sd=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];class En extends Error{constructor(t){super(t),this.message=t,this.name="Base58DecodingError"}}class Pd extends Error{constructor(t){super(t),this.message=t,this.name="InvalidMessageError"}}function Mo(r){const t=(r.length+9)%64,e=t===0?0:64-t;if(r.length>268435455)throw new Pd(`SHA-256 -- message length is too big: ${r.length}`);const i=r.length<<3,n=[...r,128,...new Array(e).fill(0),0,0,0,0,i>>24&255,i>>16&255,i>>8&255,i&255];function s(l,d){return l>>>d|l<<32-d}const o=[...Rd],a=new Array(64),c=new Array(8);for(let l=0;l<n.length;l+=64){let d=l,y=0;for(;y<16;)a[y]=n[d]<<24|n[d+1]<<16|n[d+2]<<8|n[d+3],d+=4,y++;for(;y<64;){const v=s(a[y-15],7)^s(a[y-15],18)^a[y-15]>>>3,k=s(a[y-2],17)^s(a[y-2],19)^a[y-2]>>>10;a[y]=(k|0)+a[y-7]+v+a[y-16]|0,y++}for(let v=0;v<8;v++)c[v]=o[v];for(let v=0;v<64;v++){const k=s(c[0],2)^s(c[0],13)^s(c[0],22),Y=s(c[4],6)^s(c[4],11)^s(c[4],25),T=c[7]+Y+(c[4]&c[5]^~c[4]&c[6])+Sd[v]+a[v]|0,w=k+(c[0]&c[1]^c[0]&c[2]^c[1]&c[2])|0;c[7]=c[6],c[6]=c[5],c[5]=c[4],c[4]=c[3]+T|0,c[3]=c[2],c[2]=c[1],c[1]=c[0],c[0]=T+w|0}for(let v=0;v<8;v++)o[v]=o[v]+c[v]|0}const h=[];for(const l of o)h.push(l>>24&255),h.push(l>>16&255),h.push(l>>8&255),h.push(l&255);return h}const un=[0,1,2,3,4,5,6,7,8,-1,-1,-1,-1,-1,-1,-1,9,10,11,12,13,14,15,16,-1,17,18,19,20,21,-1,22,23,24,25,26,27,28,29,30,31,32,-1,-1,-1,-1,-1,-1,33,34,35,36,37,38,39,40,41,42,43,-1,44,45,46,47,48,49,50,51,52,53,54,55,56,57];function Do(r,t){const e=r.charCodeAt(t)-49;if(e>=un.length||un[e]===-1)throw new En(`Unexpected character at position ${t}: ${r[t]}`);return un[e]}function Td(r){const t=[];let e=0;for(;e<r.length&&Do(r,e)===0;)e++;let i=e;for(;e<r.length;){let n=Do(r,e++),s=0;for(;n!==0||s<t.length;){const o=(t[s]||0)*58+n;t[s++]=o%256,n=Math.floor(o/256)}}for(;i-- >0;)t.push(0);return t.reverse()}function $a(r){const t=Td(r);if(t.length<4)throw new En(`Data is too short ${t.length}`);const e=t.slice(0,t.length-4),i=t.slice(t.length-4),n=Mo(Mo(e));if(i[0]!==n[0]||i[1]!==n[1]||i[2]!==n[2]||i[3]!==n[3])throw new En("Invalid checksum");return e}class Id extends Error{constructor(t){super(t),this.message=t,this.name="InvalidContractError"}}class Nd extends Error{constructor(t){super(t),this.message=t,this.name="InvalidTypeExpressionError"}}class xd extends Error{constructor(t){super(t),this.message=t,this.name="InvalidDataExpressionError"}}class Ld extends Error{constructor(t){super(`Contract has no entrypoint named: '${t}'`),this.entrypoint=t,this.name="InvalidEntrypointError"}}class Cd extends Error{constructor(t){super(t),this.message=t,this.name="LongIntegerError"}}class Md extends Error{constructor(t){super(`Unable to parse hex byte: ${t}`),this.hexByte=t,this.name="HexParseError"}}class Mt extends Error{constructor(t,e){super(e),this.val=t,Object.setPrototypeOf(this,Mt.prototype)}}class N extends Mt{constructor(t,e,i){super(t,i),e!==void 0&&(this.data=e),Object.setPrototypeOf(this,N.prototype)}}class Ua{constructor(t){if(this.neg=!1,this.buf=[],t!==void 0)if(typeof t=="string")for(let e=0;e<t.length;e++){const i=t.charCodeAt(e);if(e===0&&i===45)this.neg=!0;else{if(i<48||i>57)throw new Cd(`unexpected character in integer constant: ${t[e]}`);this.append(i-48)}}else t<0?(this.neg=!0,this.append(-t)):this.append(t)}append(t){let e=0;for(;t!==0||e<this.buf.length;){const i=(this.buf[e]||0)*10+t;this.buf[e++]=i%256,t=Math.floor(i/256)}}cmp(t){if(this.neg!==t.neg)return(t.neg?1:0)-(this.neg?1:0);{let e=0;if(this.buf.length!==t.buf.length)e=this.buf.length<t.buf.length?-1:1;else if(this.buf.length!==0){let i=t.buf.length-1;for(;i>=0&&this.buf[i]===t.buf[i];)i--;e=i<0?0:this.buf[i]<t.buf[i]?-1:1}return this.neg?e===0?0:-e:e}}get sign(){return this.buf.length===0?0:this.neg?-1:1}}function gr(r){const t=[];for(let e=0;e<r.length;e+=2){const i=parseInt(r.slice(e,e+2),16);if(Number.isNaN(i))return null;t.push(i)}return t}function vn(r){try{return new Ua(r),!0}catch{return!1}}function Va(r){try{return new Ua(r).sign>=0}catch{return!1}}const Dd=/^(@%|@%%|%@|[@:%]([_0-9a-zA-Z][_0-9a-zA-Z.%@]*)?)$/;function vr(r,t){if(Array.isArray(r))return{};let e,i,n;if(r.annots!==void 0){for(const s of r.annots)if(s.length!==0){if(!Dd.test(s)||!(t!=null&&t.specialVar)&&(s==="@%"||s==="@%%")||!(t!=null&&t.specialFields)&&s==="%@")throw new Mt(r,`${r.prim}: unexpected annotation: ${s}`);switch(s[0]){case"%":(t!=null&&t.emptyFields||s.length>1)&&(e=e||[],e.push(s));break;case":":s.length>1&&(i=i||[],i.push(s));break;case"@":(t!=null&&t.emptyVar||s.length>1)&&(n=n||[],n.push(s));break}}}return{f:e,t:i,v:n}}const kd={BlockHash:[32,[1,52]],OperationHash:[32,[5,116]],OperationListHash:[32,[133,233]],OperationListListHash:[32,[29,159,109]],ProtocolHash:[32,[2,170]],ContextHash:[32,[79,199]],ED25519PublicKeyHash:[20,[6,161,159]],SECP256K1PublicKeyHash:[20,[6,161,161]],P256PublicKeyHash:[20,[6,161,164]],ContractHash:[20,[2,90,121]],CryptoboxPublicKeyHash:[16,[153,103]],ED25519Seed:[32,[13,15,58,7]],ED25519PublicKey:[32,[13,15,37,217]],SECP256K1SecretKey:[32,[17,162,224,201]],P256SecretKey:[32,[16,81,238,189]],ED25519EncryptedSeed:[56,[7,90,60,179,41]],SECP256K1EncryptedSecretKey:[56,[9,237,241,174,150]],P256EncryptedSecretKey:[56,[9,48,57,115,171]],SECP256K1PublicKey:[33,[3,254,226,86]],P256PublicKey:[33,[3,178,139,127]],SECP256K1Scalar:[33,[38,248,136]],SECP256K1Element:[33,[5,92,0]],ED25519SecretKey:[64,[43,246,78,7]],ED25519Signature:[64,[9,245,205,134,18]],SECP256K1Signature:[64,[13,115,101,19,63]],P256Signature:[64,[54,240,44,52]],GenericSignature:[64,[4,130,43]],ChainID:[4,[87,82,0]],RollupAddress:[20,[1,128,120,31]],TxRollupL2Address:[20,[6,161,166]]};function we(r,...t){const e=$a(r);for(const i of t){const[n,s]=kd[i];if(e.length===n+s.length){let o=0;for(;o<s.length&&e[o]===s[o];)o++;if(o===s.length)return[i,e.slice(s.length)]}}return null}function It(r,t){const e=t,i=Array.isArray(e)?e:e.args;return i.length===2?r==="pair"?{prim:"pair",args:i}:{prim:"Pair",args:i}:Object.assign(Object.assign({},Array.isArray(e)?{prim:r}:e),{args:[i[0],{prim:r,args:i.slice(1)}]})}function Ae(r){return Array.isArray(r)||r.prim==="pair"}function Ka(r){return Array.isArray(r)||"prim"in r&&r.prim==="Pair"}const jd=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])[T ]([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):([0-5][0-9]))$/;function Ga(r){if("string"in r){if(Va(r.string))return new Date(parseInt(r.string,10));if(jd.test(r.string)){const t=new Date(r.string);if(!Number.isNaN(t.valueOf))return t}}else if(vn(r.int))return new Date(parseInt(r.int,10));return null}function Bd(r){const t=[];for(let e=0;e<r.length;e+=2){const i=r.slice(e,e+2),n=parseInt(i,16);if(Number.isNaN(n))throw new Md(i);t.push(n)}return t}function ar(r){return r.map(t=>(t>>4&15).toString(16)+(t&15).toString(16)).join("")}const Hd=31,Fa={ABS:!0,ADD:!0,ADDRESS:!0,AMOUNT:!0,AND:!0,APPLY:!0,BALANCE:!0,BLAKE2B:!0,CAR:!0,CDR:!0,CHAIN_ID:!0,CHECK_SIGNATURE:!0,COMPARE:!0,CONCAT:!0,CONS:!0,EDIV:!0,EQ:!0,EXEC:!0,FAILWITH:!0,GE:!0,GET_AND_UPDATE:!0,GT:!0,HASH_KEY:!0,IMPLICIT_ACCOUNT:!0,INT:!0,ISNAT:!0,JOIN_TICKETS:!0,KECCAK:!0,LE:!0,LEVEL:!0,LSL:!0,LSR:!0,LT:!0,MEM:!0,MUL:!0,NEG:!0,NEQ:!0,NEVER:!0,NOT:!0,NOW:!0,OR:!0,PACK:!0,PAIRING_CHECK:!0,READ_TICKET:!0,SAPLING_VERIFY_UPDATE:!0,SELF:!0,SELF_ADDRESS:!0,SENDER:!0,SET_DELEGATE:!0,SHA256:!0,SHA3:!0,SHA512:!0,SIZE:!0,SLICE:!0,SOME:!0,SOURCE:!0,SPLIT_TICKET:!0,SUB:!0,SWAP:!0,TICKET:!0,TICKET_DEPRECATED:!0,TOTAL_VOTING_POWER:!0,TRANSFER_TOKENS:!0,UNIT:!0,VOTING_POWER:!0,XOR:!0,RENAME:!0,OPEN_CHEST:!0,SUB_MUTEZ:!0,MIN_BLOCK_TIME:!0,BYTES:!0,NAT:!0},za=Object.assign({},Fa,{CONTRACT:!0,CREATE_CONTRACT:!0,DIG:!0,DIP:!0,DROP:!0,DUG:!0,DUP:!0,EMIT:!0,EMPTY_BIG_MAP:!0,EMPTY_MAP:!0,EMPTY_SET:!0,GET:!0,IF:!0,IF_CONS:!0,IF_LEFT:!0,IF_NONE:!0,ITER:!0,LAMBDA:!0,LAMBDA_REC:!0,LEFT:!0,LOOP:!0,LOOP_LEFT:!0,MAP:!0,NIL:!0,NONE:!0,PAIR:!0,PUSH:!0,RIGHT:!0,SAPLING_EMPTY_STATE:!0,UNPACK:!0,UNPAIR:!0,UPDATE:!0,CAST:!0,VIEW:!0}),qa={unit:!0,never:!0,bool:!0,int:!0,nat:!0,string:!0,chain_id:!0,bytes:!0,mutez:!0,key_hash:!0,key:!0,signature:!0,timestamp:!0,address:!0,tx_rollup_l2_address:!0},Pr=Object.assign({},qa,{or:!0,pair:!0,set:!0,big_map:!0,contract:!0,lambda:!0,list:!0,map:!0,operation:!0,option:!0,bls12_381_g1:!0,bls12_381_g2:!0,bls12_381_fr:!0,sapling_transaction:!0,sapling_transaction_deprecated:!0,sapling_state:!0,ticket:!0,chest_key:!0,chest:!0});class z extends Mt{constructor(t,e){super(t,e),this.val=t,Object.setPrototypeOf(this,z.prototype)}}function ue(r){return"prim"in r}function $d(r){return Array.isArray(r)||"prim"in r}function Wa(r){if(ue(r))return!0;throw new z(r,"prim expression expected")}function De(r){if(Array.isArray(r))return!0;throw new z(r,"sequence expression expected")}function mt(r){if($d(r))return!0;throw new z(r,"prim or sequence expression expected")}function ln(r){if(r.int[0]==="-")throw new z(r,"natural number expected")}function pi(r){if("int"in r)return!0;throw new z(r,"int literal expected")}function Ya(r){if("string"in r)return!0;throw new z(r,"string literal expected")}function K(r,t){var e;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new z(r,`${t} arguments expected`)}function Bt(r){var t,e;if(Array.isArray(r)){for(const i of r){if(!Array.isArray(i)&&!ue(i))throw new z(r,"sequence or prim expected");Bt(i)}return!0}if(Wa(r)){if(Object.prototype.hasOwnProperty.call(Fa,r.prim))return K(r,0),!0;switch(r.prim){case"DROP":case"PAIR":case"UNPAIR":case"DUP":case"UPDATE":case"GET":r.args!==void 0&&K(r,1)&&pi(r.args[0])&&ln(r.args[0]);break;case"DIG":case"DUG":case"SAPLING_EMPTY_STATE":K(r,1)&&pi(r.args[0])&&ln(r.args[0]);break;case"NONE":case"LEFT":case"RIGHT":case"NIL":case"CAST":K(r,1)&&Oe(r.args[0]);break;case"UNPACK":K(r,1)&&qn(r.args[0]);break;case"CONTRACT":K(r,1)&&Bi(r.args[0]);break;case"IF_NONE":case"IF_LEFT":case"IF_CONS":case"IF":K(r,2)&&(De(r.args[0])&&Bt(r.args[0]),De(r.args[1])&&Bt(r.args[1]));break;case"MAP":case"ITER":case"LOOP":case"LOOP_LEFT":K(r,1)&&Bt(r.args[0]);break;case"CREATE_CONTRACT":K(r,1)&&Za(r.args[0]);break;case"DIP":if(((t=r.args)===null||t===void 0?void 0:t.length)===2)pi(r.args[0])&&ln(r.args[0]),De(r.args[1])&&Bt(r.args[1]);else if(((e=r.args)===null||e===void 0?void 0:e.length)===1)De(r.args[0])&&Bt(r.args[0]);else throw new z(r,"1 or 2 arguments expected");break;case"PUSH":K(r,2)&&(_r(r.args[0]),Ze(r.args[1]));break;case"EMPTY_SET":K(r,1)&&Se(r.args[0]);break;case"EMPTY_MAP":K(r,2)&&(Se(r.args[0]),Oe(r.args[1]));break;case"EMPTY_BIG_MAP":K(r,2)&&(Se(r.args[0]),Hi(r.args[1]));break;case"LAMBDA_REC":case"LAMBDA":K(r,3)&&(Oe(r.args[0]),Oe(r.args[1]),De(r.args[2])&&Bt(r.args[2]));break;case"VIEW":K(r,2)&&(Ya(r.args[0])&&Ja(r.args[0]),Oe(r.args[1])&&_r(r.args[1]));break;case"EMIT":r.args&&r.args.length>0?K(r,1):K(r,0);break;default:throw new z(r,"instruction expected")}}return!0}function Se(r){if(mt(r)){if(Array.isArray(r)||r.prim==="pair"||r.prim==="or"||r.prim==="option")nr(r,t=>Se(t));else if(!Object.prototype.hasOwnProperty.call(qa,r.prim))throw new z(r,`${r.prim}: type is not comparable`)}return!0}function qn(r){if(mt(r)&&ue(r)){if(!Object.prototype.hasOwnProperty.call(Pr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket")throw new z(r,`${r.prim}: type can't be used inside PACK/UNPACK instructions`);nr(r,t=>qn(t))}return!0}function _r(r){if(mt(r)&&ue(r)){if(!Object.prototype.hasOwnProperty.call(Pr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket"||r.prim==="contract")throw new z(r,`${r.prim}: type can't be pushed`);nr(r,t=>_r(t))}return!0}function Wn(r){if(mt(r)&&ue(r)){if(!Object.prototype.hasOwnProperty.call(Pr,r.prim)||r.prim==="operation"||r.prim==="contract")throw new z(r,`${r.prim}: type can't be used as part of a storage`);nr(r,t=>Wn(t))}return!0}function Bi(r){if(mt(r)&&ue(r)){if(!Object.prototype.hasOwnProperty.call(Pr,r.prim)||r.prim==="operation")throw new z(r,`${r.prim}: type can't be used as part of a parameter`);nr(r,t=>Bi(t))}return!0}function Hi(r){if(mt(r)&&ue(r)){if(!Object.prototype.hasOwnProperty.call(Pr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state")throw new z(r,`${r.prim}: type can't be used inside a big_map`);nr(r,t=>Hi(t))}return!0}const Ud=new RegExp("^[a-zA-Z0-9_.%@]*$");function Ja(r){if(r.string.length>Hd)throw new z(r,`view name too long: ${r.string}`);if(!Ud.test(r.string))throw new z(r,`invalid character(s) in view name: ${r.string}`)}function Oe(r){if(mt(r)&&ue(r)){if(!Object.prototype.hasOwnProperty.call(Pr,r.prim))throw new z(r,"type expected");nr(r,t=>Oe(t))}return!0}function nr(r,t){if(Array.isArray(r)||r.prim==="pair"){const e=Array.isArray(r)?r:r.args;if(e===void 0||e.length<2)throw new z(r,"at least 2 arguments expected");return e.forEach(i=>{mt(i)&&t(i)}),!0}switch(r.prim){case"option":case"list":K(r,1)&&mt(r.args[0])&&t(r.args[0]);break;case"contract":K(r,1)&&Bi(r.args[0]);break;case"or":K(r,2)&&mt(r.args[0])&&mt(r.args[1])&&(t(r.args[0]),t(r.args[1]));break;case"lambda":K(r,2)&&(Oe(r.args[0]),Oe(r.args[1]));break;case"set":K(r,1)&&Se(r.args[0]);break;case"map":K(r,2)&&mt(r.args[0])&&mt(r.args[1])&&(Se(r.args[0]),t(r.args[1]));break;case"big_map":K(r,2)&&mt(r.args[0])&&mt(r.args[1])&&(Se(r.args[0]),Hi(r.args[1]),t(r.args[1]));break;case"ticket":K(r,1)&&mt(r.args[0])&&Se(r.args[0]);break;case"sapling_state":case"sapling_transaction":K(r,1)&&pi(r.args[0]);break;default:K(r,0)}return!0}function Ze(r){if("int"in r||"string"in r||"bytes"in r)return!0;if(Array.isArray(r)){let t=0;for(const e of r)ue(e)&&e.prim==="Elt"?(K(e,2)&&(Ze(e.args[0]),Ze(e.args[1])),t++):Ze(e);if(t!==0&&t!==r.length)throw new z(r,"data entries and map elements can't be intermixed");return!0}if(ue(r))switch(r.prim){case"Unit":case"True":case"False":case"None":K(r,0);break;case"Pair":if(r.args===void 0||r.args.length<2)throw new z(r,"at least 2 arguments expected");for(const t of r.args)Ze(t);break;case"Left":case"Right":case"Some":K(r,1)&&Ze(r.args[0]);break;case"Lambda_rec":r.args&&Bt(r.args);break;default:if(Object.prototype.hasOwnProperty.call(za,r.prim))Bt(r);else throw new z(r,"data entry or instruction expected")}else throw new z(r,"data entry expected");return!0}function Za(r){if(De(r)){const t={},e={};for(const i of r)if(Wa(i)){if(i.prim!=="view"){if(i.prim in t)throw new z(r,`duplicate contract section: ${i.prim}`);t[i.prim]=!0}switch(i.prim){case"code":K(i,1)&&De(i.args[0])&&Bt(i.args[0]);break;case"parameter":if(K(i,1)&&Bi(i.args[0]),i.annots)throw new z(i,"Annotation must be part of the parameter type");break;case"storage":K(i,1)&&Wn(i.args[0]);break;case"view":if(K(i,4)){if(Ya(i.args[0])){const n=i.args[0];if(n.string in e)throw new z(r,`duplicate view name: ${n.string}`);e[n.string]=!0,Ja(n)}_r(i.args[1]),_r(i.args[2]),De(i.args[3])&&Bt(i.args[3])}break;default:throw new z(r,`unexpected contract section: ${i.prim}`)}}}return!0}function Xa(r){return Object.prototype.hasOwnProperty.call(za,r.prim)}function _n(r){if(!Array.isArray(r))return!1;for(const t of r)if("prim"in t){if(Xa(t))throw new Mt(r,`Instruction outside of a lambda: ${JSON.stringify(r)}`);if(t.prim==="Elt")throw new Mt(r,`Elt item outside of a map literal: ${JSON.stringify(r)}`)}return!0}function Vd(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}const Kd=["parameter","storage","code","False","Elt","Left","None","Pair","Right","Some","True","Unit","PACK","UNPACK","BLAKE2B","SHA256","SHA512","ABS","ADD","AMOUNT","AND","BALANCE","CAR","CDR","CHECK_SIGNATURE","COMPARE","CONCAT","CONS","CREATE_ACCOUNT","CREATE_CONTRACT","IMPLICIT_ACCOUNT","DIP","DROP","DUP","EDIV","EMPTY_MAP","EMPTY_SET","EQ","EXEC","FAILWITH","GE","GET","GT","HASH_KEY","IF","IF_CONS","IF_LEFT","IF_NONE","INT","LAMBDA","LE","LEFT","LOOP","LSL","LSR","LT","MAP","MEM","MUL","NEG","NEQ","NIL","NONE","NOT","NOW","OR","PAIR","PUSH","RIGHT","SIZE","SOME","SOURCE","SENDER","SELF","STEPS_TO_QUOTA","SUB","SWAP","TRANSFER_TOKENS","SET_DELEGATE","UNIT","UPDATE","XOR","ITER","LOOP_LEFT","ADDRESS","CONTRACT","ISNAT","CAST","RENAME","bool","contract","int","key","key_hash","lambda","list","map","big_map","nat","option","or","pair","set","signature","string","bytes","mutez","timestamp","unit","operation","address","SLICE","DIG","DUG","EMPTY_BIG_MAP","APPLY","chain_id","CHAIN_ID","LEVEL","SELF_ADDRESS","never","NEVER","UNPAIR","VOTING_POWER","TOTAL_VOTING_POWER","KECCAK","SHA3","PAIRING_CHECK","bls12_381_g1","bls12_381_g2","bls12_381_fr","sapling_state","sapling_transaction_deprecated","SAPLING_EMPTY_STATE","SAPLING_VERIFY_UPDATE","ticket","TICKET_DEPRECATED","READ_TICKET","SPLIT_TICKET","JOIN_TICKETS","GET_AND_UPDATE","chest","chest_key","OPEN_CHEST","VIEW","view","constant","SUB_MUTEZ","tx_rollup_l2_address","MIN_BLOCK_TIME","sapling_transaction","EMIT","Lambda_rec","LAMBDA_REC","TICKET","BYTES","NAT"],Gd=Object.assign({},...Kd.map((r,t)=>({[r]:t})));var Ie;(function(r){r[r.Int=0]="Int",r[r.String=1]="String",r[r.Sequence=2]="Sequence",r[r.Prim0=3]="Prim0",r[r.Prim0Annot=4]="Prim0Annot",r[r.Prim1=5]="Prim1",r[r.Prim1Annot=6]="Prim1Annot",r[r.Prim2=7]="Prim2",r[r.Prim2Annot=8]="Prim2Annot",r[r.Prim=9]="Prim",r[r.Bytes=10]="Bytes"})(Ie||(Ie={}));class mr{constructor(){this.buffer=[]}get length(){return this.buffer.length}writeBytes(t){this.buffer.push(...t.map(e=>e&255))}writeUint8(t){const e=t|0;this.buffer.push(e&255)}writeUint16(t){const e=t|0;this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeUint32(t){const e=t|0;this.buffer.push(e>>24&255),this.buffer.push(e>>16&255),this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeInt8(t){this.writeUint8(t)}writeInt16(t){this.writeUint16(t)}writeInt32(t){this.writeUint32(t)}}const Te=new Error("bounds out of range");class wr{constructor(t,e=0,i=t.length){this.buffer=t,this.idx=e,this.cap=i}get length(){return this.cap-this.idx}readBytes(t){if(this.cap-this.idx<t)throw Te;const e=this.buffer.slice(this.idx,this.idx+t);return this.idx+=t,e}reader(t){if(this.cap-this.idx<t)throw Te;const e=new wr(this.buffer,this.idx,this.idx+t);return this.idx+=t,e}copy(){return new wr(this.buffer,this.idx,this.cap)}readUint8(){if(this.cap-this.idx<1)throw Te;return this.buffer[this.idx++]>>>0}readUint16(){if(this.cap-this.idx<2)throw Te;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)>>>0}readUint32(){if(this.cap-this.idx<4)throw Te;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],i=this.buffer[this.idx++],n=this.buffer[this.idx++];return(t<<24|e<<16|i<<8|n)>>>0}readInt8(){if(this.cap-this.idx<1)throw Te;return this.buffer[this.idx++]<<24>>24}readInt16(){if(this.cap-this.idx<2)throw Te;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)<<16>>16}readInt32(){if(this.cap-this.idx<4)throw Te;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],i=this.buffer[this.idx++],n=this.buffer[this.idx++];return t<<24|e<<16|i<<8|n}}var Ar;(function(r){r[r.Implicit=0]="Implicit",r[r.Originated=1]="Originated"})(Ar||(Ar={}));var je;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(je||(je={}));function Qa(r){let t;const e=r.readUint8();switch(e){case je.ED25519:t="ED25519PublicKeyHash";break;case je.SECP256K1:t="SECP256K1PublicKeyHash";break;case je.P256:t="P256PublicKeyHash";break;default:throw new Error(`unknown public key hash tag: ${e}`)}return{type:t,hash:r.readBytes(20)}}function Fd(r){let t;const e=r.readUint8();switch(e){case Ar.Implicit:t=Qa(r);break;case Ar.Originated:t={type:"ContractHash",hash:r.readBytes(20)},r.readBytes(1);break;default:throw new Error(`unknown address tag: ${e}`)}if(r.length!==0){const i=new TextDecoder;t.entryPoint=i.decode(new Uint8Array(r.readBytes(r.length)))}return t}function tc(r,t){let e;switch(r.type){case"ED25519PublicKeyHash":e=je.ED25519;break;case"SECP256K1PublicKeyHash":e=je.SECP256K1;break;case"P256PublicKeyHash":e=je.P256;break;default:throw new Error(`unexpected address type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.hash))}function zd(r,t){if(r.type==="ContractHash"?(t.writeUint8(Ar.Originated),t.writeBytes(Array.from(r.hash)),t.writeUint8(0)):(t.writeUint8(Ar.Implicit),tc(r,t)),r.entryPoint!==void 0&&r.entryPoint!==""&&r.entryPoint!=="default"){const i=new TextEncoder().encode(r.entryPoint);t.writeBytes(Array.from(i))}}var Be;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(Be||(Be={}));function qd(r){let t,e;const i=r.readUint8();switch(i){case Be.ED25519:e="ED25519PublicKey",t=32;break;case Be.SECP256K1:e="SECP256K1PublicKey",t=33;break;case Be.P256:e="P256PublicKey",t=33;break;default:throw new Error(`unknown public key tag: ${i}`)}return{type:e,publicKey:r.readBytes(t)}}function Wd(r,t){let e;switch(r.type){case"ED25519PublicKey":e=Be.ED25519;break;case"SECP256K1PublicKey":e=Be.SECP256K1;break;case"P256PublicKey":e=Be.P256;break;default:throw new Error(`unexpected public key type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.publicKey))}function fi(r,t,e){var i,n;const[s,o]=e(r);if(Array.isArray(s)){const h=new mr;for(const l of s){const d=o.next();if(d.done)throw new Error("REPORT ME: iterator is done");fi(l,h,d.value)}t.writeUint8(Ie.Sequence),t.writeUint32(h.length),t.writeBytes(h.buffer);return}if("string"in s){const l=new TextEncoder().encode(s.string);t.writeUint8(Ie.String),t.writeUint32(l.length),t.writeBytes(Array.from(l));return}if("int"in s){t.writeUint8(Ie.Int);let h=BigInt(s.int);const l=h<0;l&&(h=-h);let d=0;do{const y=BigInt(d===0?6:7);let v=h&(BigInt(1)<<y)-BigInt(1);h>>=y,h&&(v|=BigInt(128)),d===0&&l&&(v|=BigInt(64)),t.writeUint8(Number(v)),d++}while(h);return}if("bytes"in s){const h=Bd(s.bytes);t.writeUint8(Ie.Bytes),t.writeUint32(h.length),t.writeBytes(h);return}const a=Gd[s.prim];if(a===void 0)throw new TypeError(`Can't encode primary: ${s.prim}`);const c=(((i=s.args)===null||i===void 0?void 0:i.length)||0)<3?Ie.Prim0+(((n=s.args)===null||n===void 0?void 0:n.length)||0)*2+(s.annots===void 0||s.annots.length===0?0:1):Ie.Prim;if(t.writeUint8(c),t.writeUint8(a),s.args!==void 0)if(s.args.length<3)for(const h of s.args){const l=o.next();if(l.done)throw new Error("REPORT ME: iterator is done");fi(h,t,l.value)}else{const h=new mr;for(const l of s.args){const d=o.next();if(d.done)throw new Error("REPORT ME: iterator is done");fi(l,h,d.value)}t.writeUint32(h.length),t.writeBytes(h.buffer)}if(s.annots!==void 0&&s.annots.length!==0){const l=new TextEncoder().encode(s.annots.join(" "));t.writeUint32(l.length),t.writeBytes(Array.from(l))}else s.args!==void 0&&s.args.length>=3&&t.writeUint32(0)}const Yd=r=>"prim"in r&&(r.prim==="Left"||r.prim==="Right"),Jd=r=>"prim"in r&&(r.prim==="Some"||r.prim==="None"),Xe=r=>{if(Ae(r))return t=>{if(!Ka(t))throw new N(r,t,`pair expected: ${JSON.stringify(t)}`);_n(t);const e=It("pair",r);return[It("Pair",t),function*(){for(const n of e.args)yield Xe(n)}()]};switch(r.prim){case"or":return t=>{if(!Yd(t))throw new N(r,t,`or expected: ${JSON.stringify(t)}`);return[t,function*(){yield Xe(r.args[t.prim==="Left"?0:1])}()]};case"option":return t=>{if(!Jd(t))throw new N(r,t,`option expected: ${JSON.stringify(t)}`);return[t,function*(){t.prim==="Some"&&(yield Xe(r.args[0]))}()]};case"list":case"set":return t=>{if(!Array.isArray(t))throw new N(r,t,`${r.prim} expected: ${JSON.stringify(t)}`);return[t,function*(){for(const e of t)yield Xe(r.args[0])}()]};case"map":return t=>{if(!Array.isArray(t))throw new N(r,t,`map expected: ${JSON.stringify(t)}`);return[t,function*(){for(const e of t)yield i=>{if(!("prim"in i)||i.prim!=="Elt")throw new N(r,i,`map element expected: ${JSON.stringify(i)}`);return[i,function*(){for(const n of r.args)yield Xe(n)}()]}}()]};case"chain_id":return t=>{if(!("bytes"in t)&&!("string"in t))throw new N(r,t,`chain id expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=we(t.string,"ChainID");if(i===null)throw new N(r,t,`chain id base58 expected: ${t.string}`);e={bytes:ar(i[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"signature":return t=>{if(!("bytes"in t)&&!("string"in t))throw new N(r,t,`signature expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=we(t.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature");if(i===null)throw new N(r,t,`signature base58 expected: ${t.string}`);e={bytes:ar(i[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"key_hash":return t=>{if(!("bytes"in t)&&!("string"in t))throw new N(r,t,`key hash expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=we(t.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash");if(i===null)throw new N(r,t,`key hash base58 expected: ${t.string}`);const n=new mr;tc({type:i[0],hash:i[1]},n),e={bytes:ar(n.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"key":return t=>{if(!("bytes"in t)&&!("string"in t))throw new N(r,t,`public key expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=we(t.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey");if(i===null)throw new N(r,t,`public key base58 expected: ${t.string}`);const n=new mr;Wd({type:i[0],publicKey:i[1]},n),e={bytes:ar(n.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"address":return t=>{if(!("bytes"in t)&&!("string"in t))throw new N(r,t,`address expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=t.string.split("%"),n=we(i[0],"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash");if(n===null)throw new N(r,t,`address base58 expected: ${t.string}`);const s=new mr;zd({type:n[0],hash:n[1],entryPoint:i.length>1?i[1]:void 0},s),e={bytes:ar(s.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"timestamp":return t=>{if(!("string"in t)&&!("int"in t))throw new N(r,t,`timestamp expected: ${JSON.stringify(t)}`);let e;if("string"in t){const i=Ga(t);if(i===null)throw new N(r,t,`can't parse date: ${t.string}`);e={int:String(Math.floor(i.getTime()/1e3))}}else e=t;return[e,[][Symbol.iterator]()]};default:return Oi}},Zd=r=>"prim"in r&&r.prim==="PUSH",Oi=r=>Zd(r)?(Bt(r),[r,function*(){yield Oi,yield Xe(r.args[0])}()]):[r,function*(){for(;;)yield Oi}()];function Xd(r,t){const e=new mr;return e.writeUint8(5),fi(r,e,t!==void 0?Xe(t):Oi),e.buffer}function Qd(r,t){return{bytes:ar(Xd(r,t))}}function tp(r){const t=gr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new wr(new Uint8Array(t));return Fd(e)}function ep(r){const t=gr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new wr(new Uint8Array(t));return Qa(e)}function rp(r){const t=gr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new wr(new Uint8Array(t));return qd(e)}class j extends Mt{constructor(t,e,i){super(t,i),this.stackState=e,Object.setPrototypeOf(this,j.prototype)}}function q(r){return Array.isArray(r)?"pair":r.prim}function Ri(r){return"prim"in r?r.args:r}function $t(r,t,e=!1){if(q(r)!==q(t))throw new N(r,void 0,`types mismatch: ${q(r)} != ${q(t)}`);const i=[vr(r),vr(t)];if(i[0].t&&i[1].t&&i[0].t[0]!==i[1].t[0])throw new N(r,void 0,`${q(r)}: type names mismatch: ${i[0].t[0]} != ${i[1].t[0]}`);if(e&&i[0].f&&i[1].f&&i[0].f[0]!==i[1].f[0])throw new N(r,void 0,`${q(r)}: field names mismatch: ${i[0].f[0]} != ${i[1].f}`);if(Ae(r)){const n=It("pair",r),s=It("pair",t);$t(n.args[0],s.args[0],!0),$t(n.args[1],s.args[1],!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":case"ticket":$t(r.args[0],t.args[0]);break;case"or":$t(r.args[0],t.args[0],!0),$t(r.args[1],t.args[1],!0);break;case"lambda":case"map":case"big_map":$t(r.args[0],t.args[0]),$t(r.args[1],t.args[1]);break;case"sapling_state":case"sapling_transaction":if(parseInt(r.args[0].int,10)!==parseInt(t.args[0].int,10))throw new N(r,void 0,`${q(r)}: type argument mismatch: ${r.args[0].int} != ${t.args[0].int}`)}}function ec(r,t){if(r.length!==t.length)throw new N(r,void 0,`stack length mismatch: ${r.length} != ${t.length}`);for(let e=0;e<r.length;e++)$t(r[e],t[e])}function X(r,t=!1){var e,i,n;if(!Array.isArray(r)){const s=vr(r);if((((e=s.t)===null||e===void 0?void 0:e.length)||0)>1)throw new N(r,void 0,`${r.prim}: at most one type annotation allowed: ${r.annots}`);if(t){if((((i=s.f)===null||i===void 0?void 0:i.length)||0)>1)throw new N(r,void 0,`${r.prim}: at most one field annotation allowed: ${r.annots}`)}else if((((n=s.f)===null||n===void 0?void 0:n.length)||0)>0)throw new N(r,void 0,`${r.prim}: field annotations aren't allowed: ${r.annots}`)}if(Ae(r)){const s=Ri(r);for(const o of s)X(o,!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":X(r.args[0]);break;case"or":for(const s of r.args)X(s,!0);break;case"lambda":case"map":case"big_map":X(r.args[0]),X(r.args[1])}}function rc(r){if(!Array.isArray(r))return!1;for(const t of r)if(!(Array.isArray(t)&&rc(t)||"prim"in t&&Xa(t)))return!1;return!0}function Ht(r,t,e){if(Ae(t)){if(Ka(r)){_n(r);const i=It("Pair",r),n=It("pair",t);Ht(i.args[0],n.args[0],e),Ht(i.args[1],n.args[1],e);return}throw new N(t,r,`pair expected: ${JSON.stringify(r)}`)}switch(t.prim){case"int":if("int"in r&&vn(r.int))return;throw new N(t,r,`integer value expected: ${JSON.stringify(r)}`);case"nat":case"mutez":if("int"in r&&Va(r.int))return;throw new N(t,r,`natural value expected: ${JSON.stringify(r)}`);case"string":if("string"in r)return;throw new N(t,r,`string value expected: ${JSON.stringify(r)}`);case"bytes":case"bls12_381_g1":case"bls12_381_g2":if("bytes"in r&&gr(r.bytes)!==null)return;throw new N(t,r,`bytes value expected: ${JSON.stringify(r)}`);case"bool":if("prim"in r&&(r.prim==="True"||r.prim==="False"))return;throw new N(t,r,`boolean value expected: ${JSON.stringify(r)}`);case"key_hash":if("string"in r&&we(r.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash")!==null)return;if("bytes"in r)try{ep(r);return}catch{}throw new N(t,r,`key hash expected: ${JSON.stringify(r)}`);case"timestamp":if(("string"in r||"int"in r)&&Ga(r)!==null)return;throw new N(t,r,`timestamp expected: ${JSON.stringify(r)}`);case"address":if("string"in r){let i=r.string;const n=r.string.indexOf("%");if(n>=0&&(i=r.string.slice(0,n)),we(i,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash","TxRollupL2Address","RollupAddress")!==null)return}else if("bytes"in r)try{tp(r);return}catch{}throw new N(t,r,`address expected: ${JSON.stringify(r)}`);case"key":if("string"in r&&we(r.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey")!==null)return;if("bytes"in r)try{rp(r);return}catch{}throw new N(t,r,`public key expected: ${JSON.stringify(r)}`);case"unit":if("prim"in r&&r.prim==="Unit")return;throw new N(t,r,`unit value expected: ${JSON.stringify(r)}`);case"signature":if("bytes"in r||"string"in r&&we(r.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature")!==null)return;throw new N(t,r,`signature expected: ${JSON.stringify(r)}`);case"chain_id":if(("bytes"in r||"string"in r)&&("string"in r?$a(r.string):gr(r.bytes))!==null)return;throw new N(t,r,`chain id expected: ${JSON.stringify(r)}`);case"option":if("prim"in r){if(r.prim==="None")return;if(r.prim==="Some"){Ht(r.args[0],t.args[0],e);return}}throw new N(t,r,`option expected: ${JSON.stringify(r)}`);case"list":case"set":if(_n(r)){for(const i of r)Ht(i,t.args[0],e);return}throw new N(t,r,`${t.prim} expected: ${JSON.stringify(r)}`);case"or":if("prim"in r){if(r.prim==="Left"){Ht(r.args[0],t.args[0],e);return}else if(r.prim==="Right"){Ht(r.args[0],t.args[1],e);return}}throw new N(t,r,`union (or) expected: ${JSON.stringify(r)}`);case"lambda":if(rc(r)){const i=lt(r,[t.args[0]],e);if("failed"in i)throw new N(t,r,`function is failed with error type: ${i.failed}`);if(i.length!==1)throw new N(t,r,"function must return a value");$t(t.args[1],i[0]);return}throw new N(t,r,`function expected: ${JSON.stringify(r)}`);case"map":case"big_map":if(Array.isArray(r)){for(const i of r){if(!("prim"in i)||i.prim!=="Elt")throw new N(t,r,`map elements expected: ${JSON.stringify(r)}`);Ht(i.args[0],t.args[0],e),Ht(i.args[1],t.args[1],e)}return}throw new N(t,r,`${t.prim} expected: ${JSON.stringify(r)}`);case"bls12_381_fr":if("int"in r&&vn(r.int)||"bytes"in r&&gr(r.bytes)!==null)return;throw new N(t,r,`BLS12-381 element expected: ${JSON.stringify(r)}`);case"sapling_state":if(Array.isArray(r))return;throw new N(t,r,`sapling state expected: ${JSON.stringify(r)}`);case"ticket":Ht(r,{prim:"pair",args:[{prim:"address"},t.args[0],{prim:"nat"}]},e);return;default:throw new N(t,r,`type ${q(t)} don't have Michelson literal representation`)}}function ip(r,t,e){let i=t,n=t,s=0;for(const o of r){const a=lt(o,n,e);if(i=a,"failed"in a)break;n=a,s++}if("failed"in i&&i.level==0&&(!("prim"in i.failed)||i.failed.prim!=="never")&&s!==r.length-1)throw new j(r,i,"FAIL must appear in a tail position");if((e==null?void 0:e.traceCallback)!==void 0){const o={op:r,in:t,out:i};e.traceCallback(o)}return"failed"in i?{failed:i.failed,level:i.level+1}:i}function lt(r,t,e){const i=(e==null?void 0:e.protocol)||Ha;if(Array.isArray(r))return ip(r,t,e);const n=r;function s(g,...S){if(t.length<S.length+g)throw new j(n,t,`${n.prim}: stack must have at least ${S.length} element(s)`);let I=g;for(const $ of S){if($!==null&&$.length!==0){let B=0;for(;B<$.length&&$[B]!==q(t[I]);)B++;if(B===$.length)throw new j(n,t,`${n.prim}: stack type mismatch: [${I}] expected to be ${$}, got ${q(t[I])} instead`)}I++}return t.slice(g,S.length+g)}function o(g){return(...S)=>{try{return g(...S)}catch(I){throw I instanceof Mt?new j(n,t,I.message):I}}}function a(g){return S=>{try{return g(S)}catch(I){throw I instanceof Mt?new j(n,t,I.message):I}}}const c=o(vr),h=o(ec),l=o($t),d=a(Se),y=a(qn),v=a(Wn),k=a(_r),Y=a(Hi);function T(g,S){const I=c(n,Object.assign(Object.assign({},S),{emptyFields:g.f!==void 0&&g.f>1,emptyVar:g.v!==void 0&&g.v>1})),$=(B,pt,u)=>{if(B&&B.length>(pt||0))throw new j(n,t,`${n.prim}: at most ${pt||0} ${u} annotations allowed`)};return $(I.f,g.f,"field"),$(I.t,g.t,"type"),$(I.v,g.v,"variable"),I}function w(g,S){const I=g,$=Array.isArray(I)?{prim:"pair",args:I}:I,B=c($),pt=S.v!==void 0||S.t!==void 0||S.f!==void 0?[...(S.v===null?B.v:S.v)||[],...(S.t===null?B.t:S.t)||[],...(S.f===null?B.f:S.f)||[]]:void 0,u=Vd($,["annots"]);return Object.assign(Object.assign({},u),pt&&pt.length!==0&&{annots:pt})}function E(g,S){const I=T({v:1});return w(g,{v:I.v!==void 0?I.v:S!==void 0?[S]:null,t:null})}function ze(g,S,I,$,B){var pt,u,m,_;const R=(pt=c(S).f)===null||pt===void 0?void 0:pt[0],St=(u=I.f)===null||u===void 0?void 0:u[$];if(St!==void 0&&St!=="%"&&R!==void 0&&St!==R)throw new j(n,t,`${n.prim}: field names doesn't match: ${St} !== ${R}`);const Et=(m=I.v)===null||m===void 0?void 0:m[$],jt=(_=c(g).v)===null||_===void 0?void 0:_[0];return w(S,{t:null,v:Et?Et==="@%"?R?["@"+R.slice(1)]:void 0:Et==="@%%"?jt?["@"+jt.slice(1)+"."+(R?R.slice(1):B)]:R?["@"+R.slice(1)]:void 0:[Et]:null})}function O(g,S,I=S){const $=It("pair",g);if(I===1)return[$.args[0]];if(I===2)return $.args;const B=$.args[1];if(Ae(B))return[$.args[0],...O(B,S,I-1)];throw new j(n,t,`${n.prim}: at least ${S} fields are expected`)}function U(g,S,I=S){if(I===0)return g;const $=It("pair",g);if(I===1)return $.args[0];const B=$.args[1];if(Ae(B))return U(B,S,I-2);if(I===2)return B;throw new j(n,t,`${n.prim}: at least ${S+1} fields are expected`)}function qe(g,S,I,$=I){if($===0)return S;const B=It("pair",g);if($===1)return Object.assign(Object.assign({},B),{args:[S,B.args[1]]});const pt=B.args[1];if(Ae(pt))return Object.assign(Object.assign({},B),{args:[B.args[0],qe(pt,S,I,$-2)]});if($===2)return Object.assign(Object.assign({},B),{args:[B.args[0],S]});throw new j(n,t,`${n.prim}: at least ${I+1} fields are expected`)}const Rt=(g,S)=>["@"+(g.v?g.v[0].slice(1)+".":"")+S];function We(g,S){return"failed"in g||"failed"in S?"failed"in g?S:g:(h(g,S),g)}const Nr=(g=>{var S,I,$,B,pt;switch(g.prim){case"DUP":{const u=g.args?parseInt(g.args[0].int,10):1;if(u===0)throw new j(g,t,"DUP 0 is forbidden");const m=s(u-1,null)[0];if(q(m)==="ticket")throw new j(g,t,"ticket can't be DUPed");return[m,...t]}case"SWAP":{const u=s(0,null,null);return T({}),[u[1],u[0],...t.slice(2)]}case"SOME":return[w({prim:"option",args:[s(0,null)[0]]},T({t:1,v:1})),...t.slice(1)];case"UNIT":return[w({prim:"unit"},T({v:1,t:1})),...t];case"PAIR":{const u=g.args?parseInt(g.args[0].int,10):2;if(u<2)throw new j(g,t,`PAIR ${u} is forbidden`);const m=s(0,...new Array(u).fill(null)),_=T({f:u,t:1,v:1},{specialFields:!0}),R=Et=>{const jt=Et.lastIndexOf(".");return Et.slice(jt>0?jt+1:1)},St=m.map((Et,jt)=>{var Vi;const Os=c(Et),Cc=_.f&&_.f.length>jt&&_.f[jt]!=="%"?_.f[jt]==="%@"?Os.v?["%"+R(((Vi=Os.v)===null||Vi===void 0?void 0:Vi[0])||"")]:void 0:[_.f[jt]]:void 0;return w(Et,{v:null,t:null,f:Cc})});return[w({prim:"pair",args:St},{t:_.t,v:_.v}),...t.slice(u)]}case"UNPAIR":{const u=g.args?parseInt(g.args[0].int,10):2;if(u<2)throw new j(g,t,`UNPAIR ${u} is forbidden`);const m=s(0,["pair"])[0],_=T({f:2,v:2},{specialVar:!0});return[...O(m,u).map((St,Et)=>ze(m,St,_,Et,Et===0?"car":"cdr")),...t.slice(1)]}case"CAR":case"CDR":{const u=It("pair",s(0,["pair"])[0]),m=u.args[g.prim==="CAR"?0:1],_=T({f:1,v:1},{specialVar:!0});return[ze(u,m,_,0,g.prim.toLocaleLowerCase()),...t.slice(1)]}case"CONS":{const u=s(0,null,["list"]);return l(u[0],u[1].args[0]),[E({prim:"list",args:[u[1].args[0]]}),...t.slice(2)]}case"SIZE":return s(0,["string","list","set","map","bytes"]),[E({prim:"nat"}),...t.slice(1)];case"MEM":{const u=s(0,null,["set","map","big_map"]);return d(u[0]),l(u[0],u[1].args[0]),[E({prim:"bool"}),...t.slice(2)]}case"GET":if(g.args){const u=parseInt(g.args[0].int,10),m=s(0,["pair"])[0];return[E(U(m,u)),...t.slice(1)]}else{const u=s(0,null,["map","big_map"]);return d(u[0]),l(u[0],u[1].args[0]),[E({prim:"option",args:[u[1].args[1]]}),...t.slice(2)]}case"UPDATE":if(g.args){const u=parseInt(g.args[0].int,10),m=s(0,null,["pair"]);return[E(qe(m[1],m[0],u)),...t.slice(2)]}else{const u=s(0,null,["bool","option"]);if(d(u[0]),u[1].prim==="bool"){const _=s(2,["set"]);return l(u[0],_[0].args[0]),[E({prim:"set",args:[w(u[0],{t:null})]}),...t.slice(3)]}const m=s(2,["map","big_map"]);return l(u[0],m[0].args[0]),m[0].prim==="map"?[E({prim:"map",args:[w(u[0],{t:null}),w(u[1].args[0],{t:null})]}),...t.slice(3)]:(Y(u[1].args[0]),[E({prim:"big_map",args:[w(u[0],{t:null}),w(u[1].args[0],{t:null})]}),...t.slice(3)])}case"GET_AND_UPDATE":{const u=T({v:2}),m=s(0,null,["option"],["map","big_map"]);d(m[0]),l(m[0],m[2].args[0]),l(m[1].args[0],m[2].args[1]);const _=(S=u.v)===null||S===void 0?void 0:S.map(R=>R!=="@"?[R]:void 0);return m[2].prim==="map"?[w({prim:"option",args:[m[2].args[1]]},{v:_==null?void 0:_[0]}),w({prim:"map",args:[w(m[0],{t:null}),w(m[1].args[0],{t:null})]},{v:_==null?void 0:_[1]}),...t.slice(3)]:(Y(m[1].args[0]),[w({prim:"option",args:[m[2].args[1]]},{v:_==null?void 0:_[0]}),w({prim:"big_map",args:[w(m[0],{t:null}),w(m[1].args[0],{t:null})]},{v:_==null?void 0:_[1]}),...t.slice(3)])}case"EXEC":{const u=s(0,null,["lambda"]);return l(u[0],u[1].args[0]),[E(u[1].args[1]),...t.slice(2)]}case"APPLY":{const u=s(0,null,["lambda"]);if(v(u[0]),k(u[0]),!Ae(u[1].args[0]))throw new j(g,t,`${g.prim}: function's argument must be a pair: ${q(u[1].args[0])}`);const m=u[1].args[0];return l(u[0],Ri(m)[0]),[E({prim:"lambda",args:[Ri(m)[1],u[1].args[1]]}),...t.slice(2)]}case"FAILWITH":{const u=s(0,null)[0];return lr(i,Re.PtEdo2Zk)||y(u),{failed:u,level:0}}case"NEVER":return s(0,["never"]),{failed:{prim:"never"},level:0};case"RENAME":return[E(s(0,null)[0]),...t.slice(1)];case"CONCAT":{const u=s(0,["string","list","bytes"]);if(u[0].prim==="list"){if(q(u[0].args[0])!=="string"&&q(u[0].args[0])!=="bytes")throw new j(g,t,`${g.prim}: can't concatenate list of ${q(u[0].args[0])}'s`);return[E(u[0].args[0]),...t.slice(1)]}const m=s(1,["string","bytes"]);if(u[0].prim!==m[0].prim)throw new j(g,t,`${g.prim}: can't concatenate ${u[0].prim} with ${m[0].prim}`);return[E(m[0]),...t.slice(2)]}case"SLICE":return[E({prim:"option",args:[s(0,["nat"],["nat"],["string","bytes"])[2]]},"@slice"),...t.slice(3)];case"PACK":{const u=s(0,null)[0];return y(u),[E({prim:"bytes"},"@packed"),...t.slice(1)]}case"ADD":{const u=s(0,["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(u[0].prim==="nat"&&u[1].prim==="int"||u[0].prim==="int"&&u[1].prim==="nat")return[E({prim:"int"}),...t.slice(2)];if(u[0].prim==="int"&&u[1].prim==="timestamp"||u[0].prim==="timestamp"&&u[1].prim==="int")return[E({prim:"timestamp"}),...t.slice(2)];if((u[0].prim==="int"||u[0].prim==="nat"||u[0].prim==="mutez"||u[0].prim==="bls12_381_g1"||u[0].prim==="bls12_381_g2"||u[0].prim==="bls12_381_fr")&&u[0].prim===u[1].prim)return[E(u[0]),...t.slice(2)];throw new j(g,t,`${g.prim}: can't add ${u[0].prim} to ${u[1].prim}`)}case"SUB":{const u=lr(i,Re.PsiThaCa)?s(0,["nat","int","timestamp","mutez"],["nat","int","timestamp","mutez"]):s(0,["nat","int","timestamp"],["nat","int","timestamp"]);if((u[0].prim==="nat"||u[0].prim==="int")&&(u[1].prim==="nat"||u[1].prim==="int")||u[0].prim==="timestamp"&&u[1].prim==="timestamp")return[E({prim:"int"}),...t.slice(2)];if(u[0].prim==="timestamp"&&u[1].prim==="int")return[E({prim:"timestamp"}),...t.slice(2)];if(u[0].prim==="mutez"&&u[1].prim==="mutez")return[E({prim:"mutez"}),...t.slice(2)];throw new j(g,t,`${g.prim}: can't subtract ${u[0].prim} from ${u[1].prim}`)}case"SUB_MUTEZ":return s(0,["mutez"],["mutez"]),[E({prim:"option",args:[{prim:"mutez"}]}),...t.slice(2)];case"MUL":{const u=s(0,["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(u[0].prim==="nat"&&u[1].prim==="int"||u[0].prim==="int"&&u[1].prim==="nat")return[E({prim:"int"}),...t.slice(2)];if(u[0].prim==="nat"&&u[1].prim==="mutez"||u[0].prim==="mutez"&&u[1].prim==="nat")return[E({prim:"mutez"}),...t.slice(2)];if((u[0].prim==="bls12_381_g1"||u[0].prim==="bls12_381_g2"||u[0].prim==="bls12_381_fr")&&u[1].prim==="bls12_381_fr"||(u[0].prim==="nat"||u[0].prim==="int")&&u[0].prim===u[1].prim)return[E(u[0]),...t.slice(2)];if((u[0].prim==="nat"||u[0].prim==="int")&&u[1].prim==="bls12_381_fr"||(u[1].prim==="nat"||u[1].prim==="int")&&u[0].prim==="bls12_381_fr")return[E({prim:"bls12_381_fr"}),...t.slice(2)];throw new j(g,t,`${g.prim}: can't multiply ${u[0].prim} by ${u[1].prim}`)}case"EDIV":{const u=(_,R)=>({prim:"option",args:[{prim:"pair",args:[{prim:_},{prim:R}]}]}),m=s(0,["nat","int","mutez"],["nat","int","mutez"]);if(m[0].prim==="nat"&&m[1].prim==="nat")return[E(u("nat","nat")),...t.slice(2)];if((m[0].prim==="nat"||m[0].prim==="int")&&(m[1].prim==="nat"||m[1].prim==="int"))return[E(u("int","nat")),...t.slice(2)];if(m[0].prim==="mutez"&&m[1].prim==="nat")return[E(u("mutez","mutez")),...t.slice(2)];if(m[0].prim==="mutez"&&m[1].prim==="mutez")return[E(u("nat","mutez")),...t.slice(2)];throw new j(g,t,`${g.prim}: can't euclideally divide ${m[0].prim} by ${m[1].prim}`)}case"ABS":return s(0,["int"]),[E({prim:"nat"}),...t.slice(1)];case"ISNAT":return s(0,["int"]),[E({prim:"option",args:[{prim:"nat"}]}),...t.slice(1)];case"INT":return s(0,["nat","bls12_381_fr","bytes"]),[E({prim:"int"}),...t.slice(1)];case"BYTES":return s(0,["nat","int"]),[E({prim:"bytes"}),...t.slice(1)];case"NAT":return s(0,["bytes"]),[E({prim:"nat"}),...t.slice(1)];case"NEG":{const u=s(0,["nat","int","bls12_381_g1","bls12_381_g2","bls12_381_fr"])[0];return u.prim==="nat"||u.prim==="int"?[E({prim:"int"}),...t.slice(1)]:[E(u),...t.slice(1)]}case"LSL":case"LSR":return s(0,["nat","bytes"],["nat","bytes"]),[E({prim:"nat"}),...t.slice(2)];case"OR":case"XOR":{const u=s(0,["nat","bytes","bool"],["nat","bytes","bool"]);if(u[0].prim!==u[1].prim)throw new j(g,t,`${g.prim}: both arguments must be of the same type: ${u[0].prim}, ${u[1].prim}`);return[E(u[1]),...t.slice(2)]}case"AND":{const u=s(0,["nat","bytes","bool","int"],["nat","bytes","bool"]);if((u[0].prim!=="int"||u[1].prim!=="nat")&&u[0].prim!==u[1].prim)throw new j(g,t,`${g.prim}: both arguments must be of the same type: ${u[0].prim}, ${u[1].prim}`);return[E(u[1]),...t.slice(2)]}case"NOT":return s(0,["nat","bytes","bool","int"])[0].prim==="bool"?[E({prim:"bool"}),...t.slice(1)]:[E({prim:"int"}),...t.slice(1)];case"COMPARE":{const u=s(0,null,null);return d(u[0]),d(u[1]),[E({prim:"int"}),...t.slice(2)]}case"EQ":case"NEQ":case"LT":case"GT":case"LE":case"GE":return s(0,["int"]),[E({prim:"bool"}),...t.slice(1)];case"SELF":{if((e==null?void 0:e.contract)===void 0)throw new j(g,t,`${g.prim}: contract required`);const u=T({f:1,v:1}),m=wn(e.contract,(I=u.f)===null||I===void 0?void 0:I[0]);if(m===null)throw new j(g,t,`${g.prim}: contract has no entrypoint ${m}`);return[w({prim:"contract",args:[m]},{v:u.v?u.v:["@self"]}),...t]}case"TRANSFER_TOKENS":{const u=s(0,null,["mutez"],["contract"]);return l(u[0],u[2].args[0]),[E({prim:"operation"}),...t.slice(3)]}case"SET_DELEGATE":{const u=s(0,["option"])[0];if(q(u.args[0])!=="key_hash")throw new j(g,t,`${g.prim}: key hash expected: ${q(u.args[0])}`);return[E({prim:"operation"}),...t.slice(1)]}case"IMPLICIT_ACCOUNT":return s(0,["key_hash"]),[E({prim:"contract",args:[{prim:"unit"}]}),...t.slice(1)];case"NOW":return[E({prim:"timestamp"},"@now"),...t];case"AMOUNT":return[E({prim:"mutez"},"@amount"),...t];case"BALANCE":return[E({prim:"mutez"},"@balance"),...t];case"CHECK_SIGNATURE":return s(0,["key"],["signature"],["bytes"]),[E({prim:"bool"}),...t.slice(3)];case"BLAKE2B":case"SHA256":case"SHA512":case"KECCAK":case"SHA3":return s(0,["bytes"]),[E({prim:"bytes"}),...t.slice(1)];case"HASH_KEY":return s(0,["key"]),[E({prim:"key_hash"}),...t.slice(1)];case"SOURCE":return[E({prim:"address"},"@source"),...t];case"SENDER":return[E({prim:"address"},"@sender"),...t];case"ADDRESS":{const u=s(0,["contract"])[0],m=T({v:1});return[w({prim:"address",[ii]:u},{v:m.v?m.v:Rt(c(u),"address")}),...t.slice(1)]}case"SELF_ADDRESS":{const u={prim:"address"};return(e==null?void 0:e.contract)!==void 0&&(u[ii]={prim:"contract",args:[ae(e.contract,"parameter").args[0]]}),[E(u,"@address"),...t]}case"CHAIN_ID":return[E({prim:"chain_id"}),...t];case"DROP":{T({});const u=g.args!==void 0?parseInt(g.args[0].int,10):1;return s(u-1,null),t.slice(u)}case"DIG":{T({});const u=parseInt(g.args[0].int,10);return[s(u,null)[0],...t.slice(0,u),...t.slice(u+1)]}case"DUG":{T({});const u=parseInt(g.args[0].int,10);return[...t.slice(1,u+1),s(0,null)[0],...t.slice(u+1)]}case"NONE":return X(g.args[0]),[w({prim:"option",args:[g.args[0]]},T({t:1,v:1})),...t];case"LEFT":case"RIGHT":{const u=s(0,null)[0],m=T({f:2,t:1,v:1},{specialFields:!0}),_=c(u),R=[w(u,{t:null,v:null,f:m.f&&m.f.length>0&&m.f[0]!=="%"?m.f[0]==="%@"?_.v?["%"+_.v[0].slice(1)]:void 0:m.f:void 0}),w(g.args[0],{t:null,f:m.f&&m.f.length>1&&m.f[1]!=="%"?m.f:void 0})];return[w({prim:"or",args:g.prim==="LEFT"?R:[R[1],R[0]]},{t:m.t,v:m.v}),...t.slice(1)]}case"NIL":return X(g.args[0]),[w({prim:"list",args:[g.args[0]]},T({t:1,v:1})),...t];case"UNPACK":return s(0,["bytes"]),X(g.args[0]),[E({prim:"option",args:[g.args[0]]},"@unpacked"),...t.slice(1)];case"CONTRACT":{const u=s(0,["address"])[0];X(g.args[0]);const m=T({v:1,f:1}),_=u[ii];if(_!==void 0){const R=wn(_,($=m.f)===null||$===void 0?void 0:$[0]);if(R===null)throw new j(g,t,`${g.prim}: contract has no entrypoint ${R}`);l(R,g.args[0])}return[w({prim:"option",args:[{prim:"contract",args:[g.args[0]]}]},{v:m.v?m.v:Rt(c(u),"contract")}),...t.slice(1)]}case"CAST":{T({});const u=s(0,null)[0];return X(g.args[0]),l(g.args[0],u),[g.args[0],...t.slice(1)]}case"IF_NONE":{T({});const u=s(0,["option"])[0],m=t.slice(1),_=lt(g.args[0],m,e),R=lt(g.args[1],[w(u.args[0],{t:null,v:Rt(c(u),"some")}),...m],e);return We(_,R)}case"IF_LEFT":{T({});const u=s(0,["or"])[0],m=c(u),_=c(u.args[0]),R=c(u.args[1]),St=t.slice(1),Et=lt(g.args[0],[w(u.args[0],{t:null,v:Rt(m,_.f?_.f[0].slice(1):"left")}),...St],e),jt=lt(g.args[1],[w(u.args[1],{t:null,v:Rt(m,R.f?R.f[0].slice(1):"right")}),...St],e);return We(Et,jt)}case"IF_CONS":{T({});const u=s(0,["list"])[0],m=c(u),_=t.slice(1),R=lt(g.args[0],[w(u.args[0],{t:null,v:Rt(m,"hd")}),w(u,{t:null,v:Rt(m,"tl")}),..._],e),St=lt(g.args[1],_,e);return We(R,St)}case"IF":{T({}),s(0,["bool"]);const u=t.slice(1),m=lt(g.args[0],u,e),_=lt(g.args[1],u,e);return We(m,_)}case"MAP":{const u=s(0,["list","map","option"])[0],m=t.slice(1),_=u.prim==="map"?{prim:"pair",args:u.args}:u.args[0],R=lt(g.args[0],[w(_,{t:null,v:Rt(c(u),"elt")}),...m],e);if("failed"in R){if(!("prim"in R.failed)||R.failed.prim!=="never")throw new j(g,t,`${g.prim}: FAIL is not allowed in MAP`);return{failed:R.failed,level:R.level+1}}if(R.length<1)throw new j(g,t,`${g.prim}: function must return a value`);return h(R.slice(1),m),u.prim==="list"?[E({prim:"list",args:[R[0]]}),...m]:u.prim==="map"?[E({prim:"map",args:[u.args[0],R[0]]}),...m]:[E({prim:"option",args:[R[0]]}),...m]}case"ITER":{T({});const u=s(0,["set","list","map"])[0],m=t.slice(1),_=u.prim==="map"?{prim:"pair",args:u.args}:u.args[0],R=lt(g.args[0],[w(_,{t:null,v:Rt(c(u),"elt")}),...m],e);return"failed"in R?{failed:R.failed,level:R.level+1}:(h(R,m),m)}case"LOOP":{T({}),s(0,["bool"]);const u=t.slice(1),m=lt(g.args[0],u,e);return"failed"in m?{failed:m.failed,level:m.level+1}:(h(m,[{prim:"bool"},...u]),u)}case"LOOP_LEFT":{T({});const u=s(0,["or"])[0],m=t.slice(1),_=lt(g.args[0],[w(u.args[0],{t:null,v:Rt(c(u),"left")}),...m],e);return"failed"in _?{failed:_.failed,level:_.level+1}:(h(_,[u,...m]),[w(u.args[1],{t:null,v:T({v:1}).v}),...m])}case"DIP":{T({});const u=g.args.length===2?parseInt(g.args[0].int,10):1;s(u-1,null);const m=t.slice(0,u),_=t.slice(u),R=g.args.length===2?lt(g.args[1],_,e):lt(g.args[0],_,e);return"failed"in R?{failed:R.failed,level:R.level+1}:[...m,...R]}case"CREATE_CONTRACT":{const u=T({v:2}),m=s(0,["option"],["mutez"],null);if(q(m[0].args[0])!=="key_hash")throw new j(g,t,`${g.prim}: key hash expected: ${q(m[0].args[0])}`);v(m[2])&&(nc(g.args[0]),$t(ae(g.args[0],"storage").args[0],m[2]));const _=(B=u.v)===null||B===void 0?void 0:B.map(R=>R!=="@"?[R]:void 0);return[w({prim:"operation"},{v:_==null?void 0:_[0]}),w({prim:"address",[ii]:{prim:"contract",args:[ae(g.args[0],"parameter").args[0]]}},{v:_==null?void 0:_[1]}),...t.slice(3)]}case"PUSH":return X(g.args[0]),Ht(g.args[1],g.args[0],Object.assign(Object.assign({},e),{contract:void 0})),[E(g.args[0]),...t];case"EMPTY_SET":return X(g.args[0]),d(g.args[0]),[w({prim:"set",args:g.args},T({t:1,v:1})),...t];case"EMPTY_MAP":return X(g.args[0]),d(g.args[0]),X(g.args[1]),[w({prim:"map",args:g.args},T({t:1,v:1})),...t];case"EMPTY_BIG_MAP":return X(g.args[0]),d(g.args[0]),X(g.args[1]),Y(g.args[0]),[w({prim:"big_map",args:g.args},T({t:1,v:1})),...t];case"LAMBDA_REC":case"LAMBDA":{X(g.args[0]),X(g.args[1]);const u=[g.args[0]];g.prim==="LAMBDA_REC"&&u.push({prim:"lambda",args:[g.args[0],g.args[1]]});const m=lt(g.args[2],u,Object.assign(Object.assign({},e),{contract:void 0}));if("failed"in m)return{failed:m.failed,level:m.level+1};if(m.length!==1)throw new j(g,t,`${g.prim}: function must return a value`);return l(g.args[1],m[0]),[E({prim:"lambda",args:[g.args[0],g.args[1]]}),...t]}case"LEVEL":return[E({prim:"nat"},"@level"),...t];case"TOTAL_VOTING_POWER":return[E({prim:"nat"}),...t];case"VOTING_POWER":return s(0,["key_hash"]),[E({prim:"nat"}),...t.slice(1)];case"TICKET":{const u=s(0,null,["nat"])[0];return d(u),lr(i,Re.PtLimaPtL)?[w({prim:"ticket",args:[u]},T({t:1,v:1})),...t.slice(2)]:[E({prim:"option",args:[w({prim:"ticket",args:[u]},T({t:1,v:1}))]}),...t.slice(2)]}case"JOIN_TICKETS":{const u=It("pair",s(0,["pair"])[0]);if(q(u.args[0])!=="ticket")throw new j(g,t,`${g.prim}: ticket expected: ${q(u.args[0])}`);return l(u.args[0],u.args[1]),[E({prim:"option",args:[w(u.args[0],{t:null})]}),...t.slice(1)]}case"SPLIT_TICKET":{const u=s(0,["ticket"],["pair"]),m=It("pair",u[1]);if(q(m.args[0])!=="nat")throw new j(g,t,`${g.prim}: nat expected: ${q(m.args[0])}`);return l(m.args[0],m.args[1]),[E({prim:"option",args:[{prim:"pair",args:[w(u[0],{t:null}),w(u[0],{t:null})]}]}),...t.slice(2)]}case"READ_TICKET":{const u=T({v:2}),m=s(0,["ticket"])[0],_=(pt=u.v)===null||pt===void 0?void 0:pt.map(R=>R!=="@"?[R]:void 0);return[w({prim:"pair",args:[{prim:"address"},w(m.args[0],{t:null}),{prim:"nat"}]},{v:_==null?void 0:_[0]}),w(m,{v:_==null?void 0:_[1],t:null}),...t.slice(1)]}case"PAIRING_CHECK":{const u=s(0,["list"])[0].args[0];if(!Ae(u))throw new j(g,t,`${g.prim}: pair expected: ${q(u)}`);const m=It("pair",u);if(q(m.args[0])!=="bls12_381_g1")throw new j(g,t,`${g.prim}: bls12_381_g1 expected: ${q(m.args[0])}`);if(q(m.args[1])!=="bls12_381_g2")throw new j(g,t,`${g.prim}: bls12_381_g2 expected: ${q(m.args[1])}`);return[E({prim:"bool"}),...t.slice(1)]}case"SAPLING_EMPTY_STATE":return[w({prim:"sapling_state",args:[g.args[0]]},T({v:1,t:1})),...t];case"SAPLING_VERIFY_UPDATE":{const u=s(0,["sapling_transaction"],["sapling_state"]);if(parseInt(u[0].args[0].int,10)!==parseInt(u[1].args[0].int,10))throw new j(g,t,`${g.prim}: sapling memo size mismatch: ${u[0].args[0].int} != ${u[1].args[0].int}`);return lr(i,Re.PtJakarta)?[E({prim:"option",args:[{prim:"pair",args:[{prim:"int"},w(u[1],{t:null})]}]}),...t.slice(2)]:[E({prim:"option",args:[{prim:"pair",args:[{prim:"bytes"},{prim:"pair",args:[{prim:"int"},w(u[1],{t:null})]}]}]}),...t.slice(2)]}case"OPEN_CHEST":return s(0,["chest_key"],["chest"],["nat"]),[E({prim:"or",args:[{prim:"bytes"},{prim:"bool"}]}),...t.slice(3)];case"VIEW":{const u=s(0,null,["address"]);return k(u[0]),[E({prim:"option",args:[g.args[1]]}),...t.slice(2)]}case"MIN_BLOCK_TIME":return[E({prim:"nat"}),...t];case"EMIT":{const u=T({f:1,t:1});if(g.args){const m=s(0,null);return l(m[0],g.args[0]),[w({prim:"operation"},u),...t.slice(1)]}return[w({prim:"operation"},u),...t.slice(1)]}default:throw new Mt(g,`unexpected instruction: ${g.prim}`)}})(n);if((e==null?void 0:e.traceCallback)!==void 0){const g={op:n,in:t,out:Nr};e.traceCallback(g)}return Nr}function ae(r,t){for(const e of r)if(e.prim===t)return e;throw new Mt(r,`missing contract section: ${t}`)}function np(r){const t={};for(const e of r)e.prim==="view"&&(t[e.args[0].string]=e);return t}function ic(r){if(Array.isArray(r)){for(const t of r)if("prim"in t&&(t.prim==="parameter"||t.prim==="storage"||t.prim==="code"))return!0}return!1}function wn(r,t){t=t||"%default";const e=Si(r).find(i=>i[0]===t);return e!==void 0?e[1]:t==="%default"?ic(r)?ae(r,"parameter").args[0]:r:null}function sp(r){return Array.isArray(r)||r.prim==="or"}function Si(r){if(ic(r)){const t=ae(r,"parameter"),e=Si(t.args[0]),i=vr(t);return i.f?[[i.f[0],t.args[0]],...e]:e}if(sp(r)){const t=Ri(r),e=i=>{const n=vr(t[i]);if(q(t[i])==="or"){const s=Si(t[i]);return n.f?[[n.f[0],t[i]],...s]:s}return n.f?[[n.f[0],t[i]]]:[]};return[...e(0),...e(1)]}return[]}function nc(r,t){const e=(c,h,l,d)=>{X(c,!0),X(h);const y={prim:"pair",args:[Object.assign(Object.assign({},c),{annots:["@parameter"]}),Object.assign(Object.assign({},h),{annots:["@storage"]})]},v=lt(d,[y],Object.assign(Object.assign({},t),{contract:r}));if("failed"in v)return v;try{ec(v,[l])}catch(k){throw k instanceof Mt?new j(d,v,k.message):k}return v},i=ae(r,"parameter").args[0],n=ae(r,"storage").args[0],s=ae(r,"code").args[0],a=e(i,n,{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},n]},s);for(const c of Object.values(np(r)))e(c.args[1],n,c.args[2],c.args[3]);return a}function sc(r,t,e){X(t),Ht(r,t,e||null)}function op(r,t,e){for(const i of t)X(i);if((e==null?void 0:e.contract)!==void 0)for(const i of["parameter","storage"]){const n=ae(e.contract,i).args[0];X(n)}return lt(r,t,e||null)}function ap(r,t,e){try{return sc(r,t,e),!0}catch{return!1}}class Yn{constructor(t,e){this.contract=t,this.ctx=Object.assign({contract:t},e),this.output=nc(t,this.ctx)}static parse(t,e){const i=new Qe(e),n=typeof t=="string"?i.parseScript(t):i.parseJSON(t);if(n===null)throw new Id("empty contract");if(Za(n))return new Yn(n,e)}static parseTypeExpression(t,e){const i=new Qe(e),n=typeof t=="string"?i.parseScript(t):i.parseJSON(t);if(n===null)throw new Nd("empty type expression");if(Oe(n))return X(n),n}static parseDataExpression(t,e){const i=new Qe(e),n=typeof t=="string"?i.parseScript(t):i.parseJSON(t);if(n===null)throw new xd("empty data expression");if(Ze(n))return n;throw void 0}section(t){return ae(this.contract,t)}entryPoints(){return Si(this.contract)}entryPoint(t){return wn(this.contract,t)}assertDataValid(t,e){sc(t,e,this.ctx)}isDataValid(t,e){return ap(t,e,this.ctx)}assertParameterValid(t,e){const i=this.entryPoint(t||void 0);if(i===null)throw new Ld(t==null?void 0:t.toString());this.assertDataValid(e,i)}isParameterValid(t,e){try{return this.assertParameterValid(t,e),!0}catch{return!1}}functionType(t,e){return op(t,e,this.ctx)}}new Yn([{prim:"parameter",args:[{prim:"unit"}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}]);const ko=r=>r.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),et=(r,t=8)=>r.toString(16).padStart(t,"0"),Jn=31;var p;(function(r){r.SECRET="secret",r.RAW="raw",r.TZ1="tz1",r.BRANCH="branch",r.ZARITH="zarith",r.PUBLIC_KEY="public_key",r.PKH="pkh",r.DELEGATE="delegate",r.SCRIPT="script",r.BALLOT_STATEMENT="ballotStmt",r.PROPOSAL="proposal",r.PROPOSAL_ARR="proposalArr",r.INT32="int32",r.INT16="int16",r.PARAMETERS="parameters",r.ADDRESS="address",r.SMART_CONTRACT_ADDRESS="smart_contract_address",r.SMART_ROLLUP_ADDRESS="smart_rollup_address",r.SMART_ROLLUP_COMMITMENT_HASH="smart_rollup_commitment_hash",r.VALUE="value",r.PADDED_BYTES="padded_bytes",r.SMART_ROLLUP_MESSAGE="smart_rollup_message",r.MANAGER="manager",r.BLOCK_PAYLOAD_HASH="blockPayloadHash",r.ENTRYPOINT="entrypoint",r.OPERATION="operation",r.OP_ACTIVATE_ACCOUNT="activate_account",r.OP_DELEGATION="delegation",r.OP_TRANSACTION="transaction",r.OP_ORIGINATION="origination",r.OP_BALLOT="ballot",r.OP_ENDORSEMENT="endorsement",r.OP_SEED_NONCE_REVELATION="seed_nonce_revelation",r.OP_REVEAL="reveal",r.OP_PROPOSALS="proposals",r.OP_REGISTER_GLOBAL_CONSTANT="register_global_constant",r.OP_TRANSFER_TICKET="transfer_ticket",r.OP_TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.OP_TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.BURN_LIMIT="burn_limit",r.TX_ROLLUP_ORIGINATION_PARAM="tx_rollup_origination_param",r.TX_ROLLUP_ID="tx_rollup_id",r.TX_ROLLUP_BATCH_CONTENT="tx_rollup_batch_content",r.OP_INCREASE_PAID_STORAGE="increase_paid_storage",r.OP_UPDATE_CONSENSUS_KEY="update_consensus_key",r.OP_DRAIN_DELEGATE="drain_delegate",r.DEPOSITS_LIMIT="deposits_limit",r.OP_SET_DEPOSITS_LIMIT="set_deposits_limit",r.OP_SMART_ROLLUP_ORIGINATE="smart_rollup_originate",r.PVM_KIND="pvm_kind",r.OP_SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",r.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message"})(p||(p={}));const Kt={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0a":"True","0b":"Unit","0c":"PACK","0d":"UNPACK","0e":"BLAKE2B","0f":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1a":"CONCAT","1b":"CONS","1c":"CREATE_ACCOUNT","1d":"CREATE_CONTRACT","1e":"IMPLICIT_ACCOUNT","1f":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2a":"GT","2b":"HASH_KEY","2c":"IF","2d":"IF_CONS","2e":"IF_LEFT","2f":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3a":"MUL","3b":"NEG","3c":"NEQ","3d":"NIL","3e":"NONE","3f":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4a":"STEPS_TO_QUOTA","4b":"SUB","4c":"SWAP","4d":"TRANSFER_TOKENS","4e":"SET_DELEGATE","4f":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5a":"contract","5b":"int","5c":"key","5d":"key_hash","5e":"lambda","5f":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6a":"mutez","6b":"timestamp","6c":"unit","6d":"operation","6e":"address","6f":"SLICE",70:"DIG",71:"DUG",72:"EMPTY_BIG_MAP",73:"APPLY",74:"chain_id",75:"CHAIN_ID",76:"LEVEL",77:"SELF_ADDRESS",78:"never",79:"NEVER","7a":"UNPAIR","7b":"VOTING_POWER","7c":"TOTAL_VOTING_POWER","7d":"KECCAK","7e":"SHA3","7f":"PAIRING_CHECK",80:"bls12_381_g1",81:"bls12_381_g2",82:"bls12_381_fr",83:"sapling_state",84:"sapling_transaction_deprecated",85:"SAPLING_EMPTY_STATE",86:"SAPLING_VERIFY_UPDATE",87:"ticket",88:"TICKET_DEPRECATED",89:"READ_TICKET","8a":"SPLIT_TICKET","8b":"JOIN_TICKETS","8c":"GET_AND_UPDATE","8d":"chest","8e":"chest_key","8f":"OPEN_CHEST",90:"VIEW",91:"view",92:"constant",93:"SUB_MUTEZ",94:"tx_rollup_l2_address",95:"MIN_BLOCK_TIME",96:"sapling_transaction",97:"EMIT",98:"Lambda_rec",99:"LAMBDA_REC","9a":"TICKET","9b":"BYTES","9c":"NAT"},cp=(()=>{const r={};return Object.keys(Kt).forEach(t=>{r[Kt[t]]=t}),r})(),An={4:"activate_account",107:"reveal",110:"delegation",108:"transaction",109:"origination",6:"ballot",21:"endorsement",1:"seed_nonce_revelation",5:"proposals",111:"register_global_constant",150:"tx_rollup_origination",151:"tx_rollup_submit_batch",158:"transfer_ticket",112:"set_deposits_limit",113:"increase_paid_storage",114:"update_consensus_key",9:"drain_delegate",200:"smart_rollup_originate",201:"smart_rollup_add_messages",206:"smart_rollup_execute_outbox_message"},jo=(()=>{const r={};return Object.keys(An).forEach(t=>{const e=typeof t=="string"?parseInt(t,10):t;r[An[e]]=et(e,2)}),r})(),Pi={"00":"default","01":"root","02":"do","03":"set_delegate","04":"remove_delegate","05":"deposit"},Bo=(()=>{const r={};return Object.keys(Pi).forEach(t=>{r[Pi[t]]=t}),r})();class up extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBlockHashError"}}class Ho extends Error{constructor(t){super(t),this.message=t,this.name="InvalidOperationSchemaError"}}class oc extends Error{constructor(t){super(`Oversized entrypoint: ${t}. The maximum length of entrypoint is ${Jn}`),this.entrypoint=t,this.name="OversizedEntryPointError"}}class lp extends Error{constructor(t){super(`The ballot value '${t}' is invalid`),this.ballotValue=t,this.name="InvalidBallotValueError"}}class hp extends Error{constructor(t){super(`Failed to decode ballot value ${t}`),this.ballotValue=t,this.name="DecodeBallotValueError"}}class ac extends Error{constructor(t){super(`The hex string '${t}' is invalid`),this.hexString=t,this.name="InvalidHexStringError"}}class dp extends Error{constructor(t){super(`Failed to encode michelson value '${t}'`),this.value=t,this.name="UnexpectedMichelsonValueError"}}class cc extends Error{constructor(t){super(t),this.message=t,this.name="OperationDecodingError"}}class pp extends Error{constructor(t){super(t),this.message=t,this.name="OperationEncodingError"}}class fp extends Error{constructor(t){super(`The operation '${t}' is unsupported`),this.op=t,this.name="UnsupportedOperationError"}}class gp extends Error{constructor(t){super(`The Pvm "${t}" is not supported`),this.pvm=t,this.name="UnsupportedPvmKindError"}}class mp extends Error{constructor(t){super(`The encoded Pvm ${t} is not supported`),this.pvm=t,this.name="DecodePvmKindError"}}class yp extends Error{constructor(t){super(`The Smart Rollup Contract Address: ${t} is invalid`),this.address=t,this.name="InvalidSmartRollupContractAddress"}}class uc extends Error{constructor(t){super(`The Smart Rollup Contract Address: ${t} is invalid`),this.address=t,this.name="InvalidSmartRollupContractAddress"}}class Ut{constructor(t,e=0){this.arr=t,this.offset=e}static fromHexString(t){const e=t.toLowerCase();if(/^(([a-f]|\d){2})*$/.test(e)){const i=new Uint8Array((e.match(/([a-z]|\d){2}/g)||[]).map(n=>parseInt(n,16)));return new Ut(i)}else throw new ac(e)}consume(t){const e=this.arr.subarray(this.offset,this.offset+t);return this.offset+=t,e}get(t){return this.arr[this.offset+t]}length(){return this.arr.length-this.offset}slice(t,e){return new Ut(this.arr.slice(t,e))}}const bp=r=>"prim"in r,Ep=r=>"bytes"in r&&typeof r.bytes=="string",vp=r=>"string"in r&&typeof r.string=="string",_p=r=>"int"in r&&typeof r.int=="string",wp=r=>{const t=He(r.code),e=He(r.storage);return`${et(t.length/2,8)}${t}${et(e.length/2,8)}${e}`},Ap=r=>{const t=kt(r),e=kt(r);return{code:$e(new Ut(t)),storage:$e(new Ut(e))}},He=r=>{if(Array.isArray(r)){const t=r.map(i=>He(i)).join(""),e=t.length/2;return`02${et(e)}${t}`}else{if(bp(r))return xp(r);if(Ep(r))return Rp(r);if(vp(r))return Pp(r);if(_p(r))return Ip(r)}throw new dp(JSON.stringify(r))},$e=r=>{const t=r.consume(1);switch(t[0]){case 10:return Sp(r);case 1:return Tp(r);case 0:return Np(r);case 2:{const e=new Ut(kt(r)),i=[];for(;e.length()>0;)i.push($e(e));return i}default:return Lp(r,t)}},kt=(r,t=4)=>{const e=r.consume(t),i=parseInt(Buffer.from(e).toString("hex"),16);return r.consume(i)},Op=(r,t=4)=>{const e=[];let i=r;for(;i.length();){const n=i.consume(t),s=parseInt(Buffer.from(n).toString("hex"),16);e.push(i.consume(s)),i=i.slice(s+t)}return e},Rp=r=>{if(!/^([A-Fa-f0-9]{2})*$/.test(r.bytes))throw new ac(r.bytes);const t=r.bytes.length/2;return`0a${et(t)}${r.bytes}`},Sp=r=>{const t=kt(r);return{bytes:Buffer.from(t).toString("hex")}},Pp=r=>{const t=Buffer.from(r.string,"utf8").toString("hex"),e=t.length/2;return`01${et(e)}${t}`},Tp=r=>{const t=kt(r);return{string:Buffer.from(t).toString("utf8")}},Ip=({int:r})=>{const t=new A(r,10),e=t.toString(2)[0]==="-"?"1":"0",i=t.toString(2).replace(/-/g,""),n=i.length<=6?6:(i.length-6)%7?i.length+7-(i.length-6)%7:i.length,o=i.padStart(n,"0").match(/\d{6,7}/g).reverse();return o[0]=e+o[0],`00${o.map((c,h)=>parseInt((h===o.length-1?"0":"1")+c,2).toString(16).padStart(2,"0")).join("")}`},Np=r=>{let t=r.consume(1)[0];const e=[],i=1<<7;for(;t&i;)e.push(t),t=r.consume(1)[0];e.push(t);const n=!!(1<<6&e[0]);e[0]=e[0]&127;const s=e.map((a,c)=>a.toString(2).slice(c===0?-6:-7).padStart(c===0?6:7,"0")).reverse();let o=new A(s.join(""),2);return n&&(o=o.times(-1)),{int:o.toFixed()}},xp=r=>{const t=+Array.isArray(r.annots),e=Array.isArray(r.args)?r.args.length:0,i=et(Math.min(2*e+t+3,9),2),n=cp[r.prim];let s=(r.args||[]).map(a=>He(a)).join("");const o=Array.isArray(r.annots)?Dp(r.annots):"";return(r.prim==="LAMBDA"||r.prim==="LAMBDA_REC")&&e&&(s=et(s.length/2)+s+et(0)),(r.prim==="pair"||r.prim==="Pair")&&e>2&&(s=o===""?et(s.length/2)+s+et(0):et(s.length/2)+s),r.prim==="view"&&r.args&&(s=et(s.length/2)+s+et(0)),`${i}${n}${s}${o}`},Lp=(r,t)=>{const e=(t[0]-3)%2===1;let i=Math.floor((t[0]-3)/2);const n=r.consume(1)[0].toString(16).padStart(2,"0"),s={prim:Kt[n]};if((Kt[n]==="LAMBDA"||Kt[n]==="LAMBDA_REC")&&r.consume(4),Kt[n]==="view")return i!=0?Cp(r,s):s;let o,a;(Kt[n]==="pair"||Kt[n]==="Pair")&&i>2&&(o=Mp(r),i=0,a=$o(r));const c=new Array(i).fill(0).map(()=>$e(r));return(Kt[n]==="LAMBDA"||Kt[n]==="LAMBDA_REC")&&r.consume(4),o?s.args=o:c.length&&(s.args=c),a&&a[0]!==""?s.annots=a:e&&(s.annots=$o(r)),s},Cp=(r,t)=>(r.consume(4),t.args=new Array(4).fill(0).map(()=>$e(r)),r.consume(4),t),Mp=r=>{const t=new Ut(kt(r)),e=[];for(;t.length()>0;)e.push($e(t));return e},Dp=r=>{const t=r.map(i=>Buffer.from(i,"utf8").toString("hex")).join("20"),e=t.length/2;return`${et(e)}${t}`},$o=r=>{const t=r.consume(4),e=parseInt(Buffer.from(t).toString("hex"),16),i=r.consume(e);return Buffer.from(i).toString("hex").split("20").map(s=>Buffer.from(s,"hex").toString("utf8"))},bt=r=>t=>Uc(Buffer.from(Jo(t,In[r]))),wt=r=>t=>{const e=t.consume(Vc[r]);return Kc(e,In[r])},kp=wt(P.TZ1),jp=wt(P.B),Zn=r=>{const t=r.consume(1);if(t[0]===0)return wt(P.TZ1)(r);if(t[0]===1)return wt(P.TZ2)(r);if(t[0]===2)return wt(P.TZ3)(r)},Bp=bt(P.B),Hp=bt(P.TZ1),Uo=r=>r?"ff":"00",lc=r=>bt(P.P)(r),hc=r=>wt(P.P)(r),$p=r=>{const t=[];for(r.consume(4);r.length()>0;)t.push(hc(r));return t},Up=r=>et(32*r.length)+r.map(t=>lc(t)).join(""),Vp=r=>{switch(r){case"yay":return"00";case"nay":return"01";case"pass":return"02";default:throw new lp(r)}},Kp=r=>{const t=r.consume(1);switch(t[0]){case 0:return"yay";case 1:return"nay";case 2:return"pass";default:throw new hp(t[0].toString())}},Gp=r=>{switch(r){case"arith":return"00";case"wasm_2_0_0":return"01";default:throw new gp(r)}},Fp=r=>{const t=r.consume(1);switch(t[0]){case 0:return"arith";case 1:return"wasm_2_0_0";default:throw new mp(t[0].toString())}},zp=r=>r?Uo(!0)+Xn(r):Uo(!1),qp=r=>{const t=parseInt(String(r),10),e=[];for(let i=0;i<4;i++){const n=(4-(i+1))*8;e.push((t&255<<n)>>n)}return Buffer.from(e).toString("hex")},Wp=r=>{const t=r.consume(4);let e=0;for(let i=0;i<t.length;i++)e=e|t[i]<<(t.length-(i+1))*8;return e},Yp=r=>{const t=parseInt(String(r),10),e=[];for(let i=0;i<2;i++){const n=(2-(i+1))*8;e.push((t&255<<n)>>n)}return Buffer.from(e).toString("hex")},Jp=r=>{const t=r.consume(2);let e=0;for(let i=0;i<t.length;i++)e=e|t[i]<<(t.length-(i+1))*8;return e},Zp=r=>r.consume(1)[0]===255,Xp=r=>{if(Zp(r))return Zn(r)},Xn=r=>{switch(r.substring(0,3)){case P.TZ1:return"00"+bt(P.TZ1)(r);case P.TZ2:return"01"+bt(P.TZ2)(r);case P.TZ3:return"02"+bt(P.TZ3)(r);case P.TZ4:return"03"+bt(P.TZ4)(r);default:throw new xn(r)}},Qp=r=>{switch(r.substring(0,4)){case P.EDPK:return"00"+bt(P.EDPK)(r);case P.SPPK:return"01"+bt(P.SPPK)(r);case P.P2PK:return"02"+bt(P.P2PK)(r);default:throw new Xo(r)}},tf=r=>{switch(r.substring(0,3)){case P.TZ1:case P.TZ2:case P.TZ3:case P.TZ4:return"00"+Xn(r);case P.KT1:return"01"+bt(P.KT1)(r)+"00";default:throw new F(r)}},ef=r=>{if(r.substring(0,3)!==P.SR1)throw new yp(r);return bt(P.SR1)(r)},rf=r=>{if(r.substring(0,3)===P.KT1)return"01"+bt(P.KT1)(r)+"00";throw new pr(r)},nf=r=>{switch(r.consume(1)[0]){case 0:return wt(P.EDPK)(r);case 1:return wt(P.SPPK)(r);case 2:return wt(P.P2PK)(r);default:throw new Xo(r.toString())}},sf=r=>{if(r.substring(0,4)===P.SRC1)return bt(P.SRC1)(r);throw new uc(r)},of=r=>{switch(r.consume(1)[0]){case 0:return Zn(r);case 1:{const e=wt(P.KT1)(r);return r.consume(1),e}default:throw new F(r.toString())}},af=r=>{const t=wt(P.SR1)(r);if(t.substring(0,3)!==P.SR1)throw new F(t);return t},cf=r=>{if(r.consume(1)[0]===1){const e=wt(P.KT1)(r);return r.consume(1),e}throw new pr(r.toString())},uf=r=>{const t=wt(P.SRC1)(r);if(t.substring(0,4)!==P.SRC1)throw new uc(t);return t},Qn=r=>{const t=[];let e=new A(r,10);if(e.isNaN())throw new TypeError(`Invalid zarith number ${r}`);for(;;)if(e.lt(128)){e.lt(16)&&t.push("0"),t.push(e.toString(16));break}else{let i=e.mod(128);e=e.minus(i),e=e.dividedBy(128),i=i.plus(128),t.push(i.toString(16))}return t.join("")},ts=r=>{let t=0;for(;t<r.length()&&r.get(t)&128;)t+=1;let e=new A(0);for(let i=t;i>=0;i-=1){const n=r.get(i)&127;e=e.multipliedBy(128),e=e.plus(n)}return r.consume(t+1),new A(e).toString()},lf=r=>{const t=et(r.consume(1)[0],2);if(t in Pi)return Pi[t];{const e=kt(r,1),i=Buffer.from(e).toString("utf8");if(i.length>Jn)throw new oc(i);return i}},hf=r=>{if(r.consume(1)[0]!==0){const e=lf(r),i=kt(r),n=$e(new Ut(i));return{entrypoint:e,value:n}}},df=r=>{if(r in Bo)return`${Bo[r]}`;if(r.length>Jn)throw new oc(r);return`ff${He({string:r}).slice(8)}`},pf=r=>{if(!r||r.entrypoint==="default"&&"prim"in r.value&&r.value.prim==="Unit")return"00";const t=df(r.entrypoint),e=He(r.value),i=(e.length/2).toString(16).padStart(8,"0");return`ff${t}${i}${e}`},ff=r=>{const t=He(r);return`${et(t.length/2)}${t}`},gf=r=>{const t=kt(r);return $e(new Ut(t))},mf=bt(P.VH),yf=wt(P.VH),bf=r=>`${He({string:r}).slice(2)}`,Ef=r=>{const t=kt(r);return Buffer.from(t).toString("utf8")},vf=r=>"",_f=r=>({}),wf=bt(P.TXR1),Af=wt(P.TXR1),Of=r=>`${et(r.length/2)}${r}`,Rf=r=>{const t=kt(r);return Buffer.from(t).toString("hex")},Sf=r=>r?`ff${Qn(r)}`:"00",Pf=r=>{const t=r.consume(1);if(Buffer.from(t).toString("hex")!=="00")return ts(r)},Tf=r=>r?`ff${Qn(r)}`:"00",If=r=>{const t=r.consume(1);if(Buffer.from(t).toString("hex")!=="00")return ts(r)},Nf=(r,t=8)=>`${et(r.length/2,t)}${r}`,xf=r=>{const t=kt(r);return Buffer.from(t).toString("hex")},Lf=r=>{const t=r.reduce((e,i)=>e+`${et(i.length/2)}${i}`,"");return`${et(t.length/2)}${t}`},Cf=r=>{const t=kt(r);return Op(new Ut(t)).map(i=>Buffer.from(i).toString("hex"))},dc={branch:p.BRANCH,contents:[p.OPERATION]},es={pkh:p.TZ1,secret:p.SECRET},rs={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,public_key:p.PUBLIC_KEY},is={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,delegate:p.DELEGATE},ns={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,amount:p.ZARITH,destination:p.ADDRESS,parameters:p.PARAMETERS},ss={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,balance:p.ZARITH,delegate:p.DELEGATE,script:p.SCRIPT},os={source:p.PKH,period:p.INT32,proposal:p.PROPOSAL,ballot:p.BALLOT_STATEMENT},as={slot:p.INT16,level:p.INT32,round:p.INT32,block_payload_hash:p.BLOCK_PAYLOAD_HASH},cs={level:p.INT32,nonce:p.RAW},us={source:p.PKH,period:p.INT32,proposals:p.PROPOSAL_ARR},ls={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,value:p.VALUE},hs={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,ticket_contents:p.VALUE,ticket_ty:p.VALUE,ticket_ticketer:p.ADDRESS,ticket_amount:p.ZARITH,destination:p.ADDRESS,entrypoint:p.ENTRYPOINT},ds={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,tx_rollup_origination:p.TX_ROLLUP_ORIGINATION_PARAM},ps={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,rollup:p.TX_ROLLUP_ID,content:p.TX_ROLLUP_BATCH_CONTENT,burn_limit:p.BURN_LIMIT},fs={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,amount:p.ZARITH,destination:p.SMART_CONTRACT_ADDRESS},gs={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,pk:p.PUBLIC_KEY},ms={consensus_key:p.PKH,delegate:p.PKH,destination:p.PKH},ys={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,limit:p.DEPOSITS_LIMIT},bs={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,pvm_kind:p.PVM_KIND,kernel:p.PADDED_BYTES,origination_proof:p.PADDED_BYTES,parameters_ty:p.VALUE},Es={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,message:p.SMART_ROLLUP_MESSAGE},vs={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,rollup:p.SMART_ROLLUP_ADDRESS,cemented_commitment:p.SMART_ROLLUP_COMMITMENT_HASH,output_proof:p.PADDED_BYTES},Mf=r=>t=>{if(!(t.kind in r)||!(t.kind in jo))throw new Pe(t.kind);return jo[t.kind]+r[t.kind](t)},Df=r=>t=>{const e=t.consume(1),i=An[e[0]];if(i===void 0)throw new fp(e[0].toString());const n=r[i](t);if(typeof n!="object")throw new cc("Decoded invalid operation");return Object.assign({kind:i},n)},nt=r=>t=>e=>Object.keys(t).reduce((n,s)=>{const o=t[s];if(e&&Array.isArray(o)){const a=r[o[0]],c=e[s];if(!Array.isArray(c))throw new pp(`Expected value to be Array ${JSON.stringify(c)}`);return n+c.reduce((h,l)=>h+a(l),"")}else{const a=r[o];return n+a(e[s])}},""),st=r=>t=>e=>Object.keys(t).reduce((n,s)=>{const o=t[s];if(Array.isArray(o)){const a=r[o[0]],c=[],h=e.length();for(;e.length()>0;)if(c.push(a(e)),h===e.length())throw new cc("Unable to decode value");return Object.assign(Object.assign({},n),{[s]:c})}else{const a=r[o],c=a(e);return typeof c<"u"?Object.assign(Object.assign({},n),{[s]:c}):Object.assign({},n)}},{}),M={[p.SECRET]:r=>ko(r.consume(20)),[p.RAW]:r=>ko(r.consume(32)),[p.TZ1]:kp,[p.BRANCH]:jp,[p.ZARITH]:ts,[p.PUBLIC_KEY]:nf,[p.PKH]:Zn,[p.DELEGATE]:Xp,[p.INT32]:Wp,[p.SCRIPT]:Ap,[p.BALLOT_STATEMENT]:Kp,[p.PROPOSAL]:hc,[p.PROPOSAL_ARR]:$p,[p.PARAMETERS]:hf,[p.ADDRESS]:of,[p.SMART_ROLLUP_ADDRESS]:af,[p.SMART_CONTRACT_ADDRESS]:cf,[p.SMART_ROLLUP_COMMITMENT_HASH]:uf,[p.VALUE]:gf,[p.INT16]:Jp,[p.BLOCK_PAYLOAD_HASH]:yf,[p.ENTRYPOINT]:Ef,[p.TX_ROLLUP_ORIGINATION_PARAM]:_f,[p.TX_ROLLUP_ID]:Af,[p.TX_ROLLUP_BATCH_CONTENT]:Rf,[p.BURN_LIMIT]:Pf,[p.DEPOSITS_LIMIT]:If,[p.PVM_KIND]:Fp,[p.PADDED_BYTES]:xf,[p.SMART_ROLLUP_MESSAGE]:Cf};M[p.OPERATION]=Df(M);M[p.OP_ACTIVATE_ACCOUNT]=r=>st(M)(es)(r);M[p.OP_DELEGATION]=r=>st(M)(is)(r);M[p.OP_TRANSACTION]=r=>st(M)(ns)(r);M[p.OP_ORIGINATION]=r=>st(M)(ss)(r);M[p.OP_BALLOT]=r=>st(M)(os)(r);M[p.OP_ENDORSEMENT]=r=>st(M)(as)(r);M[p.OP_SEED_NONCE_REVELATION]=r=>st(M)(cs)(r);M[p.OP_PROPOSALS]=r=>st(M)(us)(r);M[p.OP_REVEAL]=r=>st(M)(rs)(r);M[p.OP_REGISTER_GLOBAL_CONSTANT]=r=>st(M)(ls)(r);M[p.OP_TRANSFER_TICKET]=r=>st(M)(hs)(r);M[p.OP_TX_ROLLUP_ORIGINATION]=r=>st(M)(ds)(r);M[p.OP_TX_ROLLUP_SUBMIT_BATCH]=r=>st(M)(ps)(r);M[p.OP_INCREASE_PAID_STORAGE]=r=>st(M)(fs)(r);M[p.OP_UPDATE_CONSENSUS_KEY]=r=>st(M)(gs)(r);M[p.OP_DRAIN_DELEGATE]=r=>st(M)(ms)(r);M[p.OP_SMART_ROLLUP_ORIGINATE]=r=>st(M)(bs)(r);M[p.OP_SMART_ROLLUP_ADD_MESSAGES]=r=>st(M)(Es)(r);M[p.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=r=>st(M)(vs)(r);M[p.MANAGER]=st(M)(dc);M[p.OP_SET_DEPOSITS_LIMIT]=r=>st(M)(ys)(r);const D={[p.SECRET]:r=>r,[p.RAW]:r=>r,[p.TZ1]:Hp,[p.BRANCH]:Bp,[p.ZARITH]:Qn,[p.PUBLIC_KEY]:Qp,[p.PKH]:Xn,[p.DELEGATE]:zp,[p.SCRIPT]:wp,[p.BALLOT_STATEMENT]:Vp,[p.PROPOSAL]:lc,[p.PROPOSAL_ARR]:Up,[p.INT32]:qp,[p.PARAMETERS]:pf,[p.ADDRESS]:tf,[p.SMART_ROLLUP_ADDRESS]:ef,[p.SMART_CONTRACT_ADDRESS]:rf,[p.SMART_ROLLUP_COMMITMENT_HASH]:sf,[p.VALUE]:ff,[p.INT16]:Yp,[p.BLOCK_PAYLOAD_HASH]:mf,[p.ENTRYPOINT]:bf,[p.TX_ROLLUP_ORIGINATION_PARAM]:vf,[p.TX_ROLLUP_ID]:wf,[p.TX_ROLLUP_BATCH_CONTENT]:Of,[p.BURN_LIMIT]:Sf,[p.DEPOSITS_LIMIT]:Tf,[p.PVM_KIND]:Gp,[p.PADDED_BYTES]:Nf,[p.SMART_ROLLUP_MESSAGE]:Lf};D[p.OPERATION]=Mf(D);D[p.OP_ACTIVATE_ACCOUNT]=r=>nt(D)(es)(r);D[p.OP_DELEGATION]=r=>nt(D)(is)(r);D[p.OP_TRANSACTION]=r=>nt(D)(ns)(r);D[p.OP_ORIGINATION]=r=>nt(D)(ss)(r);D[p.OP_BALLOT]=r=>nt(D)(os)(r);D[p.OP_ENDORSEMENT]=r=>nt(D)(as)(r);D[p.OP_SEED_NONCE_REVELATION]=r=>nt(D)(cs)(r);D[p.OP_PROPOSALS]=r=>nt(D)(us)(r);D[p.OP_REVEAL]=r=>nt(D)(rs)(r);D[p.OP_REGISTER_GLOBAL_CONSTANT]=r=>nt(D)(ls)(r);D[p.OP_TRANSFER_TICKET]=r=>nt(D)(hs)(r);D[p.OP_TX_ROLLUP_ORIGINATION]=r=>nt(D)(ds)(r);D[p.OP_TX_ROLLUP_SUBMIT_BATCH]=r=>nt(D)(ps)(r);D[p.OP_INCREASE_PAID_STORAGE]=r=>nt(D)(fs)(r);D[p.OP_UPDATE_CONSENSUS_KEY]=r=>nt(D)(gs)(r);D[p.OP_DRAIN_DELEGATE]=r=>nt(D)(ms)(r);D[p.OP_SMART_ROLLUP_ORIGINATE]=r=>nt(D)(bs)(r);D[p.OP_SMART_ROLLUP_ADD_MESSAGES]=r=>nt(D)(Es)(r);D[p.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=r=>nt(D)(vs)(r);D[p.MANAGER]=nt(D)(dc);D[p.OP_SET_DEPOSITS_LIMIT]=r=>nt(D)(ys)(r);const pc={activate_account:es,reveal:rs,delegation:is,transaction:ns,origination:ss,ballot:os,endorsement:as,seed_nonce_revelation:cs,proposals:us,register_global_constant:ls,transfer_ticket:hs,tx_rollup_origination:ds,tx_rollup_submit_batch:ps,increase_paid_storage:fs,update_consensus_key:gs,drain_delegate:ms,set_deposits_limit:ys,smart_rollup_originate:bs,smart_rollup_add_messages:Es,smart_rollup_execute_outbox_message:vs},kf=(r,t)=>t.filter(e=>!r.includes(e)),jf=(r,t)=>r.filter(e=>e!==t),Bf=r=>Object.keys(pc).includes(r),Hf=r=>{const t=r.kind,e=Object.keys(r),i=jf(e,"kind"),n=Object.keys(pc[t]);return kf(i,n)};var On;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(On||(On={}));const $f=On.PtMumbai2;function Uf(r,t){return{encoder:D[r],decoder:e=>{const i=Ut.fromHexString(e);return M[r](i)}}}class fc{constructor(t=$f){this.protocolHash=t,this.codec=Uf(p.MANAGER,this.protocolHash)}forge(t){if(Gc(t.branch)!==L.VALID)throw new up(`The block hash ${t.branch} is invalid`);for(const i of t.contents){if(!Bf(i.kind))throw new Pe(i.kind);const n=Hf(i);if(n.length===1){if(i.kind==="delegation"&&n[0]==="delegate")continue;if(i.kind==="origination"&&n[0]==="delegate")continue;if(i.kind==="transaction"&&n[0]==="parameters")continue;if(i.kind==="set_deposits_limit"&&n[0]==="limit")continue;if(i.kind==="tx_rollup_submit_batch"&&n[0]==="burn_limit")continue;throw new Ho(`Missing properties: ${n.join(", ").toString()}`)}else if(n.length>1)throw new Ho(`Missing properties: ${n.join(", ").toString()}`)}const e=this.codec.encoder(t).toLowerCase();return Promise.resolve(e)}parse(t){return Promise.resolve(this.codec.decoder(t))}}const lm=new fc;function Tt(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}function f(r,t,e,i){function n(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(l){try{h(i.next(l))}catch(d){o(d)}}function c(l){try{h(i.throw(l))}catch(d){o(d)}}function h(l){l.done?s(l.value):n(l.value).then(a,c)}h((i=i.apply(r,t||[])).next())})}function ni(r,t,e,i){if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!i:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?i:e==="a"?i.call(r):i?i.value:t.get(r)}function ht(r,t,e,i,n){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?n.call(r,e):n?n.value=e:t.set(r,e),e}function Vf(r,t){const e=JSON.parse(r.body);if(e[0]&&e[0].kind&&e[0].msg){const i=JSON.stringify({kind:e[0].kind,id:e[0].id,msg:e[0].msg.replace(t,"")});return new Rr(`Http error response: (${r.status}) ${i}`,r.status,r.statusText,i,r.url)}else return r}class Kf{constructor(t){this.context=t}inject(t){return f(this,void 0,void 0,function*(){let e;try{e=yield this.context.rpc.injectOperation(t)}catch(i){const n=". You may want to use --replace to provide adequate fee and replace it";throw i instanceof Rr&&i.message.includes(n)?Vf(i,n):i}return e})}}class si extends Error{constructor(){super("No signer has been configured. Please configure one by calling setProvider({signer}) on your TezosToolkit instance."),this.name="UnconfiguredSignerError"}}class Rn{publicKey(){return f(this,void 0,void 0,function*(){throw new si})}publicKeyHash(){return f(this,void 0,void 0,function*(){throw new si})}secretKey(){return f(this,void 0,void 0,function*(){throw new si})}sign(t,e){return f(this,void 0,void 0,function*(){throw new si})}}function gc(r){return new Q(t=>(r.on("data",e=>{t.next(e)}),r.on("error",e=>{t.error(e)}),r.on("close",()=>{t.complete()}),()=>{r.close()}))}var Ue;(function(r){r[r.DELEGATION=10600]="DELEGATION",r[r.ORIGINATION=10600]="ORIGINATION",r[r.TRANSFER=10600]="TRANSFER",r[r.REVEAL=1100]="REVEAL"})(Ue||(Ue={}));var Ve;(function(r){r[r.DELEGATION=1257]="DELEGATION",r[r.ORIGINATION=1e4]="ORIGINATION",r[r.TRANSFER=1e4]="TRANSFER",r[r.REVEAL=374]="REVEAL"})(Ve||(Ve={}));var Ke;(function(r){r[r.DELEGATION=0]="DELEGATION",r[r.ORIGINATION=257]="ORIGINATION",r[r.TRANSFER=257]="TRANSFER",r[r.REVEAL=0]="REVEAL"})(Ke||(Ke={}));const Gf=250;var ot;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(ot||(ot={}));ot.Pt24m4xi,ot.PsBABY5H,ot.PsBabyM1,ot.PsCARTHA,ot.PsDELPH1,ot.PtEdo2Zk,ot.PsFLorena,ot.PtGRANADs,ot.PtHangz2,ot.PsiThaCa,ot.Psithaca2,ot.PtJakart2,ot.PtKathman,ot.PtLimaPtL,ot.PtMumbai2,ot.ProtoALpha;var Vo;(function(r){r.MAINNET="NetXdQprcVkpaWU",r.CARTHAGENET="NetXjD3HPJJjmcd",r.DELPHINET="NetXm8tYqnMWky1",r.EDONET="NetXSgo1ZT2DRUG",r.FLORENCENET="NetXxkAx4woPLyu",r.GRANADANET="NetXz969SFaFn8k",r.HANGZHOUNET="NetXZSsxBpMQeAT",r.ITHACANET="NetXbhmtAbMukLc",r.ITHACANET2="NetXnHfVqm9iesp",r.JAKARTANET2="NetXLH1uAxK7CCh",r.KATHMANDUNET="NetXazhm4yetmff",r.LIMANET="NetXizpkH94bocH",r.MUMBAINET="NetXQw6nWSnrJ5t",r.MUMBAINET2="NetXgbcrNtXD2yA"})(Vo||(Vo={}));class mc extends Error{constructor(t,e,i){super(`${t} Received ${i.length} arguments while expecting one of the following signatures (${JSON.stringify(e)})`),this.smartContractMethodName=t,this.sigs=e,this.args=i,this.name="Invalid parameters error"}}class Ff extends Error{constructor(t){super(`Since Babylon delegation source can no longer be a contract address ${t}. Please use the smart contract abstraction to set your delegate.`),this.source=t,this.name="Invalid delegation source error"}}class Ti extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="InvalidCodeParameter"}}class yc extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="InvalidInitParameter"}}class zf extends Error{constructor(t,e,i,n){super(`Unable to encode the parameter of the view: ${t}. Received ${i} as parameter while expecting one of the following signatures (${JSON.stringify(e)})`),this.smartContractViewName=t,this.sigs=e,this.args=i,this.originalError=n,this.name="Invalid view parameters error",this.cause=n}}class qf extends Error{constructor(t,e,i,n){super(t),this.message=t,this.viewName=e,this.failWith=i,this.originalError=n,this.name="ViewSimulationError"}}const Wf=r=>{if(Yf(r.body)){const t=JSON.parse(r.body);if(Array.isArray(t)&&"with"in t[t.length-1])return t[t.length-1].with}},Yf=r=>{try{JSON.parse(r)}catch{return!1}return!0};class Ko extends Error{constructor(t){super(`${t} Please configure the context of the view execution in the executeView method.`),this.info=t,this.name="InvalidViewSimulationContext"}}class bc extends Error{constructor(t){super(t),this.message=t,this.name="RevealOperationError"}}class Jf extends Error{constructor(t){super(t),this.message=t,this.name="OriginationParameterError"}}class Zf extends Error{constructor(t){super(t),this.message=t,this.name="IntegerError"}}const Hr=({code:r,init:t,balance:e="0",delegate:i,storage:n,fee:s=Ve.ORIGINATION,gasLimit:o=Ue.ORIGINATION,storageLimit:a=Ke.ORIGINATION,mutez:c=!1})=>f(void 0,void 0,void 0,function*(){if(n!==void 0&&t!==void 0)throw new Jf("Storage and Init cannot be set a the same time. Please either use storage or init but not both.");if(!Array.isArray(r))throw new Ti("Wrong code parameter type, expected an array",r);let h;if(n!==void 0){const y=r.find(k=>"prim"in k&&k.prim==="storage");if((y==null?void 0:y.args)===void 0)throw new Ti("The storage section is missing from the script",r);h=new Lt(y.args[0]).Encode(n)}else if(t!==void 0&&typeof t=="object")h=t;else throw new yc("Wrong init parameter type, expected JSON Michelson",t);const l={code:r,storage:h};if(isNaN(Number(e)))throw new Zf(`Unexpected Invalid Integer ${e}`);const d={kind:b.ORIGINATION,fee:s,gas_limit:o,storage_limit:a,balance:c?e.toString():Ln("tz","mutez",e).toString(),script:l};return i&&(d.delegate=i),d}),yr=({to:r,amount:t,parameter:e,fee:i=Ve.TRANSFER,gasLimit:n=Ue.TRANSFER,storageLimit:s=Ke.TRANSFER,mutez:o=!1})=>f(void 0,void 0,void 0,function*(){return{kind:b.TRANSACTION,fee:i,gas_limit:n,storage_limit:s,amount:o?t.toString():Ln("tz","mutez",t).toString(),destination:r,parameters:e}}),$r=({delegate:r,source:t,fee:e=Ve.DELEGATION,gasLimit:i=Ue.DELEGATION,storageLimit:n=Ke.DELEGATION})=>f(void 0,void 0,void 0,function*(){return{kind:b.DELEGATION,source:t,fee:e,gas_limit:i,storage_limit:n,delegate:r}}),Ec=({fee:r=Ve.DELEGATION,gasLimit:t=Ue.DELEGATION,storageLimit:e=Ke.DELEGATION},i)=>f(void 0,void 0,void 0,function*(){return{kind:b.DELEGATION,fee:r,gas_limit:t,storage_limit:e,delegate:i}}),Ge=({fee:r=Ve.REVEAL,gasLimit:t=Ue.REVEAL,storageLimit:e=Ke.REVEAL},i,n)=>f(void 0,void 0,void 0,function*(){return{kind:b.REVEAL,fee:r,public_key:n,source:i,gas_limit:t,storage_limit:e}}),Ur=({value:r,source:t,fee:e,gasLimit:i,storageLimit:n})=>f(void 0,void 0,void 0,function*(){return{kind:b.REGISTER_GLOBAL_CONSTANT,value:r,fee:e,gas_limit:i,storage_limit:n,source:t}}),Vr=({source:r,fee:t,gasLimit:e,storageLimit:i})=>f(void 0,void 0,void 0,function*(){return{kind:b.TX_ROLLUP_ORIGINATION,fee:t,gas_limit:e,storage_limit:i,source:r,tx_rollup_origination:{}}}),Kr=({content:r,rollup:t,source:e,fee:i,gasLimit:n,storageLimit:s})=>f(void 0,void 0,void 0,function*(){return{kind:b.TX_ROLLUP_SUBMIT_BATCH,fee:i,gas_limit:n,storage_limit:s,source:e,content:r,rollup:t}}),Gr=({ticketContents:r,ticketTy:t,ticketTicketer:e,ticketAmount:i,destination:n,entrypoint:s,source:o,fee:a,gasLimit:c,storageLimit:h})=>f(void 0,void 0,void 0,function*(){return{kind:b.TRANSFER_TICKET,fee:a,gas_limit:c,storage_limit:h,source:o,ticket_contents:r,ticket_ty:t,ticket_ticketer:e,ticket_amount:i,destination:n,entrypoint:s}}),Fr=({source:r,fee:t,gasLimit:e,storageLimit:i,amount:n,destination:s})=>f(void 0,void 0,void 0,function*(){return{kind:b.INCREASE_PAID_STORAGE,source:r,fee:t,gas_limit:e,storage_limit:i,amount:n,destination:s}}),vc=({consensus_key:r,delegate:t,destination:e})=>f(void 0,void 0,void 0,function*(){return{kind:b.DRAIN_DELEGATE,consensus_key:r,delegate:t,destination:e}}),_c=({source:r,proposal:t,ballot:e})=>f(void 0,void 0,void 0,function*(){return{kind:b.BALLOT,source:r,proposal:t,ballot:e}}),wc=({source:r,proposals:t})=>f(void 0,void 0,void 0,function*(){return{kind:b.PROPOSALS,source:r,proposals:t}}),_s=({source:r,fee:t,gasLimit:e,storageLimit:i,pk:n})=>f(void 0,void 0,void 0,function*(){return{kind:b.UPDATE_CONSENSUS_KEY,source:r,fee:t,gas_limit:e,storage_limit:i,pk:n}}),zr=({source:r,fee:t,gasLimit:e,storageLimit:i,message:n})=>f(void 0,void 0,void 0,function*(){return{kind:b.SMART_ROLLUP_ADD_MESSAGES,source:r,fee:t,gas_limit:e,storage_limit:i,message:n}}),qr=({source:r,fee:t,gasLimit:e,storageLimit:i,pvmKind:n,kernel:s,originationProof:o,parametersType:a})=>f(void 0,void 0,void 0,function*(){return{kind:b.SMART_ROLLUP_ORIGINATE,source:r,fee:t,gas_limit:e,storage_limit:i,pvm_kind:n,kernel:s,origination_proof:o,parameters_ty:a}}),oi=(r,t)=>Object.assign(Object.assign({},r),{kind:t}),Go=(r,t)=>{if(Array.isArray(r)){const e=r.find(i=>i.kind===t);if(e&&Xf(e,t))return e}},Xf=(r,t)=>r.kind===t,Sn=r=>["transaction","delegation","origination","reveal","register_global_constant","increase_paid_storage","tx_rollup_origination","tx_rollup_submit_batch","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate"].indexOf(r.kind)!==-1,Ii=r=>["transaction","delegation","origination","register_global_constant","increase_paid_storage","tx_rollup_origination","tx_rollup_submit_batch","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate"].indexOf(r.kind)!==-1,ws=r=>"metadata"in r,Tr=r=>ws(r)&&"operation_result"in r.metadata,Qf=r=>ws(r)&&"internal_operation_results"in r.metadata,tg=r=>"with"in r;class Ac extends Error{constructor(t,e){super(),this.errors=t,this.errorDetails=e,this.name="TezosOperationError";const i=t[t.length-1];this.id=i.id,this.kind=i.kind,this.message=`(${this.kind}) ${this.id}`,tg(i)&&(i.with.string?this.message=i.with.string:i.with.int?this.message=i.with.int:this.message=JSON.stringify(i.with))}}class eg extends Error{constructor(t){super("Preapply returned an unexpected result"),this.result=t,this.name="TezosPreapplyFailureError"}}const ce=r=>{const t=Array.isArray(r)?r:[r],e=[];for(let i=0;i<t.length;i++)for(let n=0;n<t[i].contents.length;n++){const s=t[i].contents[n];Tr(s)&&(e.push(Object.assign({fee:s.fee},s.metadata.operation_result)),Array.isArray(s.metadata.internal_operation_results)&&s.metadata.internal_operation_results.forEach(o=>e.push(o.result)))}return e},Or=(r,t="failed")=>{const e=Array.isArray(r)?r:[r];let i=[];for(let n=0;n<e.length;n++)for(let s=0;s<e[n].contents.length;s++){const o=e[n].contents[s];if(ws(o)&&(Tr(o)&&o.metadata.operation_result.status===t&&(i=i.concat(o.metadata.operation_result.errors||[])),Qf(o)&&Array.isArray(o.metadata.internal_operation_results)))for(const a of o.metadata.internal_operation_results)"result"in a&&a.result.status===t&&(i=i.concat(a.result.errors||[]))}return i};class rg extends Error{constructor(t){super(t),this.message=t,this.name="OriginationOperationError"}}class hn extends Error{constructor(t){super(t),this.message=t,this.name="InvalidEstimateValueError"}}class Oc extends Error{constructor(t){super(t),this.message=t,this.name="InvalidConfirmationCountError"}}class ig extends Error{constructor(t){super(t),this.message=t,this.name="ConfirmationUndefinedError"}}class ng extends Error{constructor(t){super(t),this.message=t,this.name="InvalidFilterExpressionError"}}class tr extends Error{constructor(t){super(t),this.message=t,this.name="RPCResponseError"}}class gt{constructor(t,e,i,n){if(this.hash=t,this.raw=e,this.results=i,this.context=n,this._pollingConfig$=new jr(1),this.currentHead$=this._pollingConfig$.pipe(oe(s=>new Di(s).pipe(La(s.timeout*1e3,Vn(new Error("Confirmation polling timed out"))))),oe(()=>Ta(()=>gc(this.context.stream.subscribeBlock("head"))).pipe(oe(s=>{var o,a;const c=(a=(o=this.lastHead)===null||o===void 0?void 0:o.header.level)!==null&&a!==void 0?a:s.header.level-1;return Gn(c+1,s.header.level-c-1).pipe(Qr(h=>this.context.readProvider.getBlock(h)),Na(s))}),wi(s=>this.lastHead=s))),yo({refCount:!0})),this.confirmed$=this.currentHead$.pipe(er(s=>{for(let o=3;o>=0;o--)s.operations[o].forEach(a=>{a.hash===this.hash&&(this._foundAt=s.header.level)});if(s.header.level-this._foundAt>=0)return this._foundAt}),_i(s=>s!==void 0),_e(),yo()),this._foundAt=Number.POSITIVE_INFINITY,Qo(this.hash)!==L.VALID)throw new ta(this.hash);this.confirmed$.pipe(_e(),Fn(()=>Sr(_a))).subscribe()}get includedInBlock(){return this._foundAt}get revealOperation(){return Array.isArray(this.results)&&this.results.find(t=>t.kind==="reveal")}get revealStatus(){return this.revealOperation?this.revealOperation.metadata.operation_result.status:"unknown"}get status(){return this.results.map(t=>Tr(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}confirmation(t,e){return f(this,void 0,void 0,function*(){if(typeof t<"u"&&t<1)throw new Oc("Confirmation count must be at least 1");const{defaultConfirmationCount:i,confirmationPollingTimeoutSecond:n}=this.context.config;this._pollingConfig$.next({timeout:e||n});const s=t!==void 0?t:i;return new Promise((o,a)=>{this.confirmed$.pipe(oe(()=>this.currentHead$),_i(c=>c.header.level-this._foundAt>=s-1),_e()).subscribe(c=>{o(this._foundAt+(s-1))},a)})})}}class sg extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}sumProp(t,e){return t.reduce((i,n)=>e in n?Number(n[e])+i:i,0)}getOriginatedContractAddresses(){const t=this.results.filter(i=>i.kind==="origination");let e=[];for(const i of t)i.metadata.operation_result.originated_contracts&&(e=[...e,...i.metadata.operation_result.originated_contracts]);return e}get status(){return this.results.filter(t=>Rc.indexOf(t.kind)!==-1).map(t=>Tr(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}get fee(){return this.sumProp(this.params,"fee")}get gasLimit(){return this.sumProp(this.params,"gas_limit")}get storageLimit(){return this.sumProp(this.params,"storage_limit")}get consumedGas(){return A.config({DECIMAL_PLACES:0,ROUNDING_MODE:A.ROUND_UP}),new A(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(ce({contents:this.results}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(ce({contents:this.results}),"paid_storage_size_diff"))}get errors(){return Or({contents:this.results})}}class $i{constructor(t){this.context=t}get rpc(){return this.context.rpc}get signer(){return this.context.signer}isRevealOpNeeded(t,e){return f(this,void 0,void 0,function*(){return!(!(yield this.isAccountRevealRequired(e))||!this.isRevealRequiredForOpType(t))})}isAccountRevealRequired(t){return f(this,void 0,void 0,function*(){return!(yield this.context.readProvider.isAccountRevealed(t,"head"))})}isRevealRequiredForOpType(t){let e=!1;for(const i of t)Ii(i)&&(e=!0);return e}prepareOperation({operation:t,source:e},i){return f(this,void 0,void 0,function*(){const n={};let s=[];const o=this.context.readProvider.getBlockHash("head~2"),a=this.context.readProvider.getNextProtocol("head");Array.isArray(t)?s=[...t]:s=[t];const c=i||(yield this.signer.publicKeyHash());let h=Promise.resolve(void 0),l=Promise.resolve(void 0);s.find(O=>f(this,void 0,void 0,function*(){if(O.kind==="ballot"||O.kind==="proposals")try{l=this.rpc.getCurrentPeriod()}catch(U){throw new tr(`Failed to get the current voting period index: ${JSON.stringify(U)}`)}}));for(let O=0;O<s.length;O++)if(Ii(s[O])||s[O].kind==="reveal"){h=this.context.readProvider.getCounter(c,"head");break}const[d,y,v,k]=yield Promise.all([o,a,h,l]),Y=parseInt(v||"0",10);(!n[c]||n[c]<Y)&&(n[c]=Y);const T=O=>({counter:`${++n[c]}`,fee:typeof O.fee>"u"?"0":`${O.fee}`,gas_limit:typeof O.gas_limit>"u"?"0":`${O.gas_limit}`,storage_limit:typeof O.storage_limit>"u"?"0":`${O.storage_limit}`}),w=O=>({source:typeof O.source>"u"?e||c:O.source}),ze=(O=>O.map(U=>{switch(U.kind){case b.ACTIVATION:case b.DRAIN_DELEGATE:return Object.assign({},U);case b.ORIGINATION:return Object.assign(Object.assign(Object.assign(Object.assign({},U),{balance:typeof U.balance<"u"?`${U.balance}`:"0"}),w(U)),T(U));case b.TRANSACTION:{const qe=Object.assign(Object.assign(Object.assign(Object.assign({},U),{amount:typeof U.amount<"u"?`${U.amount}`:"0"}),w(U)),T(U));if(qe.source.toLowerCase().startsWith("kt1"))throw new Cn(`KT1 addresses are not supported as source since ${ot.PsBabyM1}`);return qe}case b.REVEAL:case b.DELEGATION:case b.REGISTER_GLOBAL_CONSTANT:case b.TX_ROLLUP_ORIGINATION:case b.TX_ROLLUP_SUBMIT_BATCH:case b.UPDATE_CONSENSUS_KEY:case b.SMART_ROLLUP_ADD_MESSAGES:case b.SMART_ROLLUP_ORIGINATE:return Object.assign(Object.assign(Object.assign({},U),w(U)),T(U));case b.TRANSFER_TICKET:return Object.assign(Object.assign(Object.assign(Object.assign({},U),{ticket_amount:`${U.ticket_amount}`}),w(U)),T(U));case b.INCREASE_PAID_STORAGE:return Object.assign(Object.assign(Object.assign(Object.assign({},U),{amount:`${U.amount}`}),w(U)),T(U));case b.BALLOT:if(k===void 0)throw new tr("Failed to get the current voting period index");return Object.assign(Object.assign({},U),{period:k==null?void 0:k.voting_period.index});case b.PROPOSALS:if(k===void 0)throw new tr("Failed to get the current voting period index");return Object.assign(Object.assign({},U),{period:k==null?void 0:k.voting_period.index});default:throw new Pe(U.kind)}}))(s);return{opOb:{branch:d,contents:ze,protocol:y},counter:Y}})}forge({opOb:{branch:t,contents:e,protocol:i},counter:n}){return f(this,void 0,void 0,function*(){return{opbytes:yield this.context.forger.forge({branch:t,contents:e}),opOb:{branch:t,contents:e,protocol:i},counter:n}})}simulate(t){return f(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.runOperation(t),op:t,context:this.context.clone()}})}estimate(t,e){var{fee:i,gasLimit:n,storageLimit:s}=t,o=Tt(t,["fee","gasLimit","storageLimit"]);return f(this,void 0,void 0,function*(){let a=i,c=n,h=s;if(a&&a%1!==0)throw new hn(`Fee value must not be a decimal: ${a}`);if(c&&c%1!==0)throw new hn(`Gas Limit value must not be a decimal: ${c}`);if(h&&h%1!==0)throw new hn(`Storage Limit value must not be a decimal: ${h}`);if(i===void 0||n===void 0||s===void 0){const l=yield e(Object.assign({fee:i,gasLimit:n,storageLimit:s},o));a===void 0&&(a=l.suggestedFeeMutez),c===void 0&&(c=l.gasLimit),h===void 0&&(h=l.storageLimit)}return{fee:a,gasLimit:c,storageLimit:h}})}signAndInject(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.sign(t.opbytes,new Uint8Array([3]));t.opbytes=e.sbytes,t.opOb.signature=e.prefixSig;const i=[],n=yield this.rpc.preapplyOperations([t.opOb]);if(!Array.isArray(n))throw new eg(n);for(let o=0;o<n.length;o++)for(let a=0;a<n[o].contents.length;a++)i.push(n[o].contents[a]);const s=Or(n);if(s.length)throw new Ac(s,"Error occurred during validation simulation of operation");return{hash:yield this.context.injector.inject(t.opbytes),forgedBytes:t,opResponse:i,context:this.context.clone()}})}}const Rc=[b.ACTIVATION,b.ORIGINATION,b.TRANSACTION,b.DELEGATION];class As extends $i{constructor(t,e){super(t),this.estimator=e,this.operations=[]}withTransfer(t){if(G(t.to)!==L.VALID)throw new F(t.to);return this.operations.push(Object.assign({kind:b.TRANSACTION},t)),this}withTransferTicket(t){if(G(t.destination)!==L.VALID)throw new F(t.destination,"param destination");return this.operations.push(Object.assign({kind:b.TRANSFER_TICKET},t)),this}withContractCall(t,e={}){return this.withTransfer(t.toTransferParams(e))}withDelegation(t){if(t.source&&G(t.source)!==L.VALID)throw new F(t.source);if(t.delegate&&G(t.delegate)!==L.VALID)throw new F(t.delegate);return this.operations.push(Object.assign({kind:b.DELEGATION},t)),this}withActivation({pkh:t,secret:e}){if(Nn(t)!==L.VALID)throw new xn(t);return this.operations.push({kind:b.ACTIVATION,pkh:t,secret:e}),this}withOrigination(t){return this.operations.push(Object.assign({kind:b.ORIGINATION},t)),this}withRegisterGlobalConstant(t){return this.operations.push(Object.assign({kind:b.REGISTER_GLOBAL_CONSTANT},t)),this}withIncreasePaidStorage(t){return this.operations.push(Object.assign({kind:b.INCREASE_PAID_STORAGE},t)),this}withTxRollupOrigination(t){return this.operations.push(Object.assign({kind:b.TX_ROLLUP_ORIGINATION},t)),this}withSmartRollupAddMessages(t){return this.operations.push(Object.assign({kind:b.SMART_ROLLUP_ADD_MESSAGES},t)),this}withSmartRollupOriginate(t){return this.operations.push(Object.assign({kind:b.SMART_ROLLUP_ORIGINATE},t)),this}withTxRollupSubmitBatch(t){return this.operations.push(Object.assign({kind:b.TX_ROLLUP_SUBMIT_BATCH},t)),this}getRPCOp(t){return f(this,void 0,void 0,function*(){switch(t.kind){case b.TRANSACTION:return yr(Object.assign({},t));case b.ORIGINATION:return Hr(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case b.DELEGATION:return $r(Object.assign({},t));case b.ACTIVATION:return Object.assign({},t);case b.REGISTER_GLOBAL_CONSTANT:return Ur(Object.assign({},t));case b.INCREASE_PAID_STORAGE:return Fr(Object.assign({},t));case b.TX_ROLLUP_ORIGINATION:return Vr(Object.assign({},t));case b.TX_ROLLUP_SUBMIT_BATCH:return Kr(Object.assign({},t));case b.TRANSFER_TICKET:return Gr(Object.assign({},t));case b.SMART_ROLLUP_ADD_MESSAGES:return zr(Object.assign({},t));case b.SMART_ROLLUP_ORIGINATE:return qr(Object.assign({},t));default:throw new Pe(t.kind)}})}with(t){for(const e of t)switch(e.kind){case b.TRANSACTION:this.withTransfer(e);break;case b.ORIGINATION:this.withOrigination(e);break;case b.DELEGATION:this.withDelegation(e);break;case b.ACTIVATION:this.withActivation(e);break;case b.REGISTER_GLOBAL_CONSTANT:this.withRegisterGlobalConstant(e);break;case b.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;case b.TX_ROLLUP_ORIGINATION:this.withTxRollupOrigination(e);break;case b.TX_ROLLUP_SUBMIT_BATCH:this.withTxRollupSubmitBatch(e);break;case b.TRANSFER_TICKET:this.withTransferTicket(e);break;case b.SMART_ROLLUP_ADD_MESSAGES:this.withSmartRollupAddMessages(e);break;case b.SMART_ROLLUP_ORIGINATE:this.withSmartRollupOriginate(e);break;default:throw new Pe(e.kind)}return this}toPrepare(){return f(this,void 0,void 0,function*(){const t=yield this.signer.publicKeyHash(),e=yield this.signer.publicKey(),i=yield this.estimator.batch(this.operations),n=yield this.isRevealOpNeeded(this.operations,t);let s=n?1:0;const o=[];for(const a of this.operations){if(Sn(a)){const c=yield this.estimate(a,()=>f(this,void 0,void 0,function*(){return i[s]}));o.push(yield this.getRPCOp(Object.assign(Object.assign({},a),c)))}else o.push(Object.assign({},a));s++}if(n){const a={kind:b.REVEAL},c=yield this.estimate(a,()=>f(this,void 0,void 0,function*(){return i[0]}));o.unshift(yield Ge(Object.assign({},c),t,e))}return o})}send(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.signer.publicKey(),n=yield this.estimator.batch(this.operations),s=yield this.isRevealOpNeeded(this.operations,e);let o=s?1:0;const a=[];for(const Y of this.operations){if(Sn(Y)){const T=yield this.estimate(Y,()=>f(this,void 0,void 0,function*(){return n[o]}));a.push(yield this.getRPCOp(Object.assign(Object.assign({},Y),T)))}else a.push(Object.assign({},Y));o++}if(s){const Y={kind:b.REVEAL},T=yield this.estimate(Y,()=>f(this,void 0,void 0,function*(){return n[0]}));a.unshift(yield Ge(Object.assign({},T),e,i))}const c=t&&t.source||e,h=yield this.prepareOperation({operation:a,source:c}),l=yield this.forge(h),{hash:d,context:y,forgedBytes:v,opResponse:k}=yield this.signAndInject(l);return new sg(d,a,c,v,k,y)})}}class og{constructor(t,e){this.context=t,this.estimator=e}batch(t){const e=new As(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}const ag=(r,{ALLOCATION_BURN:t,ORIGINATION_BURN:e}={ALLOCATION_BURN:257,ORIGINATION_BURN:257})=>{A.config({DECIMAL_PLACES:0,ROUNDING_MODE:A.ROUND_UP});const i=ce({contents:r});let n=new A(0),s=new A(0),o=new A(0),a=new A(0),c=new A(0),h=new A(0);return i.forEach(l=>{o=o.plus(l.fee||0),a=a.plus(Array.isArray(l.originated_contracts)?l.originated_contracts.length*e:0),c=c.plus("allocated_destination_contract"in l?t:0),n=n.plus(l.consumed_milligas||0),h=h.plus("paid_storage_size_diff"in l&&Number(l.paid_storage_size_diff)||0)}),s=s.plus(c).plus(a).plus(h),{totalFee:o,totalMilliGas:n,totalGas:n.dividedBy(1e3),totalStorage:s,totalAllocationBurn:c,totalOriginationBurn:a,totalPaidStorageDiff:h,totalStorageBurn:new A(s.multipliedBy(Gf))}},cg=60;class Ir{constructor(t,e,i){if(this.opHash=t,this.context=e,this._newHead$=i,this._operationResult=new jr(1),this._includedInBlock=new jr(1),this._included=!1,this.newHead$=this._newHead$.pipe(oe(n=>{var s,o;const a=(o=(s=this.lastHead)===null||s===void 0?void 0:s.header.level)!==null&&o!==void 0?o:n.header.level-1;return Gn(a+1,n.header.level-a-1).pipe(Qr(c=>this.context.readProvider.getBlock(c)),Na(n))}),wi(n=>this.lastHead=n),yn(1),Dr()),this.confirmed$=this.newHead$.pipe(er(n=>{for(const s of n.operations)for(const o of s)if(o.hash===this.opHash)return this._included=!0,this._includedInBlock.next(n),this._operationResult.next(o.contents),n}),_i(n=>typeof n<"u"),_e(),yn(1),Dr()),Qo(this.opHash)!==L.VALID)throw new ta(this.opHash);this.confirmed$.pipe(_e(),Fn(()=>Sr(void 0))).subscribe()}operationResults(){return f(this,void 0,void 0,function*(){return this._operationResult.pipe(_e()).toPromise()})}receipt(){return f(this,void 0,void 0,function*(){return ag(yield this.operationResults())})}getCurrentConfirmation(){return f(this,void 0,void 0,function*(){return this._included?po([this._includedInBlock,ir(this.context.readProvider.getBlock("head"))]).pipe(er(([t,e])=>e.header.level-t.header.level+1),_e()).toPromise():0})}isInCurrentBranch(t="head"){return f(this,void 0,void 0,function*(){if(!this._included)return!0;const e=yield this.context.readProvider.getBlockLevel(t),i=yield this._includedInBlock.pipe(_e()).toPromise(),n=e-i.header.level;if(n<=0)return!0;const s=Math.min(i.header.level+n,i.header.level+cg);return new Set(yield this.context.readProvider.getLiveBlocks(s)).has(i.hash)})}confirmationObservable(t){if(typeof t<"u"&&t<1)throw new Oc("Confirmation count must be at least 1");const{defaultConfirmationCount:e}=this.context.config,i=t!==void 0?t:e;if(i===void 0)throw new ig("Default confirmation count can not be undefined!");return po([this._includedInBlock,this.newHead$]).pipe(Ia(([,n],[,s])=>n.hash===s.hash),er(([n,s])=>({block:s,expectedConfirmation:i,currentConfirmation:s.header.level-n.header.level+1,completed:s.header.level-n.header.level>=i-1,isInCurrentBranch:()=>this.isInCurrentBranch(s.hash)})),wh(({completed:n})=>!n,!0))}confirmation(t){return this.confirmationObservable(t).toPromise()}}class ug extends Ir{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e,this.getOriginatedContractAddresses=()=>f(this,void 0,void 0,function*(){const s=(yield this.operationResults()).filter(a=>a.kind==="origination");let o=[];for(const a of s)a.metadata.operation_result.originated_contracts&&(o=[...o,...a.metadata.operation_result.originated_contracts]);return o})}revealOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.REVEAL)})}status(){return f(this,void 0,void 0,function*(){return this._included?(yield this.operationResults()).filter(e=>Rc.indexOf(e.kind)!==-1).map(e=>Tr(e)?e.metadata.operation_result.status:"unknown")[0]||"unknown":"pending"})}}class lg extends Ir{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}revealOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.REVEAL)})}delegationOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.DELEGATION)})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.delegationOperation();return t?t.metadata.operation_result.status:"unknown"})}}class hg extends Ir{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}revealOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.REVEAL)})}increasePaidStorageOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.INCREASE_PAID_STORAGE)})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.increasePaidStorageOperation();return t?t.metadata.operation_result.status:"unknown"})}}class dg extends Ir{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}originationOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();return Go(t,b.ORIGINATION)})}revealOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();return Go(t,b.REVEAL)})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.originationOperation();return t?t.metadata.operation_result.status:"unknown"})}contract(){return f(this,void 0,void 0,function*(){const t=yield this.originationOperation(),e=((t==null?void 0:t.metadata.operation_result.originated_contracts)||[])[0];return this.context.wallet.at(e)})}}class pg extends Ir{constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}revealOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.REVEAL)})}transactionOperation(){return f(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===b.TRANSACTION)})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.transactionOperation();return t?t.metadata.operation_result.status:"unknown"})}}function fg(r){return function(e){return new Di(null).pipe(La(r,Vn(new Error("Confirmation polling timed out"))),ji(()=>e))}}const gg=(r,t,e)=>r.pipe(fg(t.config.confirmationPollingTimeoutSecond*1e3),yn(1),Dr());class mg{constructor(t){this.context=t,this.sharedHeadObs=Ta(()=>gc(this.context.stream.subscribeBlock("head")))}createNewHeadObservable(){return f(this,void 0,void 0,function*(){return gg(this.sharedHeadObs,this.context)})}createPastBlockWalker(t,e=1){return ir(this.context.readProvider.getBlock(t)).pipe(oe(i=>e===1?Sr(i):Gn(i.header.level,e-1).pipe(mh(i),Qr(n=>f(this,void 0,void 0,function*(){return this.context.readProvider.getBlock(typeof n=="number"?n:n.header.level)})))))}createHeadObservableFromConfig({blockIdentifier:t}){return f(this,void 0,void 0,function*(){const e=[];return t&&e.push(this.createPastBlockWalker(t)),e.push(yield this.createNewHeadObservable()),vi(...e)})}createOperation(t,e={}){return f(this,void 0,void 0,function*(){return new Ir(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createBatchOperation(t,e={}){return f(this,void 0,void 0,function*(){return new ug(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createTransactionOperation(t,e={}){return f(this,void 0,void 0,function*(){return new pg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createDelegationOperation(t,e={}){return f(this,void 0,void 0,function*(){return new lg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createOriginationOperation(t,e={}){return f(this,void 0,void 0,function*(){return new dg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createIncreasePaidStorageOperation(t,e={}){return f(this,void 0,void 0,function*(){return new hg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}}class yg extends $i{constructor(t){super(t)}getBalance(t){return f(this,void 0,void 0,function*(){if(G(t)!==L.VALID)throw new F(t);return this.context.readProvider.getBalance(t,"head")})}getDelegate(t){return f(this,void 0,void 0,function*(){if(G(t)!==L.VALID)throw new F(t);return this.context.readProvider.getDelegate(t,"head")})}activate(t,e){return f(this,void 0,void 0,function*(){if(Nn(t)!==L.VALID)throw new xn(t);const i={kind:b.ACTIVATION,pkh:t,secret:e},n=yield this.prepareOperation({operation:[i],source:t}),s=yield this.forge(n),o=`${s.opbytes}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`;return new gt(yield this.rpc.injectOperation(o),Object.assign(Object.assign({},s),{opbytes:o}),[],this.context.clone())})}}const ai=100,bg=1,Eg=.1,Fo=100;class dt{constructor(t,e,i,n,s=ai){this._milligasLimit=t,this._storageLimit=e,this.opSize=i,this.minimalFeePerStorageByteMutez=n,this.baseFeeMutez=s}get burnFeeMutez(){return this.roundUp(Number(this.storageLimit)*Number(this.minimalFeePerStorageByteMutez))}get storageLimit(){const t=Math.max(Number(this._storageLimit),0);return t>0?t:0}get gasLimit(){return this.roundUp(Number(this._milligasLimit)/1e3+Fo)}get operationFeeMutez(){return(Number(this._milligasLimit)/1e3+Fo)*Eg+Number(this.opSize)*bg}roundUp(t){return Math.ceil(Number(t))}get minimalFeeMutez(){return this.roundUp(ai+this.operationFeeMutez)}get suggestedFeeMutez(){return this.roundUp(this.operationFeeMutez+ai*2)}get usingBaseFeeMutez(){return Math.max(Number(this.baseFeeMutez),ai)+this.roundUp(this.operationFeeMutez)}get totalCost(){return this.minimalFeeMutez+this.burnFeeMutez}get consumedMilligas(){return Number(this._milligasLimit)}static createEstimateInstanceFromProperties(t){let e=0,i=0,n=0,s=0,o;return t.forEach(a=>{e+=a.milligasLimit,i+=a.storageLimit,n+=a.opSize,s=Math.max(a.minimalFeePerStorageByteMutez,s),a.baseFeeMutez&&(o=o?o+a.baseFeeMutez:a.baseFeeMutez)}),new dt(e,i,n,s,o)}static createArrayEstimateInstancesFromProperties(t){return t.map(e=>new dt(e.milligasLimit,e.storageLimit,e.opSize,e.minimalFeePerStorageByteMutez,e.baseFeeMutez))}}class zo extends Error{constructor(){super("Unable to estimate the reveal operation, the public key is unknown"),this.name="Reveal Estimate Error"}}const tt=(r,t)=>({fee:typeof r.fee>"u"?t.fee:r.fee,gasLimit:typeof r.gasLimit>"u"?t.gasLimit:r.gasLimit,storageLimit:typeof r.storageLimit>"u"?t.storageLimit:r.storageLimit}),vg="edsigtkpiSSschcaCt9pUVrpNPf7TTcgvgDEDD6NCEHMy8NNQJCGnMfLZzYoQj74yLjo9wx6MPVV29CvVzgi7qEcEUok3k7AuMg";class _g extends $i{constructor(){super(...arguments),this.ALLOCATION_STORAGE=257,this.ORIGINATION_STORAGE=257,this.OP_SIZE_REVEAL=128}getKeys(){return f(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{publicKeyHash:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}getAccountLimits(t,e,i){return f(this,void 0,void 0,function*(){const n=yield this.context.readProvider.getBalance(t,"head"),{hard_gas_limit_per_operation:s,hard_gas_limit_per_block:o,hard_storage_limit_per_operation:a,cost_per_byte:c}=e;return{fee:0,gasLimit:i?Math.floor(this.ajustGasForBatchOperation(o,s,i).toNumber()):s.toNumber(),storageLimit:Math.floor(A.min(n.dividedBy(c),a).toNumber())}})}ajustGasForBatchOperation(t,e,i){return A.min(e,t.div(i+1))}getEstimationPropertiesFromOperationContent(t,e,i,n){const s=ce({contents:[t]});let o=0,a=0;return s.forEach(c=>{a+="originated_contracts"in c&&typeof c.originated_contracts<"u"?c.originated_contracts.length*this.ORIGINATION_STORAGE:0,a+="allocated_destination_contract"in c?this.ALLOCATION_STORAGE:0,o+=Number(c.consumed_milligas)||0,a+="paid_storage_size_diff"in c&&Number(c.paid_storage_size_diff)||0,a+="storage_size"in c&&"global_address"in c&&Number(c.storage_size)||0,a+="originated_rollup"in c?n:0,a+="genesis_commitment_hash"in c?Number(c.size):0}),Sn(t)?{milligasLimit:o||0,storageLimit:Number(a||0),opSize:e,minimalFeePerStorageByteMutez:i.toNumber()}:{milligasLimit:0,storageLimit:0,opSize:e,minimalFeePerStorageByteMutez:i.toNumber(),baseFeeMutez:0}}prepareEstimate(t,e,i){return f(this,void 0,void 0,function*(){const n=yield this.prepareOperation(t,i),{opbytes:s,opOb:{branch:o,contents:a}}=yield this.forge(n),c={operation:{branch:o,contents:a,signature:vg},chain_id:yield this.context.readProvider.getChainId()},{opResponse:h}=yield this.simulate(c),{cost_per_byte:l,tx_rollup_origination_size:d}=e,y=[...Or(h,"backtracked"),...Or(h)];if(y.length)throw new Ac(y,"Error occurred during estimation");let v=1;return Array.isArray(t.operation)&&t.operation.length>1&&(v=h.contents[0].kind==="reveal"?t.operation.length-1:t.operation.length),h.contents.map(k=>this.getEstimationPropertiesFromOperationContent(k,k.kind==="reveal"?this.OP_SIZE_REVEAL/2:s.length/2/v,l,d??0))})}originate(t){var{fee:e,storageLimit:i,gasLimit:n}=t,s=Tt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{publicKeyHash:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield Hr(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},s),tt({fee:e,storageLimit:i,gasLimit:n},c)))),l=yield this.isRevealOpNeeded([h],o),d=l?yield this.addRevealOp([h],o):h,y=yield this.prepareEstimate({operation:d,source:o},a,o);return l&&y.shift(),dt.createEstimateInstanceFromProperties(y)})}transfer(t){var{fee:e,storageLimit:i,gasLimit:n}=t,s=Tt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){if(G(s.to)!==L.VALID)throw new F(s.to);if(s.source&&G(s.source)!==L.VALID)throw new F(s.source);const o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield yr(Object.assign(Object.assign({},s),tt({fee:e,storageLimit:i,gasLimit:n},c))),l=yield this.isRevealOpNeeded([h],o),d=l?yield this.addRevealOp([h],o):h,y=yield this.prepareEstimate({operation:d,source:o},a,o);return l&&y.shift(),dt.createEstimateInstanceFromProperties(y)})}transferTicket(t){var e,{fee:i,storageLimit:n,gasLimit:s}=t,o=Tt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){if(G(o.destination)!==L.VALID)throw new F(o.destination,"param destination");if(o.source&&G(o.source)!==L.VALID)throw new F((e=o.source)!==null&&e!==void 0?e:"","param source");const a=(yield this.getKeys()).publicKeyHash,c=yield this.context.readProvider.getProtocolConstants("head"),h=yield this.getAccountLimits(a,c),l=yield Gr(Object.assign(Object.assign({},o),tt({fee:i,storageLimit:n,gasLimit:s},h))),d=yield this.isRevealOpNeeded([l],a),y=d?yield this.addRevealOp([l],a):l,v=yield this.prepareEstimate({operation:y,source:a},c,a);return d&&v.shift(),dt.createEstimateInstanceFromProperties(v)})}setDelegate(t){var{fee:e,gasLimit:i,storageLimit:n}=t,s=Tt(t,["fee","gasLimit","storageLimit"]);return f(this,void 0,void 0,function*(){if(s.source&&G(s.source)!==L.VALID)throw new F(s.source);if(s.delegate&&G(s.delegate)!==L.VALID)throw new F(s.delegate);const o=(yield this.getKeys()).publicKeyHash,a=s.source||o,c=yield this.context.readProvider.getProtocolConstants("head"),h=yield this.getAccountLimits(a,c),l=yield $r(Object.assign(Object.assign({},s),tt({fee:e,storageLimit:n,gasLimit:i},h))),d=yield this.isRevealOpNeeded([l],o),y=d?yield this.addRevealOp([l],o):l,v=yield this.prepareEstimate({operation:y,source:o},c,o);return d&&v.shift(),dt.createEstimateInstanceFromProperties(v)})}batch(t){return f(this,void 0,void 0,function*(){const{publicKeyHash:e}=yield this.getKeys();let i=[];const n=yield this.context.readProvider.getProtocolConstants("head"),s=yield this.getAccountLimits(e,n,t.length);for(const c of t)switch(c.kind){case b.TRANSACTION:i.push(yield yr(Object.assign(Object.assign({},c),tt(c,s))));break;case b.ORIGINATION:i.push(yield Hr(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},c),tt(c,s)))));break;case b.DELEGATION:i.push(yield $r(Object.assign(Object.assign({},c),tt(c,s))));break;case b.ACTIVATION:i.push(Object.assign(Object.assign({},c),s));break;case b.REGISTER_GLOBAL_CONSTANT:i.push(yield Ur(Object.assign(Object.assign({},c),tt(c,s))));break;case b.TX_ROLLUP_ORIGINATION:i.push(yield Vr(Object.assign(Object.assign({},c),tt(c,s))));break;case b.TX_ROLLUP_SUBMIT_BATCH:i.push(yield Kr(Object.assign(Object.assign({},c),tt(c,s))));break;case b.TRANSFER_TICKET:i.push(yield Gr(Object.assign(Object.assign({},c),tt(c,s))));break;case b.INCREASE_PAID_STORAGE:i.push(yield Fr(Object.assign(Object.assign({},c),tt(c,s))));break;case b.SMART_ROLLUP_ADD_MESSAGES:i.push(yield zr(Object.assign(Object.assign({},c),tt(c,s))));break;case b.SMART_ROLLUP_ORIGINATE:{const h=yield this.rpc.getOriginationProof({kernel:c.kernel,kind:c.pvmKind});i.push(yield qr(Object.assign(Object.assign(Object.assign({},c),{originationProof:h}),tt(c,s))));break}default:throw new Pe(c.kind)}i=(yield this.isRevealOpNeeded(i,e))?yield this.addRevealOp(i,e):i;const a=yield this.prepareEstimate({operation:i,source:e},n,e);return dt.createArrayEstimateInstancesFromProperties(a)})}registerDelegate(t){return f(this,void 0,void 0,function*(){const e=(yield this.getKeys()).publicKeyHash,i=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.getAccountLimits(e,i),s=yield Ec(Object.assign(Object.assign({},t),n),e),o=yield this.isRevealOpNeeded([s],e),a=o?yield this.addRevealOp([s],e):s,c=yield this.prepareEstimate({operation:a,source:e},i,e);return o&&c.shift(),dt.createEstimateInstanceFromProperties(c)})}reveal(t){return f(this,void 0,void 0,function*(){const{publicKeyHash:e,publicKey:i}=yield this.getKeys();if(!i)throw new zo;if(yield this.isAccountRevealRequired(e)){const n=yield this.context.readProvider.getProtocolConstants("head"),s=yield this.getAccountLimits(e,n),o=yield Ge(Object.assign(Object.assign({},t),s),e,i),a=yield this.prepareEstimate({operation:o,source:e},n,e);return dt.createEstimateInstanceFromProperties(a)}})}registerGlobalConstant(t){var{fee:e,storageLimit:i,gasLimit:n}=t,s=Tt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield Ur(Object.assign(Object.assign({},s),tt({fee:e,storageLimit:i,gasLimit:n},c))),l=yield this.isRevealOpNeeded([h],o),d=l?yield this.addRevealOp([h],o):h,y=yield this.prepareEstimate({operation:d,source:o},a,o);return l&&y.shift(),dt.createEstimateInstanceFromProperties(y)})}increasePaidStorage(t){return f(this,void 0,void 0,function*(){const{fee:e,storageLimit:i,gasLimit:n}=t,s=Tt(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield Fr(Object.assign(Object.assign({},s),tt({fee:e,storageLimit:i,gasLimit:n},c))),l=yield this.isRevealOpNeeded([h],o),d=l?yield this.addRevealOp([h],o):h,y=yield this.prepareEstimate({operation:d,source:o},a,o);return l&&y.shift(),dt.createEstimateInstanceFromProperties(y)})}txRollupOriginate(t){return f(this,void 0,void 0,function*(){t=t||{};const{fee:e,storageLimit:i,gasLimit:n}=t,s=Tt(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield Vr(Object.assign(Object.assign({},s),tt({fee:e,storageLimit:i,gasLimit:n},c))),l=yield this.isRevealOpNeeded([h],o),d=l?yield this.addRevealOp([h],o):h,y=yield this.prepareEstimate({operation:d,source:o},a,o);return l&&y.shift(),dt.createEstimateInstanceFromProperties(y)})}txRollupSubmitBatch(t){return f(this,void 0,void 0,function*(){const{fee:e,storageLimit:i,gasLimit:n}=t,s=Tt(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield Kr(Object.assign(Object.assign({},s),tt({fee:e,storageLimit:i,gasLimit:n},c))),l=yield this.isRevealOpNeeded([h],o),d=l?yield this.addRevealOp([h],o):h,y=yield this.prepareEstimate({operation:d,source:o},a,o);return l&&y.shift(),dt.createEstimateInstanceFromProperties(y)})}updateConsensusKey(t){return f(this,void 0,void 0,function*(){const{fee:e,storageLimit:i,gasLimit:n}=t,s=Tt(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield _s(Object.assign(Object.assign({},s),tt({fee:e,storageLimit:i,gasLimit:n},c))),l=yield this.isRevealOpNeeded([h],o),d=l?yield this.addRevealOp([h],o):h,y=yield this.prepareEstimate({operation:d,source:o},a,o);return l&&y.shift(),dt.createEstimateInstanceFromProperties(y)})}smartRollupAddMessages(t){return f(this,void 0,void 0,function*(){const{fee:e,storageLimit:i,gasLimit:n}=t,s=Tt(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),h=yield zr(Object.assign(Object.assign({},s),tt({fee:e,storageLimit:i,gasLimit:n},c))),l=yield this.isRevealOpNeeded([h],o),d=l?yield this.addRevealOp([h],o):h,y=yield this.prepareEstimate({operation:d,source:o},a,o);return l&&y.shift(),dt.createEstimateInstanceFromProperties(y)})}smartRollupOriginate(t){return f(this,void 0,void 0,function*(){const{fee:e,storageLimit:i,gasLimit:n}=t,s=Tt(t,["fee","storageLimit","gasLimit"]),o=(yield this.getKeys()).publicKeyHash,a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.rpc.getOriginationProof({kind:t.pvmKind,kernel:t.kernel}),h=yield this.getAccountLimits(o,a),l=yield qr(Object.assign(Object.assign(Object.assign({},s),{originationProof:c}),tt({fee:e,storageLimit:i,gasLimit:n},h))),d=yield this.isRevealOpNeeded([l],o),y=d?yield this.addRevealOp([l],o):l,v=yield this.prepareEstimate({operation:y,source:o},a,o);return d&&v.shift(),dt.createEstimateInstanceFromProperties(v)})}contractCall(t){return f(this,void 0,void 0,function*(){const e=t.toTransferParams(),{fee:i,storageLimit:n,gasLimit:s}=e,o=Tt(e,["fee","storageLimit","gasLimit"]),a=(yield this.getKeys()).publicKeyHash,c=yield this.context.readProvider.getProtocolConstants("head"),h=yield this.getAccountLimits(a,c),l=yield yr(Object.assign(Object.assign({},o),tt({fee:i,storageLimit:n,gasLimit:s},h))),d=yield this.isRevealOpNeeded([l],a),y=d?yield this.addRevealOp([l],a):l,v=yield this.prepareEstimate({operation:y,source:a},c,a);return d&&v.shift(),dt.createEstimateInstanceFromProperties(v)})}addRevealOp(t,e){return f(this,void 0,void 0,function*(){const{publicKey:i}=yield this.getKeys();if(!i)throw new zo;return t.unshift(yield Ge(Object.assign({fee:Ve.REVEAL,gasLimit:Ue.REVEAL,storageLimit:Ke.REVEAL}),e,yield this.signer.publicKey())),t})}}class qo extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="delegation"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get delegate(){return this.params.delegate}get isRegisterOperation(){return this.delegate===this.source}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get consumedGas(){return A.config({DECIMAL_PLACES:0,ROUNDING_MODE:A.ROUND_UP}),this.consumedMilliGas?new A(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class wg extends gt{constructor(t,e,i,n,s,o){super(t,i,n,s),this.params=e,this.contractProvider=o;const a=this.operationResults&&this.operationResults.originated_contracts;Array.isArray(a)&&(this.contractAddress=a[0])}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="origination"),e=t&&Tr(t)&&t.metadata.operation_result;return e||void 0}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get consumedGas(){return A.config({DECIMAL_PLACES:0,ROUNDING_MODE:A.ROUND_UP}),this.consumedMilliGas?new A(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get storageDiff(){const t=this.operationResults&&this.operationResults.paid_storage_size_diff;return t||void 0}get storageSize(){const t=this.operationResults&&this.operationResults.storage_size;return t||void 0}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}contract(t,e){return f(this,void 0,void 0,function*(){if(!this.contractAddress)throw new rg("No contract was originated in this operation");return yield this.confirmation(t,e),this.contractProvider.at(this.contractAddress)})}}class Ag extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i,this.globalConstantHash=this.operationResults&&this.operationResults.global_address}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="register_global_constant"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get registeredExpression(){return this.params.value}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedGas(){return A.config({DECIMAL_PLACES:0,ROUNDING_MODE:A.ROUND_UP}),this.consumedMilliGas?new A(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class Og extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="reveal");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get publicKey(){return this.params.public_key}sumProp(t,e){return t.reduce((i,n)=>e in n?Number(n[e])+i:i,0)}get consumedGas(){return A.config({DECIMAL_PLACES:0,ROUNDING_MODE:A.ROUND_UP}),new A(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(ce({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(ce({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(ce({contents:this.operationResults}),"storage_size"))}get errors(){return Or({contents:this.operationResults})}}class Rg extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="transaction");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get amount(){return new A(this.params.amount)}get destination(){return this.params.destination}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}sumProp(t,e){return t.reduce((i,n)=>e in n?Number(n[e])+i:i,0)}get consumedGas(){return A.config({DECIMAL_PLACES:0,ROUNDING_MODE:A.ROUND_UP}),new A(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(ce({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(ce({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(ce({contents:this.operationResults}),"storage_size"))}get errors(){return Or({contents:this.operationResults})}}class Sg{constructor(t,e,i,n,s,o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=i,this.name=n,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}validateArgs(t,e,i){const n=e.ExtractSignatures();if(!n.find(s=>s.length===t.length))throw new mc(i,n,t)}get schema(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}getSignature(){if(this.isAnonymous){const t=this.parameterSchema.ExtractSignatures().find(e=>e[0]===this.name);if(t)return t.shift(),t}else{const t=this.parameterSchema.ExtractSignatures();return t.length==1?t[0]:t}}send(t={}){return this.provider instanceof Ui?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:i,source:n,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:n,gasLimit:e,storageLimit:i,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:hr,value:this.isAnonymous?this.parameterSchema.Encode(this.name,...this.args):this.parameterSchema.Encode(...this.args)}}}}class Pg{constructor(t,e){this.id=t,this.provider=e}getSaplingDiff(t){return f(this,void 0,void 0,function*(){return this.provider.getSaplingDiffByID(this.id.toString(),t)})}getId(){return this.id.toString()}}class Tg{constructor(t,e){this.walletProvider=t,this.context=e,this.operations=[]}withTransfer(t){if(G(t.to)!==L.VALID)throw new F(t.to);return this.operations.push(Object.assign({kind:b.TRANSACTION},t)),this}withContractCall(t,e={}){return this.withTransfer(t.toTransferParams(e))}withDelegation(t){if(t.delegate&&G(t.delegate)!==L.VALID)throw new F(t.delegate);return this.operations.push(Object.assign({kind:b.DELEGATION},t)),this}withOrigination(t){return this.operations.push(Object.assign({kind:b.ORIGINATION},t)),this}withIncreasePaidStorage(t){if(G(t.destination)!==L.VALID)throw new F(t.destination);return this.operations.push(Object.assign({kind:b.INCREASE_PAID_STORAGE},t)),this}mapOperation(t){return f(this,void 0,void 0,function*(){switch(t.kind){case b.TRANSACTION:return this.walletProvider.mapTransferParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t}));case b.ORIGINATION:return this.walletProvider.mapOriginateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return this.context.parser.prepareCodeOrigination(Object.assign({},t))}));case b.DELEGATION:return this.walletProvider.mapDelegateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t}));case b.INCREASE_PAID_STORAGE:return this.walletProvider.mapIncreasePaidStorageWalletParams(()=>f(this,void 0,void 0,function*(){return t}));default:throw new Pe(t.kind)}})}with(t){for(const e of t)switch(e.kind){case b.TRANSACTION:this.withTransfer(e);break;case b.ORIGINATION:this.withOrigination(e);break;case b.DELEGATION:this.withDelegation(e);break;case b.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;default:throw new Pe(e.kind)}return this}send(){return f(this,void 0,void 0,function*(){const t=[];for(const i of this.operations)t.push(yield this.mapOperation(i));const e=yield this.walletProvider.sendOperations(t);return this.context.operationFactory.createBatchOperation(e)})}}class Ui{constructor(t){this.context=t,this.walletCommand=e=>({send:e})}get walletProvider(){return this.context.walletProvider}pkh({forceRefetch:t}={}){return f(this,void 0,void 0,function*(){return(!this._pkh||t)&&(this._pkh=yield this.walletProvider.getPKH()),this._pkh})}originate(t){return this.walletCommand(()=>f(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapOriginateParamsToWalletParams(()=>this.context.parser.prepareCodeOrigination(Object.assign({},t))),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createOriginationOperation(i)}))}setDelegate(t){if(t.delegate&&G(t.delegate)!==L.VALID)throw new F(t.delegate);return this.walletCommand(()=>f(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createDelegationOperation(i)}))}registerDelegate(){return this.walletCommand(()=>f(this,void 0,void 0,function*(){const t=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return{delegate:yield this.pkh()}})),e=yield this.walletProvider.sendOperations([t]);return this.context.operationFactory.createDelegationOperation(e)}))}transfer(t){if(G(t.to)!==L.VALID)throw new F(t.to);return this.walletCommand(()=>f(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapTransferParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createTransactionOperation(i)}))}increasePaidStorage(t){if(G(t.destination)!==L.VALID)throw new F(t.destination);return this.walletCommand(()=>f(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapIncreasePaidStorageWalletParams(()=>f(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createIncreasePaidStorageOperation(i)}))}batch(t){const e=new Tg(this.walletProvider,this.context);return Array.isArray(t)&&e.with(t),e}at(t,e=i=>i){return f(this,void 0,void 0,function*(){if(dr(t)!==L.VALID)throw new pr(t);const i=this.context.withExtensions().rpc,n=this.context.withExtensions().readProvider,s=yield n.getScript(t,"head"),o=yield n.getEntrypoints(t),a=new Pc(t,s,this,this.context.contract,o,i,n);return e(a,this.context)})}}class Sc{constructor(t){this.context=t}getPKH(){return f(this,void 0,void 0,function*(){return this.context.signer.publicKeyHash()})}mapTransferParamsToWalletParams(t){return f(this,void 0,void 0,function*(){return oi(yield t(),b.TRANSACTION)})}mapOriginateParamsToWalletParams(t){return f(this,void 0,void 0,function*(){return oi(yield t(),b.ORIGINATION)})}mapDelegateParamsToWalletParams(t){return f(this,void 0,void 0,function*(){return oi(yield t(),b.DELEGATION)})}mapIncreasePaidStorageWalletParams(t){return f(this,void 0,void 0,function*(){return oi(yield t(),b.INCREASE_PAID_STORAGE)})}sendOperations(t){return f(this,void 0,void 0,function*(){return(yield this.context.batch.batch(t).send()).hash})}}class Ig{constructor(t,e,i,n,s="unit",o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=i,this.name=n,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}getSignature(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}send(t={}){return this.provider instanceof Ui?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:i,source:n,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:n,gasLimit:e,storageLimit:i,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:hr,value:this.isAnonymous?this.parameterSchema.EncodeObject({[this.name]:this.args}):this.parameterSchema.EncodeObject(this.args)}}}}class Ng{constructor(t,e,i,n,s,o="Unit"){this._rpc=t,this._readProvider=e,this._contractAddress=i,this._smartContractViewSchema=n,this._contractStorageType=s,this._args=o}getSignature(){return{parameter:this._smartContractViewSchema.extractArgsSchema(),result:this._smartContractViewSchema.extractResultSchema()}}executeView(t){return f(this,void 0,void 0,function*(){this.verifyContextExecution(t);const e=yield this._readProvider.getChainId(),i=this.transformArgsToMichelson(),n={contract:this._contractAddress,view:this._smartContractViewSchema.viewName,input:i,chain_id:e,source:t.viewCaller};return t.source&&(n.payer=t.source),this.executeViewAndDecodeResult(n)})}verifyContextExecution(t){if(t.source&&G(t.source)!==L.VALID)throw new Ko(`The source account who initialized the view execution is invalid: ${t.source}.`);if(!t.viewCaller||G(t.viewCaller)!==L.VALID)throw new Ko(`The contract which is the caller of view is invalid: ${t.viewCaller}.`)}transformArgsToMichelson(){try{return this._smartContractViewSchema.encodeViewArgs(this._args)}catch(t){throw new zf(this._smartContractViewSchema.viewName,this.getSignature(),this._args,t)}}adaptViewCodeToContext(t,e,i){const n={BALANCE:[{prim:"PUSH",args:[{prim:"mutez"},{int:i}]}],SENDER:[{prim:"PUSH",args:[{prim:"address"},{string:e}]}],SELF_ADDRESS:[{prim:"PUSH",args:[{prim:"address"},{string:this._contractAddress}]}],AMOUNT:[{prim:"PUSH",args:[{prim:"mutez"},{int:"0"}]}]};return t.forEach((s,o)=>{s.prim in n&&(t[o]=Object(n)[s.prim]),s.args&&s.args.length!==0?this.adaptViewCodeToContext(s.args,e,i):Array.isArray(s)&&this.adaptViewCodeToContext(s,e,i)}),t}executeViewAndDecodeResult(t){return f(this,void 0,void 0,function*(){let e;try{e=(yield this._rpc.runScriptView(t)).data}catch(i){const n=Wf(i);throw n?new qf(`The simulation of the on-chain view named ${this._smartContractViewSchema.viewName} failed with: ${JSON.stringify(n)}`,this._smartContractViewSchema.viewName,n,i):i}return this._smartContractViewSchema.decodeViewResult(e)})}}class xg{constructor(t,e){this.provider=t,this.contractAddress=e}createContractMethodFlatParams(t,e,i,n=!0,s=!1){return new Sg(this.provider,this.contractAddress,t,e,i,n,s)}createContractMethodObjectParam(t,e,i,n=!0,s=!1){return new Ig(this.provider,this.contractAddress,t,e,i,n,s)}createContractViewObjectParam(t,e,i,n,s){return new Ng(t,e,this.contractAddress,i,n,s)}}const hr="default";class Lg{constructor(t,e,i,n,s,o,a){this.currentContract=t,this.name=e,this.callbackParametersSchema=i,this.parameterSchema=n,this.args=s,this.rpc=o,this.readProvider=a}read(t){return f(this,void 0,void 0,function*(){if(dr(t??"")==L.VALID)throw new Cn("Since version 12, the lambda view no longer depends on a lambda contract. The read method no longer accepts a contract address as a parameter.");if(t&&Zo(t)!==L.VALID)throw new zc(t);const e=this.parameterSchema.Encode(...this.args),i=yield this.rpc.runView({contract:this.currentContract.address,entrypoint:this.name,input:e,chain_id:t||(yield this.readProvider.getChainId())});return this.callbackParametersSchema.Execute(i.data)})}}const Cg=(r,t,e)=>{const i=t.ExtractSignatures();if(!i.find(n=>n.length===r.length))throw new mc(e,i,r)},Mg=r=>{let t=!1;if("prim"in r&&r.prim==="pair"&&r.args){const e=r.args[r.args.length-1];"prim"in e&&e.prim==="contract"&&(t=!0)}return t};class Pc{constructor(t,e,i,n,s,o,a){this.address=t,this.script=e,this.storageProvider=n,this.entrypoints=s,this.rpc=o,this.readProvider=a,this.methods={},this.methodsObject={},this.views={},this.contractViews={},this.contractMethodFactory=new xg(i,t),this.schema=Lt.fromRPCResponse({script:this.script}),this.parameterSchema=ur.fromRPCResponse({script:this.script}),this.viewSchema=zn.fromRPCResponse({script:this.script}),this.viewSchema.length!==0&&this._initializeOnChainViews(this,o,this.readProvider,this.viewSchema),this._initializeMethods(this,this.entrypoints.entrypoints,this.rpc,this.readProvider)}_initializeMethods(t,e,i,n){const s=this.parameterSchema,o=Object.keys(e);if(s.isMultipleEntryPoint)o.forEach(c=>{const h=new ur(e[c]);if(this.methods[c]=function(...l){return t.contractMethodFactory.createContractMethodFlatParams(h,c,l)},this.methodsObject[c]=function(l){return t.contractMethodFactory.createContractMethodObjectParam(h,c,l)},Mg(e[c])){const l=function(...d){const y=e[c].args[0],v=new ur(y),k=e[c].args[1].args[0],Y=new ur(k);return Cg(d,v,c),new Lg(t,c,Y,v,d,i,n)};this.views[c]=l}}),Object.keys(s.ExtractSchema()).filter(c=>Object.keys(e).indexOf(c)===-1).forEach(c=>{this.methods[c]=function(...h){return t.contractMethodFactory.createContractMethodFlatParams(s,c,h,!1,!0)},this.methodsObject[c]=function(h){return t.contractMethodFactory.createContractMethodObjectParam(s,c,h,!1,!0)}});else{const a=this.parameterSchema;this.methods[hr]=function(...c){return t.contractMethodFactory.createContractMethodFlatParams(a,hr,c,!1)},this.methodsObject[hr]=function(c){return t.contractMethodFactory.createContractMethodObjectParam(a,hr,c,!1)}}}_initializeOnChainViews(t,e,i,n){const s=this.schema.val;n.forEach(o=>{this.contractViews[o.viewName]=function(a){return t.contractMethodFactory.createContractViewObjectParam(e,i,o,s,a)}})}storage(){return this.storageProvider.getStorage(this.address,this.schema)}bigMap(t){return this.storageProvider.getBigMapKey(this.address,t,this.schema)}}class Dg{constructor(t,e,i){this.id=t,this.schema=e,this.provider=i}get(t,e){return f(this,void 0,void 0,function*(){try{return yield this.provider.getBigMapKeyByID(this.id.toString(),t,this.schema,e)}catch(i){if(i instanceof Rr&&i.status===Mr.NOT_FOUND)return;throw i}})}getMultipleValues(t,e,i=5){return f(this,void 0,void 0,function*(){return this.provider.getBigMapKeysByID(this.id.toString(),t,this.schema,e,i)})}toJSON(){return this.id.toString()}toString(){return this.id.toString()}}const Wo=r=>({big_map:(t,e)=>{if(!t||!("int"in t)||t.int===void 0)return{};{const i=new Lt(e);return new Dg(new A(t.int),i,r)}},sapling_state:t=>!t||!("int"in t)||t.int===void 0?{}:new Pg(new A(t.int),r)});class kg extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i,this.originatedRollup=this.operationResults&&this.operationResults.originated_rollup}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="tx_rollup_origination"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedGas(){return A.config({DECIMAL_PLACES:0,ROUNDING_MODE:A.ROUND_UP}),this.consumedMilliGas?new A(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class jg extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="tx_rollup_submit_batch"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get content(){return this.params.content}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedGas(){return A.config({DECIMAL_PLACES:0,ROUNDING_MODE:A.ROUND_UP}),this.consumedMilliGas?new A(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class Bg extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const e=Array.isArray(this.results)&&this.results.find(i=>i.kind==="ballot");return e||void 0}get period(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.period}get proposal(){return this.params.proposal}get ballot(){return this.params.ballot}}class Hg extends gt{constructor(t,e,i,n,s){super(t,i,n,s),this.params=e}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="drain_delegate"),e=t&&t.metadata&&t.metadata.balance_updates;return e||void 0}get consensusKey(){return this.params.consensus_key}get delegate(){return this.params.delegate}get destination(){return this.params.destination}}class $g extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind===b.TRANSFER_TICKET),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get consumedGas(){return A.config({DECIMAL_PLACES:0,ROUNDING_MODE:A.ROUND_UP}),this.consumedMilliGas?new A(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class Ug extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="increase_paid_storage"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get amount(){return this.params.amount}get destination(){return this.params.destination}}class Vg extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const e=Array.isArray(this.results)&&this.results.find(i=>i.kind==="proposals");return e||void 0}get proposals(){return this.params.proposals}get period(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.period}}class Kg extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="update_consensus_key"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get pk(){return this.params.pk}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Gg extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind==="smart_rollup_add_messages"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get message(){return this.params.message}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Fg extends gt{constructor(t,e,i,n,s,o){super(t,n,s,o),this.params=e,this.source=i}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(i=>i.kind===b.SMART_ROLLUP_ORIGINATE),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return this.params.fee}get gasLimit(){return this.params.gas_limit}get storageLimit(){return this.params.storage_limit}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get pvmKind(){return this.params.pvm_kind}get kernel(){return this.params.kernel}get originationProof(){return this.params.origination_proof}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class zg extends $i{constructor(t,e){super(t),this.estimator=e,this.contractProviderTypeSymbol=Symbol.for("taquito-contract-provider-type-symbol")}getStorage(t,e){return f(this,void 0,void 0,function*(){if(dr(t)!==L.VALID)throw new pr(t);const i=yield this.context.readProvider.getScript(t,"head");e||(e=i);let n;return Lt.isSchema(e)?n=e:n=Lt.fromRPCResponse({script:e}),n.Execute(i.storage,Wo(this))})}getBigMapKey(t,e,i){return f(this,void 0,void 0,function*(){if(dr(t)!==L.VALID)throw new pr(t);i||(i=(yield this.rpc.getContract(t)).script);let n;Lt.isSchema(i)?n=i:n=Lt.fromRPCResponse({script:i});const s=n.EncodeBigMapKey(e),o=yield this.rpc.getBigMapKey(t,s);return n.ExecuteOnBigMapValue(o)})}getBigMapKeyByID(t,e,i,n){return f(this,void 0,void 0,function*(){const{key:s,type:o}=i.EncodeBigMapKey(e),{packed:a}=yield this.context.packer.packData({data:s,type:o}),c=Fc(a),h=n?yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},n):yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},"head");return i.ExecuteOnBigMapValue(h,Wo(this))})}getBigMapKeysByID(t,e,i,n,s=5){return f(this,void 0,void 0,function*(){const o=yield this.getBlockForRequest(e,n),a=new xt;let c=0,h=[];for(;c<e.length;){const d=e.slice(c,c+s).map(y=>this.getBigMapValueOrUndefined(y,t,i,o));h=[...h,...yield Promise.all(d)],c+=s}for(let l=0;l<h.length;l++)a.set(e[l],h[l]);return a})}getBlockForRequest(t,e){return f(this,void 0,void 0,function*(){return t.length===1||typeof e<"u"?e:yield this.context.readProvider.getBlockLevel("head")})}getBigMapValueOrUndefined(t,e,i,n){return f(this,void 0,void 0,function*(){try{return yield this.getBigMapKeyByID(e,t,i,n)}catch(s){if(s instanceof Rr&&s.status===Mr.NOT_FOUND)return;throw s}})}getSaplingDiffByID(t,e){return f(this,void 0,void 0,function*(){return e?yield this.context.readProvider.getSaplingDiffById({id:t.toString()},e):yield this.context.readProvider.getSaplingDiffById({id:t.toString()},"head")})}addRevealOperationIfNeeded(t,e){return f(this,void 0,void 0,function*(){if(Ii(t)){const i=[t],n=yield this.signer.publicKey(),s=yield this.estimator.reveal();if(s){const o={kind:b.REVEAL},a=yield this.estimate(o,()=>f(this,void 0,void 0,function*(){return s}));return i.unshift(yield Ge(Object.assign({},a),e,n)),i}}return t})}originate(t){return f(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.originate.bind(this.estimator)),i=yield this.signer.publicKeyHash(),n=yield Hr(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},t),e))),s=yield this.addRevealOperationIfNeeded(n,i),o=yield this.prepareOperation({operation:s,source:i}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new wg(c,n,l,d,h,this)})}setDelegate(t){return f(this,void 0,void 0,function*(){if(t.source&&G(t.source)!==L.VALID)throw new F(t.source);if(t.delegate&&G(t.delegate)!==L.VALID)throw new F(t.delegate);if(/kt1/i.test(t.source))throw new Ff(t.source);const e=yield this.estimate(t,this.estimator.setDelegate.bind(this.estimator)),i=yield this.signer.publicKeyHash(),n=yield $r(Object.assign(Object.assign({},t),e)),s=t.source||i,o=yield this.addRevealOperationIfNeeded(n,i),a=yield this.prepareOperation({operation:o,source:s}),c=yield this.forge(a),{hash:h,context:l,forgedBytes:d,opResponse:y}=yield this.signAndInject(c);return new qo(h,n,s,d,y,l)})}registerDelegate(t){return f(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.registerDelegate.bind(this.estimator)),i=yield this.signer.publicKeyHash(),n=yield Ec(Object.assign(Object.assign({},t),e),i),s=yield this.addRevealOperationIfNeeded(n,i),o=yield this.prepareOperation({operation:s}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new qo(c,n,i,l,d,h)})}transfer(t){return f(this,void 0,void 0,function*(){if(G(t.to)!==L.VALID)throw new F(t.to);if(t.source&&G(t.source)!==L.VALID)throw new F(t.source);const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.transfer.bind(this.estimator)),n=yield yr(Object.assign(Object.assign({},t),i)),s=t.source||e,o=yield this.addRevealOperationIfNeeded(n,e),a=yield this.prepareOperation({operation:o,source:t.source}),c=yield this.forge(a),{hash:h,context:l,forgedBytes:d,opResponse:y}=yield this.signAndInject(c);return new Rg(h,n,s,d,y,l)})}transferTicket(t){var e;return f(this,void 0,void 0,function*(){if(G(t.destination)!==L.VALID)throw new F(t.destination,"param destination");if(t.source&&G(t.source)!==L.VALID)throw new F(t.source,"param source");const i=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.transferTicket.bind(this.estimator)),s=yield Gr(Object.assign(Object.assign({},t),n)),o=(e=t.source)!==null&&e!==void 0?e:i,a=yield this.addRevealOperationIfNeeded(s,i),c=yield this.prepareOperation({operation:a,source:t.source}),h=yield this.forge(c),{hash:l,context:d,forgedBytes:y,opResponse:v}=yield this.signAndInject(h);return new $g(l,s,o,y,v,d)})}reveal(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimator.reveal(t);if(i){const n=yield this.estimate(t,()=>f(this,void 0,void 0,function*(){return i})),s=yield Ge(Object.assign({},n),e,yield this.signer.publicKey()),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new Og(c,s,e,l,d,h)}else throw new bc(`The publicKeyHash '${e}' has already been revealed.`)})}registerGlobalConstant(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.registerGlobalConstant.bind(this.estimator)),n=yield Ur(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new Ag(c,n,e,l,d,h)})}increasePaidStorage(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.increasePaidStorage.bind(this.estimator)),n=yield Fr(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new Ug(c,n,e,l,d,h)})}drainDelegate(t){return f(this,void 0,void 0,function*(){const e=yield vc(Object.assign({},t)),i=yield this.prepareOperation({operation:e}),n=yield this.forge(i),{hash:s,context:o,forgedBytes:a,opResponse:c}=yield this.signAndInject(n);return new Hg(s,e,a,c,o)})}txRollupOriginate(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t||{},this.estimator.txRollupOriginate.bind(this.estimator)),n=yield Vr(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new kg(c,n,e,l,d,h)})}txRollupSubmitBatch(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.txRollupSubmitBatch.bind(this.estimator)),n=yield Kr(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:e}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new jg(c,n,e,l,d,h)})}ballot(t){var e;return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash();if(t.source&&G(t.source)!==L.VALID)throw new F(t.source);const n=(e=t.source)!==null&&e!==void 0?e:i,s=yield _c(Object.assign(Object.assign({},t),{source:n})),o=yield this.prepareOperation({operation:s,source:n}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new Bg(c,s,i,l,d,h)})}proposals(t){var e;return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash();if(t.source&&G(t.source)!==L.VALID)throw new F(t.source);const n=(e=t.source)!==null&&e!==void 0?e:i,s=yield wc(Object.assign(Object.assign({},t),{source:n})),o=yield this.prepareOperation({operation:s,source:n}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new Vg(c,s,i,l,d,h)})}updateConsensusKey(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.updateConsensusKey.bind(this.estimator)),n=yield _s(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:t.source}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new Kg(c,n,e,l,d,h)})}smartRollupAddMessages(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.smartRollupAddMessages.bind(this.estimator)),n=yield zr(Object.assign(Object.assign({},t),i)),s=yield this.addRevealOperationIfNeeded(n,e),o=yield this.prepareOperation({operation:s,source:t.source}),a=yield this.forge(o),{hash:c,context:h,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new Gg(c,n,e,l,d,h)})}smartRollupOriginate(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.smartRollupOriginate.bind(this.estimator)),n=yield this.rpc.getOriginationProof({kind:t.pvmKind,kernel:t.kernel}),s=Object.assign(Object.assign({},t),{originationProof:n}),o=yield qr(Object.assign(Object.assign({},s),i)),a=yield this.addRevealOperationIfNeeded(o,e),c=yield this.prepareOperation({operation:a,source:t.source}),h=yield this.forge(c),{hash:l,context:d,forgedBytes:y,opResponse:v}=yield this.signAndInject(h);return new Fg(l,o,e,y,v,d)})}at(t,e=i=>i){return f(this,void 0,void 0,function*(){if(dr(t)!==L.VALID)throw new pr(t);const i=this.context.withExtensions().rpc,n=this.context.withExtensions().readProvider,s=yield n.getScript(t,"head"),o=yield n.getEntrypoints(t),a=new Pc(t,s,this,this,o,i,n);return e(a,this.context)})}batch(t){const e=new As(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}class Tc{constructor(t){this.context=t}getNextProto(){return f(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}parseScript(t){return f(this,void 0,void 0,function*(){return new Qe({protocol:yield this.getNextProto()}).parseScript(t)})}parseMichelineExpression(t){return f(this,void 0,void 0,function*(){return new Qe({protocol:yield this.getNextProto()}).parseMichelineExpression(t)})}parseJSON(t){return f(this,void 0,void 0,function*(){return new Qe({protocol:yield this.getNextProto()}).parseJSON(t)})}prepareCodeOrigination(t){return f(this,void 0,void 0,function*(){const e=t;if(e.code=yield this.formatCodeParam(t.code),t.init)e.init=yield this.formatInitParam(t.init);else if(t.storage){const i=e.code.find(o=>"prim"in o&&o.prim==="storage");if(!(i!=null&&i.args))throw new Ti("The storage section is missing from the script",t.code);const n=new Lt(i.args[0]),s=yield this.findGlobalConstantsHashAndValue(n);if(Object.keys(s).length!==0){const a=new Qe({expandGlobalConstant:s}).parseJSON(i.args[0]),c=new Lt(a);e.init=c.Encode(t.storage)}else e.init=n.Encode(t.storage);delete e.storage}return e})}formatCodeParam(t){return f(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const i=yield this.parseScript(t);if(i===null)throw new Ti("Invalid code parameter",t);e=i}else{const i=yield this.parseJSON(t),n=["parameter","storage","code"];e=i.sort((s,o)=>n.indexOf(s.prim)-n.indexOf(o.prim))}return e})}formatInitParam(t){return f(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const i=yield this.parseMichelineExpression(t);if(i===null)throw new yc("Invalid init parameter",t);e=i}else e=yield this.parseJSON(t);return e})}findGlobalConstantsHashAndValue(t){return f(this,void 0,void 0,function*(){const e=t.findToken("constant"),i={};if(e.length!==0)for(const n of e){const s=n.tokenVal.args;if(s){const o=s[0];if(o.string){const a=o.string,c=yield this.context.globalConstantsProvider.getGlobalConstantByHash(a);Object.assign(i,{[a]:c})}}}return i})}}class Ic{constructor(t){this.context=t}packData(t){return f(this,void 0,void 0,function*(){return this.context.rpc.packData(t)})}}class qg extends Error{constructor(){super("No globalThis constants provider has been configured. Please configure one by calling setGlobalConstantsProvider({globalConstantsProvider}) on your TezosToolkit instance."),this.name="UnconfiguredGlobalConstantsProviderError"}}class Nc{getGlobalConstantByHash(t){return f(this,void 0,void 0,function*(){throw new qg})}}class xc{constructor(t){this.rpc=t}getBalance(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getBalance(t,{block:String(e)})})}getDelegate(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getDelegate(t,{block:String(e)})})}getNextProtocol(t){return f(this,void 0,void 0,function*(){return(yield this.rpc.getProtocols({block:String(t)})).next_protocol})}getProtocolConstants(t){return f(this,void 0,void 0,function*(){const{time_between_blocks:e,minimal_block_delay:i,hard_gas_limit_per_operation:n,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:c,smart_rollup_origination_size:h}=yield this.rpc.getConstants({block:String(t)});return{time_between_blocks:e,minimal_block_delay:i,hard_gas_limit_per_operation:n,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:c,smart_rollup_origination_size:h}})}getScript(t,e){return f(this,void 0,void 0,function*(){const{script:i}=yield this.rpc.getContract(t,{block:String(e)});return i})}getStorage(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getStorage(t,{block:String(e)})})}getBlockHash(t){return f(this,void 0,void 0,function*(){const{hash:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBlockLevel(t){return f(this,void 0,void 0,function*(){const{level:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getCounter(t,e){return f(this,void 0,void 0,function*(){const{counter:i}=yield this.rpc.getContract(t,{block:String(e)});return i||"0"})}getBlockTimestamp(t){return f(this,void 0,void 0,function*(){const{timestamp:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBigMapValue(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getBigMapExpr(t.id,t.expr,{block:String(e)})})}getSaplingDiffById(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffById(t.id,{block:String(e)})})}getSaplingDiffByContract(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffByContract(t,{block:String(e)})})}getEntrypoints(t){return f(this,void 0,void 0,function*(){return this.rpc.getEntrypoints(t)})}getChainId(){return f(this,void 0,void 0,function*(){return this.rpc.getChainId()})}isAccountRevealed(t,e){return f(this,void 0,void 0,function*(){const i=yield this.rpc.getManagerKey(t,{block:String(e)});return i&&typeof i=="object"?!!i.key:!!i})}getBlock(t){return f(this,void 0,void 0,function*(){return this.rpc.getBlock({block:String(t)})})}getLiveBlocks(t){return this.rpc.getLiveBlocks({block:String(t)})}}const Wg=(r,t)=>r.hash===t.opHash,Yg=(r,t)=>{switch(r.kind){case"endorsement":return"metadata"in r&&r.metadata.delegate===t.source;case"activate_account":return"metadata"in r&&r.pkh===t.source;default:return"source"in r&&r.source===t.source}},Jg=(r,t)=>"kind"in r&&r.kind===t.kind,Zg=(r,t)=>{switch(r.kind){case"delegation":return r.delegate===t.destination;case"origination":if("metadata"in r&&"operation_result"in r.metadata&&"originated_contracts"in r.metadata.operation_result&&Array.isArray(r.metadata.operation_result.originated_contracts))return r.metadata.operation_result.originated_contracts.some(e=>e===t.destination);break;case"transaction":return r.destination===t.destination;default:return!1}},Xg=(r,t,e)=>r.kind==="event"?t&&e?r.source===t&&r.tag===e:t&&!e?r.source===t:e?r.tag===e:!0:!1,Qg=(r,t)=>"opHash"in t?Wg(r,t):"source"in t?Yg(r,t):"kind"in t?Jg(r,t):"destination"in t?Zg(r,t):!1,tm=(r,t)=>{if(Array.isArray(t.and))return t.and.every(e=>Pn(r,e));if(Array.isArray(t.or))return t.or.some(e=>Pn(r,e));throw new ng("Filter expression must contain either and/or property")},Pn=(r,t)=>{const e=[];return Array.isArray(t)?e.push(...t):e.push(t),e.every(i=>"and"in i||"or"in i?tm(r,i):Qg(r,i))};class Yo extends Error{constructor(t){super(t),this.message=t,this.name="UnsupportedEventError"}}class ci{constructor(t,e=!1,i=xa()){this.shouldRetry=e,this.operatorFunction=i,this.errorListeners=[],this.messageListeners=[],this.closeListeners=[],this.completed$=new br,t.pipe(Eh(this.completed$),wi(n=>{this.call(this.messageListeners,n)},n=>{this.call(this.errorListeners,n)},()=>{this.call(this.closeListeners)}),this.shouldRetry?i:wi(),Fn(()=>Kl)).subscribe()}call(t,e){for(const i of t)try{i(e)}catch(n){console.error(n)}}remove(t,e){const i=t.indexOf(e);i!==-1&&t.splice(i,1)}on(t,e){switch(t){case"data":this.messageListeners.push(e);break;case"error":this.errorListeners.push(e);break;case"close":this.closeListeners.push(e);break;default:throw new Yo(`Trying to register on an unsupported event: ${t}`)}}off(t,e){switch(t){case"data":this.remove(this.messageListeners,e);break;case"error":this.remove(this.errorListeners,e);break;case"close":this.remove(this.closeListeners,e);break;default:throw new Yo(`Trying to unregister on an unsupported event: ${t}`)}}close(){this.completed$.next()}}const em={shouldObservableSubscriptionRetry:!1,observableSubscriptionRetryFunction:xa()},rm=r=>ir(r.rpc.getBlock()).pipe(_e()),im=r=>Qr(t=>new Q(e=>{for(const i of t.operations)for(const n of i)for(const s of n.contents)Pn(Object.assign({hash:n.hash},s),r)&&e.next(Object.assign({hash:n.hash},s));e.complete()})),nm=r=>Qr(t=>new Q(e=>{for(const i of t.operations)for(const n of i)for(const s of n.contents){const a=s.metadata.internal_operation_results;if(a)for(const c of a)Xg(c,r==null?void 0:r.address,r==null?void 0:r.tag)&&e.next(Object.assign({opHash:n.hash,blockHash:t.hash,level:t.header.level},c))}e.complete()}));class Tn{constructor(t,e={}){this.context=t,this._config$=new Di(Object.assign(Object.assign({},em),e)),this.timer$=this._config$.pipe(mo("pollingIntervalMilliseconds"),oe(i=>i?go(0,i):ir(this.getConfirmationPollingInterval()).pipe(oe(n=>go(0,n))))),this.newBlock$=this.timer$.pipe(oe(()=>rm(this.context)),rh("hash"),dh(),Dr())}get config(){return this._config$.getValue()}getConfirmationPollingInterval(){return f(this,void 0,void 0,function*(){if(!this.config.pollingIntervalMilliseconds)try{const i=yield this.context.readProvider.getProtocolConstants("head"),s=(i.minimal_block_delay?i.minimal_block_delay.multipliedBy(1e3):i.time_between_blocks?i.time_between_blocks[0].multipliedBy(1e3):new A(5e3)).dividedBy(3);this.config.pollingIntervalMilliseconds=s.toNumber()===0?1e3:s.toNumber()}catch{return 5e3}return this.config.pollingIntervalMilliseconds})}subscribeBlock(t){return new ci(this.newBlock$,this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribe(t){return new ci(this.newBlock$.pipe(mo("hash")),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeOperation(t){return new ci(this.newBlock$.pipe(im(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeEvent(t){return new ci(this.newBlock$.pipe(nm(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}}class Lc{constructor(t){this.context=t}getNextProto(){return f(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}forge({branch:t,contents:e}){return f(this,void 0,void 0,function*(){return new fc(yield this.getNextProto()).forge({branch:t,contents:e})})}}var Z;class sm{constructor(t){this.context=t,Z.set(this,void 0),ht(this,Z,{})}get rpc(){return this.context.rpc}get signer(){return this.context.signer}get estimate(){return this.context.estimate}get parser(){return this.context.parser}getPkh(){return f(this,void 0,void 0,function*(){return yield this.context.signer.publicKeyHash()})}getBlockHash(){return f(this,void 0,void 0,function*(){return this.context.readProvider.getBlockHash("head~2")})}getProtocolHash(){return f(this,void 0,void 0,function*(){return this.context.readProvider.getNextProtocol("head")})}getHeadCounter(t){var e;return f(this,void 0,void 0,function*(){return(e=this.context.readProvider.getCounter(t,"head"))!==null&&e!==void 0?e:"0"})}getFee(t,e,i){return(!ni(this,Z)[e]||ni(this,Z)[e]<i)&&(ni(this,Z)[e]=i),{counter:`${++ni(this,Z)[e]}`,fee:typeof t.fee>"u"?"0":`${t.fee}`,gas_limit:typeof t.gas_limit>"u"?"0":`${t.gas_limit}`,storage_limit:typeof t.storage_limit>"u"?"0":`${t.storage_limit}`}}getSource(t,e,i){return{source:typeof t.source>"u"?i||e:t.source}}buildEstimates(t){return{fee:t.suggestedFeeMutez,gasLimit:t.gasLimit,storageLimit:t.storageLimit}}addRevealOperationIfNeeded(t,e){return f(this,void 0,void 0,function*(){if(Ii(t)){const i=[t],n=yield this.signer.publicKey(),s=yield this.estimate.reveal();if(s){const o=this.buildEstimates(s);return i.unshift(yield Ge(Object.assign({},o),e,n)),i}}return t})}convertIntoArray(t){return Array.isArray(t)?[...t]:[t]}constructOpContents(t,e,i,n,s){return t.map(o=>{switch(o.kind){case b.ACTIVATION:case b.DRAIN_DELEGATE:return Object.assign({},o);case b.ORIGINATION:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{balance:typeof o.balance<"u"?`${o.balance}`:"0"}),this.getSource(o,i,n)),this.getFee(o,i,e));case b.TRANSACTION:{const a=Object.assign(Object.assign(Object.assign(Object.assign({},o),{amount:typeof o.amount<"u"?`${o.amount}`:"0"}),this.getSource(o,i,n)),this.getFee(o,i,e));if(a.source.toLowerCase().startsWith("kt1"))throw new Cn(`KT1 addresses are not supported as source since ${ot.PsBabyM1}`);return a}case b.REVEAL:case b.DELEGATION:case b.REGISTER_GLOBAL_CONSTANT:case b.TX_ROLLUP_ORIGINATION:case b.TX_ROLLUP_SUBMIT_BATCH:case b.UPDATE_CONSENSUS_KEY:case b.SMART_ROLLUP_ADD_MESSAGES:case b.SMART_ROLLUP_ORIGINATE:return Object.assign(Object.assign(Object.assign({},o),this.getSource(o,i,n)),this.getFee(o,i,e));case b.TRANSFER_TICKET:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{ticket_amount:`${o.ticket_amount}`}),this.getSource(o,i,n)),this.getFee(o,i,e));case b.INCREASE_PAID_STORAGE:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{amount:`${o.amount}`}),this.getSource(o,i,n)),this.getFee(o,i,e));case b.BALLOT:if(s===void 0)throw new tr("Failed to get the current voting period index");return Object.assign(Object.assign({},o),{period:s==null?void 0:s.voting_period.index});case b.PROPOSALS:if(s===void 0)throw new tr("Failed to get the current voting period index");return Object.assign(Object.assign({},o),{period:s==null?void 0:s.voting_period.index});default:throw new Pe(o.kind)}})}reveal(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.estimate.reveal(t);if(i){const n=this.buildEstimates(i),s=yield Ge(Object.assign({},n),e,yield this.signer.publicKey()),o=this.convertIntoArray(s),a=yield this.getBlockHash(),c=yield this.getProtocolHash();ht(this,Z,{});const h=parseInt(yield this.getHeadCounter(e),10),l=this.constructOpContents(o,h,e);return{opOb:{branch:a,contents:l,protocol:c},counter:h}}else throw new bc(`The publicKeyHash '${e}' has already been revealed.`)})}originate(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield this.estimate.originate(t),s=this.buildEstimates(n),o=yield Hr(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},t),s))),a=yield this.addRevealOperationIfNeeded(o,i),c=this.convertIntoArray(a),h=yield this.getBlockHash(),l=yield this.getProtocolHash();ht(this,Z,{});const d=parseInt(yield this.getHeadCounter(i),10),y=this.constructOpContents(c,d,i,e);return{opOb:{branch:h,contents:y,protocol:l},counter:d}})}transaction(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield this.estimate.transfer(t),s=this.buildEstimates(n),o=yield yr(Object.assign(Object.assign({},t),s)),a=yield this.addRevealOperationIfNeeded(o,i),c=this.convertIntoArray(a),h=yield this.getBlockHash(),l=yield this.getProtocolHash();ht(this,Z,{});const d=parseInt(yield this.getHeadCounter(i),10),y=this.constructOpContents(c,d,i,e);return{opOb:{branch:h,contents:y,protocol:l},counter:d}})}delegation(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield this.estimate.setDelegate(t),s=this.buildEstimates(n),o=yield $r(Object.assign(Object.assign({},t),s)),a=yield this.addRevealOperationIfNeeded(o,i),c=this.convertIntoArray(a),h=yield this.getBlockHash(),l=yield this.getProtocolHash();ht(this,Z,{});const d=parseInt(yield this.getHeadCounter(i),10),y=this.constructOpContents(c,d,i,e);return{opOb:{branch:h,contents:y,protocol:l},counter:d}})}registerGlobalConstant(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield this.estimate.registerGlobalConstant(t),s=this.buildEstimates(n),o=yield Ur(Object.assign(Object.assign({},t),s)),a=yield this.addRevealOperationIfNeeded(o,i),c=this.convertIntoArray(a),h=yield this.getBlockHash(),l=yield this.getProtocolHash();ht(this,Z,{});const d=parseInt(yield this.getHeadCounter(i),10),y=this.constructOpContents(c,d,i,e);return{opOb:{branch:h,contents:y,protocol:l},counter:d}})}txRollupOrigination(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield this.estimate.txRollupOriginate(t),s=this.buildEstimates(n),o=yield Vr(Object.assign(Object.assign({},t),s)),a=yield this.addRevealOperationIfNeeded(o,i),c=this.convertIntoArray(a),h=yield this.getBlockHash(),l=yield this.getProtocolHash();ht(this,Z,{});const d=parseInt(yield this.getHeadCounter(i),10),y=this.constructOpContents(c,d,i,e);return{opOb:{branch:h,contents:y,protocol:l},counter:d}})}txRollupSubmitBatch(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield this.estimate.txRollupSubmitBatch(t),s=this.buildEstimates(n),o=yield Kr(Object.assign(Object.assign({},t),s)),a=yield this.addRevealOperationIfNeeded(o,i),c=this.convertIntoArray(a),h=yield this.getBlockHash(),l=yield this.getProtocolHash();ht(this,Z,{});const d=parseInt(yield this.getHeadCounter(i),10),y=this.constructOpContents(c,d,i,e);return{opOb:{branch:h,contents:y,protocol:l},counter:d}})}updateConsensusKey(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield this.estimate.updateConsensusKey(t),s=this.buildEstimates(n),o=yield _s(Object.assign(Object.assign({},t),s)),a=yield this.addRevealOperationIfNeeded(o,i),c=this.convertIntoArray(a),h=yield this.getBlockHash(),l=yield this.getProtocolHash();ht(this,Z,{});const d=parseInt(yield this.getHeadCounter(i),10),y=this.constructOpContents(c,d,i,e);return{opOb:{branch:h,contents:y,protocol:l},counter:d}})}increasePaidStorage(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield this.estimate.increasePaidStorage(t),s=this.buildEstimates(n),o=yield Fr(Object.assign(Object.assign({},t),s)),a=yield this.addRevealOperationIfNeeded(o,i),c=this.convertIntoArray(a),h=yield this.getBlockHash(),l=yield this.getProtocolHash();ht(this,Z,{});const d=parseInt(yield this.getHeadCounter(i),10),y=this.constructOpContents(c,d,i,e);return{opOb:{branch:h,contents:y,protocol:l},counter:d}})}ballot(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield _c(Object.assign({},t)),n=this.convertIntoArray(i),s=yield this.getBlockHash(),o=yield this.getProtocolHash();ht(this,Z,{});const a=parseInt(yield this.getHeadCounter(e),10);let c;try{c=yield this.rpc.getCurrentPeriod()}catch{throw new tr("Failed to get the current voting period index")}const h=this.constructOpContents(n,a,e,void 0,c);return{opOb:{branch:s,contents:h,protocol:o},counter:a}})}proposals(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield wc(Object.assign({},t)),n=this.convertIntoArray(i),s=yield this.getBlockHash(),o=yield this.getProtocolHash();ht(this,Z,{});const a=parseInt(yield this.getHeadCounter(e),10);let c;try{c=yield this.rpc.getCurrentPeriod()}catch{throw new tr("Failed to get the current voting period index")}const h=this.constructOpContents(n,a,e,void 0,c);return{opOb:{branch:s,contents:h,protocol:o},counter:a}})}drainDelegate(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield vc(Object.assign({},t)),s=this.convertIntoArray(n),o=yield this.getBlockHash(),a=yield this.getProtocolHash();ht(this,Z,{});const c=parseInt(yield this.getHeadCounter(i),10),h=this.constructOpContents(s,c,i,e);return{opOb:{branch:o,contents:h,protocol:a},counter:c}})}transferTicket(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield this.estimate.transferTicket(t),s=this.buildEstimates(n),o=yield Gr(Object.assign(Object.assign({},t),s)),a=yield this.addRevealOperationIfNeeded(o,i),c=this.convertIntoArray(a),h=yield this.getBlockHash(),l=yield this.getProtocolHash();ht(this,Z,{});const d=parseInt(yield this.getHeadCounter(i),10),y=this.constructOpContents(c,d,i,e);return{opOb:{branch:h,contents:y,protocol:l},counter:d}})}smartRollupAddMessages(t,e){return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),n=yield this.estimate.smartRollupAddMessages(t),s=this.buildEstimates(n),o=yield zr(Object.assign(Object.assign({},t),s)),a=yield this.addRevealOperationIfNeeded(o,i),c=this.convertIntoArray(a),h=yield this.getBlockHash(),l=yield this.getProtocolHash();ht(this,Z,{});const d=parseInt(yield this.getHeadCounter(i),10),y=this.constructOpContents(c,d,i,e);return{opOb:{branch:h,contents:y,protocol:l},counter:d}})}smartRollupOriginate(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=yield this.rpc.getOriginationProof({kind:t.pvmKind,kernel:t.kernel}),n=Object.assign(Object.assign({},t),{originationProof:i}),s=yield this.estimate.smartRollupOriginate(n),o=this.buildEstimates(s),a=yield qr(Object.assign(Object.assign({},n),o)),c=yield this.addRevealOperationIfNeeded(a,e),h=this.convertIntoArray(c),l=yield this.getBlockHash(),d=yield this.getProtocolHash();ht(this,Z,{});const y=parseInt(yield this.getHeadCounter(e),10),v=this.constructOpContents(h,y,e);return{opOb:{branch:l,contents:v,protocol:d},counter:y}})}batch(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),i=new As(this.context,this.estimate);Array.isArray(t)&&i.with(t);const n=yield i.toPrepare(),s=yield this.getBlockHash(),o=yield this.getProtocolHash();ht(this,Z,{});const a=parseInt(yield this.getHeadCounter(e),10),c=this.constructOpContents(n,a,e);return{opOb:{branch:s,contents:c,protocol:o},counter:a}})}contractCall(t){var e,i,n;return f(this,void 0,void 0,function*(){const s=yield this.getBlockHash(),o=yield this.getProtocolHash(),a=yield this.signer.publicKeyHash();ht(this,Z,{});const c=parseInt(yield this.getHeadCounter(a),10),h=t.toTransferParams(),l=yield this.estimate.transfer(h),d=[{kind:b.TRANSACTION,fee:(e=h.fee)!==null&&e!==void 0?e:l.suggestedFeeMutez,gas_limit:(i=h.gasLimit)!==null&&i!==void 0?i:l.gasLimit,storage_limit:(n=h.storageLimit)!==null&&n!==void 0?n:l.storageLimit,amount:String(h.amount),destination:h.to}],y=this.constructOpContents(d,c,a);return{opOb:{branch:s,contents:y,protocol:o},counter:c}})}toPreapply(t){return f(this,void 0,void 0,function*(){const{opOb:{contents:e,branch:i,protocol:n}}=t,s=this.toForge(t),o=yield this.context.forger.forge(s),a=yield this.context.signer.sign(o,new Uint8Array([3]));return[{contents:e,branch:i,protocol:n,signature:a.prefixSig}]})}toForge({opOb:{contents:t,branch:e}}){return{branch:e,contents:t}}}Z=new WeakMap;const om={defaultConfirmationCount:1,confirmationPollingTimeoutSecond:180};class Ni{constructor(t,e=new Rn,i,n=new Di(Object.assign({},om)),s,o,a,c,h,l,d,y){this._rpc=t,this._signer=e,this._proto=i,this._config=n,this.providerDecorator=[],this.tz=new yg(this),this.estimate=new _g(this),this.contract=new zg(this,this.estimate),this.prepare=new sm(this),this.batch=new og(this,this.estimate),this.wallet=new Ui(this),this.withExtensions=()=>{let v=this.clone();return this.providerDecorator.forEach(k=>{v=k(v)}),v},typeof this._rpc=="string"?this._rpcClient=new hi(this._rpc):this._rpcClient=this._rpc,this._forger=s||new Lc(this),this._injector=o||new Kf(this),this.operationFactory=new mg(this),this._walletProvider=c||new Sc(this),this._parser=h||new Tc(this),this._packer=a||new Ic(this),this._globalConstantsProvider=l||new Nc,this._readProvider=d||new xc(this._rpcClient),this._stream=y||new Tn(this)}get config(){return this._config.getValue()}set config(t){this._config.next(Object.assign({},t))}setPartialConfig(t){this._config.next(Object.assign(Object.assign({},this._config.getValue()),t))}get rpc(){return this._rpcClient}set rpc(t){this._rpcClient=t}get injector(){return this._injector}set injector(t){this._injector=t}get forger(){return this._forger}set forger(t){this._forger=t}get signer(){return this._signer}set signer(t){this._signer=t}get walletProvider(){return this._walletProvider}set walletProvider(t){this._walletProvider=t}set proto(t){this._proto=t}get proto(){return this._proto}get parser(){return this._parser}set parser(t){this._parser=t}get packer(){return this._packer}set packer(t){this._packer=t}get globalConstantsProvider(){return this._globalConstantsProvider}set globalConstantsProvider(t){this._globalConstantsProvider=t}get readProvider(){return this._readProvider}set readProvider(t){this._readProvider=t}get stream(){return this._stream}set stream(t){this._stream=t}isAnyProtocolActive(t=[]){return f(this,void 0,void 0,function*(){if(this._proto)return t.includes(this._proto);{const e=yield this.readProvider.getNextProtocol("head");return t.includes(e)}})}isAnySignerConfigured(){return!(this.signer instanceof Rn)}clone(){return new Ni(this.rpc,this.signer,this.proto,this._config,this.forger,this._injector,this.packer,this._walletProvider,this._parser,this._globalConstantsProvider,this._readProvider,this._stream)}registerProviderDecorator(t){this.providerDecorator.push(t)}}const am={commitHash:"840f2a29ce4e52826df53e5a1ac879c2deaa433b",version:"16.1.0"};class hm{constructor(t){this.context=t}forge({branch:t,contents:e}){return this.context.rpc.forgeOperations({branch:t,contents:e})}}class dm{packData(t){return f(this,void 0,void 0,function*(){const{bytes:e}=Qd(t.data,t.type);return{packed:e}})}}class pm{constructor(t){this._rpc=t,this._options={},this.format=Ln,typeof this._rpc=="string"?this._rpcClient=new hi(this._rpc):this._rpcClient=this._rpc,this._context=new Ni(t),this._wallet=new Ui(this._context),this.setProvider({rpc:this._rpcClient}),this.batch=this._context.batch.batch.bind(this._context.batch)}setProvider({rpc:t,stream:e,signer:i,protocol:n,config:s,forger:o,wallet:a,packer:c,globalConstantsProvider:h,readProvider:l,parserProvider:d}){this.setRpcProvider(t),this.setStreamProvider(e),this.setSignerProvider(i),this.setForgerProvider(o),this.setWalletProvider(a),this.setPackerProvider(c),this.setGlobalConstantsProvider(h),this.setReadProvider(l),this.setParserProvider(d),this._context.proto=n,s&&this._context.setPartialConfig(s)}setSignerProvider(t){!this._options.signer&&typeof t>"u"?(this._context.signer=new Rn,this._options.signer=t):typeof t<"u"&&(this._context.signer=t,this._options.signer=t)}setRpcProvider(t){typeof t=="string"?this._rpcClient=new hi(t):t===void 0||(this._rpcClient=t),this._options.rpc=this._rpcClient,this._context.rpc=this._rpcClient}setForgerProvider(t){if(typeof t<"u")this._options.forger=t,this._context.forger=t;else if(this._options.forger===void 0){const e=this.getFactory(Lc)();this._options.forger=e,this._context.forger=e}}setStreamProvider(t){if(typeof t=="string"){const e=new Tn(new Ni(new hi(t)));this._options.stream=e,this._context.stream=e}else if(typeof t<"u")this._options.stream=t,this._context.stream=t;else if(this._options.stream===void 0){const e=this.getFactory(Tn)();this._options.stream=e,this._context.stream=e}}setWalletProvider(t){if(!this._options.wallet&&typeof t>"u"){const e=this.getFactory(Sc)();this._options.wallet=e,this._context.walletProvider=e}else typeof t<"u"&&(this._options.wallet=t,this._context.walletProvider=t)}setPackerProvider(t){if(!this._options.packer&&typeof t>"u"){const e=this.getFactory(Ic)();this._context.packer=e,this._options.packer=e}else typeof t<"u"&&(this._context.packer=t,this._options.packer=t)}setGlobalConstantsProvider(t){if(!this._options.globalConstantsProvider&&typeof t>"u"){const e=new Nc;this._context.globalConstantsProvider=e,this._options.globalConstantsProvider=e}else typeof t<"u"&&(this._context.globalConstantsProvider=t,this._options.globalConstantsProvider=t)}setReadProvider(t){const e=t||new xc(this._context.rpc);this._options.readProvider=e,this._context.readProvider=e}setParserProvider(t){if(!this._options.parserProvider&&typeof t>"u"){const e=new Tc(this._context);this._context.parser=e,this._options.parserProvider=e}else typeof t<"u"&&(this._context.parser=t,this._options.parserProvider=t)}get tz(){return this._context.tz}get contract(){return this._context.contract}get prepare(){return this._context.prepare}get wallet(){return this._wallet}get operation(){return this._context.operationFactory}get estimate(){return this._context.estimate}get stream(){return this._context.stream}get rpc(){return this._context.rpc}get signer(){return this._context.signer}get globalConstants(){return this._context.globalConstantsProvider}addExtension(t){Array.isArray(t)?t.forEach(e=>e.configureContext(this._context)):t.configureContext(this._context)}getFactory(t){return(...e)=>new t(this._context,...e)}getVersionInfo(){return am}}export{Ve as D,dt as E,Ju as H,dm as M,b as O,hm as R,Mr as S,pm as T,Rr as a,Ue as b,Ke as c,yr as d,Fr as e,Hr as f,$r as g,Lt as h,wu as i,sa as j,qs as k,lm as l,mu as s,Ot as u};
