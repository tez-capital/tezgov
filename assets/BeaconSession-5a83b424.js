import{E as f,G as I,H as O,O as i,J as x,P as o,K as g,p as S}from"./main-349e1bdc.js";import{S as T}from"./SessionBase-8601248b.js";import{connect_beacon_wallet as G,disconnect_beacon_wallet as P}from"./beacon-bb9fdfb8.js";import{S as d}from"./DAppClient-d84f4cd5.js";import"./taquito.es6-49fa74ed.js";class w extends T{constructor(t,s,n,a,e){super(t,n,a,e),this.wallet=s}get AccountType(){return f.Beacon}get Icon(){return new I("/assets/svg/beacon-wallet-icon.svg",O.raw)}static async create(t,s){const n=x[t];if(!n)throw new Error("Invalid network specification!");const{account:a,tezos:e,forger:c,managerKey:p,wallet:r}=await G(n.id??t,{...s,rpc:(s==null?void 0:s.rpc)??n.rpc});return new w(a??"",r,e,c,{networkId:t,managerKey:p})}static async create_from_cache(){}logout(){P()}async switch_wallet(){return w.create(this.NetworkId,{rpc:this.Tezos.rpc.getRpcUrl(),useCached:!1})}async vote(t,s){if(s){const e=await this.forge_ballot_op(t),c=async()=>{const p=this.Tezos.wallet.context,r=await this.wallet.client.requestSignPayload({signingType:d.OPERATION,payload:"03"+e});let u=o.SIG;switch(r.signature.slice(0,5)){case o.EDSIG:u=o.EDSIG;break;case o.SPSIG:u=o.SPSIG;break;case o.P2SIG:u=o.P2SIG;break}const h=[...g(r.signature,S[u])].map(_=>_.toString(16).padStart(2,"0")).join(""),l=await this.Tezos.rpc.injectOperation(e.concat(h));return p.operationFactory.createOperation(l)};return new i(c,"Vote",{account:this.Account,ballot:t})}const n=await this.forge_ballot(t),a=async()=>{const e=this.Tezos.wallet.context,c=await this.wallet.sendOperations([n]);return e.operationFactory.createOperation(c)};return new i(a,"Vote",{account:this.Account,ballot:t})}async propose(t,s){if(s){const e=await this.forge_proposals_op(t),c=async()=>{const p=this.Tezos.wallet.context,r=await this.wallet.client.requestSignPayload({signingType:d.OPERATION,payload:"03".concat(e)});switch(o.SIG,r.signature.slice(0,5)){case o.EDSIG:o.EDSIG;break;case o.SPSIG:o.SPSIG;break;case o.P2SIG:o.P2SIG;break}const y=[...g(r.signature,S[o.EDSIG])].map(l=>l.toString(16).padStart(2,"0")).join(""),h=await this.Tezos.rpc.injectOperation(e.concat(y));return p.operationFactory.createOperation(h)};return new i(c,"Propose",{account:this.Account,proposals:t})}const n=await this.forge_proposals(t),a=async()=>{const e=this.Tezos.wallet.context,c=await this.wallet.sendOperations([n]);return e.operationFactory.createOperation(c)};return new i(a,"Propose",{account:this.Account,proposals:t})}async set_deposits_limit(t){const s=await this.forge_set_deposit_op(t),n=async()=>{const a=this.Tezos.wallet.context,e=await this.wallet.sendOperations([s]);return a.operationFactory.createOperation(e)};return new i(n,"Set Deposit",{account:this.Account,limit:t.toString()})}async update_consensus_key(t){const s=await this.forge_update_consensus_key_op(t),n=async()=>{const a=this.Tezos.wallet.context,e=await this.wallet.sendOperations([s]);return a.operationFactory.createOperation(e)};return new i(n,"Set Deposit",{account:this.Account,"Consensus Key":t})}async restore_consensus_key(){const t=await this.Tezos.signer.publicKey(),s=await this.forge_update_consensus_key_op(t),n=async()=>{const a=this.Tezos.wallet.context,e=await this.Tezos.signer.sign(s,new Uint8Array([3])),c=await this.Tezos.rpc.injectOperation(e.sbytes);return a.operationFactory.createOperation(c)};return new i(n,"Restore consensus key",{account:this.Account,"Consensus Key":t})}}export{w as BeaconSession};
