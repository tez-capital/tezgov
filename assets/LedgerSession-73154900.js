import{R as Yt,U as Wt,_ as Zt,E as Jt,G as Qt,H as er,O as ne,W as tr,J as rr}from"./main-6fc58ee3.js";import{S as nr}from"./SessionBase-d9d985fb.js";import{L as sr}from"./LedgerDialog-2abcf91e.js";import"./taquito.es6-d1ea31ce.js";import"./DAppClient-a1a041fe.js";const Z=r=>{class e extends Error{constructor(n,s,i){if(super(n||r,i),Object.setPrototypeOf(this,e.prototype),this.name=r,s)for(const a in s)this[a]=s[a];if(i&&ir(i)&&"cause"in i&&!("cause"in this)){const a=i.cause;this.cause=a,"stack"in a&&(this.stack=this.stack+`
CAUSE: `+a.stack)}}}return e};function ir(r){return typeof r=="object"}const or=Z("LockedDeviceError"),wt=Z("DisconnectedDevice"),Ot=Z("DisconnectedDeviceDuringOperation"),be=Z("TransportOpenUserCancelled"),Ke=Z("TransportInterfaceNotAvailable"),ar=Z("TransportRaceCondition"),cr=Z("TransportWebUSBGestureRequired");var Ye;(function(r){r.Unknown="Unknown",r.LocationServicesDisabled="LocationServicesDisabled",r.LocationServicesUnauthorized="LocationServicesUnauthorized",r.BluetoothScanStartFailed="BluetoothScanStartFailed"})(Ye||(Ye={}));class V extends Error{constructor(e,t){const n="TransportError";super(e||n),this.name=n,this.message=e,this.stack=new Error(e).stack,this.id=t}}const oe={ACCESS_CONDITION_NOT_FULFILLED:38916,ALGORITHM_NOT_SUPPORTED:38020,CLA_NOT_SUPPORTED:28160,CODE_BLOCKED:38976,CODE_NOT_INITIALIZED:38914,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,CONDITIONS_OF_USE_NOT_SATISFIED:27013,CONTRADICTION_INVALIDATION:38928,CONTRADICTION_SECRET_CODE_STATUS:38920,CUSTOM_IMAGE_BOOTLOADER:26159,CUSTOM_IMAGE_EMPTY:26158,FILE_ALREADY_EXISTS:27273,FILE_NOT_FOUND:37892,GP_AUTH_FAILED:25344,HALTED:28586,INCONSISTENT_FILE:37896,INCORRECT_DATA:27264,INCORRECT_LENGTH:26368,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,DEVICE_NOT_ONBOARDED:27911,DEVICE_NOT_ONBOARDED_2:26129,INVALID_KCV:38021,INVALID_OFFSET:37890,LICENSING:28482,LOCKED_DEVICE:21781,MAX_VALUE_REACHED:38992,MEMORY_PROBLEM:37440,MISSING_CRITICAL_PARAMETER:26624,NO_EF_SELECTED:37888,NOT_ENOUGH_MEMORY_SPACE:27268,OK:36864,PIN_REMAINING_ATTEMPTS:25536,REFERENCED_DATA_NOT_FOUND:27272,SECURITY_STATUS_NOT_SATISFIED:27010,TECHNICAL_PROBLEM:28416,UNKNOWN_APDU:27906,USER_REFUSED_ON_DEVICE:21761,NOT_ENOUGH_SPACE:20738};function lr(r){switch(r){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received";case 21781:return"Locked device"}if(28416<=r&&r<=28671)return"Internal error, please report"}function Ce(r){const e=Object.keys(oe).find(i=>oe[i]===r)||"UNKNOWN_ERROR",t=lr(r)||e,n=r.toString(16),s=`Ledger device: ${t} (0x${n})`;if(r===oe.LOCKED_DEVICE)throw new or(s);this.name="TransportStatusError",this.message=s,this.stack=new Error(s).stack,this.statusCode=r,this.statusText=e}Ce.prototype=new Error;var le=globalThis&&globalThis.__awaiter||function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function u(l){try{c(n.next(l))}catch(f){a(f)}}function o(l){try{c(n.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):s(l.value).then(u,o)}c((n=n.apply(r,e||[])).next())})};class me{constructor(){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new Yt,this.send=(e,t,n,s,i=Buffer.alloc(0),a=[oe.OK])=>le(this,void 0,void 0,function*(){if(i.length>=256)throw new V("data.length exceed 256 bytes limit. Got: "+i.length,"DataLengthTooBig");const u=yield this.exchange(Buffer.concat([Buffer.from([e,t,n,s]),Buffer.from([i.length]),i])),o=u.readUInt16BE(u.length-2);if(!a.some(c=>c===o))throw new Ce(o);return u}),this.exchangeAtomicImpl=e=>le(this,void 0,void 0,function*(){if(this.exchangeBusyPromise)throw new ar("An action was already pending on the Ledger device. Please deny or reconnect.");let t;const n=new Promise(a=>{t=a});this.exchangeBusyPromise=n;let s=!1;const i=setTimeout(()=>{s=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const a=yield e();return s&&this.emit("responsive"),a}finally{clearTimeout(i),t&&t(),this.exchangeBusyPromise=null}}),this._appAPIlock=null}exchange(e){throw new Error("exchange not implemented")}exchangeBulk(e,t){let n=!1;const s=()=>{n=!0};return(()=>le(this,void 0,void 0,function*(){if(!n)for(const a of e){const u=yield this.exchange(a);if(n)return;const o=u.readUInt16BE(u.length-2);if(o!==oe.OK)throw new Ce(o);t.next(u)}}))().then(()=>!n&&t.complete(),a=>!n&&t.error(a)),{unsubscribe:s}}setScrambleKey(e){}close(){return Promise.resolve()}on(e,t){this._events.on(e,t)}off(e,t){this._events.removeListener(e,t)}emit(e,...t){this._events.emit(e,...t)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(e){this.exchangeTimeout=e}setExchangeUnresponsiveTimeout(e){this.unresponsiveTimeout=e}static create(e=3e3,t){return new Promise((n,s)=>{let i=!1;const a=this.listen({next:o=>{i=!0,a&&a.unsubscribe(),u&&clearTimeout(u),this.open(o.descriptor,e).then(n,s)},error:o=>{u&&clearTimeout(u),s(o)},complete:()=>{u&&clearTimeout(u),i||s(new V(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=t?setTimeout(()=>{a.unsubscribe(),s(new V(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},t):null})}decorateAppAPIMethods(e,t,n){for(const s of t)e[s]=this.decorateAppAPIMethod(s,e[s],e,n)}decorateAppAPIMethod(e,t,n,s){return(...i)=>le(this,void 0,void 0,function*(){const{_appAPIlock:a}=this;if(a)return Promise.reject(new V("Ledger Device is busy (lock "+a+")","TransportLocked"));try{return this._appAPIlock=e,this.setScrambleKey(s),yield t.apply(n,i)}finally{this._appAPIlock=null}})}}me.ErrorMessage_ListenTimeout="No Ledger device found (timeout)";me.ErrorMessage_NoDeviceFound="No Ledger device found";const We=5;function ur(r){const e=Buffer.alloc(2);return e.writeUInt16BE(r,0),e}const hr={data:Buffer.alloc(0),dataLength:0,sequence:0},At=(r,e)=>({makeBlocks(t){let n=Buffer.concat([ur(t.length),t]);const s=e-5,i=Math.ceil(n.length/s);n=Buffer.concat([n,Buffer.alloc(i*s-n.length+1).fill(0)]);const a=[];for(let u=0;u<i;u++){const o=Buffer.alloc(5);o.writeUInt16BE(r,0),o.writeUInt8(We,2),o.writeUInt16BE(u,3);const c=n.slice(u*s,(u+1)*s);a.push(Buffer.concat([o,c]))}return a},reduceResponse(t,n){let{data:s,dataLength:i,sequence:a}=t||hr;if(n.readUInt16BE(0)!==r)throw new V("Invalid channel","InvalidChannel");if(n.readUInt8(2)!==We)throw new V("Invalid tag","InvalidTag");if(n.readUInt16BE(3)!==a)throw new V("Invalid sequence","InvalidSequence");t||(i=n.readUInt16BE(5)),a++;const u=n.slice(t?5:7);return s=Buffer.concat([s,u]),s.length>i&&(s=s.slice(0,i)),{data:s,dataLength:i,sequence:a}},getReducedResult(t){if(t&&t.dataLength===t.data.length)return t.data}});var Pe={exports:{}};const fr="2.0.0",Lt=256,dr=Number.MAX_SAFE_INTEGER||9007199254740991,pr=16,Er=Lt-6,vr=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var ge={MAX_LENGTH:Lt,MAX_SAFE_COMPONENT_LENGTH:pr,MAX_SAFE_BUILD_LENGTH:Er,MAX_SAFE_INTEGER:dr,RELEASE_TYPES:vr,SEMVER_SPEC_VERSION:fr,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const mr=typeof process=="object"&&{}&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};var $e=mr;(function(r,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:s}=ge,i=$e;e=r.exports={};const a=e.re=[],u=e.safeRe=[],o=e.src=[],c=e.t={};let l=0;const f="[a-zA-Z0-9-]",T=[["\\s",1],["\\d",s],[f,n]],E=M=>{for(const[D,H]of T)M=M.split(`${D}*`).join(`${D}{0,${H}}`).split(`${D}+`).join(`${D}{1,${H}}`);return M},g=(M,D,H)=>{const A=E(D),q=l++;i(M,q,D),c[M]=q,o[q]=D,a[q]=new RegExp(D,H?"g":void 0),u[q]=new RegExp(A,H?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),g("MAINVERSION",`(${o[c.NUMERICIDENTIFIER]})\\.(${o[c.NUMERICIDENTIFIER]})\\.(${o[c.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${o[c.NUMERICIDENTIFIERLOOSE]})\\.(${o[c.NUMERICIDENTIFIERLOOSE]})\\.(${o[c.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${o[c.NUMERICIDENTIFIER]}|${o[c.NONNUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${o[c.NUMERICIDENTIFIERLOOSE]}|${o[c.NONNUMERICIDENTIFIER]})`),g("PRERELEASE",`(?:-(${o[c.PRERELEASEIDENTIFIER]}(?:\\.${o[c.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${o[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[c.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${f}+`),g("BUILD",`(?:\\+(${o[c.BUILDIDENTIFIER]}(?:\\.${o[c.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${o[c.MAINVERSION]}${o[c.PRERELEASE]}?${o[c.BUILD]}?`),g("FULL",`^${o[c.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${o[c.MAINVERSIONLOOSE]}${o[c.PRERELEASELOOSE]}?${o[c.BUILD]}?`),g("LOOSE",`^${o[c.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${o[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${o[c.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${o[c.XRANGEIDENTIFIER]})(?:\\.(${o[c.XRANGEIDENTIFIER]})(?:\\.(${o[c.XRANGEIDENTIFIER]})(?:${o[c.PRERELEASE]})?${o[c.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${o[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[c.XRANGEIDENTIFIERLOOSE]})(?:${o[c.PRERELEASELOOSE]})?${o[c.BUILD]}?)?)?`),g("XRANGE",`^${o[c.GTLT]}\\s*${o[c.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${o[c.GTLT]}\\s*${o[c.XRANGEPLAINLOOSE]}$`),g("COERCE",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?(?:$|[^\\d])`),g("COERCERTL",o[c.COERCE],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${o[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",g("TILDE",`^${o[c.LONETILDE]}${o[c.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${o[c.LONETILDE]}${o[c.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${o[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",g("CARET",`^${o[c.LONECARET]}${o[c.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${o[c.LONECARET]}${o[c.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${o[c.GTLT]}\\s*(${o[c.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${o[c.GTLT]}\\s*(${o[c.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${o[c.GTLT]}\\s*(${o[c.LOOSEPLAIN]}|${o[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${o[c.XRANGEPLAIN]})\\s+-\\s+(${o[c.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${o[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[c.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Pe,Pe.exports);var ce=Pe.exports;const gr=Object.freeze({loose:!0}),$r=Object.freeze({}),Ir=r=>r?typeof r!="object"?gr:r:$r;var Ge=Ir;const Ze=/^[0-9]+$/,_t=(r,e)=>{const t=Ze.test(r),n=Ze.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},Rr=(r,e)=>_t(e,r);var xt={compareIdentifiers:_t,rcompareIdentifiers:Rr};const ue=$e,{MAX_LENGTH:Je,MAX_SAFE_INTEGER:he}=ge,{safeRe:Qe,t:et}=ce,yr=Ge,{compareIdentifiers:J}=xt;let Sr=class U{constructor(e,t){if(t=yr(t),e instanceof U){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Je)throw new TypeError(`version is longer than ${Je} characters`);ue("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?Qe[et.LOOSE]:Qe[et.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>he||this.major<0)throw new TypeError("Invalid major version");if(this.minor>he||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>he||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const i=+s;if(i>=0&&i<he)return i}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ue("SemVer.compare",this.version,this.options,e),!(e instanceof U)){if(typeof e=="string"&&e===this.version)return 0;e=new U(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof U||(e=new U(e,this.options)),J(this.major,e.major)||J(this.minor,e.minor)||J(this.patch,e.patch)}comparePre(e){if(e instanceof U||(e=new U(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],s=e.prerelease[t];if(ue("prerelease compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return J(n,s)}while(++t)}compareBuild(e){e instanceof U||(e=new U(e,this.options));let t=0;do{const n=this.build[t],s=e.build[t];if(ue("prerelease compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return J(n,s)}while(++t)}inc(e,t,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(n)?1:0;if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let i=[t,s];n===!1&&(i=[t]),J(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var _=Sr;const tt=_,Tr=(r,e,t=!1)=>{if(r instanceof tt)return r;try{return new tt(r,e)}catch(n){if(!t)return null;throw n}};var te=Tr;const Nr=te,wr=(r,e)=>{const t=Nr(r,e);return t?t.version:null};var Or=wr;const Ar=te,Lr=(r,e)=>{const t=Ar(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};var _r=Lr;const rt=_,xr=(r,e,t,n,s)=>{typeof t=="string"&&(s=n,n=t,t=void 0);try{return new rt(r instanceof rt?r.version:r,t).inc(e,n,s).version}catch{return null}};var Dr=xr;const nt=te,br=(r,e)=>{const t=nt(r,null,!0),n=nt(e,null,!0),s=t.compare(n);if(s===0)return null;const i=s>0,a=i?t:n,u=i?n:t,o=!!a.prerelease.length;if(!!u.prerelease.length&&!o)return!u.patch&&!u.minor?"major":a.patch?"patch":a.minor?"minor":"major";const l=o?"pre":"";return t.major!==n.major?l+"major":t.minor!==n.minor?l+"minor":t.patch!==n.patch?l+"patch":"prerelease"};var Cr=br;const Pr=_,Ur=(r,e)=>new Pr(r,e).major;var Gr=Ur;const Fr=_,Br=(r,e)=>new Fr(r,e).minor;var Mr=Br;const jr=_,Vr=(r,e)=>new jr(r,e).patch;var Xr=Vr;const zr=te,Hr=(r,e)=>{const t=zr(r,e);return t&&t.prerelease.length?t.prerelease:null};var qr=Hr;const st=_,kr=(r,e,t)=>new st(r,t).compare(new st(e,t));var C=kr;const Kr=C,Yr=(r,e,t)=>Kr(e,r,t);var Wr=Yr;const Zr=C,Jr=(r,e)=>Zr(r,e,!0);var Qr=Jr;const it=_,en=(r,e,t)=>{const n=new it(r,t),s=new it(e,t);return n.compare(s)||n.compareBuild(s)};var Fe=en;const tn=Fe,rn=(r,e)=>r.sort((t,n)=>tn(t,n,e));var nn=rn;const sn=Fe,on=(r,e)=>r.sort((t,n)=>sn(n,t,e));var an=on;const cn=C,ln=(r,e,t)=>cn(r,e,t)>0;var Ie=ln;const un=C,hn=(r,e,t)=>un(r,e,t)<0;var Be=hn;const fn=C,dn=(r,e,t)=>fn(r,e,t)===0;var Dt=dn;const pn=C,En=(r,e,t)=>pn(r,e,t)!==0;var bt=En;const vn=C,mn=(r,e,t)=>vn(r,e,t)>=0;var Me=mn;const gn=C,$n=(r,e,t)=>gn(r,e,t)<=0;var je=$n;const In=Dt,Rn=bt,yn=Ie,Sn=Me,Tn=Be,Nn=je,wn=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return In(r,t,n);case"!=":return Rn(r,t,n);case">":return yn(r,t,n);case">=":return Sn(r,t,n);case"<":return Tn(r,t,n);case"<=":return Nn(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};var Ct=wn;const On=_,An=te,{safeRe:fe,t:de}=ce,Ln=(r,e)=>{if(r instanceof On)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(fe[de.COERCE]);else{let n;for(;(n=fe[de.COERCERTL].exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||n.index+n[0].length!==t.index+t[0].length)&&(t=n),fe[de.COERCERTL].lastIndex=n.index+n[1].length+n[2].length;fe[de.COERCERTL].lastIndex=-1}return t===null?null:An(`${t[2]}.${t[3]||"0"}.${t[4]||"0"}`,e)};var _n=Ln,Ne,ot;function xn(){return ot||(ot=1,Ne=function(r){r.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}),Ne}var Dn=y;y.Node=W;y.create=y;function y(r){var e=this;if(e instanceof y||(e=new y),e.tail=null,e.head=null,e.length=0,r&&typeof r.forEach=="function")r.forEach(function(s){e.push(s)});else if(arguments.length>0)for(var t=0,n=arguments.length;t<n;t++)e.push(arguments[t]);return e}y.prototype.removeNode=function(r){if(r.list!==this)throw new Error("removing node which does not belong to this list");var e=r.next,t=r.prev;return e&&(e.prev=t),t&&(t.next=e),r===this.head&&(this.head=e),r===this.tail&&(this.tail=t),r.list.length--,r.next=null,r.prev=null,r.list=null,e};y.prototype.unshiftNode=function(r){if(r!==this.head){r.list&&r.list.removeNode(r);var e=this.head;r.list=this,r.next=e,e&&(e.prev=r),this.head=r,this.tail||(this.tail=r),this.length++}};y.prototype.pushNode=function(r){if(r!==this.tail){r.list&&r.list.removeNode(r);var e=this.tail;r.list=this,r.prev=e,e&&(e.next=r),this.tail=r,this.head||(this.head=r),this.length++}};y.prototype.push=function(){for(var r=0,e=arguments.length;r<e;r++)Cn(this,arguments[r]);return this.length};y.prototype.unshift=function(){for(var r=0,e=arguments.length;r<e;r++)Pn(this,arguments[r]);return this.length};y.prototype.pop=function(){if(this.tail){var r=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,r}};y.prototype.shift=function(){if(this.head){var r=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,r}};y.prototype.forEach=function(r,e){e=e||this;for(var t=this.head,n=0;t!==null;n++)r.call(e,t.value,n,this),t=t.next};y.prototype.forEachReverse=function(r,e){e=e||this;for(var t=this.tail,n=this.length-1;t!==null;n--)r.call(e,t.value,n,this),t=t.prev};y.prototype.get=function(r){for(var e=0,t=this.head;t!==null&&e<r;e++)t=t.next;if(e===r&&t!==null)return t.value};y.prototype.getReverse=function(r){for(var e=0,t=this.tail;t!==null&&e<r;e++)t=t.prev;if(e===r&&t!==null)return t.value};y.prototype.map=function(r,e){e=e||this;for(var t=new y,n=this.head;n!==null;)t.push(r.call(e,n.value,this)),n=n.next;return t};y.prototype.mapReverse=function(r,e){e=e||this;for(var t=new y,n=this.tail;n!==null;)t.push(r.call(e,n.value,this)),n=n.prev;return t};y.prototype.reduce=function(r,e){var t,n=this.head;if(arguments.length>1)t=e;else if(this.head)n=this.head.next,t=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=0;n!==null;s++)t=r(t,n.value,s),n=n.next;return t};y.prototype.reduceReverse=function(r,e){var t,n=this.tail;if(arguments.length>1)t=e;else if(this.tail)n=this.tail.prev,t=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=this.length-1;n!==null;s--)t=r(t,n.value,s),n=n.prev;return t};y.prototype.toArray=function(){for(var r=new Array(this.length),e=0,t=this.head;t!==null;e++)r[e]=t.value,t=t.next;return r};y.prototype.toArrayReverse=function(){for(var r=new Array(this.length),e=0,t=this.tail;t!==null;e++)r[e]=t.value,t=t.prev;return r};y.prototype.slice=function(r,e){e=e||this.length,e<0&&(e+=this.length),r=r||0,r<0&&(r+=this.length);var t=new y;if(e<r||e<0)return t;r<0&&(r=0),e>this.length&&(e=this.length);for(var n=0,s=this.head;s!==null&&n<r;n++)s=s.next;for(;s!==null&&n<e;n++,s=s.next)t.push(s.value);return t};y.prototype.sliceReverse=function(r,e){e=e||this.length,e<0&&(e+=this.length),r=r||0,r<0&&(r+=this.length);var t=new y;if(e<r||e<0)return t;r<0&&(r=0),e>this.length&&(e=this.length);for(var n=this.length,s=this.tail;s!==null&&n>e;n--)s=s.prev;for(;s!==null&&n>r;n--,s=s.prev)t.push(s.value);return t};y.prototype.splice=function(r,e,...t){r>this.length&&(r=this.length-1),r<0&&(r=this.length+r);for(var n=0,s=this.head;s!==null&&n<r;n++)s=s.next;for(var i=[],n=0;s&&n<e;n++)i.push(s.value),s=this.removeNode(s);s===null&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev);for(var n=0;n<t.length;n++)s=bn(this,s,t[n]);return i};y.prototype.reverse=function(){for(var r=this.head,e=this.tail,t=r;t!==null;t=t.prev){var n=t.prev;t.prev=t.next,t.next=n}return this.head=e,this.tail=r,this};function bn(r,e,t){var n=e===r.head?new W(t,null,e,r):new W(t,e,e.next,r);return n.next===null&&(r.tail=n),n.prev===null&&(r.head=n),r.length++,n}function Cn(r,e){r.tail=new W(e,r.tail,null,r),r.head||(r.head=r.tail),r.length++}function Pn(r,e){r.head=new W(e,null,r.head,r),r.tail||(r.tail=r.head),r.length++}function W(r,e,t,n){if(!(this instanceof W))return new W(r,e,t,n);this.list=n,this.value=r,e?(e.next=this,this.prev=e):this.prev=null,t?(t.prev=this,this.next=t):this.next=null}try{xn()(y)}catch{}const Un=Dn,K=Symbol("max"),F=Symbol("length"),Q=Symbol("lengthCalculator"),ae=Symbol("allowStale"),Y=Symbol("maxAge"),G=Symbol("dispose"),at=Symbol("noDisposeOnSet"),O=Symbol("lruList"),b=Symbol("cache"),Pt=Symbol("updateAgeOnGet"),we=()=>1;class Gn{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");this[K]=e.max||1/0;const t=e.length||we;if(this[Q]=typeof t!="function"?we:t,this[ae]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[Y]=e.maxAge||0,this[G]=e.dispose,this[at]=e.noDisposeOnSet||!1,this[Pt]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[K]=e||1/0,se(this)}get max(){return this[K]}set allowStale(e){this[ae]=!!e}get allowStale(){return this[ae]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[Y]=e,se(this)}get maxAge(){return this[Y]}set lengthCalculator(e){typeof e!="function"&&(e=we),e!==this[Q]&&(this[Q]=e,this[F]=0,this[O].forEach(t=>{t.length=this[Q](t.value,t.key),this[F]+=t.length})),se(this)}get lengthCalculator(){return this[Q]}get length(){return this[F]}get itemCount(){return this[O].length}rforEach(e,t){t=t||this;for(let n=this[O].tail;n!==null;){const s=n.prev;ct(this,e,n,t),n=s}}forEach(e,t){t=t||this;for(let n=this[O].head;n!==null;){const s=n.next;ct(this,e,n,t),n=s}}keys(){return this[O].toArray().map(e=>e.key)}values(){return this[O].toArray().map(e=>e.value)}reset(){this[G]&&this[O]&&this[O].length&&this[O].forEach(e=>this[G](e.key,e.value)),this[b]=new Map,this[O]=new Un,this[F]=0}dump(){return this[O].map(e=>pe(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[O]}set(e,t,n){if(n=n||this[Y],n&&typeof n!="number")throw new TypeError("maxAge must be a number");const s=n?Date.now():0,i=this[Q](t,e);if(this[b].has(e)){if(i>this[K])return ee(this,this[b].get(e)),!1;const o=this[b].get(e).value;return this[G]&&(this[at]||this[G](e,o.value)),o.now=s,o.maxAge=n,o.value=t,this[F]+=i-o.length,o.length=i,this.get(e),se(this),!0}const a=new Fn(e,t,i,s,n);return a.length>this[K]?(this[G]&&this[G](e,t),!1):(this[F]+=a.length,this[O].unshift(a),this[b].set(e,this[O].head),se(this),!0)}has(e){if(!this[b].has(e))return!1;const t=this[b].get(e).value;return!pe(this,t)}get(e){return Oe(this,e,!0)}peek(e){return Oe(this,e,!1)}pop(){const e=this[O].tail;return e?(ee(this,e),e.value):null}del(e){ee(this,this[b].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const s=e[n],i=s.e||0;if(i===0)this.set(s.k,s.v);else{const a=i-t;a>0&&this.set(s.k,s.v,a)}}}prune(){this[b].forEach((e,t)=>Oe(this,t,!1))}}const Oe=(r,e,t)=>{const n=r[b].get(e);if(n){const s=n.value;if(pe(r,s)){if(ee(r,n),!r[ae])return}else t&&(r[Pt]&&(n.value.now=Date.now()),r[O].unshiftNode(n));return s.value}},pe=(r,e)=>{if(!e||!e.maxAge&&!r[Y])return!1;const t=Date.now()-e.now;return e.maxAge?t>e.maxAge:r[Y]&&t>r[Y]},se=r=>{if(r[F]>r[K])for(let e=r[O].tail;r[F]>r[K]&&e!==null;){const t=e.prev;ee(r,e),e=t}},ee=(r,e)=>{if(e){const t=e.value;r[G]&&r[G](t.key,t.value),r[F]-=t.length,r[b].delete(t.key),r[O].removeNode(e)}};class Fn{constructor(e,t,n,s,i){this.key=e,this.value=t,this.length=n,this.now=s,this.maxAge=i||0}}const ct=(r,e,t,n)=>{let s=t.value;pe(r,s)&&(ee(r,t),r[ae]||(s=void 0)),s&&e.call(n,s.value,s.key,r)};var Bn=Gn,Ae,lt;function P(){if(lt)return Ae;lt=1;class r{constructor(h,$){if($=n($),h instanceof r)return h.loose===!!$.loose&&h.includePrerelease===!!$.includePrerelease?h:new r(h.raw,$);if(h instanceof s)return this.raw=h.value,this.set=[[h]],this.format(),this;if(this.options=$,this.loose=!!$.loose,this.includePrerelease=!!$.includePrerelease,this.raw=h.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(v=>this.parseRange(v.trim())).filter(v=>v.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const v=this.set[0];if(this.set=this.set.filter(m=>!g(m[0])),this.set.length===0)this.set=[v];else if(this.set.length>1){for(const m of this.set)if(m.length===1&&M(m[0])){this.set=[m];break}}}this.format()}format(){return this.range=this.set.map(h=>h.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(h){const v=((this.options.includePrerelease&&T)|(this.options.loose&&E))+":"+h,m=t.get(v);if(m)return m;const p=this.options.loose,I=p?u[o.HYPHENRANGELOOSE]:u[o.HYPHENRANGE];h=h.replace(I,kt(this.options.includePrerelease)),i("hyphen replace",h),h=h.replace(u[o.COMPARATORTRIM],c),i("comparator trim",h),h=h.replace(u[o.TILDETRIM],l),i("tilde trim",h),h=h.replace(u[o.CARETTRIM],f),i("caret trim",h);let S=h.split(" ").map(w=>H(w,this.options)).join(" ").split(/\s+/).map(w=>qt(w,this.options));p&&(S=S.filter(w=>(i("loose invalid filter",w,this.options),!!w.match(u[o.COMPARATORLOOSE])))),i("range list",S);const R=new Map,N=S.map(w=>new s(w,this.options));for(const w of N){if(g(w))return[w];R.set(w.value,w)}R.size>1&&R.has("")&&R.delete("");const x=[...R.values()];return t.set(v,x),x}intersects(h,$){if(!(h instanceof r))throw new TypeError("a Range is required");return this.set.some(v=>D(v,$)&&h.set.some(m=>D(m,$)&&v.every(p=>m.every(I=>p.intersects(I,$)))))}test(h){if(!h)return!1;if(typeof h=="string")try{h=new a(h,this.options)}catch{return!1}for(let $=0;$<this.set.length;$++)if(Kt(this.set[$],h,this.options))return!0;return!1}}Ae=r;const e=Bn,t=new e({max:1e3}),n=Ge,s=Re(),i=$e,a=_,{safeRe:u,t:o,comparatorTrimReplace:c,tildeTrimReplace:l,caretTrimReplace:f}=ce,{FLAG_INCLUDE_PRERELEASE:T,FLAG_LOOSE:E}=ge,g=d=>d.value==="<0.0.0-0",M=d=>d.value==="",D=(d,h)=>{let $=!0;const v=d.slice();let m=v.pop();for(;$&&v.length;)$=v.every(p=>m.intersects(p,h)),m=v.pop();return $},H=(d,h)=>(i("comp",d,h),d=jt(d,h),i("caret",d),d=q(d,h),i("tildes",d),d=Xt(d,h),i("xrange",d),d=Ht(d,h),i("stars",d),d),A=d=>!d||d.toLowerCase()==="x"||d==="*",q=(d,h)=>d.trim().split(/\s+/).map($=>Mt($,h)).join(" "),Mt=(d,h)=>{const $=h.loose?u[o.TILDELOOSE]:u[o.TILDE];return d.replace($,(v,m,p,I,S)=>{i("tilde",d,v,m,p,I,S);let R;return A(m)?R="":A(p)?R=`>=${m}.0.0 <${+m+1}.0.0-0`:A(I)?R=`>=${m}.${p}.0 <${m}.${+p+1}.0-0`:S?(i("replaceTilde pr",S),R=`>=${m}.${p}.${I}-${S} <${m}.${+p+1}.0-0`):R=`>=${m}.${p}.${I} <${m}.${+p+1}.0-0`,i("tilde return",R),R})},jt=(d,h)=>d.trim().split(/\s+/).map($=>Vt($,h)).join(" "),Vt=(d,h)=>{i("caret",d,h);const $=h.loose?u[o.CARETLOOSE]:u[o.CARET],v=h.includePrerelease?"-0":"";return d.replace($,(m,p,I,S,R)=>{i("caret",d,m,p,I,S,R);let N;return A(p)?N="":A(I)?N=`>=${p}.0.0${v} <${+p+1}.0.0-0`:A(S)?p==="0"?N=`>=${p}.${I}.0${v} <${p}.${+I+1}.0-0`:N=`>=${p}.${I}.0${v} <${+p+1}.0.0-0`:R?(i("replaceCaret pr",R),p==="0"?I==="0"?N=`>=${p}.${I}.${S}-${R} <${p}.${I}.${+S+1}-0`:N=`>=${p}.${I}.${S}-${R} <${p}.${+I+1}.0-0`:N=`>=${p}.${I}.${S}-${R} <${+p+1}.0.0-0`):(i("no pr"),p==="0"?I==="0"?N=`>=${p}.${I}.${S}${v} <${p}.${I}.${+S+1}-0`:N=`>=${p}.${I}.${S}${v} <${p}.${+I+1}.0-0`:N=`>=${p}.${I}.${S} <${+p+1}.0.0-0`),i("caret return",N),N})},Xt=(d,h)=>(i("replaceXRanges",d,h),d.split(/\s+/).map($=>zt($,h)).join(" ")),zt=(d,h)=>{d=d.trim();const $=h.loose?u[o.XRANGELOOSE]:u[o.XRANGE];return d.replace($,(v,m,p,I,S,R)=>{i("xRange",d,v,m,p,I,S,R);const N=A(p),x=N||A(I),w=x||A(S),re=w;return m==="="&&re&&(m=""),R=h.includePrerelease?"-0":"",N?m===">"||m==="<"?v="<0.0.0-0":v="*":m&&re?(x&&(I=0),S=0,m===">"?(m=">=",x?(p=+p+1,I=0,S=0):(I=+I+1,S=0)):m==="<="&&(m="<",x?p=+p+1:I=+I+1),m==="<"&&(R="-0"),v=`${m+p}.${I}.${S}${R}`):x?v=`>=${p}.0.0${R} <${+p+1}.0.0-0`:w&&(v=`>=${p}.${I}.0${R} <${p}.${+I+1}.0-0`),i("xRange return",v),v})},Ht=(d,h)=>(i("replaceStars",d,h),d.trim().replace(u[o.STAR],"")),qt=(d,h)=>(i("replaceGTE0",d,h),d.trim().replace(u[h.includePrerelease?o.GTE0PRE:o.GTE0],"")),kt=d=>(h,$,v,m,p,I,S,R,N,x,w,re,wi)=>(A(v)?$="":A(m)?$=`>=${v}.0.0${d?"-0":""}`:A(p)?$=`>=${v}.${m}.0${d?"-0":""}`:I?$=`>=${$}`:$=`>=${$}${d?"-0":""}`,A(N)?R="":A(x)?R=`<${+N+1}.0.0-0`:A(w)?R=`<${N}.${+x+1}.0-0`:re?R=`<=${N}.${x}.${w}-${re}`:d?R=`<${N}.${x}.${+w+1}-0`:R=`<=${R}`,`${$} ${R}`.trim()),Kt=(d,h,$)=>{for(let v=0;v<d.length;v++)if(!d[v].test(h))return!1;if(h.prerelease.length&&!$.includePrerelease){for(let v=0;v<d.length;v++)if(i(d[v].semver),d[v].semver!==s.ANY&&d[v].semver.prerelease.length>0){const m=d[v].semver;if(m.major===h.major&&m.minor===h.minor&&m.patch===h.patch)return!0}return!1}return!0};return Ae}var Le,ut;function Re(){if(ut)return Le;ut=1;const r=Symbol("SemVer ANY");class e{static get ANY(){return r}constructor(l,f){if(f=t(f),l instanceof e){if(l.loose===!!f.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),a("comparator",l,f),this.options=f,this.loose=!!f.loose,this.parse(l),this.semver===r?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(l){const f=this.options.loose?n[s.COMPARATORLOOSE]:n[s.COMPARATOR],T=l.match(f);if(!T)throw new TypeError(`Invalid comparator: ${l}`);this.operator=T[1]!==void 0?T[1]:"",this.operator==="="&&(this.operator=""),T[2]?this.semver=new u(T[2],this.options.loose):this.semver=r}toString(){return this.value}test(l){if(a("Comparator.test",l,this.options.loose),this.semver===r||l===r)return!0;if(typeof l=="string")try{l=new u(l,this.options)}catch{return!1}return i(l,this.operator,this.semver,this.options)}intersects(l,f){if(!(l instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new o(l.value,f).test(this.value):l.operator===""?l.value===""?!0:new o(this.value,f).test(l.semver):(f=t(f),f.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||i(this.semver,"<",l.semver,f)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||i(this.semver,">",l.semver,f)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}Le=e;const t=Ge,{safeRe:n,t:s}=ce,i=Ct,a=$e,u=_,o=P();return Le}const Mn=P(),jn=(r,e,t)=>{try{e=new Mn(e,t)}catch{return!1}return e.test(r)};var ye=jn;const Vn=P(),Xn=(r,e)=>new Vn(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));var zn=Xn;const Hn=_,qn=P(),kn=(r,e,t)=>{let n=null,s=null,i=null;try{i=new qn(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!n||s.compare(a)===-1)&&(n=a,s=new Hn(n,t))}),n};var Kn=kn;const Yn=_,Wn=P(),Zn=(r,e,t)=>{let n=null,s=null,i=null;try{i=new Wn(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!n||s.compare(a)===1)&&(n=a,s=new Yn(n,t))}),n};var Jn=Zn;const _e=_,Qn=P(),ht=Ie,es=(r,e)=>{r=new Qn(r,e);let t=new _e("0.0.0");if(r.test(t)||(t=new _e("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){const s=r.set[n];let i=null;s.forEach(a=>{const u=new _e(a.semver.version);switch(a.operator){case">":u.prerelease.length===0?u.patch++:u.prerelease.push(0),u.raw=u.format();case"":case">=":(!i||ht(u,i))&&(i=u);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),i&&(!t||ht(t,i))&&(t=i)}return t&&r.test(t)?t:null};var ts=es;const rs=P(),ns=(r,e)=>{try{return new rs(r,e).range||"*"}catch{return null}};var ss=ns;const is=_,Ut=Re(),{ANY:os}=Ut,as=P(),cs=ye,ft=Ie,dt=Be,ls=je,us=Me,hs=(r,e,t,n)=>{r=new is(r,n),e=new as(e,n);let s,i,a,u,o;switch(t){case">":s=ft,i=ls,a=dt,u=">",o=">=";break;case"<":s=dt,i=us,a=ft,u="<",o="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(cs(r,e,n))return!1;for(let c=0;c<e.set.length;++c){const l=e.set[c];let f=null,T=null;if(l.forEach(E=>{E.semver===os&&(E=new Ut(">=0.0.0")),f=f||E,T=T||E,s(E.semver,f.semver,n)?f=E:a(E.semver,T.semver,n)&&(T=E)}),f.operator===u||f.operator===o||(!T.operator||T.operator===u)&&i(r,T.semver))return!1;if(T.operator===o&&a(r,T.semver))return!1}return!0};var Ve=hs;const fs=Ve,ds=(r,e,t)=>fs(r,e,">",t);var ps=ds;const Es=Ve,vs=(r,e,t)=>Es(r,e,"<",t);var ms=vs;const pt=P(),gs=(r,e,t)=>(r=new pt(r,t),e=new pt(e,t),r.intersects(e,t));var $s=gs;const Is=ye,Rs=C;var ys=(r,e,t)=>{const n=[];let s=null,i=null;const a=r.sort((l,f)=>Rs(l,f,t));for(const l of a)Is(l,e,t)?(i=l,s||(s=l)):(i&&n.push([s,i]),i=null,s=null);s&&n.push([s,null]);const u=[];for(const[l,f]of n)l===f?u.push(l):!f&&l===a[0]?u.push("*"):f?l===a[0]?u.push(`<=${f}`):u.push(`${l} - ${f}`):u.push(`>=${l}`);const o=u.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return o.length<c.length?o:e};const Et=P(),Xe=Re(),{ANY:xe}=Xe,ie=ye,ze=C,Ss=(r,e,t={})=>{if(r===e)return!0;r=new Et(r,t),e=new Et(e,t);let n=!1;e:for(const s of r.set){for(const i of e.set){const a=Ns(s,i,t);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},Ts=[new Xe(">=0.0.0-0")],vt=[new Xe(">=0.0.0")],Ns=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===xe){if(e.length===1&&e[0].semver===xe)return!0;t.includePrerelease?r=Ts:r=vt}if(e.length===1&&e[0].semver===xe){if(t.includePrerelease)return!0;e=vt}const n=new Set;let s,i;for(const E of r)E.operator===">"||E.operator===">="?s=mt(s,E,t):E.operator==="<"||E.operator==="<="?i=gt(i,E,t):n.add(E.semver);if(n.size>1)return null;let a;if(s&&i){if(a=ze(s.semver,i.semver,t),a>0)return null;if(a===0&&(s.operator!==">="||i.operator!=="<="))return null}for(const E of n){if(s&&!ie(E,String(s),t)||i&&!ie(E,String(i),t))return null;for(const g of e)if(!ie(E,String(g),t))return!1;return!0}let u,o,c,l,f=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,T=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;f&&f.prerelease.length===1&&i.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const E of e){if(l=l||E.operator===">"||E.operator===">=",c=c||E.operator==="<"||E.operator==="<=",s){if(T&&E.semver.prerelease&&E.semver.prerelease.length&&E.semver.major===T.major&&E.semver.minor===T.minor&&E.semver.patch===T.patch&&(T=!1),E.operator===">"||E.operator===">="){if(u=mt(s,E,t),u===E&&u!==s)return!1}else if(s.operator===">="&&!ie(s.semver,String(E),t))return!1}if(i){if(f&&E.semver.prerelease&&E.semver.prerelease.length&&E.semver.major===f.major&&E.semver.minor===f.minor&&E.semver.patch===f.patch&&(f=!1),E.operator==="<"||E.operator==="<="){if(o=gt(i,E,t),o===E&&o!==i)return!1}else if(i.operator==="<="&&!ie(i.semver,String(E),t))return!1}if(!E.operator&&(i||s)&&a!==0)return!1}return!(s&&c&&!i&&a!==0||i&&l&&!s&&a!==0||T||f)},mt=(r,e,t)=>{if(!r)return e;const n=ze(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},gt=(r,e,t)=>{if(!r)return e;const n=ze(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};var ws=Ss;const De=ce,$t=ge,Os=_,It=xt,As=te,Ls=Or,_s=_r,xs=Dr,Ds=Cr,bs=Gr,Cs=Mr,Ps=Xr,Us=qr,Gs=C,Fs=Wr,Bs=Qr,Ms=Fe,js=nn,Vs=an,Xs=Ie,zs=Be,Hs=Dt,qs=bt,ks=Me,Ks=je,Ys=Ct,Ws=_n,Zs=Re(),Js=P(),Qs=ye,ei=zn,ti=Kn,ri=Jn,ni=ts,si=ss,ii=Ve,oi=ps,ai=ms,ci=$s,li=ys,ui=ws;var hi={parse:As,valid:Ls,clean:_s,inc:xs,diff:Ds,major:bs,minor:Cs,patch:Ps,prerelease:Us,compare:Gs,rcompare:Fs,compareLoose:Bs,compareBuild:Ms,sort:js,rsort:Vs,gt:Xs,lt:zs,eq:Hs,neq:qs,gte:ks,lte:Ks,cmp:Ys,coerce:Ws,Comparator:Zs,Range:Js,satisfies:Qs,toComparators:ei,maxSatisfying:ti,minSatisfying:ri,minVersion:ni,validRange:si,outside:ii,gtr:oi,ltr:ai,intersects:ci,simplifyRange:li,subset:ui,SemVer:Os,re:De.re,src:De.src,tokens:De.t,SEMVER_SPEC_VERSION:$t.SEMVER_SPEC_VERSION,RELEASE_TYPES:$t.RELEASE_TYPES,compareIdentifiers:It.compareIdentifiers,rcompareIdentifiers:It.rcompareIdentifiers};const Rt=Wt(hi);var L;(function(r){r.blue="blue",r.nanoS="nanoS",r.nanoSP="nanoSP",r.nanoX="nanoX",r.stax="stax"})(L||(L={}));const Ue={[L.blue]:{id:L.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:r=>4*1024},[L.nanoS]:{id:L.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:r=>{var e;return Rt.lt((e=Rt.coerce(r))!==null&&e!==void 0?e:"","2.0.0")?4*1024:2*1024}},[L.nanoSP]:{id:L.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1536*1024,masks:[856686592],getBlockSize:r=>32},[L.nanoX]:{id:L.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:r=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[L.stax]:{id:L.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1536*1024,masks:[857735168],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]}};L.blue,L.nanoS,L.nanoSP,L.nanoX,L.stax;const yt=Object.values(Ue),Se=11415,Te=r=>{const e=yt.find(s=>s.legacyUsbProductId===r);if(e)return e;const t=r>>8;return yt.find(s=>s.productIdMM===t)},fi=[],St={};for(const r in Ue){const e=Ue[r],{bluetoothSpec:t}=e;if(t)for(let n=0;n<t.length;n++){const s=t[n];fi.push(s.serviceUuid),St[s.serviceUuid]=St[s.serviceUuid.replace(/-/g,"")]=Object.assign({deviceModel:e},s)}}var di=0,j=[],Ee=function(r,e,t){var n={type:r,id:String(++di),date:new Date};e&&(n.message=e),t&&(n.data=t),Ei(n)},pi=function(r){return j.push(r),function(){var e=j.indexOf(r);e!==-1&&(j[e]=j[j.length-1],j.pop())}};function Ei(r){for(var e=0;e<j.length;e++)try{j[e](r)}catch(t){console.error(t)}}typeof window<"u"&&(window.__ledgerLogsListen=pi);var B=globalThis&&globalThis.__awaiter||function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function u(l){try{c(n.next(l))}catch(f){a(f)}}function o(l){try{c(n.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):s(l.value).then(u,o)}c((n=n.apply(r,e||[])).next())})};const vi=[{vendorId:Se}],mi=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),ve=()=>{const{hid:r}=navigator;if(!r)throw new V("navigator.hid is not supported","HIDNotSupported");return r};function Gt(){return B(this,void 0,void 0,function*(){const r=yield ve().requestDevice({filters:vi});return Array.isArray(r)?r:[r]})}function He(){return B(this,void 0,void 0,function*(){return(yield ve().getDevices()).filter(e=>e.vendorId===Se)})}function gi(){return B(this,void 0,void 0,function*(){const r=yield He();return r.length>0?r[0]:(yield Gt())[0]})}class X extends me{constructor(e){super(),this.channel=Math.floor(Math.random()*65535),this.packetSize=64,this.inputs=[],this.read=()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(t=>{this.inputCallback=t}),this.onInputReport=t=>{const n=Buffer.from(t.data.buffer);this.inputCallback?(this.inputCallback(n),this.inputCallback=null):this.inputs.push(n)},this._disconnectEmitted=!1,this._emitDisconnect=t=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",t))},this.exchange=t=>B(this,void 0,void 0,function*(){return yield this.exchangeAtomicImpl(()=>B(this,void 0,void 0,function*(){const{channel:s,packetSize:i}=this;Ee("apdu","=> "+t.toString("hex"));const a=At(s,i),u=a.makeBlocks(t);for(let l=0;l<u.length;l++)yield this.device.sendReport(0,u[l]);let o,c;for(;!(o=a.getReducedResult(c));){const l=yield this.read();c=a.reduceResponse(c,l)}return Ee("apdu","<= "+o.toString("hex")),o})).catch(s=>{throw s&&s.message&&s.message.includes("write")?(this._emitDisconnect(s),new Ot(s.message)):s})}),this.device=e,this.deviceModel=typeof e.productId=="number"?Te(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static request(){return B(this,void 0,void 0,function*(){const[e]=yield Gt();return X.open(e)})}static openConnected(){return B(this,void 0,void 0,function*(){const e=yield He();return e.length===0?null:X.open(e[0])})}static open(e){return B(this,void 0,void 0,function*(){yield e.open();const t=new X(e),n=s=>{e===s.device&&(ve().removeEventListener("disconnect",n),t._emitDisconnect(new wt))};return ve().addEventListener("disconnect",n),t})}close(){return B(this,void 0,void 0,function*(){yield this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),yield this.device.close()})}setScrambleKey(){}}X.isSupported=mi;X.list=He;X.listen=r=>{let e=!1;gi().then(n=>{if(!n)r.error(new be("Access denied to use Ledger device"));else if(!e){const s=typeof n.productId=="number"?Te(n.productId):void 0;r.next({type:"add",descriptor:n,deviceModel:s}),r.complete()}},n=>{r.error(new be(n.message))});function t(){e=!0}return{unsubscribe:t}};var qe=globalThis&&globalThis.__awaiter||function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function u(l){try{c(n.next(l))}catch(f){a(f)}}function o(l){try{c(n.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):s(l.value).then(u,o)}c((n=n.apply(r,e||[])).next())})};const $i=[{vendorId:Se}];function Ft(){return qe(this,void 0,void 0,function*(){return yield navigator.usb.requestDevice({filters:$i})})}function ke(){return qe(this,void 0,void 0,function*(){return(yield navigator.usb.getDevices()).filter(e=>e.vendorId===Se)})}function Ii(){return qe(this,void 0,void 0,function*(){const r=yield ke();return r.length>0?r[0]:Ft()})}const Ri=()=>Promise.resolve(!!navigator&&!!navigator.usb&&typeof navigator.usb.getDevices=="function");var k=globalThis&&globalThis.__awaiter||function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function u(l){try{c(n.next(l))}catch(f){a(f)}}function o(l){try{c(n.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):s(l.value).then(u,o)}c((n=n.apply(r,e||[])).next())})};const yi=1,Tt=3;class z extends me{constructor(e,t){super(),this.channel=Math.floor(Math.random()*65535),this.packetSize=64,this._disconnectEmitted=!1,this._emitDisconnect=n=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",n))},this.device=e,this.interfaceNumber=t,this.deviceModel=Te(e.productId)}static request(){return k(this,void 0,void 0,function*(){const e=yield Ft();return z.open(e)})}static openConnected(){return k(this,void 0,void 0,function*(){const e=yield ke();return e.length===0?null:z.open(e[0])})}static open(e){return k(this,void 0,void 0,function*(){yield e.open(),e.configuration===null&&(yield e.selectConfiguration(yi)),yield Nt(e);const t=e.configurations[0].interfaces.find(({alternates:a})=>a.some(u=>u.interfaceClass===255));if(!t)throw new Ke("No WebUSB interface found for your Ledger device. Please upgrade firmware or contact techsupport.");const n=t.interfaceNumber;try{yield e.claimInterface(n)}catch(a){throw yield e.close(),new Ke(a.message)}const s=new z(e,n),i=a=>{e===a.device&&(navigator.usb.removeEventListener("disconnect",i),s._emitDisconnect(new wt))};return navigator.usb.addEventListener("disconnect",i),s})}close(){return k(this,void 0,void 0,function*(){yield this.exchangeBusyPromise,yield this.device.releaseInterface(this.interfaceNumber),yield Nt(this.device),yield this.device.close()})}exchange(e){return k(this,void 0,void 0,function*(){return yield this.exchangeAtomicImpl(()=>k(this,void 0,void 0,function*(){const{channel:n,packetSize:s}=this;Ee("apdu","=> "+e.toString("hex"));const i=At(n,s),a=i.makeBlocks(e);for(let c=0;c<a.length;c++)yield this.device.transferOut(Tt,a[c]);let u,o;for(;!(u=i.getReducedResult(o));){const c=yield this.device.transferIn(Tt,s),l=Buffer.from(c.data.buffer);o=i.reduceResponse(o,l)}return Ee("apdu","<= "+u.toString("hex")),u})).catch(n=>{throw n&&n.message&&n.message.includes("disconnected")?(this._emitDisconnect(n),new Ot(n.message)):n})})}setScrambleKey(){}}z.isSupported=Ri;z.list=ke;z.listen=r=>{let e=!1;Ii().then(n=>{if(!e){const s=Te(n.productId);r.next({type:"add",descriptor:n,deviceModel:s}),r.complete()}},n=>{window.DOMException&&n instanceof window.DOMException&&n.code===18?r.error(new cr(n.message)):r.error(new be(n.message))});function t(){e=!0}return{unsubscribe:t}};function Nt(r){return k(this,void 0,void 0,function*(){try{yield r.reset()}catch(e){console.warn(e)}})}const Si=async()=>{try{return await z.create()}catch(r){return navigator.hid||alert("Error: "+r),console.log(r),await X.create()}},Ti=async(r,e)=>{const{create_toolkit:t}=await Zt(()=>import("./taquito-9120357a.js"),["assets/taquito-9120357a.js","assets/taquito.es6-d1ea31ce.js","assets/main-6fc58ee3.js","assets/index-3694a04e.css"]),{tezos:n,forger:s}=await t(e.rpc),i=new sr(r,e.derivationPath,void 0,e.derivationType);n.setSignerProvider(i);const a=await n.signer.publicKeyHash(),u=a?await n.rpc.getManagerKey(a):void 0;return{account:a,tezos:n,forger:s,managerKey:u==null?void 0:u.toString()}},{request_ledger_setup:Ni}=tr();class Bt extends nr{constructor(e,t,n,s,i){super(e,n,s,i),this.transport=t}get AccountType(){return Jt.Ledger}get Icon(){return new Qt("/assets/svg/ledger-wallet-icon.svg",er.raw)}get IsAccountSwitchSupported(){return!1}static async create(e,t,n){const s=rr[t];if(!s)throw new Error("Invalid network specification!");const{account:i,tezos:a,forger:u,managerKey:o}=await Ti(e,{...n,rpc:(n==null?void 0:n.rpc)??s.rpc});return new Bt(i??"",e,a,u,{networkId:t,managerKey:o})}static async create_transport(){return Si()}static async create_from_cache(){}logout(){this.transport.close()}async switch_wallet(){const e=await Ni({networkId:this.NetworkId,rpc:this.Tezos.rpc.getRpcUrl()});if(!e)throw new Error("Aborted.");return e}async vote(e){const t=await this.forge_ballot_op(e),n=async()=>{const s=this.Tezos.wallet.context,i=await this.Tezos.signer.sign(t,new Uint8Array([3])),a=await this.Tezos.rpc.injectOperation(i.sbytes);return s.operationFactory.createOperation(a)};return new ne(n,"Vote",{account:this.Account,ballot:e})}async propose(e){const t=await this.forge_proposals_op(e),n=async()=>{const s=this.Tezos.wallet.context,i=await this.Tezos.signer.sign(t,new Uint8Array([3])),a=await this.Tezos.rpc.injectOperation(i.sbytes);return s.operationFactory.createOperation(a)};return new ne(n,"Propose",{account:this.Account,proposals:e})}async set_deposits_limit(e){const t=await this.forge_set_deposit_op(e),n=async()=>{const s=this.Tezos.wallet.context,i=await this.Tezos.signer.sign(t,new Uint8Array([3])),a=await this.Tezos.rpc.injectOperation(i.sbytes);return s.operationFactory.createOperation(a)};return new ne(n,"Set deposit limit",{account:this.Account,limit:e.toString()})}async update_consensus_key(e){const t=await this.forge_update_consensus_key_op(e),n=async()=>{const s=this.Tezos.wallet.context,i=await this.Tezos.signer.sign(t,new Uint8Array([3])),a=await this.Tezos.rpc.injectOperation(i.sbytes);return s.operationFactory.createOperation(a)};return new ne(n,"Update consensus key",{account:this.Account,"Consensus Key":e})}async restore_consensus_key(){const e=await this.Tezos.signer.publicKey(),t=await this.forge_update_consensus_key_op(e),n=async()=>{const s=this.Tezos.wallet.context,i=await this.Tezos.signer.sign(t,new Uint8Array([3])),a=await this.Tezos.rpc.injectOperation(i.sbytes);return s.operationFactory.createOperation(a)};return new ne(n,"Restore consensus key",{account:this.Account,"Consensus Key":e})}}export{Bt as LedgerSession};
