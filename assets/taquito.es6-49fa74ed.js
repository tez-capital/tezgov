import{U as sa,ao as Nn,ap as V,V as T,aq as z,i as $,ar as br,as as cr,a9 as I,T as Z,at as oa,au as su,av as bi,aw as ou,ax as Ks,ay as Vs,az as au,aA as cu,P as R,K as aa,p as ji,aB as Fs,X as Ui,aC as uu,aD as ca,a as W,aE as lu,aF as ua,a1 as hu,aG as du,b as pu,Y as Gi,aH as la,aI as Ye,aJ as fu,aK as gu,aL as Ki,aM as Vi,Z as Fn,aN as ha,aO as Ur,aP as mu,aQ as Ln,aR as da,aS as pa,aT as yu}from"./main-349e1bdc.js";var fa=function(t,e,n,i,s){return t.config=e,n&&(t.code=n),t.request=i,t.response=s,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t},vu=fa,ga=function(t,e,n,i,s){var o=new Error(t);return vu(o,e,n,i,s)},Eu=ga,ma=function(t,e,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):e(Eu("Request failed with status code "+n.status,n.config,null,n.request,n))},ya=function(t,e){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return t.apply(e,i)}},bu=ya,tr=Object.prototype.toString;function Fi(r){return Array.isArray(r)}function _i(r){return typeof r>"u"}function _u(r){return r!==null&&!_i(r)&&r.constructor!==null&&!_i(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function va(r){return tr.call(r)==="[object ArrayBuffer]"}function wu(r){return tr.call(r)==="[object FormData]"}function Au(r){var t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&va(r.buffer),t}function Su(r){return typeof r=="string"}function Ru(r){return typeof r=="number"}function Ea(r){return r!==null&&typeof r=="object"}function cn(r){if(tr.call(r)!=="[object Object]")return!1;var t=Object.getPrototypeOf(r);return t===null||t===Object.prototype}function Ou(r){return tr.call(r)==="[object Date]"}function Pu(r){return tr.call(r)==="[object File]"}function Tu(r){return tr.call(r)==="[object Blob]"}function ba(r){return tr.call(r)==="[object Function]"}function Iu(r){return Ea(r)&&ba(r.pipe)}function Nu(r){return tr.call(r)==="[object URLSearchParams]"}function Lu(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function xu(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function zi(r,t){if(!(r===null||typeof r>"u"))if(typeof r!="object"&&(r=[r]),Fi(r))for(var e=0,n=r.length;e<n;e++)t.call(null,r[e],e,r);else for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.call(null,r[i],i,r)}function wi(){var r={};function t(i,s){cn(r[s])&&cn(i)?r[s]=wi(r[s],i):cn(i)?r[s]=wi({},i):Fi(i)?r[s]=i.slice():r[s]=i}for(var e=0,n=arguments.length;e<n;e++)zi(arguments[e],t);return r}function Cu(r,t,e){return zi(t,function(i,s){e&&typeof i=="function"?r[s]=bu(i,e):r[s]=i}),r}function Mu(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var St={isArray:Fi,isArrayBuffer:va,isBuffer:_u,isFormData:wu,isArrayBufferView:Au,isString:Su,isNumber:Ru,isObject:Ea,isPlainObject:cn,isUndefined:_i,isDate:Ou,isFile:Pu,isBlob:Tu,isFunction:ba,isStream:Iu,isURLSearchParams:Nu,isStandardBrowserEnv:xu,forEach:zi,merge:wi,extend:Cu,trim:Lu,stripBOM:Mu},fr=St;function zs(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Ji=function(t,e,n){if(!e)return t;var i;if(n)i=n(e);else if(fr.isURLSearchParams(e))i=e.toString();else{var s=[];fr.forEach(e,function(c,u){c===null||typeof c>"u"||(fr.isArray(c)?u=u+"[]":c=[c],fr.forEach(c,function(d){fr.isDate(d)?d=d.toISOString():fr.isObject(d)&&(d=JSON.stringify(d)),s.push(zs(u)+"="+zs(d))}))}),i=s.join("&")}if(i){var o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t},Du=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)},ku=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t},Bu=Du,$u=ku,_a=function(t,e){return t&&!Bu(e)?$u(t,e):e},qi={exports:{}},Hu=St;function xn(){this.handlers=[]}xn.prototype.use=function(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1};xn.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)};xn.prototype.forEach=function(t){Hu.forEach(this.handlers,function(n){n!==null&&t(n)})};var ju=xn,Uu=St,Gu=function(t,e){Uu.forEach(t,function(i,s){s!==e&&s.toUpperCase()===e.toUpperCase()&&(t[e]=i,delete t[s])})},zn,Js;function Ku(){if(Js)return zn;Js=1;var r=St;return zn=r.isStandardBrowserEnv()?function(){return{write:function(n,i,s,o,a,c){var u=[];u.push(n+"="+encodeURIComponent(i)),r.isNumber(s)&&u.push("expires="+new Date(s).toGMTString()),r.isString(o)&&u.push("path="+o),r.isString(a)&&u.push("domain="+a),c===!0&&u.push("secure"),document.cookie=u.join("; ")},read:function(n){var i=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),zn}var Jn,qs;function Vu(){if(qs)return Jn;qs=1;var r=St,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Jn=function(n){var i={},s,o,a;return n&&r.forEach(n.split(`
`),function(u){if(a=u.indexOf(":"),s=r.trim(u.substr(0,a)).toLowerCase(),o=r.trim(u.substr(a+1)),s){if(i[s]&&t.indexOf(s)>=0)return;s==="set-cookie"?i[s]=(i[s]?i[s]:[]).concat([o]):i[s]=i[s]?i[s]+", "+o:o}}),i},Jn}var qn,Ws;function Fu(){if(Ws)return qn;Ws=1;var r=St;return qn=r.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a"),i;function s(o){var a=o;return e&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return i=s(window.location.href),function(a){var c=r.isString(a)?s(a):a;return c.protocol===i.protocol&&c.host===i.host}}():function(){return function(){return!0}}(),qn}var Wn,Zs;function Cn(){if(Zs)return Wn;Zs=1;function r(t){this.message=t}return r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,Wn=r,Wn}var Zn,Ys;function Xs(){if(Ys)return Zn;Ys=1;var r=St,t=ma,e=Ku(),n=Ji,i=_a,s=Vu(),o=Fu(),a=ga,c=Mn(),u=Cn();return Zn=function(d){return new Promise(function(v,b){var w=d.data,O=d.headers,A=d.responseType,_;function It(){d.cancelToken&&d.cancelToken.unsubscribe(_),d.signal&&d.signal.removeEventListener("abort",_)}r.isFormData(w)&&delete O["Content-Type"];var k=new XMLHttpRequest;if(d.auth){var ge=d.auth.username||"",me=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";O.Authorization="Basic "+btoa(ge+":"+me)}var Nt=i(d.baseURL,d.url);k.open(d.method.toUpperCase(),n(Nt,d.params,d.paramsSerializer),!0),k.timeout=d.timeout;function nr(){if(k){var g="getAllResponseHeaders"in k?s(k.getAllResponseHeaders()):null,N=!A||A==="text"||A==="json"?k.responseText:k.response,L={data:N,status:k.status,statusText:k.statusText,headers:g,config:d,request:k};t(function(j){v(j),It()},function(j){b(j),It()},L),k=null}}if("onloadend"in k?k.onloadend=nr:k.onreadystatechange=function(){!k||k.readyState!==4||k.status===0&&!(k.responseURL&&k.responseURL.indexOf("file:")===0)||setTimeout(nr)},k.onabort=function(){k&&(b(a("Request aborted",d,"ECONNABORTED",k)),k=null)},k.onerror=function(){b(a("Network Error",d,null,k)),k=null},k.ontimeout=function(){var N=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",L=d.transitional||c.transitional;d.timeoutErrorMessage&&(N=d.timeoutErrorMessage),b(a(N,d,L.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",k)),k=null},r.isStandardBrowserEnv()){var Dr=(d.withCredentials||o(Nt))&&d.xsrfCookieName?e.read(d.xsrfCookieName):void 0;Dr&&(O[d.xsrfHeaderName]=Dr)}"setRequestHeader"in k&&r.forEach(O,function(N,L){typeof w>"u"&&L.toLowerCase()==="content-type"?delete O[L]:k.setRequestHeader(L,N)}),r.isUndefined(d.withCredentials)||(k.withCredentials=!!d.withCredentials),A&&A!=="json"&&(k.responseType=d.responseType),typeof d.onDownloadProgress=="function"&&k.addEventListener("progress",d.onDownloadProgress),typeof d.onUploadProgress=="function"&&k.upload&&k.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(_=function(g){k&&(b(!g||g&&g.type?new u("canceled"):g),k.abort(),k=null)},d.cancelToken&&d.cancelToken.subscribe(_),d.signal&&(d.signal.aborted?_():d.signal.addEventListener("abort",_))),w||(w=null),k.send(w)})},Zn}var Yn,Qs;function Mn(){if(Qs)return Yn;Qs=1;var r=St,t=Gu,e=fa,n={"Content-Type":"application/x-www-form-urlencoded"};function i(c,u){!r.isUndefined(c)&&r.isUndefined(c["Content-Type"])&&(c["Content-Type"]=u)}function s(){var c;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(c=Xs()),c}function o(c,u,l){if(r.isString(c))try{return(u||JSON.parse)(c),r.trim(c)}catch(d){if(d.name!=="SyntaxError")throw d}return(l||JSON.stringify)(c)}var a={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:s(),transformRequest:[function(u,l){return t(l,"Accept"),t(l,"Content-Type"),r.isFormData(u)||r.isArrayBuffer(u)||r.isBuffer(u)||r.isStream(u)||r.isFile(u)||r.isBlob(u)?u:r.isArrayBufferView(u)?u.buffer:r.isURLSearchParams(u)?(i(l,"application/x-www-form-urlencoded;charset=utf-8"),u.toString()):r.isObject(u)||l&&l["Content-Type"]==="application/json"?(i(l,"application/json"),o(u)):u}],transformResponse:[function(u){var l=this.transitional||a.transitional,d=l&&l.silentJSONParsing,m=l&&l.forcedJSONParsing,v=!d&&this.responseType==="json";if(v||m&&r.isString(u)&&u.length)try{return JSON.parse(u)}catch(b){if(v)throw b.name==="SyntaxError"?e(b,this,"E_JSON_PARSE"):b}return u}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(u){return u>=200&&u<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};return r.forEach(["delete","get","head"],function(u){a.headers[u]={}}),r.forEach(["post","put","patch"],function(u){a.headers[u]=r.merge(n)}),Yn=a,Yn}var zu=St,Ju=Mn(),qu=function(t,e,n){var i=this||Ju;return zu.forEach(n,function(o){t=o.call(i,t,e)}),t},Xn,to;function wa(){return to||(to=1,Xn=function(t){return!!(t&&t.__CANCEL__)}),Xn}var eo=St,Qn=qu,Wu=wa(),Zu=Mn(),Yu=Cn();function ti(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Yu("canceled")}var Xu=function(t){ti(t),t.headers=t.headers||{},t.data=Qn.call(t,t.data,t.headers,t.transformRequest),t.headers=eo.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),eo.forEach(["delete","get","head","post","put","patch","common"],function(i){delete t.headers[i]});var e=t.adapter||Zu.adapter;return e(t).then(function(i){return ti(t),i.data=Qn.call(t,i.data,i.headers,t.transformResponse),i},function(i){return Wu(i)||(ti(t),i&&i.response&&(i.response.data=Qn.call(t,i.response.data,i.response.headers,t.transformResponse))),Promise.reject(i)})},xt=St,Aa=function(t,e){e=e||{};var n={};function i(l,d){return xt.isPlainObject(l)&&xt.isPlainObject(d)?xt.merge(l,d):xt.isPlainObject(d)?xt.merge({},d):xt.isArray(d)?d.slice():d}function s(l){if(xt.isUndefined(e[l])){if(!xt.isUndefined(t[l]))return i(void 0,t[l])}else return i(t[l],e[l])}function o(l){if(!xt.isUndefined(e[l]))return i(void 0,e[l])}function a(l){if(xt.isUndefined(e[l])){if(!xt.isUndefined(t[l]))return i(void 0,t[l])}else return i(void 0,e[l])}function c(l){if(l in e)return i(t[l],e[l]);if(l in t)return i(void 0,t[l])}var u={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return xt.forEach(Object.keys(t).concat(Object.keys(e)),function(d){var m=u[d]||s,v=m(d);xt.isUndefined(v)&&m!==c||(n[d]=v)}),n},ei,ro;function Sa(){return ro||(ro=1,ei={version:"0.26.0"}),ei}var Qu=Sa().version,Wi={};["object","boolean","number","function","string","symbol"].forEach(function(r,t){Wi[r]=function(n){return typeof n===r||"a"+(t<1?"n ":" ")+r}});var no={};Wi.transitional=function(t,e,n){function i(s,o){return"[Axios v"+Qu+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return function(s,o,a){if(t===!1)throw new Error(i(o," has been removed"+(e?" in "+e:"")));return e&&!no[o]&&(no[o]=!0,console.warn(i(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,o,a):!0}};function tl(r,t,e){if(typeof r!="object")throw new TypeError("options must be an object");for(var n=Object.keys(r),i=n.length;i-- >0;){var s=n[i],o=t[s];if(o){var a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new TypeError("option "+s+" must be "+c);continue}if(e!==!0)throw Error("Unknown option "+s)}}var el={assertOptions:tl,validators:Wi},Ra=St,rl=Ji,io=ju,so=Xu,Dn=Aa,Oa=el,gr=Oa.validators;function zr(r){this.defaults=r,this.interceptors={request:new io,response:new io}}zr.prototype.request=function(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Dn(this.defaults,e),e.method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var n=e.transitional;n!==void 0&&Oa.assertOptions(n,{silentJSONParsing:gr.transitional(gr.boolean),forcedJSONParsing:gr.transitional(gr.boolean),clarifyTimeoutError:gr.transitional(gr.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(e)===!1||(s=s&&v.synchronous,i.unshift(v.fulfilled,v.rejected))});var o=[];this.interceptors.response.forEach(function(v){o.push(v.fulfilled,v.rejected)});var a;if(!s){var c=[so,void 0];for(Array.prototype.unshift.apply(c,i),c=c.concat(o),a=Promise.resolve(e);c.length;)a=a.then(c.shift(),c.shift());return a}for(var u=e;i.length;){var l=i.shift(),d=i.shift();try{u=l(u)}catch(m){d(m);break}}try{a=so(u)}catch(m){return Promise.reject(m)}for(;o.length;)a=a.then(o.shift(),o.shift());return a};zr.prototype.getUri=function(t){return t=Dn(this.defaults,t),rl(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")};Ra.forEach(["delete","get","head","options"],function(t){zr.prototype[t]=function(e,n){return this.request(Dn(n||{},{method:t,url:e,data:(n||{}).data}))}});Ra.forEach(["post","put","patch"],function(t){zr.prototype[t]=function(e,n,i){return this.request(Dn(i||{},{method:t,url:e,data:n}))}});var nl=zr,ri,oo;function il(){if(oo)return ri;oo=1;var r=Cn();function t(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var n;this.promise=new Promise(function(o){n=o});var i=this;this.promise.then(function(s){if(i._listeners){var o,a=i._listeners.length;for(o=0;o<a;o++)i._listeners[o](s);i._listeners=null}}),this.promise.then=function(s){var o,a=new Promise(function(c){i.subscribe(c),o=c}).then(s);return a.cancel=function(){i.unsubscribe(o)},a},e(function(o){i.reason||(i.reason=new r(o),n(i.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]},t.prototype.unsubscribe=function(n){if(this._listeners){var i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}},t.source=function(){var n,i=new t(function(o){n=o});return{token:i,cancel:n}},ri=t,ri}var ni,ao;function sl(){return ao||(ao=1,ni=function(t){return function(n){return t.apply(null,n)}}),ni}var ii,co;function ol(){if(co)return ii;co=1;var r=St;return ii=function(e){return r.isObject(e)&&e.isAxiosError===!0},ii}var uo=St,al=ya,un=nl,cl=Aa,ul=Mn();function Pa(r){var t=new un(r),e=al(un.prototype.request,t);return uo.extend(e,un.prototype,t),uo.extend(e,t),e.create=function(i){return Pa(cl(r,i))},e}var fe=Pa(ul);fe.Axios=un;fe.Cancel=Cn();fe.CancelToken=il();fe.isCancel=wa();fe.VERSION=Sa().version;fe.all=function(t){return Promise.all(t)};fe.spread=sl();fe.isAxiosError=ol();qi.exports=fe;qi.exports.default=fe;var ll=qi.exports,hl=ll;const lo=sa(hl);function Zi(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(d){o(d)}}function c(l){try{u(n.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(r,t||[])).next())})}const dl=ma,pl=Ji,fl=_a,{isUndefined:gl,isStandardBrowserEnv:ml,isFormData:yl}=St;function vl(r){return Zi(this,void 0,void 0,function*(){const t=bl(r),e=[El(t,r)];r.timeout&&r.timeout>0&&e.push(new Promise(i=>{setTimeout(()=>{const s=r.timeoutErrorMessage?r.timeoutErrorMessage:"timeout of "+r.timeout+"ms exceeded";i(Ai(s,r,"ECONNABORTED",t))},r.timeout)}));const n=yield Promise.race(e);return new Promise((i,s)=>{if(n instanceof Error)s(n);else{const o=r;"settle"in o&&Object.prototype.toString.call(o.settle)==="[object Function]"?o.settle(i,s,n):dl(i,s,n)}})})}function El(r,t){return Zi(this,void 0,void 0,function*(){try{const e=yield fetch(r);let n={ok:e.ok,status:e.status,statusText:e.statusText,headers:new Headers(e.headers),config:t,request:r};if(e.status>=400)return Ai("Response Error",t,"ERR_NETWORK",r,n);if(n={ok:e.ok,status:e.status,statusText:e.statusText,headers:new Headers(e.headers),config:t,request:r},e.status>=200&&e.status!==204)switch(t.responseType){case"arraybuffer":n.data=yield e.arrayBuffer();break;case"blob":n.data=yield e.blob();break;case"json":n.data=yield e.json();break;default:n.data=yield e.text();break}return n}catch{return Ai("Network Error",t,"ERR_NETWORK",r)}})}function bl(r){var t;const e=new Headers(r.headers);if(r.auth){const c=r.auth.username||"",u=r.auth.password?decodeURI(encodeURIComponent(r.auth.password)):"";e.set("Authorization",`Basic ${btoa(c+":"+u)}`)}const n=(t=r.method)===null||t===void 0?void 0:t.toUpperCase(),i={headers:e,method:n};n!=="GET"&&n!=="HEAD"&&(i.body=r.data,yl(i.body)&&ml()&&e.delete("Content-Type"));const s=r;"mode"in s&&(i.mode=s.mode),"cache"in s&&(i.cache=s.cache),"integrity"in s&&(i.integrity=s.integrity),"redirect"in s&&(i.redirect=s.redirect),"referrer"in s&&(i.referrer=s.referrer),gl(s.withCredentials)||(i.credentials=s.withCredentials?"include":"omit");const o=fl(s.baseURL,s.url),a=pl(o,s.params,s.paramsSerializer);return new Request(a,i)}function Ai(r,t,e,n,i){const s=new Error(r);return _l(s,t,e,n,i)}function _l(r,t,e,n,i){return r.config=t,e&&(r.code=e),r.request=n,r.response=i,r.isAxiosError=!0,r.toJSON=function(){return{message:this.message,name:this.name,description:"description"in this?this.description:void 0,number:"number"in this?this.number:void 0,fileName:"fileName"in this?this.fileName:void 0,lineNumber:"lineNumber"in this?this.lineNumber:void 0,columnNumber:"columnNumber"in this?this.columnNumber:void 0,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},r}class wl extends Nn{constructor(t,e,n){super(),this.method=t,this.url=e,this.cause=n,this.name="HttpRequestFailed",this.message=`${t} ${e} ${String(n)}`}}class Lr extends Nn{constructor(t,e,n,i,s){super(),this.message=t,this.status=e,this.statusText=n,this.body=i,this.url=s,this.name="HttpResponse"}}var Gr;(function(r){r[r.CONTINUE=100]="CONTINUE",r[r.SWITCHING_PROTOCOLS=101]="SWITCHING_PROTOCOLS",r[r.PROCESSING=102]="PROCESSING",r[r.OK=200]="OK",r[r.CREATED=201]="CREATED",r[r.ACCEPTED=202]="ACCEPTED",r[r.NON_AUTHORITATIVE_INFORMATION=203]="NON_AUTHORITATIVE_INFORMATION",r[r.NO_CONTENT=204]="NO_CONTENT",r[r.RESET_CONTENT=205]="RESET_CONTENT",r[r.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",r[r.MULTI_STATUS=207]="MULTI_STATUS",r[r.ALREADY_REPORTED=208]="ALREADY_REPORTED",r[r.IM_USED=226]="IM_USED",r[r.MULTIPLE_CHOICES=300]="MULTIPLE_CHOICES",r[r.MOVED_PERMANENTLY=301]="MOVED_PERMANENTLY",r[r.FOUND=302]="FOUND",r[r.SEE_OTHER=303]="SEE_OTHER",r[r.NOT_MODIFIED=304]="NOT_MODIFIED",r[r.USE_PROXY=305]="USE_PROXY",r[r.SWITCH_PROXY=306]="SWITCH_PROXY",r[r.TEMPORARY_REDIRECT=307]="TEMPORARY_REDIRECT",r[r.PERMANENT_REDIRECT=308]="PERMANENT_REDIRECT",r[r.BAD_REQUEST=400]="BAD_REQUEST",r[r.UNAUTHORIZED=401]="UNAUTHORIZED",r[r.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",r[r.FORBIDDEN=403]="FORBIDDEN",r[r.NOT_FOUND=404]="NOT_FOUND",r[r.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",r[r.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",r[r.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",r[r.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",r[r.CONFLICT=409]="CONFLICT",r[r.GONE=410]="GONE",r[r.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",r[r.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",r[r.PAYLOAD_TOO_LARGE=413]="PAYLOAD_TOO_LARGE",r[r.URI_TOO_LONG=414]="URI_TOO_LONG",r[r.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",r[r.RANGE_NOT_SATISFIABLE=416]="RANGE_NOT_SATISFIABLE",r[r.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",r[r.I_AM_A_TEAPOT=418]="I_AM_A_TEAPOT",r[r.MISDIRECTED_REQUEST=421]="MISDIRECTED_REQUEST",r[r.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",r[r.LOCKED=423]="LOCKED",r[r.FAILED_DEPENDENCY=424]="FAILED_DEPENDENCY",r[r.UPGRADE_REQUIRED=426]="UPGRADE_REQUIRED",r[r.PRECONDITION_REQUIRED=428]="PRECONDITION_REQUIRED",r[r.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",r[r.REQUEST_HEADER_FIELDS_TOO_LARGE=431]="REQUEST_HEADER_FIELDS_TOO_LARGE",r[r.UNAVAILABLE_FOR_LEGAL_REASONS=451]="UNAVAILABLE_FOR_LEGAL_REASONS",r[r.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",r[r.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",r[r.BAD_GATEWAY=502]="BAD_GATEWAY",r[r.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",r[r.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",r[r.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED",r[r.VARIANT_ALSO_NEGOTIATES=506]="VARIANT_ALSO_NEGOTIATES",r[r.INSUFFICIENT_STORAGE=507]="INSUFFICIENT_STORAGE",r[r.LOOP_DETECTED=508]="LOOP_DETECTED",r[r.NOT_EXTENDED=510]="NOT_EXTENDED",r[r.NETWORK_AUTHENTICATION_REQUIRED=511]="NETWORK_AUTHENTICATION_REQUIRED"})(Gr||(Gr={}));var si;const Ta=typeof process<"u"&&!!(!((si=process==null?void 0:process.versions)===null||si===void 0)&&si.node),Al=Ta?void 0:vl;var gn;(function(r){r.TEXT="text",r.JSON="json"})(gn||(gn={}));class Sl{constructor(t=3e4){this.timeout=t}serialize(t){if(!t)return"";const e=[];for(const i in t)if(t.hasOwnProperty(i)&&typeof t[i]<"u"){const s=typeof t[i].toJSON=="function"?t[i].toJSON():t[i];if(s===null){e.push(encodeURIComponent(i));continue}if(Array.isArray(s)){s.forEach(o=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(o))});continue}e.push(encodeURIComponent(i)+"="+encodeURIComponent(s))}const n=e.join("&");return n?`?${n}`:""}createRequest({url:t,method:e,timeout:n=this.timeout,query:i,headers:s={},json:o=!0},a){return Zi(this,void 0,void 0,function*(){const c=t+this.serialize(i);let u,l;s["Content-Type"]||(s["Content-Type"]="application/json"),o?u=gn.JSON:(u=gn.TEXT,l=[d=>d]);try{return(yield lo.request({url:c,method:e??"GET",headers:s,responseType:u,transformResponse:l,timeout:n,data:a,adapter:Al})).data}catch(d){if(lo.isAxiosError(d)&&d.response||!Ta&&d.response){let m;throw typeof d.response.data=="object"?m=JSON.stringify(d.response.data):m=d.response.data,new Lr(`Http error response: (${d.response.status}) ${m}`,d.response.status,d.response.statusText,m,c)}else throw new wl(String(e),c,d)}})}}function Zr(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(e[n[i]]=r[n[i]]);return e}function C(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(d){o(d)}}function c(l){try{u(n.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(r,t||[])).next())})}const Rl="main",B={block:"head"};var ho;(function(r){r.GET_BAKING_RIGHTS="getBakingRights",r.GET_BALLOTS="getBallots",r.GET_BALLOT_LIST="getBallotList",r.GET_BIG_MAP_KEY="getBigMapKey",r.GET_BIG_MAP_EXPR="getBigMapExpr",r.GET_BLOCK_HASH="getBlockHash",r.GET_BLOCK="getBlock",r.GET_BLOCK_HEADER="getBlockHeader",r.GET_BLOCK_METADATA="getBlockMetadata",r.GET_BALANCE="getBalance",r.GET_CHAIN_ID="getChainId",r.GET_CONSTANTS="getConstants",r.GET_CONTRACT="getContract",r.GET_CURRENT_PERIOD="getCurrentPeriod",r.GET_CURRENT_PROPOSAL="getCurrentProposal",r.GET_CURRENT_QUORUM="getCurrentQuorum",r.GET_DELEGATE="getDelegate",r.GET_DELEGATES="getDelegates",r.GET_VOTING_INFO="getVotingInfo",r.GET_ENDORSING_RIGHTS="getEndorsingRights",r.GET_ENTRYPOINTS="getEntrypoints",r.GET_LIVE_BLOCKS="getLiveBlocks",r.GET_MANAGER_KEY="getManagerKey",r.GET_NORMALIZED_SCRIPT="getNormalizedScript",r.GET_PROPOSALS="getProposals",r.GET_PROTOCOLS="getProtocols",r.GET_SAPLING_DIFF_BY_CONTRACT="getSaplingDiffByContract",r.GET_SAPLING_DIFF_BY_ID="getSaplingDiffById",r.GET_SCRIPT="getScript",r.GET_STORAGE="getStorage",r.GET_SUCCESSOR_PERIOD="getSuccessorPeriod",r.GET_TX_ROLLUP_INBOX="getTxRollupInbox",r.GET_TX_ROLLUP_STATE="getTxRollupState",r.GET_VOTES_LISTINGS="getVotesListings",r.PACK_DATA="packData",r.GET_STORAGE_USED_SPACE="getStorageUsedSpace",r.GET_STORAGE_PAID_SPACE="getStoragePaidSpace",r.GET_TICKET_BALANCE="getTicketBalance",r.GET_ALL_TICKET_BALANCES="getAllTicketBalances",r.GET_PENDING_OPERATIONS="getPendingOperations",r.GET_ORIGINATION_PROOF="getOriginationProof"})(ho||(ho={}));function Hr(r,t){const e=Array.isArray(r);typeof t>"u"&&(t=Object.keys(r));const n=e?[]:{};return t.forEach(i=>{const s=r[i];let o;if(!(typeof s>"u")){if(Array.isArray(s)){o=Hr(s),n[i]=o;return}o=new I(s),n[i]=o}}),n}var po;(function(r){r.TOO_LARGE="too large"})(po||(po={}));var fo;(function(r){r.BAKING_REWARDS="baking rewards",r.REWARDS="rewards",r.FEES="fees",r.DEPOSITS="deposits",r.LEGACY_REWARDS="legacy_rewards",r.LEGACY_FEES="legacy_fees",r.LEGACY_DEPOSITS="legacy_deposits",r.BLOCK_FEES="block fees",r.NONCE_REVELATION_REWARDS="nonce revelation rewards",r.DOUBLE_SIGNING_EVIDENCE_REWARDS="double signing evidence rewards",r.ENDORSING_REWARDS="endorsing rewards",r.BAKING_BONUSES="baking bonuses",r.STORAGE_FEES="storage fees",r.PUNISHMENTS="punishments",r.LOST_ENDORSING_REWARDS="lost endorsing rewards",r.SUBSIDY="subsidy",r.BURNED="burned",r.COMMITMENT="commitment",r.BOOTSTRAP="bootstrap",r.INVOICE="invoice",r.MINTED="minted",r.TX_ROLLUP_REJECTION_REWARDS="tx_rollup_rejection_rewards",r.TX_ROLLUP_REJECTION_PUNISHMENTS="tx_rollup_rejection_punishments",r.BONDS="bonds"})(fo||(fo={}));var go;(function(r){r.WASM2="wasm_2_0_0",r.ARITH="arith"})(go||(go={}));var mo;(function(r){r.START="start",r.MOVE="move"})(mo||(mo={}));var yo;(function(r){r.INBOX_PROOF="inbox_proof",r.REVEAL_PROOF="reveal_proof",r.FIRST_INPUT="first_input"})(yo||(yo={}));var vo;(function(r){r.RAW_DATA_PROOF="raw_data_proof",r.METADATA_PROOF="metadata_proof",r.DAL_PAGE_PROOF="dal_page_proof"})(vo||(vo={}));var Eo;(function(r){r.ONGOING="ongoing",r.ENDED="ended"})(Eo||(Eo={}));var bo;(function(r){r.LOSER="loser",r.DRAW="draw"})(bo||(bo={}));var _o;(function(r){r.CONFLICT_RESOLVED="conflict_resolved",r.TIMEOUT="timeout"})(_o||(_o={}));var E;(function(r){r.ORIGINATION="origination",r.DELEGATION="delegation",r.REVEAL="reveal",r.TRANSACTION="transaction",r.ACTIVATION="activate_account",r.ENDORSEMENT="endorsement",r.PREENDORSEMENT="preendorsement",r.SET_DEPOSITS_LIMIT="set_deposits_limit",r.DOUBLE_PREENDORSEMENT_EVIDENCE="double_preendorsement_evidence",r.ENDORSEMENT_WITH_SLOT="endorsement_with_slot",r.SEED_NONCE_REVELATION="seed_nonce_revelation",r.DOUBLE_ENDORSEMENT_EVIDENCE="double_endorsement_evidence",r.DOUBLE_BAKING_EVIDENCE="double_baking_evidence",r.PROPOSALS="proposals",r.BALLOT="ballot",r.FAILING_NOOP="failing_noop",r.REGISTER_GLOBAL_CONSTANT="register_global_constant",r.TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.TX_ROLLUP_COMMIT="tx_rollup_commit",r.TX_ROLLUP_RETURN_BOND="tx_rollup_return_bond",r.TX_ROLLUP_FINALIZE_COMMITMENT="tx_rollup_finalize_commitment",r.TX_ROLLUP_REMOVE_COMMITMENT="tx_rollup_remove_commitment",r.TX_ROLLUP_REJECTION="tx_rollup_rejection",r.TX_ROLLUP_DISPATCH_TICKETS="tx_rollup_dispatch_tickets",r.TRANSFER_TICKET="transfer_ticket",r.INCREASE_PAID_STORAGE="increase_paid_storage",r.UPDATE_CONSENSUS_KEY="update_consensus_key",r.DRAIN_DELEGATE="drain_delegate",r.VDF_REVELATION="vdf_revelation",r.EVENT="event",r.TICKET_UPDATES="ticket_updates",r.SMART_ROLLUP_ORIGINATE="smart_rollup_originate",r.SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",r.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message",r.SMART_ROLLUP_PUBLISH="smart_rollup_publish",r.SMART_ROLLUP_CEMENT="smart_rollup_cement",r.SMART_ROLLUP_RECOVER_BOND="smart_rollup_recover_bond",r.SMART_ROLLUP_REFUTE="smart_rollup_refute",r.SMART_ROLLUP_TIMEOUT="smart_rollup_timeout"})(E||(E={}));class ln{constructor(t,e=Rl,n=new Sl){this.url=t,this.chain=e,this.httpBackend=n}createURL(t){return`${this.url.replace(/\/+$/g,"")}${t}`}validateAddress(t){const e=V(t);if(e!==T.VALID)throw new z(t,$(e))}validateContract(t){const e=br(t);if(e!==T.VALID)throw new cr(t,$(e))}getBlockHash({block:t}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/hash`),method:"GET"})})}getLiveBlocks({block:t}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/live_blocks`),method:"GET"})})}getBalance(t,{block:e}=B){return C(this,void 0,void 0,function*(){this.validateAddress(t);const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/balance`),method:"GET"});return new I(n)})}getStorage(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage`),method:"GET"})})}getScript(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/script`),method:"GET"})})}getNormalizedScript(t,e={unparsing_mode:"Readable"},{block:n}=B){return C(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${t}/script/normalized`),method:"POST"},e)})}getContract(t,{block:e}=B){return C(this,void 0,void 0,function*(){this.validateAddress(t);const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}`),method:"GET"});return Object.assign(Object.assign({},n),{balance:new I(n.balance)})})}getManagerKey(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/manager_key`),method:"GET"})})}getDelegate(t,{block:e}=B){return C(this,void 0,void 0,function*(){this.validateAddress(t);let n;try{n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/delegate`),method:"GET"})}catch(i){if(i instanceof Lr&&i.status===Gr.NOT_FOUND)n=null;else throw i}return n})}getBigMapKey(t,e,{block:n}=B){return C(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${t}/big_map_get`),method:"POST"},e)})}getBigMapExpr(t,e,{block:n}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/big_maps/${t}/${e}`),method:"GET"})})}getDelegates(t,{block:e}=B){return C(this,void 0,void 0,function*(){this.validateAddress(t);const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}`),method:"GET"}),i=Hr(n,["balance","full_balance","current_frozen_deposits","frozen_deposits","frozen_balance","frozen_deposits_limit","staking_balance","delegated_balance","voting_power"]);return Object.assign(Object.assign(Object.assign({},n),i),{frozen_balance_by_cycle:n.frozen_balance_by_cycle?n.frozen_balance_by_cycle.map(s=>{var{deposit:o,deposits:a,fees:c,rewards:u}=s,l=Zr(s,["deposit","deposits","fees","rewards"]);const d=Hr({deposit:o,deposits:a,fees:c,rewards:u},["deposit","deposits","fees","rewards"]);return Object.assign(Object.assign({},l),{deposit:d.deposit,deposits:d.deposits,fees:d.fees,rewards:d.rewards})}):void 0})})}getVotingInfo(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.validateAddress(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}/voting_info`),method:"GET"})})}getConstants({block:t}=B){return C(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/context/constants`),method:"GET"}),n=Hr(e,["time_between_blocks","hard_gas_limit_per_operation","hard_gas_limit_per_block","proof_of_work_threshold","tokens_per_roll","seed_nonce_revelation_tip","block_security_deposit","endorsement_security_deposit","block_reward","endorsement_reward","cost_per_byte","hard_storage_limit_per_operation","test_chain_duration","baking_reward_per_endorsement","delay_per_missing_endorsement","minimal_block_delay","liquidity_baking_subsidy","cache_layout","baking_reward_fixed_portion","baking_reward_bonus_per_slot","endorsing_reward_per_slot","double_baking_punishment","delay_increment_per_round","tx_rollup_commitment_bond","vdf_difficulty","sc_rollup_stake_amount","minimal_stake"]);return Object.assign(Object.assign({},e),n)})}getBlock({block:t}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}`),method:"GET"})})}getBlockHeader({block:t}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/header`),method:"GET"})})}getBlockMetadata({block:t}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/metadata`),method:"GET"})})}getBakingRights(t={},{block:e}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/baking_rights`),method:"GET",query:t})})}getEndorsingRights(t={},{block:e}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/endorsing_rights`),method:"GET",query:t})})}getBallotList({block:t}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballot_list`),method:"GET"})})}getBallots({block:t}=B){return C(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballots`),method:"GET"});return Hr(e,["yay","nay","pass"])})}getCurrentProposal({block:t}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_proposal`),method:"GET"})})}getCurrentQuorum({block:t}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_quorum`),method:"GET"})})}getVotesListings({block:t}=B){return C(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/listings`),method:"GET"});return e.map(n=>(n.voting_power&&(n.voting_power=new I(n.voting_power)),n)),e})}getProposals({block:t}=B){return C(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/proposals`),method:"GET"});return e.map(n=>n[1]=new I(n[1])),e})}forgeOperations(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/forge/operations`),method:"POST"},t)})}injectOperation(t){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL("/injection/operation"),method:"POST"},t)})}preapplyOperations(t,{block:e}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/preapply/operations`),method:"POST"},t)})}getEntrypoints(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.validateContract(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/entrypoints`),method:"GET"})})}runOperation(t,{block:e}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_operation`),method:"POST"},t)})}simulateOperation(t,{block:e}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/simulate_operation`),method:"POST"},t)})}runCode(t,{block:e}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_code`),method:"POST"},t)})}runScriptView(t,{block:e}=B){var{unparsing_mode:n="Readable"}=t,i=Zr(t,["unparsing_mode"]);return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_script_view`),method:"POST"},Object.assign({unparsing_mode:n},i))})}runView(t,{block:e}=B){var{unparsing_mode:n="Readable"}=t,i=Zr(t,["unparsing_mode"]);return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_view`),method:"POST"},Object.assign({unparsing_mode:n},i))})}getChainId(){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/chain_id`),method:"GET"})})}packData(t,{block:e}=B){return C(this,void 0,void 0,function*(){const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/pack_data`),method:"POST"},t),{gas:i}=n,s=Zr(n,["gas"]);let o=i;const a=new I(i||"");return a.isNaN()||(o=a),Object.assign({gas:o},s)})}getRpcUrl(){return this.url}getCurrentPeriod({block:t}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_period`),method:"GET"})})}getSuccessorPeriod({block:t}=B){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/successor_period`),method:"GET"})})}getSaplingDiffById(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/sapling/${t}/get_diff`),method:"GET"})})}getSaplingDiffByContract(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/single_sapling_get_diff`),method:"GET"})})}getProtocols({block:t}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/protocols`),method:"GET"})})}getTxRollupState(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/tx_rollup/${t}/state`),method:"GET"})})}getTxRollupInbox(t,e,{block:n}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/tx_rollup/${t}/inbox/${e}`),method:"GET"})})}getStorageUsedSpace(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage/used_space`),method:"GET"})})}getStoragePaidSpace(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage/paid_space`),method:"GET"})})}getTicketBalance(t,e,{block:n}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${t}/ticket_balance`),method:"POST"},e)})}getAllTicketBalances(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/all_ticket_balances`),method:"GET"})})}getPendingOperations(t={}){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/mempool/pending_operations`),method:"GET",query:t})})}getOriginationProof(t,{block:e}=B){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/smart_rollups/all/origination_proof`),method:"POST"},t)})}}var Si=function(r,t){return Si=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},Si(r,t)};function zt(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Si(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Ol(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(d){o(d)}}function c(l){try{u(n.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(r,t||[])).next())})}function Ia(r,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(e=0)),e;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,i=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){e.label=u[1];break}if(u[0]===6&&e.label<s[1]){e.label=s[1],s=u;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(u);break}s[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(r,e)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Sr(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Me(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var n=e.call(r),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(o)throw o.error}}return s}function De(r,t,e){if(e||arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return r.concat(s||Array.prototype.slice.call(t))}function _r(r){return this instanceof _r?(this.v=r,this):new _r(r)}function Pl(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(r,t||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(m){n[m]&&(i[m]=function(v){return new Promise(function(b,w){s.push([m,v,b,w])>1||a(m,v)})})}function a(m,v){try{c(n[m](v))}catch(b){d(s[0][3],b)}}function c(m){m.value instanceof _r?Promise.resolve(m.value.v).then(u,l):d(s[0][2],m)}function u(m){a("next",m)}function l(m){a("throw",m)}function d(m,v){m(v),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Tl(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=r[Symbol.asyncIterator],e;return t?t.call(r):(r=typeof Sr=="function"?Sr(r):r[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(s){e[s]=r[s]&&function(o){return new Promise(function(a,c){o=r[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function Y(r){return typeof r=="function"}function kn(r){var t=function(n){Error.call(n),n.stack=new Error().stack},e=r(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var oi=kn(function(r){return function(e){r(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function mn(r,t){if(r){var e=r.indexOf(t);0<=e&&r.splice(e,1)}}var lr=function(){function r(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var t,e,n,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Sr(o),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(w){t={error:w}}finally{try{c&&!c.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else o.remove(this);var l=this.initialTeardown;if(Y(l))try{l()}catch(w){s=w instanceof oi?w.errors:[w]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var m=Sr(d),v=m.next();!v.done;v=m.next()){var b=v.value;try{wo(b)}catch(w){s=s??[],w instanceof oi?s=De(De([],Me(s)),Me(w.errors)):s.push(w)}}}catch(w){n={error:w}}finally{try{v&&!v.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}}if(s)throw new oi(s)}},r.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)wo(t);else{if(t instanceof r){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},r.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},r.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},r.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&mn(e,t)},r.prototype.remove=function(t){var e=this._finalizers;e&&mn(e,t),t instanceof r&&t._removeParent(this)},r.EMPTY=function(){var t=new r;return t.closed=!0,t}(),r}(),Na=lr.EMPTY;function La(r){return r instanceof lr||r&&"closed"in r&&Y(r.remove)&&Y(r.add)&&Y(r.unsubscribe)}function wo(r){Y(r)?r():r.unsubscribe()}var xa={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ri={setTimeout:function(r,t){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];var i=Ri.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,De([r,t],Me(e))):setTimeout.apply(void 0,De([r,t],Me(e)))},clearTimeout:function(r){var t=Ri.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(r)},delegate:void 0};function Ca(r){Ri.setTimeout(function(){throw r})}function yn(){}function hn(r){r()}var Yi=function(r){zt(t,r);function t(e){var n=r.call(this)||this;return n.isStopped=!1,e?(n.destination=e,La(e)&&e.add(n)):n.destination=xl,n}return t.create=function(e,n,i){return new Kr(e,n,i)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(lr),Il=Function.prototype.bind;function ai(r,t){return Il.call(r,t)}var Nl=function(){function r(t){this.partialObserver=t}return r.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(n){Yr(n)}},r.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(n){Yr(n)}else Yr(t)},r.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){Yr(e)}},r}(),Kr=function(r){zt(t,r);function t(e,n,i){var s=r.call(this)||this,o;if(Y(e)||!e)o={next:e??void 0,error:n??void 0,complete:i??void 0};else{var a;s&&xa.useDeprecatedNextContext?(a=Object.create(e),a.unsubscribe=function(){return s.unsubscribe()},o={next:e.next&&ai(e.next,a),error:e.error&&ai(e.error,a),complete:e.complete&&ai(e.complete,a)}):o=e}return s.destination=new Nl(o),s}return t}(Yi);function Yr(r){Ca(r)}function Ll(r){throw r}var xl={closed:!0,next:yn,error:Ll,complete:yn},Xi=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function er(r){return r}function Cl(r){return r.length===0?er:r.length===1?r[0]:function(e){return r.reduce(function(n,i){return i(n)},e)}}var et=function(){function r(t){t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,n){var i=this,s=Dl(t)?t:new Kr(t,e,n);return hn(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},r.prototype.forEach=function(t,e){var n=this;return e=Ao(e),new e(function(i,s){var o=new Kr({next:function(a){try{t(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});n.subscribe(o)})},r.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},r.prototype[Xi]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Cl(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=Ao(t),new t(function(n,i){var s;e.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},r.create=function(t){return new r(t)},r}();function Ao(r){var t;return(t=r??xa.Promise)!==null&&t!==void 0?t:Promise}function Ml(r){return r&&Y(r.next)&&Y(r.error)&&Y(r.complete)}function Dl(r){return r&&r instanceof Yi||Ml(r)&&La(r)}function Ma(r){return Y(r==null?void 0:r.lift)}function ut(r){return function(t){if(Ma(t))return t.lift(function(e){try{return r(e,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function ot(r,t,e,n,i){return new kl(r,t,e,n,i)}var kl=function(r){zt(t,r);function t(e,n,i,s,o,a){var c=r.call(this,e)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=n?function(u){try{n(u)}catch(l){e.error(l)}}:r.prototype._next,c._error=s?function(u){try{s(u)}catch(l){e.error(l)}finally{this.unsubscribe()}}:r.prototype._error,c._complete=i?function(){try{i()}catch(u){e.error(u)}finally{this.unsubscribe()}}:r.prototype._complete,c}return t.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;r.prototype.unsubscribe.call(this),!n&&((e=this.onFinalize)===null||e===void 0||e.call(this))}},t}(Yi);function Da(){return ut(function(r,t){var e=null;r._refCount++;var n=ot(t,void 0,void 0,void 0,function(){if(!r||r._refCount<=0||0<--r._refCount){e=null;return}var i=r._connection,s=e;e=null,i&&(!s||i===s)&&i.unsubscribe(),t.unsubscribe()});r.subscribe(n),n.closed||(e=r.connect())})}var Bl=function(r){zt(t,r);function t(e,n){var i=r.call(this)||this;return i.source=e,i.subjectFactory=n,i._subject=null,i._refCount=0,i._connection=null,Ma(e)&&(i.lift=e.lift),i}return t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,e==null||e.unsubscribe()},t.prototype.connect=function(){var e=this,n=this._connection;if(!n){n=this._connection=new lr;var i=this.getSubject();n.add(this.source.subscribe(ot(i,void 0,function(){e._teardown(),i.complete()},function(s){e._teardown(),i.error(s)},function(){return e._teardown()}))),n.closed&&(this._connection=null,n=lr.EMPTY)}return n},t.prototype.refCount=function(){return Da()(this)},t}(et),$l=kn(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),dr=function(r){zt(t,r);function t(){var e=r.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var n=new So(this,this);return n.operator=e,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new $l},t.prototype.next=function(e){var n=this;hn(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=Sr(n.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(e)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},t.prototype.error=function(e){var n=this;hn(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=e;for(var i=n.observers;i.length;)i.shift().error(e)}})},t.prototype.complete=function(){var e=this;hn(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var n=e.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var n=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Na:(this.currentObservers=null,a.push(e),new lr(function(){n.currentObservers=null,mn(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var n=this,i=n.hasError,s=n.thrownError,o=n.isStopped;i?e.error(s):o&&e.complete()},t.prototype.asObservable=function(){var e=new et;return e.source=this,e},t.create=function(e,n){return new So(e,n)},t}(et),So=function(r){zt(t,r);function t(e,n){var i=r.call(this)||this;return i.destination=e,i.source=n,i}return t.prototype.next=function(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,e)},t.prototype.error=function(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,e)},t.prototype.complete=function(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)},t.prototype._subscribe=function(e){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&i!==void 0?i:Na},t}(dr),Bn=function(r){zt(t,r);function t(e){var n=r.call(this)||this;return n._value=e,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(e){var n=r.prototype._subscribe.call(this,e);return!n.closed&&e.next(this._value),n},t.prototype.getValue=function(){var e=this,n=e.hasError,i=e.thrownError,s=e._value;if(n)throw i;return this._throwIfClosed(),s},t.prototype.next=function(e){r.prototype.next.call(this,this._value=e)},t}(dr),Qi={now:function(){return(Qi.delegate||Date).now()},delegate:void 0},or=function(r){zt(t,r);function t(e,n,i){e===void 0&&(e=1/0),n===void 0&&(n=1/0),i===void 0&&(i=Qi);var s=r.call(this)||this;return s._bufferSize=e,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,e),s._windowTime=Math.max(1,n),s}return t.prototype.next=function(e){var n=this,i=n.isStopped,s=n._buffer,o=n._infiniteTimeWindow,a=n._timestampProvider,c=n._windowTime;i||(s.push(e),!o&&s.push(a.now()+c)),this._trimBuffer(),r.prototype.next.call(this,e)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(e),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!e.closed;c+=s?1:2)e.next(a[c]);return this._checkFinalizedStatuses(e),n},t.prototype._trimBuffer=function(){var e=this,n=e._bufferSize,i=e._timestampProvider,s=e._buffer,o=e._infiniteTimeWindow,a=(o?1:2)*n;if(n<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),u=0,l=1;l<s.length&&s[l]<=c;l+=2)u=l;u&&s.splice(0,u+1)}},t}(dr),Hl=function(r){zt(t,r);function t(e,n){return r.call(this)||this}return t.prototype.schedule=function(e,n){return this},t}(lr),vn={setInterval:function(r,t){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];var i=vn.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,De([r,t],Me(e))):setInterval.apply(void 0,De([r,t],Me(e)))},clearInterval:function(r){var t=vn.delegate;return((t==null?void 0:t.clearInterval)||clearInterval)(r)},delegate:void 0},jl=function(r){zt(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return t.prototype.schedule=function(e,n){var i;if(n===void 0&&(n=0),this.closed)return this;this.state=e;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,n)),this.pending=!0,this.delay=n,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,n),this},t.prototype.requestAsyncId=function(e,n,i){return i===void 0&&(i=0),vn.setInterval(e.flush.bind(e,this),i)},t.prototype.recycleAsyncId=function(e,n,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return n;n!=null&&vn.clearInterval(n)},t.prototype.execute=function(e,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(e,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,n){var i=!1,s;try{this.work(e)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},t.prototype.unsubscribe=function(){if(!this.closed){var e=this,n=e.id,i=e.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,mn(s,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,r.prototype.unsubscribe.call(this)}},t}(Hl),Ro=function(){function r(t,e){e===void 0&&(e=r.now),this.schedulerActionCtor=t,this.now=e}return r.prototype.schedule=function(t,e,n){return e===void 0&&(e=0),new this.schedulerActionCtor(this,t).schedule(n,e)},r.now=Qi.now,r}(),Ul=function(r){zt(t,r);function t(e,n){n===void 0&&(n=Ro.now);var i=r.call(this,e,n)||this;return i.actions=[],i._active=!1,i}return t.prototype.flush=function(e){var n=this.actions;if(this._active){n.push(e);return}var i;this._active=!0;do if(i=e.execute(e.state,e.delay))break;while(e=n.shift());if(this._active=!1,i){for(;e=n.shift();)e.unsubscribe();throw i}},t}(Ro),ka=new Ul(jl),Gl=ka,ts=new et(function(r){return r.complete()});function Ba(r){return r&&Y(r.schedule)}function $a(r){return r[r.length-1]}function Kl(r){return Y($a(r))?r.pop():void 0}function $n(r){return Ba($a(r))?r.pop():void 0}var Ha=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function ja(r){return Y(r==null?void 0:r.then)}function Ua(r){return Y(r[Xi])}function Ga(r){return Symbol.asyncIterator&&Y(r==null?void 0:r[Symbol.asyncIterator])}function Ka(r){return new TypeError("You provided "+(r!==null&&typeof r=="object"?"an invalid object":"'"+r+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Vl(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Va=Vl();function Fa(r){return Y(r==null?void 0:r[Va])}function za(r){return Pl(this,arguments,function(){var e,n,i,s;return Ia(this,function(o){switch(o.label){case 0:e=r.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,_r(e.read())];case 3:return n=o.sent(),i=n.value,s=n.done,s?[4,_r(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,_r(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function Ja(r){return Y(r==null?void 0:r.getReader)}function Tt(r){if(r instanceof et)return r;if(r!=null){if(Ua(r))return Fl(r);if(Ha(r))return zl(r);if(ja(r))return Jl(r);if(Ga(r))return qa(r);if(Fa(r))return ql(r);if(Ja(r))return Wl(r)}throw Ka(r)}function Fl(r){return new et(function(t){var e=r[Xi]();if(Y(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function zl(r){return new et(function(t){for(var e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()})}function Jl(r){return new et(function(t){r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,Ca)})}function ql(r){return new et(function(t){var e,n;try{for(var i=Sr(r),s=i.next();!s.done;s=i.next()){var o=s.value;if(t.next(o),t.closed)return}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}t.complete()})}function qa(r){return new et(function(t){Zl(r,t).catch(function(e){return t.error(e)})})}function Wl(r){return qa(za(r))}function Zl(r,t){var e,n,i,s;return Ol(this,void 0,void 0,function(){var o,a;return Ia(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),e=Tl(r),c.label=1;case 1:return[4,e.next()];case 2:if(n=c.sent(),!!n.done)return[3,4];if(o=n.value,t.next(o),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(s=e.return)?[4,s.call(e)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function le(r,t,e,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var s=t.schedule(function(){e(),i?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(s),!i)return s}function Wa(r,t){return t===void 0&&(t=0),ut(function(e,n){e.subscribe(ot(n,function(i){return le(n,r,function(){return n.next(i)},t)},function(){return le(n,r,function(){return n.complete()},t)},function(i){return le(n,r,function(){return n.error(i)},t)}))})}function Za(r,t){return t===void 0&&(t=0),ut(function(e,n){n.add(r.schedule(function(){return e.subscribe(n)},t))})}function Yl(r,t){return Tt(r).pipe(Za(t),Wa(t))}function Xl(r,t){return Tt(r).pipe(Za(t),Wa(t))}function Ql(r,t){return new et(function(e){var n=0;return t.schedule(function(){n===r.length?e.complete():(e.next(r[n++]),e.closed||this.schedule())})})}function th(r,t){return new et(function(e){var n;return le(e,t,function(){n=r[Va](),le(e,t,function(){var i,s,o;try{i=n.next(),s=i.value,o=i.done}catch(a){e.error(a);return}o?e.complete():e.next(s)},0,!0)}),function(){return Y(n==null?void 0:n.return)&&n.return()}})}function Ya(r,t){if(!r)throw new Error("Iterable cannot be null");return new et(function(e){le(e,t,function(){var n=r[Symbol.asyncIterator]();le(e,t,function(){n.next().then(function(i){i.done?e.complete():e.next(i.value)})},0,!0)})})}function eh(r,t){return Ya(za(r),t)}function rh(r,t){if(r!=null){if(Ua(r))return Yl(r,t);if(Ha(r))return Ql(r,t);if(ja(r))return Xl(r,t);if(Ga(r))return Ya(r,t);if(Fa(r))return th(r,t);if(Ja(r))return eh(r,t)}throw Ka(r)}function rr(r,t){return t?rh(r,t):Tt(r)}function Hn(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=$n(r);return rr(r,e)}function Xa(r,t){var e=Y(r)?r:function(){return r},n=function(i){return i.error(e())};return new et(t?function(i){return t.schedule(n,0,i)}:n)}var Qa=kn(function(r){return function(){r(this),this.name="EmptyError",this.message="no elements in sequence"}});function tc(r){return r instanceof Date&&!isNaN(r)}var nh=kn(function(r){return function(e){e===void 0&&(e=null),r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function ec(r,t){var e=tc(r)?{first:r}:typeof r=="number"?{each:r}:r,n=e.first,i=e.each,s=e.with,o=s===void 0?ih:s,a=e.scheduler,c=a===void 0?t??ka:a,u=e.meta,l=u===void 0?null:u;if(n==null&&i==null)throw new TypeError("No timeout provided.");return ut(function(d,m){var v,b,w=null,O=0,A=function(_){b=le(m,c,function(){try{v.unsubscribe(),Tt(o({meta:l,lastValue:w,seen:O})).subscribe(m)}catch(It){m.error(It)}},_)};v=d.subscribe(ot(m,function(_){b==null||b.unsubscribe(),O++,m.next(w=_),i>0&&A(i)},void 0,void 0,function(){b!=null&&b.closed||b==null||b.unsubscribe(),w=null})),!O&&A(n!=null?typeof n=="number"?n:+n-c.now():i)})}function ih(r){throw new nh(r)}function ur(r,t){return ut(function(e,n){var i=0;e.subscribe(ot(n,function(s){n.next(r.call(t,s,i++))}))})}var sh=Array.isArray;function oh(r,t){return sh(t)?r.apply(void 0,De([],Me(t))):r(t)}function ah(r){return ur(function(t){return oh(r,t)})}var ch=Array.isArray,uh=Object.getPrototypeOf,lh=Object.prototype,hh=Object.keys;function dh(r){if(r.length===1){var t=r[0];if(ch(t))return{args:t,keys:null};if(ph(t)){var e=hh(t);return{args:e.map(function(n){return t[n]}),keys:e}}}return{args:r,keys:null}}function ph(r){return r&&typeof r=="object"&&uh(r)===lh}function fh(r,t){return r.reduce(function(e,n,i){return e[n]=t[i],e},{})}function Oo(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=$n(r),n=Kl(r),i=dh(r),s=i.args,o=i.keys;if(s.length===0)return rr([],e);var a=new et(gh(s,e,o?function(c){return fh(o,c)}:er));return n?a.pipe(ah(n)):a}function gh(r,t,e){return e===void 0&&(e=er),function(n){Po(t,function(){for(var i=r.length,s=new Array(i),o=i,a=i,c=function(l){Po(t,function(){var d=rr(r[l],t),m=!1;d.subscribe(ot(n,function(v){s[l]=v,m||(m=!0,a--),a||n.next(e(s.slice()))},function(){--o||n.complete()}))},n)},u=0;u<i;u++)c(u)},n)}}function Po(r,t,e){r?le(e,r,t):t()}function mh(r,t,e,n,i,s,o,a){var c=[],u=0,l=0,d=!1,m=function(){d&&!c.length&&!u&&t.complete()},v=function(w){return u<n?b(w):c.push(w)},b=function(w){s&&t.next(w),u++;var O=!1;Tt(e(w,l++)).subscribe(ot(t,function(A){i==null||i(A),s?v(A):t.next(A)},function(){O=!0},void 0,function(){if(O)try{u--;for(var A=function(){var _=c.shift();o?le(t,o,function(){return b(_)}):b(_)};c.length&&u<n;)A();m()}catch(_){t.error(_)}}))};return r.subscribe(ot(t,v,function(){d=!0,m()})),function(){a==null||a()}}function Vr(r,t,e){return e===void 0&&(e=1/0),Y(t)?Vr(function(n,i){return ur(function(s,o){return t(n,s,i,o)})(Tt(r(n,i)))},e):(typeof t=="number"&&(e=t),ut(function(n,i){return mh(n,i,r,e)}))}function yh(r){return r===void 0&&(r=1/0),Vr(er,r)}function vh(){return yh(1)}function En(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return vh()(rr(r,$n(r)))}function rc(r){return new et(function(t){Tt(r()).subscribe(t)})}function Oi(r,t,e){r===void 0&&(r=0),e===void 0&&(e=Gl);var n=-1;return t!=null&&(Ba(t)?e=t:n=t),new et(function(i){var s=tc(r)?+r-e.now():r;s<0&&(s=0);var o=0;return e.schedule(function(){i.closed||(i.next(o++),0<=n?this.schedule(void 0,n):i.complete())},s)})}var Eh=new et(yn);function bn(r,t){return ut(function(e,n){var i=0;e.subscribe(ot(n,function(s){return r.call(t,s,i++)&&n.next(s)}))})}function es(r,t,e){if(t==null&&(t=r,r=0),t<=0)return ts;var n=t+r;return new et(e?function(i){var s=r;return e.schedule(function(){s<n?(i.next(s++),this.schedule()):i.complete()})}:function(i){for(var s=r;s<n&&!i.closed;)i.next(s++);i.complete()})}function jn(r){return ut(function(t,e){var n=null,i=!1,s;n=t.subscribe(ot(e,void 0,void 0,function(o){s=Tt(r(o,jn(r)(t))),n?(n.unsubscribe(),n=null,s.subscribe(e)):i=!0})),i&&(n.unsubscribe(),n=null,s.subscribe(e))})}function Jr(r,t){return Y(t)?Vr(r,t,1):Vr(r,1)}function bh(r){return new et(function(t){return r.subscribe(t)})}var _h={connector:function(){return new dr}};function nc(r,t){t===void 0&&(t=_h);var e=t.connector;return ut(function(n,i){var s=e();Tt(r(bh(s))).subscribe(i),i.add(n.subscribe(s))})}function wh(r){return ut(function(t,e){var n=!1;t.subscribe(ot(e,function(i){n=!0,e.next(i)},function(){n||e.next(r),e.complete()}))})}function Ah(r){return r<=0?function(){return ts}:ut(function(t,e){var n=0;t.subscribe(ot(e,function(i){++n<=r&&(e.next(i),r<=n&&e.complete())}))})}function ic(r,t){return t===void 0&&(t=er),r=r??Sh,ut(function(e,n){var i,s=!0;e.subscribe(ot(n,function(o){var a=t(o);(s||!r(i,a))&&(s=!1,i=a,n.next(o))}))})}function Sh(r,t){return r===t}function Rh(r,t){return ic(function(e,n){return t?t(e[r],n[r]):e[r]===n[r]})}function Oh(r){return r===void 0&&(r=Ph),ut(function(t,e){var n=!1;t.subscribe(ot(e,function(i){n=!0,e.next(i)},function(){return n?e.complete():e.error(r())}))})}function Ph(){return new Qa}function sc(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(e){return En(e,Hn.apply(void 0,De([],Me(r))))}}function Oe(r,t){var e=arguments.length>=2;return function(n){return n.pipe(r?bn(function(i,s){return r(i,s,n)}):er,Ah(1),e?wh(t):Oh(function(){return new Qa}))}}function Th(r,t){var e=Y(r)?r:function(){return r};return Y(t)?nc(t,{connector:e}):function(n){return new Bl(n,e)}}function To(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r.length;if(e===0)throw new Error("list of properties cannot be empty.");return ur(function(n){for(var i=n,s=0;s<e;s++){var o=i==null?void 0:i[r[s]];if(typeof o<"u")i=o;else return}return i})}function Ih(r){return r?function(t){return nc(r)(t)}:function(t){return Th(new dr)(t)}}function oc(r){r===void 0&&(r=1/0);var t;r&&typeof r=="object"?t=r:t={count:r};var e=t.count,n=e===void 0?1/0:e,i=t.delay,s=t.resetOnSuccess,o=s===void 0?!1:s;return n<=0?er:ut(function(a,c){var u=0,l,d=function(){var m=!1;l=a.subscribe(ot(c,function(v){o&&(u=0),c.next(v)},void 0,function(v){if(u++<n){var b=function(){l?(l.unsubscribe(),l=null,d()):m=!0};if(i!=null){var w=typeof i=="number"?Oi(i):Tt(i(v,u)),O=ot(c,function(){O.unsubscribe(),b()},function(){c.complete()});w.subscribe(O)}else b()}else c.error(v)})),m&&(l.unsubscribe(),l=null,d())};d()})}function _n(r){r===void 0&&(r={});var t=r.connector,e=t===void 0?function(){return new dr}:t,n=r.resetOnError,i=n===void 0?!0:n,s=r.resetOnComplete,o=s===void 0?!0:s,a=r.resetOnRefCountZero,c=a===void 0?!0:a;return function(u){var l,d,m,v=0,b=!1,w=!1,O=function(){d==null||d.unsubscribe(),d=void 0},A=function(){O(),l=m=void 0,b=w=!1},_=function(){var It=l;A(),It==null||It.unsubscribe()};return ut(function(It,k){v++,!w&&!b&&O();var ge=m=m??e();k.add(function(){v--,v===0&&!w&&!b&&(d=ci(_,c))}),ge.subscribe(k),!l&&v>0&&(l=new Kr({next:function(me){return ge.next(me)},error:function(me){w=!0,O(),d=ci(A,i,me),ge.error(me)},complete:function(){b=!0,O(),d=ci(A,o),ge.complete()}}),Tt(It).subscribe(l))})(u)}}function ci(r,t){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];if(t===!0){r();return}if(t!==!1){var i=new Kr({next:function(){i.unsubscribe(),r()}});return Tt(t.apply(void 0,De([],Me(e)))).subscribe(i)}}function Io(r,t,e){var n,i,s,o,a=!1;return r&&typeof r=="object"?(n=r.bufferSize,o=n===void 0?1/0:n,i=r.windowTime,t=i===void 0?1/0:i,s=r.refCount,a=s===void 0?!1:s,e=r.scheduler):o=r??1/0,_n({connector:function(){return new or(o,t,e)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function Nh(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=$n(r);return ut(function(n,i){(e?En(r,n,e):En(r,n)).subscribe(i)})}function Le(r,t){return ut(function(e,n){var i=null,s=0,o=!1,a=function(){return o&&!i&&n.complete()};e.subscribe(ot(n,function(c){i==null||i.unsubscribe();var u=0,l=s++;Tt(r(c,l)).subscribe(i=ot(n,function(d){return n.next(t?t(c,d,l,u++):d)},function(){i=null,a()}))},function(){o=!0,a()}))})}function Lh(r){return ut(function(t,e){Tt(r).subscribe(ot(e,function(){return e.complete()},yn)),!e.closed&&t.subscribe(e)})}function xh(r,t){return t===void 0&&(t=!1),ut(function(e,n){var i=0;e.subscribe(ot(n,function(s){var o=r(s,i++);(o||t)&&n.next(s),!o&&n.complete()}))})}function wn(r,t,e){var n=Y(r)||t||e?{next:r,error:t,complete:e}:r;return n?ut(function(i,s){var o;(o=n.subscribe)===null||o===void 0||o.call(n);var a=!0;i.subscribe(ot(s,function(c){var u;(u=n.next)===null||u===void 0||u.call(n,c),s.next(c)},function(){var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),s.complete()},function(c){var u;a=!1,(u=n.error)===null||u===void 0||u.call(n,c),s.error(c)},function(){var c,u;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(u=n.finalize)===null||u===void 0||u.call(n)}))}):er}var Ch=function(r,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var e=typeof t.cycles=="boolean"?t.cycles:!1,n=t.cmp&&function(s){return function(o){return function(a,c){var u={key:a,value:o[a]},l={key:c,value:o[c]};return s(u,l)}}}(t.cmp),i=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,c;if(Array.isArray(o)){for(c="[",a=0;a<o.length;a++)a&&(c+=","),c+=s(o[a])||"null";return c+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=i.push(o)-1,l=Object.keys(o).sort(n&&n(o));for(c="",a=0;a<l.length;a++){var d=l[a],m=s(o[d]);m&&(c&&(c+=","),c+=JSON.stringify(d)+":"+m)}return i.splice(u,1),"{"+c+"}"}}(r)};const Mh=sa(Ch);var ac;class kr extends Z{constructor(t,e){super(),this.mapType=t,this.reason=e,this.message=`The map type '${JSON.stringify(t)}' is invalid. Reason: ${e}.`,this.name="InvalidMapTypeError"}}const cc=Symbol.for("taquito-michelson-map-type-symbol");function Dh(r){if(!("prim"in r))throw new kr(r,"Missing 'prim' field");if(!["map","big_map"].includes(r.prim))throw new kr(r,"The prim field should be 'map' or 'big_map'");if(!("args"in r))throw new kr(r,"Missing 'args' field");if(!Array.isArray(r.args))throw new kr(r,"The 'args' field should be an array");if(r.args.length!==2)throw new kr(r,"The 'args' field should have 2 elements")}class No extends Z{constructor(t,e,n,i){super(),this.value=t,this.type=e,this.reason=i,this.name="MapTypecheckError",this.message=`The ${n} provided: ${JSON.stringify(t)} is not compatible with the expected michelson type: ${JSON.stringify(e)}. Reason: ${JSON.stringify(i)}.`,this.name="MapTypecheckError"}}class Dt{constructor(t){this.valueMap=new Map,this.keyMap=new Map,this[ac]=!0,t&&this.setType(t)}static isMichelsonMap(t){return t&&t[cc]===!0}setType(t){Dh(t),this.keySchema=new kt(t.args[0]),this.valueSchema=new kt(t.args[1])}removeType(){this.keySchema=void 0,this.valueSchema=void 0}static fromLiteral(t,e){const n=new Dt(e);return Object.keys(t).forEach(i=>{n.set(i,t[i])}),n}typecheckKey(t){this.keySchema&&this.keySchema.Typecheck(t)}typecheckValue(t){this.valueSchema&&this.valueSchema.Typecheck(t)}assertTypecheckValue(t){try{this.typecheckValue(t)}catch(e){throw new No(t,this.valueSchema,"value",e)}}assertTypecheckKey(t){try{this.typecheckKey(t)}catch(e){throw new No(t,this.keySchema,"key",e)}}serializeDeterministically(t){return Mh(t)}*keys(){for(const[t]of this.entries())yield t}*values(){for(const[,t]of this.entries())yield t}*entries(){for(const t of this.valueMap.keys())yield[this.keyMap.get(t),this.valueMap.get(t)]}get(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.valueMap.get(e)}set(t,e){this.assertTypecheckKey(t),this.assertTypecheckValue(e);const n=this.serializeDeterministically(t);this.keyMap.set(n,t),this.valueMap.set(n,e)}delete(t){this.assertTypecheckKey(t),this.keyMap.delete(this.serializeDeterministically(t)),this.valueMap.delete(this.serializeDeterministically(t))}has(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.keyMap.has(e)&&this.valueMap.has(e)}clear(){this.keyMap.clear(),this.valueMap.clear()}get size(){return this.keyMap.size}forEach(t){for(const[e,n]of this.entries())t(n,e,this)}}ac=cc;class J extends Z{constructor(t,e,n){super(),this.value=t,this.token=e,this.name="TokenValidationError";const i=this.token.annot(),s=i?`[${i}] `:"";this.message=`${s}${n}`}}class lt{constructor(t,e,n){this.val=t,this.idx=e,this.fac=n,this.createToken=this.fac}typeWithoutAnnotations(){const t=n=>{if(typeof n=="object"){if(Array.isArray(n))return n.map(o=>t(o));const i=n;return i.args?{prim:i.prim,args:i.args.map(s=>t(s))}:{prim:i.prim}}return n};return(n=>n.args?{prim:n.prim,args:n.args.map(i=>t(i))}:{prim:n.prim})(this.val)}annot(){return(Array.isArray(this.val.annots)&&this.val.annots.length>0?this.val.annots[0]:String(this.idx)).replace(/(%|:)(_Liq_entry_)?/,"")}hasAnnotations(){return Array.isArray(this.val.annots)&&this.val.annots.length}get tokenVal(){return this.val}ExtractSignature(){return[[this.ExtractSchema()]]}}class nt extends lt{compare(t,e){return t===e?0:t<e?-1:1}}class Lo extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="BigMapValidationError"}}class Mt extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}ExtractSchema(){return{big_map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:Mt.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}validate(t){if(!Dt.isMichelsonMap(t))throw new Lo(t,this,`Value ${JSON.stringify(t)} is not a MichelsonMap`)}objLitToMichelsonMap(t){return t instanceof Dt?t:typeof t=="object"?Object.keys(t).length===0?new Dt:Dt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop());return this.validate(e),Array.from(e.keys()).sort((n,i)=>this.KeySchema.compare(n,i)).map(n=>({prim:"Elt",args:[this.KeySchema.EncodeObject(n),this.ValueSchema.EncodeObject(e.get(n))]}))}EncodeObject(t,e){const n=this.objLitToMichelsonMap(t);return this.validate(n),e&&e[Mt.prim]?e[Mt.prim](n,this.val):Array.from(n.keys()).sort((i,s)=>this.KeySchema.compare(i,s)).map(i=>({prim:"Elt",args:[this.KeySchema.EncodeObject(i),this.ValueSchema.EncodeObject(n.get(i))]}))}Execute(t,e){if(e&&e[Mt.prim])return e[Mt.prim](t,this.val);if(Array.isArray(t)){const n=new Dt(this.val);return t.forEach(i=>{n.set(this.KeySchema.ToKey(i.args[0]),this.ValueSchema.Execute(i.args[1]))}),n}else{if("int"in t)return t.int;throw new Lo(t,this,`Big map is expecting either an array (Athens) or an object with an int property (Babylon). Got ${JSON.stringify(t)}`)}}findAndReturnTokens(t,e){return Mt.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}Mt.prim="big_map";class kh extends Z{constructor(t){super(t),this.message=t,this.name="OrTokenDecodingError"}}class G extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Encode(t){const e=t[t.length-1],n=this.createToken(this.val.args[0],this.idx);let i=1;n instanceof G&&(i=Object.keys(n.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+i);if(String(n.annot())===String(e)&&!(n instanceof G))return t.pop(),{prim:"Left",args:[n.Encode(t)]};if(String(s.annot())===String(e)&&!(s instanceof G))return t.pop(),{prim:"Right",args:[s.Encode(t)]};if(n instanceof G){const o=n.Encode(t);if(o)return{prim:"Left",args:[o]}}if(s instanceof G){const o=s.Encode(t);if(o)return{prim:"Right",args:[o]}}return null}ExtractSignature(){const t=this.createToken(this.val.args[0],this.idx);let e=1;t instanceof G&&(e=Object.keys(t.ExtractSchema()).length);const n=this.createToken(this.val.args[1],this.idx+e),i=[];if(t instanceof G)i.push(...t.ExtractSignature());else for(const s of t.ExtractSignature())i.push([t.annot(),...s]);if(n instanceof G)i.push(...n.ExtractSignature());else for(const s of n.ExtractSignature())i.push([n.annot(),...s]);return i}EncodeObject(t,e){const n=Object.keys(t)[0],i=this.createToken(this.val.args[0],this.idx);let s=1;i instanceof G&&(s=Object.keys(i.ExtractSchema()).length);const o=this.createToken(this.val.args[1],this.idx+s);if(String(i.annot())===String(n)&&!(i instanceof G))return{prim:"Left",args:[i.EncodeObject(t[n],e)]};if(String(o.annot())===String(n)&&!(o instanceof G))return{prim:"Right",args:[o.EncodeObject(t[n],e)]};if(i instanceof G){const a=i.EncodeObject(t,e);if(a)return{prim:"Left",args:[a]}}if(o instanceof G){const a=o.EncodeObject(t,e);if(a)return{prim:"Right",args:[a]}}return null}Execute(t,e){const n=this.createToken(this.val.args[0],this.idx);let i=1;n instanceof G&&(i=Object.keys(n.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+i);if(t.prim==="Right")return s instanceof G?s.Execute(t.args[0],e):{[s.annot()]:s.Execute(t.args[0],e)};if(t.prim==="Left")return n instanceof G?n.Execute(t.args[0],e):{[n.annot()]:n.Execute(t.args[0],e)};throw new kh(`Was expecting Left or Right prim but got: ${JSON.stringify(t.prim)}`)}traversal(t,e,n){const i=this.createToken(this.val.args[0],this.idx);let s=1,o;i instanceof G&&!i.hasAnnotations()?(o=t(i),s=Object.keys(i.ExtractSchema()).length):o={[i.annot()]:t(i)};const a=this.createToken(this.val.args[1],this.idx+s);let c;return a instanceof G&&!a.hasAnnotations()?c=e(a):c={[a.annot()]:e(a)},n(o,c)}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}generateSchema(){return{__michelsonType:G.prim,schema:this.traversal(t=>t instanceof G&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof G&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}}findToken(t){const e=this.createToken(this.val.args[0],this.idx);let n=1;e instanceof G&&(n=Object.keys(e.ExtractSchema()).length);const i=this.createToken(this.val.args[1],this.idx+n);if(String(e.annot())===String(t)&&!(e instanceof G)&&e instanceof nt)return e;if(String(i.annot())===String(t)&&!(i instanceof G)&&i instanceof nt)return i;if(e instanceof G){const s=e.findToken(t);if(s)return s}if(i instanceof G){const s=i.findToken(t);if(s)return s}return null}compare(t,e){const n=Object.keys(t)[0],i=Object.keys(e)[0];if(n===i){const s=this.findToken(n);if(s instanceof nt)return s.compare(t[n],e[n])}else{const s=JSON.stringify(this.EncodeObject(t)),o=JSON.stringify(this.EncodeObject(e));return s<o?-1:1}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return G.prim===t&&e.push(this),this.traversal(n=>n.findAndReturnTokens(t,e),n=>n.findAndReturnTokens(t,e),(n,i)=>Object.assign(Object.assign({},n),i)),e}}G.prim="or";class Bh extends Z{constructor(t){super(t),this.message=t,this.name="TokenArgumentValidationError"}}class $h extends Z{constructor(t,e){super(),this.val1=t,this.val2=e,this.name="TokenComparisonError",this.message=`Tokens ${JSON.stringify(t)} and ${JSON.stringify(e)} are not comparable`}}function Pi(r,t=ct.prim){if(Array.isArray(r))return Pi({prim:t,args:r},t);if(r.args===void 0)throw new Bh(`The value ${JSON.stringify(r)} is an invalid PairToken with no arguments, a pair must have two or more arguments.`);return r.args.length>2?[r.args[0],{prim:t,args:r.args.slice(1)}]:[r.args[0],r.args[1]]}class ct extends nt{constructor(t,e,n){super(Array.isArray(t)?{prim:ct.prim,args:t}:t.prim?t:{prim:ct.prim,args:t},e,n)}args(){return Pi(this.val)}tokens(){let t=0;return this.args().map(e=>{const n=this.createToken(e,this.idx+t);return n instanceof ct?t+=Object.keys(n.ExtractSchema()).length:t++,n})}Encode(t){return{prim:"Pair",args:this.tokens().map(e=>e.Encode(t))}}ExtractSignature(){const t=this.args(),e=this.createToken(t[0],this.idx);let n=1;e instanceof G&&(n=Object.keys(e.ExtractSchema()).length);const i=this.createToken(t[1],this.idx+n),s=[];for(const o of e.ExtractSignature())for(const a of i.ExtractSignature())s.push([...o,...a]);return s}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}ToKey(t){return this.Execute(t)}EncodeObject(t,e){const[n,i]=this.tokens();let s;n instanceof ct&&!n.hasAnnotations()?s=t:s=t[n.annot()];let o;return i instanceof ct&&!i.hasAnnotations()?o=t:o=t[i.annot()],{prim:"Pair",args:[n.EncodeObject(s,e),i.EncodeObject(o,e)]}}traversal(t,e){const n=this.args(),i=this.createToken(n[0],this.idx);let s=1,o;i instanceof ct&&(s=Object.keys(i.ExtractSchema()).length),i instanceof ct&&!i.hasAnnotations()?o=t(i):o={[i.annot()]:t(i)};const a=this.createToken(n[1],this.idx+s);let c;return a instanceof ct&&!a.hasAnnotations()?c=e(a):c={[a.annot()]:e(a)},Object.assign(Object.assign({},o),c)}Execute(t,e){const n=Pi(t,"Pair");return this.traversal(i=>i.Execute(n[0],e),i=>i.Execute(n[1],e))}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema())}generateSchema(){return{__michelsonType:ct.prim,schema:this.traversal(t=>t instanceof ct&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof ct&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema())}}compare(t,e){const[n,i]=this.tokens(),s=(o,a)=>o instanceof ct&&!o.hasAnnotations()?a:a[o.annot()];if(n instanceof nt&&i instanceof nt){const o=n.compare(s(n,t),s(n,e));return o===0?i.compare(s(i,t),s(i,e)):o}throw new $h(t,e)}findAndReturnTokens(t,e){return ct.prim===t&&e.push(this),this.tokens().map(n=>n.findAndReturnTokens(t,e)),e}}ct.prim="pair";class xo extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="NatValidationError"}}class qt extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return new I(t[Object.keys(t)[0]])}Encode(t){const e=t.pop();return this.validate(e),{int:new I(e).toFixed()}}validate(t){const e=new I(t);if(e.isNaN())throw new xo(t,this,`Value is not a number: ${JSON.stringify(t)}`);if(e.isNegative())throw new xo(t,this,`Value cannot be negative: ${JSON.stringify(t)}`)}EncodeObject(t,e){return this.validate(t),e&&e[qt.prim]?e[qt.prim](t):{int:new I(t).toFixed()}}ExtractSchema(){return qt.prim}generateSchema(){return{__michelsonType:qt.prim,schema:qt.prim}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:qt.prim}}}ToKey({int:t}){return new I(t)}compare(t,e){const n=Number(t),i=Number(e);return n===i?0:n<i?-1:1}findAndReturnTokens(t,e){return qt.prim===t&&e.push(this),e}}qt.prim="nat";class Wt extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return Wt.prim}generateSchema(){return{__michelsonType:Wt.prim,schema:Wt.prim}}Encode(t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[Wt.prim]?e[Wt.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Wt.prim}}}findAndReturnTokens(t,e){return Wt.prim===t&&e.push(this),e}}Wt.prim="string";class ui extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="AddressValidationError"}}class ye extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}ToBigMapKey(t){return{key:{bytes:su(t)},type:{prim:"bytes"}}}validate(t){if(V(t)!==T.VALID)throw new ui(t,this,`Address is not valid: ${JSON.stringify(t)}`)}Encode(t){const e=t.pop();return this.validate(e),{string:e}}EncodeObject(t,e){return this.validate(t),e&&e[ye.prim]?e[ye.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new ui(t,this,`cannot be missing both string and bytes: ${JSON.stringify(t)}`);return bi(t.bytes)}ExtractSchema(){return ye.prim}generateSchema(){return{__michelsonType:ye.prim,schema:ye.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new ui({bytes:t,string:e},this,`cannot be missing both string and bytes ${JSON.stringify({string:e,bytes:t})}`);return bi(t)}compare(t,e){const n=o=>o.startsWith("tz"),i=n(t),s=n(e);return i&&!s?-1:s&&!i?1:super.compare(t,e)}findAndReturnTokens(t,e){return ye.prim===t&&e.push(this),e}}ye.prim="address";class Hh extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="MapValidationError"}}class qe extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}validate(t){if(!Dt.isMichelsonMap(t))throw new Hh(t,this,`Value ${JSON.stringify(t)} is not a valid MichelsonMap`)}Execute(t,e){const n=new Dt(this.val);return t.forEach(i=>{n.set(this.KeySchema.ToKey(i.args[0]),this.ValueSchema.Execute(i.args[1],e))}),n}objLitToMichelsonMap(t){return t instanceof Dt?t:typeof t=="object"?Object.keys(t).length===0?new Dt:Dt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop());return this.validate(e),Array.from(e.keys()).sort((n,i)=>this.KeySchema.compare(n,i)).map(n=>({prim:"Elt",args:[this.KeySchema.EncodeObject(n),this.ValueSchema.EncodeObject(e.get(n))]}))}EncodeObject(t,e){const n=this.objLitToMichelsonMap(t);return this.validate(n),e&&e[qe.prim]?e[qe.prim](n):Array.from(n.keys()).sort((i,s)=>this.KeySchema.compare(i,s)).map(i=>({prim:"Elt",args:[this.KeySchema.EncodeObject(i),this.ValueSchema.EncodeObject(n.get(i))]}))}ExtractSchema(){return{map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:qe.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}findAndReturnTokens(t,e){return qe.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}qe.prim="map";class Zt extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return String(t.prim).toLowerCase()==="true"}Encode(t){return{prim:t.pop()?"True":"False"}}EncodeObject(t,e){return e&&e[Zt.prim]?e[Zt.prim](t):{prim:t?"True":"False"}}ExtractSchema(){return Zt.prim}generateSchema(){return{__michelsonType:Zt.prim,schema:Zt.prim}}ToBigMapKey(t){return{key:this.EncodeObject(t),type:{prim:Zt.prim}}}ToKey(t){return this.EncodeObject(t)}compare(t,e){return t&&e||!t&&!e?0:t?1:-1}findAndReturnTokens(t,e){return Zt.prim===t&&e.push(this),e}}Zt.prim="bool";class Xr extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="TxRollupL2AddressValidationError"}}class ve extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}ToBigMapKey(t){return{key:{bytes:ou(t)},type:{prim:"bytes"}}}validate(t){if(V(t)!==T.VALID)throw new Xr(t,this,`tx_rollup_l2_address is not valid: ${JSON.stringify(t)}`)}Encode(t){const e=t.pop();if(!e)throw new Xr(e,this,`arg missing to encode: this -> "${JSON.stringify(e)}"`);return this.validate(e),{string:e}}EncodeObject(t,e){return this.validate(t),e&&e[ve.prim]?e[ve.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Xr(t,this,`value cannot be missing string and byte value. must have one ${JSON.stringify(t)}`);return Ks(t.bytes)}ExtractSchema(){return ve.prim}generateSchema(){return{__michelsonType:ve.prim,schema:ve.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new Xr(t,this,`value cannot be missing string and byte value. must have one: bytes = ${JSON.stringify(t)}`);return Ks(t)}findAndReturnTokens(t,e){return ve.prim===t&&e.push(this),e}}ve.prim="tx_rollup_l2_address";class Co extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ContractValidationError"}}class Pt extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}validate(t){if(V(t)!==T.VALID)throw new Co(t,this,`Value ${JSON.stringify(t)} is not a valid contract address.`);return null}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Co(t,this,`Value ${JSON.stringify(t)} is not a valid contract address. must contain bytes or string.`);return bi(t.bytes)}Encode(t){const e=t.pop();return this.validate(e),{string:e}}EncodeObject(t,e){return this.validate(t),e&&e[Pt.prim]?e[Pt.prim](t):{string:t}}ExtractSchema(){return Pt.prim}generateSchema(){const t=this.createToken(this.val.args[0],0);return{__michelsonType:Pt.prim,schema:{parameter:this.val.args[0]?t.generateSchema():{}}}}findAndReturnTokens(t,e){return Pt.prim===t&&e.push(this),e}}Pt.prim="contract";class jh extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ListValidationError"}}class Ge extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get valueSchema(){return this.createToken(this.val.args[0],this.idx)}validate(t){if(!Array.isArray(t))throw new jh(t,this,`Value ${JSON.stringify(t)} is not a valid array`)}Encode(t){const e=t.pop();this.validate(e);const n=this.createToken(this.val.args[0],0);return e.reduce((i,s)=>[...i,n.EncodeObject(s)],[])}Execute(t,e){const n=this.createToken(this.val.args[0],0);return this.validate(t),t.reduce((i,s)=>[...i,n.Execute(s,e)],[])}EncodeObject(t,e){const n=this.createToken(this.val.args[0],0);return this.validate(t),e&&e[Ge.prim]?e[Ge.prim](t):t.reduce((i,s)=>[...i,n.EncodeObject(s)],[])}ExtractSchema(){return{[Ge.prim]:this.valueSchema.ExtractSchema()}}generateSchema(){return{__michelsonType:Ge.prim,schema:this.valueSchema.generateSchema()}}findAndReturnTokens(t,e){return Ge.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),e}}Ge.prim="list";class Uh extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="MutezValidationError"}}class Yt extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return new I(t[Object.keys(t)[0]])}ExtractSchema(){return Yt.prim}generateSchema(){return{__michelsonType:Yt.prim,schema:Yt.prim}}validate(t){if(new I(t).isNaN())throw new Uh(t,this,`Value is not a number: ${t}`)}Encode(t){const e=t.pop();return this.validate(e),{int:String(e).toString()}}EncodeObject(t,e){return this.validate(t),e&&e[Yt.prim]?e[Yt.prim](t):{int:String(t).toString()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:Yt.prim}}}ToKey({int:t}){return t}compare(t,e){const n=Number(t),i=Number(e);return n===i?0:n<i?-1:1}findAndReturnTokens(t,e){return Yt.prim===t&&e.push(this),e}}Yt.prim="mutez";class Gh extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="BytesValidationError"}}class Xt extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}ToBigMapKey(t){return{key:{bytes:t},type:{prim:Xt.prim}}}validate(t){if(!(typeof t=="string"&&/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0))throw new Gh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=Vs(this.convertUint8ArrayToHexString(e)),this.validate(e),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.convertUint8ArrayToHexString(t),typeof t=="string"&&(t=Vs(t)),this.validate(t),e&&e[Xt.prim]?e[Xt.prim](t):{bytes:String(t).toString()}}Execute(t){return t.bytes}ExtractSchema(){return Xt.prim}generateSchema(){return{__michelsonType:Xt.prim,schema:Xt.prim}}ToKey({bytes:t,string:e}){return e||t}findAndReturnTokens(t,e){return Xt.prim===t&&e.push(this),e}}Xt.prim="bytes";class Rr extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}subToken(){return this.createToken(this.val.args[0],this.idx)}schema(){return this.createToken(this.val.args[0],0)}annot(){return Array.isArray(this.val.annots)?super.annot():this.createToken(this.val.args[0],this.idx).annot()}Encode(t){const e=t;return e==null?{prim:"None"}:Array.isArray(e)&&(e[e.length-1]===void 0||e[e.length-1]===null)?(e.pop(),{prim:"None"}):{prim:"Some",args:[this.schema().Encode(t)]}}EncodeObject(t,e){let n=t;return n==null?{prim:"None"}:(n=typeof n=="object"&&"Some"in n?n.Some:n,{prim:"Some",args:[this.schema().EncodeObject(n,e)]})}Execute(t,e){return t.prim==="None"?null:{Some:this.schema().Execute(t.args[0],e)}}ExtractSchema(){return{Some:this.schema().ExtractSchema()}}generateSchema(){return{__michelsonType:Rr.prim,schema:this.schema().generateSchema()}}ExtractSignature(){return[...this.schema().ExtractSignature()]}get KeySchema(){return this.schema()}compare(t,e){if(t){if(!e)return 1}else return-1;return this.KeySchema.compare(t,e)}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return Rr.prim===t&&e.push(this),this.subToken().findAndReturnTokens(t,e),e}}Rr.prim="option";class Qt extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){if(t.string&&/^\d+$/.test(t.string))return new Date(Number(t.string)*1e3).toISOString();if(t.string)return new Date(t.string).toISOString();if(t.int)return new Date(Number(t.int)*1e3).toISOString()}Encode(t){const e=t.pop();return typeof e=="number"?{int:String(e)}:{string:e}}EncodeObject(t,e){return e&&e[Qt.prim]?e[Qt.prim](t):typeof t=="number"?{int:String(t)}:{string:t}}ExtractSchema(){return Qt.prim}generateSchema(){return{__michelsonType:Qt.prim,schema:Qt.prim}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Qt.prim}}}findAndReturnTokens(t,e){return Qt.prim===t&&e.push(this),e}}Qt.prim="timestamp";class Kh extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="IntValidationError"}}class vt extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return new I(t[Object.keys(t)[0]])}ExtractSchema(){return vt.prim}generateSchema(){return{__michelsonType:vt.prim,schema:vt.prim}}validate(t){if(new I(t).isNaN())throw new Kh(t,this,`Value is not a number: ${JSON.stringify(t)}`)}Encode(t){const e=t.pop();return this.validate(e),{int:new I(e).toFixed()}}EncodeObject(t,e){return this.validate(t),e&&e[vt.prim]?e[vt.prim](t):{int:new I(t).toFixed()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:vt.prim}}}ToKey({int:t}){return t}compare(t,e){const n=Number(t),i=Number(e);return n===i?0:n<i?-1:1}findAndReturnTokens(t,e){return vt.prim===t&&e.push(this),e}}vt.prim="int";class te extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Encode(t){return t.pop(),{prim:"Unit"}}EncodeObject(t,e){return e&&e[te.prim]?e[te.prim](t):{prim:"Unit"}}Execute(t){return Ho}ExtractSchema(){return te.prim}generateSchema(){return{__michelsonType:te.prim,schema:te.prim}}compare(t,e){return 0}ToKey(t){return Ho}ToBigMapKey(t){return{key:{prim:"Unit"},type:{prim:te.prim}}}findAndReturnTokens(t,e){return te.prim===t&&e.push(this),e}}te.prim="unit";const Vh=4;class Fh extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="KeyValidationError"}}class ee extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string?t.string:au(t.bytes)}validate(t){if(cu(t)!==T.VALID)throw new Fh(t,this,"Key is not valid")}Encode(t){const e=t.pop();return this.validate(e),{string:e}}EncodeObject(t,e){return this.validate(t),e&&e[ee.prim]?e[ee.prim](t):{string:t}}ExtractSchema(){return ee.prim}generateSchema(){return{__michelsonType:ee.prim,schema:ee.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:ee.prim}}}compare(t,e){const n=this.getPrefix(t),i=this.getPrefix(e);if(n===R.EDPK&&i!==R.EDPK)return-1;if(n===R.SPPK&&i!==R.SPPK)return i===R.EDPK?1:-1;if(n===R.P2PK){if(i!==R.P2PK)return 1;const s=this.getP256PublicKeyComparableBytes(t),o=this.getP256PublicKeyComparableBytes(e);return Buffer.compare(s,o)}return super.compare(t,e)}getPrefix(t){return t.substring(0,Vh)}getP256PublicKeyComparableBytes(t){return aa(t,ji[R.P2PK]).slice(1)}findAndReturnTokens(t,e){return ee.prim===t&&e.push(this),e}}ee.prim="key";class zh extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="KeyHashValidationError"}}class re extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string?t.string:Fs(t.bytes)}validate(t){if(Ui(t)!==T.VALID)throw new zh(t,this,`KeyHash is not valid: ${JSON.stringify(t)}`)}Encode(t){const e=t.pop();return this.validate(e),{string:e}}EncodeObject(t,e){return this.validate(t),e&&e[re.prim]?e[re.prim](t):{string:t}}ExtractSchema(){return re.prim}generateSchema(){return{__michelsonType:re.prim,schema:re.prim}}ToKey({string:t,bytes:e}){return t||Fs(e)}ToBigMapKey(t){return{key:{string:t},type:{prim:re.prim}}}findAndReturnTokens(t,e){return re.prim===t&&e.push(this),e}}re.prim="key_hash";class Jh extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SignatureValidationError"}}class ne extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string?t.string:t.bytes}validate(t){if(uu(t)!==T.VALID)throw new Jh(t,this,"Signature is not valid")}Encode(t){const e=t.pop();return this.validate(e),{string:e}}EncodeObject(t,e){return this.validate(t),e&&e[ne.prim]?e[ne.prim](t):{string:t}}ExtractSchema(){return ne.prim}generateSchema(){return{__michelsonType:ne.prim,schema:ne.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:ne.prim}}}findAndReturnTokens(t,e){return ne.prim===t&&e.push(this),e}}ne.prim="signature";class Ke extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get paramSchema(){return this.createToken(this.val.args[0],this.idx)}get returnSchema(){return this.createToken(this.val.args[1],this.idx+1)}Execute(t){return t.string?t.string:t}Encode(t){return t.pop()}EncodeObject(t,e){return e&&e[Ke.prim]?e[Ke.prim](t):t}ExtractSchema(){return{[Ke.prim]:{parameters:this.paramSchema.ExtractSchema(),returns:this.returnSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:Ke.prim,schema:{parameters:this.paramSchema.generateSchema(),returns:this.returnSchema.generateSchema()}}}findAndReturnTokens(t,e){return Ke.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),this.createToken(this.val.args[1],this.idx).findAndReturnTokens(t,e),e}}Ke.prim="lambda";class Ee extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string}Encode(...t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[Ee.prim]?e[Ee.prim](t):{string:t}}ExtractSchema(){return Ee.prim}generateSchema(){return{__michelsonType:Ee.prim,schema:Ee.prim}}findAndReturnTokens(t,e){return Ee.prim===t&&e.push(this),e}}Ee.prim="operation";class qh extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SetValidationError"}}class Ve extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get KeySchema(){return this.createToken(this.val.args[0],0)}validate(t){if(!Array.isArray(t))throw new qh(t,this,`Value ${JSON.stringify(t)} is not an array`)}Encode(t){const e=t.pop();return this.validate(e),e.sort((n,i)=>this.KeySchema.compare(n,i)).reduce((n,i)=>[...n,this.KeySchema.EncodeObject(i)],[])}Execute(t,e){return t.reduce((n,i)=>[...n,this.KeySchema.Execute(i,e)],[])}EncodeObject(t,e){return this.validate(t),e&&e[Ve.prim]?e[Ve.prim](t):t.sort((n,i)=>this.KeySchema.compare(n,i)).reduce((n,i)=>[...n,this.KeySchema.EncodeObject(i)],[])}ExtractSchema(){return Ve.prim}generateSchema(){return{__michelsonType:Ve.prim,schema:this.KeySchema.generateSchema()}}findAndReturnTokens(t,e){return Ve.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),e}}Ve.prim="set";class Wh extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ChainIDValidationError"}}class ie extends nt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}validate(t){if(ca(t)!==T.VALID)throw new Wh(t,this,`Value ${JSON.stringify(t)} is not a valid ChainID`)}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return ie.prim}generateSchema(){return{__michelsonType:ie.prim,schema:ie.prim}}Encode(t){const e=t.pop();return this.validate(e),{string:e}}EncodeObject(t,e){return this.validate(t),e&&e[ie.prim]?e[ie.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:ie.prim}}}findAndReturnTokens(t,e){return ie.prim===t&&e.push(this),e}}ie.prim="chain_id";class Mo extends Z{constructor(){super(),this.name="TicketEncodeError",this.message="Tickets cannot be sent to the blockchain; they are created on-chain"}}const Zh={prim:"contract"},Yh={prim:"int"};class ae extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new Mo}EncodeObject(t,e){if(e&&e[ae.prim])return e[ae.prim](t,this.val);throw new Mo}Execute(t,e){if(e&&e[ae.prim])return e[ae.prim](t,this.val);const n=this.createToken(Zh,this.idx),i=this.valueToken,s=this.createToken(Yh,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1].args[0],e),amount:s.Execute(t.args[1].args[1],e)}:{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1],e),amount:s.Execute(t.args[2],e)}}ExtractSchema(){return{ticketer:Pt.prim,value:this.valueToken.ExtractSchema(),amount:vt.prim}}generateSchema(){return{__michelsonType:ae.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:Pt.prim,schema:Pt.prim},amount:{__michelsonType:vt.prim,schema:vt.prim}}}}findAndReturnTokens(t,e){return ae.prim===t&&e.push(this),this.valueToken.findAndReturnTokens(t,e),e}}ae.prim="ticket";class Do extends Z{constructor(){super(),this.name="TicketDeprecatedEncodeError",this.message="Ticket_deprecated cannot be sent to the blockchain; they are created on-chain"}}const Xh={prim:"contract"},Qh={prim:"int"};class ce extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new Do}EncodeObject(t,e){if(e&&e[ce.prim])return e[ce.prim](t,this.val);throw new Do}Execute(t,e){if(e&&e[ce.prim])return e[ce.prim](t,this.val);const n=this.createToken(Xh,this.idx),i=this.valueToken,s=this.createToken(Qh,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1].args[0],e),amount:s.Execute(t.args[1].args[1],e)}:{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1],e),amount:s.Execute(t.args[2],e)}}ExtractSchema(){return{ticketer:Pt.prim,value:this.valueToken.ExtractSchema(),amount:vt.prim}}generateSchema(){return{__michelsonType:ce.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:Pt.prim,schema:Pt.prim},amount:{__michelsonType:vt.prim,schema:vt.prim}}}}findAndReturnTokens(t,e){return ce.prim===t&&e.push(this),this.valueToken.findAndReturnTokens(t,e),e}}ce.prim="ticket_deprecated";class li extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="NeverTokenError"}}class be extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Encode(t){const e=t.pop();throw new li(e,this,`Assigning a value to the type never is forbidden. Trying to assign ${JSON.stringify(e)}.`)}EncodeObject(t,e){if(e&&e[be.prim])return e[be.prim](t);throw new li(t,this,`Assigning a value to the type never is forbidden. Trying to assign ${JSON.stringify(t)}.`)}Execute(t){throw new li(t,this,`There is no literal value for the type never. Trying to execute ${JSON.stringify(t)}.`)}ExtractSchema(){return be.prim}generateSchema(){return{__michelsonType:be.prim,schema:be.prim}}findAndReturnTokens(t,e){return be.prim===t&&e.push(this),e}}be.prim="never";class hi extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SaplingStateValidationError"}}class se extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return typeof t=="object"&&Object.keys(t).length===0}Execute(t,e){if(e&&e[se.prim])return e[se.prim](t,this.val);if("int"in t)return t.int;throw new hi(t,this,`Sapling state is expecting an object with an int property. Got ${JSON.stringify(t)}`)}Encode(t){const e=t.pop();if(this.isValid(e))return[];throw new hi(e,this,`Invalid sapling_state. Received: ${JSON.stringify(e)} while expecting: {}`)}EncodeObject(t,e){if(e&&e[se.prim])return e[se.prim](t);if(this.isValid(t))return[];throw new hi(t,this,`Invalid sapling_state. Received: ${JSON.stringify(t)} while expecting: {}`)}ExtractSchema(){return{[se.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:se.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return se.prim===t&&e.push(this),e}}se.prim="sapling_state";class ko extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SaplingTransactionValidationError"}}class Fe extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){throw new ko(t,this,`There is no literal value for the sapling_transaction type. Got: ${JSON.stringify(t)}.`)}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new ko(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[Fe.prim]?e[Fe.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[Fe.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:Fe.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return Fe.prim===t&&e.push(this),e}}Fe.prim="sapling_transaction";class Bo extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SaplingTransactionDeprecatedValidationError"}}class ze extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){throw new Bo(t,this,`There is no literal value for the sapling_transaction_deprecated type. Got: ${JSON.stringify(t)}.`)}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new Bo(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[ze.prim]?e[ze.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[ze.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:ze.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return ze.prim===t&&e.push(this),e}}ze.prim="sapling_transaction_deprecated";class td extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="Bls12381frValidationError"}}class _e extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}validate(t){if(!(/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0))throw new td(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return typeof e=="number"?{int:e.toString()}:(e=this.convertUint8ArrayToHexString(e),this.validate(e),{bytes:e})}EncodeObject(t,e){return e&&e[_e.prim]?e[_e.prim](t):typeof t=="number"?{int:t.toString()}:(t=this.convertUint8ArrayToHexString(t),this.validate(t),{bytes:t})}Execute(t){return t.bytes}ExtractSchema(){return _e.prim}generateSchema(){return{__michelsonType:_e.prim,schema:_e.prim}}findAndReturnTokens(t,e){return _e.prim===t&&e.push(this),e}}_e.prim="bls12_381_fr";class ed extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="Bls12381g1ValidationError"}}class we extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}validate(t){if(!(/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0))throw new ed(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.convertUint8ArrayToHexString(e),this.validate(e),{bytes:e}}EncodeObject(t,e){return t=this.convertUint8ArrayToHexString(t),this.validate(t),e&&e[we.prim]?e[we.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return we.prim}generateSchema(){return{__michelsonType:we.prim,schema:we.prim}}findAndReturnTokens(t,e){return we.prim===t&&e.push(this),e}}we.prim="bls12_381_g1";class rd extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="Bls12381g2ValidationError"}}class Ae extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}validate(t){if(!(/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0))throw new rd(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.convertUint8ArrayToHexString(e),this.validate(e),{bytes:e}}EncodeObject(t,e){return t=this.convertUint8ArrayToHexString(t),this.validate(t),e&&e[Ae.prim]?e[Ae.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Ae.prim}generateSchema(){return{__michelsonType:Ae.prim,schema:Ae.prim}}findAndReturnTokens(t,e){return Ae.prim===t&&e.push(this),e}}Ae.prim="bls12_381_g2";class nd extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ChestValidationError"}}class Se extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}validate(t){if(!(/^[0-9a-fA-F]*$/.test(t)&&t.length%2==0))throw new nd(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.convertUint8ArrayToHexString(e),this.validate(e),{bytes:e}}EncodeObject(t,e){return t=this.convertUint8ArrayToHexString(t),this.validate(t),e&&e[Se.prim]?e[Se.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Se.prim}generateSchema(){return{__michelsonType:Se.prim,schema:Se.prim}}findAndReturnTokens(t,e){return Se.prim===t&&e.push(this),e}}Se.prim="chest";class id extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ChestKeyValidationError"}}class Re extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}validate(t){if(!(/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0))throw new id(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.convertUint8ArrayToHexString(e),this.validate(e),{bytes:e}}EncodeObject(t,e){return t=this.convertUint8ArrayToHexString(t),this.validate(t),e&&e[Re.prim]?e[Re.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Re.prim}generateSchema(){return{__michelsonType:Re.prim,schema:Re.prim}}findAndReturnTokens(t,e){return Re.prim===t&&e.push(this),e}}Re.prim="chest_key";class $o extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="GlobalConstantEncodingError"}}class sd extends J{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="GlobalConstantDecodingError"}}class oe extends lt{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t,e){if(e&&e[oe.prim])return e[oe.prim](t,this.val);throw new sd(t,this,`Unable to decode a value represented by a globalThis constants. Please provide an expanded script to the Michelson-Encoder or semantics for the decoding. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}Encode(t){throw new $o(t,this,`Unable to encode a script containing globalThis constants. Please provide an expanded script to the Michelson-Encoder. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}EncodeObject(t,e){if(e&&e[oe.prim])return e[oe.prim](t);throw new $o(t,this,`Unable to encode a script containing globalThis constants. Please provide an expanded script to the Michelson-Encoder. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}ExtractSchema(){return oe.prim}generateSchema(){return{__michelsonType:oe.prim,schema:{hash:this.val.args[0].string}}}findAndReturnTokens(t,e){return oe.prim===t&&e.push(this),e}}oe.prim="constant";const od=[ct,qt,Wt,Mt,ye,ve,qe,Zt,G,Pt,Ge,Yt,Xt,Rr,Qt,vt,te,ee,re,ne,Ke,Ee,Ve,ie,ae,ce,be,se,Fe,ze,_e,we,Ae,Se,Re,oe];class ad extends Z{constructor(t,e){super(t),this.message=t,this.data=e,this.name="Invalid token error"}}function hr(r,t){if(Array.isArray(r))return new ct(r,t,hr);const e=od.find(n=>n.prim===r.prim);if(!e)throw new ad(`Malformed data: ${JSON.stringify(r)}. Expected a value with a valid prim property`,r);return new e(r,t,hr)}class Ti extends oa{constructor(t,e,n,i){super(t,e,n,i),this.viewName=t,this.sigs=e,this.args=n,this.cause=i,this.name="ParameterEncodingError",this.message=`Could not encode parameter ${JSON.stringify(n)} received for name "${t}" expecting one of the following signatures ${JSON.stringify(e)}`}}class di extends Z{constructor(t,e){super(),this.script=t,this.reason=e,this.name="InvalidScriptError";let n="Invalid on-chain view found in the following script.";e&&(n+=` Reason: ${e}.`),n+=`Script: ${JSON.stringify(t)}`,this.message=n}}class Pe extends Z{constructor(t,e){super(),this.script=t,this.reason=e,this.name="InvalidRpcResponseError";let n="Invalid RPC response passed as argument(s).";e&&(n+=` Reason: ${e}.`),n+=` Received: ${JSON.stringify(t)}`,this.message=n}}class Qr extends Z{constructor(t){super(t),this.message=t,this.name="InvalidBigMapSchemaError"}}class cd extends Z{constructor(t,e){super(t),this.message=t,this.value=e,this.name="InvalidBigMapDiffError"}}class ud extends Z{constructor(t,e,n,i){super(),this.details=e,this.schema=n,this.value=i,this.name="BigMapEncodingError",this.message=`Unable to encode the big map ${t}. Schema is: ${JSON.stringify(n)}. The ${t} is: ${JSON.stringify(i)}. Error details: ${e}`}}class ld extends Z{constructor(t,e,n,i,s){super(),this.details=e,this.schema=n,this.value=i,this.semantics=s,this.name="StorageEncodingError",this.message=`Unable to encode ${t}. The schema is: ${JSON.stringify(n)}, the value is: ${JSON.stringify(i)}.${s?`And the semantic is: ${JSON.stringify(s)}`:""}. Error details: ${e}`}}class hd extends Z{constructor(t){super(t),this.message=t,this.name="MissingArgumentError"}}var uc;const lc=Symbol.for("taquito-schema-type-symbol");function Fr(r,t=ct.prim){var e,n;if(Array.isArray(r))return Fr({prim:t,args:r},t);const i=r;return i.prim===t&&i.args&&i.args.length>2?Object.assign(Object.assign({},i),{args:[(e=i.args)===null||e===void 0?void 0:e[0],{prim:t,args:(n=i.args)===null||n===void 0?void 0:n.slice(1)}]}):i}function rs(r,t){if(r===void 0||t===void 0)return r===t;const e=Fr(r),n=Fr(t);return e.prim===n.prim&&(e.args===void 0&&n.args===void 0||e.args!==void 0&&n.args!==void 0&&e.args.length===n.args.length&&e.args.every((i,s)=>{var o,a;return rs(i,(a=(o=n.args)===null||o===void 0?void 0:o[s])!==null&&a!==void 0?a:{})}))&&(e.annots===void 0&&n.annots===void 0||e.annots!==void 0&&n.annots!==void 0&&e.annots.length===n.annots.length&&e.annots.every((i,s)=>{var o;return i===((o=n.annots)===null||o===void 0?void 0:o[s])}))}class kt{constructor(t){if(this.val=t,this[uc]=!0,this.root=hr(t,0),this.root instanceof Mt)this.bigMap=this.root;else if(this.isExpressionExtended(t)&&t.prim==="pair"){const e=t.args[0];this.isExpressionExtended(e)&&e.prim==="big_map"&&(this.bigMap=new Mt(e,0,hr))}}static isSchema(t){return t&&t[lc]===!0}static fromRPCResponse(t){if(!t)throw new Pe(t,"the RPC response is empty");if(!t.script)throw new Pe(t,"the RPC response has no script");if(!Array.isArray(t.script.code))throw new Pe(t,"The response.script.code should be an array");let e=t.script.code;for(;e.length===1&&Array.isArray(e[0]);)e=e[0];const n=e.find(i=>"prim"in i&&i.prim==="storage");if(!n||!Array.isArray(n.args))throw new Pe(t,'The response.script.code has an element of type {prim: "storage"}, but its args is not an array');return new kt(n.args[0])}isExpressionExtended(t){return"prim"in t&&Array.isArray(t.args)}removeTopLevelAnnotation(t){return(this.root instanceof ct||this.root instanceof G)&&this.root.hasAnnotations()&&typeof t=="object"&&Object.keys(t).length===1?t[Object.keys(t)[0]]:t}Execute(t,e){const n=this.root.Execute(t,e);return this.removeTopLevelAnnotation(n)}Typecheck(t){this.root instanceof Mt&&Number.isInteger(Number(t))||this.root instanceof ae&&t.ticketer&&t.value&&t.amount||this.root instanceof ce&&t.ticketer&&t.value&&t.amount||this.root instanceof qe&&this.root.ValueSchema instanceof Mt||this.root.EncodeObject(t)}ExecuteOnBigMapDiff(t,e){if(!this.bigMap)throw new Qr("Big map schema is undefined");if(!Array.isArray(t))throw new cd(`Big map diff must be an array, got: ${JSON.stringify(t)}`,t);const n=t.map(({key:i,value:s})=>({args:[i,s]}));return this.bigMap.Execute(n,e)}ExecuteOnBigMapValue(t,e){if(!this.bigMap)throw new Qr("Big map schema is undefined");return this.bigMap.ValueSchema.Execute(t,e)}EncodeBigMapKey(t){if(!this.bigMap)throw new Qr("Big map schema is undefined");try{return this.bigMap.KeySchema.ToBigMapKey(t)}catch(e){throw new ud("key",e,this.bigMap.KeySchema,t)}}Encode(t,e){try{return this.root.EncodeObject(t,e)}catch(n){throw n instanceof J?n:new ld("storage object",n,this.root,t,e)}}ExtractSchema(){return this.removeTopLevelAnnotation(this.root.ExtractSchema())}generateSchema(){return this.removeTopLevelAnnotation(this.root.generateSchema())}ComputeState(t,e){if(!this.bigMap)throw new Qr("Big map schema is undefined");const n=t.reduce((i,s)=>Object.assign(Object.assign({},i),this.ExecuteOnBigMapDiff(s.contents[0].metadata.operation_result.big_map_diff)),{});return Object.assign(Object.assign({},this.Execute(e)),{[this.bigMap.annot()]:n})}FindFirstInTopLevelPair(t,e){return this.findValue(this.root.val,t,e)}findValue(t,e,n){if(rs(n,t))return e;if(Array.isArray(t)||t.prim==="pair"){const i=Fr(t),s=Fr(e,"Pair");if(i.args===void 0||s.args===void 0)throw new hd("Tokens have no arguments");if(i.args[0])return this.findValue(i.args[0],s.args[0],n)||this.findValue(i.args[1],s.args[1],n)}}findToken(t){const e=[];return this.root.findAndReturnTokens(t,e)}}uc=lc;class yr{constructor(t){this.root=hr(t,0)}static fromRPCResponse(t){if(!t)throw new Pe(t,"the RPC response is empty");if(!t.script)throw new Pe(t,"the RPC response has no script");if(!Array.isArray(t.script.code))throw new Pe(t,"The response.script.code should be an array");const e=t.script.code.find(n=>"prim"in n&&n.prim==="parameter");if(!e)throw new Pe(t,'The response.script.code should have an element of type {prim: "parameter"}');if(!Array.isArray(e.args))throw new Pe(t,'The response.script.code has an element of type {prim: "parameter"}, but its args is not an array');return new yr(e.args[0])}get isMultipleEntryPoint(){return this.root instanceof G||this.root instanceof Rr&&this.root.subToken()instanceof G}get hasAnnotation(){return this.isMultipleEntryPoint?Object.keys(this.ExtractSchema())[0]!=="0":!0}Execute(t,e){return this.root.Execute(t,e)}Encode(...t){try{return this.root.Encode(t.reverse())}catch(e){throw e instanceof J?e:new Ti("Unable to encode parameter",this.root,t,e)}}EncodeObject(t,e){try{return this.root.EncodeObject(t,e)}catch(n){throw n instanceof J?n:new Ti("Unable to encode parameter object",this.root,t,n)}}ExtractSchema(){return this.root.ExtractSchema()}generateSchema(){return this.root.generateSchema()}ExtractSignatures(){return this.root.ExtractSignature()}}class ns{constructor(t){if(!t)throw new di(t,"the args are not defined");if(t.length!==4)throw new di(t,"there should be exactly 4 arguments");if(!("string"in t[0])||!t[0].string)throw new di(t,"The first argument should be a string, representing the view name. It should be in the form: { string: 'viewName' }");this.viewName=t[0].string,this.viewArgsType=t[1],this.viewReturnType=t[2],this.instructions=t[3],this.rootArgsType=hr(this.viewArgsType,0),this.rootReturnType=hr(this.viewReturnType,0)}static fromRPCResponse(t){const e=[],n=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.filter(i=>i.prim==="view");return n&&n.forEach(i=>{e.push(new ns(i.args))}),e}encodeViewArgs(t){try{return this.rootArgsType.EncodeObject(t)}catch(e){throw new Ti(this.viewName,void 0,t,e)}}decodeViewResult(t,e){return this.rootReturnType.Execute(t,e)}extractArgsSchema(){return this.rootArgsType.ExtractSchema()}extractResultSchema(){return this.rootReturnType.ExtractSchema()}}class je{constructor(t,e){this.tag=t,this.type=e}static fromMichelineValue(t){var e,n;return new je((e=t.annots)===null||e===void 0?void 0:e[0],(n=t.args)===null||n===void 0?void 0:n[0])}static fromRPCResponse(t){const e=[];return t.script.code.forEach(n=>{!("prim"in n)||n.prim!=="code"||!("args"in n)||!n.args||e.push(...je.extractEventsRecursively(n.args))}),je.removeDuplicates(e)}static removeDuplicates(t){const e=[];return t.forEach(n=>{e.findIndex(s=>s.tag===n.tag&&rs(s.type,n.type))===-1&&e.push(n)}),e}static extractEventsRecursively(t){return Array.isArray(t)?t.flatMap(e=>je.extractEventsRecursively(e)):"prim"in t?t.prim==="EMIT"?[je.fromMichelineValue(t)]:!("args"in t)||!t.args?[]:t.args.flatMap(e=>je.extractEventsRecursively(e)):[]}}const Ho=Symbol(),_t=Symbol("source_reference");class Br extends Z{constructor(t,e,n){super(),this.src=t,this.idx=e,this.message=n,this.name="ScanError"}}var wt;(function(r){r[r.Comment=0]="Comment",r[r.Number=1]="Number",r[r.String=2]="String",r[r.Bytes=3]="Bytes",r[r.Ident=4]="Ident"})(wt||(wt={}));const dd=new RegExp("\\s"),pd=new RegExp("[:@%_A-Za-z]"),fd=new RegExp("[@%_\\.A-Za-z0-9]"),jo=new RegExp("[0-9]"),gd=new RegExp("[0-9a-fA-F]");function*pi(r,t=!1){let e=0;for(;e<r.length;){for(;e<r.length&&dd.test(r[e]);)e++;if(e===r.length)return;const n=r[e],i=e;if(pd.test(n)){for(e++;e<r.length&&fd.test(r[e]);)e++;yield{t:wt.Ident,v:r.slice(i,e),first:i,last:e}}else if(r.length-e>1&&r.substring(e,e+2)==="0x"){for(e+=2;e<r.length&&gd.test(r[e]);)e++;if(e-i&1)throw new Br(r,e,"Bytes literal length is expected to be power of two");yield{t:wt.Bytes,v:r.slice(i,e),first:i,last:e}}else if(jo.test(n)||n==="-"){n==="-"&&e++;const s=e;for(;e<r.length&&jo.test(r[e]);)e++;if(s===e)throw new Br(r,e,"Number literal is too short");yield{t:wt.Number,v:r.slice(i,e),first:i,last:e}}else if(n==='"'){e++;let s=!1;for(;e<r.length&&(s||r[e]!=='"');e++)!s&&r[e]==="\\"?s=!0:s=!1;if(e===r.length)throw new Br(r,e,"Unterminated string literal");e++,yield{t:wt.String,v:r.slice(i,e),first:i,last:e}}else if(n==="#"){for(e++;e<r.length&&r[e]!==`
`;)e++;t&&(yield{t:wt.Comment,v:r.slice(i,e),first:i,last:e})}else if(r.length-e>1&&r.substring(e,e+2)==="/*"){for(e+=2;e<r.length&&!(r.length-e>1&&r.substring(e,e+2)==="*/");)e++;if(e===r.length)throw new Br(r,e,"Unterminated C style comment");e+=2,t&&(yield{t:wt.Comment,v:r.slice(i,e),first:i,last:e})}else if(n==="("||n===")"||n==="{"||n==="}"||n===";")e++,yield{t:n,v:n,first:i,last:e};else throw new Br(r,e,`Invalid character at offset ${e}: \`${n}'`)}}const tn=Symbol("ref_contract");var xe;(function(r){r.Ps9mPmXa="Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P",r.PtCJ7pwo="PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY",r.PsYLVpVv="PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt",r.PsddFKi3="PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP",r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdoTez="PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLoren="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANAD="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangzH="PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakarta="PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(xe||(xe={}));const hc=xe.Psithaca2,Uo={Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P:0,PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY:1,PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt:2,PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP:3,Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd:4,PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU:5,PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS:5,PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb:6,PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo:7,PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq:8,PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA:8,PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i:9,PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV:10,PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r:11,PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx:11,PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP:12,Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A:12,PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw:13,PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY:13,PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg:14,PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW:15,PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc:16,PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1:16,PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf:17,ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK:18};function vr(r,t){return Uo[r]<Uo[t]}class Kt extends Z{constructor(t,e){super(),this.prim=t,this.message=e,this.name="MacroError"}}function X(r,t){var e,n;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new Kt(r,`macro ${r.prim} expects ${t} arguments, was given ${(n=r.args)===null||n===void 0?void 0:n.length}`)}function $r(r){if(r.annots===void 0)return!0;throw new Kt(r,`unexpected annotation on macro ${r.prim}: ${r.annots}`)}function Go(r,t){if("int"in t)return!0;throw new Kt(r,`macro ${r.prim} expects int argument`)}function jr(r,t,e,n){let i=0,s=0;const o=[null,null];let a;if(i===t.length)throw new Kt(r,`unexpected end: ${r.prim}`);let c=t[i++];switch(c){case"P":{const{r:l,n:d,an:m}=jr(r,t.slice(i),e.slice(s),n);a=l,i+=d,s+=m;break}case"A":s!==e.length&&(o[0]=e[s++]);break;default:throw new Kt(r,`${r.prim}: unexpected character: ${c}`)}let u;if(i===t.length)throw new Kt(r,`unexpected end: ${r.prim}`);switch(c=t[i++],c){case"P":{const{r:l,n:d,an:m}=jr(r,t.slice(i),e.slice(s),n);u=l.map(([v,b])=>[v+1,b]),i+=d,s+=m;break}case"I":s!==e.length&&(o[1]=e[s++]);break;default:throw new Kt(r,`${r.prim}: unexpected character: ${c}`)}return{r:n(a,u,[0,o]),n:i,an:s}}function An(r,t,e,n){const i=t[0];switch(i){case"A":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CAR",annots:["@%%"]},An(r,t.slice(1),[],n)]]},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%@","%@",...e]}]:n.a;case"D":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CDR",annots:["@%%"]},An(r,t.slice(1),[],n)]]},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%@",...e]}]:n.d;default:throw new Kt(r,`${r.prim}: unexpected character: ${i}`)}}function md(r,t){let e=r.length;for(;e>0&&r[e-1]===t;)e--;return r.slice(0,e)}function fi(r){const t=[],e=[];if(r!==void 0)for(const n of r)(n.length!==0&&n[0]==="%"?t:e).push(n);return{fields:t,rest:e}}function ht({prim:r,annots:t,args:e}){return Object.assign(Object.assign({prim:r},t&&{annots:t}),e&&{args:e})}const yd=/^P[PAI]{3,}R$/,vd=/^UNP[PAI]{2,}R$/,Ed=/^C[AD]{2,}R$/,bd=/^SET_C[AD]+R$/,_d=/^MAP_C[AD]+R$/,wd=/^DI{2,}P$/,Ad=/^DU+P$/;function Sd(r,t){const e=(t==null?void 0:t.protocol)||hc;function n(i){return i!==void 0?[{prim:"RENAME",annots:i}]:[]}switch(r.prim){case"CMPEQ":case"CMPNEQ":case"CMPLT":case"CMPGT":case"CMPLE":case"CMPGE":if(X(r,0))return[{prim:"COMPARE"},ht({prim:r.prim.slice(3),annots:r.annots})];break;case"IFEQ":case"IFNEQ":case"IFLT":case"IFGT":case"IFLE":case"IFGE":if(X(r,2))return[{prim:r.prim.slice(2)},ht({prim:"IF",annots:r.annots,args:r.args})];break;case"IFCMPEQ":case"IFCMPNEQ":case"IFCMPLT":case"IFCMPGT":case"IFCMPLE":case"IFCMPGE":if(X(r,2))return[{prim:"COMPARE"},{prim:r.prim.slice(5)},ht({prim:"IF",annots:r.annots,args:r.args})];break;case"FAIL":if(X(r,0)&&$r(r))return[{prim:"UNIT"},{prim:"FAILWITH"}];break;case"ASSERT":if(X(r,0)&&$r(r))return[{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_EQ":case"ASSERT_NEQ":case"ASSERT_LT":case"ASSERT_GT":case"ASSERT_LE":case"ASSERT_GE":if(X(r,0)&&$r(r))return[{prim:r.prim.slice(7)},{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_CMPEQ":case"ASSERT_CMPNEQ":case"ASSERT_CMPLT":case"ASSERT_CMPGT":case"ASSERT_CMPLE":case"ASSERT_CMPGE":if(X(r,0)&&$r(r))return[[{prim:"COMPARE"},{prim:r.prim.slice(10)}],{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_NONE":if(X(r,0)&&$r(r))return[{prim:"IF_NONE",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_SOME":if(X(r,0))return[{prim:"IF_NONE",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],n(r.annots)]}];break;case"ASSERT_LEFT":if(X(r,0))return[{prim:"IF_LEFT",args:[n(r.annots),[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_RIGHT":if(X(r,0))return[{prim:"IF_LEFT",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],n(r.annots)]}];break;case"IF_SOME":if(X(r,2))return[ht({prim:"IF_NONE",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"IF_RIGHT":if(X(r,2))return[ht({prim:"IF_LEFT",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"CAR":case"CDR":if(r.args!==void 0){if(X(r,1)&&Go(r,r.args[0])){const i=parseInt(r.args[0].int,10);return ht({prim:"GET",args:[{int:r.prim==="CAR"?String(i*2+1):String(i*2)}],annots:r.annots})}}else return r}if(yd.test(r.prim)&&X(r,0)){const{fields:i,rest:s}=fi(r.annots),{r:o}=jr(r,r.prim.slice(1),i,(a,c,u)=>[...a||[],...c||[],u]);return o.map(([a,c],u)=>{const l=[...md(c,null).map(m=>m===null?"%":m),...a===0&&u===o.length-1?s:[]],d=ht({prim:"PAIR",annots:l.length!==0?l:void 0});return a===0?d:{prim:"DIP",args:a===1?[[d]]:[{int:String(a)},[d]]}})}if(vd.test(r.prim))if(vr(e,xe.PtEdo2Zk)&&X(r,0)){const{r:i}=jr(r,r.prim.slice(3),r.annots||[],(s,o,a)=>[a,...o||[],...s||[]]);return i.map(([s,o])=>{const a=[{prim:"DUP"},ht({prim:"CAR",annots:o[0]!==null?[o[0]]:void 0}),{prim:"DIP",args:[[ht({prim:"CDR",annots:o[1]!==null?[o[1]]:void 0})]]}];return s===0?a:{prim:"DIP",args:s===1?[[a]]:[{int:String(s)},[a]]}})}else{if(r.prim==="UNPAIR")return r;if(X(r,0)){const{r:i}=jr(r,r.prim.slice(3),[],(s,o,a)=>[a,...o||[],...s||[]]);return i.map(([s])=>{const o=ht({prim:"UNPAIR"});return s===0?o:{prim:"DIP",args:s===1?[[o]]:[{int:String(s)},[o]]}})}}if(Ed.test(r.prim)&&X(r,0)){const i=[...r.prim.slice(1,r.prim.length-1)];return i.map((s,o)=>{const a=o===i.length-1?r.annots:void 0;switch(s){case"A":return ht({prim:"CAR",annots:a});case"D":return ht({prim:"CDR",annots:a});default:throw new Kt(r,`unexpected character: ${s}`)}})}if(bd.test(r.prim)&&X(r,0)){const{fields:i,rest:s}=fi(r.annots);if(i.length>1)throw new Kt(r,`unexpected annotation on macro ${r.prim}: ${i}`);const o=i.length!==0?{a:[{prim:"DUP"},{prim:"CAR",annots:i},{prim:"DROP"},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:[i[0],"%@"]}],d:[{prim:"DUP"},{prim:"CDR",annots:i},{prim:"DROP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",i[0]]}]}:{a:[{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%","%@"]}],d:[{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%"]}]};return An(r,r.prim.slice(5,r.prim.length-1),s,o)}if(_d.test(r.prim)&&X(r,1)){const{fields:i}=fi(r.annots);if(i.length>1)throw new Kt(r,`unexpected annotation on macro ${r.prim}: ${i}`);const s={a:[{prim:"DUP"},{prim:"CDR",annots:["@%%"]},{prim:"DIP",args:[[ht({prim:"CAR",annots:i.length!==0?["@"+i[0].slice(1)]:void 0}),r.args[0]]]},{prim:"SWAP"},{prim:"PAIR",annots:[i.length!==0?i[0]:"%","%@"]}],d:[{prim:"DUP"},ht({prim:"CDR",annots:i.length!==0?["@"+i[0].slice(1)]:void 0}),r.args[0],{prim:"SWAP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",i.length!==0?i[0]:"%"]}]};return An(r,r.prim.slice(5,r.prim.length-1),[],s)}if(wd.test(r.prim)&&X(r,1)){let i=0;for(;r.prim[1+i]==="I";)i++;return ht({prim:"DIP",args:[{int:String(i)},r.args[0]]})}if(Ad.test(r.prim)){let i=0;for(;r.prim[1+i]==="U";)i++;if(vr(e,xe.PtEdo2Zk)){if(i===1){if(r.args===void 0)return r;X(r,1)&&Go(r,r.args[0])&&(i=parseInt(r.args[0].int,10))}else X(r,0);return i===1?[ht({prim:"DUP",annots:r.annots})]:i===2?[{prim:"DIP",args:[[ht({prim:"DUP",annots:r.annots})]]},{prim:"SWAP"}]:[{prim:"DIP",args:[{int:String(i-1)},[ht({prim:"DUP",annots:r.annots})]]},{prim:"DIG",args:[{int:String(i)}]}]}else{if(i===1)return r;if(X(r,0))return ht({prim:"DUP",args:[{int:String(i)}],annots:r.annots})}}return r}function Rd(r,t){return r.args!==void 0&&r.args.length===1&&"string"in r.args[0]&&r.args[0].string in t?t[r.args[0].string]:r}class dn extends Z{constructor(t,e){super(),this.token=t,this.message=e,this.name="MichelineParseError"}}class $e extends Z{constructor(t,e){super(),this.node=t,this.message=e,this.name="JSONParseError"}}const gi=new dn(null,"Unexpected EOF");function Ko(r){return r.t===wt.Ident&&(r.v[0]==="@"||r.v[0]==="%"||r.v[0]===":")}const Od=new RegExp("^-?[0-9]+$"),Pd=new RegExp("^([0-9a-fA-F]{2})*$");class ar{constructor(t){this.opt=t}expand(t){var e,n,i;if(((e=this.opt)===null||e===void 0?void 0:e.expandGlobalConstant)!==void 0&&t.prim==="constant"){const s=Rd(t,this.opt.expandGlobalConstant);return s!==t&&(s[_t]=Object.assign(Object.assign({},t[_t]||{first:0,last:0}),{globalConstant:t})),s}if(((n=this.opt)===null||n===void 0?void 0:n.expandMacros)===void 0||!((i=this.opt)===null||i===void 0)&&i.expandMacros){const s=Sd(t,this.opt);return s!==t&&(s[_t]=Object.assign(Object.assign({},t[_t]||{first:0,last:0}),{macro:t})),s}else return t}parseListExpr(t,e){var n;const i={first:e.first,last:e.last},s=e.t==="(";let o;if(s){if(o=t.next(),o.done)throw gi;i.last=o.value.last}else o={value:e};if(o.value.t!==wt.Ident)throw new dn(o.value,`not an identifier: ${o.value.v}`);const a={prim:o.value.v,[_t]:i};for(;;){const c=t.next();if(c.done){if(s)throw gi;break}else if(c.value.t===")"){if(!s)throw new dn(c.value,"unexpected closing bracket");i.last=c.value.last;break}else if(Ko(c.value))a.annots=a.annots||[],a.annots.push(c.value.v),i.last=c.value.last;else{a.args=a.args||[];const u=this.parseExpr(t,c.value);i.last=((n=u[_t])===null||n===void 0?void 0:n.last)||i.last,a.args.push(u)}}return this.expand(a)}parseArgs(t,e){var n;const i={first:e.first,last:e.last},s={prim:e.v,[_t]:i};for(;;){const o=t.next();if(o.done||o.value.t==="}"||o.value.t===";")return[s,o];if(Ko(o.value))i.last=o.value.last,s.annots=s.annots||[],s.annots.push(o.value.v);else{const a=this.parseExpr(t,o.value);i.last=((n=a[_t])===null||n===void 0?void 0:n.last)||i.last,s.args=s.args||[],s.args.push(a)}}}parseSequenceExpr(t,e){var n,i;const s={first:e.first,last:e.last},o=[];o[_t]=s;const a=e.t==="{";let c=e.t==="{"?null:{value:e};for(;;){if(c===null&&(c=t.next(),c.done||(s.last=c.value.last)),c.done){if(a)throw gi;return o}if(c.value.t==="}"){if(a)return o;throw new dn(c.value,"unexpected closing bracket")}else if(c.value.t===wt.Ident){const[u,l]=this.parseArgs(t,c.value);s.last=((n=u[_t])===null||n===void 0?void 0:n.last)||s.last,o.push(this.expand(u)),c=l}else{const u=this.parseExpr(t,c.value);s.last=((i=u[_t])===null||i===void 0?void 0:i.last)||s.last,o.push(u),c=null}c===null&&(c=t.next(),c.done||(s.last=c.value.last)),!c.done&&c.value.t===";"&&(c=null)}}parseExpr(t,e){switch(e.t){case wt.Ident:return this.expand({prim:e.v,[_t]:{first:e.first,last:e.last}});case wt.Number:return{int:e.v,[_t]:{first:e.first,last:e.last}};case wt.String:return{string:JSON.parse(e.v),[_t]:{first:e.first,last:e.last}};case wt.Bytes:return{bytes:e.v.slice(2),[_t]:{first:e.first,last:e.last}};case"{":return this.parseSequenceExpr(t,e);default:return this.parseListExpr(t,e)}}parseSequence(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=pi(t),n=e.next();return n.done?null:this.parseSequenceExpr(e,n.value)}parseList(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=pi(t),n=e.next();return n.done?null:this.parseListExpr(e,n.value)}parseMichelineExpression(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=pi(t),n=e.next();return n.done?null:this.parseExpr(e,n.value)}parseScript(t){return this.parseSequence(t)}parseData(t){return this.parseList(t)}parseJSON(t){if(typeof t!="object")throw new TypeError(`object type was expected, got ${typeof t} instead`);if(Array.isArray(t)){const e=[];for(const n of t){if(n===null||typeof n!="object")throw new $e(n,`unexpected sequence element: ${n}`);e.push(this.parseJSON(n))}return e}else if("prim"in t){const e=t;if(typeof e.prim=="string"&&(e.annots===void 0||Array.isArray(e.annots))&&(e.args===void 0||Array.isArray(e.args))){const n={prim:e.prim};if(e.annots!==void 0){for(const i of e.annots)if(typeof i!="string")throw new $e(i,`string expected: ${i}`);n.annots=e.annots}if(e.args!==void 0){n.args=[];for(const i of e.args){if(i===null||typeof i!="object")throw new $e(i,`unexpected argument: ${i}`);n.args.push(this.parseJSON(i))}}return this.expand(n)}throw new $e(t,`malformed prim expression: ${t}`)}else if("string"in t){if(typeof t.string=="string")return{string:t.string};throw new $e(t,`malformed string literal: ${t}`)}else if("int"in t){if(typeof t.int=="string"&&Od.test(t.int))return{int:t.int};throw new $e(t,`malformed int literal: ${t}`)}else if("bytes"in t){if(typeof t.bytes=="string"&&Pd.test(t.bytes))return{bytes:t.bytes};throw new $e(t,`malformed bytes literal: ${t}`)}else throw new $e(t,`unexpected object: ${t}`)}}const Td=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Id=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];class Ii extends Z{constructor(t){super(),this.message=t,this.name="Base58DecodingError"}}function Vo(r){const t=(r.length+9)%64,e=t===0?0:64-t;if(r.length>268435455)throw new lu("",`: Invalid length ${r.length} is too big -- SHA-256.`);const n=r.length<<3,i=[...r,128,...new Array(e).fill(0),0,0,0,0,n>>24&255,n>>16&255,n>>8&255,n&255];function s(l,d){return l>>>d|l<<32-d}const o=[...Td],a=new Array(64),c=new Array(8);for(let l=0;l<i.length;l+=64){let d=l,m=0;for(;m<16;)a[m]=i[d]<<24|i[d+1]<<16|i[d+2]<<8|i[d+3],d+=4,m++;for(;m<64;){const v=s(a[m-15],7)^s(a[m-15],18)^a[m-15]>>>3,b=s(a[m-2],17)^s(a[m-2],19)^a[m-2]>>>10;a[m]=(b|0)+a[m-7]+v+a[m-16]|0,m++}for(let v=0;v<8;v++)c[v]=o[v];for(let v=0;v<64;v++){const b=s(c[0],2)^s(c[0],13)^s(c[0],22),w=s(c[4],6)^s(c[4],11)^s(c[4],25),O=c[7]+w+(c[4]&c[5]^~c[4]&c[6])+Id[v]+a[v]|0,A=b+(c[0]&c[1]^c[0]&c[2]^c[1]&c[2])|0;c[7]=c[6],c[6]=c[5],c[5]=c[4],c[4]=c[3]+O|0,c[3]=c[2],c[2]=c[1],c[1]=c[0],c[0]=O+A|0}for(let v=0;v<8;v++)o[v]=o[v]+c[v]|0}const u=[];for(const l of o)u.push(l>>24&255),u.push(l>>16&255),u.push(l>>8&255),u.push(l&255);return u}const mi=[0,1,2,3,4,5,6,7,8,-1,-1,-1,-1,-1,-1,-1,9,10,11,12,13,14,15,16,-1,17,18,19,20,21,-1,22,23,24,25,26,27,28,29,30,31,32,-1,-1,-1,-1,-1,-1,33,34,35,36,37,38,39,40,41,42,43,-1,44,45,46,47,48,49,50,51,52,53,54,55,56,57];function Fo(r,t){const e=r.charCodeAt(t)-49;if(e>=mi.length||mi[e]===-1)throw new Ii(`Unexpected character at position ${t}: ${r[t]}`);return mi[e]}function Nd(r){const t=[];let e=0;for(;e<r.length&&Fo(r,e)===0;)e++;let n=e;for(;e<r.length;){let i=Fo(r,e++),s=0;for(;i!==0||s<t.length;){const o=(t[s]||0)*58+i;t[s++]=o%256,i=Math.floor(o/256)}}for(;n-- >0;)t.push(0);return t.reverse()}function dc(r){const t=Nd(r);if(t.length<4)throw new Ii(`Data is too short ${t.length}`);const e=t.slice(0,t.length-4),n=t.slice(t.length-4),i=Vo(Vo(e));if(n[0]!==i[0]||n[1]!==i[1]||n[2]!==i[2]||n[3]!==i[3])throw new Ii("Invalid checksum");return e}class Ld extends W{constructor(t){super(),this.message=t,this.name="InvalidMichelsonError"}}class xd extends W{constructor(t){super(),this.message=t,this.name="InvalidTypeExpressionError"}}class Cd extends W{constructor(t){super(),this.message=t,this.name="InvalidDataExpressionError"}}class Md extends W{constructor(t){super(),this.entrypoint=t,this.name="InvalidEntrypointError",this.message=`Contract has no entrypoint named: "${t}"`}}class Dd extends Z{constructor(t){super(),this.message=t,this.name="LongIntegerError"}}class kd extends Z{constructor(t){super(),this.hexByte=t,this.name="HexParseError",this.message=`Unable to parse hex byte "${t}"`}}class Vt extends Z{constructor(t,e){super(),this.val=t,this.message=e,this.name="MichelsonError"}}class x extends Vt{constructor(t,e,n){super(t,e),this.val=t,this.message=e,this.name="MichelsonTypeError",n!==void 0&&(this.data=n)}}class pc{constructor(t){if(this.neg=!1,this.buf=[],t!==void 0)if(typeof t=="string")for(let e=0;e<t.length;e++){const n=t.charCodeAt(e);if(e===0&&n===45)this.neg=!0;else{if(n<48||n>57)throw new Dd(`unexpected character in integer constant "${t[e]}"`);this.append(n-48)}}else t<0?(this.neg=!0,this.append(-t)):this.append(t)}append(t){let e=0;for(;t!==0||e<this.buf.length;){const n=(this.buf[e]||0)*10+t;this.buf[e++]=n%256,t=Math.floor(n/256)}}cmp(t){if(this.neg!==t.neg)return(t.neg?1:0)-(this.neg?1:0);{let e=0;if(this.buf.length!==t.buf.length)e=this.buf.length<t.buf.length?-1:1;else if(this.buf.length!==0){let n=t.buf.length-1;for(;n>=0&&this.buf[n]===t.buf[n];)n--;e=n<0?0:this.buf[n]<t.buf[n]?-1:1}return this.neg?e===0?0:-e:e}}get sign(){return this.buf.length===0?0:this.neg?-1:1}}function wr(r){const t=[];for(let e=0;e<r.length;e+=2){const n=parseInt(r.slice(e,e+2),16);if(Number.isNaN(n))return null;t.push(n)}return t}function Ni(r){try{return new pc(r),!0}catch{return!1}}function fc(r){try{return new pc(r).sign>=0}catch{return!1}}const Bd=/^(@%|@%%|%@|[@:%]([_0-9a-zA-Z][_0-9a-zA-Z.%@]*)?)$/;function Or(r,t){if(Array.isArray(r))return{};let e,n,i;if(r.annots!==void 0){for(const s of r.annots)if(s.length!==0){if(!Bd.test(s)||!(t!=null&&t.specialVar)&&(s==="@%"||s==="@%%")||!(t!=null&&t.specialFields)&&s==="%@")throw new Vt(r,`${r.prim}: unexpected annotation: ${s}`);switch(s[0]){case"%":(t!=null&&t.emptyFields||s.length>1)&&(e=e||[],e.push(s));break;case":":s.length>1&&(n=n||[],n.push(s));break;case"@":(t!=null&&t.emptyVar||s.length>1)&&(i=i||[],i.push(s));break}}}return{f:e,t:n,v:i}}const $d={BlockHash:[32,[1,52]],OperationHash:[32,[5,116]],OperationListHash:[32,[133,233]],OperationListListHash:[32,[29,159,109]],ProtocolHash:[32,[2,170]],ContextHash:[32,[79,199]],ED25519PublicKeyHash:[20,[6,161,159]],SECP256K1PublicKeyHash:[20,[6,161,161]],P256PublicKeyHash:[20,[6,161,164]],ContractHash:[20,[2,90,121]],CryptoboxPublicKeyHash:[16,[153,103]],ED25519Seed:[32,[13,15,58,7]],ED25519PublicKey:[32,[13,15,37,217]],SECP256K1SecretKey:[32,[17,162,224,201]],P256SecretKey:[32,[16,81,238,189]],ED25519EncryptedSeed:[56,[7,90,60,179,41]],SECP256K1EncryptedSecretKey:[56,[9,237,241,174,150]],P256EncryptedSecretKey:[56,[9,48,57,115,171]],SECP256K1PublicKey:[33,[3,254,226,86]],P256PublicKey:[33,[3,178,139,127]],SECP256K1Scalar:[33,[38,248,136]],SECP256K1Element:[33,[5,92,0]],ED25519SecretKey:[64,[43,246,78,7]],ED25519Signature:[64,[9,245,205,134,18]],SECP256K1Signature:[64,[13,115,101,19,63]],P256Signature:[64,[54,240,44,52]],GenericSignature:[64,[4,130,43]],ChainID:[4,[87,82,0]],RollupAddress:[20,[1,128,120,31]],TxRollupL2Address:[20,[6,161,166]]};function Te(r,...t){const e=dc(r);for(const n of t){const[i,s]=$d[n];if(e.length===i+s.length){let o=0;for(;o<s.length&&e[o]===s[o];)o++;if(o===s.length)return[n,e.slice(s.length)]}}return null}function Ct(r,t){const e=t,n=Array.isArray(e)?e:e.args;return n.length===2?r==="pair"?{prim:"pair",args:n}:{prim:"Pair",args:n}:Object.assign(Object.assign({},Array.isArray(e)?{prim:r}:e),{args:[n[0],{prim:r,args:n.slice(1)}]})}function Ie(r){return Array.isArray(r)||r.prim==="pair"}function gc(r){return Array.isArray(r)||"prim"in r&&r.prim==="Pair"}const Hd=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])[T ]([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):([0-5][0-9]))$/;function mc(r){if("string"in r){if(fc(r.string))return new Date(parseInt(r.string,10));if(Hd.test(r.string)){const t=new Date(r.string);if(!Number.isNaN(t.valueOf))return t}}else if(Ni(r.int))return new Date(parseInt(r.int,10));return null}function jd(r){const t=[];for(let e=0;e<r.length;e+=2){const n=r.slice(e,e+2),i=parseInt(n,16);if(Number.isNaN(i))throw new kd(n);t.push(i)}return t}function mr(r){return r.map(t=>(t>>4&15).toString(16)+(t&15).toString(16)).join("")}const Ud=31,yc={ABS:!0,ADD:!0,ADDRESS:!0,AMOUNT:!0,AND:!0,APPLY:!0,BALANCE:!0,BLAKE2B:!0,CAR:!0,CDR:!0,CHAIN_ID:!0,CHECK_SIGNATURE:!0,COMPARE:!0,CONCAT:!0,CONS:!0,EDIV:!0,EQ:!0,EXEC:!0,FAILWITH:!0,GE:!0,GET_AND_UPDATE:!0,GT:!0,HASH_KEY:!0,IMPLICIT_ACCOUNT:!0,INT:!0,ISNAT:!0,JOIN_TICKETS:!0,KECCAK:!0,LE:!0,LEVEL:!0,LSL:!0,LSR:!0,LT:!0,MEM:!0,MUL:!0,NEG:!0,NEQ:!0,NEVER:!0,NOT:!0,NOW:!0,OR:!0,PACK:!0,PAIRING_CHECK:!0,READ_TICKET:!0,SAPLING_VERIFY_UPDATE:!0,SELF:!0,SELF_ADDRESS:!0,SENDER:!0,SET_DELEGATE:!0,SHA256:!0,SHA3:!0,SHA512:!0,SIZE:!0,SLICE:!0,SOME:!0,SOURCE:!0,SPLIT_TICKET:!0,SUB:!0,SWAP:!0,TICKET:!0,TICKET_DEPRECATED:!0,TOTAL_VOTING_POWER:!0,TRANSFER_TOKENS:!0,UNIT:!0,VOTING_POWER:!0,XOR:!0,RENAME:!0,OPEN_CHEST:!0,SUB_MUTEZ:!0,MIN_BLOCK_TIME:!0,BYTES:!0,NAT:!0},vc=Object.assign({},yc,{CONTRACT:!0,CREATE_CONTRACT:!0,DIG:!0,DIP:!0,DROP:!0,DUG:!0,DUP:!0,EMIT:!0,EMPTY_BIG_MAP:!0,EMPTY_MAP:!0,EMPTY_SET:!0,GET:!0,IF:!0,IF_CONS:!0,IF_LEFT:!0,IF_NONE:!0,ITER:!0,LAMBDA:!0,LAMBDA_REC:!0,LEFT:!0,LOOP:!0,LOOP_LEFT:!0,MAP:!0,NIL:!0,NONE:!0,PAIR:!0,PUSH:!0,RIGHT:!0,SAPLING_EMPTY_STATE:!0,UNPACK:!0,UNPAIR:!0,UPDATE:!0,CAST:!0,VIEW:!0}),Ec={unit:!0,never:!0,bool:!0,int:!0,nat:!0,string:!0,chain_id:!0,bytes:!0,mutez:!0,key_hash:!0,key:!0,signature:!0,timestamp:!0,address:!0,tx_rollup_l2_address:!0},xr=Object.assign({},Ec,{or:!0,pair:!0,set:!0,big_map:!0,contract:!0,lambda:!0,list:!0,map:!0,operation:!0,option:!0,bls12_381_g1:!0,bls12_381_g2:!0,bls12_381_fr:!0,sapling_transaction:!0,sapling_transaction_deprecated:!0,sapling_state:!0,ticket:!0,chest_key:!0,chest:!0});class q extends Vt{constructor(t,e){super(t,e),this.val=t,this.message=e,this.name="MichelsonValidationError"}}function pe(r){return"prim"in r}function Gd(r){return Array.isArray(r)||"prim"in r}function bc(r){if(pe(r))return!0;throw new q(r,"prim expression expected")}function Je(r){if(Array.isArray(r))return!0;throw new q(r,"sequence expression expected")}function mt(r){if(Gd(r))return!0;throw new q(r,"prim or sequence expression expected")}function yi(r){if(r.int[0]==="-")throw new q(r,"natural number expected")}function pn(r){if("int"in r)return!0;throw new q(r,"int literal expected")}function _c(r){if("string"in r)return!0;throw new q(r,"string literal expected")}function K(r,t){var e;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new q(r,`${t} arguments expected`)}function jt(r){var t,e;if(Array.isArray(r)){for(const n of r){if(!Array.isArray(n)&&!pe(n))throw new q(r,"sequence or prim expected");jt(n)}return!0}if(bc(r)){if(Object.prototype.hasOwnProperty.call(yc,r.prim))return K(r,0),!0;switch(r.prim){case"DROP":case"PAIR":case"UNPAIR":case"DUP":case"UPDATE":case"GET":r.args!==void 0&&K(r,1)&&pn(r.args[0])&&yi(r.args[0]);break;case"DIG":case"DUG":case"SAPLING_EMPTY_STATE":K(r,1)&&pn(r.args[0])&&yi(r.args[0]);break;case"NONE":case"LEFT":case"RIGHT":case"NIL":case"CAST":K(r,1)&&Ne(r.args[0]);break;case"UNPACK":K(r,1)&&is(r.args[0]);break;case"CONTRACT":K(r,1)&&Un(r.args[0]);break;case"IF_NONE":case"IF_LEFT":case"IF_CONS":case"IF":K(r,2)&&(Je(r.args[0])&&jt(r.args[0]),Je(r.args[1])&&jt(r.args[1]));break;case"MAP":case"ITER":case"LOOP":case"LOOP_LEFT":K(r,1)&&jt(r.args[0]);break;case"CREATE_CONTRACT":K(r,1)&&Ac(r.args[0]);break;case"DIP":if(((t=r.args)===null||t===void 0?void 0:t.length)===2)pn(r.args[0])&&yi(r.args[0]),Je(r.args[1])&&jt(r.args[1]);else if(((e=r.args)===null||e===void 0?void 0:e.length)===1)Je(r.args[0])&&jt(r.args[0]);else throw new q(r,"1 or 2 arguments expected");break;case"PUSH":K(r,2)&&(Pr(r.args[0]),ir(r.args[1]));break;case"EMPTY_SET":K(r,1)&&Ce(r.args[0]);break;case"EMPTY_MAP":K(r,2)&&(Ce(r.args[0]),Ne(r.args[1]));break;case"EMPTY_BIG_MAP":K(r,2)&&(Ce(r.args[0]),Gn(r.args[1]));break;case"LAMBDA_REC":case"LAMBDA":K(r,3)&&(Ne(r.args[0]),Ne(r.args[1]),Je(r.args[2])&&jt(r.args[2]));break;case"VIEW":K(r,2)&&(_c(r.args[0])&&wc(r.args[0]),Ne(r.args[1])&&Pr(r.args[1]));break;case"EMIT":r.args&&r.args.length>0?K(r,1):K(r,0);break;default:throw new q(r,"instruction expected")}}return!0}function Ce(r){if(mt(r)){if(Array.isArray(r)||r.prim==="pair"||r.prim==="or"||r.prim==="option")pr(r,t=>Ce(t));else if(!Object.prototype.hasOwnProperty.call(Ec,r.prim))throw new q(r,`${r.prim}: type is not comparable`)}return!0}function is(r){if(mt(r)&&pe(r)){if(!Object.prototype.hasOwnProperty.call(xr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket")throw new q(r,`${r.prim}: type can't be used inside PACK/UNPACK instructions`);pr(r,t=>is(t))}return!0}function Pr(r){if(mt(r)&&pe(r)){if(!Object.prototype.hasOwnProperty.call(xr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket"||r.prim==="contract")throw new q(r,`${r.prim}: type can't be pushed`);pr(r,t=>Pr(t))}return!0}function ss(r){if(mt(r)&&pe(r)){if(!Object.prototype.hasOwnProperty.call(xr,r.prim)||r.prim==="operation"||r.prim==="contract")throw new q(r,`${r.prim}: type can't be used as part of a storage`);pr(r,t=>ss(t))}return!0}function Un(r){if(mt(r)&&pe(r)){if(!Object.prototype.hasOwnProperty.call(xr,r.prim)||r.prim==="operation")throw new q(r,`${r.prim}: type can't be used as part of a parameter`);pr(r,t=>Un(t))}return!0}function Gn(r){if(mt(r)&&pe(r)){if(!Object.prototype.hasOwnProperty.call(xr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state")throw new q(r,`${r.prim}: type can't be used inside a big_map`);pr(r,t=>Gn(t))}return!0}const Kd=new RegExp("^[a-zA-Z0-9_.%@]*$");function wc(r){if(r.string.length>Ud)throw new q(r,`view name too long: ${r.string}`);if(!Kd.test(r.string))throw new q(r,`invalid character(s) in view name: ${r.string}`)}function Ne(r){if(mt(r)&&pe(r)){if(!Object.prototype.hasOwnProperty.call(xr,r.prim))throw new q(r,"type expected");pr(r,t=>Ne(t))}return!0}function pr(r,t){if(Array.isArray(r)||r.prim==="pair"){const e=Array.isArray(r)?r:r.args;if(e===void 0||e.length<2)throw new q(r,"at least 2 arguments expected");return e.forEach(n=>{mt(n)&&t(n)}),!0}switch(r.prim){case"option":case"list":K(r,1)&&mt(r.args[0])&&t(r.args[0]);break;case"contract":K(r,1)&&Un(r.args[0]);break;case"or":K(r,2)&&mt(r.args[0])&&mt(r.args[1])&&(t(r.args[0]),t(r.args[1]));break;case"lambda":K(r,2)&&(Ne(r.args[0]),Ne(r.args[1]));break;case"set":K(r,1)&&Ce(r.args[0]);break;case"map":K(r,2)&&mt(r.args[0])&&mt(r.args[1])&&(Ce(r.args[0]),t(r.args[1]));break;case"big_map":K(r,2)&&mt(r.args[0])&&mt(r.args[1])&&(Ce(r.args[0]),Gn(r.args[1]),t(r.args[1]));break;case"ticket":K(r,1)&&mt(r.args[0])&&Ce(r.args[0]);break;case"sapling_state":case"sapling_transaction":K(r,1)&&pn(r.args[0]);break;default:K(r,0)}return!0}function ir(r){if("int"in r||"string"in r||"bytes"in r)return!0;if(Array.isArray(r)){let t=0;for(const e of r)pe(e)&&e.prim==="Elt"?(K(e,2)&&(ir(e.args[0]),ir(e.args[1])),t++):ir(e);if(t!==0&&t!==r.length)throw new q(r,"data entries and map elements can't be intermixed");return!0}if(pe(r))switch(r.prim){case"Unit":case"True":case"False":case"None":K(r,0);break;case"Pair":if(r.args===void 0||r.args.length<2)throw new q(r,"at least 2 arguments expected");for(const t of r.args)ir(t);break;case"Left":case"Right":case"Some":K(r,1)&&ir(r.args[0]);break;case"Lambda_rec":r.args&&jt(r.args);break;default:if(Object.prototype.hasOwnProperty.call(vc,r.prim))jt(r);else throw new q(r,"data entry or instruction expected")}else throw new q(r,"data entry expected");return!0}function Ac(r){if(Je(r)){const t={},e={};for(const n of r)if(bc(n)){if(n.prim!=="view"){if(n.prim in t)throw new q(r,`duplicate contract section: ${n.prim}`);t[n.prim]=!0}switch(n.prim){case"code":K(n,1)&&Je(n.args[0])&&jt(n.args[0]);break;case"parameter":if(K(n,1)&&Un(n.args[0]),n.annots)throw new q(n,"Annotation must be part of the parameter type");break;case"storage":K(n,1)&&ss(n.args[0]);break;case"view":if(K(n,4)){if(_c(n.args[0])){const i=n.args[0];if(i.string in e)throw new q(r,`duplicate view name: ${i.string}`);e[i.string]=!0,wc(i)}Pr(n.args[1]),Pr(n.args[2]),Je(n.args[3])&&jt(n.args[3])}break;default:throw new q(r,`unexpected contract section: ${n.prim}`)}}}return!0}function Sc(r){return Object.prototype.hasOwnProperty.call(vc,r.prim)}function Li(r){if(!Array.isArray(r))return!1;for(const t of r)if("prim"in t){if(Sc(t))throw new Vt(r,`Instruction outside of a lambda: ${JSON.stringify(r)}`);if(t.prim==="Elt")throw new Vt(r,`Elt item outside of a map literal: ${JSON.stringify(r)}`)}return!0}function Vd(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(e[n[i]]=r[n[i]]);return e}const Fd=["parameter","storage","code","False","Elt","Left","None","Pair","Right","Some","True","Unit","PACK","UNPACK","BLAKE2B","SHA256","SHA512","ABS","ADD","AMOUNT","AND","BALANCE","CAR","CDR","CHECK_SIGNATURE","COMPARE","CONCAT","CONS","CREATE_ACCOUNT","CREATE_CONTRACT","IMPLICIT_ACCOUNT","DIP","DROP","DUP","EDIV","EMPTY_MAP","EMPTY_SET","EQ","EXEC","FAILWITH","GE","GET","GT","HASH_KEY","IF","IF_CONS","IF_LEFT","IF_NONE","INT","LAMBDA","LE","LEFT","LOOP","LSL","LSR","LT","MAP","MEM","MUL","NEG","NEQ","NIL","NONE","NOT","NOW","OR","PAIR","PUSH","RIGHT","SIZE","SOME","SOURCE","SENDER","SELF","STEPS_TO_QUOTA","SUB","SWAP","TRANSFER_TOKENS","SET_DELEGATE","UNIT","UPDATE","XOR","ITER","LOOP_LEFT","ADDRESS","CONTRACT","ISNAT","CAST","RENAME","bool","contract","int","key","key_hash","lambda","list","map","big_map","nat","option","or","pair","set","signature","string","bytes","mutez","timestamp","unit","operation","address","SLICE","DIG","DUG","EMPTY_BIG_MAP","APPLY","chain_id","CHAIN_ID","LEVEL","SELF_ADDRESS","never","NEVER","UNPAIR","VOTING_POWER","TOTAL_VOTING_POWER","KECCAK","SHA3","PAIRING_CHECK","bls12_381_g1","bls12_381_g2","bls12_381_fr","sapling_state","sapling_transaction_deprecated","SAPLING_EMPTY_STATE","SAPLING_VERIFY_UPDATE","ticket","TICKET_DEPRECATED","READ_TICKET","SPLIT_TICKET","JOIN_TICKETS","GET_AND_UPDATE","chest","chest_key","OPEN_CHEST","VIEW","view","constant","SUB_MUTEZ","tx_rollup_l2_address","MIN_BLOCK_TIME","sapling_transaction","EMIT","Lambda_rec","LAMBDA_REC","TICKET","BYTES","NAT"],zd=Object.assign({},...Fd.map((r,t)=>({[r]:t})));var Ue;(function(r){r[r.Int=0]="Int",r[r.String=1]="String",r[r.Sequence=2]="Sequence",r[r.Prim0=3]="Prim0",r[r.Prim0Annot=4]="Prim0Annot",r[r.Prim1=5]="Prim1",r[r.Prim1Annot=6]="Prim1Annot",r[r.Prim2=7]="Prim2",r[r.Prim2Annot=8]="Prim2Annot",r[r.Prim=9]="Prim",r[r.Bytes=10]="Bytes"})(Ue||(Ue={}));class Ar{constructor(){this.buffer=[]}get length(){return this.buffer.length}writeBytes(t){this.buffer.push(...t.map(e=>e&255))}writeUint8(t){const e=t|0;this.buffer.push(e&255)}writeUint16(t){const e=t|0;this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeUint32(t){const e=t|0;this.buffer.push(e>>24&255),this.buffer.push(e>>16&255),this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeInt8(t){this.writeUint8(t)}writeInt16(t){this.writeUint16(t)}writeInt32(t){this.writeUint32(t)}}const He=new Error("bounds out of range");class Tr{constructor(t,e=0,n=t.length){this.buffer=t,this.idx=e,this.cap=n}get length(){return this.cap-this.idx}readBytes(t){if(this.cap-this.idx<t)throw He;const e=this.buffer.slice(this.idx,this.idx+t);return this.idx+=t,e}reader(t){if(this.cap-this.idx<t)throw He;const e=new Tr(this.buffer,this.idx,this.idx+t);return this.idx+=t,e}copy(){return new Tr(this.buffer,this.idx,this.cap)}readUint8(){if(this.cap-this.idx<1)throw He;return this.buffer[this.idx++]>>>0}readUint16(){if(this.cap-this.idx<2)throw He;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)>>>0}readUint32(){if(this.cap-this.idx<4)throw He;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],n=this.buffer[this.idx++],i=this.buffer[this.idx++];return(t<<24|e<<16|n<<8|i)>>>0}readInt8(){if(this.cap-this.idx<1)throw He;return this.buffer[this.idx++]<<24>>24}readInt16(){if(this.cap-this.idx<2)throw He;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)<<16>>16}readInt32(){if(this.cap-this.idx<4)throw He;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],n=this.buffer[this.idx++],i=this.buffer[this.idx++];return t<<24|e<<16|n<<8|i}}var Ir;(function(r){r[r.Implicit=0]="Implicit",r[r.Originated=1]="Originated"})(Ir||(Ir={}));var We;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(We||(We={}));function Rc(r){let t;const e=r.readUint8();switch(e){case We.ED25519:t="ED25519PublicKeyHash";break;case We.SECP256K1:t="SECP256K1PublicKeyHash";break;case We.P256:t="P256PublicKeyHash";break;default:throw new Error(`unknown public key hash tag: ${e}`)}return{type:t,hash:r.readBytes(20)}}function Jd(r){let t;const e=r.readUint8();switch(e){case Ir.Implicit:t=Rc(r);break;case Ir.Originated:t={type:"ContractHash",hash:r.readBytes(20)},r.readBytes(1);break;default:throw new Error(`unknown address tag: ${e}`)}if(r.length!==0){const n=new TextDecoder;t.entryPoint=n.decode(new Uint8Array(r.readBytes(r.length)))}return t}function Oc(r,t){let e;switch(r.type){case"ED25519PublicKeyHash":e=We.ED25519;break;case"SECP256K1PublicKeyHash":e=We.SECP256K1;break;case"P256PublicKeyHash":e=We.P256;break;default:throw new Error(`unexpected address type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.hash))}function qd(r,t){if(r.type==="ContractHash"?(t.writeUint8(Ir.Originated),t.writeBytes(Array.from(r.hash)),t.writeUint8(0)):(t.writeUint8(Ir.Implicit),Oc(r,t)),r.entryPoint!==void 0&&r.entryPoint!==""&&r.entryPoint!=="default"){const n=new TextEncoder().encode(r.entryPoint);t.writeBytes(Array.from(n))}}var Ze;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(Ze||(Ze={}));function Wd(r){let t,e;const n=r.readUint8();switch(n){case Ze.ED25519:e="ED25519PublicKey",t=32;break;case Ze.SECP256K1:e="SECP256K1PublicKey",t=33;break;case Ze.P256:e="P256PublicKey",t=33;break;default:throw new Error(`unknown public key tag: ${n}`)}return{type:e,publicKey:r.readBytes(t)}}function Zd(r,t){let e;switch(r.type){case"ED25519PublicKey":e=Ze.ED25519;break;case"SECP256K1PublicKey":e=Ze.SECP256K1;break;case"P256PublicKey":e=Ze.P256;break;default:throw new Error(`unexpected public key type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.publicKey))}function fn(r,t,e){var n,i;const[s,o]=e(r);if(Array.isArray(s)){const u=new Ar;for(const l of s){const d=o.next();if(d.done)throw new Error("REPORT ME: iterator is done");fn(l,u,d.value)}t.writeUint8(Ue.Sequence),t.writeUint32(u.length),t.writeBytes(u.buffer);return}if("string"in s){const l=new TextEncoder().encode(s.string);t.writeUint8(Ue.String),t.writeUint32(l.length),t.writeBytes(Array.from(l));return}if("int"in s){t.writeUint8(Ue.Int);let u=BigInt(s.int);const l=u<0;l&&(u=-u);let d=0;do{const m=BigInt(d===0?6:7);let v=u&(BigInt(1)<<m)-BigInt(1);u>>=m,u&&(v|=BigInt(128)),d===0&&l&&(v|=BigInt(64)),t.writeUint8(Number(v)),d++}while(u);return}if("bytes"in s){const u=jd(s.bytes);t.writeUint8(Ue.Bytes),t.writeUint32(u.length),t.writeBytes(u);return}const a=zd[s.prim];if(a===void 0)throw new TypeError(`Can't encode primary: ${s.prim}`);const c=(((n=s.args)===null||n===void 0?void 0:n.length)||0)<3?Ue.Prim0+(((i=s.args)===null||i===void 0?void 0:i.length)||0)*2+(s.annots===void 0||s.annots.length===0?0:1):Ue.Prim;if(t.writeUint8(c),t.writeUint8(a),s.args!==void 0)if(s.args.length<3)for(const u of s.args){const l=o.next();if(l.done)throw new Error("REPORT ME: iterator is done");fn(u,t,l.value)}else{const u=new Ar;for(const l of s.args){const d=o.next();if(d.done)throw new Error("REPORT ME: iterator is done");fn(l,u,d.value)}t.writeUint32(u.length),t.writeBytes(u.buffer)}if(s.annots!==void 0&&s.annots.length!==0){const l=new TextEncoder().encode(s.annots.join(" "));t.writeUint32(l.length),t.writeBytes(Array.from(l))}else s.args!==void 0&&s.args.length>=3&&t.writeUint32(0)}const Yd=r=>"prim"in r&&(r.prim==="Left"||r.prim==="Right"),Xd=r=>"prim"in r&&(r.prim==="Some"||r.prim==="None"),sr=r=>{if(Ie(r))return t=>{if(!gc(t))throw new x(r,`pair expected: ${JSON.stringify(t)}`,t);Li(t);const e=Ct("pair",r);return[Ct("Pair",t),function*(){for(const i of e.args)yield sr(i)}()]};switch(r.prim){case"or":return t=>{if(!Yd(t))throw new x(r,`or expected: ${JSON.stringify(t)}`,t);return[t,function*(){yield sr(r.args[t.prim==="Left"?0:1])}()]};case"option":return t=>{if(!Xd(t))throw new x(r,`option expected: ${JSON.stringify(t)}`,t);return[t,function*(){t.prim==="Some"&&(yield sr(r.args[0]))}()]};case"list":case"set":return t=>{if(!Array.isArray(t))throw new x(r,`${r.prim} expected: ${JSON.stringify(t)}`,t);return[t,function*(){for(const e of t)yield sr(r.args[0])}()]};case"map":return t=>{if(!Array.isArray(t))throw new x(r,`map expected: ${JSON.stringify(t)}`,t);return[t,function*(){for(const e of t)yield n=>{if(!("prim"in n)||n.prim!=="Elt")throw new x(r,`map element expected: ${JSON.stringify(n)}`,n);return[n,function*(){for(const i of r.args)yield sr(i)}()]}}()]};case"chain_id":return t=>{if(!("bytes"in t)&&!("string"in t))throw new x(r,`chain id expected: ${JSON.stringify(t)}`,t);let e;if("string"in t){const n=Te(t.string,"ChainID");if(n===null)throw new x(r,`chain id base58 expected: ${t.string}`,t);e={bytes:mr(n[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"signature":return t=>{if(!("bytes"in t)&&!("string"in t))throw new x(r,`signature expected: ${JSON.stringify(t)}`,t);let e;if("string"in t){const n=Te(t.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature");if(n===null)throw new x(r,`signature base58 expected: ${t.string}`,t);e={bytes:mr(n[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"key_hash":return t=>{if(!("bytes"in t)&&!("string"in t))throw new x(r,`key hash expected: ${JSON.stringify(t)}`,t);let e;if("string"in t){const n=Te(t.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash");if(n===null)throw new x(r,`key hash base58 expected: ${t.string}`,t);const i=new Ar;Oc({type:n[0],hash:n[1]},i),e={bytes:mr(i.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"key":return t=>{if(!("bytes"in t)&&!("string"in t))throw new x(r,`public key expected: ${JSON.stringify(t)}`,t);let e;if("string"in t){const n=Te(t.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey");if(n===null)throw new x(r,`public key base58 expected: ${t.string}`,t);const i=new Ar;Zd({type:n[0],publicKey:n[1]},i),e={bytes:mr(i.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"address":return t=>{if(!("bytes"in t)&&!("string"in t))throw new x(r,`address expected: ${JSON.stringify(t)}`,t);let e;if("string"in t){const n=t.string.split("%"),i=Te(n[0],"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash");if(i===null)throw new x(r,`address base58 expected: ${t.string}`,t);const s=new Ar;qd({type:i[0],hash:i[1],entryPoint:n.length>1?n[1]:void 0},s),e={bytes:mr(s.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"timestamp":return t=>{if(!("string"in t)&&!("int"in t))throw new x(r,`timestamp expected: ${JSON.stringify(t)}`,t);let e;if("string"in t){const n=mc(t);if(n===null)throw new x(r,`can't parse date: ${t.string}`,t);e={int:String(Math.floor(n.getTime()/1e3))}}else e=t;return[e,[][Symbol.iterator]()]};default:return Sn}},Qd=r=>"prim"in r&&r.prim==="PUSH",Sn=r=>Qd(r)?(jt(r),[r,function*(){yield Sn,yield sr(r.args[0])}()]):[r,function*(){for(;;)yield Sn}()];function tp(r,t){const e=new Ar;return e.writeUint8(5),fn(r,e,t!==void 0?sr(t):Sn),e.buffer}function ep(r,t){return{bytes:mr(tp(r,t))}}function rp(r){const t=wr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new Tr(new Uint8Array(t));return Jd(e)}function np(r){const t=wr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new Tr(new Uint8Array(t));return Rc(e)}function ip(r){const t=wr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new Tr(new Uint8Array(t));return Wd(e)}class H extends Vt{constructor(t,e,n){super(t,n),this.val=t,this.stackState=e,this.message=n,this.name="MichelsonInstructionError"}}function F(r){return Array.isArray(r)?"pair":r.prim}function Rn(r){return"prim"in r?r.args:r}function Gt(r,t,e=!1){if(F(r)!==F(t))throw new x(r,`types mismatch: ${F(r)} != ${F(t)}`,void 0);const n=[Or(r),Or(t)];if(n[0].t&&n[1].t&&n[0].t[0]!==n[1].t[0])throw new x(r,`${F(r)}: type names mismatch: ${n[0].t[0]} != ${n[1].t[0]}`,void 0);if(e&&n[0].f&&n[1].f&&n[0].f[0]!==n[1].f[0])throw new x(r,`${F(r)}: field names mismatch: ${n[0].f[0]} != ${n[1].f}`,void 0);if(Ie(r)){const i=Ct("pair",r),s=Ct("pair",t);Gt(i.args[0],s.args[0],!0),Gt(i.args[1],s.args[1],!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":case"ticket":Gt(r.args[0],t.args[0]);break;case"or":Gt(r.args[0],t.args[0],!0),Gt(r.args[1],t.args[1],!0);break;case"lambda":case"map":case"big_map":Gt(r.args[0],t.args[0]),Gt(r.args[1],t.args[1]);break;case"sapling_state":case"sapling_transaction":if(parseInt(r.args[0].int,10)!==parseInt(t.args[0].int,10))throw new x(r,`${F(r)}: type argument mismatch: ${r.args[0].int} != ${t.args[0].int}`,void 0)}}function Pc(r,t){if(r.length!==t.length)throw new x(r,`stack length mismatch: ${r.length} != ${t.length}`,void 0);for(let e=0;e<r.length;e++)Gt(r[e],t[e])}function tt(r,t=!1){var e,n,i;if(!Array.isArray(r)){const s=Or(r);if((((e=s.t)===null||e===void 0?void 0:e.length)||0)>1)throw new x(r,`${r.prim}: at most one type annotation allowed: ${r.annots}`,void 0);if(t){if((((n=s.f)===null||n===void 0?void 0:n.length)||0)>1)throw new x(r,`${r.prim}: at most one field annotation allowed: ${r.annots}`,void 0)}else if((((i=s.f)===null||i===void 0?void 0:i.length)||0)>0)throw new x(r,`${r.prim}: field annotations aren't allowed: ${r.annots}`,void 0)}if(Ie(r)){const s=Rn(r);for(const o of s)tt(o,!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":tt(r.args[0]);break;case"or":for(const s of r.args)tt(s,!0);break;case"lambda":case"map":case"big_map":tt(r.args[0]),tt(r.args[1])}}function Tc(r){if(!Array.isArray(r))return!1;for(const t of r)if(!(Array.isArray(t)&&Tc(t)||"prim"in t&&Sc(t)))return!1;return!0}function Ut(r,t,e){if(Ie(t)){if(gc(r)){Li(r);const n=Ct("Pair",r),i=Ct("pair",t);Ut(n.args[0],i.args[0],e),Ut(n.args[1],i.args[1],e);return}throw new x(t,`pair expected: ${JSON.stringify(r)}`,r)}switch(t.prim){case"int":if("int"in r&&Ni(r.int))return;throw new x(t,`integer value expected: ${JSON.stringify(r)}`,r);case"nat":case"mutez":if("int"in r&&fc(r.int))return;throw new x(t,`natural value expected: ${JSON.stringify(r)}`,r);case"string":if("string"in r)return;throw new x(t,`string value expected: ${JSON.stringify(r)}`,r);case"bytes":case"bls12_381_g1":case"bls12_381_g2":if("bytes"in r&&wr(r.bytes)!==null)return;throw new x(t,`bytes value expected: ${JSON.stringify(r)}`,r);case"bool":if("prim"in r&&(r.prim==="True"||r.prim==="False"))return;throw new x(t,`boolean value expected: ${JSON.stringify(r)}`,r);case"key_hash":if("string"in r&&Te(r.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash")!==null)return;if("bytes"in r)try{np(r);return}catch{}throw new x(t,`key hash expected: ${JSON.stringify(r)}`,r);case"timestamp":if(("string"in r||"int"in r)&&mc(r)!==null)return;throw new x(t,`timestamp expected: ${JSON.stringify(r)}`,r);case"address":if("string"in r){let n=r.string;const i=r.string.indexOf("%");if(i>=0&&(n=r.string.slice(0,i)),Te(n,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash","TxRollupL2Address","RollupAddress")!==null)return}else if("bytes"in r)try{rp(r);return}catch{}throw new x(t,`address expected: ${JSON.stringify(r)}`,r);case"key":if("string"in r&&Te(r.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey")!==null)return;if("bytes"in r)try{ip(r);return}catch{}throw new x(t,`public key expected: ${JSON.stringify(r)}`,r);case"unit":if("prim"in r&&r.prim==="Unit")return;throw new x(t,`unit value expected: ${JSON.stringify(r)}`,r);case"signature":if("bytes"in r||"string"in r&&Te(r.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature")!==null)return;throw new x(t,`signature expected: ${JSON.stringify(r)}`,r);case"chain_id":if(("bytes"in r||"string"in r)&&("string"in r?dc(r.string):wr(r.bytes))!==null)return;throw new x(t,`chain id expected: ${JSON.stringify(r)}`,r);case"option":if("prim"in r){if(r.prim==="None")return;if(r.prim==="Some"){Ut(r.args[0],t.args[0],e);return}}throw new x(t,`option expected: ${JSON.stringify(r)}`,r);case"list":case"set":if(Li(r)){for(const n of r)Ut(n,t.args[0],e);return}throw new x(t,`${t.prim} expected: ${JSON.stringify(r)}`,r);case"or":if("prim"in r){if(r.prim==="Left"){Ut(r.args[0],t.args[0],e);return}else if(r.prim==="Right"){Ut(r.args[0],t.args[1],e);return}}throw new x(t,`union (or) expected: ${JSON.stringify(r)}`,r);case"lambda":if(Tc(r)){const n=dt(r,[t.args[0]],e);if("failed"in n)throw new x(t,`function is failed with error type: ${n.failed}`,r);if(n.length!==1)throw new x(t,"function must return a value",r);Gt(t.args[1],n[0]);return}throw new x(t,`function expected: ${JSON.stringify(r)}`,r);case"map":case"big_map":if(Array.isArray(r)){for(const n of r){if(!("prim"in n)||n.prim!=="Elt")throw new x(t,`map elements expected: ${JSON.stringify(r)}`,r);Ut(n.args[0],t.args[0],e),Ut(n.args[1],t.args[1],e)}return}throw new x(t,`${t.prim} expected: ${JSON.stringify(r)}`,r);case"bls12_381_fr":if("int"in r&&Ni(r.int)||"bytes"in r&&wr(r.bytes)!==null)return;throw new x(t,`BLS12-381 element expected: ${JSON.stringify(r)}`,r);case"sapling_state":if(Array.isArray(r))return;throw new x(t,`sapling state expected: ${JSON.stringify(r)}`,r);case"ticket":Ut(r,{prim:"pair",args:[{prim:"address"},t.args[0],{prim:"nat"}]},e);return;default:throw new x(t,`type ${F(t)} don't have Michelson literal representation`,r)}}function sp(r,t,e){let n=t,i=t,s=0;for(const o of r){const a=dt(o,i,e);if(n=a,"failed"in a)break;i=a,s++}if("failed"in n&&n.level==0&&(!("prim"in n.failed)||n.failed.prim!=="never")&&s!==r.length-1)throw new H(r,n,"FAIL must appear in a tail position");if((e==null?void 0:e.traceCallback)!==void 0){const o={op:r,in:t,out:n};e.traceCallback(o)}return"failed"in n?{failed:n.failed,level:n.level+1}:n}function dt(r,t,e){const n=(e==null?void 0:e.protocol)||hc;if(Array.isArray(r))return sp(r,t,e);const i=r;function s(g,...N){if(t.length<N.length+g)throw new H(i,t,`${i.prim}: stack must have at least ${N.length} element(s)`);let L=g;for(const U of N){if(U!==null&&U.length!==0){let j=0;for(;j<U.length&&U[j]!==F(t[L]);)j++;if(j===U.length)throw new H(i,t,`${i.prim}: stack type mismatch: [${L}] expected to be ${U}, got ${F(t[L])} instead`)}L++}return t.slice(g,N.length+g)}function o(g){return(...N)=>{try{return g(...N)}catch(L){throw L instanceof Vt?new H(i,t,L.message):L}}}function a(g){return N=>{try{return g(N)}catch(L){throw L instanceof Vt?new H(i,t,L.message):L}}}const c=o(Or),u=o(Pc),l=o(Gt),d=a(Ce),m=a(is),v=a(ss),b=a(Pr),w=a(Gn);function O(g,N){const L=c(i,Object.assign(Object.assign({},N),{emptyFields:g.f!==void 0&&g.f>1,emptyVar:g.v!==void 0&&g.v>1})),U=(j,ft,h)=>{if(j&&j.length>(ft||0))throw new H(i,t,`${i.prim}: at most ${ft||0} ${h} annotations allowed`)};return U(L.f,g.f,"field"),U(L.t,g.t,"type"),U(L.v,g.v,"variable"),L}function A(g,N){const L=g,U=Array.isArray(L)?{prim:"pair",args:L}:L,j=c(U),ft=N.v!==void 0||N.t!==void 0||N.f!==void 0?[...(N.v===null?j.v:N.v)||[],...(N.t===null?j.t:N.t)||[],...(N.f===null?j.f:N.f)||[]]:void 0,h=Vd(U,["annots"]);return Object.assign(Object.assign({},h),ft&&ft.length!==0&&{annots:ft})}function _(g,N){const L=O({v:1});return A(g,{v:L.v!==void 0?L.v:N!==void 0?[N]:null,t:null})}function It(g,N,L,U,j){var ft,h,y,S;const P=(ft=c(N).f)===null||ft===void 0?void 0:ft[0],Lt=(h=L.f)===null||h===void 0?void 0:h[U];if(Lt!==void 0&&Lt!=="%"&&P!==void 0&&Lt!==P)throw new H(i,t,`${i.prim}: field names doesn't match: ${Lt} !== ${P}`);const bt=(y=L.v)===null||y===void 0?void 0:y[U],Ht=(S=c(g).v)===null||S===void 0?void 0:S[0];return A(N,{t:null,v:bt?bt==="@%"?P?["@"+P.slice(1)]:void 0:bt==="@%%"?Ht?["@"+Ht.slice(1)+"."+(P?P.slice(1):j)]:P?["@"+P.slice(1)]:void 0:[bt]:null})}function k(g,N,L=N){const U=Ct("pair",g);if(L===1)return[U.args[0]];if(L===2)return U.args;const j=U.args[1];if(Ie(j))return[U.args[0],...k(j,N,L-1)];throw new H(i,t,`${i.prim}: at least ${N} fields are expected`)}function ge(g,N,L=N){if(L===0)return g;const U=Ct("pair",g);if(L===1)return U.args[0];const j=U.args[1];if(Ie(j))return ge(j,N,L-2);if(L===2)return j;throw new H(i,t,`${i.prim}: at least ${N+1} fields are expected`)}function me(g,N,L,U=L){if(U===0)return N;const j=Ct("pair",g);if(U===1)return Object.assign(Object.assign({},j),{args:[N,j.args[1]]});const ft=j.args[1];if(Ie(ft))return Object.assign(Object.assign({},j),{args:[j.args[0],me(ft,N,L,U-2)]});if(U===2)return Object.assign(Object.assign({},j),{args:[j.args[0],N]});throw new H(i,t,`${i.prim}: at least ${L+1} fields are expected`)}const Nt=(g,N)=>["@"+(g.v?g.v[0].slice(1)+".":"")+N];function nr(g,N){return"failed"in g||"failed"in N?"failed"in g?N:g:(u(g,N),g)}const Dr=(g=>{var N,L,U,j,ft;switch(g.prim){case"DUP":{const h=g.args?parseInt(g.args[0].int,10):1;if(h===0)throw new H(g,t,"DUP 0 is forbidden");const y=s(h-1,null)[0];if(F(y)==="ticket")throw new H(g,t,"ticket can't be DUPed");return[y,...t]}case"SWAP":{const h=s(0,null,null);return O({}),[h[1],h[0],...t.slice(2)]}case"SOME":return[A({prim:"option",args:[s(0,null)[0]]},O({t:1,v:1})),...t.slice(1)];case"UNIT":return[A({prim:"unit"},O({v:1,t:1})),...t];case"PAIR":{const h=g.args?parseInt(g.args[0].int,10):2;if(h<2)throw new H(g,t,`PAIR ${h} is forbidden`);const y=s(0,...new Array(h).fill(null)),S=O({f:h,t:1,v:1},{specialFields:!0}),P=bt=>{const Ht=bt.lastIndexOf(".");return bt.slice(Ht>0?Ht+1:1)},Lt=y.map((bt,Ht)=>{var Vn;const Gs=c(bt),iu=S.f&&S.f.length>Ht&&S.f[Ht]!=="%"?S.f[Ht]==="%@"?Gs.v?["%"+P(((Vn=Gs.v)===null||Vn===void 0?void 0:Vn[0])||"")]:void 0:[S.f[Ht]]:void 0;return A(bt,{v:null,t:null,f:iu})});return[A({prim:"pair",args:Lt},{t:S.t,v:S.v}),...t.slice(h)]}case"UNPAIR":{const h=g.args?parseInt(g.args[0].int,10):2;if(h<2)throw new H(g,t,`UNPAIR ${h} is forbidden`);const y=s(0,["pair"])[0],S=O({f:2,v:2},{specialVar:!0});return[...k(y,h).map((Lt,bt)=>It(y,Lt,S,bt,bt===0?"car":"cdr")),...t.slice(1)]}case"CAR":case"CDR":{const h=Ct("pair",s(0,["pair"])[0]),y=h.args[g.prim==="CAR"?0:1],S=O({f:1,v:1},{specialVar:!0});return[It(h,y,S,0,g.prim.toLocaleLowerCase()),...t.slice(1)]}case"CONS":{const h=s(0,null,["list"]);return l(h[0],h[1].args[0]),[_({prim:"list",args:[h[1].args[0]]}),...t.slice(2)]}case"SIZE":return s(0,["string","list","set","map","bytes"]),[_({prim:"nat"}),...t.slice(1)];case"MEM":{const h=s(0,null,["set","map","big_map"]);return d(h[0]),l(h[0],h[1].args[0]),[_({prim:"bool"}),...t.slice(2)]}case"GET":if(g.args){const h=parseInt(g.args[0].int,10),y=s(0,["pair"])[0];return[_(ge(y,h)),...t.slice(1)]}else{const h=s(0,null,["map","big_map"]);return d(h[0]),l(h[0],h[1].args[0]),[_({prim:"option",args:[h[1].args[1]]}),...t.slice(2)]}case"UPDATE":if(g.args){const h=parseInt(g.args[0].int,10),y=s(0,null,["pair"]);return[_(me(y[1],y[0],h)),...t.slice(2)]}else{const h=s(0,null,["bool","option"]);if(d(h[0]),h[1].prim==="bool"){const S=s(2,["set"]);return l(h[0],S[0].args[0]),[_({prim:"set",args:[A(h[0],{t:null})]}),...t.slice(3)]}const y=s(2,["map","big_map"]);return l(h[0],y[0].args[0]),y[0].prim==="map"?[_({prim:"map",args:[A(h[0],{t:null}),A(h[1].args[0],{t:null})]}),...t.slice(3)]:(w(h[1].args[0]),[_({prim:"big_map",args:[A(h[0],{t:null}),A(h[1].args[0],{t:null})]}),...t.slice(3)])}case"GET_AND_UPDATE":{const h=O({v:2}),y=s(0,null,["option"],["map","big_map"]);d(y[0]),l(y[0],y[2].args[0]),l(y[1].args[0],y[2].args[1]);const S=(N=h.v)===null||N===void 0?void 0:N.map(P=>P!=="@"?[P]:void 0);return y[2].prim==="map"?[A({prim:"option",args:[y[2].args[1]]},{v:S==null?void 0:S[0]}),A({prim:"map",args:[A(y[0],{t:null}),A(y[1].args[0],{t:null})]},{v:S==null?void 0:S[1]}),...t.slice(3)]:(w(y[1].args[0]),[A({prim:"option",args:[y[2].args[1]]},{v:S==null?void 0:S[0]}),A({prim:"big_map",args:[A(y[0],{t:null}),A(y[1].args[0],{t:null})]},{v:S==null?void 0:S[1]}),...t.slice(3)])}case"EXEC":{const h=s(0,null,["lambda"]);return l(h[0],h[1].args[0]),[_(h[1].args[1]),...t.slice(2)]}case"APPLY":{const h=s(0,null,["lambda"]);if(v(h[0]),b(h[0]),!Ie(h[1].args[0]))throw new H(g,t,`${g.prim}: function's argument must be a pair: ${F(h[1].args[0])}`);const y=h[1].args[0];return l(h[0],Rn(y)[0]),[_({prim:"lambda",args:[Rn(y)[1],h[1].args[1]]}),...t.slice(2)]}case"FAILWITH":{const h=s(0,null)[0];return vr(n,xe.PtEdo2Zk)||m(h),{failed:h,level:0}}case"NEVER":return s(0,["never"]),{failed:{prim:"never"},level:0};case"RENAME":return[_(s(0,null)[0]),...t.slice(1)];case"CONCAT":{const h=s(0,["string","list","bytes"]);if(h[0].prim==="list"){if(F(h[0].args[0])!=="string"&&F(h[0].args[0])!=="bytes")throw new H(g,t,`${g.prim}: can't concatenate list of ${F(h[0].args[0])}'s`);return[_(h[0].args[0]),...t.slice(1)]}const y=s(1,["string","bytes"]);if(h[0].prim!==y[0].prim)throw new H(g,t,`${g.prim}: can't concatenate ${h[0].prim} with ${y[0].prim}`);return[_(y[0]),...t.slice(2)]}case"SLICE":return[_({prim:"option",args:[s(0,["nat"],["nat"],["string","bytes"])[2]]},"@slice"),...t.slice(3)];case"PACK":{const h=s(0,null)[0];return m(h),[_({prim:"bytes"},"@packed"),...t.slice(1)]}case"ADD":{const h=s(0,["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(h[0].prim==="nat"&&h[1].prim==="int"||h[0].prim==="int"&&h[1].prim==="nat")return[_({prim:"int"}),...t.slice(2)];if(h[0].prim==="int"&&h[1].prim==="timestamp"||h[0].prim==="timestamp"&&h[1].prim==="int")return[_({prim:"timestamp"}),...t.slice(2)];if((h[0].prim==="int"||h[0].prim==="nat"||h[0].prim==="mutez"||h[0].prim==="bls12_381_g1"||h[0].prim==="bls12_381_g2"||h[0].prim==="bls12_381_fr")&&h[0].prim===h[1].prim)return[_(h[0]),...t.slice(2)];throw new H(g,t,`${g.prim}: can't add ${h[0].prim} to ${h[1].prim}`)}case"SUB":{const h=vr(n,xe.PsiThaCa)?s(0,["nat","int","timestamp","mutez"],["nat","int","timestamp","mutez"]):s(0,["nat","int","timestamp"],["nat","int","timestamp"]);if((h[0].prim==="nat"||h[0].prim==="int")&&(h[1].prim==="nat"||h[1].prim==="int")||h[0].prim==="timestamp"&&h[1].prim==="timestamp")return[_({prim:"int"}),...t.slice(2)];if(h[0].prim==="timestamp"&&h[1].prim==="int")return[_({prim:"timestamp"}),...t.slice(2)];if(h[0].prim==="mutez"&&h[1].prim==="mutez")return[_({prim:"mutez"}),...t.slice(2)];throw new H(g,t,`${g.prim}: can't subtract ${h[0].prim} from ${h[1].prim}`)}case"SUB_MUTEZ":return s(0,["mutez"],["mutez"]),[_({prim:"option",args:[{prim:"mutez"}]}),...t.slice(2)];case"MUL":{const h=s(0,["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(h[0].prim==="nat"&&h[1].prim==="int"||h[0].prim==="int"&&h[1].prim==="nat")return[_({prim:"int"}),...t.slice(2)];if(h[0].prim==="nat"&&h[1].prim==="mutez"||h[0].prim==="mutez"&&h[1].prim==="nat")return[_({prim:"mutez"}),...t.slice(2)];if((h[0].prim==="bls12_381_g1"||h[0].prim==="bls12_381_g2"||h[0].prim==="bls12_381_fr")&&h[1].prim==="bls12_381_fr"||(h[0].prim==="nat"||h[0].prim==="int")&&h[0].prim===h[1].prim)return[_(h[0]),...t.slice(2)];if((h[0].prim==="nat"||h[0].prim==="int")&&h[1].prim==="bls12_381_fr"||(h[1].prim==="nat"||h[1].prim==="int")&&h[0].prim==="bls12_381_fr")return[_({prim:"bls12_381_fr"}),...t.slice(2)];throw new H(g,t,`${g.prim}: can't multiply ${h[0].prim} by ${h[1].prim}`)}case"EDIV":{const h=(S,P)=>({prim:"option",args:[{prim:"pair",args:[{prim:S},{prim:P}]}]}),y=s(0,["nat","int","mutez"],["nat","int","mutez"]);if(y[0].prim==="nat"&&y[1].prim==="nat")return[_(h("nat","nat")),...t.slice(2)];if((y[0].prim==="nat"||y[0].prim==="int")&&(y[1].prim==="nat"||y[1].prim==="int"))return[_(h("int","nat")),...t.slice(2)];if(y[0].prim==="mutez"&&y[1].prim==="nat")return[_(h("mutez","mutez")),...t.slice(2)];if(y[0].prim==="mutez"&&y[1].prim==="mutez")return[_(h("nat","mutez")),...t.slice(2)];throw new H(g,t,`${g.prim}: can't euclideally divide ${y[0].prim} by ${y[1].prim}`)}case"ABS":return s(0,["int"]),[_({prim:"nat"}),...t.slice(1)];case"ISNAT":return s(0,["int"]),[_({prim:"option",args:[{prim:"nat"}]}),...t.slice(1)];case"INT":return s(0,["nat","bls12_381_fr","bytes"]),[_({prim:"int"}),...t.slice(1)];case"BYTES":return s(0,["nat","int"]),[_({prim:"bytes"}),...t.slice(1)];case"NAT":return s(0,["bytes"]),[_({prim:"nat"}),...t.slice(1)];case"NEG":{const h=s(0,["nat","int","bls12_381_g1","bls12_381_g2","bls12_381_fr"])[0];return h.prim==="nat"||h.prim==="int"?[_({prim:"int"}),...t.slice(1)]:[_(h),...t.slice(1)]}case"LSL":case"LSR":return s(0,["nat","bytes"],["nat","bytes"]),[_({prim:"nat"}),...t.slice(2)];case"OR":case"XOR":{const h=s(0,["nat","bytes","bool"],["nat","bytes","bool"]);if(h[0].prim!==h[1].prim)throw new H(g,t,`${g.prim}: both arguments must be of the same type: ${h[0].prim}, ${h[1].prim}`);return[_(h[1]),...t.slice(2)]}case"AND":{const h=s(0,["nat","bytes","bool","int"],["nat","bytes","bool"]);if((h[0].prim!=="int"||h[1].prim!=="nat")&&h[0].prim!==h[1].prim)throw new H(g,t,`${g.prim}: both arguments must be of the same type: ${h[0].prim}, ${h[1].prim}`);return[_(h[1]),...t.slice(2)]}case"NOT":return s(0,["nat","bytes","bool","int"])[0].prim==="bool"?[_({prim:"bool"}),...t.slice(1)]:[_({prim:"int"}),...t.slice(1)];case"COMPARE":{const h=s(0,null,null);return d(h[0]),d(h[1]),[_({prim:"int"}),...t.slice(2)]}case"EQ":case"NEQ":case"LT":case"GT":case"LE":case"GE":return s(0,["int"]),[_({prim:"bool"}),...t.slice(1)];case"SELF":{if((e==null?void 0:e.contract)===void 0)throw new H(g,t,`${g.prim}: contract required`);const h=O({f:1,v:1}),y=xi(e.contract,(L=h.f)===null||L===void 0?void 0:L[0]);if(y===null)throw new H(g,t,`${g.prim}: contract has no entrypoint ${y}`);return[A({prim:"contract",args:[y]},{v:h.v?h.v:["@self"]}),...t]}case"TRANSFER_TOKENS":{const h=s(0,null,["mutez"],["contract"]);return l(h[0],h[2].args[0]),[_({prim:"operation"}),...t.slice(3)]}case"SET_DELEGATE":{const h=s(0,["option"])[0];if(F(h.args[0])!=="key_hash")throw new H(g,t,`${g.prim}: key hash expected: ${F(h.args[0])}`);return[_({prim:"operation"}),...t.slice(1)]}case"IMPLICIT_ACCOUNT":return s(0,["key_hash"]),[_({prim:"contract",args:[{prim:"unit"}]}),...t.slice(1)];case"NOW":return[_({prim:"timestamp"},"@now"),...t];case"AMOUNT":return[_({prim:"mutez"},"@amount"),...t];case"BALANCE":return[_({prim:"mutez"},"@balance"),...t];case"CHECK_SIGNATURE":return s(0,["key"],["signature"],["bytes"]),[_({prim:"bool"}),...t.slice(3)];case"BLAKE2B":case"SHA256":case"SHA512":case"KECCAK":case"SHA3":return s(0,["bytes"]),[_({prim:"bytes"}),...t.slice(1)];case"HASH_KEY":return s(0,["key"]),[_({prim:"key_hash"}),...t.slice(1)];case"SOURCE":return[_({prim:"address"},"@source"),...t];case"SENDER":return[_({prim:"address"},"@sender"),...t];case"ADDRESS":{const h=s(0,["contract"])[0],y=O({v:1});return[A({prim:"address",[tn]:h},{v:y.v?y.v:Nt(c(h),"address")}),...t.slice(1)]}case"SELF_ADDRESS":{const h={prim:"address"};return(e==null?void 0:e.contract)!==void 0&&(h[tn]={prim:"contract",args:[he(e.contract,"parameter").args[0]]}),[_(h,"@address"),...t]}case"CHAIN_ID":return[_({prim:"chain_id"}),...t];case"DROP":{O({});const h=g.args!==void 0?parseInt(g.args[0].int,10):1;return s(h-1,null),t.slice(h)}case"DIG":{O({});const h=parseInt(g.args[0].int,10);return[s(h,null)[0],...t.slice(0,h),...t.slice(h+1)]}case"DUG":{O({});const h=parseInt(g.args[0].int,10);return[...t.slice(1,h+1),s(0,null)[0],...t.slice(h+1)]}case"NONE":return tt(g.args[0]),[A({prim:"option",args:[g.args[0]]},O({t:1,v:1})),...t];case"LEFT":case"RIGHT":{const h=s(0,null)[0],y=O({f:2,t:1,v:1},{specialFields:!0}),S=c(h),P=[A(h,{t:null,v:null,f:y.f&&y.f.length>0&&y.f[0]!=="%"?y.f[0]==="%@"?S.v?["%"+S.v[0].slice(1)]:void 0:y.f:void 0}),A(g.args[0],{t:null,f:y.f&&y.f.length>1&&y.f[1]!=="%"?y.f:void 0})];return[A({prim:"or",args:g.prim==="LEFT"?P:[P[1],P[0]]},{t:y.t,v:y.v}),...t.slice(1)]}case"NIL":return tt(g.args[0]),[A({prim:"list",args:[g.args[0]]},O({t:1,v:1})),...t];case"UNPACK":return s(0,["bytes"]),tt(g.args[0]),[_({prim:"option",args:[g.args[0]]},"@unpacked"),...t.slice(1)];case"CONTRACT":{const h=s(0,["address"])[0];tt(g.args[0]);const y=O({v:1,f:1}),S=h[tn];if(S!==void 0){const P=xi(S,(U=y.f)===null||U===void 0?void 0:U[0]);if(P===null)throw new H(g,t,`${g.prim}: contract has no entrypoint ${P}`);l(P,g.args[0])}return[A({prim:"option",args:[{prim:"contract",args:[g.args[0]]}]},{v:y.v?y.v:Nt(c(h),"contract")}),...t.slice(1)]}case"CAST":{O({});const h=s(0,null)[0];return tt(g.args[0]),l(g.args[0],h),[g.args[0],...t.slice(1)]}case"IF_NONE":{O({});const h=s(0,["option"])[0],y=t.slice(1),S=dt(g.args[0],y,e),P=dt(g.args[1],[A(h.args[0],{t:null,v:Nt(c(h),"some")}),...y],e);return nr(S,P)}case"IF_LEFT":{O({});const h=s(0,["or"])[0],y=c(h),S=c(h.args[0]),P=c(h.args[1]),Lt=t.slice(1),bt=dt(g.args[0],[A(h.args[0],{t:null,v:Nt(y,S.f?S.f[0].slice(1):"left")}),...Lt],e),Ht=dt(g.args[1],[A(h.args[1],{t:null,v:Nt(y,P.f?P.f[0].slice(1):"right")}),...Lt],e);return nr(bt,Ht)}case"IF_CONS":{O({});const h=s(0,["list"])[0],y=c(h),S=t.slice(1),P=dt(g.args[0],[A(h.args[0],{t:null,v:Nt(y,"hd")}),A(h,{t:null,v:Nt(y,"tl")}),...S],e),Lt=dt(g.args[1],S,e);return nr(P,Lt)}case"IF":{O({}),s(0,["bool"]);const h=t.slice(1),y=dt(g.args[0],h,e),S=dt(g.args[1],h,e);return nr(y,S)}case"MAP":{const h=s(0,["list","map","option"])[0],y=t.slice(1),S=h.prim==="map"?{prim:"pair",args:h.args}:h.args[0],P=dt(g.args[0],[A(S,{t:null,v:Nt(c(h),"elt")}),...y],e);if("failed"in P){if(!("prim"in P.failed)||P.failed.prim!=="never")throw new H(g,t,`${g.prim}: FAIL is not allowed in MAP`);return{failed:P.failed,level:P.level+1}}if(P.length<1)throw new H(g,t,`${g.prim}: function must return a value`);return u(P.slice(1),y),h.prim==="list"?[_({prim:"list",args:[P[0]]}),...y]:h.prim==="map"?[_({prim:"map",args:[h.args[0],P[0]]}),...y]:[_({prim:"option",args:[P[0]]}),...y]}case"ITER":{O({});const h=s(0,["set","list","map"])[0],y=t.slice(1),S=h.prim==="map"?{prim:"pair",args:h.args}:h.args[0],P=dt(g.args[0],[A(S,{t:null,v:Nt(c(h),"elt")}),...y],e);return"failed"in P?{failed:P.failed,level:P.level+1}:(u(P,y),y)}case"LOOP":{O({}),s(0,["bool"]);const h=t.slice(1),y=dt(g.args[0],h,e);return"failed"in y?{failed:y.failed,level:y.level+1}:(u(y,[{prim:"bool"},...h]),h)}case"LOOP_LEFT":{O({});const h=s(0,["or"])[0],y=t.slice(1),S=dt(g.args[0],[A(h.args[0],{t:null,v:Nt(c(h),"left")}),...y],e);return"failed"in S?{failed:S.failed,level:S.level+1}:(u(S,[h,...y]),[A(h.args[1],{t:null,v:O({v:1}).v}),...y])}case"DIP":{O({});const h=g.args.length===2?parseInt(g.args[0].int,10):1;s(h-1,null);const y=t.slice(0,h),S=t.slice(h),P=g.args.length===2?dt(g.args[1],S,e):dt(g.args[0],S,e);return"failed"in P?{failed:P.failed,level:P.level+1}:[...y,...P]}case"CREATE_CONTRACT":{const h=O({v:2}),y=s(0,["option"],["mutez"],null);if(F(y[0].args[0])!=="key_hash")throw new H(g,t,`${g.prim}: key hash expected: ${F(y[0].args[0])}`);v(y[2])&&(Nc(g.args[0]),Gt(he(g.args[0],"storage").args[0],y[2]));const S=(j=h.v)===null||j===void 0?void 0:j.map(P=>P!=="@"?[P]:void 0);return[A({prim:"operation"},{v:S==null?void 0:S[0]}),A({prim:"address",[tn]:{prim:"contract",args:[he(g.args[0],"parameter").args[0]]}},{v:S==null?void 0:S[1]}),...t.slice(3)]}case"PUSH":return tt(g.args[0]),Ut(g.args[1],g.args[0],Object.assign(Object.assign({},e),{contract:void 0})),[_(g.args[0]),...t];case"EMPTY_SET":return tt(g.args[0]),d(g.args[0]),[A({prim:"set",args:g.args},O({t:1,v:1})),...t];case"EMPTY_MAP":return tt(g.args[0]),d(g.args[0]),tt(g.args[1]),[A({prim:"map",args:g.args},O({t:1,v:1})),...t];case"EMPTY_BIG_MAP":return tt(g.args[0]),d(g.args[0]),tt(g.args[1]),w(g.args[0]),[A({prim:"big_map",args:g.args},O({t:1,v:1})),...t];case"LAMBDA_REC":case"LAMBDA":{tt(g.args[0]),tt(g.args[1]);const h=[g.args[0]];g.prim==="LAMBDA_REC"&&h.push({prim:"lambda",args:[g.args[0],g.args[1]]});const y=dt(g.args[2],h,Object.assign(Object.assign({},e),{contract:void 0}));if("failed"in y)return{failed:y.failed,level:y.level+1};if(y.length!==1)throw new H(g,t,`${g.prim}: function must return a value`);return l(g.args[1],y[0]),[_({prim:"lambda",args:[g.args[0],g.args[1]]}),...t]}case"LEVEL":return[_({prim:"nat"},"@level"),...t];case"TOTAL_VOTING_POWER":return[_({prim:"nat"}),...t];case"VOTING_POWER":return s(0,["key_hash"]),[_({prim:"nat"}),...t.slice(1)];case"TICKET":{const h=s(0,null,["nat"])[0];return d(h),vr(n,xe.PtLimaPtL)?[A({prim:"ticket",args:[h]},O({t:1,v:1})),...t.slice(2)]:[_({prim:"option",args:[A({prim:"ticket",args:[h]},O({t:1,v:1}))]}),...t.slice(2)]}case"JOIN_TICKETS":{const h=Ct("pair",s(0,["pair"])[0]);if(F(h.args[0])!=="ticket")throw new H(g,t,`${g.prim}: ticket expected: ${F(h.args[0])}`);return l(h.args[0],h.args[1]),[_({prim:"option",args:[A(h.args[0],{t:null})]}),...t.slice(1)]}case"SPLIT_TICKET":{const h=s(0,["ticket"],["pair"]),y=Ct("pair",h[1]);if(F(y.args[0])!=="nat")throw new H(g,t,`${g.prim}: nat expected: ${F(y.args[0])}`);return l(y.args[0],y.args[1]),[_({prim:"option",args:[{prim:"pair",args:[A(h[0],{t:null}),A(h[0],{t:null})]}]}),...t.slice(2)]}case"READ_TICKET":{const h=O({v:2}),y=s(0,["ticket"])[0],S=(ft=h.v)===null||ft===void 0?void 0:ft.map(P=>P!=="@"?[P]:void 0);return[A({prim:"pair",args:[{prim:"address"},A(y.args[0],{t:null}),{prim:"nat"}]},{v:S==null?void 0:S[0]}),A(y,{v:S==null?void 0:S[1],t:null}),...t.slice(1)]}case"PAIRING_CHECK":{const h=s(0,["list"])[0].args[0];if(!Ie(h))throw new H(g,t,`${g.prim}: pair expected: ${F(h)}`);const y=Ct("pair",h);if(F(y.args[0])!=="bls12_381_g1")throw new H(g,t,`${g.prim}: bls12_381_g1 expected: ${F(y.args[0])}`);if(F(y.args[1])!=="bls12_381_g2")throw new H(g,t,`${g.prim}: bls12_381_g2 expected: ${F(y.args[1])}`);return[_({prim:"bool"}),...t.slice(1)]}case"SAPLING_EMPTY_STATE":return[A({prim:"sapling_state",args:[g.args[0]]},O({v:1,t:1})),...t];case"SAPLING_VERIFY_UPDATE":{const h=s(0,["sapling_transaction"],["sapling_state"]);if(parseInt(h[0].args[0].int,10)!==parseInt(h[1].args[0].int,10))throw new H(g,t,`${g.prim}: sapling memo size mismatch: ${h[0].args[0].int} != ${h[1].args[0].int}`);return vr(n,xe.PtJakarta)?[_({prim:"option",args:[{prim:"pair",args:[{prim:"int"},A(h[1],{t:null})]}]}),...t.slice(2)]:[_({prim:"option",args:[{prim:"pair",args:[{prim:"bytes"},{prim:"pair",args:[{prim:"int"},A(h[1],{t:null})]}]}]}),...t.slice(2)]}case"OPEN_CHEST":return s(0,["chest_key"],["chest"],["nat"]),[_({prim:"or",args:[{prim:"bytes"},{prim:"bool"}]}),...t.slice(3)];case"VIEW":{const h=s(0,null,["address"]);return b(h[0]),[_({prim:"option",args:[g.args[1]]}),...t.slice(2)]}case"MIN_BLOCK_TIME":return[_({prim:"nat"}),...t];case"EMIT":{const h=O({f:1,t:1});if(g.args){const y=s(0,null);return l(y[0],g.args[0]),[A({prim:"operation"},h),...t.slice(1)]}return[A({prim:"operation"},h),...t.slice(1)]}default:throw new Vt(g,`unexpected instruction: ${g.prim}`)}})(i);if((e==null?void 0:e.traceCallback)!==void 0){const g={op:i,in:t,out:Dr};e.traceCallback(g)}return Dr}function he(r,t){for(const e of r)if(e.prim===t)return e;throw new Vt(r,`missing contract section: ${t}`)}function op(r){const t={};for(const e of r)e.prim==="view"&&(t[e.args[0].string]=e);return t}function Ic(r){if(Array.isArray(r)){for(const t of r)if("prim"in t&&(t.prim==="parameter"||t.prim==="storage"||t.prim==="code"))return!0}return!1}function xi(r,t){t=t||"%default";const e=On(r).find(n=>n[0]===t);return e!==void 0?e[1]:t==="%default"?Ic(r)?he(r,"parameter").args[0]:r:null}function ap(r){return Array.isArray(r)||r.prim==="or"}function On(r){if(Ic(r)){const t=he(r,"parameter"),e=On(t.args[0]),n=Or(t);return n.f?[[n.f[0],t.args[0]],...e]:e}if(ap(r)){const t=Rn(r),e=n=>{const i=Or(t[n]);if(F(t[n])==="or"){const s=On(t[n]);return i.f?[[i.f[0],t[n]],...s]:s}return i.f?[[i.f[0],t[n]]]:[]};return[...e(0),...e(1)]}return[]}function Nc(r,t){const e=(c,u,l,d)=>{tt(c,!0),tt(u);const m={prim:"pair",args:[Object.assign(Object.assign({},c),{annots:["@parameter"]}),Object.assign(Object.assign({},u),{annots:["@storage"]})]},v=dt(d,[m],Object.assign(Object.assign({},t),{contract:r}));if("failed"in v)return v;try{Pc(v,[l])}catch(b){throw b instanceof Vt?new H(d,v,b.message):b}return v},n=he(r,"parameter").args[0],i=he(r,"storage").args[0],s=he(r,"code").args[0],a=e(n,i,{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},i]},s);for(const c of Object.values(op(r)))e(c.args[1],i,c.args[2],c.args[3]);return a}function Lc(r,t,e){tt(t),Ut(r,t,e||null)}function cp(r,t,e){for(const n of t)tt(n);if((e==null?void 0:e.contract)!==void 0)for(const n of["parameter","storage"]){const i=he(e.contract,n).args[0];tt(i)}return dt(r,t,e||null)}function up(r,t,e){try{return Lc(r,t,e),!0}catch{return!1}}class os{constructor(t,e){this.contract=t,this.ctx=Object.assign({contract:t},e),this.output=Nc(t,this.ctx)}static parse(t,e){const n=new ar(e),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new Ld("empty Michelson");if(Ac(i))return new os(i,e)}static parseTypeExpression(t,e){const n=new ar(e),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new xd("empty type expression");if(Ne(i))return tt(i),i}static parseDataExpression(t,e){const n=new ar(e),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new Cd("empty data expression");if(ir(i))return i;throw void 0}section(t){return he(this.contract,t)}entryPoints(){return On(this.contract)}entryPoint(t){return xi(this.contract,t)}assertDataValid(t,e){Lc(t,e,this.ctx)}isDataValid(t,e){return up(t,e,this.ctx)}assertParameterValid(t,e){const n=this.entryPoint(t||void 0);if(n===null)throw new Md(t==null?void 0:t.toString());this.assertDataValid(e,n)}isParameterValid(t,e){try{return this.assertParameterValid(t,e),!0}catch{return!1}}functionType(t,e){return cp(t,e,this.ctx)}}new os([{prim:"parameter",args:[{prim:"unit"}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}]);const zo=r=>r.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),rt=(r,t=8)=>r.toString(16).padStart(t,"0"),as=31;var p;(function(r){r.SECRET="secret",r.RAW="raw",r.TZ1="tz1",r.BRANCH="branch",r.ZARITH="zarith",r.PUBLIC_KEY="public_key",r.PKH="pkh",r.DELEGATE="delegate",r.SCRIPT="script",r.BALLOT_STATEMENT="ballotStmt",r.PROPOSAL="proposal",r.PROPOSAL_ARR="proposalArr",r.INT32="int32",r.INT16="int16",r.PARAMETERS="parameters",r.ADDRESS="address",r.SMART_CONTRACT_ADDRESS="smart_contract_address",r.SMART_ROLLUP_ADDRESS="smart_rollup_address",r.SMART_ROLLUP_COMMITMENT_HASH="smart_rollup_commitment_hash",r.VALUE="value",r.PADDED_BYTES="padded_bytes",r.SMART_ROLLUP_MESSAGE="smart_rollup_message",r.MANAGER="manager",r.BLOCK_PAYLOAD_HASH="blockPayloadHash",r.ENTRYPOINT="entrypoint",r.OPERATION="operation",r.OP_ACTIVATE_ACCOUNT="activate_account",r.OP_DELEGATION="delegation",r.OP_TRANSACTION="transaction",r.OP_ORIGINATION="origination",r.OP_BALLOT="ballot",r.OP_FAILING_NOOP="failing_noop",r.OP_ENDORSEMENT="endorsement",r.OP_SEED_NONCE_REVELATION="seed_nonce_revelation",r.OP_REVEAL="reveal",r.OP_PROPOSALS="proposals",r.OP_REGISTER_GLOBAL_CONSTANT="register_global_constant",r.OP_TRANSFER_TICKET="transfer_ticket",r.OP_TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.OP_TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.BURN_LIMIT="burn_limit",r.TX_ROLLUP_ORIGINATION_PARAM="tx_rollup_origination_param",r.TX_ROLLUP_ID="tx_rollup_id",r.TX_ROLLUP_BATCH_CONTENT="tx_rollup_batch_content",r.OP_INCREASE_PAID_STORAGE="increase_paid_storage",r.OP_UPDATE_CONSENSUS_KEY="update_consensus_key",r.OP_DRAIN_DELEGATE="drain_delegate",r.DEPOSITS_LIMIT="deposits_limit",r.OP_SET_DEPOSITS_LIMIT="set_deposits_limit",r.OP_SMART_ROLLUP_ORIGINATE="smart_rollup_originate",r.PVM_KIND="pvm_kind",r.OP_SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",r.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message"})(p||(p={}));const Jt={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0a":"True","0b":"Unit","0c":"PACK","0d":"UNPACK","0e":"BLAKE2B","0f":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1a":"CONCAT","1b":"CONS","1c":"CREATE_ACCOUNT","1d":"CREATE_CONTRACT","1e":"IMPLICIT_ACCOUNT","1f":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2a":"GT","2b":"HASH_KEY","2c":"IF","2d":"IF_CONS","2e":"IF_LEFT","2f":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3a":"MUL","3b":"NEG","3c":"NEQ","3d":"NIL","3e":"NONE","3f":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4a":"STEPS_TO_QUOTA","4b":"SUB","4c":"SWAP","4d":"TRANSFER_TOKENS","4e":"SET_DELEGATE","4f":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5a":"contract","5b":"int","5c":"key","5d":"key_hash","5e":"lambda","5f":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6a":"mutez","6b":"timestamp","6c":"unit","6d":"operation","6e":"address","6f":"SLICE",70:"DIG",71:"DUG",72:"EMPTY_BIG_MAP",73:"APPLY",74:"chain_id",75:"CHAIN_ID",76:"LEVEL",77:"SELF_ADDRESS",78:"never",79:"NEVER","7a":"UNPAIR","7b":"VOTING_POWER","7c":"TOTAL_VOTING_POWER","7d":"KECCAK","7e":"SHA3","7f":"PAIRING_CHECK",80:"bls12_381_g1",81:"bls12_381_g2",82:"bls12_381_fr",83:"sapling_state",84:"sapling_transaction_deprecated",85:"SAPLING_EMPTY_STATE",86:"SAPLING_VERIFY_UPDATE",87:"ticket",88:"TICKET_DEPRECATED",89:"READ_TICKET","8a":"SPLIT_TICKET","8b":"JOIN_TICKETS","8c":"GET_AND_UPDATE","8d":"chest","8e":"chest_key","8f":"OPEN_CHEST",90:"VIEW",91:"view",92:"constant",93:"SUB_MUTEZ",94:"tx_rollup_l2_address",95:"MIN_BLOCK_TIME",96:"sapling_transaction",97:"EMIT",98:"Lambda_rec",99:"LAMBDA_REC","9a":"TICKET","9b":"BYTES","9c":"NAT"},lp=(()=>{const r={};return Object.keys(Jt).forEach(t=>{r[Jt[t]]=t}),r})(),Ci={4:"activate_account",107:"reveal",110:"delegation",108:"transaction",109:"origination",6:"ballot",21:"endorsement",1:"seed_nonce_revelation",5:"proposals",111:"register_global_constant",150:"tx_rollup_origination",151:"tx_rollup_submit_batch",158:"transfer_ticket",112:"set_deposits_limit",113:"increase_paid_storage",114:"update_consensus_key",9:"drain_delegate",200:"smart_rollup_originate",201:"smart_rollup_add_messages",206:"smart_rollup_execute_outbox_message",17:"failing_noop"},Jo=(()=>{const r={};return Object.keys(Ci).forEach(t=>{const e=typeof t=="string"?parseInt(t,10):t;r[Ci[e]]=rt(e,2)}),r})(),Pn={"00":"default","01":"root","02":"do","03":"set_delegate","04":"remove_delegate","05":"deposit"},qo=(()=>{const r={};return Object.keys(Pn).forEach(t=>{r[Pn[t]]=t}),r})();class Wo extends W{constructor(t,e){super(),this.operation=t,this.errorDetail=e,this.name="InvalidOperationSchemaError",this.message="Invalid operation content recevied",e&&(this.message+=` ${e}.`)}}class xc extends W{constructor(t){super(),this.entrypoint=t,this.name="OversizedEntryPointError",this.message=`Invalid entrypoint length "${t.length}", maximum length is "${as}".`}}class hp extends W{constructor(t){super(),this.ballotValue=t,this.name="InvalidBallotValueError",this.message=`Invalid ballot value "${t}" expecting one of the following: "yay", "nay", "pass".`}}class dp extends W{constructor(t){super(),this.ballotValue=t,this.name="DecodeBallotValueError",this.message=`Invalid ballot value "${t}", cannot be decoded.`}}class pp extends W{constructor(t){super(),this.value=t,this.name="UnexpectedMichelsonValueError",this.message=`Invalid Michelson value "${t}", unalbe to encode.`}}class Cc extends W{constructor(t){super(),this.message=t,this.name="OperationDecodingError"}}class fp extends W{constructor(t){super(),this.message=t,this.name="OperationEncodingError"}}class gp extends W{constructor(t){super(),this.op=t,this.name="UnsupportedOperationError",this.message=`Unsupported operation "${t}", can submit an issue on our github for feature request.`}}class mp extends W{constructor(t){super(),this.pvm=t,this.name="UnsupportedPvmKindError",this.message=`Invalid Pvm kind "${t}" expecting either "arith" or "wasm_2_0_0".`}}class yp extends W{constructor(t){super(),this.pvm=t,this.name="DecodePvmKindError",this.message=`Invalid Pvm kind "${t}", cannot be decoded.`}}class Mc extends W{constructor(t,e){super(),this.address=t,this.errorDetail=e,this.name="InvalidSmartRollupAddress",this.message=`Invalid smart rollup address "${t}"`,e&&(this.message+=` ${e}.`)}}class Dc extends W{constructor(t,e){super(),this.hash=t,this.errorDetail=e,this.name="InvalidSmartRollupCommitmentHashError",this.message=`Invalid smart rollup commitment hash "${t}"`,e&&(this.message+=` ${e}.`)}}class Ft{constructor(t,e=0){this.arr=t,this.offset=e}static fromHexString(t){const e=t.toLowerCase();if(/^(([a-f]|\d){2})*$/.test(e)){const n=new Uint8Array((e.match(/([a-z]|\d){2}/g)||[]).map(i=>parseInt(i,16)));return new Ft(n)}else throw new ua(e)}consume(t){const e=this.arr.subarray(this.offset,this.offset+t);return this.offset+=t,e}get(t){return this.arr[this.offset+t]}length(){return this.arr.length-this.offset}slice(t,e){return new Ft(this.arr.slice(t,e))}}const vp=r=>"prim"in r,Ep=r=>"bytes"in r&&typeof r.bytes=="string",bp=r=>"string"in r&&typeof r.string=="string",_p=r=>"int"in r&&typeof r.int=="string",wp=r=>{const t=Xe(r.code),e=Xe(r.storage);return`${rt(t.length/2,8)}${t}${rt(e.length/2,8)}${e}`},Ap=r=>{const t=$t(r),e=$t(r);return{code:Qe(new Ft(t)),storage:Qe(new Ft(e))}},Xe=r=>{if(Array.isArray(r)){const t=r.map(n=>Xe(n)).join(""),e=t.length/2;return`02${rt(e)}${t}`}else{if(vp(r))return Lp(r);if(Ep(r))return Rp(r);if(bp(r))return Pp(r);if(_p(r))return Ip(r)}throw new pp(JSON.stringify(r))},Qe=r=>{const t=r.consume(1);switch(t[0]){case 10:return Op(r);case 1:return Tp(r);case 0:return Np(r);case 2:{const e=new Ft($t(r)),n=[];for(;e.length()>0;)n.push(Qe(e));return n}default:return xp(r,t)}},$t=(r,t=4)=>{const e=r.consume(t),n=parseInt(Buffer.from(e).toString("hex"),16);return r.consume(n)},Sp=(r,t=4)=>{const e=[];let n=r;for(;n.length();){const i=n.consume(t),s=parseInt(Buffer.from(i).toString("hex"),16);e.push(n.consume(s)),n=n.slice(s+t)}return e},Rp=r=>{if(!/^([A-Fa-f0-9]{2})*$/.test(r.bytes))throw new ua(r.bytes);const t=r.bytes.length/2;return`0a${rt(t)}${r.bytes}`},Op=r=>{const t=$t(r);return{bytes:Buffer.from(t).toString("hex")}},Pp=r=>{const t=Buffer.from(r.string,"utf8").toString("hex"),e=t.length/2;return`01${rt(e)}${t}`},Tp=r=>{const t=$t(r);return{string:Buffer.from(t).toString("utf8")}},Ip=({int:r})=>{const t=new I(r,10),e=t.toString(2)[0]==="-"?"1":"0",n=t.toString(2).replace(/-/g,""),i=n.length<=6?6:(n.length-6)%7?n.length+7-(n.length-6)%7:n.length,o=n.padStart(i,"0").match(/\d{6,7}/g).reverse();return o[0]=e+o[0],`00${o.map((c,u)=>parseInt((u===o.length-1?"0":"1")+c,2).toString(16).padStart(2,"0")).join("")}`},Np=r=>{let t=r.consume(1)[0];const e=[],n=128;for(;t&n;)e.push(t),t=r.consume(1)[0];e.push(t);const i=!!(64&e[0]);e[0]=e[0]&127;const s=e.map((a,c)=>a.toString(2).slice(c===0?-6:-7).padStart(c===0?6:7,"0")).reverse();let o=new I(s.join(""),2);return i&&(o=o.times(-1)),{int:o.toFixed()}},Lp=r=>{const t=+Array.isArray(r.annots),e=Array.isArray(r.args)?r.args.length:0,n=rt(Math.min(2*e+t+3,9),2),i=lp[r.prim];let s=(r.args||[]).map(a=>Xe(a)).join("");const o=Array.isArray(r.annots)?Dp(r.annots):"";return(r.prim==="LAMBDA"||r.prim==="LAMBDA_REC")&&e&&(s=rt(s.length/2)+s+rt(0)),(r.prim==="pair"||r.prim==="Pair")&&e>2&&(s=o===""?rt(s.length/2)+s+rt(0):rt(s.length/2)+s),r.prim==="view"&&r.args&&(s=rt(s.length/2)+s+rt(0)),`${n}${i}${s}${o}`},xp=(r,t)=>{const e=(t[0]-3)%2===1;let n=Math.floor((t[0]-3)/2);const i=r.consume(1)[0].toString(16).padStart(2,"0"),s={prim:Jt[i]};if((Jt[i]==="LAMBDA"||Jt[i]==="LAMBDA_REC")&&r.consume(4),Jt[i]==="view")return n!=0?Cp(r,s):s;let o,a;(Jt[i]==="pair"||Jt[i]==="Pair")&&n>2&&(o=Mp(r),n=0,a=Zo(r));const c=new Array(n).fill(0).map(()=>Qe(r));return(Jt[i]==="LAMBDA"||Jt[i]==="LAMBDA_REC")&&r.consume(4),o?s.args=o:c.length&&(s.args=c),a&&a[0]!==""?s.annots=a:e&&(s.annots=Zo(r)),s},Cp=(r,t)=>(r.consume(4),t.args=new Array(4).fill(0).map(()=>Qe(r)),r.consume(4),t),Mp=r=>{const t=new Ft($t(r)),e=[];for(;t.length()>0;)e.push(Qe(t));return e},Dp=r=>{const t=r.map(n=>Buffer.from(n,"utf8").toString("hex")).join("20"),e=t.length/2;return`${rt(e)}${t}`},Zo=r=>{const t=r.consume(4),e=parseInt(Buffer.from(t).toString("hex"),16),n=r.consume(e);return Buffer.from(n).toString("hex").split("20").map(s=>Buffer.from(s,"hex").toString("utf8"))},Et=r=>t=>hu(Buffer.from(aa(t,ji[r]))),At=r=>t=>{const e=t.consume(du[r]);return pu(e,ji[r])},kp=At(R.TZ1),Bp=At(R.B),cs=r=>{const t=r.consume(1);if(t[0]===0)return At(R.TZ1)(r);if(t[0]===1)return At(R.TZ2)(r);if(t[0]===2)return At(R.TZ3)(r)},$p=Et(R.B),Hp=Et(R.TZ1),Yo=r=>r?"ff":"00",kc=r=>Et(R.P)(r),Bc=r=>At(R.P)(r),jp=r=>{const t=[];for(r.consume(4);r.length()>0;)t.push(Bc(r));return t},Up=r=>rt(32*r.length)+r.map(t=>kc(t)).join(""),Gp=r=>{switch(r){case"yay":return"00";case"nay":return"01";case"pass":return"02";default:throw new hp(r)}},Kp=r=>{const t=r.consume(1);switch(t[0]){case 0:return"yay";case 1:return"nay";case 2:return"pass";default:throw new dp(t[0].toString())}},Vp=r=>{switch(r){case"arith":return"00";case"wasm_2_0_0":return"01";default:throw new mp(r)}},Fp=r=>{const t=r.consume(1);switch(t[0]){case 0:return"arith";case 1:return"wasm_2_0_0";default:throw new yp(t[0].toString())}},zp=r=>r?Yo(!0)+us(r):Yo(!1),Jp=r=>{const t=parseInt(String(r),10),e=[];for(let n=0;n<4;n++){const i=(4-(n+1))*8;e.push((t&255<<i)>>i)}return Buffer.from(e).toString("hex")},qp=r=>{const t=r.consume(4);let e=0;for(let n=0;n<t.length;n++)e=e|t[n]<<(t.length-(n+1))*8;return e},Wp=r=>{const t=parseInt(String(r),10),e=[];for(let n=0;n<2;n++){const i=(2-(n+1))*8;e.push((t&255<<i)>>i)}return Buffer.from(e).toString("hex")},Zp=r=>{const t=r.consume(2);let e=0;for(let n=0;n<t.length;n++)e=e|t[n]<<(t.length-(n+1))*8;return e},Yp=r=>r.consume(1)[0]===255,Xp=r=>{if(Yp(r))return cs(r)},us=r=>{switch(r.substring(0,3)){case R.TZ1:return"00"+Et(R.TZ1)(r);case R.TZ2:return"01"+Et(R.TZ2)(r);case R.TZ3:return"02"+Et(R.TZ3)(r);case R.TZ4:return"03"+Et(R.TZ4)(r);default:throw new Gi(r,$(T.NO_PREFIX_MATCHED)+` expecting one for the following "${R.TZ1}", "${R.TZ2}", "${R.TZ3}" or "${R.TZ4}".`)}},Qp=r=>{switch(r.substring(0,4)){case R.EDPK:return"00"+Et(R.EDPK)(r);case R.SPPK:return"01"+Et(R.SPPK)(r);case R.P2PK:return"02"+Et(R.P2PK)(r);default:throw new la(r,$(T.NO_PREFIX_MATCHED)+` expecting one of the following '${R.EDPK}', '${R.SPPK}', '${R.P2PK}' or '${R.BLPK}'.`)}},tf=r=>{switch(r.substring(0,3)){case R.TZ1:case R.TZ2:case R.TZ3:case R.TZ4:return"00"+us(r);case R.KT1:return"01"+Et(R.KT1)(r)+"00";default:throw new z(r,$(T.NO_PREFIX_MATCHED)+` expecting one of the following prefix '${R.TZ1}', ${R.TZ2}', '${R.TZ3}', '${R.TZ4}' or '${R.KT1}'.`)}},ef=r=>{if(r.substring(0,3)!==R.SR1)throw new Mc(r,$(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.SR1}'.`);return Et(R.SR1)(r)},rf=r=>{if(r.substring(0,3)===R.KT1)return"01"+Et(R.KT1)(r)+"00";throw new cr(r,$(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.KT1}'.`)},nf=r=>{switch(r.consume(1)[0]){case 0:return At(R.EDPK)(r);case 1:return At(R.SPPK)(r);case 2:return At(R.P2PK)(r);default:throw new la(r.toString(),$(T.NO_PREFIX_MATCHED))}},sf=r=>{if(r.substring(0,4)===R.SRC1)return Et(R.SRC1)(r);throw new Dc(r,$(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.SRC1}'`)},of=r=>{switch(r.consume(1)[0]){case 0:return cs(r);case 1:{const e=At(R.KT1)(r);return r.consume(1),e}default:throw new z(r.toString(),": Unable to decode.")}},af=r=>{const t=At(R.SR1)(r);if(t.substring(0,3)!==R.SR1)throw new Mc(t,$(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.SR1}'.`);return t},cf=r=>{if(r.consume(1)[0]===1){const e=At(R.KT1)(r);return r.consume(1),e}throw new cr(r.toString(),$(T.NO_PREFIX_MATCHED))},uf=r=>{const t=At(R.SRC1)(r);if(t.substring(0,4)!==R.SRC1)throw new Dc(t,$(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.SRC1}'`);return t},ls=r=>{const t=[];let e=new I(r,10);if(e.isNaN())throw new TypeError(`Invalid zarith number ${r}`);for(;;)if(e.lt(128)){e.lt(16)&&t.push("0"),t.push(e.toString(16));break}else{let n=e.mod(128);e=e.minus(n),e=e.dividedBy(128),n=n.plus(128),t.push(n.toString(16))}return t.join("")},hs=r=>{let t=0;for(;t<r.length()&&r.get(t)&128;)t+=1;let e=new I(0);for(let n=t;n>=0;n-=1){const i=r.get(n)&127;e=e.multipliedBy(128),e=e.plus(i)}return r.consume(t+1),new I(e).toString()},lf=r=>{const t=rt(r.consume(1)[0],2);if(t in Pn)return Pn[t];{const e=$t(r,1),n=Buffer.from(e).toString("utf8");if(n.length>as)throw new xc(n);return n}},hf=r=>{if(r.consume(1)[0]!==0){const e=lf(r),n=$t(r),i=Qe(new Ft(n));return{entrypoint:e,value:i}}},df=r=>{if(r in qo)return`${qo[r]}`;if(r.length>as)throw new xc(r);return`ff${Xe({string:r}).slice(8)}`},pf=r=>{if(!r||r.entrypoint==="default"&&"prim"in r.value&&r.value.prim==="Unit")return"00";const t=df(r.entrypoint),e=Xe(r.value),n=(e.length/2).toString(16).padStart(8,"0");return`ff${t}${n}${e}`},ff=r=>{const t=Xe(r);return`${rt(t.length/2)}${t}`},gf=r=>{const t=$t(r);return Qe(new Ft(t))},mf=Et(R.VH),yf=At(R.VH),vf=r=>`${Xe({string:r}).slice(2)}`,Ef=r=>{const t=$t(r);return Buffer.from(t).toString("utf8")},bf=r=>"",_f=r=>({}),wf=Et(R.TXR1),Af=At(R.TXR1),Sf=r=>`${rt(r.length/2)}${r}`,Rf=r=>{const t=$t(r);return Buffer.from(t).toString("hex")},Of=r=>r?`ff${ls(r)}`:"00",Pf=r=>{const t=r.consume(1);if(Buffer.from(t).toString("hex")!=="00")return hs(r)},Tf=r=>r?`ff${ls(r)}`:"00",If=r=>{const t=r.consume(1);if(Buffer.from(t).toString("hex")!=="00")return hs(r)},Nf=(r,t=8)=>`${rt(r.length/2,t)}${r}`,Lf=r=>{const t=$t(r);return Buffer.from(t).toString("hex")},xf=r=>{const t=r.reduce((e,n)=>e+`${rt(n.length/2)}${n}`,"");return`${rt(t.length/2)}${t}`},Cf=r=>{const t=$t(r);return Sp(new Ft(t)).map(n=>Buffer.from(n).toString("hex"))},$c={branch:p.BRANCH,contents:[p.OPERATION]},ds={pkh:p.TZ1,secret:p.SECRET},ps={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,public_key:p.PUBLIC_KEY},fs={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,delegate:p.DELEGATE},gs={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,amount:p.ZARITH,destination:p.ADDRESS,parameters:p.PARAMETERS},ms={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,balance:p.ZARITH,delegate:p.DELEGATE,script:p.SCRIPT},ys={source:p.PKH,period:p.INT32,proposal:p.PROPOSAL,ballot:p.BALLOT_STATEMENT},vs={slot:p.INT16,level:p.INT32,round:p.INT32,block_payload_hash:p.BLOCK_PAYLOAD_HASH},Es={level:p.INT32,nonce:p.RAW},bs={source:p.PKH,period:p.INT32,proposals:p.PROPOSAL_ARR},_s={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,value:p.VALUE},ws={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,ticket_contents:p.VALUE,ticket_ty:p.VALUE,ticket_ticketer:p.ADDRESS,ticket_amount:p.ZARITH,destination:p.ADDRESS,entrypoint:p.ENTRYPOINT},As={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,tx_rollup_origination:p.TX_ROLLUP_ORIGINATION_PARAM},Ss={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,rollup:p.TX_ROLLUP_ID,content:p.TX_ROLLUP_BATCH_CONTENT,burn_limit:p.BURN_LIMIT},Rs={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,amount:p.ZARITH,destination:p.SMART_CONTRACT_ADDRESS},Os={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,pk:p.PUBLIC_KEY},Ps={consensus_key:p.PKH,delegate:p.PKH,destination:p.PKH},Ts={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,limit:p.DEPOSITS_LIMIT},Is={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,pvm_kind:p.PVM_KIND,kernel:p.PADDED_BYTES,origination_proof:p.PADDED_BYTES,parameters_ty:p.VALUE},Ns={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,message:p.SMART_ROLLUP_MESSAGE},Ls={source:p.PKH,fee:p.ZARITH,counter:p.ZARITH,gas_limit:p.ZARITH,storage_limit:p.ZARITH,rollup:p.SMART_ROLLUP_ADDRESS,cemented_commitment:p.SMART_ROLLUP_COMMITMENT_HASH,output_proof:p.PADDED_BYTES},xs={arbitrary:p.PADDED_BYTES},Mf=r=>t=>{if(!(t.kind in r)||!(t.kind in Jo))throw new Ye(t.kind);return Jo[t.kind]+r[t.kind](t)},Df=r=>t=>{const e=t.consume(1),n=Ci[e[0]];if(n===void 0)throw new gp(e[0].toString());const i=r[n](t);if(typeof i!="object")throw new Cc("Invalid operation, cannot be decoded.");return Object.assign({kind:n},i)},it=r=>t=>e=>Object.keys(t).reduce((i,s)=>{const o=t[s];if(e&&Array.isArray(o)){const a=r[o[0]],c=e[s];if(!Array.isArray(c))throw new fp(`Invalid operation value "${JSON.stringify(c)}" of key "${s}, expected value to be Array.`);return i+c.reduce((u,l)=>u+a(l),"")}else{const a=r[o];return i+a(e[s])}},""),st=r=>t=>e=>Object.keys(t).reduce((i,s)=>{const o=t[s];if(Array.isArray(o)){const a=r[o[0]],c=[],u=e.length();for(;e.length()>0;)if(c.push(a(e)),u===e.length())throw new Cc("Unable to decode value");return Object.assign(Object.assign({},i),{[s]:c})}else{const a=r[o],c=a(e);return typeof c<"u"?Object.assign(Object.assign({},i),{[s]:c}):Object.assign({},i)}},{}),M={[p.SECRET]:r=>zo(r.consume(20)),[p.RAW]:r=>zo(r.consume(32)),[p.TZ1]:kp,[p.BRANCH]:Bp,[p.ZARITH]:hs,[p.PUBLIC_KEY]:nf,[p.PKH]:cs,[p.DELEGATE]:Xp,[p.INT32]:qp,[p.SCRIPT]:Ap,[p.BALLOT_STATEMENT]:Kp,[p.PROPOSAL]:Bc,[p.PROPOSAL_ARR]:jp,[p.PARAMETERS]:hf,[p.ADDRESS]:of,[p.SMART_ROLLUP_ADDRESS]:af,[p.SMART_CONTRACT_ADDRESS]:cf,[p.SMART_ROLLUP_COMMITMENT_HASH]:uf,[p.VALUE]:gf,[p.INT16]:Zp,[p.BLOCK_PAYLOAD_HASH]:yf,[p.ENTRYPOINT]:Ef,[p.TX_ROLLUP_ORIGINATION_PARAM]:_f,[p.TX_ROLLUP_ID]:Af,[p.TX_ROLLUP_BATCH_CONTENT]:Rf,[p.BURN_LIMIT]:Pf,[p.DEPOSITS_LIMIT]:If,[p.PVM_KIND]:Fp,[p.PADDED_BYTES]:Lf,[p.SMART_ROLLUP_MESSAGE]:Cf};M[p.OPERATION]=Df(M);M[p.OP_ACTIVATE_ACCOUNT]=r=>st(M)(ds)(r);M[p.OP_FAILING_NOOP]=r=>st(M)(xs)(r);M[p.OP_DELEGATION]=r=>st(M)(fs)(r);M[p.OP_TRANSACTION]=r=>st(M)(gs)(r);M[p.OP_ORIGINATION]=r=>st(M)(ms)(r);M[p.OP_BALLOT]=r=>st(M)(ys)(r);M[p.OP_ENDORSEMENT]=r=>st(M)(vs)(r);M[p.OP_SEED_NONCE_REVELATION]=r=>st(M)(Es)(r);M[p.OP_PROPOSALS]=r=>st(M)(bs)(r);M[p.OP_REVEAL]=r=>st(M)(ps)(r);M[p.OP_REGISTER_GLOBAL_CONSTANT]=r=>st(M)(_s)(r);M[p.OP_TRANSFER_TICKET]=r=>st(M)(ws)(r);M[p.OP_TX_ROLLUP_ORIGINATION]=r=>st(M)(As)(r);M[p.OP_TX_ROLLUP_SUBMIT_BATCH]=r=>st(M)(Ss)(r);M[p.OP_INCREASE_PAID_STORAGE]=r=>st(M)(Rs)(r);M[p.OP_UPDATE_CONSENSUS_KEY]=r=>st(M)(Os)(r);M[p.OP_DRAIN_DELEGATE]=r=>st(M)(Ps)(r);M[p.OP_SMART_ROLLUP_ORIGINATE]=r=>st(M)(Is)(r);M[p.OP_SMART_ROLLUP_ADD_MESSAGES]=r=>st(M)(Ns)(r);M[p.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=r=>st(M)(Ls)(r);M[p.MANAGER]=st(M)($c);M[p.OP_SET_DEPOSITS_LIMIT]=r=>st(M)(Ts)(r);const D={[p.SECRET]:r=>r,[p.RAW]:r=>r,[p.TZ1]:Hp,[p.BRANCH]:$p,[p.ZARITH]:ls,[p.PUBLIC_KEY]:Qp,[p.PKH]:us,[p.DELEGATE]:zp,[p.SCRIPT]:wp,[p.BALLOT_STATEMENT]:Gp,[p.PROPOSAL]:kc,[p.PROPOSAL_ARR]:Up,[p.INT32]:Jp,[p.PARAMETERS]:pf,[p.ADDRESS]:tf,[p.SMART_ROLLUP_ADDRESS]:ef,[p.SMART_CONTRACT_ADDRESS]:rf,[p.SMART_ROLLUP_COMMITMENT_HASH]:sf,[p.VALUE]:ff,[p.INT16]:Wp,[p.BLOCK_PAYLOAD_HASH]:mf,[p.ENTRYPOINT]:vf,[p.TX_ROLLUP_ORIGINATION_PARAM]:bf,[p.TX_ROLLUP_ID]:wf,[p.TX_ROLLUP_BATCH_CONTENT]:Sf,[p.BURN_LIMIT]:Of,[p.DEPOSITS_LIMIT]:Tf,[p.PVM_KIND]:Vp,[p.PADDED_BYTES]:Nf,[p.SMART_ROLLUP_MESSAGE]:xf};D[p.OPERATION]=Mf(D);D[p.OP_ACTIVATE_ACCOUNT]=r=>it(D)(ds)(r);D[p.OP_DELEGATION]=r=>it(D)(fs)(r);D[p.OP_TRANSACTION]=r=>it(D)(gs)(r);D[p.OP_ORIGINATION]=r=>it(D)(ms)(r);D[p.OP_BALLOT]=r=>it(D)(ys)(r);D[p.OP_ENDORSEMENT]=r=>it(D)(vs)(r);D[p.OP_SEED_NONCE_REVELATION]=r=>it(D)(Es)(r);D[p.OP_PROPOSALS]=r=>it(D)(bs)(r);D[p.OP_REVEAL]=r=>it(D)(ps)(r);D[p.OP_REGISTER_GLOBAL_CONSTANT]=r=>it(D)(_s)(r);D[p.OP_TRANSFER_TICKET]=r=>it(D)(ws)(r);D[p.OP_TX_ROLLUP_ORIGINATION]=r=>it(D)(As)(r);D[p.OP_TX_ROLLUP_SUBMIT_BATCH]=r=>it(D)(Ss)(r);D[p.OP_INCREASE_PAID_STORAGE]=r=>it(D)(Rs)(r);D[p.OP_UPDATE_CONSENSUS_KEY]=r=>it(D)(Os)(r);D[p.OP_DRAIN_DELEGATE]=r=>it(D)(Ps)(r);D[p.OP_SMART_ROLLUP_ORIGINATE]=r=>it(D)(Is)(r);D[p.OP_SMART_ROLLUP_ADD_MESSAGES]=r=>it(D)(Ns)(r);D[p.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=r=>it(D)(Ls)(r);D[p.MANAGER]=it(D)($c);D[p.OP_SET_DEPOSITS_LIMIT]=r=>it(D)(Ts)(r);D[p.OP_FAILING_NOOP]=r=>it(D)(xs)(r);const Hc={activate_account:ds,reveal:ps,delegation:fs,transaction:gs,origination:ms,ballot:ys,endorsement:vs,seed_nonce_revelation:Es,proposals:bs,register_global_constant:_s,transfer_ticket:ws,tx_rollup_origination:As,tx_rollup_submit_batch:Ss,increase_paid_storage:Rs,update_consensus_key:Os,drain_delegate:Ps,set_deposits_limit:Ts,smart_rollup_originate:Is,smart_rollup_add_messages:Ns,smart_rollup_execute_outbox_message:Ls,failing_noop:xs},kf=(r,t)=>t.filter(e=>!r.includes(e)),Bf=(r,t)=>r.filter(e=>e!==t),$f=r=>Object.keys(Hc).includes(r),Hf=r=>{const t=r.kind,e=Object.keys(r),n=Bf(e,"kind"),i=Object.keys(Hc[t]);return kf(n,i)};var Mi;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(Mi||(Mi={}));const jf=Mi.PtMumbai2;function Uf(r,t){return{encoder:D[r],decoder:e=>{const n=Ft.fromHexString(e);return M[r](n)}}}class jc{constructor(t=jf){this.protocolHash=t,this.codec=Uf(p.MANAGER,this.protocolHash)}forge(t){const e=fu(t.branch);if(e!==T.VALID)throw new gu(t.branch,$(e));for(const i of t.contents){if(!$f(i.kind))throw new Ye(i.kind);const s=Hf(i);if(s.length===1){if(i.kind==="delegation"&&s[0]==="delegate")continue;if(i.kind==="origination"&&s[0]==="delegate")continue;if(i.kind==="transaction"&&s[0]==="parameters")continue;if(i.kind==="set_deposits_limit"&&s[0]==="limit")continue;if(i.kind==="tx_rollup_submit_batch"&&s[0]==="burn_limit")continue;throw new Wo(i,`missing properties "${s.join(", ")}"`)}else if(s.length>1)throw new Wo(i,`missing properties "${s.join(", ")}"`)}const n=this.codec.encoder(t).toLowerCase();return Promise.resolve(n)}parse(t){return Promise.resolve(this.codec.decoder(t))}}const dm=new jc;function yt(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(e[n[i]]=r[n[i]]);return e}function f(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(d){o(d)}}function c(l){try{u(n.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(r,t||[])).next())})}function en(r,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(r):n?n.value:t.get(r)}function pt(r,t,e,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!i:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,e):i?i.value=e:t.set(r,e),e}function Gf(r,t){const e=JSON.parse(r.body);if(e[0]&&e[0].kind&&e[0].msg){const n=JSON.stringify({kind:e[0].kind,id:e[0].id,msg:e[0].msg.replace(t,"")});return new Lr(`Http error response: (${r.status}) ${n}`,r.status,r.statusText,n,r.url)}else return r}class Uc{constructor(t){this.context=t}inject(t){return f(this,void 0,void 0,function*(){let e;try{e=yield this.context.rpc.injectOperation(t)}catch(n){const i=". You may want to use --replace to provide adequate fee and replace it";throw n instanceof Lr&&n.message.includes(i)?Gf(n,i):n}return e})}}class rn extends Vi{constructor(){super(),this.name="UnconfiguredSignerError",this.message="No signer has been configured. Please configure one by calling setProvider({signer}) on your TezosToolkit instance."}}class Di{publicKey(){return f(this,void 0,void 0,function*(){throw new rn})}publicKeyHash(){return f(this,void 0,void 0,function*(){throw new rn})}secretKey(){return f(this,void 0,void 0,function*(){throw new rn})}sign(t,e){return f(this,void 0,void 0,function*(){throw new rn})}}function Gc(r){return new et(t=>(r.on("data",e=>{t.next(e)}),r.on("error",e=>{t.error(e)}),r.on("close",()=>{t.complete()}),()=>{r.close()}))}var ue;(function(r){r[r.DELEGATION=10600]="DELEGATION",r[r.ORIGINATION=10600]="ORIGINATION",r[r.TRANSFER=10600]="TRANSFER",r[r.REVEAL_TZ1=1e3]="REVEAL_TZ1",r[r.REVEAL_TZ2=1e3]="REVEAL_TZ2",r[r.REVEAL_TZ3=2e3]="REVEAL_TZ3",r[r.REVEAL_TZ4=2e3]="REVEAL_TZ4"})(ue||(ue={}));var ke;(function(r){r[r.DELEGATION=1257]="DELEGATION",r[r.ORIGINATION=1e4]="ORIGINATION",r[r.TRANSFER=1e4]="TRANSFER",r[r.REVEAL=374]="REVEAL"})(ke||(ke={}));var Be;(function(r){r[r.DELEGATION=0]="DELEGATION",r[r.ORIGINATION=257]="ORIGINATION",r[r.TRANSFER=257]="TRANSFER",r[r.REVEAL=0]="REVEAL"})(Be||(Be={}));const Kf=250;var at;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(at||(at={}));at.Pt24m4xi,at.PsBABY5H,at.PsBabyM1,at.PsCARTHA,at.PsDELPH1,at.PtEdo2Zk,at.PsFLorena,at.PtGRANADs,at.PtHangz2,at.PsiThaCa,at.Psithaca2,at.PtJakart2,at.PtKathman,at.PtLimaPtL,at.PtMumbai2,at.PtNairobi,at.ProtoALpha;var Xo;(function(r){r.MAINNET="NetXdQprcVkpaWU",r.CARTHAGENET="NetXjD3HPJJjmcd",r.DELPHINET="NetXm8tYqnMWky1",r.EDONET="NetXSgo1ZT2DRUG",r.FLORENCENET="NetXxkAx4woPLyu",r.GRANADANET="NetXz969SFaFn8k",r.HANGZHOUNET="NetXZSsxBpMQeAT",r.ITHACANET="NetXbhmtAbMukLc",r.ITHACANET2="NetXnHfVqm9iesp",r.JAKARTANET2="NetXLH1uAxK7CCh",r.KATHMANDUNET="NetXazhm4yetmff",r.LIMANET="NetXizpkH94bocH",r.MUMBAINET="NetXQw6nWSnrJ5t",r.MUMBAINET2="NetXgbcrNtXD2yA",r.NAIROBINET="NetXyuzvDo2Ugzb"})(Xo||(Xo={}));const ki=r=>Math.round(Vf(r)*11/10),Vf=r=>{switch(r.substring(0,3)){case"tz1":return ue.REVEAL_TZ1;case"tz2":return ue.REVEAL_TZ2;case"tz3":return ue.REVEAL_TZ3;case"tz4":return ue.REVEAL_TZ4;default:throw new Error(`Cannot estimate reveal gas limit for ${r}`)}};class Kc extends W{constructor(t,e,n){super(),this.smartContractMethodName=t,this.sigs=e,this.invalidParams=n,this.name="InvalidParameterError",this.message=`${t} Received ${n.length} arguments while expecting one of the following signatures (${JSON.stringify(e)})`}}class Ff extends W{constructor(t){super(),this.source=t,this.name="InvalidDelegationSource",this.message=`Since Babylon delegation source can no longer be a contract address ${t}. Please use the smart contract abstraction to set your delegate.`}}class Tn extends W{constructor(t,e){super(),this.message=t,this.data=e,this.name="InvalidCodeParameter"}}class Vc extends W{constructor(t,e){super(),this.message=t,this.data=e,this.name="InvalidInitParameter"}}class zf extends Ln{constructor(t,e,n,i){super(),this.message=t,this.viewName=e,this.failWith=n,this.cause=i,this.name="ViewSimulationError"}}const Jf=r=>{if(qf(r.body)){const t=JSON.parse(r.body);if(Array.isArray(t)&&"with"in t[t.length-1])return t[t.length-1].with}},qf=r=>{try{JSON.parse(r)}catch{return!1}return!0};class Qo extends W{constructor(t){super(),this.info=t,this.name="InvalidViewSimulationContext",this.message=`${t} Please configure the context of the view execution in the executeView method.`}}class Wf extends Ln{constructor(t){super(),this.message=t,this.name="RevealOperationError"}}class Zf extends W{constructor(t){super(),this.message=t,this.name}}class Yf extends W{constructor(t){super(),this.message=t,this.name="InvalidBalanceError"}}const Xf=({pkh:r,secret:t})=>f(void 0,void 0,void 0,function*(){return{kind:E.ACTIVATION,pkh:r,secret:t}}),Cs=({code:r,init:t,balance:e="0",delegate:n,storage:i,fee:s=ke.ORIGINATION,gasLimit:o=ue.ORIGINATION,storageLimit:a=Be.ORIGINATION,mutez:c=!1})=>f(void 0,void 0,void 0,function*(){if(i!==void 0&&t!==void 0)throw new Zf("Storage and Init cannot be set a the same time. Please either use storage or init but not both.");if(!Array.isArray(r))throw new Tn("Wrong code parameter type, expected an array",r);let u;if(i!==void 0){const m=r.find(b=>"prim"in b&&b.prim==="storage");if((m==null?void 0:m.args)===void 0)throw new Tn("The storage section is missing from the script",r);u=new kt(m.args[0]).Encode(i)}else if(t!==void 0&&typeof t=="object")u=t;else throw new Vc("Wrong init parameter type, expected JSON Michelson",t);const l={code:r,storage:u};if(isNaN(Number(e)))throw new Yf(`Invalid Balance "${e}", cannot be converted to a number`);const d={kind:E.ORIGINATION,fee:s,gas_limit:o,storage_limit:a,balance:c?e.toString():Ki("tz","mutez",e).toString(),script:l};return n&&(d.delegate=n),d}),Ms=({to:r,amount:t,parameter:e,fee:n=ke.TRANSFER,gasLimit:i=ue.TRANSFER,storageLimit:s=Be.TRANSFER,mutez:o=!1})=>f(void 0,void 0,void 0,function*(){return{kind:E.TRANSACTION,fee:n,gas_limit:i,storage_limit:s,amount:o?t.toString():Ki("tz","mutez",t).toString(),destination:r,parameters:e}}),Ds=({delegate:r,source:t,fee:e=ke.DELEGATION,gasLimit:n=ue.DELEGATION,storageLimit:i=Be.DELEGATION})=>f(void 0,void 0,void 0,function*(){return{kind:E.DELEGATION,source:t,fee:e,gas_limit:n,storage_limit:i,delegate:r}}),Qf=({fee:r=ke.DELEGATION,gasLimit:t=ue.DELEGATION,storageLimit:e=Be.DELEGATION},n)=>f(void 0,void 0,void 0,function*(){return{kind:E.DELEGATION,fee:r,gas_limit:t,storage_limit:e,delegate:n}}),vi=({fee:r=ke.REVEAL,gasLimit:t=void 0,storageLimit:e=Be.REVEAL},n,i)=>f(void 0,void 0,void 0,function*(){return{kind:E.REVEAL,fee:r,public_key:i,source:n,gas_limit:t??ki(n),storage_limit:e}}),ks=({value:r,source:t,fee:e,gasLimit:n,storageLimit:i})=>f(void 0,void 0,void 0,function*(){return{kind:E.REGISTER_GLOBAL_CONSTANT,value:r,fee:e,gas_limit:n,storage_limit:i,source:t}}),Bs=({ticketContents:r,ticketTy:t,ticketTicketer:e,ticketAmount:n,destination:i,entrypoint:s,source:o,fee:a,gasLimit:c,storageLimit:u})=>f(void 0,void 0,void 0,function*(){return{kind:E.TRANSFER_TICKET,fee:a,gas_limit:c,storage_limit:u,source:o,ticket_contents:r,ticket_ty:t,ticket_ticketer:e,ticket_amount:n,destination:i,entrypoint:s}}),$s=({source:r,fee:t,gasLimit:e,storageLimit:n,amount:i,destination:s})=>f(void 0,void 0,void 0,function*(){return{kind:E.INCREASE_PAID_STORAGE,source:r,fee:t,gas_limit:e,storage_limit:n,amount:i,destination:s}}),tg=({consensus_key:r,delegate:t,destination:e})=>f(void 0,void 0,void 0,function*(){return{kind:E.DRAIN_DELEGATE,consensus_key:r,delegate:t,destination:e}}),eg=({source:r,proposal:t,ballot:e})=>f(void 0,void 0,void 0,function*(){return{kind:E.BALLOT,source:r,proposal:t,ballot:e}}),rg=({source:r,proposals:t})=>f(void 0,void 0,void 0,function*(){return{kind:E.PROPOSALS,source:r,proposals:t}}),ng=({source:r,fee:t,gasLimit:e,storageLimit:n,pk:i})=>f(void 0,void 0,void 0,function*(){return{kind:E.UPDATE_CONSENSUS_KEY,source:r,fee:t,gas_limit:e,storage_limit:n,pk:i}}),Hs=({source:r,fee:t,gasLimit:e,storageLimit:n,message:i})=>f(void 0,void 0,void 0,function*(){return{kind:E.SMART_ROLLUP_ADD_MESSAGES,source:r,fee:t,gas_limit:e,storage_limit:n,message:i}}),js=({source:r,fee:t,gasLimit:e,storageLimit:n,pvmKind:i,kernel:s,originationProof:o,parametersType:a})=>f(void 0,void 0,void 0,function*(){return{kind:E.SMART_ROLLUP_ORIGINATE,source:r,fee:t,gas_limit:e,storage_limit:n,pvm_kind:i,kernel:s,origination_proof:o,parameters_ty:a}}),nn=(r,t)=>Object.assign(Object.assign({},r),{kind:t}),ta=(r,t)=>{if(Array.isArray(r)){const e=r.find(n=>n.kind===t);if(e&&ig(e,t))return e}},ig=(r,t)=>r.kind===t,Bi=r=>["transaction","delegation","origination","reveal","register_global_constant","increase_paid_storage","tx_rollup_origination","tx_rollup_submit_batch","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate"].indexOf(r.kind)!==-1,Fc=r=>["transaction","delegation","origination","register_global_constant","increase_paid_storage","tx_rollup_origination","tx_rollup_submit_batch","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate"].indexOf(r.kind)!==-1,Us=r=>"metadata"in r,Cr=r=>Us(r)&&"operation_result"in r.metadata,sg=r=>Us(r)&&"internal_operation_results"in r.metadata,og=r=>"with"in r;class zc extends Ln{constructor(t,e){super(),this.errors=t,this.errorDetails=e,this.name="TezosOperationError";const n=t[t.length-1];this.id=n.id,this.kind=n.kind,this.message=`(${this.kind}) ${this.id}`,og(n)&&(n.with.string?this.message=n.with.string:n.with.int?this.message=n.with.int:this.message=JSON.stringify(n.with))}}class ag extends Error{constructor(t){super(),this.result=t,this.name="TezosPreapplyFailureError",this.message="Preapply returned an unexpected result"}}const de=r=>{const t=Array.isArray(r)?r:[r],e=[];for(let n=0;n<t.length;n++)for(let i=0;i<t[n].contents.length;i++){const s=t[n].contents[i];Cr(s)&&"fee"in s&&(e.push(Object.assign({fee:s.fee},s.metadata.operation_result)),Array.isArray(s.metadata.internal_operation_results)&&s.metadata.internal_operation_results.forEach(o=>e.push(o.result)))}return e},Nr=(r,t="failed")=>{const e=Array.isArray(r)?r:[r];let n=[];for(let i=0;i<e.length;i++)for(let s=0;s<e[i].contents.length;s++){const o=e[i].contents[s];if(Us(o)&&(Cr(o)&&o.metadata.operation_result.status===t&&(n=n.concat(o.metadata.operation_result.errors||[])),sg(o)&&Array.isArray(o.metadata.internal_operation_results)))for(const a of o.metadata.internal_operation_results)"result"in a&&a.result.status===t&&(n=n.concat(a.result.errors||[]))}return n};class cg extends Z{constructor(t){super(),this.message=t,this.name="OriginationOperationError"}}class Ei extends W{constructor(t){super(),this.message=t,this.name="InvalidEstimateValueError"}}class Jc extends W{constructor(t){super(),this.invalidConfirmations=t,this.name="InvalidConfirmationCountError",this.message=`Invalid confirmation count ${t} expecting at least 1`}}class qc extends Nn{constructor(t){super(),this.message=t,this.name="ConfirmationTimeoutError"}}class sn extends Ln{constructor(t,e){super(),this.message=t,this.cause=e,this.name="RPCResponseError"}}class Rt{constructor(t,e,n,i){if(this.hash=t,this.raw=e,this.results=n,this.context=i,this._pollingConfig$=new or(1),this.currentHead$=this._pollingConfig$.pipe(Le(s=>new Bn(s).pipe(ec({each:s.timeout*1e3,with:()=>Xa(()=>new qc("Confirmation polling timed out"))}))),Le(()=>rc(()=>Gc(this.context.stream.subscribeBlock("head"))).pipe(Le(s=>{var o,a;const c=(a=(o=this.lastHead)===null||o===void 0?void 0:o.header.level)!==null&&a!==void 0?a:s.header.level-1;return es(c+1,s.header.level-c-1).pipe(Jr(u=>this.context.readProvider.getBlock(u)),sc(s))}),wn(s=>this.lastHead=s))),Io({refCount:!0})),this.confirmed$=this.currentHead$.pipe(ur(s=>{for(let o=3;o>=0;o--)s.operations[o].forEach(a=>{a.hash===this.hash&&(this._foundAt=s.header.level)});if(s.header.level-this._foundAt>=0)return this._foundAt}),bn(s=>s!==void 0),Oe(),Io()),this._foundAt=Number.POSITIVE_INFINITY,da(this.hash)!==T.VALID)throw new pa(this.hash);this.confirmed$.pipe(Oe(),jn(()=>Hn(ts))).subscribe()}get includedInBlock(){return this._foundAt}get revealOperation(){return Array.isArray(this.results)&&this.results.find(t=>t.kind==="reveal")}get revealStatus(){return this.revealOperation?this.revealOperation.metadata.operation_result.status:"unknown"}get status(){return this.results.map(t=>Cr(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}confirmation(t,e){return f(this,void 0,void 0,function*(){if(typeof t<"u"&&t<1)throw new Jc(t);const{defaultConfirmationCount:n,confirmationPollingTimeoutSecond:i}=this.context.config;this._pollingConfig$.next({timeout:e||i});const s=t!==void 0?t:n;return new Promise((o,a)=>{this.confirmed$.pipe(Le(()=>this.currentHead$),bn(c=>c.header.level-this._foundAt>=s-1),Oe()).subscribe(c=>{o(this._foundAt+(s-1))},a)})})}}class ug extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}sumProp(t,e){return t.reduce((n,i)=>e in i?Number(i[e])+n:n,0)}getOriginatedContractAddresses(){const t=this.results.filter(n=>n.kind==="origination");let e=[];for(const n of t)n.metadata.operation_result.originated_contracts&&(e=[...e,...n.metadata.operation_result.originated_contracts]);return e}get status(){return this.results.filter(t=>Yc.indexOf(t.kind)!==-1).map(t=>Cr(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}get fee(){return this.sumProp(this.params,"fee")}get gasLimit(){return this.sumProp(this.params,"gas_limit")}get storageLimit(){return this.sumProp(this.params,"storage_limit")}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),new I(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(de({contents:this.results}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(de({contents:this.results}),"paid_storage_size_diff"))}get errors(){return Nr({contents:this.results})}}class qr{constructor(t){this.context=t}get rpc(){return this.context.rpc}get signer(){return this.context.signer}forge({opOb:{branch:t,contents:e,protocol:n},counter:i}){return f(this,void 0,void 0,function*(){return{opbytes:yield this.context.forger.forge({branch:t,contents:e}),opOb:{branch:t,contents:e,protocol:n},counter:i}})}estimate(t,e){var{fee:n,gasLimit:i,storageLimit:s}=t,o=yt(t,["fee","gasLimit","storageLimit"]);return f(this,void 0,void 0,function*(){let a=n,c=i,u=s;if(a&&a%1!==0)throw new Ei(`Fee value must not be a decimal: ${a}`);if(c&&c%1!==0)throw new Ei(`Gas Limit value must not be a decimal: ${c}`);if(u&&u%1!==0)throw new Ei(`Storage Limit value must not be a decimal: ${u}`);if(n===void 0||i===void 0||s===void 0){const l=yield e(Object.assign({fee:n,gasLimit:i,storageLimit:s},o));a??(a=l.suggestedFeeMutez),c??(c=l.gasLimit),u??(u=l.storageLimit)}return{fee:a,gasLimit:c,storageLimit:u}})}getRPCOp(t){return f(this,void 0,void 0,function*(){switch(t.kind){case E.TRANSACTION:return Ms(Object.assign({},t));case E.ORIGINATION:return Cs(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case E.DELEGATION:return Ds(Object.assign({},t));case E.REGISTER_GLOBAL_CONSTANT:return ks(Object.assign({},t));case E.INCREASE_PAID_STORAGE:return $s(Object.assign({},t));case E.TRANSFER_TICKET:return Bs(Object.assign({},t));case E.SMART_ROLLUP_ADD_MESSAGES:return Hs(Object.assign({},t));case E.SMART_ROLLUP_ORIGINATE:return js(Object.assign({},t));default:throw new Ye(t.kind)}})}runOperation(t){return f(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.runOperation(t),op:t,context:this.context.clone()}})}simulate(t){return f(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.simulateOperation(t),op:t,context:this.context.clone()}})}isRevealOpNeeded(t,e){return f(this,void 0,void 0,function*(){return!(!(yield this.isAccountRevealRequired(e))||!this.isRevealRequiredForOpType(t))})}isAccountRevealRequired(t){return f(this,void 0,void 0,function*(){return!(yield this.context.readProvider.isAccountRevealed(t,"head"))})}isRevealRequiredForOpType(t){let e=!1;for(const n of t)Fc(n)&&(e=!0);return e}signAndInject(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.sign(t.opbytes,new Uint8Array([3]));t.opbytes=e.sbytes,t.opOb.signature=e.prefixSig;const n=[],i=yield this.rpc.preapplyOperations([t.opOb]);if(!Array.isArray(i))throw new ag(i);for(let o=0;o<i.length;o++)for(let a=0;a<i[o].contents.length;a++)n.push(i[o].contents[a]);const s=Nr(i);if(s.length)throw new zc(s,"Error occurred during validation simulation of operation");return{hash:yield this.context.injector.inject(t.opbytes),forgedBytes:t,opResponse:n,context:this.context.clone()}})}}class lg{constructor(t,e){this.walletProvider=t,this.context=e,this.operations=[]}withTransfer(t){const e=V(t.to);if(e!==T.VALID)throw new z(t.to,$(e));return this.operations.push(Object.assign({kind:E.TRANSACTION},t)),this}withContractCall(t,e={}){return this.withTransfer(t.toTransferParams(e))}withDelegation(t){var e;const n=V((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&n!==T.VALID)throw new z(t.delegate,$(n));return this.operations.push(Object.assign({kind:E.DELEGATION},t)),this}withOrigination(t){return this.operations.push(Object.assign({kind:E.ORIGINATION},t)),this}withIncreasePaidStorage(t){const e=V(t.destination);if(e!==T.VALID)throw new z(t.destination,$(e));return this.operations.push(Object.assign({kind:E.INCREASE_PAID_STORAGE},t)),this}mapOperation(t){return f(this,void 0,void 0,function*(){switch(t.kind){case E.TRANSACTION:return this.walletProvider.mapTransferParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t}));case E.ORIGINATION:return this.walletProvider.mapOriginateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return this.context.parser.prepareCodeOrigination(Object.assign({},t))}));case E.DELEGATION:return this.walletProvider.mapDelegateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t}));case E.INCREASE_PAID_STORAGE:return this.walletProvider.mapIncreasePaidStorageWalletParams(()=>f(this,void 0,void 0,function*(){return t}));default:throw new Ye(JSON.stringify(t.kind))}})}with(t){for(const e of t)switch(e.kind){case E.TRANSACTION:this.withTransfer(e);break;case E.ORIGINATION:this.withOrigination(e);break;case E.DELEGATION:this.withDelegation(e);break;case E.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;default:throw new Ye(JSON.stringify(e.kind))}return this}send(){return f(this,void 0,void 0,function*(){const t=[];for(const n of this.operations)t.push(yield this.mapOperation(n));const e=yield this.walletProvider.sendOperations(t);return this.context.operationFactory.createBatchOperation(e)})}}class Kn{constructor(t){this.context=t,this.walletCommand=e=>({send:e})}get walletProvider(){return this.context.walletProvider}pkh({forceRefetch:t}={}){return f(this,void 0,void 0,function*(){return(!this._pkh||t)&&(this._pkh=yield this.walletProvider.getPKH()),this._pkh})}originate(t){return this.walletCommand(()=>f(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapOriginateParamsToWalletParams(()=>this.context.parser.prepareCodeOrigination(Object.assign({},t))),n=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createOriginationOperation(n)}))}setDelegate(t){var e;const n=V((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&n!==T.VALID)throw new z(t.delegate,$(n));return this.walletCommand(()=>f(this,void 0,void 0,function*(){const i=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t})),s=yield this.walletProvider.sendOperations([i]);return this.context.operationFactory.createDelegationOperation(s)}))}signFailingNoop(t){return f(this,void 0,void 0,function*(){const e={kind:E.FAILING_NOOP,arbitrary:t.arbitrary},n=yield this.context.readProvider.getBlockHash(t.basedOnBlock),i=yield this.context.forger.forge({branch:n,contents:[e]});return{signature:yield this.walletProvider.sign(i,Uint8Array.from([3])),bytes:i,signedContent:{branch:n,contents:[{kind:E.FAILING_NOOP,arbitrary:t.arbitrary}]}}})}registerDelegate(){return this.walletCommand(()=>f(this,void 0,void 0,function*(){const t=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return{delegate:yield this.pkh()}})),e=yield this.walletProvider.sendOperations([t]);return this.context.operationFactory.createDelegationOperation(e)}))}transfer(t){const e=V(t.to);if(e!==T.VALID)throw new z(t.to,$(e));return this.walletCommand(()=>f(this,void 0,void 0,function*(){const n=yield this.walletProvider.mapTransferParamsToWalletParams(()=>f(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([n]);return this.context.operationFactory.createTransactionOperation(i)}))}increasePaidStorage(t){const e=V(t.destination);if(e!==T.VALID)throw new z(t.destination,$(e));return this.walletCommand(()=>f(this,void 0,void 0,function*(){const n=yield this.walletProvider.mapIncreasePaidStorageWalletParams(()=>f(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([n]);return this.context.operationFactory.createIncreasePaidStorageOperation(i)}))}batch(t){const e=new lg(this.walletProvider,this.context);return Array.isArray(t)&&e.with(t),e}at(t,e=n=>n){return f(this,void 0,void 0,function*(){const n=br(t);if(n!==T.VALID)throw new cr(t,$(n));const i=this.context.withExtensions().rpc,s=this.context.withExtensions().readProvider,o=yield s.getScript(t,"head"),a=yield s.getEntrypoints(t),c=new Zc(t,o,this,this.context.contract,a,i,s);return e(c,this.context)})}getPK(){return this.walletProvider.getPK()}}const hg=(r,{ALLOCATION_BURN:t,ORIGINATION_BURN:e}={ALLOCATION_BURN:257,ORIGINATION_BURN:257})=>{I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP});const n=de({contents:r});let i=new I(0),s=new I(0),o=new I(0),a=new I(0),c=new I(0),u=new I(0);return n.forEach(l=>{o=o.plus(l.fee||0),a=a.plus(Array.isArray(l.originated_contracts)?l.originated_contracts.length*e:0),c=c.plus("allocated_destination_contract"in l?t:0),i=i.plus(l.consumed_milligas||0),u=u.plus("paid_storage_size_diff"in l&&Number(l.paid_storage_size_diff)||0)}),s=s.plus(c).plus(a).plus(u),{totalFee:o,totalMilliGas:i,totalGas:i.dividedBy(1e3),totalStorage:s,totalAllocationBurn:c,totalOriginationBurn:a,totalPaidStorageDiff:u,totalStorageBurn:new I(s.multipliedBy(Kf))}};class dg extends Vi{constructor(){super(),this.name="ConfirmationUndefinedError",this.message="Default confirmation count can not be undefined"}}class Bt extends Nn{constructor(t){super(),this.message=t,this.name="ObservableError"}}const pg=60;class Mr{constructor(t,e,n){if(this.opHash=t,this.context=e,this._newHead$=n,this._operationResult=new or(1),this._includedInBlock=new or(1),this._included=!1,this.newHead$=this._newHead$.pipe(Le(i=>{var s,o;const a=(o=(s=this.lastHead)===null||s===void 0?void 0:s.header.level)!==null&&o!==void 0?o:i.header.level-1;return es(a+1,i.header.level-a-1).pipe(Jr(c=>this.context.readProvider.getBlock(c)),sc(i))}),wn(i=>this.lastHead=i),_n({connector:()=>new or(1),resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!1})),this.confirmed$=this.newHead$.pipe(ur(i=>{for(const s of i.operations)for(const o of s)if(o.hash===this.opHash)return this._included=!0,this._includedInBlock.next(i),this._operationResult.next(o.contents),i}),bn(i=>typeof i<"u"),Oe(),_n({connector:()=>new or(1),resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!1})),da(this.opHash)!==T.VALID)throw new pa(this.opHash);this.confirmed$.pipe(Oe(),jn(()=>Hn(void 0))).subscribe()}operationResults(){return f(this,void 0,void 0,function*(){return this._operationResult.pipe(Oe()).toPromise()})}receipt(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();if(!t)throw new Bt("Unable to get operation results");return hg(t)})}getCurrentConfirmation(){return f(this,void 0,void 0,function*(){return this._included?Oo([this._includedInBlock,rr(this.context.readProvider.getBlock("head"))]).pipe(ur(([t,e])=>e.header.level-t.header.level+1),Oe()).toPromise():0})}isInCurrentBranch(t="head"){return f(this,void 0,void 0,function*(){if(!this._included)return!0;const e=yield this.context.readProvider.getBlockLevel(t),n=yield this._includedInBlock.pipe(Oe()).toPromise();if(!n)throw new Bt("Inclusion block is undefined");const i=e-n.header.level;if(i<=0)return!0;const s=Math.min(n.header.level+i,n.header.level+pg);return new Set(yield this.context.readProvider.getLiveBlocks(s)).has(n.hash)})}confirmationObservable(t){if(typeof t<"u"&&t<1)throw new Jc(t);const{defaultConfirmationCount:e}=this.context.config,n=t!==void 0?t:e;if(n===void 0)throw new dg;return Oo([this._includedInBlock,this.newHead$]).pipe(ic(([,i],[,s])=>i.hash===s.hash),ur(([i,s])=>({block:s,expectedConfirmation:n,currentConfirmation:s.header.level-i.header.level+1,completed:s.header.level-i.header.level>=n-1,isInCurrentBranch:()=>this.isInCurrentBranch(s.hash)})),xh(({completed:i})=>!i,!0))}confirmation(t){return this.confirmationObservable(t).toPromise()}}class fg extends Mr{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}revealOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();if(!t)throw new Bt("operationResult returned undefined");return t.find(e=>e.kind===E.REVEAL)})}transactionOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();if(!t)throw new Bt("operationResult returned undefined");return t.find(e=>e.kind===E.TRANSACTION)})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.transactionOperation();return t?t.metadata.operation_result.status:"unknown"})}}class gg extends Mr{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}originationOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return ta(t,E.ORIGINATION);throw new Bt("Unable to fetch operation result")})}revealOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return ta(t,E.REVEAL);throw new Bt("Unable to fetch operation result")})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.originationOperation();return t?t.metadata.operation_result.status:"unknown"})}contract(){return f(this,void 0,void 0,function*(){const t=yield this.originationOperation(),e=((t==null?void 0:t.metadata.operation_result.originated_contracts)||[])[0];return this.context.wallet.at(e)})}}class mg extends Mr{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}revealOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return t.find(e=>e.kind===E.REVEAL);throw new Bt("Unable to fetch operation result")})}delegationOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return t.find(e=>e.kind===E.DELEGATION);throw new Bt("Unable to fetch operation result")})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.delegationOperation();return t?t.metadata.operation_result.status:"unknown"})}}class Wc{constructor(t){this.context=t}getPKH(){return f(this,void 0,void 0,function*(){return this.context.signer.publicKeyHash()})}mapTransferParamsToWalletParams(t){return f(this,void 0,void 0,function*(){return nn(yield t(),E.TRANSACTION)})}mapOriginateParamsToWalletParams(t){return f(this,void 0,void 0,function*(){return nn(yield t(),E.ORIGINATION)})}mapDelegateParamsToWalletParams(t){return f(this,void 0,void 0,function*(){return nn(yield t(),E.DELEGATION)})}mapIncreasePaidStorageWalletParams(t){return f(this,void 0,void 0,function*(){return nn(yield t(),E.INCREASE_PAID_STORAGE)})}sendOperations(t){return f(this,void 0,void 0,function*(){return(yield this.context.batch.batch(t).send()).hash})}sign(t,e){return f(this,void 0,void 0,function*(){const{prefixSig:n}=yield this.context.signer.sign(t,e);return n})}getPK(){return this.context.signer.publicKey()}}class yg{constructor(t,e,n,i,s="unit",o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=n,this.name=i,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}getSignature(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}send(t={}){return this.provider instanceof Kn?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:n,source:i,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:i,gasLimit:e,storageLimit:n,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:Er,value:this.isAnonymous?this.parameterSchema.EncodeObject({[this.name]:this.args}):this.parameterSchema.EncodeObject(this.args)}}}}class vg{constructor(t,e,n,i,s,o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=n,this.name=i,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}validateArgs(t,e,n){const i=e.ExtractSignatures();if(!i.find(s=>s.length===t.length))throw new Kc(n,i,t)}get schema(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}getSignature(){if(this.isAnonymous){const t=this.parameterSchema.ExtractSignatures().find(e=>e[0]===this.name);if(t)return t.shift(),t}else{const t=this.parameterSchema.ExtractSignatures();return t.length==1?t[0]:t}}send(t={}){return this.provider instanceof Kn?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:n,source:i,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:i,gasLimit:e,storageLimit:n,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:Er,value:this.isAnonymous?this.parameterSchema.Encode(this.name,...this.args):this.parameterSchema.Encode(...this.args)}}}}class Eg{constructor(t,e,n,i,s,o="Unit"){this._rpc=t,this._readProvider=e,this._contractAddress=n,this._smartContractViewSchema=i,this._contractStorageType=s,this._args=o}getSignature(){return{parameter:this._smartContractViewSchema.extractArgsSchema(),result:this._smartContractViewSchema.extractResultSchema()}}executeView(t){return f(this,void 0,void 0,function*(){this.verifyContextExecution(t);const e=yield this._readProvider.getChainId(),n=this.transformArgsToMichelson(),i={contract:this._contractAddress,view:this._smartContractViewSchema.viewName,input:n,chain_id:e,source:t.viewCaller};return t.source&&(i.payer=t.source),this.executeViewAndDecodeResult(i)})}verifyContextExecution(t){if(t.source&&V(t.source)!==T.VALID)throw new Qo(`The source account who initialized the view execution is invalid: ${t.source}.`);if(!t.viewCaller||V(t.viewCaller)!==T.VALID)throw new Qo(`The contract which is the caller of view is invalid: ${t.viewCaller}.`)}transformArgsToMichelson(){try{return this._smartContractViewSchema.encodeViewArgs(this._args)}catch(t){throw new oa(this._smartContractViewSchema.viewName,this.getSignature(),this._args,t)}}adaptViewCodeToContext(t,e,n){const i={BALANCE:[{prim:"PUSH",args:[{prim:"mutez"},{int:n}]}],SENDER:[{prim:"PUSH",args:[{prim:"address"},{string:e}]}],SELF_ADDRESS:[{prim:"PUSH",args:[{prim:"address"},{string:this._contractAddress}]}],AMOUNT:[{prim:"PUSH",args:[{prim:"mutez"},{int:"0"}]}]};return t.forEach((s,o)=>{s.prim in i&&(t[o]=Object(i)[s.prim]),s.args&&s.args.length!==0?this.adaptViewCodeToContext(s.args,e,n):Array.isArray(s)&&this.adaptViewCodeToContext(s,e,n)}),t}executeViewAndDecodeResult(t){return f(this,void 0,void 0,function*(){let e;try{e=(yield this._rpc.runScriptView(t)).data}catch(n){const i=Jf(n);throw i?new zf(`The simulation of the on-chain view named ${this._smartContractViewSchema.viewName} failed with: ${JSON.stringify(i)}`,this._smartContractViewSchema.viewName,i,n):n}return this._smartContractViewSchema.decodeViewResult(e)})}}class bg{constructor(t,e){this.provider=t,this.contractAddress=e}createContractMethodFlatParams(t,e,n,i=!0,s=!1){return new vg(this.provider,this.contractAddress,t,e,n,i,s)}createContractMethodObjectParam(t,e,n,i=!0,s=!1){return new yg(this.provider,this.contractAddress,t,e,n,i,s)}createContractViewObjectParam(t,e,n,i,s){return new Eg(t,e,this.contractAddress,n,i,s)}}const Er="default";class _g{constructor(t,e,n,i,s,o,a){this.currentContract=t,this.name=e,this.callbackParametersSchema=n,this.parameterSchema=i,this.args=s,this.rpc=o,this.readProvider=a}read(t){return f(this,void 0,void 0,function*(){const e=ca(t??"");if(br(t??"")==T.VALID)throw new ha("Since version 12, the lambda view no longer depends on a lambda contract. The read method no longer accepts a contract address as a parameter.");if(t&&e!==T.VALID)throw new yu(t,$(e));const n=this.parameterSchema.Encode(...this.args),i=yield this.rpc.runView({contract:this.currentContract.address,entrypoint:this.name,input:n,chain_id:t||(yield this.readProvider.getChainId())});return this.callbackParametersSchema.Execute(i.data)})}}const wg=(r,t,e)=>{const n=t.ExtractSignatures();if(!n.find(i=>i.length===r.length))throw new Kc(e,n,r)},Ag=r=>{let t=!1;if("prim"in r&&r.prim==="pair"&&r.args){const e=r.args[r.args.length-1];"prim"in e&&e.prim==="contract"&&(t=!0)}return t};class Zc{constructor(t,e,n,i,s,o,a){this.address=t,this.script=e,this.storageProvider=i,this.entrypoints=s,this.rpc=o,this.readProvider=a,this.methods={},this.methodsObject={},this.views={},this.contractViews={},this.contractMethodFactory=new bg(n,t),this.schema=kt.fromRPCResponse({script:this.script}),this.parameterSchema=yr.fromRPCResponse({script:this.script}),this.viewSchema=ns.fromRPCResponse({script:this.script}),this.viewSchema.length!==0&&this._initializeOnChainViews(this,o,this.readProvider,this.viewSchema),this.eventSchema=je.fromRPCResponse({script:this.script}),this._initializeMethods(this,this.entrypoints.entrypoints,this.rpc,this.readProvider)}_initializeMethods(t,e,n,i){const s=this.parameterSchema,o=Object.keys(e);if(s.isMultipleEntryPoint)o.forEach(c=>{const u=new yr(e[c]);if(this.methods[c]=function(...l){return t.contractMethodFactory.createContractMethodFlatParams(u,c,l)},this.methodsObject[c]=function(l){return t.contractMethodFactory.createContractMethodObjectParam(u,c,l)},Ag(e[c])){const l=function(...d){const m=e[c].args[0],v=new yr(m),b=e[c].args[1].args[0],w=new yr(b);return wg(d,v,c),new _g(t,c,w,v,d,n,i)};this.views[c]=l}}),Object.keys(s.ExtractSchema()).filter(c=>Object.keys(e).indexOf(c)===-1).forEach(c=>{this.methods[c]=function(...u){return t.contractMethodFactory.createContractMethodFlatParams(s,c,u,!1,!0)},this.methodsObject[c]=function(u){return t.contractMethodFactory.createContractMethodObjectParam(s,c,u,!1,!0)}});else{const a=this.parameterSchema;this.methods[Er]=function(...c){return t.contractMethodFactory.createContractMethodFlatParams(a,Er,c,!1)},this.methodsObject[Er]=function(c){return t.contractMethodFactory.createContractMethodObjectParam(a,Er,c,!1)}}}_initializeOnChainViews(t,e,n,i){const s=this.schema.val;i.forEach(o=>{this.contractViews[o.viewName]=function(a){return t.contractMethodFactory.createContractViewObjectParam(e,n,o,s,a)}})}storage(){return this.storageProvider.getStorage(this.address,this.schema)}bigMap(t){return this.storageProvider.getBigMapKey(this.address,t,this.schema)}}class Sg{constructor(t,e){this.id=t,this.provider=e}getSaplingDiff(t){return f(this,void 0,void 0,function*(){return this.provider.getSaplingDiffByID(this.id.toString(),t)})}getId(){return this.id.toString()}}var Q;const Ot=(r,t)=>{var e,n,i;return{fee:(e=r.fee)!==null&&e!==void 0?e:t.fee,gasLimit:(n=r.gasLimit)!==null&&n!==void 0?n:t.gasLimit,storageLimit:(i=r.storageLimit)!==null&&i!==void 0?i:t.storageLimit}};class Wr extends qr{constructor(t){super(t),this.context=t,Q.set(this,void 0),pt(this,Q,{})}getBlockHash(t){return f(this,void 0,void 0,function*(){return this.context.readProvider.getBlockHash(t??"head~2")})}getProtocolHash(){return f(this,void 0,void 0,function*(){return this.context.readProvider.getNextProtocol("head")})}getHeadCounter(t){var e;return f(this,void 0,void 0,function*(){return(e=this.context.readProvider.getCounter(t,"head"))!==null&&e!==void 0?e:"0"})}adjustGasForBatchOperation(t,e,n){return I.min(e,t.div(n+1))}getAccountLimits(t,e,n){return f(this,void 0,void 0,function*(){const i=yield this.context.readProvider.getBalance(t,"head"),{hard_gas_limit_per_operation:s,hard_gas_limit_per_block:o,hard_storage_limit_per_operation:a,cost_per_byte:c}=e;return{fee:0,gasLimit:n?Math.floor(this.adjustGasForBatchOperation(o,s,n).toNumber()):s.toNumber(),storageLimit:Math.floor(I.min(i.dividedBy(c),a).toNumber())}})}getFee(t,e,n){return(!en(this,Q)[e]||en(this,Q)[e]<n)&&(en(this,Q)[e]=n),{counter:`${++en(this,Q)[e]}`,fee:typeof t.fee>"u"?"0":`${t.fee}`,gas_limit:typeof t.gas_limit>"u"?"0":`${t.gas_limit}`,storage_limit:typeof t.storage_limit>"u"?"0":`${t.storage_limit}`}}getSource(t,e,n){return{source:typeof t.source>"u"?n||e:t.source}}addRevealOperationIfNeeded(t,e){return f(this,void 0,void 0,function*(){if(Fc(t)){const n=[t],{publicKey:i,pkh:s}=yield this.getKeys();if(yield this.isAccountRevealRequired(e)){if(!i)throw new Fn(s);return n.unshift(yield vi({fee:ke.REVEAL,storageLimit:Be.REVEAL,gasLimit:ki(s)},e,i)),n}}return t})}getKeys(){return f(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{pkh:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}convertIntoArray(t){return Array.isArray(t)?[...t]:[t]}constructOpContents(t,e,n,i,s){return t.map(o=>{switch(o.kind){case E.ACTIVATION:case E.DRAIN_DELEGATE:return Object.assign({},o);case E.ORIGINATION:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{balance:typeof o.balance<"u"?`${o.balance}`:"0"}),this.getSource(o,n,i)),this.getFee(o,n,e));case E.TRANSACTION:{const a=Object.assign(Object.assign(Object.assign(Object.assign({},o),{amount:typeof o.amount<"u"?`${o.amount}`:"0"}),this.getSource(o,n,i)),this.getFee(o,n,e));if(a.source.toLowerCase().startsWith("kt1"))throw new ha(`KT1 addresses are not supported as source since ${at.PsBabyM1}`);return a}case E.REVEAL:case E.DELEGATION:case E.REGISTER_GLOBAL_CONSTANT:case E.UPDATE_CONSENSUS_KEY:case E.SMART_ROLLUP_ADD_MESSAGES:case E.SMART_ROLLUP_ORIGINATE:return Object.assign(Object.assign(Object.assign({},o),this.getSource(o,n,i)),this.getFee(o,n,e));case E.TRANSFER_TICKET:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{ticket_amount:`${o.ticket_amount}`}),this.getSource(o,n,i)),this.getFee(o,n,e));case E.INCREASE_PAID_STORAGE:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{amount:`${o.amount}`}),this.getSource(o,n,i)),this.getFee(o,n,e));case E.BALLOT:if(s===void 0)throw new sn("Failed to get the current voting period index");return Object.assign(Object.assign({},o),{period:s==null?void 0:s.voting_period.index});case E.PROPOSALS:if(s===void 0)throw new sn("Failed to get the current voting period index");return Object.assign(Object.assign({},o),{period:s==null?void 0:s.voting_period.index});default:throw new Ye(o.kind)}})}activate({pkh:t,secret:e}){return f(this,void 0,void 0,function*(){const n=yield Xf({pkh:t,secret:e}),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();pt(this,Q,{});const a=parseInt(yield this.getHeadCounter(t),10),c=this.constructOpContents(i,a,t);return{opOb:{branch:s,contents:c,protocol:o},counter:a}})}reveal({fee:t,gasLimit:e,storageLimit:n}){return f(this,void 0,void 0,function*(){const{pkh:i,publicKey:s}=yield this.getKeys();if(!s)throw new Fn(i);const o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.getAccountLimits(i,o),c=Ot({fee:t,storageLimit:n,gasLimit:e},a),u=yield vi({fee:c.fee,gasLimit:c.gasLimit,storageLimit:c.storageLimit},i,s),l=this.convertIntoArray(u),d=yield this.getBlockHash(),m=yield this.getProtocolHash();pt(this,Q,{});const v=parseInt(yield this.getHeadCounter(i),10),b=this.constructOpContents(l,v,i);return{opOb:{branch:d,contents:b,protocol:m},counter:v}})}originate(t,e){var{fee:n,storageLimit:i,gasLimit:s}=t,o=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{pkh:a}=yield this.getKeys(),c=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getAccountLimits(a,c),l=yield Cs(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},o),Ot({fee:n,storageLimit:i,gasLimit:s},u)))),d=yield this.addRevealOperationIfNeeded(l,a),m=this.convertIntoArray(d),v=yield this.getBlockHash(),b=yield this.getProtocolHash();pt(this,Q,{});const w=parseInt(yield this.getHeadCounter(a),10),O=this.constructOpContents(m,w,a,e);return{opOb:{branch:v,contents:O,protocol:b},counter:w}})}transaction(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),u=yield Ms(Object.assign(Object.assign({},s),Ot({fee:e,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),d=this.convertIntoArray(l),m=yield this.getBlockHash(),v=yield this.getProtocolHash();pt(this,Q,{});const b=parseInt(yield this.getHeadCounter(o),10),w=this.constructOpContents(d,b,o,s.source);return{opOb:{branch:m,contents:w,protocol:v},counter:b}})}delegation(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),u=yield Ds(Object.assign(Object.assign({},s),Ot({fee:e,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),d=this.convertIntoArray(l),m=yield this.getBlockHash(),v=yield this.getProtocolHash();pt(this,Q,{});const b=parseInt(yield this.getHeadCounter(o),10),w=this.constructOpContents(d,b,o,s.source);return{opOb:{branch:m,contents:w,protocol:v},counter:b}})}registerDelegate({fee:t,storageLimit:e,gasLimit:n},i){return f(this,void 0,void 0,function*(){const{pkh:s}=yield this.getKeys(),o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.getAccountLimits(s,o),c=Ot({fee:t,storageLimit:e,gasLimit:n},a),u=yield Qf({fee:c.fee,storageLimit:c.storageLimit,gasLimit:c.gasLimit},s),l=yield this.addRevealOperationIfNeeded(u,s),d=this.convertIntoArray(l),m=yield this.getBlockHash(),v=yield this.getProtocolHash();pt(this,Q,{});const b=parseInt(yield this.getHeadCounter(s),10),w=this.constructOpContents(d,b,s,i);return{opOb:{branch:m,contents:w,protocol:v},counter:b}})}registerGlobalConstant(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),u=yield ks(Object.assign(Object.assign({},s),Ot({fee:e,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),d=this.convertIntoArray(l),m=yield this.getBlockHash(),v=yield this.getProtocolHash();pt(this,Q,{});const b=parseInt(yield this.getHeadCounter(o),10),w=this.constructOpContents(d,b,o,s.source);return{opOb:{branch:m,contents:w,protocol:v},counter:b}})}updateConsensusKey(t,e){var{fee:n,storageLimit:i,gasLimit:s}=t,o=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{pkh:a}=yield this.getKeys(),c=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getAccountLimits(a,c),l=yield ng(Object.assign(Object.assign({},o),Ot({fee:n,storageLimit:i,gasLimit:s},u))),d=yield this.addRevealOperationIfNeeded(l,a),m=this.convertIntoArray(d),v=yield this.getBlockHash(),b=yield this.getProtocolHash();pt(this,Q,{});const w=parseInt(yield this.getHeadCounter(a),10),O=this.constructOpContents(m,w,a,e);return{opOb:{branch:v,contents:O,protocol:b},counter:w}})}increasePaidStorage(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),u=yield $s(Object.assign(Object.assign({},s),Ot({fee:e,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),d=this.convertIntoArray(l),m=yield this.getBlockHash(),v=yield this.getProtocolHash();pt(this,Q,{});const b=parseInt(yield this.getHeadCounter(o),10),w=this.constructOpContents(d,b,o,s.source);return{opOb:{branch:m,contents:w,protocol:v},counter:b}})}ballot(t){return f(this,void 0,void 0,function*(){const{pkh:e}=yield this.getKeys(),n=yield eg(Object.assign({},t)),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();pt(this,Q,{});const a=parseInt(yield this.getHeadCounter(e),10);let c;try{c=yield this.rpc.getCurrentPeriod()}catch{throw new sn("Failed to get the current voting period index")}const u=this.constructOpContents(i,a,e,void 0,c);return{opOb:{branch:s,contents:u,protocol:o},counter:a}})}proposals(t){return f(this,void 0,void 0,function*(){const{pkh:e}=yield this.getKeys(),n=yield rg(Object.assign({},t)),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();pt(this,Q,{});const a=parseInt(yield this.getHeadCounter(e),10);let c;try{c=yield this.rpc.getCurrentPeriod()}catch{throw new sn("Failed to get the current voting period index")}const u=this.constructOpContents(i,a,e,void 0,c);return{opOb:{branch:s,contents:u,protocol:o},counter:a}})}drainDelegate(t,e){return f(this,void 0,void 0,function*(){const{pkh:n}=yield this.getKeys(),i=yield tg(Object.assign({},t)),s=this.convertIntoArray(i),o=yield this.getBlockHash(),a=yield this.getProtocolHash();pt(this,Q,{});const c=parseInt(yield this.getHeadCounter(n),10),u=this.constructOpContents(s,c,n,e);return{opOb:{branch:o,contents:u,protocol:a},counter:c}})}transferTicket(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),u=yield Bs(Object.assign(Object.assign({},s),Ot({fee:e,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),d=this.convertIntoArray(l),m=yield this.getBlockHash(),v=yield this.getProtocolHash();pt(this,Q,{});const b=parseInt(yield this.getHeadCounter(o),10),w=this.constructOpContents(d,b,o,s.source);return{opOb:{branch:m,contents:w,protocol:v},counter:b}})}smartRollupAddMessages(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),u=yield Hs(Object.assign(Object.assign({},s),Ot({fee:e,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),d=this.convertIntoArray(l),m=yield this.getBlockHash(),v=yield this.getProtocolHash();pt(this,Q,{});const b=parseInt(yield this.getHeadCounter(o),10),w=this.constructOpContents(d,b,o,s.source);return{opOb:{branch:m,contents:w,protocol:v},counter:b}})}smartRollupOriginate(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.rpc.getOriginationProof({kind:s.pvmKind,kernel:s.kernel}),c=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getAccountLimits(o,c),l=yield js(Object.assign(Object.assign(Object.assign({},Ot({fee:e,storageLimit:n,gasLimit:i},u)),s),{originationProof:a})),d=yield this.addRevealOperationIfNeeded(l,o),m=this.convertIntoArray(d),v=yield this.getBlockHash(),b=yield this.getProtocolHash();pt(this,Q,{});const w=parseInt(yield this.getHeadCounter(o),10),O=this.constructOpContents(m,w,o,s.source);return{opOb:{branch:v,contents:O,protocol:b},counter:w}})}batch(t,e){return f(this,void 0,void 0,function*(){const{pkh:n,publicKey:i}=yield this.getKeys(),s=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getAccountLimits(n,s,t.length),a=yield this.isRevealOpNeeded(t,n),c=[];if(e)for(const v of t)if(Bi(v)){const b=e.shift(),w=Ot(v,{fee:b.suggestedFeeMutez,storageLimit:b.storageLimit,gasLimit:b.gasLimit});c.push(yield this.getRPCOp(Object.assign(Object.assign({},v),w)))}else c.push(Object.assign({},v));else for(const v of t)if(Bi(v)){const b=Ot(v,o);c.push(yield this.getRPCOp(Object.assign(Object.assign({},v),b)))}else c.push(Object.assign({},v));if(a){if(!i)throw new Fn(n);c.unshift(yield vi({fee:ke.REVEAL,storageLimit:Be.REVEAL,gasLimit:ki(n)},n,i))}const u=yield this.getBlockHash(),l=yield this.getProtocolHash();pt(this,Q,{});const d=parseInt(yield this.getHeadCounter(n),10),m=this.constructOpContents(c,d,n);return{opOb:{branch:u,contents:m,protocol:l},counter:d}})}contractCall(t){var e,n,i;return f(this,void 0,void 0,function*(){const s=yield this.getBlockHash(),o=yield this.getProtocolHash(),{pkh:a}=yield this.getKeys();pt(this,Q,{});const c=parseInt(yield this.getHeadCounter(a),10),u=t.toTransferParams(),l=yield this.context.readProvider.getProtocolConstants("head"),d=yield this.getAccountLimits(a,l),m=Ot({fee:u.fee,storageLimit:u.storageLimit,gasLimit:u.gasLimit},d),v={kind:E.TRANSACTION,fee:(e=u.fee)!==null&&e!==void 0?e:m.fee,gas_limit:(n=u.gasLimit)!==null&&n!==void 0?n:m.gasLimit,storage_limit:(i=u.storageLimit)!==null&&i!==void 0?i:m.storageLimit,amount:String(u.amount),destination:u.to,parameters:u.parameter},b=yield this.addRevealOperationIfNeeded(v,a),w=this.convertIntoArray(b),O=this.constructOpContents(w,c,a);return{opOb:{branch:s,contents:O,protocol:o},counter:c}})}toPreapply(t){return f(this,void 0,void 0,function*(){const{opOb:{contents:e,branch:n,protocol:i}}=t,s=this.toForge(t),o=yield this.context.forger.forge(s),a=yield this.context.signer.sign(o,new Uint8Array([3]));return[{contents:e,branch:n,protocol:i,signature:a.prefixSig}]})}toForge({opOb:{contents:t,branch:e}}){return{branch:e,contents:t}}}Q=new WeakMap;const Yc=[E.ACTIVATION,E.ORIGINATION,E.TRANSACTION,E.DELEGATION];class Xc extends qr{constructor(t,e){super(t),this.estimator=e,this.operations=[],this.prepare=new Wr(this.context)}withTransfer(t){const e=V(t.to);if(t.amount<0)throw new Ur(t.amount.toString());if(e!==T.VALID)throw new z(t.to,$(e));return this.operations.push(Object.assign({kind:E.TRANSACTION},t)),this}withTransferTicket(t){const e=V(t.destination);if(e!==T.VALID)throw new z(t.destination,$(e));return this.operations.push(Object.assign({kind:E.TRANSFER_TICKET},t)),this}withContractCall(t,e={}){return this.withTransfer(t.toTransferParams(e))}withDelegation(t){var e;const n=V(t.source);if(t.source&&n!==T.VALID)throw new z(t.source,$(n));const i=V((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&i!==T.VALID)throw new z(t.delegate,$(i));return this.operations.push(Object.assign({kind:E.DELEGATION},t)),this}withActivation({pkh:t,secret:e}){const n=Ui(t);if(n!==T.VALID)throw new Gi(t,$(n));return this.operations.push({kind:E.ACTIVATION,pkh:t,secret:e}),this}withOrigination(t){return this.operations.push(Object.assign({kind:E.ORIGINATION},t)),this}withRegisterGlobalConstant(t){return this.operations.push(Object.assign({kind:E.REGISTER_GLOBAL_CONSTANT},t)),this}withIncreasePaidStorage(t){return this.operations.push(Object.assign({kind:E.INCREASE_PAID_STORAGE},t)),this}withSmartRollupAddMessages(t){return this.operations.push(Object.assign({kind:E.SMART_ROLLUP_ADD_MESSAGES},t)),this}withSmartRollupOriginate(t){return this.operations.push(Object.assign({kind:E.SMART_ROLLUP_ORIGINATE},t)),this}getRPCOp(t){return f(this,void 0,void 0,function*(){switch(t.kind){case E.TRANSACTION:return Ms(Object.assign({},t));case E.ORIGINATION:return Cs(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case E.DELEGATION:return Ds(Object.assign({},t));case E.REGISTER_GLOBAL_CONSTANT:return ks(Object.assign({},t));case E.INCREASE_PAID_STORAGE:return $s(Object.assign({},t));case E.TRANSFER_TICKET:return Bs(Object.assign({},t));case E.SMART_ROLLUP_ADD_MESSAGES:return Hs(Object.assign({},t));case E.SMART_ROLLUP_ORIGINATE:return js(Object.assign({},t));default:throw new Ye(JSON.stringify(t.kind))}})}with(t){for(const e of t)switch(e.kind){case E.TRANSACTION:this.withTransfer(e);break;case E.ORIGINATION:this.withOrigination(e);break;case E.DELEGATION:this.withDelegation(e);break;case E.ACTIVATION:this.withActivation(e);break;case E.REGISTER_GLOBAL_CONSTANT:this.withRegisterGlobalConstant(e);break;case E.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;case E.TRANSFER_TICKET:this.withTransferTicket(e);break;case E.SMART_ROLLUP_ADD_MESSAGES:this.withSmartRollupAddMessages(e);break;case E.SMART_ROLLUP_ORIGINATE:this.withSmartRollupOriginate(e);break;default:throw new Ye(JSON.stringify(e.kind))}return this}send(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=t&&t.source||e,i=yield this.estimator.batch(this.operations);i.length!==this.operations.length&&i.shift();const s=yield this.prepare.batch(this.operations,i),o=yield this.forge(s),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new ug(a,s.opOb.contents,n,u,l,c)})}}class Rg{constructor(t,e){this.context=t,this.estimator=e}batch(t){const e=new Xc(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}class Og extends Mr{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e,this.getOriginatedContractAddresses=()=>f(this,void 0,void 0,function*(){const i=yield this.operationResults();if(i){const s=i.filter(a=>a.kind==="origination");let o=[];for(const a of s)a.metadata.operation_result.originated_contracts&&(o=[...o,...a.metadata.operation_result.originated_contracts]);return o}else throw new Bt("Unable to fetch operation results")})}revealOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return t.find(e=>e.kind===E.REVEAL);throw new Bt("Unable to fetch operation results")})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.operationResults();if(t)return t.filter(e=>Yc.indexOf(e.kind)!==-1).map(e=>Cr(e)?e.metadata.operation_result.status:"unknown")[0]||"unknown";throw new Bt("Unable to fetch operation results")})}}class Pg extends Mr{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}revealOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return t.find(e=>e.kind===E.REVEAL);throw new Bt("Unable to fetch operation result")})}increasePaidStorageOperation(){return f(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return t.find(e=>e.kind===E.INCREASE_PAID_STORAGE);throw new Bt("Unable to fetch operation result")})}status(){return f(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.increasePaidStorageOperation();return t?t.metadata.operation_result.status:"unknown"})}}function Tg(r){return function(e){return new Bn(null).pipe(ec({each:r,with:()=>Xa(()=>new qc("Confirmation polling timed out"))}),Vr(()=>e))}}const Ig=(r,t,e)=>r.pipe(Tg(t.config.confirmationPollingTimeoutSecond*1e3),_n({connector:()=>new or(1),resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!1}));class Ng{constructor(t){this.context=t,this.sharedHeadObs=rc(()=>Gc(this.context.stream.subscribeBlock("head")))}createNewHeadObservable(){return f(this,void 0,void 0,function*(){return Ig(this.sharedHeadObs,this.context)})}createPastBlockWalker(t,e=1){return rr(this.context.readProvider.getBlock(t)).pipe(Le(n=>e===1?Hn(n):es(n.header.level,e-1).pipe(Nh(n),Jr(i=>f(this,void 0,void 0,function*(){return this.context.readProvider.getBlock(typeof i=="number"?i:i.header.level)})))))}createHeadObservableFromConfig({blockIdentifier:t}){return f(this,void 0,void 0,function*(){const e=[];return t&&e.push(this.createPastBlockWalker(t)),e.push(yield this.createNewHeadObservable()),En(...e)})}createOperation(t,e={}){return f(this,void 0,void 0,function*(){return new Mr(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createBatchOperation(t,e={}){return f(this,void 0,void 0,function*(){return new Og(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createTransactionOperation(t,e={}){return f(this,void 0,void 0,function*(){return new fg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createDelegationOperation(t,e={}){return f(this,void 0,void 0,function*(){return new mg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createOriginationOperation(t,e={}){return f(this,void 0,void 0,function*(){return new gg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createIncreasePaidStorageOperation(t,e={}){return f(this,void 0,void 0,function*(){return new Pg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}}class Lg extends qr{constructor(t){super(t),this.prepare=new Wr(this.context)}getBalance(t){return f(this,void 0,void 0,function*(){const e=V(t);if(e!==T.VALID)throw new z(t,$(e));return this.context.readProvider.getBalance(t,"head")})}getDelegate(t){return f(this,void 0,void 0,function*(){const e=V(t);if(e!==T.VALID)throw new z(t,$(e));return this.context.readProvider.getDelegate(t,"head")})}activate(t,e){return f(this,void 0,void 0,function*(){const n=Ui(t);if(n!==T.VALID)throw new Gi(t,$(n));const i=yield this.prepare.activate({pkh:t,secret:e}),s=yield this.forge(i),o=`${s.opbytes}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`;return new Rt(yield this.rpc.injectOperation(o),Object.assign(Object.assign({},s),{opbytes:o}),[],this.context.clone())})}}const on=100,xg=1,Cg=.1,ea=100;class gt{constructor(t,e,n,i,s=on){this._milligasLimit=t,this._storageLimit=e,this.opSize=n,this.minimalFeePerStorageByteMutez=i,this.baseFeeMutez=s}get burnFeeMutez(){return this.roundUp(Number(this.storageLimit)*Number(this.minimalFeePerStorageByteMutez))}get storageLimit(){const t=Math.max(Number(this._storageLimit),0);return t>0?t:0}get gasLimit(){return this.roundUp(Number(this._milligasLimit)/1e3+ea)}get operationFeeMutez(){return(Number(this._milligasLimit)/1e3+ea)*Cg+Number(this.opSize)*xg}roundUp(t){return Math.ceil(Number(t))}get minimalFeeMutez(){return this.roundUp(on+this.operationFeeMutez)}get suggestedFeeMutez(){return this.roundUp(this.operationFeeMutez+on*2)}get usingBaseFeeMutez(){return Math.max(Number(this.baseFeeMutez),on)+this.roundUp(this.operationFeeMutez)}get totalCost(){return this.minimalFeeMutez+this.burnFeeMutez}get consumedMilligas(){return Number(this._milligasLimit)}static createEstimateInstanceFromProperties(t){let e=0,n=0,i=0,s=0,o;return t.forEach(a=>{e+=a.milligasLimit,n+=a.storageLimit,i+=a.opSize,s=Math.max(a.minimalFeePerStorageByteMutez,s),a.baseFeeMutez&&(o=o?o+a.baseFeeMutez:a.baseFeeMutez)}),new gt(e,n,i,s,o)}static createArrayEstimateInstancesFromProperties(t){return t.map(e=>new gt(e.milligasLimit,e.storageLimit,e.opSize,e.minimalFeePerStorageByteMutez,e.baseFeeMutez))}}class Mg extends Z{constructor(){super(),this.name="RevealEstimateError",this.message="Public key is unknown, unable to estimate the reveal operation in Wallet API."}}class Dg extends qr{constructor(){super(...arguments),this.ALLOCATION_STORAGE=257,this.ORIGINATION_STORAGE=257,this.OP_SIZE_REVEAL=128,this.prepare=new Wr(this.context)}getKeys(){return f(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{publicKeyHash:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}getEstimationPropertiesFromOperationContent(t,e,n){const i=de({contents:[t]});let s=0,o=0;return i.forEach(a=>{o+="originated_contracts"in a&&typeof a.originated_contracts<"u"?a.originated_contracts.length*this.ORIGINATION_STORAGE:0,o+="allocated_destination_contract"in a?this.ALLOCATION_STORAGE:0,s+=Number(a.consumed_milligas)||0,o+="paid_storage_size_diff"in a&&Number(a.paid_storage_size_diff)||0,o+="storage_size"in a&&"global_address"in a&&Number(a.storage_size)||0,o+="genesis_commitment_hash"in a?Number(a.size):0}),Bi(t)?{milligasLimit:s||0,storageLimit:Number(o||0),opSize:e,minimalFeePerStorageByteMutez:n.toNumber()}:{milligasLimit:0,storageLimit:0,opSize:e,minimalFeePerStorageByteMutez:n.toNumber(),baseFeeMutez:0}}calculateEstimates(t,e){return f(this,void 0,void 0,function*(){const{opbytes:n,opOb:{branch:i,contents:s}}=yield this.forge(t),o={operation:{branch:i,contents:s},chain_id:yield this.context.readProvider.getChainId()},{opResponse:a}=yield this.simulate(o),{cost_per_byte:c}=e,u=[...Nr(a,"backtracked"),...Nr(a)];if(u.length)throw new zc(u,"Error occurred during estimation");let l=1;return Array.isArray(t.opOb.contents)&&t.opOb.contents.length>1&&(l=a.contents[0].kind==="reveal"?t.opOb.contents.length-1:t.opOb.contents.length),a.contents.map(d=>this.getEstimationPropertiesFromOperationContent(d,d.kind==="reveal"?this.OP_SIZE_REVEAL/2:n.length/2/l,c))})}originate(t){return f(this,void 0,void 0,function*(){const e=yield this.prepare.originate(t),n=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.calculateEstimates(e,n);return e.opOb.contents[0].kind==="reveal"&&i.shift(),gt.createEstimateInstanceFromProperties(i)})}transfer(t){var e,{fee:n,storageLimit:i,gasLimit:s}=t,o=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const a=V(o.to);if(a!==T.VALID)throw new z(o.to,$(a));const c=V((e=o.source)!==null&&e!==void 0?e:"");if(o.source&&c!==T.VALID)throw new z(o.source,$(c));if(o.amount<0)throw new Ur(o.amount.toString());const u=yield this.prepare.transaction(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),l=yield this.context.readProvider.getProtocolConstants("head"),d=yield this.calculateEstimates(u,l);return u.opOb.contents[0].kind==="reveal"&&d.shift(),gt.createEstimateInstanceFromProperties(d)})}transferTicket(t){var e,{fee:n,storageLimit:i,gasLimit:s}=t,o=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const a=V(o.destination);if(a!==T.VALID)throw new z(o.destination,$(a));const c=V((e=o.source)!==null&&e!==void 0?e:"");if(o.source&&c!==T.VALID)throw new z(o.source,$(c));const u=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.prepare.transferTicket(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),d=yield this.calculateEstimates(l,u);return l.opOb.contents[0].kind==="reveal"&&d.shift(),gt.createEstimateInstanceFromProperties(d)})}setDelegate(t){var e,{fee:n,gasLimit:i,storageLimit:s}=t,o=yt(t,["fee","gasLimit","storageLimit"]);return f(this,void 0,void 0,function*(){const a=V(o.source);if(o.source&&a!==T.VALID)throw new z(o.source,$(a));const c=V((e=o.delegate)!==null&&e!==void 0?e:"");if(o.delegate&&c!==T.VALID)throw new z(o.delegate,$(c));const u=yield this.prepare.delegation(Object.assign({fee:n,storageLimit:s,gasLimit:i},o)),l=yield this.context.readProvider.getProtocolConstants("head"),d=yield this.calculateEstimates(u,l);return u.opOb.contents[0].kind==="reveal"&&d.shift(),gt.createEstimateInstanceFromProperties(d)})}batch(t){return f(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.batch(t),i=yield this.calculateEstimates(n,e);return gt.createArrayEstimateInstancesFromProperties(i)})}registerDelegate(t,e){var{fee:n,storageLimit:i,gasLimit:s}=t,o=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const a=(yield this.getKeys()).publicKeyHash,c=yield this.context.readProvider.getProtocolConstants("head"),u=e||a,l=yield this.prepare.registerDelegate(Object.assign({fee:n,storageLimit:i,gasLimit:s},o),u),d=yield this.calculateEstimates(l,c);return l.opOb.contents[0].kind==="reveal"&&d.shift(),gt.createEstimateInstanceFromProperties(d)})}reveal(t){return f(this,void 0,void 0,function*(){const{publicKeyHash:e,publicKey:n}=yield this.getKeys();if(!n)throw new Mg;if(yield this.isAccountRevealRequired(e)){const i=yield this.context.readProvider.getProtocolConstants("head"),s=t?yield this.prepare.reveal(t):yield this.prepare.reveal({}),o=yield this.calculateEstimates(s,i);return gt.createEstimateInstanceFromProperties(o)}})}registerGlobalConstant(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){const o=yield this.prepare.registerGlobalConstant(Object.assign({fee:e,storageLimit:n,gasLimit:i},s)),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.calculateEstimates(o,a);return o.opOb.contents[0].kind==="reveal"&&c.shift(),gt.createEstimateInstanceFromProperties(c)})}increasePaidStorage(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=yt(t,["fee","storageLimit","gasLimit"]);return f(this,void 0,void 0,function*(){if(s.amount<0)throw new Ur(s.amount.toString());const o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.prepare.increasePaidStorage(Object.assign({fee:e,storageLimit:n,gasLimit:i},s)),c=yield this.calculateEstimates(a,o);return a.opOb.contents[0].kind==="reveal"&&c.shift(),gt.createEstimateInstanceFromProperties(c)})}updateConsensusKey(t){return f(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.updateConsensusKey(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),gt.createEstimateInstanceFromProperties(i)})}smartRollupAddMessages(t){return f(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.smartRollupAddMessages(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),gt.createEstimateInstanceFromProperties(i)})}smartRollupOriginate(t){return f(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.smartRollupOriginate(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),gt.createEstimateInstanceFromProperties(i)})}contractCall(t){return f(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.contractCall(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),gt.createEstimateInstanceFromProperties(i)})}}class ra extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="delegation"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get delegate(){return this.params.delegate}get isRegisterOperation(){return this.delegate===this.source}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),this.consumedMilliGas?new I(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class kg extends Rt{constructor(t,e,n,i,s,o){super(t,n,i,s),this.params=e,this.contractProvider=o;const a=this.operationResults&&this.operationResults.originated_contracts;Array.isArray(a)&&(this.contractAddress=a[0])}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="origination"),e=t&&Cr(t)&&t.metadata.operation_result;return e||void 0}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),this.consumedMilliGas?new I(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get storageDiff(){const t=this.operationResults&&this.operationResults.paid_storage_size_diff;return t||void 0}get storageSize(){const t=this.operationResults&&this.operationResults.storage_size;return t||void 0}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}contract(t,e){return f(this,void 0,void 0,function*(){if(!this.contractAddress)throw new cg("No contract was originated in this operation");return yield this.confirmation(t,e),this.contractProvider.at(this.contractAddress)})}}class Bg extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n,this.globalConstantHash=this.operationResults&&this.operationResults.global_address}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="register_global_constant"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get registeredExpression(){return this.params.value}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),this.consumedMilliGas?new I(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class $g extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="reveal");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get publicKey(){return this.params.public_key}sumProp(t,e){return t.reduce((n,i)=>e in i?Number(i[e])+n:n,0)}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),new I(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(de({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(de({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(de({contents:this.operationResults}),"storage_size"))}get errors(){return Nr({contents:this.operationResults})}}class Hg extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="transaction");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get amount(){return new I(this.params.amount)}get destination(){return this.params.destination}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}sumProp(t,e){return t.reduce((n,i)=>e in i?Number(i[e])+n:n,0)}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),new I(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(de({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(de({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(de({contents:this.operationResults}),"storage_size"))}get errors(){return Nr({contents:this.operationResults})}}class jg{constructor(t,e,n){this.id=t,this.schema=e,this.provider=n}get(t,e){return f(this,void 0,void 0,function*(){try{return yield this.provider.getBigMapKeyByID(this.id.toString(),t,this.schema,e)}catch(n){if(n instanceof Lr&&n.status===Gr.NOT_FOUND)return;throw n}})}getMultipleValues(t,e,n=5){return f(this,void 0,void 0,function*(){return this.provider.getBigMapKeysByID(this.id.toString(),t,this.schema,e,n)})}toJSON(){return this.id.toString()}toString(){return this.id.toString()}}const na=r=>({big_map:(t,e)=>{if(!t||!("int"in t)||t.int===void 0)return{};{const n=new kt(e);return new jg(new I(t.int),n,r)}},sapling_state:t=>!t||!("int"in t)||t.int===void 0?{}:new Sg(new I(t.int),r)});class Ug extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const e=Array.isArray(this.results)&&this.results.find(n=>n.kind==="ballot");return e||void 0}get period(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.period}get proposal(){return this.params.proposal}get ballot(){return this.params.ballot}}class Gg extends Rt{constructor(t,e,n,i,s){super(t,n,i,s),this.params=e}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="drain_delegate"),e=t&&t.metadata&&t.metadata.balance_updates;return e||void 0}get consensusKey(){return this.params.consensus_key}get delegate(){return this.params.delegate}get destination(){return this.params.destination}}class Kg extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind===E.TRANSFER_TICKET),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),this.consumedMilliGas?new I(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class Vg extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="increase_paid_storage"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get amount(){return this.params.amount}get destination(){return this.params.destination}}class Fg extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const e=Array.isArray(this.results)&&this.results.find(n=>n.kind==="proposals");return e||void 0}get proposals(){return this.params.proposals}get period(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.period}}class zg extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="update_consensus_key"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get pk(){return this.params.pk}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Jg extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="smart_rollup_add_messages"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get message(){return this.params.message}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class qg extends Rt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind===E.SMART_ROLLUP_ORIGINATE),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get pvmKind(){return this.params.pvm_kind}get kernel(){return this.params.kernel}get originationProof(){return this.params.origination_proof}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Wg extends qr{constructor(t,e){super(t),this.estimator=e,this.contractProviderTypeSymbol=Symbol.for("taquito-contract-provider-type-symbol"),this.prepare=new Wr(this.context)}getStorage(t,e){return f(this,void 0,void 0,function*(){const n=br(t);if(n!==T.VALID)throw new cr(t,$(n));const i=yield this.context.readProvider.getScript(t,"head");e||(e=i);let s;return kt.isSchema(e)?s=e:s=kt.fromRPCResponse({script:e}),s.Execute(i.storage,na(this))})}getBigMapKey(t,e,n){return f(this,void 0,void 0,function*(){const i=br(t);if(i!==T.VALID)throw new cr(t,$(i));n||(n=(yield this.rpc.getContract(t)).script);let s;kt.isSchema(n)?s=n:s=kt.fromRPCResponse({script:n});const o=s.EncodeBigMapKey(e),a=yield this.rpc.getBigMapKey(t,o);return s.ExecuteOnBigMapValue(a)})}getBigMapKeyByID(t,e,n,i){return f(this,void 0,void 0,function*(){const{key:s,type:o}=n.EncodeBigMapKey(e),{packed:a}=yield this.context.packer.packData({data:s,type:o}),c=mu(a),u=i?yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},i):yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},"head");return n.ExecuteOnBigMapValue(u,na(this))})}getBigMapKeysByID(t,e,n,i,s=5){return f(this,void 0,void 0,function*(){const o=yield this.getBlockForRequest(e,i),a=new Dt;let c=0,u=[];for(;c<e.length;){const d=e.slice(c,c+s).map(m=>this.getBigMapValueOrUndefined(m,t,n,o));u=[...u,...yield Promise.all(d)],c+=s}for(let l=0;l<u.length;l++)a.set(e[l],u[l]);return a})}getBlockForRequest(t,e){return f(this,void 0,void 0,function*(){return t.length===1||typeof e<"u"?e:yield this.context.readProvider.getBlockLevel("head")})}getBigMapValueOrUndefined(t,e,n,i){return f(this,void 0,void 0,function*(){try{return yield this.getBigMapKeyByID(e,t,n,i)}catch(s){if(s instanceof Lr&&s.status===Gr.NOT_FOUND)return;throw s}})}getSaplingDiffByID(t,e){return f(this,void 0,void 0,function*(){return e?yield this.context.readProvider.getSaplingDiffById({id:t.toString()},e):yield this.context.readProvider.getSaplingDiffById({id:t.toString()},"head")})}originate(t){return f(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.originate.bind(this.estimator)),n=yield this.prepare.originate(Object.assign(Object.assign({},t),e)),i=n.opOb.contents.find(l=>l.kind===E.ORIGINATION),s=yield this.forge(n),{hash:o,context:a,forgedBytes:c,opResponse:u}=yield this.signAndInject(s);return new kg(o,i,c,u,a,this)})}setDelegate(t){var e;return f(this,void 0,void 0,function*(){const n=V(t.source);if(t.source&&n!==T.VALID)throw new z(t.source,$(n));const i=V((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&i!==T.VALID)throw new z(t.delegate,$(i));if(/kt1/i.test(t.source))throw new Ff(t.source);const s=yield this.signer.publicKeyHash(),o=t.source||s,a=yield this.estimate(t,this.estimator.setDelegate.bind(this.estimator)),c=yield this.prepare.delegation(Object.assign(Object.assign({},t),a)),u=c.opOb.contents.find(w=>w.kind===E.DELEGATION),l=yield this.forge(c),{hash:d,context:m,forgedBytes:v,opResponse:b}=yield this.signAndInject(l);return new ra(d,u,o,v,b,m)})}registerDelegate(t){return f(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.registerDelegate.bind(this.estimator)),n=yield this.signer.publicKeyHash(),i=yield this.prepare.registerDelegate(Object.assign(Object.assign({},t),e)),s=i.opOb.contents.find(d=>d.kind===E.DELEGATION),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new ra(a,s,n,u,l,c)})}transfer(t){var e;return f(this,void 0,void 0,function*(){const n=V(t.to);if(n!==T.VALID)throw new z(t.to,$(n));const i=V((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&i!==T.VALID)throw new z(t.source,$(i));if(t.amount<0)throw new Ur(t.amount.toString());const s=yield this.signer.publicKeyHash(),o=yield this.estimate(t,this.estimator.transfer.bind(this.estimator)),a=t.source||s,c=yield this.prepare.transaction(Object.assign(Object.assign({},t),o)),u=c.opOb.contents.find(w=>w.kind===E.TRANSACTION),l=yield this.forge(c),{hash:d,context:m,forgedBytes:v,opResponse:b}=yield this.signAndInject(l);return new Hg(d,u,a,v,b,m)})}transferTicket(t){var e,n;return f(this,void 0,void 0,function*(){const i=V(t.destination);if(i!==T.VALID)throw new z(t.destination,$(i));const s=V((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&s!==T.VALID)throw new z(t.source,$(s));const o=yield this.signer.publicKeyHash(),a=(n=t.source)!==null&&n!==void 0?n:o,c=yield this.estimate(t,this.estimator.transferTicket.bind(this.estimator)),u=yield this.prepare.transferTicket(Object.assign(Object.assign({},t),c)),l=u.opOb.contents.find(O=>O.kind===E.TRANSFER_TICKET),d=yield this.forge(u),{hash:m,context:v,forgedBytes:b,opResponse:w}=yield this.signAndInject(d);return new Kg(m,l,a,b,w,v)})}reveal(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimator.reveal(t);if(n){const i=yield this.estimate(t,()=>f(this,void 0,void 0,function*(){return n})),s=yield this.prepare.reveal(Object.assign(Object.assign({},t),i)),o=s.opOb.contents.find(m=>m.kind===E.REVEAL),a=yield this.forge(s),{hash:c,context:u,forgedBytes:l,opResponse:d}=yield this.signAndInject(a);return new $g(c,o,e,l,d,u)}else throw new Wf(`The publicKeyHash '${e}' has already been revealed.`)})}registerGlobalConstant(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.registerGlobalConstant.bind(this.estimator)),i=yield this.prepare.registerGlobalConstant(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(d=>d.kind===E.REGISTER_GLOBAL_CONSTANT),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new Bg(a,s,e,u,l,c)})}increasePaidStorage(t){return f(this,void 0,void 0,function*(){if(t.amount<0)throw new Ur(t.amount.toString());const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.increasePaidStorage.bind(this.estimator)),i=yield this.prepare.increasePaidStorage(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(d=>d.kind===E.INCREASE_PAID_STORAGE),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new Vg(a,s,e,u,l,c)})}drainDelegate(t){return f(this,void 0,void 0,function*(){const e=yield this.prepare.drainDelegate(t),n=e.opOb.contents.find(u=>u.kind===E.DRAIN_DELEGATE),i=yield this.forge(e),{hash:s,context:o,forgedBytes:a,opResponse:c}=yield this.signAndInject(i);return new Gg(s,n,a,c,o)})}ballot(t){var e,n;return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),s=V((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&s!==T.VALID)throw new z(t.source,$(s));const o=(n=t.source)!==null&&n!==void 0?n:i,a=yield this.prepare.ballot(Object.assign(Object.assign({},t),{source:o})),c=a.opOb.contents.find(b=>b.kind===E.BALLOT),u=yield this.forge(a),{hash:l,context:d,forgedBytes:m,opResponse:v}=yield this.signAndInject(u);return new Ug(l,c,i,m,v,d)})}proposals(t){var e,n;return f(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),s=V((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&s!==T.VALID)throw new z(t.source,$(s));const o=(n=t.source)!==null&&n!==void 0?n:i,a=yield this.prepare.proposals(Object.assign(Object.assign({},t),{source:o})),c=a.opOb.contents.find(b=>b.kind===E.PROPOSALS),u=yield this.forge(a),{hash:l,context:d,forgedBytes:m,opResponse:v}=yield this.signAndInject(u);return new Fg(l,c,i,m,v,d)})}updateConsensusKey(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.updateConsensusKey.bind(this.estimator)),i=yield this.prepare.updateConsensusKey(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(d=>d.kind===E.UPDATE_CONSENSUS_KEY),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new zg(a,s,e,u,l,c)})}smartRollupAddMessages(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.smartRollupAddMessages.bind(this.estimator)),i=yield this.prepare.smartRollupAddMessages(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(d=>d.kind===E.SMART_ROLLUP_ADD_MESSAGES),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new Jg(a,s,e,u,l,c)})}smartRollupOriginate(t){return f(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.smartRollupOriginate.bind(this.estimator)),i=yield this.rpc.getOriginationProof({kind:t.pvmKind,kernel:t.kernel}),s=Object.assign(Object.assign({},t),{originationProof:i}),o=yield this.prepare.smartRollupOriginate(Object.assign(Object.assign({},s),n)),a=o.opOb.contents.find(v=>v.kind===E.SMART_ROLLUP_ORIGINATE),c=yield this.forge(o),{hash:u,context:l,forgedBytes:d,opResponse:m}=yield this.signAndInject(c);return new qg(u,a,e,d,m,l)})}failingNoop(t){return f(this,void 0,void 0,function*(){const e={kind:E.FAILING_NOOP,arbitrary:t.arbitrary},n=yield this.context.readProvider.getBlockHash(t.basedOnBlock),i=yield this.context.forger.forge({branch:n,contents:[e]}),{prefixSig:s}=yield this.signer.sign(i,new Uint8Array([3]));return{signature:s,bytes:i,signedContent:{branch:n,contents:[{kind:E.FAILING_NOOP,arbitrary:t.arbitrary}]}}})}at(t,e=n=>n){return f(this,void 0,void 0,function*(){const n=br(t);if(n!==T.VALID)throw new cr(t,$(n));const i=this.context.withExtensions().rpc,s=this.context.withExtensions().readProvider,o=yield s.getScript(t,"head"),a=yield s.getEntrypoints(t),c=new Zc(t,o,this,this,a,i,s);return e(c,this.context)})}batch(t){const e=new Xc(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}class Qc{constructor(t){this.context=t}getNextProto(){return f(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}parseScript(t){return f(this,void 0,void 0,function*(){return new ar({protocol:yield this.getNextProto()}).parseScript(t)})}parseMichelineExpression(t){return f(this,void 0,void 0,function*(){return new ar({protocol:yield this.getNextProto()}).parseMichelineExpression(t)})}parseJSON(t){return f(this,void 0,void 0,function*(){return new ar({protocol:yield this.getNextProto()}).parseJSON(t)})}prepareCodeOrigination(t){return f(this,void 0,void 0,function*(){const e=t;if(e.code=yield this.formatCodeParam(t.code),t.init)e.init=yield this.formatInitParam(t.init);else if(t.storage){const n=e.code.find(o=>"prim"in o&&o.prim==="storage");if(!(n!=null&&n.args))throw new Tn("The storage section is missing from the script",t.code);const i=new kt(n.args[0]),s=yield this.findGlobalConstantsHashAndValue(i);if(Object.keys(s).length!==0){const a=new ar({expandGlobalConstant:s}).parseJSON(n.args[0]),c=new kt(a);e.init=c.Encode(t.storage)}else e.init=i.Encode(t.storage);delete e.storage}return e})}formatCodeParam(t){return f(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const n=yield this.parseScript(t);if(n===null)throw new Tn("Unable to parse",t);e=n}else{const n=yield this.parseJSON(t),i=["parameter","storage","code"];e=n.sort((s,o)=>i.indexOf(s.prim)-i.indexOf(o.prim))}return e})}formatInitParam(t){return f(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const n=yield this.parseMichelineExpression(t);if(n===null)throw new Vc("Invalid init parameter",t);e=n}else e=yield this.parseJSON(t);return e})}findGlobalConstantsHashAndValue(t){return f(this,void 0,void 0,function*(){const e=t.findToken("constant"),n={};if(e.length!==0)for(const i of e){const s=i.tokenVal.args;if(s){const o=s[0];if(o.string){const a=o.string,c=yield this.context.globalConstantsProvider.getGlobalConstantByHash(a);Object.assign(n,{[a]:c})}}}return n})}}class tu{constructor(t){this.context=t}packData(t){return f(this,void 0,void 0,function*(){return this.context.rpc.packData(t)})}}class Zg extends Vi{constructor(){super(),this.name="UnconfiguredGlobalConstantsProviderError",this.message="No globalThis constants provider has been configured. Please configure one by calling setGlobalConstantsProvider({globalConstantsProvider}) on your TezosToolkit instance."}}class eu{getGlobalConstantByHash(t){return f(this,void 0,void 0,function*(){throw new Zg})}}class ru{constructor(t){this.rpc=t}getBalance(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getBalance(t,{block:String(e)})})}getDelegate(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getDelegate(t,{block:String(e)})})}getNextProtocol(t){return f(this,void 0,void 0,function*(){return(yield this.rpc.getProtocols({block:String(t)})).next_protocol})}getProtocolConstants(t){return f(this,void 0,void 0,function*(){const{time_between_blocks:e,minimal_block_delay:n,hard_gas_limit_per_operation:i,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:c,smart_rollup_origination_size:u}=yield this.rpc.getConstants({block:String(t)});return{time_between_blocks:e,minimal_block_delay:n,hard_gas_limit_per_operation:i,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:c,smart_rollup_origination_size:u}})}getScript(t,e){return f(this,void 0,void 0,function*(){const{script:n}=yield this.rpc.getContract(t,{block:String(e)});return n})}getStorage(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getStorage(t,{block:String(e)})})}getBlockHash(t){return f(this,void 0,void 0,function*(){const{hash:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBlockLevel(t){return f(this,void 0,void 0,function*(){const{level:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getCounter(t,e){return f(this,void 0,void 0,function*(){const{counter:n}=yield this.rpc.getContract(t,{block:String(e)});return n||"0"})}getBlockTimestamp(t){return f(this,void 0,void 0,function*(){const{timestamp:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBigMapValue(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getBigMapExpr(t.id,t.expr,{block:String(e)})})}getSaplingDiffById(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffById(t.id,{block:String(e)})})}getSaplingDiffByContract(t,e){return f(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffByContract(t,{block:String(e)})})}getEntrypoints(t){return f(this,void 0,void 0,function*(){return this.rpc.getEntrypoints(t)})}getChainId(){return f(this,void 0,void 0,function*(){return this.rpc.getChainId()})}isAccountRevealed(t,e){return f(this,void 0,void 0,function*(){const n=yield this.rpc.getManagerKey(t,{block:String(e)});return n&&typeof n=="object"?!!n.key:!!n})}getBlock(t){return f(this,void 0,void 0,function*(){return this.rpc.getBlock({block:String(t)})})}getLiveBlocks(t){return this.rpc.getLiveBlocks({block:String(t)})}}class ia extends W{constructor(t){super(),this.type=t,this.name="UnsupportedEventError",this.message=`Unsupported event type "${t}" expecting one of the "data", "error", or "close".`}}class Yg extends W{constructor(t){super(),this.invalidExpression=t,this.name="InvalidFilterExpressionError",this.message="Invalid filter expression expecting the object to contain either and/or property"}}const Xg=(r,t)=>r.hash===t.opHash,Qg=(r,t)=>{switch(r.kind){case"endorsement":return"metadata"in r&&r.metadata.delegate===t.source;case"activate_account":return"metadata"in r&&r.pkh===t.source;default:return"source"in r&&r.source===t.source}},tm=(r,t)=>"kind"in r&&r.kind===t.kind,em=(r,t)=>{switch(r.kind){case"delegation":return r.delegate===t.destination;case"origination":if("metadata"in r&&"operation_result"in r.metadata&&"originated_contracts"in r.metadata.operation_result&&Array.isArray(r.metadata.operation_result.originated_contracts))return r.metadata.operation_result.originated_contracts.some(e=>e===t.destination);break;case"transaction":return r.destination===t.destination;default:return!1}},rm=(r,t,e,n)=>!(r.kind!=="event"||e&&r.tag!==e||t&&r.source!==t||n&&r.result.status!=="applied"),nm=(r,t)=>"opHash"in t?Xg(r,t):"source"in t?Qg(r,t):"kind"in t?tm(r,t):"destination"in t?em(r,t):!1,im=(r,t)=>{if(Array.isArray(t.and))return t.and.every(e=>$i(r,e));if(Array.isArray(t.or))return t.or.some(e=>$i(r,e));throw new Yg(t)},$i=(r,t)=>{const e=[];return Array.isArray(t)?e.push(...t):e.push(t),e.every(n=>"and"in n||"or"in n?im(r,n):nm(r,n))};class an{constructor(t,e=!1,n=oc()){this.shouldRetry=e,this.operatorFunction=n,this.errorListeners=[],this.messageListeners=[],this.closeListeners=[],this.completed$=new dr,t.pipe(Lh(this.completed$),wn(i=>{this.call(this.messageListeners,i)},i=>{this.call(this.errorListeners,i)},()=>{this.call(this.closeListeners)}),this.shouldRetry?n:wn(),jn(()=>Eh)).subscribe()}call(t,e){for(const n of t)try{n(e)}catch(i){console.error(i)}}remove(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}on(t,e){switch(t){case"data":this.messageListeners.push(e);break;case"error":this.errorListeners.push(e);break;case"close":this.closeListeners.push(e);break;default:throw new ia(t)}}off(t,e){switch(t){case"data":this.remove(this.messageListeners,e);break;case"error":this.remove(this.errorListeners,e);break;case"close":this.remove(this.closeListeners,e);break;default:throw new ia(t)}}close(){this.completed$.next()}}const sm={shouldObservableSubscriptionRetry:!1,observableSubscriptionRetryFunction:oc()},om=r=>rr(r.rpc.getBlock()).pipe(Oe()),am=r=>Jr(t=>new et(e=>{for(const n of t.operations)for(const i of n)for(const s of i.contents)$i(Object.assign({hash:i.hash},s),r)&&e.next(Object.assign({hash:i.hash},s));e.complete()})),cm=r=>Jr(t=>new et(e=>{for(const n of t.operations)for(const i of n)for(const s of i.contents){const a=s.metadata.internal_operation_results;if(a)for(const c of a)rm(c,r==null?void 0:r.address,r==null?void 0:r.tag,r==null?void 0:r.excludeFailedOperations)&&e.next(Object.assign({opHash:i.hash,blockHash:t.hash,level:t.header.level},c))}e.complete()}));class Hi{constructor(t,e={}){this.context=t,this._config$=new Bn(Object.assign(Object.assign({},sm),e)),this.timer$=this._config$.pipe(To("pollingIntervalMilliseconds"),Le(n=>n?Oi(0,n):rr(this.getConfirmationPollingInterval()).pipe(Le(i=>Oi(0,i))))),this.newBlock$=this.timer$.pipe(Le(()=>om(this.context)),Rh("hash"),Ih(),Da())}get config(){return this._config$.getValue()}getConfirmationPollingInterval(){return f(this,void 0,void 0,function*(){if(!this.config.pollingIntervalMilliseconds)try{const n=yield this.context.readProvider.getProtocolConstants("head"),s=(n.minimal_block_delay?n.minimal_block_delay.multipliedBy(1e3):n.time_between_blocks?n.time_between_blocks[0].multipliedBy(1e3):new I(5e3)).dividedBy(3);this.config.pollingIntervalMilliseconds=s.toNumber()===0?1e3:s.toNumber()}catch{return 5e3}return this.config.pollingIntervalMilliseconds})}subscribeBlock(t){return new an(this.newBlock$,this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribe(t){return new an(this.newBlock$.pipe(To("hash")),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeOperation(t){return new an(this.newBlock$.pipe(am(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeEvent(t){return new an(this.newBlock$.pipe(cm(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}}class nu{constructor(t){this.context=t}getNextProto(){return f(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}forge({branch:t,contents:e}){return f(this,void 0,void 0,function*(){return new jc(yield this.getNextProto()).forge({branch:t,contents:e})})}}const um={defaultConfirmationCount:1,confirmationPollingTimeoutSecond:180};class In{constructor(t,e=new Di,n,i=new Bn(Object.assign({},um)),s,o,a,c,u,l,d,m){this._rpc=t,this._signer=e,this._proto=n,this._config=i,this.providerDecorator=[],this.tz=new Lg(this),this.estimate=new Dg(this),this.contract=new Wg(this,this.estimate),this.prepare=new Wr(this),this.batch=new Rg(this,this.estimate),this.wallet=new Kn(this),this.withExtensions=()=>{let v=this.clone();return this.providerDecorator.forEach(b=>{v=b(v)}),v},typeof this._rpc=="string"?this._rpcClient=new ln(this._rpc):this._rpcClient=this._rpc,this._forger=s||new nu(this),this._injector=o||new Uc(this),this.operationFactory=new Ng(this),this._walletProvider=c||new Wc(this),this._parser=u||new Qc(this),this._packer=a||new tu(this),this._globalConstantsProvider=l||new eu,this._readProvider=d||new ru(this._rpcClient),this._stream=m||new Hi(this)}get config(){return this._config.getValue()}set config(t){this._config.next(Object.assign({},t))}setPartialConfig(t){this._config.next(Object.assign(Object.assign({},this._config.getValue()),t))}get rpc(){return this._rpcClient}set rpc(t){this._rpcClient=t}get injector(){return this._injector}set injector(t){this._injector=t}get forger(){return this._forger}set forger(t){this._forger=t}get signer(){return this._signer}set signer(t){this._signer=t}get walletProvider(){return this._walletProvider}set walletProvider(t){this._walletProvider=t}set proto(t){this._proto=t}get proto(){return this._proto}get parser(){return this._parser}set parser(t){this._parser=t}get packer(){return this._packer}set packer(t){this._packer=t}get globalConstantsProvider(){return this._globalConstantsProvider}set globalConstantsProvider(t){this._globalConstantsProvider=t}get readProvider(){return this._readProvider}set readProvider(t){this._readProvider=t}get stream(){return this._stream}set stream(t){this._stream=t}isAnyProtocolActive(t=[]){return f(this,void 0,void 0,function*(){if(this._proto)return t.includes(this._proto);{const e=yield this.readProvider.getNextProtocol("head");return t.includes(e)}})}isAnySignerConfigured(){return!(this.signer instanceof Di)}clone(){return new In(this.rpc,this.signer,this.proto,this._config,this.forger,this._injector,this.packer,this._walletProvider,this._parser,this._globalConstantsProvider,this._readProvider,this._stream)}registerProviderDecorator(t){this.providerDecorator.push(t)}}const lm={commitHash:"b85fc404e34545a518215e449b3f1253f4520eec",version:"17.2.0"};class pm{constructor(t){this.context=t}forge({branch:t,contents:e}){return this.context.rpc.forgeOperations({branch:t,contents:e})}}class fm{packData(t){return f(this,void 0,void 0,function*(){const{bytes:e}=ep(t.data,t.type);return{packed:e}})}}class gm{constructor(t){this._rpc=t,this._options={},this.format=Ki,typeof this._rpc=="string"?this._rpcClient=new ln(this._rpc):this._rpcClient=this._rpc,this._context=new In(t),this._wallet=new Kn(this._context),this.setProvider({rpc:this._rpcClient}),this.batch=this._context.batch.batch.bind(this._context.batch)}setProvider({rpc:t,stream:e,signer:n,protocol:i,config:s,forger:o,wallet:a,packer:c,globalConstantsProvider:u,readProvider:l,parserProvider:d,injectorProvider:m}){this.setRpcProvider(t),this.setStreamProvider(e),this.setSignerProvider(n),this.setForgerProvider(o),this.setWalletProvider(a),this.setPackerProvider(c),this.setGlobalConstantsProvider(u),this.setReadProvider(l),this.setParserProvider(d),this.setInjectorProvider(m),this._context.proto=i,s&&this._context.setPartialConfig(s)}setSignerProvider(t){!this._options.signer&&typeof t>"u"?(this._context.signer=new Di,this._options.signer=t):typeof t<"u"&&(this._context.signer=t,this._options.signer=t)}setRpcProvider(t){typeof t=="string"?this._rpcClient=new ln(t):t===void 0||(this._rpcClient=t),this._options.rpc=this._rpcClient,this._context.rpc=this._rpcClient}setForgerProvider(t){if(typeof t<"u")this._options.forger=t,this._context.forger=t;else if(this._options.forger===void 0){const e=this.getFactory(nu)();this._options.forger=e,this._context.forger=e}}setStreamProvider(t){if(typeof t=="string"){const e=new Hi(new In(new ln(t)));this._options.stream=e,this._context.stream=e}else if(typeof t<"u")this._options.stream=t,this._context.stream=t;else if(this._options.stream===void 0){const e=this.getFactory(Hi)();this._options.stream=e,this._context.stream=e}}setWalletProvider(t){if(!this._options.wallet&&typeof t>"u"){const e=this.getFactory(Wc)();this._options.wallet=e,this._context.walletProvider=e}else typeof t<"u"&&(this._options.wallet=t,this._context.walletProvider=t)}setPackerProvider(t){if(!this._options.packer&&typeof t>"u"){const e=this.getFactory(tu)();this._context.packer=e,this._options.packer=e}else typeof t<"u"&&(this._context.packer=t,this._options.packer=t)}setGlobalConstantsProvider(t){if(!this._options.globalConstantsProvider&&typeof t>"u"){const e=new eu;this._context.globalConstantsProvider=e,this._options.globalConstantsProvider=e}else typeof t<"u"&&(this._context.globalConstantsProvider=t,this._options.globalConstantsProvider=t)}setReadProvider(t){const e=t||new ru(this._context.rpc);this._options.readProvider=e,this._context.readProvider=e}setParserProvider(t){if(!this._options.parserProvider&&typeof t>"u"){const e=new Qc(this._context);this._context.parser=e,this._options.parserProvider=e}else typeof t<"u"&&(this._context.parser=t,this._options.parserProvider=t)}setInjectorProvider(t){if(!this._options.injectorProvider&&typeof t>"u"){const e=new Uc(this._context);this._context.injector=e,this._options.injectorProvider=e}else typeof t<"u"&&(this._context.injector=t,this._options.injectorProvider=t)}get tz(){return this._context.tz}get contract(){return this._context.contract}get prepare(){return this._context.prepare}get wallet(){return this._wallet}get operation(){return this._context.operationFactory}get estimate(){return this._context.estimate}get stream(){return this._context.stream}get rpc(){return this._context.rpc}get signer(){return this._context.signer}get globalConstants(){return this._context.globalConstantsProvider}addExtension(t){Array.isArray(t)?t.forEach(e=>e.configureContext(this._context)):t.configureContext(this._context)}getFactory(t){return(...e)=>new t(this._context,...e)}getVersionInfo(){return lm}}export{ke as D,gt as E,Sl as H,fm as M,E as O,pm as R,Gr as S,gm as T,Lr as a,ue as b,Be as c,Ms as d,$s as e,Cs as f,Ds as g,kt as h,dm as l};
