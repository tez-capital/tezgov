import{R as ca,al as ua,am as F,V as O,an as W,i as M,ao as hr,ap as Qe,a8 as P,aq as zc,ar as hi,as as qc,at as Ms,au as Ds,av as Wc,aw as Yc,P as A,a3 as la,p as Ni,ax as ks,W as xi,ay as Zc,az as ha,aA as Jc,aB as da,$ as Xc,aC as Qc,b as tu,X as Li,aD as pa,aE as Ge,aF as eu,aG as ru,a as $t,aH as Ci,aI as Lr,aJ as fa,aK as nu,aL as ga,aM as ma,aN as iu,aO as su}from"./main-653d6738.js";import{_ as V}from"./DAppClient-3841790b.js";var Mi={exports:{}},ya=function(t,e){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return t.apply(e,i)}},ou=ya,ze=Object.prototype.toString;function Di(r){return Array.isArray(r)}function di(r){return typeof r>"u"}function au(r){return r!==null&&!di(r)&&r.constructor!==null&&!di(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function ba(r){return ze.call(r)==="[object ArrayBuffer]"}function cu(r){return ze.call(r)==="[object FormData]"}function uu(r){var t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&ba(r.buffer),t}function lu(r){return typeof r=="string"}function hu(r){return typeof r=="number"}function Ea(r){return r!==null&&typeof r=="object"}function sn(r){if(ze.call(r)!=="[object Object]")return!1;var t=Object.getPrototypeOf(r);return t===null||t===Object.prototype}function du(r){return ze.call(r)==="[object Date]"}function pu(r){return ze.call(r)==="[object File]"}function fu(r){return ze.call(r)==="[object Blob]"}function va(r){return ze.call(r)==="[object Function]"}function gu(r){return Ea(r)&&va(r.pipe)}function mu(r){return ze.call(r)==="[object URLSearchParams]"}function yu(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function bu(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function ki(r,t){if(!(r===null||typeof r>"u"))if(typeof r!="object"&&(r=[r]),Di(r))for(var e=0,n=r.length;e<n;e++)t.call(null,r[e],e,r);else for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.call(null,r[i],i,r)}function pi(){var r={};function t(i,s){sn(r[s])&&sn(i)?r[s]=pi(r[s],i):sn(i)?r[s]=pi({},i):Di(i)?r[s]=i.slice():r[s]=i}for(var e=0,n=arguments.length;e<n;e++)ki(arguments[e],t);return r}function Eu(r,t,e){return ki(t,function(i,s){e&&typeof i=="function"?r[s]=ou(i,e):r[s]=i}),r}function vu(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var Rt={isArray:Di,isArrayBuffer:ba,isBuffer:au,isFormData:cu,isArrayBufferView:uu,isString:lu,isNumber:hu,isObject:Ea,isPlainObject:sn,isUndefined:di,isDate:du,isFile:pu,isBlob:fu,isFunction:va,isStream:gu,isURLSearchParams:mu,isStandardBrowserEnv:bu,forEach:ki,merge:pi,extend:Eu,trim:yu,stripBOM:vu},ir=Rt;function Bs(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var _a=function(t,e,n){if(!e)return t;var i;if(n)i=n(e);else if(ir.isURLSearchParams(e))i=e.toString();else{var s=[];ir.forEach(e,function(c,l){c===null||typeof c>"u"||(ir.isArray(c)?l=l+"[]":c=[c],ir.forEach(c,function(h){ir.isDate(h)?h=h.toISOString():ir.isObject(h)&&(h=JSON.stringify(h)),s.push(Bs(l)+"="+Bs(h))}))}),i=s.join("&")}if(i){var o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t},_u=Rt;function Rn(){this.handlers=[]}Rn.prototype.use=function(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1};Rn.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)};Rn.prototype.forEach=function(t){_u.forEach(this.handlers,function(n){n!==null&&t(n)})};var wu=Rn,Au=Rt,Su=function(t,e){Au.forEach(t,function(i,s){s!==e&&s.toUpperCase()===e.toUpperCase()&&(t[e]=i,delete t[s])})},wa=function(t,e,n,i,s){return t.config=e,n&&(t.code=n),t.request=i,t.response=s,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t},Aa={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},kn,Hs;function Sa(){if(Hs)return kn;Hs=1;var r=wa;return kn=function(e,n,i,s,o){var a=new Error(e);return r(a,n,i,s,o)},kn}var Bn,$s;function Ru(){if($s)return Bn;$s=1;var r=Sa();return Bn=function(e,n,i){var s=i.config.validateStatus;!i.status||!s||s(i.status)?e(i):n(r("Request failed with status code "+i.status,i.config,null,i.request,i))},Bn}var Hn,js;function Ou(){if(js)return Hn;js=1;var r=Rt;return Hn=r.isStandardBrowserEnv()?function(){return{write:function(n,i,s,o,a,c){var l=[];l.push(n+"="+encodeURIComponent(i)),r.isNumber(s)&&l.push("expires="+new Date(s).toGMTString()),r.isString(o)&&l.push("path="+o),r.isString(a)&&l.push("domain="+a),c===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(n){var i=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Hn}var $n,Vs;function Pu(){return Vs||(Vs=1,$n=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}),$n}var jn,Us;function Tu(){return Us||(Us=1,jn=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}),jn}var Vn,Gs;function Iu(){if(Gs)return Vn;Gs=1;var r=Pu(),t=Tu();return Vn=function(n,i){return n&&!r(i)?t(n,i):i},Vn}var Un,Ks;function Nu(){if(Ks)return Un;Ks=1;var r=Rt,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Un=function(n){var i={},s,o,a;return n&&r.forEach(n.split(`
`),function(l){if(a=l.indexOf(":"),s=r.trim(l.substr(0,a)).toLowerCase(),o=r.trim(l.substr(a+1)),s){if(i[s]&&t.indexOf(s)>=0)return;s==="set-cookie"?i[s]=(i[s]?i[s]:[]).concat([o]):i[s]=i[s]?i[s]+", "+o:o}}),i},Un}var Gn,Fs;function xu(){if(Fs)return Gn;Fs=1;var r=Rt;return Gn=r.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a"),i;function s(o){var a=o;return e&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return i=s(window.location.href),function(a){var c=r.isString(a)?s(a):a;return c.protocol===i.protocol&&c.host===i.host}}():function(){return function(){return!0}}(),Gn}var Kn,zs;function On(){if(zs)return Kn;zs=1;function r(t){this.message=t}return r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,Kn=r,Kn}var Fn,qs;function Ws(){if(qs)return Fn;qs=1;var r=Rt,t=Ru(),e=Ou(),n=_a,i=Iu(),s=Nu(),o=xu(),a=Sa(),c=Aa,l=On();return Fn=function(h){return new Promise(function(E,_){var L=h.data,I=h.headers,S=h.responseType,v;function Pr(){h.cancelToken&&h.cancelToken.unsubscribe(v),h.signal&&h.signal.removeEventListener("abort",v)}r.isFormData(L)&&delete I["Content-Type"];var H=new XMLHttpRequest;if(h.auth){var zr=h.auth.username||"",qr=h.auth.password?unescape(encodeURIComponent(h.auth.password)):"";I.Authorization="Basic "+btoa(zr+":"+qr)}var Ot=i(h.baseURL,h.url);H.open(h.method.toUpperCase(),n(Ot,h.params,h.paramsSerializer),!0),H.timeout=h.timeout;function qe(){if(H){var f="getAllResponseHeaders"in H?s(H.getAllResponseHeaders()):null,T=!S||S==="text"||S==="json"?H.responseText:H.response,N={data:T,status:H.status,statusText:H.statusText,headers:f,config:h,request:H};t(function(j){E(j),Pr()},function(j){_(j),Pr()},N),H=null}}if("onloadend"in H?H.onloadend=qe:H.onreadystatechange=function(){!H||H.readyState!==4||H.status===0&&!(H.responseURL&&H.responseURL.indexOf("file:")===0)||setTimeout(qe)},H.onabort=function(){H&&(_(a("Request aborted",h,"ECONNABORTED",H)),H=null)},H.onerror=function(){_(a("Network Error",h,null,H)),H=null},H.ontimeout=function(){var T=h.timeout?"timeout of "+h.timeout+"ms exceeded":"timeout exceeded",N=h.transitional||c;h.timeoutErrorMessage&&(T=h.timeoutErrorMessage),_(a(T,h,N.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",H)),H=null},r.isStandardBrowserEnv()){var Tr=(h.withCredentials||o(Ot))&&h.xsrfCookieName?e.read(h.xsrfCookieName):void 0;Tr&&(I[h.xsrfHeaderName]=Tr)}"setRequestHeader"in H&&r.forEach(I,function(T,N){typeof L>"u"&&N.toLowerCase()==="content-type"?delete I[N]:H.setRequestHeader(N,T)}),r.isUndefined(h.withCredentials)||(H.withCredentials=!!h.withCredentials),S&&S!=="json"&&(H.responseType=h.responseType),typeof h.onDownloadProgress=="function"&&H.addEventListener("progress",h.onDownloadProgress),typeof h.onUploadProgress=="function"&&H.upload&&H.upload.addEventListener("progress",h.onUploadProgress),(h.cancelToken||h.signal)&&(v=function(f){H&&(_(!f||f&&f.type?new l("canceled"):f),H.abort(),H=null)},h.cancelToken&&h.cancelToken.subscribe(v),h.signal&&(h.signal.aborted?v():h.signal.addEventListener("abort",v))),L||(L=null),H.send(L)})},Fn}var dt=Rt,Ys=Su,Lu=wa,Cu=Aa,Mu={"Content-Type":"application/x-www-form-urlencoded"};function Zs(r,t){!dt.isUndefined(r)&&dt.isUndefined(r["Content-Type"])&&(r["Content-Type"]=t)}function Du(){var r;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(r=Ws()),r}function ku(r,t,e){if(dt.isString(r))try{return(t||JSON.parse)(r),dt.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(e||JSON.stringify)(r)}var Pn={transitional:Cu,adapter:Du(),transformRequest:[function(t,e){return Ys(e,"Accept"),Ys(e,"Content-Type"),dt.isFormData(t)||dt.isArrayBuffer(t)||dt.isBuffer(t)||dt.isStream(t)||dt.isFile(t)||dt.isBlob(t)?t:dt.isArrayBufferView(t)?t.buffer:dt.isURLSearchParams(t)?(Zs(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):dt.isObject(t)||e&&e["Content-Type"]==="application/json"?(Zs(e,"application/json"),ku(t)):t}],transformResponse:[function(t){var e=this.transitional||Pn.transitional,n=e&&e.silentJSONParsing,i=e&&e.forcedJSONParsing,s=!n&&this.responseType==="json";if(s||i&&dt.isString(t)&&t.length)try{return JSON.parse(t)}catch(o){if(s)throw o.name==="SyntaxError"?Lu(o,this,"E_JSON_PARSE"):o}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};dt.forEach(["delete","get","head"],function(t){Pn.headers[t]={}});dt.forEach(["post","put","patch"],function(t){Pn.headers[t]=dt.merge(Mu)});var Bi=Pn,Bu=Rt,Hu=Bi,$u=function(t,e,n){var i=this||Hu;return Bu.forEach(n,function(o){t=o.call(i,t,e)}),t},zn,Js;function Ra(){return Js||(Js=1,zn=function(t){return!!(t&&t.__CANCEL__)}),zn}var Xs=Rt,qn=$u,ju=Ra(),Vu=Bi,Uu=On();function Wn(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Uu("canceled")}var Gu=function(t){Wn(t),t.headers=t.headers||{},t.data=qn.call(t,t.data,t.headers,t.transformRequest),t.headers=Xs.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),Xs.forEach(["delete","get","head","post","put","patch","common"],function(i){delete t.headers[i]});var e=t.adapter||Vu.adapter;return e(t).then(function(i){return Wn(t),i.data=qn.call(t,i.data,i.headers,t.transformResponse),i},function(i){return ju(i)||(Wn(t),i&&i.response&&(i.response.data=qn.call(t,i.response.data,i.response.headers,t.transformResponse))),Promise.reject(i)})},Tt=Rt,Oa=function(t,e){e=e||{};var n={};function i(p,h){return Tt.isPlainObject(p)&&Tt.isPlainObject(h)?Tt.merge(p,h):Tt.isPlainObject(h)?Tt.merge({},h):Tt.isArray(h)?h.slice():h}function s(p){if(Tt.isUndefined(e[p])){if(!Tt.isUndefined(t[p]))return i(void 0,t[p])}else return i(t[p],e[p])}function o(p){if(!Tt.isUndefined(e[p]))return i(void 0,e[p])}function a(p){if(Tt.isUndefined(e[p])){if(!Tt.isUndefined(t[p]))return i(void 0,t[p])}else return i(void 0,e[p])}function c(p){if(p in e)return i(t[p],e[p]);if(p in t)return i(void 0,t[p])}var l={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return Tt.forEach(Object.keys(t).concat(Object.keys(e)),function(h){var b=l[h]||s,E=b(h);Tt.isUndefined(E)&&b!==c||(n[h]=E)}),n},Yn,Qs;function Pa(){return Qs||(Qs=1,Yn={version:"0.26.1"}),Yn}var Ku=Pa().version,Hi={};["object","boolean","number","function","string","symbol"].forEach(function(r,t){Hi[r]=function(n){return typeof n===r||"a"+(t<1?"n ":" ")+r}});var to={};Hi.transitional=function(t,e,n){function i(s,o){return"[Axios v"+Ku+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return function(s,o,a){if(t===!1)throw new Error(i(o," has been removed"+(e?" in "+e:"")));return e&&!to[o]&&(to[o]=!0,console.warn(i(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,o,a):!0}};function Fu(r,t,e){if(typeof r!="object")throw new TypeError("options must be an object");for(var n=Object.keys(r),i=n.length;i-- >0;){var s=n[i],o=t[s];if(o){var a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new TypeError("option "+s+" must be "+c);continue}if(e!==!0)throw Error("Unknown option "+s)}}var zu={assertOptions:Fu,validators:Hi},Ta=Rt,qu=_a,eo=wu,ro=Gu,Tn=Oa,Ia=zu,sr=Ia.validators;function Hr(r){this.defaults=r,this.interceptors={request:new eo,response:new eo}}Hr.prototype.request=function(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Tn(this.defaults,e),e.method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var n=e.transitional;n!==void 0&&Ia.assertOptions(n,{silentJSONParsing:sr.transitional(sr.boolean),forcedJSONParsing:sr.transitional(sr.boolean),clarifyTimeoutError:sr.transitional(sr.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(e)===!1||(s=s&&E.synchronous,i.unshift(E.fulfilled,E.rejected))});var o=[];this.interceptors.response.forEach(function(E){o.push(E.fulfilled,E.rejected)});var a;if(!s){var c=[ro,void 0];for(Array.prototype.unshift.apply(c,i),c=c.concat(o),a=Promise.resolve(e);c.length;)a=a.then(c.shift(),c.shift());return a}for(var l=e;i.length;){var p=i.shift(),h=i.shift();try{l=p(l)}catch(b){h(b);break}}try{a=ro(l)}catch(b){return Promise.reject(b)}for(;o.length;)a=a.then(o.shift(),o.shift());return a};Hr.prototype.getUri=function(t){return t=Tn(this.defaults,t),qu(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")};Ta.forEach(["delete","get","head","options"],function(t){Hr.prototype[t]=function(e,n){return this.request(Tn(n||{},{method:t,url:e,data:(n||{}).data}))}});Ta.forEach(["post","put","patch"],function(t){Hr.prototype[t]=function(e,n,i){return this.request(Tn(i||{},{method:t,url:e,data:n}))}});var Wu=Hr,Zn,no;function Yu(){if(no)return Zn;no=1;var r=On();function t(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var n;this.promise=new Promise(function(o){n=o});var i=this;this.promise.then(function(s){if(i._listeners){var o,a=i._listeners.length;for(o=0;o<a;o++)i._listeners[o](s);i._listeners=null}}),this.promise.then=function(s){var o,a=new Promise(function(c){i.subscribe(c),o=c}).then(s);return a.cancel=function(){i.unsubscribe(o)},a},e(function(o){i.reason||(i.reason=new r(o),n(i.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]},t.prototype.unsubscribe=function(n){if(this._listeners){var i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}},t.source=function(){var n,i=new t(function(o){n=o});return{token:i,cancel:n}},Zn=t,Zn}var Jn,io;function Zu(){return io||(io=1,Jn=function(t){return function(n){return t.apply(null,n)}}),Jn}var Xn,so;function Ju(){if(so)return Xn;so=1;var r=Rt;return Xn=function(e){return r.isObject(e)&&e.isAxiosError===!0},Xn}var oo=Rt,Xu=ya,on=Wu,Qu=Oa,tl=Bi;function Na(r){var t=new on(r),e=Xu(on.prototype.request,t);return oo.extend(e,on.prototype,t),oo.extend(e,t),e.create=function(i){return Na(Qu(r,i))},e}var de=Na(tl);de.Axios=on;de.Cancel=On();de.CancelToken=Yu();de.isCancel=Ra();de.VERSION=Pa().version;de.all=function(t){return Promise.all(t)};de.spread=Zu();de.isAxiosError=Ju();Mi.exports=de;Mi.exports.default=de;var el=Mi.exports,rl=el;const ao=ca(rl);function $i(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(p){try{l(n.next(p))}catch(h){o(h)}}function c(p){try{l(n.throw(p))}catch(h){o(h)}}function l(p){p.done?s(p.value):i(p.value).then(a,c)}l((n=n.apply(r,t||[])).next())})}const nl=require("axios/lib/core/settle"),il=require("axios/lib/helpers/buildURL"),sl=require("axios/lib/core/buildFullPath"),{isUndefined:ol,isStandardBrowserEnv:al,isFormData:cl}=require("axios/lib/utils");function ul(r){return $i(this,void 0,void 0,function*(){const t=hl(r),e=[ll(t,r)];r.timeout&&r.timeout>0&&e.push(new Promise(i=>{setTimeout(()=>{const s=r.timeoutErrorMessage?r.timeoutErrorMessage:"timeout of "+r.timeout+"ms exceeded";i(fi(s,r,"ECONNABORTED",t))},r.timeout)}));const n=yield Promise.race(e);return new Promise((i,s)=>{if(n instanceof Error)s(n);else{const o=r;"settle"in o&&Object.prototype.toString.call(o.settle)==="[object Function]"?o.settle(i,s,n):nl(i,s,n)}})})}function ll(r,t){return $i(this,void 0,void 0,function*(){try{const e=yield fetch(r);let n={ok:e.ok,status:e.status,statusText:e.statusText,headers:new Headers(e.headers),config:t,request:r};if(e.status>=400)return fi("Response Error",t,"ERR_NETWORK",r,n);if(n={ok:e.ok,status:e.status,statusText:e.statusText,headers:new Headers(e.headers),config:t,request:r},e.status>=200&&e.status!==204)switch(t.responseType){case"arraybuffer":n.data=yield e.arrayBuffer();break;case"blob":n.data=yield e.blob();break;case"json":n.data=yield e.json();break;default:n.data=yield e.text();break}return n}catch{return fi("Network Error",t,"ERR_NETWORK",r)}})}function hl(r){var t;const e=new Headers(r.headers);if(r.auth){const c=r.auth.username||"",l=r.auth.password?decodeURI(encodeURIComponent(r.auth.password)):"";e.set("Authorization",`Basic ${btoa(c+":"+l)}`)}const n=(t=r.method)===null||t===void 0?void 0:t.toUpperCase(),i={headers:e,method:n};n!=="GET"&&n!=="HEAD"&&(i.body=r.data,cl(i.body)&&al()&&e.delete("Content-Type"));const s=r;"mode"in s&&(i.mode=s.mode),"cache"in s&&(i.cache=s.cache),"integrity"in s&&(i.integrity=s.integrity),"redirect"in s&&(i.redirect=s.redirect),"referrer"in s&&(i.referrer=s.referrer),ol(s.withCredentials)||(i.credentials=s.withCredentials?"include":"omit");const o=sl(s.baseURL,s.url),a=il(o,s.params,s.paramsSerializer);return new Request(a,i)}function fi(r,t,e,n,i){const s=new Error(r);return dl(s,t,e,n,i)}function dl(r,t,e,n,i){return r.config=t,e&&(r.code=e),r.request=n,r.response=i,r.isAxiosError=!0,r.toJSON=function(){return{message:this.message,name:this.name,description:"description"in this?this.description:void 0,number:"number"in this?this.number:void 0,fileName:"fileName"in this?this.fileName:void 0,lineNumber:"lineNumber"in this?this.lineNumber:void 0,columnNumber:"columnNumber"in this?this.columnNumber:void 0,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},r}class pl extends ua{constructor(t,e,n){super(),this.method=t,this.url=e,this.cause=n,this.name="HttpRequestFailed",this.message=`${t} ${e} ${String(n)}`}}class wr extends ua{constructor(t,e,n,i,s){super(t),this.message=t,this.status=e,this.statusText=n,this.body=i,this.url=s,this.name="HttpResponse"}}var Cr;(function(r){r[r.CONTINUE=100]="CONTINUE",r[r.SWITCHING_PROTOCOLS=101]="SWITCHING_PROTOCOLS",r[r.PROCESSING=102]="PROCESSING",r[r.OK=200]="OK",r[r.CREATED=201]="CREATED",r[r.ACCEPTED=202]="ACCEPTED",r[r.NON_AUTHORITATIVE_INFORMATION=203]="NON_AUTHORITATIVE_INFORMATION",r[r.NO_CONTENT=204]="NO_CONTENT",r[r.RESET_CONTENT=205]="RESET_CONTENT",r[r.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",r[r.MULTI_STATUS=207]="MULTI_STATUS",r[r.ALREADY_REPORTED=208]="ALREADY_REPORTED",r[r.IM_USED=226]="IM_USED",r[r.MULTIPLE_CHOICES=300]="MULTIPLE_CHOICES",r[r.MOVED_PERMANENTLY=301]="MOVED_PERMANENTLY",r[r.FOUND=302]="FOUND",r[r.SEE_OTHER=303]="SEE_OTHER",r[r.NOT_MODIFIED=304]="NOT_MODIFIED",r[r.USE_PROXY=305]="USE_PROXY",r[r.SWITCH_PROXY=306]="SWITCH_PROXY",r[r.TEMPORARY_REDIRECT=307]="TEMPORARY_REDIRECT",r[r.PERMANENT_REDIRECT=308]="PERMANENT_REDIRECT",r[r.BAD_REQUEST=400]="BAD_REQUEST",r[r.UNAUTHORIZED=401]="UNAUTHORIZED",r[r.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",r[r.FORBIDDEN=403]="FORBIDDEN",r[r.NOT_FOUND=404]="NOT_FOUND",r[r.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",r[r.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",r[r.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",r[r.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",r[r.CONFLICT=409]="CONFLICT",r[r.GONE=410]="GONE",r[r.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",r[r.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",r[r.PAYLOAD_TOO_LARGE=413]="PAYLOAD_TOO_LARGE",r[r.URI_TOO_LONG=414]="URI_TOO_LONG",r[r.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",r[r.RANGE_NOT_SATISFIABLE=416]="RANGE_NOT_SATISFIABLE",r[r.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",r[r.I_AM_A_TEAPOT=418]="I_AM_A_TEAPOT",r[r.MISDIRECTED_REQUEST=421]="MISDIRECTED_REQUEST",r[r.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",r[r.LOCKED=423]="LOCKED",r[r.FAILED_DEPENDENCY=424]="FAILED_DEPENDENCY",r[r.UPGRADE_REQUIRED=426]="UPGRADE_REQUIRED",r[r.PRECONDITION_REQUIRED=428]="PRECONDITION_REQUIRED",r[r.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",r[r.REQUEST_HEADER_FIELDS_TOO_LARGE=431]="REQUEST_HEADER_FIELDS_TOO_LARGE",r[r.UNAVAILABLE_FOR_LEGAL_REASONS=451]="UNAVAILABLE_FOR_LEGAL_REASONS",r[r.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",r[r.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",r[r.BAD_GATEWAY=502]="BAD_GATEWAY",r[r.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",r[r.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",r[r.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED",r[r.VARIANT_ALSO_NEGOTIATES=506]="VARIANT_ALSO_NEGOTIATES",r[r.INSUFFICIENT_STORAGE=507]="INSUFFICIENT_STORAGE",r[r.LOOP_DETECTED=508]="LOOP_DETECTED",r[r.NOT_EXTENDED=510]="NOT_EXTENDED",r[r.NETWORK_AUTHENTICATION_REQUIRED=511]="NETWORK_AUTHENTICATION_REQUIRED"})(Cr||(Cr={}));var Qn;const xa=typeof process<"u"&&!!(!((Qn=process==null?void 0:process.versions)===null||Qn===void 0)&&Qn.node),fl=xa?void 0:ul;var hn;(function(r){r.TEXT="text",r.JSON="json"})(hn||(hn={}));class gl{constructor(t=3e4){this.timeout=t}serialize(t){if(!t)return"";const e=[];for(const i in t)if(t.hasOwnProperty(i)&&typeof t[i]<"u"){const s=typeof t[i].toJSON=="function"?t[i].toJSON():t[i];if(s===null){e.push(encodeURIComponent(i));continue}if(Array.isArray(s)){s.forEach(o=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(o))});continue}e.push(encodeURIComponent(i)+"="+encodeURIComponent(s))}const n=e.join("&");return n?`?${n}`:""}createRequest({url:t,method:e,timeout:n=this.timeout,query:i,headers:s={},json:o=!0},a){return $i(this,void 0,void 0,function*(){const c=t+this.serialize(i);let l,p;s["Content-Type"]||(s["Content-Type"]="application/json"),o?l=hn.JSON:(l=hn.TEXT,p=[h=>h]);try{return(yield ao.request({url:c,method:e??"GET",headers:s,responseType:l,transformResponse:p,timeout:n,data:a,adapter:fl})).data}catch(h){if(ao.isAxiosError(h)&&h.response||!xa&&h.response){let b;throw typeof h.response.data=="object"?b=JSON.stringify(h.response.data):b=h.response.data,new wr(`Http error response: (${h.response.status}) ${b}`,h.response.status,h.response.statusText,b,c)}else throw new pl(String(e),c,h)}})}}function Wr(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(e[n[i]]=r[n[i]]);return e}function C(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(p){try{l(n.next(p))}catch(h){o(h)}}function c(p){try{l(n.throw(p))}catch(h){o(h)}}function l(p){p.done?s(p.value):i(p.value).then(a,c)}l((n=n.apply(r,t||[])).next())})}const ml="main",D={block:"head"};var co;(function(r){r.GET_BAKING_RIGHTS="getBakingRights",r.GET_BALLOTS="getBallots",r.GET_BALLOT_LIST="getBallotList",r.GET_BIG_MAP_KEY="getBigMapKey",r.GET_BIG_MAP_EXPR="getBigMapExpr",r.GET_BLOCK_HASH="getBlockHash",r.GET_BLOCK="getBlock",r.GET_BLOCK_HEADER="getBlockHeader",r.GET_BLOCK_METADATA="getBlockMetadata",r.GET_BALANCE="getBalance",r.GET_CHAIN_ID="getChainId",r.GET_CONSTANTS="getConstants",r.GET_CONTRACT="getContract",r.GET_CURRENT_PERIOD="getCurrentPeriod",r.GET_CURRENT_PROPOSAL="getCurrentProposal",r.GET_CURRENT_QUORUM="getCurrentQuorum",r.GET_DELEGATE="getDelegate",r.GET_DELEGATES="getDelegates",r.GET_VOTING_INFO="getVotingInfo",r.GET_ENDORSING_RIGHTS="getEndorsingRights",r.GET_ENTRYPOINTS="getEntrypoints",r.GET_LIVE_BLOCKS="getLiveBlocks",r.GET_MANAGER_KEY="getManagerKey",r.GET_NORMALIZED_SCRIPT="getNormalizedScript",r.GET_PROPOSALS="getProposals",r.GET_PROTOCOLS="getProtocols",r.GET_SAPLING_DIFF_BY_CONTRACT="getSaplingDiffByContract",r.GET_SAPLING_DIFF_BY_ID="getSaplingDiffById",r.GET_SCRIPT="getScript",r.GET_STORAGE="getStorage",r.GET_SUCCESSOR_PERIOD="getSuccessorPeriod",r.GET_TX_ROLLUP_INBOX="getTxRollupInbox",r.GET_TX_ROLLUP_STATE="getTxRollupState",r.GET_VOTES_LISTINGS="getVotesListings",r.PACK_DATA="packData",r.GET_STORAGE_USED_SPACE="getStorageUsedSpace",r.GET_STORAGE_PAID_SPACE="getStoragePaidSpace",r.GET_TICKET_BALANCE="getTicketBalance",r.GET_ALL_TICKET_BALANCES="getAllTicketBalances",r.GET_PENDING_OPERATIONS="getPendingOperations",r.GET_ORIGINATION_PROOF="getOriginationProof"})(co||(co={}));function Nr(r,t){const e=Array.isArray(r);typeof t>"u"&&(t=Object.keys(r));const n=e?[]:{};return t.forEach(i=>{const s=r[i];let o;if(!(typeof s>"u")){if(Array.isArray(s)){o=Nr(s),n[i]=o;return}o=new P(s),n[i]=o}}),n}var uo;(function(r){r.TOO_LARGE="too large"})(uo||(uo={}));var lo;(function(r){r.BAKING_REWARDS="baking rewards",r.REWARDS="rewards",r.FEES="fees",r.DEPOSITS="deposits",r.LEGACY_REWARDS="legacy_rewards",r.LEGACY_FEES="legacy_fees",r.LEGACY_DEPOSITS="legacy_deposits",r.BLOCK_FEES="block fees",r.NONCE_REVELATION_REWARDS="nonce revelation rewards",r.DOUBLE_SIGNING_EVIDENCE_REWARDS="double signing evidence rewards",r.ENDORSING_REWARDS="endorsing rewards",r.BAKING_BONUSES="baking bonuses",r.STORAGE_FEES="storage fees",r.PUNISHMENTS="punishments",r.LOST_ENDORSING_REWARDS="lost endorsing rewards",r.SUBSIDY="subsidy",r.BURNED="burned",r.COMMITMENT="commitment",r.BOOTSTRAP="bootstrap",r.INVOICE="invoice",r.MINTED="minted",r.TX_ROLLUP_REJECTION_REWARDS="tx_rollup_rejection_rewards",r.TX_ROLLUP_REJECTION_PUNISHMENTS="tx_rollup_rejection_punishments",r.BONDS="bonds"})(lo||(lo={}));var ho;(function(r){r.WASM2="wasm_2_0_0",r.ARITH="arith"})(ho||(ho={}));var po;(function(r){r.START="start",r.MOVE="move"})(po||(po={}));var fo;(function(r){r.INBOX_PROOF="inbox_proof",r.REVEAL_PROOF="reveal_proof",r.FIRST_INPUT="first_input"})(fo||(fo={}));var go;(function(r){r.RAW_DATA_PROOF="raw_data_proof",r.METADATA_PROOF="metadata_proof",r.DAL_PAGE_PROOF="dal_page_proof"})(go||(go={}));var mo;(function(r){r.ONGOING="ongoing",r.ENDED="ended"})(mo||(mo={}));var yo;(function(r){r.LOSER="loser",r.DRAW="draw"})(yo||(yo={}));var bo;(function(r){r.CONFLICT_RESOLVED="conflict_resolved",r.TIMEOUT="timeout"})(bo||(bo={}));var y;(function(r){r.ORIGINATION="origination",r.DELEGATION="delegation",r.REVEAL="reveal",r.TRANSACTION="transaction",r.ACTIVATION="activate_account",r.ENDORSEMENT="endorsement",r.PREENDORSEMENT="preendorsement",r.SET_DEPOSITS_LIMIT="set_deposits_limit",r.DOUBLE_PREENDORSEMENT_EVIDENCE="double_preendorsement_evidence",r.ENDORSEMENT_WITH_SLOT="endorsement_with_slot",r.SEED_NONCE_REVELATION="seed_nonce_revelation",r.DOUBLE_ENDORSEMENT_EVIDENCE="double_endorsement_evidence",r.DOUBLE_BAKING_EVIDENCE="double_baking_evidence",r.PROPOSALS="proposals",r.BALLOT="ballot",r.FAILING_NOOP="failing_noop",r.REGISTER_GLOBAL_CONSTANT="register_global_constant",r.TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.TX_ROLLUP_COMMIT="tx_rollup_commit",r.TX_ROLLUP_RETURN_BOND="tx_rollup_return_bond",r.TX_ROLLUP_FINALIZE_COMMITMENT="tx_rollup_finalize_commitment",r.TX_ROLLUP_REMOVE_COMMITMENT="tx_rollup_remove_commitment",r.TX_ROLLUP_REJECTION="tx_rollup_rejection",r.TX_ROLLUP_DISPATCH_TICKETS="tx_rollup_dispatch_tickets",r.TRANSFER_TICKET="transfer_ticket",r.INCREASE_PAID_STORAGE="increase_paid_storage",r.UPDATE_CONSENSUS_KEY="update_consensus_key",r.DRAIN_DELEGATE="drain_delegate",r.VDF_REVELATION="vdf_revelation",r.EVENT="event",r.TICKET_UPDATES="ticket_updates",r.SMART_ROLLUP_ORIGINATE="smart_rollup_originate",r.SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",r.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message",r.SMART_ROLLUP_PUBLISH="smart_rollup_publish",r.SMART_ROLLUP_CEMENT="smart_rollup_cement",r.SMART_ROLLUP_RECOVER_BOND="smart_rollup_recover_bond",r.SMART_ROLLUP_REFUTE="smart_rollup_refute",r.SMART_ROLLUP_TIMEOUT="smart_rollup_timeout"})(y||(y={}));class an{constructor(t,e=ml,n=new gl){this.url=t,this.chain=e,this.httpBackend=n}createURL(t){return`${this.url.replace(/\/+$/g,"")}${t}`}validateAddress(t){const e=F(t);if(e!==O.VALID)throw new W(t,M(e))}validateContract(t){const e=hr(t);if(e!==O.VALID)throw new Qe(t,M(e))}getBlockHash({block:t}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/hash`),method:"GET"})})}getLiveBlocks({block:t}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/live_blocks`),method:"GET"})})}getBalance(t,{block:e}=D){return C(this,void 0,void 0,function*(){this.validateAddress(t);const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/balance`),method:"GET"});return new P(n)})}getStorage(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage`),method:"GET"})})}getScript(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/script`),method:"GET"})})}getNormalizedScript(t,e={unparsing_mode:"Readable"},{block:n}=D){return C(this,void 0,void 0,function*(){return this.validateContract(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${t}/script/normalized`),method:"POST"},e)})}getContract(t,{block:e}=D){return C(this,void 0,void 0,function*(){this.validateAddress(t);const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}`),method:"GET"});return Object.assign(Object.assign({},n),{balance:new P(n.balance)})})}getManagerKey(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/manager_key`),method:"GET"})})}getDelegate(t,{block:e}=D){return C(this,void 0,void 0,function*(){this.validateAddress(t);let n;try{n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/delegate`),method:"GET"})}catch(i){if(i instanceof wr&&i.status===Cr.NOT_FOUND)n=null;else throw i}return n})}getBigMapKey(t,e,{block:n}=D){return C(this,void 0,void 0,function*(){return this.validateAddress(t),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${t}/big_map_get`),method:"POST"},e)})}getBigMapExpr(t,e,{block:n}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/big_maps/${t}/${e}`),method:"GET"})})}getDelegates(t,{block:e}=D){return C(this,void 0,void 0,function*(){this.validateAddress(t);const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}`),method:"GET"}),i=Nr(n,["balance","full_balance","current_frozen_deposits","frozen_deposits","frozen_balance","frozen_deposits_limit","staking_balance","delegated_balance","voting_power"]);return Object.assign(Object.assign(Object.assign({},n),i),{frozen_balance_by_cycle:n.frozen_balance_by_cycle?n.frozen_balance_by_cycle.map(s=>{var{deposit:o,deposits:a,fees:c,rewards:l}=s,p=Wr(s,["deposit","deposits","fees","rewards"]);const h=Nr({deposit:o,deposits:a,fees:c,rewards:l},["deposit","deposits","fees","rewards"]);return Object.assign(Object.assign({},p),{deposit:h.deposit,deposits:h.deposits,fees:h.fees,rewards:h.rewards})}):void 0})})}getVotingInfo(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.validateAddress(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/delegates/${t}/voting_info`),method:"GET"})})}getConstants({block:t}=D){return C(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/context/constants`),method:"GET"}),n=Nr(e,["time_between_blocks","hard_gas_limit_per_operation","hard_gas_limit_per_block","proof_of_work_threshold","tokens_per_roll","seed_nonce_revelation_tip","block_security_deposit","endorsement_security_deposit","block_reward","endorsement_reward","cost_per_byte","hard_storage_limit_per_operation","test_chain_duration","baking_reward_per_endorsement","delay_per_missing_endorsement","minimal_block_delay","liquidity_baking_subsidy","cache_layout","baking_reward_fixed_portion","baking_reward_bonus_per_slot","endorsing_reward_per_slot","double_baking_punishment","delay_increment_per_round","tx_rollup_commitment_bond","vdf_difficulty","sc_rollup_stake_amount","minimal_stake"]);return Object.assign(Object.assign({},e),n)})}getBlock({block:t}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}`),method:"GET"})})}getBlockHeader({block:t}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/header`),method:"GET"})})}getBlockMetadata({block:t}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/metadata`),method:"GET"})})}getBakingRights(t={},{block:e}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/baking_rights`),method:"GET",query:t})})}getEndorsingRights(t={},{block:e}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/endorsing_rights`),method:"GET",query:t})})}getBallotList({block:t}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballot_list`),method:"GET"})})}getBallots({block:t}=D){return C(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballots`),method:"GET"});return Nr(e,["yay","nay","pass"])})}getCurrentProposal({block:t}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_proposal`),method:"GET"})})}getCurrentQuorum({block:t}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_quorum`),method:"GET"})})}getVotesListings({block:t}=D){return C(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/listings`),method:"GET"});return e.map(n=>(n.voting_power&&(n.voting_power=new P(n.voting_power)),n)),e})}getProposals({block:t}=D){return C(this,void 0,void 0,function*(){const e=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/proposals`),method:"GET"});return e.map(n=>n[1]=new P(n[1])),e})}forgeOperations(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/forge/operations`),method:"POST"},t)})}injectOperation(t){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL("/injection/operation"),method:"POST"},t)})}preapplyOperations(t,{block:e}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/preapply/operations`),method:"POST"},t)})}getEntrypoints(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.validateContract(t),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/entrypoints`),method:"GET"})})}runOperation(t,{block:e}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_operation`),method:"POST"},t)})}runCode(t,{block:e}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_code`),method:"POST"},t)})}runScriptView(t,{block:e}=D){var{unparsing_mode:n="Readable"}=t,i=Wr(t,["unparsing_mode"]);return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_script_view`),method:"POST"},Object.assign({unparsing_mode:n},i))})}runView(t,{block:e}=D){var{unparsing_mode:n="Readable"}=t,i=Wr(t,["unparsing_mode"]);return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/run_view`),method:"POST"},Object.assign({unparsing_mode:n},i))})}getChainId(){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/chain_id`),method:"GET"})})}packData(t,{block:e}=D){return C(this,void 0,void 0,function*(){const n=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/helpers/scripts/pack_data`),method:"POST"},t),{gas:i}=n,s=Wr(n,["gas"]);let o=i;const a=new P(i||"");return a.isNaN()||(o=a),Object.assign({gas:o},s)})}getRpcUrl(){return this.url}getCurrentPeriod({block:t}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_period`),method:"GET"})})}getSuccessorPeriod({block:t}=D){return C(this,void 0,void 0,function*(){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/successor_period`),method:"GET"})})}getSaplingDiffById(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/sapling/${t}/get_diff`),method:"GET"})})}getSaplingDiffByContract(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/single_sapling_get_diff`),method:"GET"})})}getProtocols({block:t}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/protocols`),method:"GET"})})}getTxRollupState(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/tx_rollup/${t}/state`),method:"GET"})})}getTxRollupInbox(t,e,{block:n}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/tx_rollup/${t}/inbox/${e}`),method:"GET"})})}getStorageUsedSpace(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage/used_space`),method:"GET"})})}getStoragePaidSpace(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/storage/paid_space`),method:"GET"})})}getTicketBalance(t,e,{block:n}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${t}/ticket_balance`),method:"POST"},e)})}getAllTicketBalances(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/contracts/${t}/all_ticket_balances`),method:"GET"})})}getPendingOperations(t={}){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/mempool/pending_operations`),method:"GET",query:t})})}getOriginationProof(t,{block:e}=D){return C(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${e}/context/smart_rollups/all/origination_proof`),method:"POST"},t)})}}function dn(r){return typeof r=="function"}var Eo=!1,ie={Promise:void 0,set useDeprecatedSynchronousErrorHandling(r){if(r){var t=new Error;""+t.stack}Eo=r},get useDeprecatedSynchronousErrorHandling(){return Eo}};function ar(r){setTimeout(function(){throw r},0)}var pn={closed:!0,next:function(r){},error:function(r){if(ie.useDeprecatedSynchronousErrorHandling)throw r;ar(r)},complete:function(){}},ji=function(){return Array.isArray||function(r){return r&&typeof r.length=="number"}}();function La(r){return r!==null&&typeof r=="object"}var yl=function(){function r(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(e,n){return n+1+") "+e.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return r.prototype=Object.create(Error.prototype),r}(),cn=yl,Dt=function(){function r(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return r.prototype.unsubscribe=function(){var t;if(!this.closed){var e=this,n=e._parentOrParents,i=e._ctorUnsubscribe,s=e._unsubscribe,o=e._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof r)n.remove(this);else if(n!==null)for(var a=0;a<n.length;++a){var c=n[a];c.remove(this)}if(dn(s)){i&&(this._unsubscribe=void 0);try{s.call(this)}catch(h){t=h instanceof cn?vo(h.errors):[h]}}if(ji(o))for(var a=-1,l=o.length;++a<l;){var p=o[a];if(La(p))try{p.unsubscribe()}catch(b){t=t||[],b instanceof cn?t=t.concat(vo(b.errors)):t.push(b)}}if(t)throw new cn(t)}},r.prototype.add=function(t){var e=t;if(!t)return r.EMPTY;switch(typeof t){case"function":e=new r(t);case"object":if(e===this||e.closed||typeof e.unsubscribe!="function")return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof r)){var n=e;e=new r,e._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=e._parentOrParents;if(i===null)e._parentOrParents=this;else if(i instanceof r){if(i===this)return e;e._parentOrParents=[i,this]}else if(i.indexOf(this)===-1)i.push(this);else return e;var s=this._subscriptions;return s===null?this._subscriptions=[e]:s.push(e),e},r.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);n!==-1&&e.splice(n,1)}},r.EMPTY=function(t){return t.closed=!0,t}(new r),r}();function vo(r){return r.reduce(function(t,e){return t.concat(e instanceof cn?e.errors:e)},[])}var fn=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),rt=function(r){V(t,r);function t(e,n,i){var s=r.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=pn;break;case 1:if(!e){s.destination=pn;break}if(typeof e=="object"){e instanceof t?(s.syncErrorThrowable=e.syncErrorThrowable,s.destination=e,e.add(s)):(s.syncErrorThrowable=!0,s.destination=new _o(s,e));break}default:s.syncErrorThrowable=!0,s.destination=new _o(s,e,n,i);break}return s}return t.prototype[fn]=function(){return this},t.create=function(e,n,i){var s=new t(e,n,i);return s.syncErrorThrowable=!1,s},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(Dt),_o=function(r){V(t,r);function t(e,n,i,s){var o=r.call(this)||this;o._parentSubscriber=e;var a,c=o;return dn(n)?a=n:n&&(a=n.next,i=n.error,s=n.complete,n!==pn&&(c=Object.create(n),dn(c.unsubscribe)&&o.add(c.unsubscribe.bind(c)),c.unsubscribe=o.unsubscribe.bind(o))),o._context=c,o._next=a,o._error=i,o._complete=s,o}return t.prototype.next=function(e){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!ie.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,e):this.__tryOrSetError(n,this._next,e)&&this.unsubscribe()}},t.prototype.error=function(e){if(!this.isStopped){var n=this._parentSubscriber,i=ie.useDeprecatedSynchronousErrorHandling;if(this._error)!i||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,e),this.unsubscribe()):(this.__tryOrSetError(n,this._error,e),this.unsubscribe());else if(n.syncErrorThrowable)i?(n.syncErrorValue=e,n.syncErrorThrown=!0):ar(e),this.unsubscribe();else{if(this.unsubscribe(),i)throw e;ar(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var i=function(){return e._complete.call(e._context)};!ie.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(i),this.unsubscribe()):(this.__tryOrSetError(n,i),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,n){try{e.call(this._context,n)}catch(i){if(this.unsubscribe(),ie.useDeprecatedSynchronousErrorHandling)throw i;ar(i)}},t.prototype.__tryOrSetError=function(e,n,i){if(!ie.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,i)}catch(s){return ie.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=s,e.syncErrorThrown=!0,!0):(ar(s),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(rt);function bl(r){for(;r;){var t=r,e=t.closed,n=t.destination,i=t.isStopped;if(e||i)return!1;n&&n instanceof rt?r=n:r=null}return!0}function El(r,t,e){if(r){if(r instanceof rt)return r;if(r[fn])return r[fn]()}return!r&&!t&&!e?new rt(pn):new rt(r,t,e)}var $r=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Vi(r){return r}function vl(r){return r.length===0?Vi:r.length===1?r[0]:function(e){return r.reduce(function(n,i){return i(n)},e)}}var Q=function(){function r(t){this._isScalar=!1,t&&(this._subscribe=t)}return r.prototype.lift=function(t){var e=new r;return e.source=this,e.operator=t,e},r.prototype.subscribe=function(t,e,n){var i=this.operator,s=El(t,e,n);if(i?s.add(i.call(s,this.source)):s.add(this.source||ie.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),ie.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},r.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){ie.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),bl(t)?t.error(e):console.warn(e)}},r.prototype.forEach=function(t,e){var n=this;return e=wo(e),new e(function(i,s){var o;o=n.subscribe(function(a){try{t(a)}catch(c){s(c),o&&o.unsubscribe()}},s,i)})},r.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},r.prototype[$r]=function(){return this},r.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length===0?this:vl(t)(this)},r.prototype.toPromise=function(t){var e=this;return t=wo(t),new t(function(n,i){var s;e.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},r.create=function(t){return new r(t)},r}();function wo(r){if(r||(r=Promise),!r)throw new Error("no Promise impl found");return r}var _l=function(){function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return r.prototype=Object.create(Error.prototype),r}(),We=_l,Ca=function(r){V(t,r);function t(e,n){var i=r.call(this)||this;return i.subject=e,i.subscriber=n,i.closed=!1,i}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,n=e.observers;if(this.subject=null,!(!n||n.length===0||e.isStopped||e.closed)){var i=n.indexOf(this.subscriber);i!==-1&&n.splice(i,1)}}},t}(Dt),Ma=function(r){V(t,r);function t(e){var n=r.call(this,e)||this;return n.destination=e,n}return t}(rt),gr=function(r){V(t,r);function t(){var e=r.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype[fn]=function(){return new Ma(this)},t.prototype.lift=function(e){var n=new Ao(this,this);return n.operator=e,n},t.prototype.next=function(e){if(this.closed)throw new We;if(!this.isStopped)for(var n=this.observers,i=n.length,s=n.slice(),o=0;o<i;o++)s[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new We;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var n=this.observers,i=n.length,s=n.slice(),o=0;o<i;o++)s[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new We;this.isStopped=!0;for(var e=this.observers,n=e.length,i=e.slice(),s=0;s<n;s++)i[s].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(e){if(this.closed)throw new We;return r.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){if(this.closed)throw new We;return this.hasError?(e.error(this.thrownError),Dt.EMPTY):this.isStopped?(e.complete(),Dt.EMPTY):(this.observers.push(e),new Ca(this,e))},t.prototype.asObservable=function(){var e=new Q;return e.source=this,e},t.create=function(e,n){return new Ao(e,n)},t}(Q),Ao=function(r){V(t,r);function t(e,n){var i=r.call(this)||this;return i.destination=e,i.source=n,i}return t.prototype.next=function(e){var n=this.destination;n&&n.next&&n.next(e)},t.prototype.error=function(e){var n=this.destination;n&&n.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){var n=this.source;return n?this.source.subscribe(e):Dt.EMPTY},t}(gr);function Mr(){return function(t){return t.lift(new wl(t))}}var wl=function(){function r(t){this.connectable=t}return r.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var i=new Al(t,n),s=e.subscribe(i);return i.closed||(i.connection=n.connect()),s},r}(),Al=function(r){V(t,r);function t(e,n){var i=r.call(this,e)||this;return i.connectable=n,i}return t.prototype._unsubscribe=function(){var e=this.connectable;if(!e){this.connection=null;return}this.connectable=null;var n=e._refCount;if(n<=0){this.connection=null;return}if(e._refCount=n-1,n>1){this.connection=null;return}var i=this.connection,s=e._connection;this.connection=null,s&&(!i||s===i)&&s.unsubscribe()},t}(rt),Sl=function(r){V(t,r);function t(e,n){var i=r.call(this)||this;return i.source=e,i.subjectFactory=n,i._refCount=0,i._isComplete=!1,i}return t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,e=this._connection=new Dt,e.add(this.source.subscribe(new Ol(this.getSubject(),this))),e.closed&&(this._connection=null,e=Dt.EMPTY)),e},t.prototype.refCount=function(){return Mr()(this)},t}(Q),Rl=function(){var r=Sl.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:r._subscribe},_isComplete:{value:r._isComplete,writable:!0},getSubject:{value:r.getSubject},connect:{value:r.connect},refCount:{value:r.refCount}}}(),Ol=function(r){V(t,r);function t(e,n){var i=r.call(this,e)||this;return i.connectable=n,i}return t.prototype._error=function(e){this._unsubscribe(),r.prototype._error.call(this,e)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),r.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var n=e._connection;e._refCount=0,e._subject=null,e._connection=null,n&&n.unsubscribe()}},t}(Ma),In=function(r){V(t,r);function t(e){var n=r.call(this)||this;return n._value=e,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(e){var n=r.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new We;return this._value},t.prototype.next=function(e){r.prototype.next.call(this,this._value=e)},t}(gr),Pl=function(r){V(t,r);function t(e,n){return r.call(this)||this}return t.prototype.schedule=function(e,n){return this},t}(Dt),Da=function(r){V(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return t.prototype.schedule=function(e,n){if(n===void 0&&(n=0),this.closed)return this;this.state=e;var i=this.id,s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(s,this.id,n),this},t.prototype.requestAsyncId=function(e,n,i){return i===void 0&&(i=0),setInterval(e.flush.bind(e,this),i)},t.prototype.recycleAsyncId=function(e,n,i){if(i===void 0&&(i=0),i!==null&&this.delay===i&&this.pending===!1)return n;clearInterval(n)},t.prototype.execute=function(e,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(e,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,n){var i=!1,s=void 0;try{this.work(e)}catch(o){i=!0,s=!!o&&o||new Error(o)}if(i)return this.unsubscribe(),s},t.prototype._unsubscribe=function(){var e=this.id,n=this.scheduler,i=n.actions,s=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,s!==-1&&i.splice(s,1),e!=null&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null},t}(Pl),Tl=function(r){V(t,r);function t(e,n){var i=r.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return t.prototype.schedule=function(e,n){return n===void 0&&(n=0),n>0?r.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},t.prototype.execute=function(e,n){return n>0||this.closed?r.prototype.execute.call(this,e,n):this._execute(e,n)},t.prototype.requestAsyncId=function(e,n,i){return i===void 0&&(i=0),i!==null&&i>0||i===null&&this.delay>0?r.prototype.requestAsyncId.call(this,e,n,i):e.flush(this)},t}(Da),So=function(){function r(t,e){e===void 0&&(e=r.now),this.SchedulerAction=t,this.now=e}return r.prototype.schedule=function(t,e,n){return e===void 0&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},r.now=function(){return Date.now()},r}(),ka=function(r){V(t,r);function t(e,n){n===void 0&&(n=So.now);var i=r.call(this,e,function(){return t.delegate&&t.delegate!==i?t.delegate.now():n()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),t.delegate&&t.delegate!==this?t.delegate.schedule(e,n,i):r.prototype.schedule.call(this,e,n,i)},t.prototype.flush=function(e){var n=this.actions;if(this.active){n.push(e);return}var i;this.active=!0;do if(i=e.execute(e.state,e.delay))break;while(e=n.shift());if(this.active=!1,i){for(;e=n.shift();)e.unsubscribe();throw i}},t}(So),Il=function(r){V(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(ka),Nl=new Il(Tl),xl=Nl,Ba=new Q(function(r){return r.complete()});function Ui(r){return r?Ll(r):Ba}function Ll(r){return new Q(function(t){return r.schedule(function(){return t.complete()})})}function Dr(r){return r&&typeof r.schedule=="function"}var Ha=function(r){return function(t){for(var e=0,n=r.length;e<n&&!t.closed;e++)t.next(r[e]);t.complete()}};function Gi(r,t){return new Q(function(e){var n=new Dt,i=0;return n.add(t.schedule(function(){if(i===r.length){e.complete();return}e.next(r[i++]),e.closed||n.add(this.schedule())})),n})}function $a(r,t){return t?Gi(r,t):new Q(Ha(r))}function Ar(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r[r.length-1];return Dr(e)?(r.pop(),Gi(r,e)):$a(r)}function Ki(r,t){return t?new Q(function(e){return t.schedule(Cl,0,{error:r,subscriber:e})}):new Q(function(e){return e.error(r)})}function Cl(r){var t=r.error,e=r.subscriber;e.error(t)}var ti=function(){function r(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue=t==="N"}return r.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},r.prototype.do=function(t,e,n){var i=this.kind;switch(i){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},r.prototype.accept=function(t,e,n){return t&&typeof t.next=="function"?this.observe(t):this.do(t,e,n)},r.prototype.toObservable=function(){var t=this.kind;switch(t){case"N":return Ar(this.value);case"E":return Ki(this.error);case"C":return Ui()}throw new Error("unexpected notification kind value")},r.createNext=function(t){return typeof t<"u"?new r("N",t):r.undefinedValueNotification},r.createError=function(t){return new r("E",void 0,t)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r.undefinedValueNotification=new r("N",void 0),r}(),Ml=function(r){V(t,r);function t(e,n,i){i===void 0&&(i=0);var s=r.call(this,e)||this;return s.scheduler=n,s.delay=i,s}return t.dispatch=function(e){var n=e.notification,i=e.destination;n.observe(i),this.unsubscribe()},t.prototype.scheduleMessage=function(e){var n=this.destination;n.add(this.scheduler.schedule(t.dispatch,this.delay,new Dl(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(ti.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(ti.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(ti.createComplete()),this.unsubscribe()},t}(rt),Dl=function(){function r(t,e){this.notification=t,this.destination=e}return r}(),kr=function(r){V(t,r);function t(e,n,i){e===void 0&&(e=Number.POSITIVE_INFINITY),n===void 0&&(n=Number.POSITIVE_INFINITY);var s=r.call(this)||this;return s.scheduler=i,s._events=[],s._infiniteTimeWindow=!1,s._bufferSize=e<1?1:e,s._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(s._infiniteTimeWindow=!0,s.next=s.nextInfiniteTimeWindow):s.next=s.nextTimeWindow,s}return t.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift()}r.prototype.next.call(this,e)},t.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new kl(this._getNow(),e)),this._trimBufferThenGetEvents()),r.prototype.next.call(this,e)},t.prototype._subscribe=function(e){var n=this._infiniteTimeWindow,i=n?this._events:this._trimBufferThenGetEvents(),s=this.scheduler,o=i.length,a;if(this.closed)throw new We;if(this.isStopped||this.hasError?a=Dt.EMPTY:(this.observers.push(e),a=new Ca(this,e)),s&&e.add(e=new Ml(e,s)),n)for(var c=0;c<o&&!e.closed;c++)e.next(i[c]);else for(var c=0;c<o&&!e.closed;c++)e.next(i[c].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),a},t.prototype._getNow=function(){return(this.scheduler||xl).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),n=this._bufferSize,i=this._windowTime,s=this._events,o=s.length,a=0;a<o&&!(e-s[a].time<i);)a++;return o>n&&(a=Math.max(a,o-n)),a>0&&s.splice(0,a),s},t}(gr),kl=function(){function r(t,e){this.time=t,this.value=e}return r}(),Bl=new ka(Da),ja=Bl;function pe(){}var Hl=function(){function r(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return r.prototype=Object.create(Error.prototype),r}(),$l=Hl,jl=function(){function r(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return r.prototype=Object.create(Error.prototype),r}(),Va=jl;function tr(r,t){return function(n){if(typeof r!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Vl(r,t))}}var Vl=function(){function r(t,e){this.project=t,this.thisArg=e}return r.prototype.call=function(t,e){return e.subscribe(new Ul(t,this.project,this.thisArg))},r}(),Ul=function(r){V(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.project=n,s.count=0,s.thisArg=i||s,s}return t.prototype._next=function(e){var n;try{n=this.project.call(this.thisArg,e,this.count++)}catch(i){this.destination.error(i);return}this.destination.next(n)},t}(rt),Gl=function(r){V(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.notifyNext=function(e,n,i,s,o){this.destination.next(n)},t.prototype.notifyError=function(e,n){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(rt),Kl=function(r){V(t,r);function t(e,n,i){var s=r.call(this)||this;return s.parent=e,s.outerValue=n,s.outerIndex=i,s.index=0,s}return t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(rt),Fl=function(r){return function(t){return r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,ar),t}};function zl(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Nn=zl(),ql=function(r){return function(t){var e=r[Nn]();do{var n=void 0;try{n=e.next()}catch(i){return t.error(i),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}while(!0);return typeof e.return=="function"&&t.add(function(){e.return&&e.return()}),t}},Wl=function(r){return function(t){var e=r[$r]();if(typeof e.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)}},Ua=function(r){return r&&typeof r.length=="number"&&typeof r!="function"};function Ga(r){return!!r&&typeof r.subscribe!="function"&&typeof r.then=="function"}var Fi=function(r){if(r&&typeof r[$r]=="function")return Wl(r);if(Ua(r))return Ha(r);if(Ga(r))return Fl(r);if(r&&typeof r[Nn]=="function")return ql(r);var t=La(r)?"an invalid object":"'"+r+"'",e="You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";throw new TypeError(e)};function Yl(r,t,e,n,i){if(i===void 0&&(i=new Kl(r,e,n)),!i.closed)return t instanceof Q?t.subscribe(i):Fi(t)(i)}var Ro={};function Oo(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=void 0,n=void 0;return Dr(r[r.length-1])&&(n=r.pop()),typeof r[r.length-1]=="function"&&(e=r.pop()),r.length===1&&ji(r[0])&&(r=r[0]),$a(r,n).lift(new Zl(e))}var Zl=function(){function r(t){this.resultSelector=t}return r.prototype.call=function(t,e){return e.subscribe(new Jl(t,this.resultSelector))},r}(),Jl=function(r){V(t,r);function t(e,n){var i=r.call(this,e)||this;return i.resultSelector=n,i.active=0,i.values=[],i.observables=[],i}return t.prototype._next=function(e){this.values.push(Ro),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,n=e.length;if(n===0)this.destination.complete();else{this.active=n,this.toRespond=n;for(var i=0;i<n;i++){var s=e[i];this.add(Yl(this,s,void 0,i))}}},t.prototype.notifyComplete=function(e){(this.active-=1)===0&&this.destination.complete()},t.prototype.notifyNext=function(e,n,i){var s=this.values,o=s[i],a=this.toRespond?o===Ro?--this.toRespond:this.toRespond:0;s[i]=n,a===0&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},t.prototype._tryResultSelector=function(e){var n;try{n=this.resultSelector.apply(this,e)}catch(i){this.destination.error(i);return}this.destination.next(n)},t}(Gl);function Xl(r,t){return new Q(function(e){var n=new Dt;return n.add(t.schedule(function(){var i=r[$r]();n.add(i.subscribe({next:function(s){n.add(t.schedule(function(){return e.next(s)}))},error:function(s){n.add(t.schedule(function(){return e.error(s)}))},complete:function(){n.add(t.schedule(function(){return e.complete()}))}}))})),n})}function Ql(r,t){return new Q(function(e){var n=new Dt;return n.add(t.schedule(function(){return r.then(function(i){n.add(t.schedule(function(){e.next(i),n.add(t.schedule(function(){return e.complete()}))}))},function(i){n.add(t.schedule(function(){return e.error(i)}))})})),n})}function th(r,t){if(!r)throw new Error("Iterable cannot be null");return new Q(function(e){var n=new Dt,i;return n.add(function(){i&&typeof i.return=="function"&&i.return()}),n.add(t.schedule(function(){i=r[Nn](),n.add(t.schedule(function(){if(!e.closed){var s,o;try{var a=i.next();s=a.value,o=a.done}catch(c){e.error(c);return}o?e.complete():(e.next(s),this.schedule())}}))})),n})}function eh(r){return r&&typeof r[$r]=="function"}function rh(r){return r&&typeof r[Nn]=="function"}function nh(r,t){if(r!=null){if(eh(r))return Xl(r,t);if(Ga(r))return Ql(r,t);if(Ua(r))return Gi(r,t);if(rh(r)||typeof r=="string")return th(r,t)}throw new TypeError((r!==null&&typeof r||r)+" is not observable")}function rr(r,t){return t?nh(r,t):r instanceof Q?r:new Q(Fi(r))}var jr=function(r){V(t,r);function t(e){var n=r.call(this)||this;return n.parent=e,n}return t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(rt),Vr=function(r){V(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(rt);function Ur(r,t){if(!t.closed){if(r instanceof Q)return r.subscribe(t);var e;try{e=Fi(r)(t)}catch(n){t.error(n)}return e}}function xn(r,t,e){return e===void 0&&(e=Number.POSITIVE_INFINITY),typeof t=="function"?function(n){return n.pipe(xn(function(i,s){return rr(r(i,s)).pipe(tr(function(o,a){return t(i,o,s,a)}))},e))}:(typeof t=="number"&&(e=t),function(n){return n.lift(new ih(r,e))})}var ih=function(){function r(t,e){e===void 0&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return r.prototype.call=function(t,e){return e.subscribe(new sh(t,this.project,this.concurrent))},r}(),sh=function(r){V(t,r);function t(e,n,i){i===void 0&&(i=Number.POSITIVE_INFINITY);var s=r.call(this,e)||this;return s.project=n,s.concurrent=i,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var n,i=this.index++;try{n=this.project(e,i)}catch(s){this.destination.error(s);return}this.active++,this._innerSub(n)},t.prototype._innerSub=function(e){var n=new jr(this),i=this.destination;i.add(n);var s=Ur(e,n);s!==n&&i.add(s)},t.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},t}(Vr);function oh(r){return r===void 0&&(r=Number.POSITIVE_INFINITY),xn(Vi,r)}function ah(){return oh(1)}function gn(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return ah()(Ar.apply(void 0,r))}function Ka(r){return new Q(function(t){var e;try{e=r()}catch(i){t.error(i);return}var n=e?rr(e):Ui();return n.subscribe(t)})}function Po(r){return!ji(r)&&r-parseFloat(r)+1>=0}var ch=new Q(pe);function mn(r,t){return function(n){return n.lift(new uh(r,t))}}var uh=function(){function r(t,e){this.predicate=t,this.thisArg=e}return r.prototype.call=function(t,e){return e.subscribe(new lh(t,this.predicate,this.thisArg))},r}(),lh=function(r){V(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.predicate=n,s.thisArg=i,s.count=0,s}return t.prototype._next=function(e){var n;try{n=this.predicate.call(this.thisArg,e,this.count++)}catch(i){this.destination.error(i);return}n&&this.destination.next(e)},t}(rt);function zi(r,t,e){return r===void 0&&(r=0),new Q(function(n){t===void 0&&(t=r,r=0);var i=0,s=r;if(e)return e.schedule(hh,0,{index:i,count:t,start:r,subscriber:n});do{if(i++>=t){n.complete();break}if(n.next(s++),n.closed)break}while(!0)})}function hh(r){var t=r.start,e=r.index,n=r.count,i=r.subscriber;if(e>=n){i.complete();return}i.next(t),!i.closed&&(r.index=e+1,r.start=t+1,this.schedule(r))}function To(r,t,e){r===void 0&&(r=0);var n=-1;return Po(t)?n=Number(t)<1&&1||Number(t):Dr(t)&&(e=t),Dr(e)||(e=ja),new Q(function(i){var s=Po(r)?r:+r-e.now();return e.schedule(dh,s,{index:0,period:n,subscriber:i})})}function dh(r){var t=r.index,e=r.period,n=r.subscriber;if(n.next(t),!n.closed){if(e===-1)return n.complete();r.index=t+1,this.schedule(r,e)}}function qi(r){return function(e){var n=new ph(r),i=e.lift(n);return n.caught=i}}var ph=function(){function r(t){this.selector=t}return r.prototype.call=function(t,e){return e.subscribe(new fh(t,this.selector,this.caught))},r}(),fh=function(r){V(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.selector=n,s.caught=i,s}return t.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(o){r.prototype.error.call(this,o);return}this._unsubscribeAndRecycle();var i=new jr(this);this.add(i);var s=Ur(n,i);s!==i&&this.add(s)}},t}(Vr);function Gr(r,t){return xn(r,t,1)}function gh(r){return r===void 0&&(r=null),function(t){return t.lift(new mh(r))}}var mh=function(){function r(t){this.defaultValue=t}return r.prototype.call=function(t,e){return e.subscribe(new yh(t,this.defaultValue))},r}(),yh=function(r){V(t,r);function t(e,n){var i=r.call(this,e)||this;return i.defaultValue=n,i.isEmpty=!0,i}return t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(rt);function bh(r){return r instanceof Date&&!isNaN(+r)}function Fa(r,t){return function(e){return e.lift(new Eh(r,t))}}var Eh=function(){function r(t,e){this.compare=t,this.keySelector=e}return r.prototype.call=function(t,e){return e.subscribe(new vh(t,this.compare,this.keySelector))},r}(),vh=function(r){V(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.keySelector=i,s.hasKey=!1,typeof n=="function"&&(s.compare=n),s}return t.prototype.compare=function(e,n){return e===n},t.prototype._next=function(e){var n;try{var i=this.keySelector;n=i?i(e):e}catch(a){return this.destination.error(a)}var s=!1;if(this.hasKey)try{var o=this.compare;s=o(this.key,n)}catch(a){return this.destination.error(a)}else this.hasKey=!0;s||(this.key=n,this.destination.next(e))},t}(rt);function _h(r,t){return Fa(function(e,n){return t?t(e[r],n[r]):e[r]===n[r]})}function wh(r){return r===void 0&&(r=Rh),function(t){return t.lift(new Ah(r))}}var Ah=function(){function r(t){this.errorFactory=t}return r.prototype.call=function(t,e){return e.subscribe(new Sh(t,this.errorFactory))},r}(),Sh=function(r){V(t,r);function t(e,n){var i=r.call(this,e)||this;return i.errorFactory=n,i.hasValue=!1,i}return t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(n){e=n}this.destination.error(e)},t}(rt);function Rh(){return new Va}function Oh(r){return function(t){return r===0?Ui():t.lift(new Ph(r))}}var Ph=function(){function r(t){if(this.total=t,this.total<0)throw new $l}return r.prototype.call=function(t,e){return e.subscribe(new Th(t,this.total))},r}(),Th=function(r){V(t,r);function t(e,n){var i=r.call(this,e)||this;return i.total=n,i.count=0,i}return t.prototype._next=function(e){var n=this.total,i=++this.count;i<=n&&(this.destination.next(e),i===n&&(this.destination.complete(),this.unsubscribe()))},t}(rt);function za(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(e){return gn(e,Ar.apply(void 0,r))}}function Ae(r,t){var e=arguments.length>=2;return function(n){return n.pipe(r?mn(function(i,s){return r(i,s,n)}):Vi,Oh(1),e?gh(t):wh(function(){return new Va}))}}function gi(r,t){return function(n){var i;if(typeof r=="function"?i=r:i=function(){return r},typeof t=="function")return n.lift(new Ih(i,t));var s=Object.create(n,Rl);return s.source=n,s.subjectFactory=i,s}}var Ih=function(){function r(t,e){this.subjectFactory=t,this.selector=e}return r.prototype.call=function(t,e){var n=this.selector,i=this.subjectFactory(),s=n(i).subscribe(t);return s.add(e.subscribe(i)),s},r}();function Io(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r.length;if(e===0)throw new Error("list of properties cannot be empty.");return function(n){return tr(Nh(r,e))(n)}}function Nh(r,t){var e=function(n){for(var i=n,s=0;s<t;s++){var o=i!=null?i[r[s]]:void 0;if(o!==void 0)i=o;else return}return i};return e}function xh(r){return r?gi(function(){return new gr},r):gi(new gr)}function mi(r,t,e,n){e&&typeof e!="function"&&(n=e);var i=typeof e=="function"?e:void 0,s=new kr(r,t,n);return function(o){return gi(function(){return s},i)(o)}}function qa(r){return r===void 0&&(r=-1),function(t){return t.lift(new Lh(r,t))}}var Lh=function(){function r(t,e){this.count=t,this.source=e}return r.prototype.call=function(t,e){return e.subscribe(new Ch(t,this.count,this.source))},r}(),Ch=function(r){V(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.count=n,s.source=i,s}return t.prototype.error=function(e){if(!this.isStopped){var n=this,i=n.source,s=n.count;if(s===0)return r.prototype.error.call(this,e);s>-1&&(this.count=s-1),i.subscribe(this._unsubscribeAndRecycle())}},t}(rt);function No(r,t,e){var n;return r&&typeof r=="object"?n=r:n={bufferSize:r,windowTime:t,refCount:!1,scheduler:e},function(i){return i.lift(Mh(n))}}function Mh(r){var t=r.bufferSize,e=t===void 0?Number.POSITIVE_INFINITY:t,n=r.windowTime,i=n===void 0?Number.POSITIVE_INFINITY:n,s=r.refCount,o=r.scheduler,a,c=0,l,p=!1,h=!1;return function(E){c++;var _;!a||p?(p=!1,a=new kr(e,i,o),_=a.subscribe(this),l=E.subscribe({next:function(L){a.next(L)},error:function(L){p=!0,a.error(L)},complete:function(){h=!0,l=void 0,a.complete()}}),h&&(l=void 0)):_=a.subscribe(this),this.add(function(){c--,_.unsubscribe(),_=void 0,l&&!h&&s&&c===0&&(l.unsubscribe(),l=void 0,a=void 0)})}}function Dh(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=r[r.length-1];return Dr(e)?(r.pop(),function(n){return gn(r,n,e)}):function(n){return gn(r,n)}}function ae(r,t){return typeof t=="function"?function(e){return e.pipe(ae(function(n,i){return rr(r(n,i)).pipe(tr(function(s,o){return t(n,s,i,o)}))}))}:function(e){return e.lift(new kh(r))}}var kh=function(){function r(t){this.project=t}return r.prototype.call=function(t,e){return e.subscribe(new Bh(t,this.project))},r}(),Bh=function(r){V(t,r);function t(e,n){var i=r.call(this,e)||this;return i.project=n,i.index=0,i}return t.prototype._next=function(e){var n,i=this.index++;try{n=this.project(e,i)}catch(s){this.destination.error(s);return}this._innerSub(n)},t.prototype._innerSub=function(e){var n=this.innerSubscription;n&&n.unsubscribe();var i=new jr(this),s=this.destination;s.add(i),this.innerSubscription=Ur(e,i),this.innerSubscription!==i&&s.add(this.innerSubscription)},t.prototype._complete=function(){var e=this.innerSubscription;(!e||e.closed)&&r.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&r.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(Vr);function Hh(r){return function(t){return t.lift(new $h(r))}}var $h=function(){function r(t){this.notifier=t}return r.prototype.call=function(t,e){var n=new jh(t),i=Ur(this.notifier,new jr(n));return i&&!n.seenValue?(n.add(i),e.subscribe(n)):n},r}(),jh=function(r){V(t,r);function t(e){var n=r.call(this,e)||this;return n.seenValue=!1,n}return t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(Vr);function Vh(r,t){return t===void 0&&(t=!1),function(e){return e.lift(new Uh(r,t))}}var Uh=function(){function r(t,e){this.predicate=t,this.inclusive=e}return r.prototype.call=function(t,e){return e.subscribe(new Gh(t,this.predicate,this.inclusive))},r}(),Gh=function(r){V(t,r);function t(e,n,i){var s=r.call(this,e)||this;return s.predicate=n,s.inclusive=i,s.index=0,s}return t.prototype._next=function(e){var n=this.destination,i;try{i=this.predicate(e,this.index++)}catch(s){n.error(s);return}this.nextOrComplete(e,i)},t.prototype.nextOrComplete=function(e,n){var i=this.destination;n?i.next(e):(this.inclusive&&i.next(e),i.complete())},t}(rt);function yn(r,t,e){return function(i){return i.lift(new Kh(r,t,e))}}var Kh=function(){function r(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return r.prototype.call=function(t,e){return e.subscribe(new Fh(t,this.nextOrObserver,this.error,this.complete))},r}(),Fh=function(r){V(t,r);function t(e,n,i,s){var o=r.call(this,e)||this;return o._tapNext=pe,o._tapError=pe,o._tapComplete=pe,o._tapError=i||pe,o._tapComplete=s||pe,dn(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||pe,o._tapError=n.error||pe,o._tapComplete=n.complete||pe),o}return t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(n){this.destination.error(n);return}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(n){this.destination.error(n);return}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){this.destination.error(e);return}return this.destination.complete()},t}(rt);function Wa(r,t,e){return e===void 0&&(e=ja),function(n){var i=bh(r),s=i?+r-e.now():Math.abs(r);return n.lift(new zh(s,i,t,e))}}var zh=function(){function r(t,e,n,i){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=i}return r.prototype.call=function(t,e){return e.subscribe(new qh(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},r}(),qh=function(r){V(t,r);function t(e,n,i,s,o){var a=r.call(this,e)||this;return a.absoluteTimeout=n,a.waitFor=i,a.withObservable=s,a.scheduler=o,a.scheduleTimeout(),a}return t.dispatchTimeout=function(e){var n=e.withObservable;e._unsubscribeAndRecycle(),e.add(Ur(n,new jr(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),r.prototype._next.call(this,e)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(Vr),Wh=function(r,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var e=typeof t.cycles=="boolean"?t.cycles:!1,n=t.cmp&&function(s){return function(o){return function(a,c){var l={key:a,value:o[a]},p={key:c,value:o[c]};return s(l,p)}}}(t.cmp),i=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,c;if(Array.isArray(o)){for(c="[",a=0;a<o.length;a++)a&&(c+=","),c+=s(o[a])||"null";return c+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(e)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=i.push(o)-1,p=Object.keys(o).sort(n&&n(o));for(c="",a=0;a<p.length;a++){var h=p[a],b=s(o[h]);b&&(c&&(c+=","),c+=JSON.stringify(h)+":"+b)}return i.splice(l,1),"{"+c+"}"}}(r)};const Yh=ca(Wh);var Ya;class Zh extends Error{constructor(t){super(`The map type '${t}' is invalid`),this.mapType=t,this.name="InvalidMapTypeError"}}const Za=Symbol.for("taquito-michelson-map-type-symbol"),Jh=r=>"args"in r&&Array.isArray(r.args)&&r.args.length===2;class xo extends Error{constructor(t,e,n){super(`${n} not compliant with underlying michelson type`),this.value=t,this.type=e,this.name="MapTypecheckError"}}class xt{constructor(t){this.valueMap=new Map,this.keyMap=new Map,this[Ya]=!0,t&&this.setType(t)}static isMichelsonMap(t){return t&&t[Za]===!0}setType(t){if(!Jh(t))throw new Zh(t.toString());this.keySchema=new Lt(t.args[0]),this.valueSchema=new Lt(t.args[1])}removeType(){this.keySchema=void 0,this.valueSchema=void 0}static fromLiteral(t,e){const n=new xt(e);return Object.keys(t).forEach(i=>{n.set(i,t[i])}),n}typecheckKey(t){return this.keySchema?this.keySchema.Typecheck(t):!0}typecheckValue(t){return this.valueSchema?this.valueSchema.Typecheck(t):!0}assertTypecheckValue(t){if(!this.typecheckValue(t))throw new xo(t,this.valueSchema,"value")}assertTypecheckKey(t){if(!this.typecheckKey(t))throw new xo(t,this.keySchema,"key")}serializeDeterministically(t){return Yh(t)}*keys(){for(const[t]of this.entries())yield t}*values(){for(const[,t]of this.entries())yield t}*entries(){for(const t of this.valueMap.keys())yield[this.keyMap.get(t),this.valueMap.get(t)]}get(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.valueMap.get(e)}set(t,e){this.assertTypecheckKey(t),this.assertTypecheckValue(e);const n=this.serializeDeterministically(t);this.keyMap.set(n,t),this.valueMap.set(n,e)}delete(t){this.assertTypecheckKey(t),this.keyMap.delete(this.serializeDeterministically(t)),this.valueMap.delete(this.serializeDeterministically(t))}has(t){this.assertTypecheckKey(t);const e=this.serializeDeterministically(t);return this.keyMap.has(e)&&this.valueMap.has(e)}clear(){this.keyMap.clear(),this.valueMap.clear()}get size(){return this.keyMap.size}forEach(t){for(const[e,n]of this.entries())t(n,e,this)}}Ya=Za;class Y extends Error{constructor(t,e,n){super(),this.value=t,this.token=e,this.name="ValidationError";const i=this.token.annot(),s=i?`[${i}] `:"";this.message=`${s}${n}`}}class at{constructor(t,e,n){this.val=t,this.idx=e,this.fac=n,this.createToken=this.fac}typeWithoutAnnotations(){const t=n=>{if(typeof n=="object"){if(Array.isArray(n))return n.map(o=>t(o));const i=n;return i.args?{prim:i.prim,args:i.args.map(s=>t(s))}:{prim:i.prim}}return n};return(n=>n.args?{prim:n.prim,args:n.args.map(i=>t(i))}:{prim:n.prim})(this.val)}annot(){return(Array.isArray(this.val.annots)&&this.val.annots.length>0?this.val.annots[0]:String(this.idx)).replace(/(%|:)(_Liq_entry_)?/,"")}hasAnnotations(){return Array.isArray(this.val.annots)&&this.val.annots.length}get tokenVal(){return this.val}ExtractSignature(){return[[this.ExtractSchema()]]}}class et extends at{compare(t,e){return t===e?0:t<e?-1:1}}class Lo extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="BigMapValidationError"}}class Nt extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}ExtractSchema(){return{big_map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:Nt.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}isValid(t){return xt.isMichelsonMap(t)?null:new Lo(t,this,"Value must be a MichelsonMap")}objLitToMichelsonMap(t){return t instanceof xt?t:typeof t=="object"?Object.keys(t).length===0?new xt:xt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop()),n=this.isValid(e);if(n)throw n;return Array.from(e.keys()).sort((i,s)=>this.KeySchema.compare(i,s)).map(i=>({prim:"Elt",args:[this.KeySchema.EncodeObject(i),this.ValueSchema.EncodeObject(e.get(i))]}))}EncodeObject(t,e){const n=this.objLitToMichelsonMap(t),i=this.isValid(n);if(i)throw i;return e&&e[Nt.prim]?e[Nt.prim](n,this.val):Array.from(n.keys()).sort((s,o)=>this.KeySchema.compare(s,o)).map(s=>({prim:"Elt",args:[this.KeySchema.EncodeObject(s),this.ValueSchema.EncodeObject(n.get(s))]}))}Execute(t,e){if(e&&e[Nt.prim])return e[Nt.prim](t,this.val);if(Array.isArray(t)){const n=new xt(this.val);return t.forEach(i=>{n.set(this.KeySchema.ToKey(i.args[0]),this.ValueSchema.Execute(i.args[1]))}),n}else{if("int"in t)return t.int;throw new Lo(t,this,`Big map is expecting either an array (Athens) or an object with an int property (Babylon). Got ${JSON.stringify(t)}`)}}findAndReturnTokens(t,e){return Nt.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}Nt.prim="big_map";class Xh extends Error{constructor(t){super(t),this.message=t,this.name="OrTokenDecodingError"}}class G extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Encode(t){const e=t[t.length-1],n=this.createToken(this.val.args[0],this.idx);let i=1;n instanceof G&&(i=Object.keys(n.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+i);if(String(n.annot())===String(e)&&!(n instanceof G))return t.pop(),{prim:"Left",args:[n.Encode(t)]};if(String(s.annot())===String(e)&&!(s instanceof G))return t.pop(),{prim:"Right",args:[s.Encode(t)]};if(n instanceof G){const o=n.Encode(t);if(o)return{prim:"Left",args:[o]}}if(s instanceof G){const o=s.Encode(t);if(o)return{prim:"Right",args:[o]}}return null}ExtractSignature(){const t=this.createToken(this.val.args[0],this.idx);let e=1;t instanceof G&&(e=Object.keys(t.ExtractSchema()).length);const n=this.createToken(this.val.args[1],this.idx+e),i=[];if(t instanceof G)i.push(...t.ExtractSignature());else for(const s of t.ExtractSignature())i.push([t.annot(),...s]);if(n instanceof G)i.push(...n.ExtractSignature());else for(const s of n.ExtractSignature())i.push([n.annot(),...s]);return i}EncodeObject(t,e){const n=Object.keys(t)[0],i=this.createToken(this.val.args[0],this.idx);let s=1;i instanceof G&&(s=Object.keys(i.ExtractSchema()).length);const o=this.createToken(this.val.args[1],this.idx+s);if(String(i.annot())===String(n)&&!(i instanceof G))return{prim:"Left",args:[i.EncodeObject(t[n],e)]};if(String(o.annot())===String(n)&&!(o instanceof G))return{prim:"Right",args:[o.EncodeObject(t[n],e)]};if(i instanceof G){const a=i.EncodeObject(t,e);if(a)return{prim:"Left",args:[a]}}if(o instanceof G){const a=o.EncodeObject(t,e);if(a)return{prim:"Right",args:[a]}}return null}Execute(t,e){const n=this.createToken(this.val.args[0],this.idx);let i=1;n instanceof G&&(i=Object.keys(n.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.idx+i);if(t.prim==="Right")return s instanceof G?s.Execute(t.args[0],e):{[s.annot()]:s.Execute(t.args[0],e)};if(t.prim==="Left")return n instanceof G?n.Execute(t.args[0],e):{[n.annot()]:n.Execute(t.args[0],e)};throw new Xh(`Was expecting Left or Right prim but got: ${t.prim}`)}traversal(t,e,n){const i=this.createToken(this.val.args[0],this.idx);let s=1,o;i instanceof G&&!i.hasAnnotations()?(o=t(i),s=Object.keys(i.ExtractSchema()).length):o={[i.annot()]:t(i)};const a=this.createToken(this.val.args[1],this.idx+s);let c;return a instanceof G&&!a.hasAnnotations()?c=e(a):c={[a.annot()]:e(a)},n(o,c)}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}generateSchema(){return{__michelsonType:G.prim,schema:this.traversal(t=>t instanceof G&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof G&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),(t,e)=>Object.assign(Object.assign({},t),e))}}findToken(t){const e=this.createToken(this.val.args[0],this.idx);let n=1;e instanceof G&&(n=Object.keys(e.ExtractSchema()).length);const i=this.createToken(this.val.args[1],this.idx+n);if(String(e.annot())===String(t)&&!(e instanceof G)&&e instanceof et)return e;if(String(i.annot())===String(t)&&!(i instanceof G)&&i instanceof et)return i;if(e instanceof G){const s=e.findToken(t);if(s)return s}if(i instanceof G){const s=i.findToken(t);if(s)return s}return null}compare(t,e){const n=Object.keys(t)[0],i=Object.keys(e)[0];if(n===i){const s=this.findToken(n);if(s instanceof et)return s.compare(t[n],e[n])}else{const s=JSON.stringify(this.EncodeObject(t)),o=JSON.stringify(this.EncodeObject(e));return s<o?-1:1}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return G.prim===t&&e.push(this),this.traversal(n=>n.findAndReturnTokens(t,e),n=>n.findAndReturnTokens(t,e),(n,i)=>Object.assign(Object.assign({},n),i)),e}}G.prim="or";class Qh extends Error{constructor(t){super(t),this.message=t,this.name="TokenArgumentValidationError"}}class td extends Error{constructor(t,e){super(`Tokens ${t} and ${e} are not comparable`),this.val1=t,this.val2=e,this.name="TokenComparisonError"}}function yi(r,t=ot.prim){if(Array.isArray(r))return yi({prim:t,args:r},t);if(r.args===void 0)throw new Qh("Encountered an invalid PairToken with no arguments, a pair must have two or more arguments");return r.args.length>2?[r.args[0],{prim:t,args:r.args.slice(1)}]:[r.args[0],r.args[1]]}class ot extends et{constructor(t,e,n){super(Array.isArray(t)?{prim:ot.prim,args:t}:t.prim?t:{prim:ot.prim,args:t},e,n)}args(){return yi(this.val)}tokens(){let t=0;return this.args().map(e=>{const n=this.createToken(e,this.idx+t);return n instanceof ot?t+=Object.keys(n.ExtractSchema()).length:t++,n})}Encode(t){return{prim:"Pair",args:this.tokens().map(e=>e.Encode(t))}}ExtractSignature(){const t=this.args(),e=this.createToken(t[0],this.idx);let n=1;e instanceof G&&(n=Object.keys(e.ExtractSchema()).length);const i=this.createToken(t[1],this.idx+n),s=[];for(const o of e.ExtractSignature())for(const a of i.ExtractSignature())s.push([...o,...a]);return s}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}ToKey(t){return this.Execute(t)}EncodeObject(t,e){const[n,i]=this.tokens();let s;n instanceof ot&&!n.hasAnnotations()?s=t:s=t[n.annot()];let o;return i instanceof ot&&!i.hasAnnotations()?o=t:o=t[i.annot()],{prim:"Pair",args:[n.EncodeObject(s,e),i.EncodeObject(o,e)]}}traversal(t,e){const n=this.args(),i=this.createToken(n[0],this.idx);let s=1,o;i instanceof ot&&(s=Object.keys(i.ExtractSchema()).length),i instanceof ot&&!i.hasAnnotations()?o=t(i):o={[i.annot()]:t(i)};const a=this.createToken(n[1],this.idx+s);let c;return a instanceof ot&&!a.hasAnnotations()?c=e(a):c={[a.annot()]:e(a)},Object.assign(Object.assign({},o),c)}Execute(t,e){const n=yi(t,"Pair");return this.traversal(i=>i.Execute(n[0],e),i=>i.Execute(n[1],e))}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema())}generateSchema(){return{__michelsonType:ot.prim,schema:this.traversal(t=>t instanceof ot&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof ot&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema())}}compare(t,e){const[n,i]=this.tokens(),s=(o,a)=>o instanceof ot&&!o.hasAnnotations()?a:a[o.annot()];if(n instanceof et&&i instanceof et){const o=n.compare(s(n,t),s(n,e));return o===0?i.compare(s(i,t),s(i,e)):o}throw new td(t,e)}findAndReturnTokens(t,e){return ot.prim===t&&e.push(this),this.tokens().map(n=>n.findAndReturnTokens(t,e)),e}}ot.prim="pair";class Co extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="NatValidationError"}}class Ft extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return new P(t[Object.keys(t)[0]])}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{int:new P(e).toFixed()}}isValid(t){const e=new P(t);return e.isNaN()?new Co(t,this,`Value is not a number: ${t}`):e.isNegative()?new Co(t,this,`Value cannot be negative: ${t}`):null}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[Ft.prim]?e[Ft.prim](t):{int:new P(t).toFixed()}}ExtractSchema(){return Ft.prim}generateSchema(){return{__michelsonType:Ft.prim,schema:Ft.prim}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:Ft.prim}}}ToKey({int:t}){return new P(t)}compare(t,e){const n=Number(t),i=Number(e);return n===i?0:n<i?-1:1}findAndReturnTokens(t,e){return Ft.prim===t&&e.push(this),e}}Ft.prim="nat";class zt extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return zt.prim}generateSchema(){return{__michelsonType:zt.prim,schema:zt.prim}}Encode(t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[zt.prim]?e[zt.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:zt.prim}}}findAndReturnTokens(t,e){return zt.prim===t&&e.push(this),e}}zt.prim="string";class ei extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="AddressValidationError"}}class fe extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}ToBigMapKey(t){return{key:{bytes:zc(t)},type:{prim:"bytes"}}}isValid(t){return F(t)!==O.VALID?new ei(t,this,`Address is not valid: ${t}`):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[fe.prim]?e[fe.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new ei(t,this,`cannot be missing both string and bytes: ${t}`);return hi(t.bytes)}ExtractSchema(){return fe.prim}generateSchema(){return{__michelsonType:fe.prim,schema:fe.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new ei({bytes:t,string:e},this,`cannot be missing both string and bytes ${{string:e,bytes:t}}`);return hi(t)}compare(t,e){const n=o=>o.startsWith("tz"),i=n(t),s=n(e);return i&&!s?-1:s&&!i?1:super.compare(t,e)}findAndReturnTokens(t,e){return fe.prim===t&&e.push(this),e}}fe.prim="address";class ed extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="MapValidationError"}}class je extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}isValid(t){return xt.isMichelsonMap(t)?null:new ed(t,this,"Value must be a MichelsonMap")}Execute(t,e){const n=new xt(this.val);return t.forEach(i=>{n.set(this.KeySchema.ToKey(i.args[0]),this.ValueSchema.Execute(i.args[1],e))}),n}objLitToMichelsonMap(t){return t instanceof xt?t:typeof t=="object"?Object.keys(t).length===0?new xt:xt.fromLiteral(t):t}Encode(t){const e=this.objLitToMichelsonMap(t.pop()),n=this.isValid(e);if(n)throw n;return Array.from(e.keys()).sort((i,s)=>this.KeySchema.compare(i,s)).map(i=>({prim:"Elt",args:[this.KeySchema.EncodeObject(i),this.ValueSchema.EncodeObject(e.get(i))]}))}EncodeObject(t,e){const n=this.objLitToMichelsonMap(t),i=this.isValid(n);if(i)throw i;return e&&e[je.prim]?e[je.prim](n):Array.from(n.keys()).sort((s,o)=>this.KeySchema.compare(s,o)).map(s=>({prim:"Elt",args:[this.KeySchema.EncodeObject(s),this.ValueSchema.EncodeObject(n.get(s))]}))}ExtractSchema(){return{map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:je.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}findAndReturnTokens(t,e){return je.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),this.ValueSchema.findAndReturnTokens(t,e),e}}je.prim="map";class qt extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return String(t.prim).toLowerCase()==="true"}Encode(t){return{prim:t.pop()?"True":"False"}}EncodeObject(t,e){return e&&e[qt.prim]?e[qt.prim](t):{prim:t?"True":"False"}}ExtractSchema(){return qt.prim}generateSchema(){return{__michelsonType:qt.prim,schema:qt.prim}}ToBigMapKey(t){return{key:this.EncodeObject(t),type:{prim:qt.prim}}}ToKey(t){return this.EncodeObject(t)}compare(t,e){return t&&e||!t&&!e?0:t?1:-1}findAndReturnTokens(t,e){return qt.prim===t&&e.push(this),e}}qt.prim="bool";class Yr extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="TxRollupL2AddressValidationError"}}class ge extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}ToBigMapKey(t){return{key:{bytes:qc(t)},type:{prim:"bytes"}}}isValid(t){if(F(t)!==O.VALID)throw new Yr(t,this,`tx_rollup_l2_address is not valid: ${t}`);return null}Encode(t){const e=t.pop();if(!e)throw new Yr(e,this,`arg missing to encode: this -> "${e}"`);return this.isValid(e),{string:e}}EncodeObject(t,e){return this.isValid(t),e&&e[ge.prim]?e[ge.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Yr(t,this,`value cannot be missing string and byte value. must have one ${JSON.stringify(t)}`);return Ms(t.bytes)}ExtractSchema(){return ge.prim}generateSchema(){return{__michelsonType:ge.prim,schema:ge.prim}}ToKey({bytes:t,string:e}){if(e)return e;if(!t)throw new Yr(t,this,`value cannot be missing string and byte value. must have one: bytes = ${t}`);return Ms(t)}findAndReturnTokens(t,e){return ge.prim===t&&e.push(this),e}}ge.prim="tx_rollup_l2_address";class Mo extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ContractValidationError"}}class St extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return F(t)!==O.VALID?new Mo(t,this,"Contract address is not valid"):null}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Mo(t,this,"must contain bytes or string");return hi(t.bytes)}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[St.prim]?e[St.prim](t):{string:t}}ExtractSchema(){return St.prim}generateSchema(){const t=this.createToken(this.val.args[0],0);return{__michelsonType:St.prim,schema:{parameter:this.val.args[0]?t.generateSchema():{}}}}findAndReturnTokens(t,e){return St.prim===t&&e.push(this),e}}St.prim="contract";class rd extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ListValidationError"}}class Me extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get valueSchema(){return this.createToken(this.val.args[0],this.idx)}isValid(t){return Array.isArray(t)?null:new rd(t,this,"Value must be an array")}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;const i=this.createToken(this.val.args[0],0);return e.reduce((s,o)=>[...s,i.EncodeObject(o)],[])}Execute(t,e){const n=this.createToken(this.val.args[0],0),i=this.isValid(t);if(i)throw i;return t.reduce((s,o)=>[...s,n.Execute(o,e)],[])}EncodeObject(t,e){const n=this.createToken(this.val.args[0],0),i=this.isValid(t);if(i)throw i;return e&&e[Me.prim]?e[Me.prim](t):t.reduce((s,o)=>[...s,n.EncodeObject(o)],[])}ExtractSchema(){return{[Me.prim]:this.valueSchema.ExtractSchema()}}generateSchema(){return{__michelsonType:Me.prim,schema:this.valueSchema.generateSchema()}}findAndReturnTokens(t,e){return Me.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),e}}Me.prim="list";class nd extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="MutezValidationError"}}class Wt extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return new P(t[Object.keys(t)[0]])}ExtractSchema(){return Wt.prim}generateSchema(){return{__michelsonType:Wt.prim,schema:Wt.prim}}isValid(t){return new P(t).isNaN()?new nd(t,this,`Value is not a number: ${t}`):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{int:String(e).toString()}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[Wt.prim]?e[Wt.prim](t):{int:String(t).toString()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:Wt.prim}}}ToKey({int:t}){return t}compare(t,e){const n=Number(t),i=Number(e);return n===i?0:n<i?-1:1}findAndReturnTokens(t,e){return Wt.prim===t&&e.push(this),e}}Wt.prim="mutez";class id extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="BytesValidationError"}}class Yt extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}ToBigMapKey(t){return{key:{bytes:t},type:{prim:Yt.prim}}}isValid(t){return typeof t=="string"&&/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new id(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=Ds(this.convertUint8ArrayToHexString(e));const n=this.isValid(e);if(n)throw n;return{bytes:String(e).toString()}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t),typeof t=="string"&&(t=Ds(t));const n=this.isValid(t);if(n)throw n;return e&&e[Yt.prim]?e[Yt.prim](t):{bytes:String(t).toString()}}Execute(t){return t.bytes}ExtractSchema(){return Yt.prim}generateSchema(){return{__michelsonType:Yt.prim,schema:Yt.prim}}ToKey({bytes:t,string:e}){return e||t}findAndReturnTokens(t,e){return Yt.prim===t&&e.push(this),e}}Yt.prim="bytes";class mr extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}subToken(){return this.createToken(this.val.args[0],this.idx)}schema(){return this.createToken(this.val.args[0],0)}annot(){return Array.isArray(this.val.annots)?super.annot():this.createToken(this.val.args[0],this.idx).annot()}Encode(t){const e=t;return e==null?{prim:"None"}:Array.isArray(e)&&(e[e.length-1]===void 0||e[e.length-1]===null)?(e.pop(),{prim:"None"}):{prim:"Some",args:[this.schema().Encode(t)]}}EncodeObject(t,e){let n=t;return n==null?{prim:"None"}:(n=typeof n=="object"&&"Some"in n?n.Some:n,{prim:"Some",args:[this.schema().EncodeObject(n,e)]})}Execute(t,e){return t.prim==="None"?null:{Some:this.schema().Execute(t.args[0],e)}}ExtractSchema(){return{Some:this.schema().ExtractSchema()}}generateSchema(){return{__michelsonType:mr.prim,schema:this.schema().generateSchema()}}ExtractSignature(){return[...this.schema().ExtractSignature()]}get KeySchema(){return this.schema()}compare(t,e){if(t){if(!e)return 1}else return-1;return this.KeySchema.compare(t,e)}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,e){return mr.prim===t&&e.push(this),this.subToken().findAndReturnTokens(t,e),e}}mr.prim="option";class Zt extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){if(t.string&&/^\d+$/.test(t.string))return new Date(Number(t.string)*1e3).toISOString();if(t.string)return new Date(t.string).toISOString();if(t.int)return new Date(Number(t.int)*1e3).toISOString()}Encode(t){const e=t.pop();return typeof e=="number"?{int:String(e)}:{string:e}}EncodeObject(t,e){return e&&e[Zt.prim]?e[Zt.prim](t):typeof t=="number"?{int:String(t)}:{string:t}}ExtractSchema(){return Zt.prim}generateSchema(){return{__michelsonType:Zt.prim,schema:Zt.prim}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:Zt.prim}}}findAndReturnTokens(t,e){return Zt.prim===t&&e.push(this),e}}Zt.prim="timestamp";class sd extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="IntValidationError"}}class mt extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return new P(t[Object.keys(t)[0]])}ExtractSchema(){return mt.prim}generateSchema(){return{__michelsonType:mt.prim,schema:mt.prim}}isValid(t){return new P(t).isNaN()?new sd(t,this,`Value is not a number: ${t}`):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{int:new P(e).toFixed()}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[mt.prim]?e[mt.prim](t):{int:new P(t).toFixed()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:mt.prim}}}ToKey({int:t}){return t}compare(t,e){const n=Number(t),i=Number(e);return n===i?0:n<i?-1:1}findAndReturnTokens(t,e){return mt.prim===t&&e.push(this),e}}mt.prim="int";class Jt extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Encode(t){return t.pop(),{prim:"Unit"}}EncodeObject(t,e){return e&&e[Jt.prim]?e[Jt.prim](t):{prim:"Unit"}}Execute(t){return Uo}ExtractSchema(){return Jt.prim}generateSchema(){return{__michelsonType:Jt.prim,schema:Jt.prim}}compare(t,e){return 0}ToKey(t){return Uo}ToBigMapKey(t){return{key:{prim:"Unit"},type:{prim:Jt.prim}}}findAndReturnTokens(t,e){return Jt.prim===t&&e.push(this),e}}Jt.prim="unit";const od=4;class ad extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="KeyValidationError"}}class Xt extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string?t.string:Wc(t.bytes)}isValid(t){return Yc(t)!==O.VALID?new ad(t,this,"Key is not valid"):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[Xt.prim]?e[Xt.prim](t):{string:t}}ExtractSchema(){return Xt.prim}generateSchema(){return{__michelsonType:Xt.prim,schema:Xt.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:Xt.prim}}}compare(t,e){const n=this.getPrefix(t),i=this.getPrefix(e);if(n===A.EDPK&&i!==A.EDPK)return-1;if(n===A.SPPK&&i!==A.SPPK)return i===A.EDPK?1:-1;if(n===A.P2PK){if(i!==A.P2PK)return 1;const s=this.getP256PublicKeyComparableBytes(t),o=this.getP256PublicKeyComparableBytes(e);return Buffer.compare(s,o)}return super.compare(t,e)}getPrefix(t){return t.substring(0,od)}getP256PublicKeyComparableBytes(t){return la(t,Ni[A.P2PK]).slice(1)}findAndReturnTokens(t,e){return Xt.prim===t&&e.push(this),e}}Xt.prim="key";class cd extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="KeyHashValidationError"}}class Qt extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string?t.string:ks(t.bytes)}isValid(t){return xi(t)!==O.VALID?new cd(t,this,`KeyHash is not valid: ${t}`):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[Qt.prim]?e[Qt.prim](t):{string:t}}ExtractSchema(){return Qt.prim}generateSchema(){return{__michelsonType:Qt.prim,schema:Qt.prim}}ToKey({string:t,bytes:e}){return t||ks(e)}ToBigMapKey(t){return{key:{string:t},type:{prim:Qt.prim}}}findAndReturnTokens(t,e){return Qt.prim===t&&e.push(this),e}}Qt.prim="key_hash";class ud extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SignatureValidationError"}}class te extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string?t.string:t.bytes}isValid(t){return Zc(t)!==O.VALID?new ud(t,this,"Signature is not valid"):null}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[te.prim]?e[te.prim](t):{string:t}}ExtractSchema(){return te.prim}generateSchema(){return{__michelsonType:te.prim,schema:te.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:te.prim}}}findAndReturnTokens(t,e){return te.prim===t&&e.push(this),e}}te.prim="signature";class De extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get paramSchema(){return this.createToken(this.val.args[0],this.idx)}get returnSchema(){return this.createToken(this.val.args[1],this.idx+1)}Execute(t){return t.string?t.string:t}Encode(t){return t.pop()}EncodeObject(t,e){return e&&e[De.prim]?e[De.prim](t):t}ExtractSchema(){return{[De.prim]:{parameters:this.paramSchema.ExtractSchema(),returns:this.returnSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:De.prim,schema:{parameters:this.paramSchema.generateSchema(),returns:this.returnSchema.generateSchema()}}}findAndReturnTokens(t,e){return De.prim===t&&e.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,e),this.createToken(this.val.args[1],this.idx).findAndReturnTokens(t,e),e}}De.prim="lambda";class me extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){return t.string}Encode(...t){return{string:t.pop()}}EncodeObject(t,e){return e&&e[me.prim]?e[me.prim](t):{string:t}}ExtractSchema(){return me.prim}generateSchema(){return{__michelsonType:me.prim,schema:me.prim}}findAndReturnTokens(t,e){return me.prim===t&&e.push(this),e}}me.prim="operation";class ld extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SetValidationError"}}class ke extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get KeySchema(){return this.createToken(this.val.args[0],0)}isValid(t){return Array.isArray(t)?null:new ld(t,this,"Value must be an array")}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return e.sort((i,s)=>this.KeySchema.compare(i,s)).reduce((i,s)=>[...i,this.KeySchema.EncodeObject(s)],[])}Execute(t,e){return t.reduce((n,i)=>[...n,this.KeySchema.Execute(i,e)],[])}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[ke.prim]?e[ke.prim](t):t.sort((i,s)=>this.KeySchema.compare(i,s)).reduce((i,s)=>[...i,this.KeySchema.EncodeObject(s)],[])}ExtractSchema(){return ke.prim}generateSchema(){return{__michelsonType:ke.prim,schema:this.KeySchema.generateSchema()}}findAndReturnTokens(t,e){return ke.prim===t&&e.push(this),this.KeySchema.findAndReturnTokens(t,e),e}}ke.prim="set";class hd extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ChainIDValidationError"}}class ee extends et{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return ha(t)!==O.VALID?new hd(t,this,"ChainID is not valid"):null}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return ee.prim}generateSchema(){return{__michelsonType:ee.prim,schema:ee.prim}}Encode(t){const e=t.pop(),n=this.isValid(e);if(n)throw n;return{string:e}}EncodeObject(t,e){const n=this.isValid(t);if(n)throw n;return e&&e[ee.prim]?e[ee.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:ee.prim}}}findAndReturnTokens(t,e){return ee.prim===t&&e.push(this),e}}ee.prim="chain_id";class Do extends Error{constructor(){super("Tickets cannot be sent to the blockchain; they are created on-chain"),this.name="TicketEncodeError"}}const dd={prim:"contract"},pd={prim:"int"};class se extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new Do}EncodeObject(t,e){if(e&&e[se.prim])return e[se.prim](t,this.val);throw new Do}Execute(t,e){if(e&&e[se.prim])return e[se.prim](t,this.val);const n=this.createToken(dd,this.idx),i=this.valueToken,s=this.createToken(pd,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1].args[0],e),amount:s.Execute(t.args[1].args[1],e)}:{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1],e),amount:s.Execute(t.args[2],e)}}ExtractSchema(){return{ticketer:St.prim,value:this.valueToken.ExtractSchema(),amount:mt.prim}}generateSchema(){return{__michelsonType:se.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:St.prim,schema:St.prim},amount:{__michelsonType:mt.prim,schema:mt.prim}}}}findAndReturnTokens(t,e){return se.prim===t&&e.push(this),this.valueToken.findAndReturnTokens(t,e),e}}se.prim="ticket";class ko extends Error{constructor(){super("Ticket_deprecated cannot be sent to the blockchain; they are created on-chain"),this.name="TicketDeprecatedEncodeError"}}const fd={prim:"contract"},gd={prim:"int"};class oe extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new ko}EncodeObject(t,e){if(e&&e[oe.prim])return e[oe.prim](t,this.val);throw new ko}Execute(t,e){if(e&&e[oe.prim])return e[oe.prim](t,this.val);const n=this.createToken(fd,this.idx),i=this.valueToken,s=this.createToken(gd,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1].args[0],e),amount:s.Execute(t.args[1].args[1],e)}:{ticketer:n.Execute(t.args[0],e),value:i.Execute(t.args[1],e),amount:s.Execute(t.args[2],e)}}ExtractSchema(){return{ticketer:St.prim,value:this.valueToken.ExtractSchema(),amount:mt.prim}}generateSchema(){return{__michelsonType:oe.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:St.prim,schema:St.prim},amount:{__michelsonType:mt.prim,schema:mt.prim}}}}findAndReturnTokens(t,e){return oe.prim===t&&e.push(this),this.valueToken.findAndReturnTokens(t,e),e}}oe.prim="ticket_deprecated";class ri extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="NeverTokenError"}}class ye extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Encode(t){const e=t.pop();throw new ri(e,this,"Assigning a value to the type never is forbidden.")}EncodeObject(t,e){if(e&&e[ye.prim])return e[ye.prim](t);throw new ri(t,this,"Assigning a value to the type never is forbidden.")}Execute(t){throw new ri(t,this,"There is no literal value for the type never.")}ExtractSchema(){return ye.prim}generateSchema(){return{__michelsonType:ye.prim,schema:ye.prim}}findAndReturnTokens(t,e){return ye.prim===t&&e.push(this),e}}ye.prim="never";class ni extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SaplingStateValidationError"}}class re extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return typeof t=="object"&&Object.keys(t).length===0}Execute(t,e){if(e&&e[re.prim])return e[re.prim](t,this.val);if("int"in t)return t.int;throw new ni(t,this,`Sapling state is expecting an object with an int property. Got ${JSON.stringify(t)}`)}Encode(t){const e=t.pop();if(this.isValid(e))return[];throw new ni(e,this,`Invalid sapling_state. Received: ${e} while expecting: {}`)}EncodeObject(t,e){if(e&&e[re.prim])return e[re.prim](t);if(this.isValid(t))return[];throw new ni(t,this,`Invalid sapling_state. Received: ${t} while expecting: {}`)}ExtractSchema(){return{[re.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:re.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return re.prim===t&&e.push(this),e}}re.prim="sapling_state";class Bo extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SaplingTransactionValidationError"}}class Be extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){throw new Bo(t,this,"There is no literal value for the sapling_transaction type.")}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new Bo(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[Be.prim]?e[Be.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[Be.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:Be.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return Be.prim===t&&e.push(this),e}}Be.prim="sapling_transaction";class Ho extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="SaplingTransactionDeprecatedValidationError"}}class He extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t){throw new Ho(t,this,"There is no literal value for the sapling_transaction_deprecated type.")}validateBytes(t){const e=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(e&&e[2].length%2===0)return e[2];throw new Ho(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();return e=this.validateBytes(this.convertUint8ArrayToHexString(e)),{bytes:String(e).toString()}}EncodeObject(t,e){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),e&&e[He.prim]?e[He.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[He.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:He.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,e){return He.prim===t&&e.push(this),e}}He.prim="sapling_transaction_deprecated";class md extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="Bls12381frValidationError"}}class be extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new md(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();if(typeof e=="number")return{int:e.toString()};{e=this.convertUint8ArrayToHexString(e);const n=this.isValid(e);if(n)throw n;return{bytes:e}}}EncodeObject(t,e){if(e&&e[be.prim])return e[be.prim](t);if(typeof t=="number")return{int:t.toString()};{t=this.convertUint8ArrayToHexString(t);const n=this.isValid(t);if(n)throw n;return{bytes:t}}}Execute(t){return t.bytes}ExtractSchema(){return be.prim}generateSchema(){return{__michelsonType:be.prim,schema:be.prim}}findAndReturnTokens(t,e){return be.prim===t&&e.push(this),e}}be.prim="bls12_381_fr";class yd extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="Bls12381g1ValidationError"}}class Ee extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new yd(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const n=this.isValid(e);if(n)throw n;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const n=this.isValid(t);if(n)throw n;return e&&e[Ee.prim]?e[Ee.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Ee.prim}generateSchema(){return{__michelsonType:Ee.prim,schema:Ee.prim}}findAndReturnTokens(t,e){return Ee.prim===t&&e.push(this),e}}Ee.prim="bls12_381_g1";class bd extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="Bls12381g2ValidationError"}}class ve extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new bd(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const n=this.isValid(e);if(n)throw n;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const n=this.isValid(t);if(n)throw n;return e&&e[ve.prim]?e[ve.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return ve.prim}generateSchema(){return{__michelsonType:ve.prim,schema:ve.prim}}findAndReturnTokens(t,e){return ve.prim===t&&e.push(this),e}}ve.prim="bls12_381_g2";class Ed extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ChestValidationError"}}class _e extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new Ed(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const n=this.isValid(e);if(n)throw n;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const n=this.isValid(t);if(n)throw n;return e&&e[_e.prim]?e[_e.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return _e.prim}generateSchema(){return{__michelsonType:_e.prim,schema:_e.prim}}findAndReturnTokens(t,e){return _e.prim===t&&e.push(this),e}}_e.prim="chest";class vd extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="ChestKeyValidationError"}}class we extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}isValid(t){return/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0?null:new vd(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let e=t.pop();e=this.convertUint8ArrayToHexString(e);const n=this.isValid(e);if(n)throw n;return{bytes:e}}EncodeObject(t,e){t=this.convertUint8ArrayToHexString(t);const n=this.isValid(t);if(n)throw n;return e&&e[we.prim]?e[we.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return we.prim}generateSchema(){return{__michelsonType:we.prim,schema:we.prim}}findAndReturnTokens(t,e){return we.prim===t&&e.push(this),e}}we.prim="chest_key";class $o extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="GlobalConstantEncodingError"}}class _d extends Y{constructor(t,e,n){super(t,e,n),this.value=t,this.token=e,this.name="GlobalConstantDecodingError"}}class ne extends at{constructor(t,e,n){super(t,e,n),this.val=t,this.idx=e,this.fac=n}Execute(t,e){if(e&&e[ne.prim])return e[ne.prim](t,this.val);throw new _d(t,this,`Unable to decode a value represented by a globalThis constants. Please provide an expanded script to the Michelson-Encoder or semantics for the decoding. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}Encode(t){throw new $o(t,this,`Unable to encode a script containing globalThis constants. Please provide an expanded script to the Michelson-Encoder. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}EncodeObject(t,e){if(e&&e[ne.prim])return e[ne.prim](t);throw new $o(t,this,`Unable to encode a script containing globalThis constants. Please provide an expanded script to the Michelson-Encoder. The following globalThis constant hash was encountered: ${this.val.args[0].string}.`)}ExtractSchema(){return ne.prim}generateSchema(){return{__michelsonType:ne.prim,schema:{hash:this.val.args[0].string}}}findAndReturnTokens(t,e){return ne.prim===t&&e.push(this),e}}ne.prim="constant";const wd=[ot,Ft,zt,Nt,fe,ge,je,qt,G,St,Me,Wt,Yt,mr,Zt,mt,Jt,Xt,Qt,te,De,me,ke,ee,se,oe,ye,re,Be,He,be,Ee,ve,_e,we,ne];class Ad extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="Invalid token error"}}function er(r,t){if(Array.isArray(r))return new ot(r,t,er);const e=wd.find(n=>n.prim===r.prim);if(!e)throw new Ad("Malformed data expected a value with a valid prim property",r);return new e(r,t,er)}class Sd extends Error{constructor(t,e){super(`Unable to encode the parameter of the view: ${t}.`),this.smartContractViewName=t,this.originalError=e,this.name="ViewEncodingError"}}class jo extends Error{constructor(t){super(t),this.message=t,this.name="InvalidScriptError"}}class Ja extends Error{constructor(t){super("Invalid RPC response passed as argument(s)"),this.script=t,this.name="InvalidRpcResponseError"}}class Vo extends Error{constructor(t,e,n){super(`
      ${t}. Error encountered when trying to encode arguments: 

      [${e}]
    `),this.message=t,this.args=e,this.originalError=n,this.name="ParameterEncodingError"}}class Zr extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBigMapSchema"}}class Rd extends Error{constructor(t){super(t),this.message=t,this.name="InvalidBigMapDiff"}}class Od extends Error{constructor(t,e){super(`Unable to encode ${t}. ${e}`),this.obj=t,this.details=e,this.name="BigMapEncodingError"}}class Pd extends Error{constructor(t,e){super(`Unable to encode ${t}. ${e}`),this.obj=t,this.details=e,this.name="StorageEncodingError"}}class Td extends Error{constructor(t){super(t),this.message=t,this.name="MissingArgumentError"}}var Xa;const Qa=Symbol.for("taquito-schema-type-symbol");function Br(r,t=ot.prim){var e,n;if(Array.isArray(r))return Br({prim:t,args:r},t);const i=r;return i.prim===t&&i.args&&i.args.length>2?Object.assign(Object.assign({},i),{args:[(e=i.args)===null||e===void 0?void 0:e[0],{prim:t,args:(n=i.args)===null||n===void 0?void 0:n.slice(1)}]}):i}function Wi(r,t){if(r===void 0||t===void 0)return r===t;const e=Br(r),n=Br(t);return e.prim===n.prim&&(e.args===void 0&&n.args===void 0||e.args!==void 0&&n.args!==void 0&&e.args.length===n.args.length&&e.args.every((i,s)=>{var o,a;return Wi(i,(a=(o=n.args)===null||o===void 0?void 0:o[s])!==null&&a!==void 0?a:{})}))&&(e.annots===void 0&&n.annots===void 0||e.annots!==void 0&&n.annots!==void 0&&e.annots.length===n.annots.length&&e.annots.every((i,s)=>{var o;return i===((o=n.annots)===null||o===void 0?void 0:o[s])}))}class Lt{constructor(t){if(this.val=t,this[Xa]=!0,this.root=er(t,0),this.root instanceof Nt)this.bigMap=this.root;else if(this.isExpressionExtended(t)&&t.prim==="pair"){const e=t.args[0];this.isExpressionExtended(e)&&e.prim==="big_map"&&(this.bigMap=new Nt(e,0,er))}}static isSchema(t){return t&&t[Qa]===!0}static fromRPCResponse(t){const e=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.find(n=>{if(Array.isArray(n))this.fromRPCResponse({script:{code:n,storage:t.script.storage}});else{const i=n;return i.prim?i.prim==="storage":!1}});if(!e||!Array.isArray(e.args))throw new Ja(t.script);return new Lt(e.args[0])}isExpressionExtended(t){return"prim"in t&&Array.isArray(t.args)}removeTopLevelAnnotation(t){return(this.root instanceof ot||this.root instanceof G)&&this.root.hasAnnotations()&&typeof t=="object"&&Object.keys(t).length===1?t[Object.keys(t)[0]]:t}Execute(t,e){const n=this.root.Execute(t,e);return this.removeTopLevelAnnotation(n)}Typecheck(t){if(this.root instanceof Nt&&Number.isInteger(Number(t))||this.root instanceof se&&t.ticketer&&t.value&&t.amount||this.root instanceof oe&&t.ticketer&&t.value&&t.amount||this.root instanceof je&&this.root.ValueSchema instanceof Nt)return!0;try{return this.root.EncodeObject(t),!0}catch{return!1}}ExecuteOnBigMapDiff(t,e){if(!this.bigMap)throw new Zr("Big map schema is undefined");if(!Array.isArray(t))throw new Rd("Big map diff must be an array");const n=t.map(({key:i,value:s})=>({args:[i,s]}));return this.bigMap.Execute(n,e)}ExecuteOnBigMapValue(t,e){if(!this.bigMap)throw new Zr("No big map schema");return this.bigMap.ValueSchema.Execute(t,e)}EncodeBigMapKey(t){if(!this.bigMap)throw new Zr("Big map schema is undefined");try{return this.bigMap.KeySchema.ToBigMapKey(t)}catch(e){throw new Od("big map key",e)}}Encode(t,e){try{return this.root.EncodeObject(t,e)}catch(n){throw n instanceof Y?n:new Pd("storage object",n)}}ExtractSchema(){return this.removeTopLevelAnnotation(this.root.ExtractSchema())}generateSchema(){return this.removeTopLevelAnnotation(this.root.generateSchema())}ComputeState(t,e){if(!this.bigMap)throw new Zr("Big map schema is undefined");const n=t.reduce((i,s)=>Object.assign(Object.assign({},i),this.ExecuteOnBigMapDiff(s.contents[0].metadata.operation_result.big_map_diff)),{});return Object.assign(Object.assign({},this.Execute(e)),{[this.bigMap.annot()]:n})}FindFirstInTopLevelPair(t,e){return this.findValue(this.root.val,t,e)}findValue(t,e,n){if(Wi(n,t))return e;if(Array.isArray(t)||t.prim==="pair"){const i=Br(t),s=Br(e,"Pair");if(i.args===void 0||s.args===void 0)throw new Td("Tokens have no arguments");if(i.args[0])return this.findValue(i.args[0],s.args[0],n)||this.findValue(i.args[1],s.args[1],n)}}findToken(t){const e=[];return this.root.findAndReturnTokens(t,e)}}Xa=Qa;class cr{constructor(t){this.root=er(t,0)}static fromRPCResponse(t){const e=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.find(n=>n.prim==="parameter");if(!e||!Array.isArray(e.args))throw new Ja(t.script);return new cr(e.args[0])}get isMultipleEntryPoint(){return this.root instanceof G||this.root instanceof mr&&this.root.subToken()instanceof G}get hasAnnotation(){return this.isMultipleEntryPoint?Object.keys(this.ExtractSchema())[0]!=="0":!0}Execute(t,e){return this.root.Execute(t,e)}Encode(...t){try{return this.root.Encode(t.reverse())}catch(e){throw e instanceof Y?e:new Vo("Unable to encode parameter",t.toString(),e)}}EncodeObject(t,e){try{return this.root.EncodeObject(t,e)}catch(n){throw n instanceof Y?n:new Vo("Unable to encode parameter object",t,n)}}ExtractSchema(){return this.root.ExtractSchema()}generateSchema(){return this.root.generateSchema()}ExtractSignatures(){return this.root.ExtractSignature()}}class Yi{constructor(t){if(t.length!==4||!("string"in t[0]))throw new jo(`Invalid on-chain view: ${JSON.stringify(t)}`);this.viewName=t[0].string,this.viewArgsType=t[1],this.viewReturnType=t[2],this.instructions=t[3],this.rootArgsType=er(this.viewArgsType,0),this.rootReturnType=er(this.viewReturnType,0)}static fromRPCResponse(t){const e=[],n=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.filter(i=>i.prim==="view");return n&&n.forEach(i=>{if(!i.args||i.args.length!==4)throw new jo(`Invalid on-chain view found in the script: ${JSON.stringify(i)}`);e.push(new Yi(i.args))}),e}encodeViewArgs(t){try{return this.rootArgsType.EncodeObject(t)}catch(e){throw new Sd(this.viewName,e)}}decodeViewResult(t,e){return this.rootReturnType.Execute(t,e)}extractArgsSchema(){return this.rootArgsType.ExtractSchema()}extractResultSchema(){return this.rootReturnType.ExtractSchema()}}class Le{constructor(t,e){this.tag=t,this.type=e}static fromMichelineValue(t){var e,n;return new Le((e=t.annots)===null||e===void 0?void 0:e[0],(n=t.args)===null||n===void 0?void 0:n[0])}static fromRPCResponse(t){const e=[];return t.script.code.forEach(n=>{!("prim"in n)||n.prim!=="code"||!("args"in n)||!n.args||e.push(...Le.extractEventsRecursively(n.args))}),Le.removeDuplicates(e)}static removeDuplicates(t){const e=[];return t.forEach(n=>{e.findIndex(s=>s.tag===n.tag&&Wi(s.type,n.type))===-1&&e.push(n)}),e}static extractEventsRecursively(t){return Array.isArray(t)?t.flatMap(e=>Le.extractEventsRecursively(e)):"prim"in t?t.prim==="EMIT"?[Le.fromMichelineValue(t)]:!("args"in t)||!t.args?[]:t.args.flatMap(e=>Le.extractEventsRecursively(e)):[]}}const Uo=Symbol(),Et=Symbol("source_reference");class Ye extends Error{constructor(t,e,n){super(n),this.src=t,this.idx=e,Object.setPrototypeOf(this,Ye.prototype)}}var vt;(function(r){r[r.Comment=0]="Comment",r[r.Number=1]="Number",r[r.String=2]="String",r[r.Bytes=3]="Bytes",r[r.Ident=4]="Ident"})(vt||(vt={}));const Id=new RegExp("\\s"),Nd=new RegExp("[:@%_A-Za-z]"),xd=new RegExp("[@%_\\.A-Za-z0-9]"),Go=new RegExp("[0-9]"),Ld=new RegExp("[0-9a-fA-F]");function*ii(r,t=!1){let e=0;for(;e<r.length;){for(;e<r.length&&Id.test(r[e]);)e++;if(e===r.length)return;const n=r[e],i=e;if(Nd.test(n)){for(e++;e<r.length&&xd.test(r[e]);)e++;yield{t:vt.Ident,v:r.slice(i,e),first:i,last:e}}else if(r.length-e>1&&r.substring(e,e+2)==="0x"){for(e+=2;e<r.length&&Ld.test(r[e]);)e++;if(e-i&1)throw new Ye(r,e,"Bytes literal length is expected to be power of two");yield{t:vt.Bytes,v:r.slice(i,e),first:i,last:e}}else if(Go.test(n)||n==="-"){n==="-"&&e++;const s=e;for(;e<r.length&&Go.test(r[e]);)e++;if(s===e)throw new Ye(r,e,"Number literal is too short");yield{t:vt.Number,v:r.slice(i,e),first:i,last:e}}else if(n==='"'){e++;let s=!1;for(;e<r.length&&(s||r[e]!=='"');e++)!s&&r[e]==="\\"?s=!0:s=!1;if(e===r.length)throw new Ye(r,e,"Unterminated string literal");e++,yield{t:vt.String,v:r.slice(i,e),first:i,last:e}}else if(n==="#"){for(e++;e<r.length&&r[e]!==`
`;)e++;t&&(yield{t:vt.Comment,v:r.slice(i,e),first:i,last:e})}else if(r.length-e>1&&r.substring(e,e+2)==="/*"){for(e+=2;e<r.length&&!(r.length-e>1&&r.substring(e,e+2)==="*/");)e++;if(e===r.length)throw new Ye(r,e,"Unterminated C style comment");e+=2,t&&(yield{t:vt.Comment,v:r.slice(i,e),first:i,last:e})}else if(n==="("||n===")"||n==="{"||n==="}"||n===";")e++,yield{t:n,v:n,first:i,last:e};else throw new Ye(r,e,`Invalid character at offset ${e}: \`${n}'`)}}const Jr=Symbol("ref_contract");var Pe;(function(r){r.Ps9mPmXa="Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P",r.PtCJ7pwo="PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY",r.PsYLVpVv="PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt",r.PsddFKi3="PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP",r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdoTez="PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLoren="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANAD="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangzH="PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakarta="PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(Pe||(Pe={}));const tc=Pe.Psithaca2,Ko={Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P:0,PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY:1,PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt:2,PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP:3,Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd:4,PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU:5,PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS:5,PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb:6,PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo:7,PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq:8,PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA:8,PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i:9,PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV:10,PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r:11,PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx:11,PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP:12,Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A:12,PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw:13,PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY:13,PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg:14,PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW:15,PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc:16,PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1:16,PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf:17,ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK:18};function ur(r,t){return Ko[r]<Ko[t]}class Ct extends Error{constructor(t,e){super(e),this.prim=t,Object.setPrototypeOf(this,Ct.prototype)}}function Z(r,t){var e,n;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new Ct(r,`macro ${r.prim} expects ${t} arguments, was given ${(n=r.args)===null||n===void 0?void 0:n.length}`)}function Ir(r){if(r.annots===void 0)return!0;throw new Ct(r,`unexpected annotation on macro ${r.prim}: ${r.annots}`)}function Fo(r,t){if("int"in t)return!0;throw new Ct(r,`macro ${r.prim} expects int argument`)}function xr(r,t,e,n){let i=0,s=0;const o=[null,null];let a;if(i===t.length)throw new Ct(r,`unexpected end: ${r.prim}`);let c=t[i++];switch(c){case"P":{const{r:p,n:h,an:b}=xr(r,t.slice(i),e.slice(s),n);a=p,i+=h,s+=b;break}case"A":s!==e.length&&(o[0]=e[s++]);break;default:throw new Ct(r,`${r.prim}: unexpected character: ${c}`)}let l;if(i===t.length)throw new Ct(r,`unexpected end: ${r.prim}`);switch(c=t[i++],c){case"P":{const{r:p,n:h,an:b}=xr(r,t.slice(i),e.slice(s),n);l=p.map(([E,_])=>[E+1,_]),i+=h,s+=b;break}case"I":s!==e.length&&(o[1]=e[s++]);break;default:throw new Ct(r,`${r.prim}: unexpected character: ${c}`)}return{r:n(a,l,[0,o]),n:i,an:s}}function bn(r,t,e,n){const i=t[0];switch(i){case"A":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CAR",annots:["@%%"]},bn(r,t.slice(1),[],n)]]},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%@","%@",...e]}]:n.a;case"D":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CDR",annots:["@%%"]},bn(r,t.slice(1),[],n)]]},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%@",...e]}]:n.d;default:throw new Ct(r,`${r.prim}: unexpected character: ${i}`)}}function Cd(r,t){let e=r.length;for(;e>0&&r[e-1]===t;)e--;return r.slice(0,e)}function si(r){const t=[],e=[];if(r!==void 0)for(const n of r)(n.length!==0&&n[0]==="%"?t:e).push(n);return{fields:t,rest:e}}function ct({prim:r,annots:t,args:e}){return Object.assign(Object.assign({prim:r},t&&{annots:t}),e&&{args:e})}const Md=/^P[PAI]{3,}R$/,Dd=/^UNP[PAI]{2,}R$/,kd=/^C[AD]{2,}R$/,Bd=/^SET_C[AD]+R$/,Hd=/^MAP_C[AD]+R$/,$d=/^DI{2,}P$/,jd=/^DU+P$/;function Vd(r,t){const e=(t==null?void 0:t.protocol)||tc;function n(i){return i!==void 0?[{prim:"RENAME",annots:i}]:[]}switch(r.prim){case"CMPEQ":case"CMPNEQ":case"CMPLT":case"CMPGT":case"CMPLE":case"CMPGE":if(Z(r,0))return[{prim:"COMPARE"},ct({prim:r.prim.slice(3),annots:r.annots})];break;case"IFEQ":case"IFNEQ":case"IFLT":case"IFGT":case"IFLE":case"IFGE":if(Z(r,2))return[{prim:r.prim.slice(2)},ct({prim:"IF",annots:r.annots,args:r.args})];break;case"IFCMPEQ":case"IFCMPNEQ":case"IFCMPLT":case"IFCMPGT":case"IFCMPLE":case"IFCMPGE":if(Z(r,2))return[{prim:"COMPARE"},{prim:r.prim.slice(5)},ct({prim:"IF",annots:r.annots,args:r.args})];break;case"FAIL":if(Z(r,0)&&Ir(r))return[{prim:"UNIT"},{prim:"FAILWITH"}];break;case"ASSERT":if(Z(r,0)&&Ir(r))return[{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_EQ":case"ASSERT_NEQ":case"ASSERT_LT":case"ASSERT_GT":case"ASSERT_LE":case"ASSERT_GE":if(Z(r,0)&&Ir(r))return[{prim:r.prim.slice(7)},{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_CMPEQ":case"ASSERT_CMPNEQ":case"ASSERT_CMPLT":case"ASSERT_CMPGT":case"ASSERT_CMPLE":case"ASSERT_CMPGE":if(Z(r,0)&&Ir(r))return[[{prim:"COMPARE"},{prim:r.prim.slice(10)}],{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_NONE":if(Z(r,0)&&Ir(r))return[{prim:"IF_NONE",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_SOME":if(Z(r,0))return[{prim:"IF_NONE",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],n(r.annots)]}];break;case"ASSERT_LEFT":if(Z(r,0))return[{prim:"IF_LEFT",args:[n(r.annots),[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_RIGHT":if(Z(r,0))return[{prim:"IF_LEFT",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],n(r.annots)]}];break;case"IF_SOME":if(Z(r,2))return[ct({prim:"IF_NONE",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"IF_RIGHT":if(Z(r,2))return[ct({prim:"IF_LEFT",annots:r.annots,args:[r.args[1],r.args[0]]})];break;case"CAR":case"CDR":if(r.args!==void 0){if(Z(r,1)&&Fo(r,r.args[0])){const i=parseInt(r.args[0].int,10);return ct({prim:"GET",args:[{int:r.prim==="CAR"?String(i*2+1):String(i*2)}],annots:r.annots})}}else return r}if(Md.test(r.prim)&&Z(r,0)){const{fields:i,rest:s}=si(r.annots),{r:o}=xr(r,r.prim.slice(1),i,(a,c,l)=>[...a||[],...c||[],l]);return o.map(([a,c],l)=>{const p=[...Cd(c,null).map(b=>b===null?"%":b),...a===0&&l===o.length-1?s:[]],h=ct({prim:"PAIR",annots:p.length!==0?p:void 0});return a===0?h:{prim:"DIP",args:a===1?[[h]]:[{int:String(a)},[h]]}})}if(Dd.test(r.prim))if(ur(e,Pe.PtEdo2Zk)&&Z(r,0)){const{r:i}=xr(r,r.prim.slice(3),r.annots||[],(s,o,a)=>[a,...o||[],...s||[]]);return i.map(([s,o])=>{const a=[{prim:"DUP"},ct({prim:"CAR",annots:o[0]!==null?[o[0]]:void 0}),{prim:"DIP",args:[[ct({prim:"CDR",annots:o[1]!==null?[o[1]]:void 0})]]}];return s===0?a:{prim:"DIP",args:s===1?[[a]]:[{int:String(s)},[a]]}})}else{if(r.prim==="UNPAIR")return r;if(Z(r,0)){const{r:i}=xr(r,r.prim.slice(3),[],(s,o,a)=>[a,...o||[],...s||[]]);return i.map(([s])=>{const o=ct({prim:"UNPAIR"});return s===0?o:{prim:"DIP",args:s===1?[[o]]:[{int:String(s)},[o]]}})}}if(kd.test(r.prim)&&Z(r,0)){const i=[...r.prim.slice(1,r.prim.length-1)];return i.map((s,o)=>{const a=o===i.length-1?r.annots:void 0;switch(s){case"A":return ct({prim:"CAR",annots:a});case"D":return ct({prim:"CDR",annots:a});default:throw new Ct(r,`unexpected character: ${s}`)}})}if(Bd.test(r.prim)&&Z(r,0)){const{fields:i,rest:s}=si(r.annots);if(i.length>1)throw new Ct(r,`unexpected annotation on macro ${r.prim}: ${i}`);const o=i.length!==0?{a:[{prim:"DUP"},{prim:"CAR",annots:i},{prim:"DROP"},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:[i[0],"%@"]}],d:[{prim:"DUP"},{prim:"CDR",annots:i},{prim:"DROP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",i[0]]}]}:{a:[{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%","%@"]}],d:[{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%"]}]};return bn(r,r.prim.slice(5,r.prim.length-1),s,o)}if(Hd.test(r.prim)&&Z(r,1)){const{fields:i}=si(r.annots);if(i.length>1)throw new Ct(r,`unexpected annotation on macro ${r.prim}: ${i}`);const s={a:[{prim:"DUP"},{prim:"CDR",annots:["@%%"]},{prim:"DIP",args:[[ct({prim:"CAR",annots:i.length!==0?["@"+i[0].slice(1)]:void 0}),r.args[0]]]},{prim:"SWAP"},{prim:"PAIR",annots:[i.length!==0?i[0]:"%","%@"]}],d:[{prim:"DUP"},ct({prim:"CDR",annots:i.length!==0?["@"+i[0].slice(1)]:void 0}),r.args[0],{prim:"SWAP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",i.length!==0?i[0]:"%"]}]};return bn(r,r.prim.slice(5,r.prim.length-1),[],s)}if($d.test(r.prim)&&Z(r,1)){let i=0;for(;r.prim[1+i]==="I";)i++;return ct({prim:"DIP",args:[{int:String(i)},r.args[0]]})}if(jd.test(r.prim)){let i=0;for(;r.prim[1+i]==="U";)i++;if(ur(e,Pe.PtEdo2Zk)){if(i===1){if(r.args===void 0)return r;Z(r,1)&&Fo(r,r.args[0])&&(i=parseInt(r.args[0].int,10))}else Z(r,0);return i===1?[ct({prim:"DUP",annots:r.annots})]:i===2?[{prim:"DIP",args:[[ct({prim:"DUP",annots:r.annots})]]},{prim:"SWAP"}]:[{prim:"DIP",args:[{int:String(i-1)},[ct({prim:"DUP",annots:r.annots})]]},{prim:"DIG",args:[{int:String(i)}]}]}else{if(i===1)return r;if(Z(r,0))return ct({prim:"DUP",args:[{int:String(i)}],annots:r.annots})}}return r}function Ud(r,t){return r.args!==void 0&&r.args.length===1&&"string"in r.args[0]&&r.args[0].string in t?t[r.args[0].string]:r}class dr extends Error{constructor(t,e){super(e),this.token=t,Object.setPrototypeOf(this,dr.prototype)}}class Gt extends Error{constructor(t,e){super(e),this.node=t,Object.setPrototypeOf(this,Gt.prototype)}}const oi=new dr(null,"Unexpected EOF");function zo(r){return r.t===vt.Ident&&(r.v[0]==="@"||r.v[0]==="%"||r.v[0]===":")}const Gd=new RegExp("^-?[0-9]+$"),Kd=new RegExp("^([0-9a-fA-F]{2})*$");class Xe{constructor(t){this.opt=t}expand(t){var e,n,i;if(((e=this.opt)===null||e===void 0?void 0:e.expandGlobalConstant)!==void 0&&t.prim==="constant"){const s=Ud(t,this.opt.expandGlobalConstant);return s!==t&&(s[Et]=Object.assign(Object.assign({},t[Et]||{first:0,last:0}),{globalConstant:t})),s}if(((n=this.opt)===null||n===void 0?void 0:n.expandMacros)===void 0||!((i=this.opt)===null||i===void 0)&&i.expandMacros){const s=Vd(t,this.opt);return s!==t&&(s[Et]=Object.assign(Object.assign({},t[Et]||{first:0,last:0}),{macro:t})),s}else return t}parseListExpr(t,e){var n;const i={first:e.first,last:e.last},s=e.t==="(";let o;if(s){if(o=t.next(),o.done)throw oi;i.last=o.value.last}else o={value:e};if(o.value.t!==vt.Ident)throw new dr(o.value,`not an identifier: ${o.value.v}`);const a={prim:o.value.v,[Et]:i};for(;;){const c=t.next();if(c.done){if(s)throw oi;break}else if(c.value.t===")"){if(!s)throw new dr(c.value,"unexpected closing bracket");i.last=c.value.last;break}else if(zo(c.value))a.annots=a.annots||[],a.annots.push(c.value.v),i.last=c.value.last;else{a.args=a.args||[];const l=this.parseExpr(t,c.value);i.last=((n=l[Et])===null||n===void 0?void 0:n.last)||i.last,a.args.push(l)}}return this.expand(a)}parseArgs(t,e){var n;const i={first:e.first,last:e.last},s={prim:e.v,[Et]:i};for(;;){const o=t.next();if(o.done||o.value.t==="}"||o.value.t===";")return[s,o];if(zo(o.value))i.last=o.value.last,s.annots=s.annots||[],s.annots.push(o.value.v);else{const a=this.parseExpr(t,o.value);i.last=((n=a[Et])===null||n===void 0?void 0:n.last)||i.last,s.args=s.args||[],s.args.push(a)}}}parseSequenceExpr(t,e){var n,i;const s={first:e.first,last:e.last},o=[];o[Et]=s;const a=e.t==="{";let c=e.t==="{"?null:{value:e};for(;;){if(c===null&&(c=t.next(),c.done||(s.last=c.value.last)),c.done){if(a)throw oi;return o}if(c.value.t==="}"){if(a)return o;throw new dr(c.value,"unexpected closing bracket")}else if(c.value.t===vt.Ident){const[l,p]=this.parseArgs(t,c.value);s.last=((n=l[Et])===null||n===void 0?void 0:n.last)||s.last,o.push(this.expand(l)),c=p}else{const l=this.parseExpr(t,c.value);s.last=((i=l[Et])===null||i===void 0?void 0:i.last)||s.last,o.push(l),c=null}c===null&&(c=t.next(),c.done||(s.last=c.value.last)),!c.done&&c.value.t===";"&&(c=null)}}parseExpr(t,e){switch(e.t){case vt.Ident:return this.expand({prim:e.v,[Et]:{first:e.first,last:e.last}});case vt.Number:return{int:e.v,[Et]:{first:e.first,last:e.last}};case vt.String:return{string:JSON.parse(e.v),[Et]:{first:e.first,last:e.last}};case vt.Bytes:return{bytes:e.v.slice(2),[Et]:{first:e.first,last:e.last}};case"{":return this.parseSequenceExpr(t,e);default:return this.parseListExpr(t,e)}}parseSequence(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=ii(t),n=e.next();return n.done?null:this.parseSequenceExpr(e,n.value)}parseList(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=ii(t),n=e.next();return n.done?null:this.parseListExpr(e,n.value)}parseMichelineExpression(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const e=ii(t),n=e.next();return n.done?null:this.parseExpr(e,n.value)}parseScript(t){return this.parseSequence(t)}parseData(t){return this.parseList(t)}parseJSON(t){if(typeof t!="object")throw new TypeError(`object type was expected, got ${typeof t} instead`);if(Array.isArray(t)){const e=[];for(const n of t){if(n===null||typeof n!="object")throw new Gt(n,`unexpected sequence element: ${n}`);e.push(this.parseJSON(n))}return e}else if("prim"in t){const e=t;if(typeof e.prim=="string"&&(e.annots===void 0||Array.isArray(e.annots))&&(e.args===void 0||Array.isArray(e.args))){const n={prim:e.prim};if(e.annots!==void 0){for(const i of e.annots)if(typeof i!="string")throw new Gt(i,`string expected: ${i}`);n.annots=e.annots}if(e.args!==void 0){n.args=[];for(const i of e.args){if(i===null||typeof i!="object")throw new Gt(i,`unexpected argument: ${i}`);n.args.push(this.parseJSON(i))}}return this.expand(n)}throw new Gt(t,`malformed prim expression: ${t}`)}else if("string"in t){if(typeof t.string=="string")return{string:t.string};throw new Gt(t,`malformed string literal: ${t}`)}else if("int"in t){if(typeof t.int=="string"&&Gd.test(t.int))return{int:t.int};throw new Gt(t,`malformed int literal: ${t}`)}else if("bytes"in t){if(typeof t.bytes=="string"&&Kd.test(t.bytes))return{bytes:t.bytes};throw new Gt(t,`malformed bytes literal: ${t}`)}else throw new Gt(t,`unexpected object: ${t}`)}}const Fd=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],zd=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];class bi extends Error{constructor(t){super(t),this.message=t,this.name="Base58DecodingError"}}function qo(r){const t=(r.length+9)%64,e=t===0?0:64-t;if(r.length>268435455)throw new Jc("",`: Invalid length ${r.length} is too big -- SHA-256.`);const n=r.length<<3,i=[...r,128,...new Array(e).fill(0),0,0,0,0,n>>24&255,n>>16&255,n>>8&255,n&255];function s(p,h){return p>>>h|p<<32-h}const o=[...Fd],a=new Array(64),c=new Array(8);for(let p=0;p<i.length;p+=64){let h=p,b=0;for(;b<16;)a[b]=i[h]<<24|i[h+1]<<16|i[h+2]<<8|i[h+3],h+=4,b++;for(;b<64;){const E=s(a[b-15],7)^s(a[b-15],18)^a[b-15]>>>3,_=s(a[b-2],17)^s(a[b-2],19)^a[b-2]>>>10;a[b]=(_|0)+a[b-7]+E+a[b-16]|0,b++}for(let E=0;E<8;E++)c[E]=o[E];for(let E=0;E<64;E++){const _=s(c[0],2)^s(c[0],13)^s(c[0],22),L=s(c[4],6)^s(c[4],11)^s(c[4],25),I=c[7]+L+(c[4]&c[5]^~c[4]&c[6])+zd[E]+a[E]|0,S=_+(c[0]&c[1]^c[0]&c[2]^c[1]&c[2])|0;c[7]=c[6],c[6]=c[5],c[5]=c[4],c[4]=c[3]+I|0,c[3]=c[2],c[2]=c[1],c[1]=c[0],c[0]=I+S|0}for(let E=0;E<8;E++)o[E]=o[E]+c[E]|0}const l=[];for(const p of o)l.push(p>>24&255),l.push(p>>16&255),l.push(p>>8&255),l.push(p&255);return l}const ai=[0,1,2,3,4,5,6,7,8,-1,-1,-1,-1,-1,-1,-1,9,10,11,12,13,14,15,16,-1,17,18,19,20,21,-1,22,23,24,25,26,27,28,29,30,31,32,-1,-1,-1,-1,-1,-1,33,34,35,36,37,38,39,40,41,42,43,-1,44,45,46,47,48,49,50,51,52,53,54,55,56,57];function Wo(r,t){const e=r.charCodeAt(t)-49;if(e>=ai.length||ai[e]===-1)throw new bi(`Unexpected character at position ${t}: ${r[t]}`);return ai[e]}function qd(r){const t=[];let e=0;for(;e<r.length&&Wo(r,e)===0;)e++;let n=e;for(;e<r.length;){let i=Wo(r,e++),s=0;for(;i!==0||s<t.length;){const o=(t[s]||0)*58+i;t[s++]=o%256,i=Math.floor(o/256)}}for(;n-- >0;)t.push(0);return t.reverse()}function ec(r){const t=qd(r);if(t.length<4)throw new bi(`Data is too short ${t.length}`);const e=t.slice(0,t.length-4),n=t.slice(t.length-4),i=qo(qo(e));if(n[0]!==i[0]||n[1]!==i[1]||n[2]!==i[2]||n[3]!==i[3])throw new bi("Invalid checksum");return e}class Wd extends Error{constructor(t){super(t),this.message=t,this.name="InvalidContractError"}}class Yd extends Error{constructor(t){super(t),this.message=t,this.name="InvalidTypeExpressionError"}}class Zd extends Error{constructor(t){super(t),this.message=t,this.name="InvalidDataExpressionError"}}class Jd extends Error{constructor(t){super(`Contract has no entrypoint named: '${t}'`),this.entrypoint=t,this.name="InvalidEntrypointError"}}class Xd extends Error{constructor(t){super(t),this.message=t,this.name="LongIntegerError"}}class Qd extends Error{constructor(t){super(`Unable to parse hex byte: ${t}`),this.hexByte=t,this.name="HexParseError"}}class Mt extends Error{constructor(t,e){super(e),this.val=t,Object.setPrototypeOf(this,Mt.prototype)}}class x extends Mt{constructor(t,e,n){super(t,n),e!==void 0&&(this.data=e),Object.setPrototypeOf(this,x.prototype)}}class rc{constructor(t){if(this.neg=!1,this.buf=[],t!==void 0)if(typeof t=="string")for(let e=0;e<t.length;e++){const n=t.charCodeAt(e);if(e===0&&n===45)this.neg=!0;else{if(n<48||n>57)throw new Xd(`unexpected character in integer constant: ${t[e]}`);this.append(n-48)}}else t<0?(this.neg=!0,this.append(-t)):this.append(t)}append(t){let e=0;for(;t!==0||e<this.buf.length;){const n=(this.buf[e]||0)*10+t;this.buf[e++]=n%256,t=Math.floor(n/256)}}cmp(t){if(this.neg!==t.neg)return(t.neg?1:0)-(this.neg?1:0);{let e=0;if(this.buf.length!==t.buf.length)e=this.buf.length<t.buf.length?-1:1;else if(this.buf.length!==0){let n=t.buf.length-1;for(;n>=0&&this.buf[n]===t.buf[n];)n--;e=n<0?0:this.buf[n]<t.buf[n]?-1:1}return this.neg?e===0?0:-e:e}}get sign(){return this.buf.length===0?0:this.neg?-1:1}}function pr(r){const t=[];for(let e=0;e<r.length;e+=2){const n=parseInt(r.slice(e,e+2),16);if(Number.isNaN(n))return null;t.push(n)}return t}function Ei(r){try{return new rc(r),!0}catch{return!1}}function nc(r){try{return new rc(r).sign>=0}catch{return!1}}const tp=/^(@%|@%%|%@|[@:%]([_0-9a-zA-Z][_0-9a-zA-Z.%@]*)?)$/;function yr(r,t){if(Array.isArray(r))return{};let e,n,i;if(r.annots!==void 0){for(const s of r.annots)if(s.length!==0){if(!tp.test(s)||!(t!=null&&t.specialVar)&&(s==="@%"||s==="@%%")||!(t!=null&&t.specialFields)&&s==="%@")throw new Mt(r,`${r.prim}: unexpected annotation: ${s}`);switch(s[0]){case"%":(t!=null&&t.emptyFields||s.length>1)&&(e=e||[],e.push(s));break;case":":s.length>1&&(n=n||[],n.push(s));break;case"@":(t!=null&&t.emptyVar||s.length>1)&&(i=i||[],i.push(s));break}}}return{f:e,t:n,v:i}}const ep={BlockHash:[32,[1,52]],OperationHash:[32,[5,116]],OperationListHash:[32,[133,233]],OperationListListHash:[32,[29,159,109]],ProtocolHash:[32,[2,170]],ContextHash:[32,[79,199]],ED25519PublicKeyHash:[20,[6,161,159]],SECP256K1PublicKeyHash:[20,[6,161,161]],P256PublicKeyHash:[20,[6,161,164]],ContractHash:[20,[2,90,121]],CryptoboxPublicKeyHash:[16,[153,103]],ED25519Seed:[32,[13,15,58,7]],ED25519PublicKey:[32,[13,15,37,217]],SECP256K1SecretKey:[32,[17,162,224,201]],P256SecretKey:[32,[16,81,238,189]],ED25519EncryptedSeed:[56,[7,90,60,179,41]],SECP256K1EncryptedSecretKey:[56,[9,237,241,174,150]],P256EncryptedSecretKey:[56,[9,48,57,115,171]],SECP256K1PublicKey:[33,[3,254,226,86]],P256PublicKey:[33,[3,178,139,127]],SECP256K1Scalar:[33,[38,248,136]],SECP256K1Element:[33,[5,92,0]],ED25519SecretKey:[64,[43,246,78,7]],ED25519Signature:[64,[9,245,205,134,18]],SECP256K1Signature:[64,[13,115,101,19,63]],P256Signature:[64,[54,240,44,52]],GenericSignature:[64,[4,130,43]],ChainID:[4,[87,82,0]],RollupAddress:[20,[1,128,120,31]],TxRollupL2Address:[20,[6,161,166]]};function Se(r,...t){const e=ec(r);for(const n of t){const[i,s]=ep[n];if(e.length===i+s.length){let o=0;for(;o<s.length&&e[o]===s[o];)o++;if(o===s.length)return[n,e.slice(s.length)]}}return null}function It(r,t){const e=t,n=Array.isArray(e)?e:e.args;return n.length===2?r==="pair"?{prim:"pair",args:n}:{prim:"Pair",args:n}:Object.assign(Object.assign({},Array.isArray(e)?{prim:r}:e),{args:[n[0],{prim:r,args:n.slice(1)}]})}function Re(r){return Array.isArray(r)||r.prim==="pair"}function ic(r){return Array.isArray(r)||"prim"in r&&r.prim==="Pair"}const rp=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])[T ]([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):([0-5][0-9]))$/;function sc(r){if("string"in r){if(nc(r.string))return new Date(parseInt(r.string,10));if(rp.test(r.string)){const t=new Date(r.string);if(!Number.isNaN(t.valueOf))return t}}else if(Ei(r.int))return new Date(parseInt(r.int,10));return null}function np(r){const t=[];for(let e=0;e<r.length;e+=2){const n=r.slice(e,e+2),i=parseInt(n,16);if(Number.isNaN(i))throw new Qd(n);t.push(i)}return t}function or(r){return r.map(t=>(t>>4&15).toString(16)+(t&15).toString(16)).join("")}const ip=31,oc={ABS:!0,ADD:!0,ADDRESS:!0,AMOUNT:!0,AND:!0,APPLY:!0,BALANCE:!0,BLAKE2B:!0,CAR:!0,CDR:!0,CHAIN_ID:!0,CHECK_SIGNATURE:!0,COMPARE:!0,CONCAT:!0,CONS:!0,EDIV:!0,EQ:!0,EXEC:!0,FAILWITH:!0,GE:!0,GET_AND_UPDATE:!0,GT:!0,HASH_KEY:!0,IMPLICIT_ACCOUNT:!0,INT:!0,ISNAT:!0,JOIN_TICKETS:!0,KECCAK:!0,LE:!0,LEVEL:!0,LSL:!0,LSR:!0,LT:!0,MEM:!0,MUL:!0,NEG:!0,NEQ:!0,NEVER:!0,NOT:!0,NOW:!0,OR:!0,PACK:!0,PAIRING_CHECK:!0,READ_TICKET:!0,SAPLING_VERIFY_UPDATE:!0,SELF:!0,SELF_ADDRESS:!0,SENDER:!0,SET_DELEGATE:!0,SHA256:!0,SHA3:!0,SHA512:!0,SIZE:!0,SLICE:!0,SOME:!0,SOURCE:!0,SPLIT_TICKET:!0,SUB:!0,SWAP:!0,TICKET:!0,TICKET_DEPRECATED:!0,TOTAL_VOTING_POWER:!0,TRANSFER_TOKENS:!0,UNIT:!0,VOTING_POWER:!0,XOR:!0,RENAME:!0,OPEN_CHEST:!0,SUB_MUTEZ:!0,MIN_BLOCK_TIME:!0,BYTES:!0,NAT:!0},ac=Object.assign({},oc,{CONTRACT:!0,CREATE_CONTRACT:!0,DIG:!0,DIP:!0,DROP:!0,DUG:!0,DUP:!0,EMIT:!0,EMPTY_BIG_MAP:!0,EMPTY_MAP:!0,EMPTY_SET:!0,GET:!0,IF:!0,IF_CONS:!0,IF_LEFT:!0,IF_NONE:!0,ITER:!0,LAMBDA:!0,LAMBDA_REC:!0,LEFT:!0,LOOP:!0,LOOP_LEFT:!0,MAP:!0,NIL:!0,NONE:!0,PAIR:!0,PUSH:!0,RIGHT:!0,SAPLING_EMPTY_STATE:!0,UNPACK:!0,UNPAIR:!0,UPDATE:!0,CAST:!0,VIEW:!0}),cc={unit:!0,never:!0,bool:!0,int:!0,nat:!0,string:!0,chain_id:!0,bytes:!0,mutez:!0,key_hash:!0,key:!0,signature:!0,timestamp:!0,address:!0,tx_rollup_l2_address:!0},Sr=Object.assign({},cc,{or:!0,pair:!0,set:!0,big_map:!0,contract:!0,lambda:!0,list:!0,map:!0,operation:!0,option:!0,bls12_381_g1:!0,bls12_381_g2:!0,bls12_381_fr:!0,sapling_transaction:!0,sapling_transaction_deprecated:!0,sapling_state:!0,ticket:!0,chest_key:!0,chest:!0});class z extends Mt{constructor(t,e){super(t,e),this.val=t,Object.setPrototypeOf(this,z.prototype)}}function he(r){return"prim"in r}function sp(r){return Array.isArray(r)||"prim"in r}function uc(r){if(he(r))return!0;throw new z(r,"prim expression expected")}function $e(r){if(Array.isArray(r))return!0;throw new z(r,"sequence expression expected")}function ft(r){if(sp(r))return!0;throw new z(r,"prim or sequence expression expected")}function ci(r){if(r.int[0]==="-")throw new z(r,"natural number expected")}function un(r){if("int"in r)return!0;throw new z(r,"int literal expected")}function lc(r){if("string"in r)return!0;throw new z(r,"string literal expected")}function K(r,t){var e;if(t===0&&r.args===void 0||((e=r.args)===null||e===void 0?void 0:e.length)===t)return!0;throw new z(r,`${t} arguments expected`)}function Ht(r){var t,e;if(Array.isArray(r)){for(const n of r){if(!Array.isArray(n)&&!he(n))throw new z(r,"sequence or prim expected");Ht(n)}return!0}if(uc(r)){if(Object.prototype.hasOwnProperty.call(oc,r.prim))return K(r,0),!0;switch(r.prim){case"DROP":case"PAIR":case"UNPAIR":case"DUP":case"UPDATE":case"GET":r.args!==void 0&&K(r,1)&&un(r.args[0])&&ci(r.args[0]);break;case"DIG":case"DUG":case"SAPLING_EMPTY_STATE":K(r,1)&&un(r.args[0])&&ci(r.args[0]);break;case"NONE":case"LEFT":case"RIGHT":case"NIL":case"CAST":K(r,1)&&Oe(r.args[0]);break;case"UNPACK":K(r,1)&&Zi(r.args[0]);break;case"CONTRACT":K(r,1)&&Ln(r.args[0]);break;case"IF_NONE":case"IF_LEFT":case"IF_CONS":case"IF":K(r,2)&&($e(r.args[0])&&Ht(r.args[0]),$e(r.args[1])&&Ht(r.args[1]));break;case"MAP":case"ITER":case"LOOP":case"LOOP_LEFT":K(r,1)&&Ht(r.args[0]);break;case"CREATE_CONTRACT":K(r,1)&&dc(r.args[0]);break;case"DIP":if(((t=r.args)===null||t===void 0?void 0:t.length)===2)un(r.args[0])&&ci(r.args[0]),$e(r.args[1])&&Ht(r.args[1]);else if(((e=r.args)===null||e===void 0?void 0:e.length)===1)$e(r.args[0])&&Ht(r.args[0]);else throw new z(r,"1 or 2 arguments expected");break;case"PUSH":K(r,2)&&(br(r.args[0]),Ze(r.args[1]));break;case"EMPTY_SET":K(r,1)&&Te(r.args[0]);break;case"EMPTY_MAP":K(r,2)&&(Te(r.args[0]),Oe(r.args[1]));break;case"EMPTY_BIG_MAP":K(r,2)&&(Te(r.args[0]),Cn(r.args[1]));break;case"LAMBDA_REC":case"LAMBDA":K(r,3)&&(Oe(r.args[0]),Oe(r.args[1]),$e(r.args[2])&&Ht(r.args[2]));break;case"VIEW":K(r,2)&&(lc(r.args[0])&&hc(r.args[0]),Oe(r.args[1])&&br(r.args[1]));break;case"EMIT":r.args&&r.args.length>0?K(r,1):K(r,0);break;default:throw new z(r,"instruction expected")}}return!0}function Te(r){if(ft(r)){if(Array.isArray(r)||r.prim==="pair"||r.prim==="or"||r.prim==="option")nr(r,t=>Te(t));else if(!Object.prototype.hasOwnProperty.call(cc,r.prim))throw new z(r,`${r.prim}: type is not comparable`)}return!0}function Zi(r){if(ft(r)&&he(r)){if(!Object.prototype.hasOwnProperty.call(Sr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket")throw new z(r,`${r.prim}: type can't be used inside PACK/UNPACK instructions`);nr(r,t=>Zi(t))}return!0}function br(r){if(ft(r)&&he(r)){if(!Object.prototype.hasOwnProperty.call(Sr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state"||r.prim==="ticket"||r.prim==="contract")throw new z(r,`${r.prim}: type can't be pushed`);nr(r,t=>br(t))}return!0}function Ji(r){if(ft(r)&&he(r)){if(!Object.prototype.hasOwnProperty.call(Sr,r.prim)||r.prim==="operation"||r.prim==="contract")throw new z(r,`${r.prim}: type can't be used as part of a storage`);nr(r,t=>Ji(t))}return!0}function Ln(r){if(ft(r)&&he(r)){if(!Object.prototype.hasOwnProperty.call(Sr,r.prim)||r.prim==="operation")throw new z(r,`${r.prim}: type can't be used as part of a parameter`);nr(r,t=>Ln(t))}return!0}function Cn(r){if(ft(r)&&he(r)){if(!Object.prototype.hasOwnProperty.call(Sr,r.prim)||r.prim==="big_map"||r.prim==="operation"||r.prim==="sapling_state")throw new z(r,`${r.prim}: type can't be used inside a big_map`);nr(r,t=>Cn(t))}return!0}const op=new RegExp("^[a-zA-Z0-9_.%@]*$");function hc(r){if(r.string.length>ip)throw new z(r,`view name too long: ${r.string}`);if(!op.test(r.string))throw new z(r,`invalid character(s) in view name: ${r.string}`)}function Oe(r){if(ft(r)&&he(r)){if(!Object.prototype.hasOwnProperty.call(Sr,r.prim))throw new z(r,"type expected");nr(r,t=>Oe(t))}return!0}function nr(r,t){if(Array.isArray(r)||r.prim==="pair"){const e=Array.isArray(r)?r:r.args;if(e===void 0||e.length<2)throw new z(r,"at least 2 arguments expected");return e.forEach(n=>{ft(n)&&t(n)}),!0}switch(r.prim){case"option":case"list":K(r,1)&&ft(r.args[0])&&t(r.args[0]);break;case"contract":K(r,1)&&Ln(r.args[0]);break;case"or":K(r,2)&&ft(r.args[0])&&ft(r.args[1])&&(t(r.args[0]),t(r.args[1]));break;case"lambda":K(r,2)&&(Oe(r.args[0]),Oe(r.args[1]));break;case"set":K(r,1)&&Te(r.args[0]);break;case"map":K(r,2)&&ft(r.args[0])&&ft(r.args[1])&&(Te(r.args[0]),t(r.args[1]));break;case"big_map":K(r,2)&&ft(r.args[0])&&ft(r.args[1])&&(Te(r.args[0]),Cn(r.args[1]),t(r.args[1]));break;case"ticket":K(r,1)&&ft(r.args[0])&&Te(r.args[0]);break;case"sapling_state":case"sapling_transaction":K(r,1)&&un(r.args[0]);break;default:K(r,0)}return!0}function Ze(r){if("int"in r||"string"in r||"bytes"in r)return!0;if(Array.isArray(r)){let t=0;for(const e of r)he(e)&&e.prim==="Elt"?(K(e,2)&&(Ze(e.args[0]),Ze(e.args[1])),t++):Ze(e);if(t!==0&&t!==r.length)throw new z(r,"data entries and map elements can't be intermixed");return!0}if(he(r))switch(r.prim){case"Unit":case"True":case"False":case"None":K(r,0);break;case"Pair":if(r.args===void 0||r.args.length<2)throw new z(r,"at least 2 arguments expected");for(const t of r.args)Ze(t);break;case"Left":case"Right":case"Some":K(r,1)&&Ze(r.args[0]);break;case"Lambda_rec":r.args&&Ht(r.args);break;default:if(Object.prototype.hasOwnProperty.call(ac,r.prim))Ht(r);else throw new z(r,"data entry or instruction expected")}else throw new z(r,"data entry expected");return!0}function dc(r){if($e(r)){const t={},e={};for(const n of r)if(uc(n)){if(n.prim!=="view"){if(n.prim in t)throw new z(r,`duplicate contract section: ${n.prim}`);t[n.prim]=!0}switch(n.prim){case"code":K(n,1)&&$e(n.args[0])&&Ht(n.args[0]);break;case"parameter":if(K(n,1)&&Ln(n.args[0]),n.annots)throw new z(n,"Annotation must be part of the parameter type");break;case"storage":K(n,1)&&Ji(n.args[0]);break;case"view":if(K(n,4)){if(lc(n.args[0])){const i=n.args[0];if(i.string in e)throw new z(r,`duplicate view name: ${i.string}`);e[i.string]=!0,hc(i)}br(n.args[1]),br(n.args[2]),$e(n.args[3])&&Ht(n.args[3])}break;default:throw new z(r,`unexpected contract section: ${n.prim}`)}}}return!0}function pc(r){return Object.prototype.hasOwnProperty.call(ac,r.prim)}function vi(r){if(!Array.isArray(r))return!1;for(const t of r)if("prim"in t){if(pc(t))throw new Mt(r,`Instruction outside of a lambda: ${JSON.stringify(r)}`);if(t.prim==="Elt")throw new Mt(r,`Elt item outside of a map literal: ${JSON.stringify(r)}`)}return!0}function ap(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(e[n[i]]=r[n[i]]);return e}const cp=["parameter","storage","code","False","Elt","Left","None","Pair","Right","Some","True","Unit","PACK","UNPACK","BLAKE2B","SHA256","SHA512","ABS","ADD","AMOUNT","AND","BALANCE","CAR","CDR","CHECK_SIGNATURE","COMPARE","CONCAT","CONS","CREATE_ACCOUNT","CREATE_CONTRACT","IMPLICIT_ACCOUNT","DIP","DROP","DUP","EDIV","EMPTY_MAP","EMPTY_SET","EQ","EXEC","FAILWITH","GE","GET","GT","HASH_KEY","IF","IF_CONS","IF_LEFT","IF_NONE","INT","LAMBDA","LE","LEFT","LOOP","LSL","LSR","LT","MAP","MEM","MUL","NEG","NEQ","NIL","NONE","NOT","NOW","OR","PAIR","PUSH","RIGHT","SIZE","SOME","SOURCE","SENDER","SELF","STEPS_TO_QUOTA","SUB","SWAP","TRANSFER_TOKENS","SET_DELEGATE","UNIT","UPDATE","XOR","ITER","LOOP_LEFT","ADDRESS","CONTRACT","ISNAT","CAST","RENAME","bool","contract","int","key","key_hash","lambda","list","map","big_map","nat","option","or","pair","set","signature","string","bytes","mutez","timestamp","unit","operation","address","SLICE","DIG","DUG","EMPTY_BIG_MAP","APPLY","chain_id","CHAIN_ID","LEVEL","SELF_ADDRESS","never","NEVER","UNPAIR","VOTING_POWER","TOTAL_VOTING_POWER","KECCAK","SHA3","PAIRING_CHECK","bls12_381_g1","bls12_381_g2","bls12_381_fr","sapling_state","sapling_transaction_deprecated","SAPLING_EMPTY_STATE","SAPLING_VERIFY_UPDATE","ticket","TICKET_DEPRECATED","READ_TICKET","SPLIT_TICKET","JOIN_TICKETS","GET_AND_UPDATE","chest","chest_key","OPEN_CHEST","VIEW","view","constant","SUB_MUTEZ","tx_rollup_l2_address","MIN_BLOCK_TIME","sapling_transaction","EMIT","Lambda_rec","LAMBDA_REC","TICKET","BYTES","NAT"],up=Object.assign({},...cp.map((r,t)=>({[r]:t})));var Ce;(function(r){r[r.Int=0]="Int",r[r.String=1]="String",r[r.Sequence=2]="Sequence",r[r.Prim0=3]="Prim0",r[r.Prim0Annot=4]="Prim0Annot",r[r.Prim1=5]="Prim1",r[r.Prim1Annot=6]="Prim1Annot",r[r.Prim2=7]="Prim2",r[r.Prim2Annot=8]="Prim2Annot",r[r.Prim=9]="Prim",r[r.Bytes=10]="Bytes"})(Ce||(Ce={}));class fr{constructor(){this.buffer=[]}get length(){return this.buffer.length}writeBytes(t){this.buffer.push(...t.map(e=>e&255))}writeUint8(t){const e=t|0;this.buffer.push(e&255)}writeUint16(t){const e=t|0;this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeUint32(t){const e=t|0;this.buffer.push(e>>24&255),this.buffer.push(e>>16&255),this.buffer.push(e>>8&255),this.buffer.push(e&255)}writeInt8(t){this.writeUint8(t)}writeInt16(t){this.writeUint16(t)}writeInt32(t){this.writeUint32(t)}}const xe=new Error("bounds out of range");class Er{constructor(t,e=0,n=t.length){this.buffer=t,this.idx=e,this.cap=n}get length(){return this.cap-this.idx}readBytes(t){if(this.cap-this.idx<t)throw xe;const e=this.buffer.slice(this.idx,this.idx+t);return this.idx+=t,e}reader(t){if(this.cap-this.idx<t)throw xe;const e=new Er(this.buffer,this.idx,this.idx+t);return this.idx+=t,e}copy(){return new Er(this.buffer,this.idx,this.cap)}readUint8(){if(this.cap-this.idx<1)throw xe;return this.buffer[this.idx++]>>>0}readUint16(){if(this.cap-this.idx<2)throw xe;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)>>>0}readUint32(){if(this.cap-this.idx<4)throw xe;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],n=this.buffer[this.idx++],i=this.buffer[this.idx++];return(t<<24|e<<16|n<<8|i)>>>0}readInt8(){if(this.cap-this.idx<1)throw xe;return this.buffer[this.idx++]<<24>>24}readInt16(){if(this.cap-this.idx<2)throw xe;const t=this.buffer[this.idx++],e=this.buffer[this.idx++];return(t<<8|e)<<16>>16}readInt32(){if(this.cap-this.idx<4)throw xe;const t=this.buffer[this.idx++],e=this.buffer[this.idx++],n=this.buffer[this.idx++],i=this.buffer[this.idx++];return t<<24|e<<16|n<<8|i}}var vr;(function(r){r[r.Implicit=0]="Implicit",r[r.Originated=1]="Originated"})(vr||(vr={}));var Ve;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(Ve||(Ve={}));function fc(r){let t;const e=r.readUint8();switch(e){case Ve.ED25519:t="ED25519PublicKeyHash";break;case Ve.SECP256K1:t="SECP256K1PublicKeyHash";break;case Ve.P256:t="P256PublicKeyHash";break;default:throw new Error(`unknown public key hash tag: ${e}`)}return{type:t,hash:r.readBytes(20)}}function lp(r){let t;const e=r.readUint8();switch(e){case vr.Implicit:t=fc(r);break;case vr.Originated:t={type:"ContractHash",hash:r.readBytes(20)},r.readBytes(1);break;default:throw new Error(`unknown address tag: ${e}`)}if(r.length!==0){const n=new TextDecoder;t.entryPoint=n.decode(new Uint8Array(r.readBytes(r.length)))}return t}function gc(r,t){let e;switch(r.type){case"ED25519PublicKeyHash":e=Ve.ED25519;break;case"SECP256K1PublicKeyHash":e=Ve.SECP256K1;break;case"P256PublicKeyHash":e=Ve.P256;break;default:throw new Error(`unexpected address type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.hash))}function hp(r,t){if(r.type==="ContractHash"?(t.writeUint8(vr.Originated),t.writeBytes(Array.from(r.hash)),t.writeUint8(0)):(t.writeUint8(vr.Implicit),gc(r,t)),r.entryPoint!==void 0&&r.entryPoint!==""&&r.entryPoint!=="default"){const n=new TextEncoder().encode(r.entryPoint);t.writeBytes(Array.from(n))}}var Ue;(function(r){r[r.ED25519=0]="ED25519",r[r.SECP256K1=1]="SECP256K1",r[r.P256=2]="P256"})(Ue||(Ue={}));function dp(r){let t,e;const n=r.readUint8();switch(n){case Ue.ED25519:e="ED25519PublicKey",t=32;break;case Ue.SECP256K1:e="SECP256K1PublicKey",t=33;break;case Ue.P256:e="P256PublicKey",t=33;break;default:throw new Error(`unknown public key tag: ${n}`)}return{type:e,publicKey:r.readBytes(t)}}function pp(r,t){let e;switch(r.type){case"ED25519PublicKey":e=Ue.ED25519;break;case"SECP256K1PublicKey":e=Ue.SECP256K1;break;case"P256PublicKey":e=Ue.P256;break;default:throw new Error(`unexpected public key type: ${r.type}`)}t.writeUint8(e),t.writeBytes(Array.from(r.publicKey))}function ln(r,t,e){var n,i;const[s,o]=e(r);if(Array.isArray(s)){const l=new fr;for(const p of s){const h=o.next();if(h.done)throw new Error("REPORT ME: iterator is done");ln(p,l,h.value)}t.writeUint8(Ce.Sequence),t.writeUint32(l.length),t.writeBytes(l.buffer);return}if("string"in s){const p=new TextEncoder().encode(s.string);t.writeUint8(Ce.String),t.writeUint32(p.length),t.writeBytes(Array.from(p));return}if("int"in s){t.writeUint8(Ce.Int);let l=BigInt(s.int);const p=l<0;p&&(l=-l);let h=0;do{const b=BigInt(h===0?6:7);let E=l&(BigInt(1)<<b)-BigInt(1);l>>=b,l&&(E|=BigInt(128)),h===0&&p&&(E|=BigInt(64)),t.writeUint8(Number(E)),h++}while(l);return}if("bytes"in s){const l=np(s.bytes);t.writeUint8(Ce.Bytes),t.writeUint32(l.length),t.writeBytes(l);return}const a=up[s.prim];if(a===void 0)throw new TypeError(`Can't encode primary: ${s.prim}`);const c=(((n=s.args)===null||n===void 0?void 0:n.length)||0)<3?Ce.Prim0+(((i=s.args)===null||i===void 0?void 0:i.length)||0)*2+(s.annots===void 0||s.annots.length===0?0:1):Ce.Prim;if(t.writeUint8(c),t.writeUint8(a),s.args!==void 0)if(s.args.length<3)for(const l of s.args){const p=o.next();if(p.done)throw new Error("REPORT ME: iterator is done");ln(l,t,p.value)}else{const l=new fr;for(const p of s.args){const h=o.next();if(h.done)throw new Error("REPORT ME: iterator is done");ln(p,l,h.value)}t.writeUint32(l.length),t.writeBytes(l.buffer)}if(s.annots!==void 0&&s.annots.length!==0){const p=new TextEncoder().encode(s.annots.join(" "));t.writeUint32(p.length),t.writeBytes(Array.from(p))}else s.args!==void 0&&s.args.length>=3&&t.writeUint32(0)}const fp=r=>"prim"in r&&(r.prim==="Left"||r.prim==="Right"),gp=r=>"prim"in r&&(r.prim==="Some"||r.prim==="None"),Je=r=>{if(Re(r))return t=>{if(!ic(t))throw new x(r,t,`pair expected: ${JSON.stringify(t)}`);vi(t);const e=It("pair",r);return[It("Pair",t),function*(){for(const i of e.args)yield Je(i)}()]};switch(r.prim){case"or":return t=>{if(!fp(t))throw new x(r,t,`or expected: ${JSON.stringify(t)}`);return[t,function*(){yield Je(r.args[t.prim==="Left"?0:1])}()]};case"option":return t=>{if(!gp(t))throw new x(r,t,`option expected: ${JSON.stringify(t)}`);return[t,function*(){t.prim==="Some"&&(yield Je(r.args[0]))}()]};case"list":case"set":return t=>{if(!Array.isArray(t))throw new x(r,t,`${r.prim} expected: ${JSON.stringify(t)}`);return[t,function*(){for(const e of t)yield Je(r.args[0])}()]};case"map":return t=>{if(!Array.isArray(t))throw new x(r,t,`map expected: ${JSON.stringify(t)}`);return[t,function*(){for(const e of t)yield n=>{if(!("prim"in n)||n.prim!=="Elt")throw new x(r,n,`map element expected: ${JSON.stringify(n)}`);return[n,function*(){for(const i of r.args)yield Je(i)}()]}}()]};case"chain_id":return t=>{if(!("bytes"in t)&&!("string"in t))throw new x(r,t,`chain id expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=Se(t.string,"ChainID");if(n===null)throw new x(r,t,`chain id base58 expected: ${t.string}`);e={bytes:or(n[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"signature":return t=>{if(!("bytes"in t)&&!("string"in t))throw new x(r,t,`signature expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=Se(t.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature");if(n===null)throw new x(r,t,`signature base58 expected: ${t.string}`);e={bytes:or(n[1])}}else e=t;return[e,[][Symbol.iterator]()]};case"key_hash":return t=>{if(!("bytes"in t)&&!("string"in t))throw new x(r,t,`key hash expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=Se(t.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash");if(n===null)throw new x(r,t,`key hash base58 expected: ${t.string}`);const i=new fr;gc({type:n[0],hash:n[1]},i),e={bytes:or(i.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"key":return t=>{if(!("bytes"in t)&&!("string"in t))throw new x(r,t,`public key expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=Se(t.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey");if(n===null)throw new x(r,t,`public key base58 expected: ${t.string}`);const i=new fr;pp({type:n[0],publicKey:n[1]},i),e={bytes:or(i.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"address":return t=>{if(!("bytes"in t)&&!("string"in t))throw new x(r,t,`address expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=t.string.split("%"),i=Se(n[0],"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash");if(i===null)throw new x(r,t,`address base58 expected: ${t.string}`);const s=new fr;hp({type:i[0],hash:i[1],entryPoint:n.length>1?n[1]:void 0},s),e={bytes:or(s.buffer)}}else e=t;return[e,[][Symbol.iterator]()]};case"timestamp":return t=>{if(!("string"in t)&&!("int"in t))throw new x(r,t,`timestamp expected: ${JSON.stringify(t)}`);let e;if("string"in t){const n=sc(t);if(n===null)throw new x(r,t,`can't parse date: ${t.string}`);e={int:String(Math.floor(n.getTime()/1e3))}}else e=t;return[e,[][Symbol.iterator]()]};default:return En}},mp=r=>"prim"in r&&r.prim==="PUSH",En=r=>mp(r)?(Ht(r),[r,function*(){yield En,yield Je(r.args[0])}()]):[r,function*(){for(;;)yield En}()];function yp(r,t){const e=new fr;return e.writeUint8(5),ln(r,e,t!==void 0?Je(t):En),e.buffer}function bp(r,t){return{bytes:or(yp(r,t))}}function Ep(r){const t=pr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new Er(new Uint8Array(t));return lp(e)}function vp(r){const t=pr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new Er(new Uint8Array(t));return fc(e)}function _p(r){const t=pr(r.bytes);if(t===null)throw new Error(`can't parse bytes: "${r.bytes}"`);const e=new Er(new Uint8Array(t));return dp(e)}class $ extends Mt{constructor(t,e,n){super(t,n),this.stackState=e,Object.setPrototypeOf(this,$.prototype)}}function q(r){return Array.isArray(r)?"pair":r.prim}function vn(r){return"prim"in r?r.args:r}function Vt(r,t,e=!1){if(q(r)!==q(t))throw new x(r,void 0,`types mismatch: ${q(r)} != ${q(t)}`);const n=[yr(r),yr(t)];if(n[0].t&&n[1].t&&n[0].t[0]!==n[1].t[0])throw new x(r,void 0,`${q(r)}: type names mismatch: ${n[0].t[0]} != ${n[1].t[0]}`);if(e&&n[0].f&&n[1].f&&n[0].f[0]!==n[1].f[0])throw new x(r,void 0,`${q(r)}: field names mismatch: ${n[0].f[0]} != ${n[1].f}`);if(Re(r)){const i=It("pair",r),s=It("pair",t);Vt(i.args[0],s.args[0],!0),Vt(i.args[1],s.args[1],!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":case"ticket":Vt(r.args[0],t.args[0]);break;case"or":Vt(r.args[0],t.args[0],!0),Vt(r.args[1],t.args[1],!0);break;case"lambda":case"map":case"big_map":Vt(r.args[0],t.args[0]),Vt(r.args[1],t.args[1]);break;case"sapling_state":case"sapling_transaction":if(parseInt(r.args[0].int,10)!==parseInt(t.args[0].int,10))throw new x(r,void 0,`${q(r)}: type argument mismatch: ${r.args[0].int} != ${t.args[0].int}`)}}function mc(r,t){if(r.length!==t.length)throw new x(r,void 0,`stack length mismatch: ${r.length} != ${t.length}`);for(let e=0;e<r.length;e++)Vt(r[e],t[e])}function X(r,t=!1){var e,n,i;if(!Array.isArray(r)){const s=yr(r);if((((e=s.t)===null||e===void 0?void 0:e.length)||0)>1)throw new x(r,void 0,`${r.prim}: at most one type annotation allowed: ${r.annots}`);if(t){if((((n=s.f)===null||n===void 0?void 0:n.length)||0)>1)throw new x(r,void 0,`${r.prim}: at most one field annotation allowed: ${r.annots}`)}else if((((i=s.f)===null||i===void 0?void 0:i.length)||0)>0)throw new x(r,void 0,`${r.prim}: field annotations aren't allowed: ${r.annots}`)}if(Re(r)){const s=vn(r);for(const o of s)X(o,!0);return}switch(r.prim){case"option":case"list":case"contract":case"set":X(r.args[0]);break;case"or":for(const s of r.args)X(s,!0);break;case"lambda":case"map":case"big_map":X(r.args[0]),X(r.args[1])}}function yc(r){if(!Array.isArray(r))return!1;for(const t of r)if(!(Array.isArray(t)&&yc(t)||"prim"in t&&pc(t)))return!1;return!0}function jt(r,t,e){if(Re(t)){if(ic(r)){vi(r);const n=It("Pair",r),i=It("pair",t);jt(n.args[0],i.args[0],e),jt(n.args[1],i.args[1],e);return}throw new x(t,r,`pair expected: ${JSON.stringify(r)}`)}switch(t.prim){case"int":if("int"in r&&Ei(r.int))return;throw new x(t,r,`integer value expected: ${JSON.stringify(r)}`);case"nat":case"mutez":if("int"in r&&nc(r.int))return;throw new x(t,r,`natural value expected: ${JSON.stringify(r)}`);case"string":if("string"in r)return;throw new x(t,r,`string value expected: ${JSON.stringify(r)}`);case"bytes":case"bls12_381_g1":case"bls12_381_g2":if("bytes"in r&&pr(r.bytes)!==null)return;throw new x(t,r,`bytes value expected: ${JSON.stringify(r)}`);case"bool":if("prim"in r&&(r.prim==="True"||r.prim==="False"))return;throw new x(t,r,`boolean value expected: ${JSON.stringify(r)}`);case"key_hash":if("string"in r&&Se(r.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash")!==null)return;if("bytes"in r)try{vp(r);return}catch{}throw new x(t,r,`key hash expected: ${JSON.stringify(r)}`);case"timestamp":if(("string"in r||"int"in r)&&sc(r)!==null)return;throw new x(t,r,`timestamp expected: ${JSON.stringify(r)}`);case"address":if("string"in r){let n=r.string;const i=r.string.indexOf("%");if(i>=0&&(n=r.string.slice(0,i)),Se(n,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash","TxRollupL2Address","RollupAddress")!==null)return}else if("bytes"in r)try{Ep(r);return}catch{}throw new x(t,r,`address expected: ${JSON.stringify(r)}`);case"key":if("string"in r&&Se(r.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey")!==null)return;if("bytes"in r)try{_p(r);return}catch{}throw new x(t,r,`public key expected: ${JSON.stringify(r)}`);case"unit":if("prim"in r&&r.prim==="Unit")return;throw new x(t,r,`unit value expected: ${JSON.stringify(r)}`);case"signature":if("bytes"in r||"string"in r&&Se(r.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature")!==null)return;throw new x(t,r,`signature expected: ${JSON.stringify(r)}`);case"chain_id":if(("bytes"in r||"string"in r)&&("string"in r?ec(r.string):pr(r.bytes))!==null)return;throw new x(t,r,`chain id expected: ${JSON.stringify(r)}`);case"option":if("prim"in r){if(r.prim==="None")return;if(r.prim==="Some"){jt(r.args[0],t.args[0],e);return}}throw new x(t,r,`option expected: ${JSON.stringify(r)}`);case"list":case"set":if(vi(r)){for(const n of r)jt(n,t.args[0],e);return}throw new x(t,r,`${t.prim} expected: ${JSON.stringify(r)}`);case"or":if("prim"in r){if(r.prim==="Left"){jt(r.args[0],t.args[0],e);return}else if(r.prim==="Right"){jt(r.args[0],t.args[1],e);return}}throw new x(t,r,`union (or) expected: ${JSON.stringify(r)}`);case"lambda":if(yc(r)){const n=ut(r,[t.args[0]],e);if("failed"in n)throw new x(t,r,`function is failed with error type: ${n.failed}`);if(n.length!==1)throw new x(t,r,"function must return a value");Vt(t.args[1],n[0]);return}throw new x(t,r,`function expected: ${JSON.stringify(r)}`);case"map":case"big_map":if(Array.isArray(r)){for(const n of r){if(!("prim"in n)||n.prim!=="Elt")throw new x(t,r,`map elements expected: ${JSON.stringify(r)}`);jt(n.args[0],t.args[0],e),jt(n.args[1],t.args[1],e)}return}throw new x(t,r,`${t.prim} expected: ${JSON.stringify(r)}`);case"bls12_381_fr":if("int"in r&&Ei(r.int)||"bytes"in r&&pr(r.bytes)!==null)return;throw new x(t,r,`BLS12-381 element expected: ${JSON.stringify(r)}`);case"sapling_state":if(Array.isArray(r))return;throw new x(t,r,`sapling state expected: ${JSON.stringify(r)}`);case"ticket":jt(r,{prim:"pair",args:[{prim:"address"},t.args[0],{prim:"nat"}]},e);return;default:throw new x(t,r,`type ${q(t)} don't have Michelson literal representation`)}}function wp(r,t,e){let n=t,i=t,s=0;for(const o of r){const a=ut(o,i,e);if(n=a,"failed"in a)break;i=a,s++}if("failed"in n&&n.level==0&&(!("prim"in n.failed)||n.failed.prim!=="never")&&s!==r.length-1)throw new $(r,n,"FAIL must appear in a tail position");if((e==null?void 0:e.traceCallback)!==void 0){const o={op:r,in:t,out:n};e.traceCallback(o)}return"failed"in n?{failed:n.failed,level:n.level+1}:n}function ut(r,t,e){const n=(e==null?void 0:e.protocol)||tc;if(Array.isArray(r))return wp(r,t,e);const i=r;function s(f,...T){if(t.length<T.length+f)throw new $(i,t,`${i.prim}: stack must have at least ${T.length} element(s)`);let N=f;for(const U of T){if(U!==null&&U.length!==0){let j=0;for(;j<U.length&&U[j]!==q(t[N]);)j++;if(j===U.length)throw new $(i,t,`${i.prim}: stack type mismatch: [${N}] expected to be ${U}, got ${q(t[N])} instead`)}N++}return t.slice(f,T.length+f)}function o(f){return(...T)=>{try{return f(...T)}catch(N){throw N instanceof Mt?new $(i,t,N.message):N}}}function a(f){return T=>{try{return f(T)}catch(N){throw N instanceof Mt?new $(i,t,N.message):N}}}const c=o(yr),l=o(mc),p=o(Vt),h=a(Te),b=a(Zi),E=a(Ji),_=a(br),L=a(Cn);function I(f,T){const N=c(i,Object.assign(Object.assign({},T),{emptyFields:f.f!==void 0&&f.f>1,emptyVar:f.v!==void 0&&f.v>1})),U=(j,ht,u)=>{if(j&&j.length>(ht||0))throw new $(i,t,`${i.prim}: at most ${ht||0} ${u} annotations allowed`)};return U(N.f,f.f,"field"),U(N.t,f.t,"type"),U(N.v,f.v,"variable"),N}function S(f,T){const N=f,U=Array.isArray(N)?{prim:"pair",args:N}:N,j=c(U),ht=T.v!==void 0||T.t!==void 0||T.f!==void 0?[...(T.v===null?j.v:T.v)||[],...(T.t===null?j.t:T.t)||[],...(T.f===null?j.f:T.f)||[]]:void 0,u=ap(U,["annots"]);return Object.assign(Object.assign({},u),ht&&ht.length!==0&&{annots:ht})}function v(f,T){const N=I({v:1});return S(f,{v:N.v!==void 0?N.v:T!==void 0?[T]:null,t:null})}function Pr(f,T,N,U,j){var ht,u,m,w;const R=(ht=c(T).f)===null||ht===void 0?void 0:ht[0],Pt=(u=N.f)===null||u===void 0?void 0:u[U];if(Pt!==void 0&&Pt!=="%"&&R!==void 0&&Pt!==R)throw new $(i,t,`${i.prim}: field names doesn't match: ${Pt} !== ${R}`);const bt=(m=N.v)===null||m===void 0?void 0:m[U],Bt=(w=c(f).v)===null||w===void 0?void 0:w[0];return S(T,{t:null,v:bt?bt==="@%"?R?["@"+R.slice(1)]:void 0:bt==="@%%"?Bt?["@"+Bt.slice(1)+"."+(R?R.slice(1):j)]:R?["@"+R.slice(1)]:void 0:[bt]:null})}function H(f,T,N=T){const U=It("pair",f);if(N===1)return[U.args[0]];if(N===2)return U.args;const j=U.args[1];if(Re(j))return[U.args[0],...H(j,T,N-1)];throw new $(i,t,`${i.prim}: at least ${T} fields are expected`)}function zr(f,T,N=T){if(N===0)return f;const U=It("pair",f);if(N===1)return U.args[0];const j=U.args[1];if(Re(j))return zr(j,T,N-2);if(N===2)return j;throw new $(i,t,`${i.prim}: at least ${T+1} fields are expected`)}function qr(f,T,N,U=N){if(U===0)return T;const j=It("pair",f);if(U===1)return Object.assign(Object.assign({},j),{args:[T,j.args[1]]});const ht=j.args[1];if(Re(ht))return Object.assign(Object.assign({},j),{args:[j.args[0],qr(ht,T,N,U-2)]});if(U===2)return Object.assign(Object.assign({},j),{args:[j.args[0],T]});throw new $(i,t,`${i.prim}: at least ${N+1} fields are expected`)}const Ot=(f,T)=>["@"+(f.v?f.v[0].slice(1)+".":"")+T];function qe(f,T){return"failed"in f||"failed"in T?"failed"in f?T:f:(l(f,T),f)}const Tr=(f=>{var T,N,U,j,ht;switch(f.prim){case"DUP":{const u=f.args?parseInt(f.args[0].int,10):1;if(u===0)throw new $(f,t,"DUP 0 is forbidden");const m=s(u-1,null)[0];if(q(m)==="ticket")throw new $(f,t,"ticket can't be DUPed");return[m,...t]}case"SWAP":{const u=s(0,null,null);return I({}),[u[1],u[0],...t.slice(2)]}case"SOME":return[S({prim:"option",args:[s(0,null)[0]]},I({t:1,v:1})),...t.slice(1)];case"UNIT":return[S({prim:"unit"},I({v:1,t:1})),...t];case"PAIR":{const u=f.args?parseInt(f.args[0].int,10):2;if(u<2)throw new $(f,t,`PAIR ${u} is forbidden`);const m=s(0,...new Array(u).fill(null)),w=I({f:u,t:1,v:1},{specialFields:!0}),R=bt=>{const Bt=bt.lastIndexOf(".");return bt.slice(Bt>0?Bt+1:1)},Pt=m.map((bt,Bt)=>{var Dn;const Cs=c(bt),Fc=w.f&&w.f.length>Bt&&w.f[Bt]!=="%"?w.f[Bt]==="%@"?Cs.v?["%"+R(((Dn=Cs.v)===null||Dn===void 0?void 0:Dn[0])||"")]:void 0:[w.f[Bt]]:void 0;return S(bt,{v:null,t:null,f:Fc})});return[S({prim:"pair",args:Pt},{t:w.t,v:w.v}),...t.slice(u)]}case"UNPAIR":{const u=f.args?parseInt(f.args[0].int,10):2;if(u<2)throw new $(f,t,`UNPAIR ${u} is forbidden`);const m=s(0,["pair"])[0],w=I({f:2,v:2},{specialVar:!0});return[...H(m,u).map((Pt,bt)=>Pr(m,Pt,w,bt,bt===0?"car":"cdr")),...t.slice(1)]}case"CAR":case"CDR":{const u=It("pair",s(0,["pair"])[0]),m=u.args[f.prim==="CAR"?0:1],w=I({f:1,v:1},{specialVar:!0});return[Pr(u,m,w,0,f.prim.toLocaleLowerCase()),...t.slice(1)]}case"CONS":{const u=s(0,null,["list"]);return p(u[0],u[1].args[0]),[v({prim:"list",args:[u[1].args[0]]}),...t.slice(2)]}case"SIZE":return s(0,["string","list","set","map","bytes"]),[v({prim:"nat"}),...t.slice(1)];case"MEM":{const u=s(0,null,["set","map","big_map"]);return h(u[0]),p(u[0],u[1].args[0]),[v({prim:"bool"}),...t.slice(2)]}case"GET":if(f.args){const u=parseInt(f.args[0].int,10),m=s(0,["pair"])[0];return[v(zr(m,u)),...t.slice(1)]}else{const u=s(0,null,["map","big_map"]);return h(u[0]),p(u[0],u[1].args[0]),[v({prim:"option",args:[u[1].args[1]]}),...t.slice(2)]}case"UPDATE":if(f.args){const u=parseInt(f.args[0].int,10),m=s(0,null,["pair"]);return[v(qr(m[1],m[0],u)),...t.slice(2)]}else{const u=s(0,null,["bool","option"]);if(h(u[0]),u[1].prim==="bool"){const w=s(2,["set"]);return p(u[0],w[0].args[0]),[v({prim:"set",args:[S(u[0],{t:null})]}),...t.slice(3)]}const m=s(2,["map","big_map"]);return p(u[0],m[0].args[0]),m[0].prim==="map"?[v({prim:"map",args:[S(u[0],{t:null}),S(u[1].args[0],{t:null})]}),...t.slice(3)]:(L(u[1].args[0]),[v({prim:"big_map",args:[S(u[0],{t:null}),S(u[1].args[0],{t:null})]}),...t.slice(3)])}case"GET_AND_UPDATE":{const u=I({v:2}),m=s(0,null,["option"],["map","big_map"]);h(m[0]),p(m[0],m[2].args[0]),p(m[1].args[0],m[2].args[1]);const w=(T=u.v)===null||T===void 0?void 0:T.map(R=>R!=="@"?[R]:void 0);return m[2].prim==="map"?[S({prim:"option",args:[m[2].args[1]]},{v:w==null?void 0:w[0]}),S({prim:"map",args:[S(m[0],{t:null}),S(m[1].args[0],{t:null})]},{v:w==null?void 0:w[1]}),...t.slice(3)]:(L(m[1].args[0]),[S({prim:"option",args:[m[2].args[1]]},{v:w==null?void 0:w[0]}),S({prim:"big_map",args:[S(m[0],{t:null}),S(m[1].args[0],{t:null})]},{v:w==null?void 0:w[1]}),...t.slice(3)])}case"EXEC":{const u=s(0,null,["lambda"]);return p(u[0],u[1].args[0]),[v(u[1].args[1]),...t.slice(2)]}case"APPLY":{const u=s(0,null,["lambda"]);if(E(u[0]),_(u[0]),!Re(u[1].args[0]))throw new $(f,t,`${f.prim}: function's argument must be a pair: ${q(u[1].args[0])}`);const m=u[1].args[0];return p(u[0],vn(m)[0]),[v({prim:"lambda",args:[vn(m)[1],u[1].args[1]]}),...t.slice(2)]}case"FAILWITH":{const u=s(0,null)[0];return ur(n,Pe.PtEdo2Zk)||b(u),{failed:u,level:0}}case"NEVER":return s(0,["never"]),{failed:{prim:"never"},level:0};case"RENAME":return[v(s(0,null)[0]),...t.slice(1)];case"CONCAT":{const u=s(0,["string","list","bytes"]);if(u[0].prim==="list"){if(q(u[0].args[0])!=="string"&&q(u[0].args[0])!=="bytes")throw new $(f,t,`${f.prim}: can't concatenate list of ${q(u[0].args[0])}'s`);return[v(u[0].args[0]),...t.slice(1)]}const m=s(1,["string","bytes"]);if(u[0].prim!==m[0].prim)throw new $(f,t,`${f.prim}: can't concatenate ${u[0].prim} with ${m[0].prim}`);return[v(m[0]),...t.slice(2)]}case"SLICE":return[v({prim:"option",args:[s(0,["nat"],["nat"],["string","bytes"])[2]]},"@slice"),...t.slice(3)];case"PACK":{const u=s(0,null)[0];return b(u),[v({prim:"bytes"},"@packed"),...t.slice(1)]}case"ADD":{const u=s(0,["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(u[0].prim==="nat"&&u[1].prim==="int"||u[0].prim==="int"&&u[1].prim==="nat")return[v({prim:"int"}),...t.slice(2)];if(u[0].prim==="int"&&u[1].prim==="timestamp"||u[0].prim==="timestamp"&&u[1].prim==="int")return[v({prim:"timestamp"}),...t.slice(2)];if((u[0].prim==="int"||u[0].prim==="nat"||u[0].prim==="mutez"||u[0].prim==="bls12_381_g1"||u[0].prim==="bls12_381_g2"||u[0].prim==="bls12_381_fr")&&u[0].prim===u[1].prim)return[v(u[0]),...t.slice(2)];throw new $(f,t,`${f.prim}: can't add ${u[0].prim} to ${u[1].prim}`)}case"SUB":{const u=ur(n,Pe.PsiThaCa)?s(0,["nat","int","timestamp","mutez"],["nat","int","timestamp","mutez"]):s(0,["nat","int","timestamp"],["nat","int","timestamp"]);if((u[0].prim==="nat"||u[0].prim==="int")&&(u[1].prim==="nat"||u[1].prim==="int")||u[0].prim==="timestamp"&&u[1].prim==="timestamp")return[v({prim:"int"}),...t.slice(2)];if(u[0].prim==="timestamp"&&u[1].prim==="int")return[v({prim:"timestamp"}),...t.slice(2)];if(u[0].prim==="mutez"&&u[1].prim==="mutez")return[v({prim:"mutez"}),...t.slice(2)];throw new $(f,t,`${f.prim}: can't subtract ${u[0].prim} from ${u[1].prim}`)}case"SUB_MUTEZ":return s(0,["mutez"],["mutez"]),[v({prim:"option",args:[{prim:"mutez"}]}),...t.slice(2)];case"MUL":{const u=s(0,["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(u[0].prim==="nat"&&u[1].prim==="int"||u[0].prim==="int"&&u[1].prim==="nat")return[v({prim:"int"}),...t.slice(2)];if(u[0].prim==="nat"&&u[1].prim==="mutez"||u[0].prim==="mutez"&&u[1].prim==="nat")return[v({prim:"mutez"}),...t.slice(2)];if((u[0].prim==="bls12_381_g1"||u[0].prim==="bls12_381_g2"||u[0].prim==="bls12_381_fr")&&u[1].prim==="bls12_381_fr"||(u[0].prim==="nat"||u[0].prim==="int")&&u[0].prim===u[1].prim)return[v(u[0]),...t.slice(2)];if((u[0].prim==="nat"||u[0].prim==="int")&&u[1].prim==="bls12_381_fr"||(u[1].prim==="nat"||u[1].prim==="int")&&u[0].prim==="bls12_381_fr")return[v({prim:"bls12_381_fr"}),...t.slice(2)];throw new $(f,t,`${f.prim}: can't multiply ${u[0].prim} by ${u[1].prim}`)}case"EDIV":{const u=(w,R)=>({prim:"option",args:[{prim:"pair",args:[{prim:w},{prim:R}]}]}),m=s(0,["nat","int","mutez"],["nat","int","mutez"]);if(m[0].prim==="nat"&&m[1].prim==="nat")return[v(u("nat","nat")),...t.slice(2)];if((m[0].prim==="nat"||m[0].prim==="int")&&(m[1].prim==="nat"||m[1].prim==="int"))return[v(u("int","nat")),...t.slice(2)];if(m[0].prim==="mutez"&&m[1].prim==="nat")return[v(u("mutez","mutez")),...t.slice(2)];if(m[0].prim==="mutez"&&m[1].prim==="mutez")return[v(u("nat","mutez")),...t.slice(2)];throw new $(f,t,`${f.prim}: can't euclideally divide ${m[0].prim} by ${m[1].prim}`)}case"ABS":return s(0,["int"]),[v({prim:"nat"}),...t.slice(1)];case"ISNAT":return s(0,["int"]),[v({prim:"option",args:[{prim:"nat"}]}),...t.slice(1)];case"INT":return s(0,["nat","bls12_381_fr","bytes"]),[v({prim:"int"}),...t.slice(1)];case"BYTES":return s(0,["nat","int"]),[v({prim:"bytes"}),...t.slice(1)];case"NAT":return s(0,["bytes"]),[v({prim:"nat"}),...t.slice(1)];case"NEG":{const u=s(0,["nat","int","bls12_381_g1","bls12_381_g2","bls12_381_fr"])[0];return u.prim==="nat"||u.prim==="int"?[v({prim:"int"}),...t.slice(1)]:[v(u),...t.slice(1)]}case"LSL":case"LSR":return s(0,["nat","bytes"],["nat","bytes"]),[v({prim:"nat"}),...t.slice(2)];case"OR":case"XOR":{const u=s(0,["nat","bytes","bool"],["nat","bytes","bool"]);if(u[0].prim!==u[1].prim)throw new $(f,t,`${f.prim}: both arguments must be of the same type: ${u[0].prim}, ${u[1].prim}`);return[v(u[1]),...t.slice(2)]}case"AND":{const u=s(0,["nat","bytes","bool","int"],["nat","bytes","bool"]);if((u[0].prim!=="int"||u[1].prim!=="nat")&&u[0].prim!==u[1].prim)throw new $(f,t,`${f.prim}: both arguments must be of the same type: ${u[0].prim}, ${u[1].prim}`);return[v(u[1]),...t.slice(2)]}case"NOT":return s(0,["nat","bytes","bool","int"])[0].prim==="bool"?[v({prim:"bool"}),...t.slice(1)]:[v({prim:"int"}),...t.slice(1)];case"COMPARE":{const u=s(0,null,null);return h(u[0]),h(u[1]),[v({prim:"int"}),...t.slice(2)]}case"EQ":case"NEQ":case"LT":case"GT":case"LE":case"GE":return s(0,["int"]),[v({prim:"bool"}),...t.slice(1)];case"SELF":{if((e==null?void 0:e.contract)===void 0)throw new $(f,t,`${f.prim}: contract required`);const u=I({f:1,v:1}),m=_i(e.contract,(N=u.f)===null||N===void 0?void 0:N[0]);if(m===null)throw new $(f,t,`${f.prim}: contract has no entrypoint ${m}`);return[S({prim:"contract",args:[m]},{v:u.v?u.v:["@self"]}),...t]}case"TRANSFER_TOKENS":{const u=s(0,null,["mutez"],["contract"]);return p(u[0],u[2].args[0]),[v({prim:"operation"}),...t.slice(3)]}case"SET_DELEGATE":{const u=s(0,["option"])[0];if(q(u.args[0])!=="key_hash")throw new $(f,t,`${f.prim}: key hash expected: ${q(u.args[0])}`);return[v({prim:"operation"}),...t.slice(1)]}case"IMPLICIT_ACCOUNT":return s(0,["key_hash"]),[v({prim:"contract",args:[{prim:"unit"}]}),...t.slice(1)];case"NOW":return[v({prim:"timestamp"},"@now"),...t];case"AMOUNT":return[v({prim:"mutez"},"@amount"),...t];case"BALANCE":return[v({prim:"mutez"},"@balance"),...t];case"CHECK_SIGNATURE":return s(0,["key"],["signature"],["bytes"]),[v({prim:"bool"}),...t.slice(3)];case"BLAKE2B":case"SHA256":case"SHA512":case"KECCAK":case"SHA3":return s(0,["bytes"]),[v({prim:"bytes"}),...t.slice(1)];case"HASH_KEY":return s(0,["key"]),[v({prim:"key_hash"}),...t.slice(1)];case"SOURCE":return[v({prim:"address"},"@source"),...t];case"SENDER":return[v({prim:"address"},"@sender"),...t];case"ADDRESS":{const u=s(0,["contract"])[0],m=I({v:1});return[S({prim:"address",[Jr]:u},{v:m.v?m.v:Ot(c(u),"address")}),...t.slice(1)]}case"SELF_ADDRESS":{const u={prim:"address"};return(e==null?void 0:e.contract)!==void 0&&(u[Jr]={prim:"contract",args:[ue(e.contract,"parameter").args[0]]}),[v(u,"@address"),...t]}case"CHAIN_ID":return[v({prim:"chain_id"}),...t];case"DROP":{I({});const u=f.args!==void 0?parseInt(f.args[0].int,10):1;return s(u-1,null),t.slice(u)}case"DIG":{I({});const u=parseInt(f.args[0].int,10);return[s(u,null)[0],...t.slice(0,u),...t.slice(u+1)]}case"DUG":{I({});const u=parseInt(f.args[0].int,10);return[...t.slice(1,u+1),s(0,null)[0],...t.slice(u+1)]}case"NONE":return X(f.args[0]),[S({prim:"option",args:[f.args[0]]},I({t:1,v:1})),...t];case"LEFT":case"RIGHT":{const u=s(0,null)[0],m=I({f:2,t:1,v:1},{specialFields:!0}),w=c(u),R=[S(u,{t:null,v:null,f:m.f&&m.f.length>0&&m.f[0]!=="%"?m.f[0]==="%@"?w.v?["%"+w.v[0].slice(1)]:void 0:m.f:void 0}),S(f.args[0],{t:null,f:m.f&&m.f.length>1&&m.f[1]!=="%"?m.f:void 0})];return[S({prim:"or",args:f.prim==="LEFT"?R:[R[1],R[0]]},{t:m.t,v:m.v}),...t.slice(1)]}case"NIL":return X(f.args[0]),[S({prim:"list",args:[f.args[0]]},I({t:1,v:1})),...t];case"UNPACK":return s(0,["bytes"]),X(f.args[0]),[v({prim:"option",args:[f.args[0]]},"@unpacked"),...t.slice(1)];case"CONTRACT":{const u=s(0,["address"])[0];X(f.args[0]);const m=I({v:1,f:1}),w=u[Jr];if(w!==void 0){const R=_i(w,(U=m.f)===null||U===void 0?void 0:U[0]);if(R===null)throw new $(f,t,`${f.prim}: contract has no entrypoint ${R}`);p(R,f.args[0])}return[S({prim:"option",args:[{prim:"contract",args:[f.args[0]]}]},{v:m.v?m.v:Ot(c(u),"contract")}),...t.slice(1)]}case"CAST":{I({});const u=s(0,null)[0];return X(f.args[0]),p(f.args[0],u),[f.args[0],...t.slice(1)]}case"IF_NONE":{I({});const u=s(0,["option"])[0],m=t.slice(1),w=ut(f.args[0],m,e),R=ut(f.args[1],[S(u.args[0],{t:null,v:Ot(c(u),"some")}),...m],e);return qe(w,R)}case"IF_LEFT":{I({});const u=s(0,["or"])[0],m=c(u),w=c(u.args[0]),R=c(u.args[1]),Pt=t.slice(1),bt=ut(f.args[0],[S(u.args[0],{t:null,v:Ot(m,w.f?w.f[0].slice(1):"left")}),...Pt],e),Bt=ut(f.args[1],[S(u.args[1],{t:null,v:Ot(m,R.f?R.f[0].slice(1):"right")}),...Pt],e);return qe(bt,Bt)}case"IF_CONS":{I({});const u=s(0,["list"])[0],m=c(u),w=t.slice(1),R=ut(f.args[0],[S(u.args[0],{t:null,v:Ot(m,"hd")}),S(u,{t:null,v:Ot(m,"tl")}),...w],e),Pt=ut(f.args[1],w,e);return qe(R,Pt)}case"IF":{I({}),s(0,["bool"]);const u=t.slice(1),m=ut(f.args[0],u,e),w=ut(f.args[1],u,e);return qe(m,w)}case"MAP":{const u=s(0,["list","map","option"])[0],m=t.slice(1),w=u.prim==="map"?{prim:"pair",args:u.args}:u.args[0],R=ut(f.args[0],[S(w,{t:null,v:Ot(c(u),"elt")}),...m],e);if("failed"in R){if(!("prim"in R.failed)||R.failed.prim!=="never")throw new $(f,t,`${f.prim}: FAIL is not allowed in MAP`);return{failed:R.failed,level:R.level+1}}if(R.length<1)throw new $(f,t,`${f.prim}: function must return a value`);return l(R.slice(1),m),u.prim==="list"?[v({prim:"list",args:[R[0]]}),...m]:u.prim==="map"?[v({prim:"map",args:[u.args[0],R[0]]}),...m]:[v({prim:"option",args:[R[0]]}),...m]}case"ITER":{I({});const u=s(0,["set","list","map"])[0],m=t.slice(1),w=u.prim==="map"?{prim:"pair",args:u.args}:u.args[0],R=ut(f.args[0],[S(w,{t:null,v:Ot(c(u),"elt")}),...m],e);return"failed"in R?{failed:R.failed,level:R.level+1}:(l(R,m),m)}case"LOOP":{I({}),s(0,["bool"]);const u=t.slice(1),m=ut(f.args[0],u,e);return"failed"in m?{failed:m.failed,level:m.level+1}:(l(m,[{prim:"bool"},...u]),u)}case"LOOP_LEFT":{I({});const u=s(0,["or"])[0],m=t.slice(1),w=ut(f.args[0],[S(u.args[0],{t:null,v:Ot(c(u),"left")}),...m],e);return"failed"in w?{failed:w.failed,level:w.level+1}:(l(w,[u,...m]),[S(u.args[1],{t:null,v:I({v:1}).v}),...m])}case"DIP":{I({});const u=f.args.length===2?parseInt(f.args[0].int,10):1;s(u-1,null);const m=t.slice(0,u),w=t.slice(u),R=f.args.length===2?ut(f.args[1],w,e):ut(f.args[0],w,e);return"failed"in R?{failed:R.failed,level:R.level+1}:[...m,...R]}case"CREATE_CONTRACT":{const u=I({v:2}),m=s(0,["option"],["mutez"],null);if(q(m[0].args[0])!=="key_hash")throw new $(f,t,`${f.prim}: key hash expected: ${q(m[0].args[0])}`);E(m[2])&&(Ec(f.args[0]),Vt(ue(f.args[0],"storage").args[0],m[2]));const w=(j=u.v)===null||j===void 0?void 0:j.map(R=>R!=="@"?[R]:void 0);return[S({prim:"operation"},{v:w==null?void 0:w[0]}),S({prim:"address",[Jr]:{prim:"contract",args:[ue(f.args[0],"parameter").args[0]]}},{v:w==null?void 0:w[1]}),...t.slice(3)]}case"PUSH":return X(f.args[0]),jt(f.args[1],f.args[0],Object.assign(Object.assign({},e),{contract:void 0})),[v(f.args[0]),...t];case"EMPTY_SET":return X(f.args[0]),h(f.args[0]),[S({prim:"set",args:f.args},I({t:1,v:1})),...t];case"EMPTY_MAP":return X(f.args[0]),h(f.args[0]),X(f.args[1]),[S({prim:"map",args:f.args},I({t:1,v:1})),...t];case"EMPTY_BIG_MAP":return X(f.args[0]),h(f.args[0]),X(f.args[1]),L(f.args[0]),[S({prim:"big_map",args:f.args},I({t:1,v:1})),...t];case"LAMBDA_REC":case"LAMBDA":{X(f.args[0]),X(f.args[1]);const u=[f.args[0]];f.prim==="LAMBDA_REC"&&u.push({prim:"lambda",args:[f.args[0],f.args[1]]});const m=ut(f.args[2],u,Object.assign(Object.assign({},e),{contract:void 0}));if("failed"in m)return{failed:m.failed,level:m.level+1};if(m.length!==1)throw new $(f,t,`${f.prim}: function must return a value`);return p(f.args[1],m[0]),[v({prim:"lambda",args:[f.args[0],f.args[1]]}),...t]}case"LEVEL":return[v({prim:"nat"},"@level"),...t];case"TOTAL_VOTING_POWER":return[v({prim:"nat"}),...t];case"VOTING_POWER":return s(0,["key_hash"]),[v({prim:"nat"}),...t.slice(1)];case"TICKET":{const u=s(0,null,["nat"])[0];return h(u),ur(n,Pe.PtLimaPtL)?[S({prim:"ticket",args:[u]},I({t:1,v:1})),...t.slice(2)]:[v({prim:"option",args:[S({prim:"ticket",args:[u]},I({t:1,v:1}))]}),...t.slice(2)]}case"JOIN_TICKETS":{const u=It("pair",s(0,["pair"])[0]);if(q(u.args[0])!=="ticket")throw new $(f,t,`${f.prim}: ticket expected: ${q(u.args[0])}`);return p(u.args[0],u.args[1]),[v({prim:"option",args:[S(u.args[0],{t:null})]}),...t.slice(1)]}case"SPLIT_TICKET":{const u=s(0,["ticket"],["pair"]),m=It("pair",u[1]);if(q(m.args[0])!=="nat")throw new $(f,t,`${f.prim}: nat expected: ${q(m.args[0])}`);return p(m.args[0],m.args[1]),[v({prim:"option",args:[{prim:"pair",args:[S(u[0],{t:null}),S(u[0],{t:null})]}]}),...t.slice(2)]}case"READ_TICKET":{const u=I({v:2}),m=s(0,["ticket"])[0],w=(ht=u.v)===null||ht===void 0?void 0:ht.map(R=>R!=="@"?[R]:void 0);return[S({prim:"pair",args:[{prim:"address"},S(m.args[0],{t:null}),{prim:"nat"}]},{v:w==null?void 0:w[0]}),S(m,{v:w==null?void 0:w[1],t:null}),...t.slice(1)]}case"PAIRING_CHECK":{const u=s(0,["list"])[0].args[0];if(!Re(u))throw new $(f,t,`${f.prim}: pair expected: ${q(u)}`);const m=It("pair",u);if(q(m.args[0])!=="bls12_381_g1")throw new $(f,t,`${f.prim}: bls12_381_g1 expected: ${q(m.args[0])}`);if(q(m.args[1])!=="bls12_381_g2")throw new $(f,t,`${f.prim}: bls12_381_g2 expected: ${q(m.args[1])}`);return[v({prim:"bool"}),...t.slice(1)]}case"SAPLING_EMPTY_STATE":return[S({prim:"sapling_state",args:[f.args[0]]},I({v:1,t:1})),...t];case"SAPLING_VERIFY_UPDATE":{const u=s(0,["sapling_transaction"],["sapling_state"]);if(parseInt(u[0].args[0].int,10)!==parseInt(u[1].args[0].int,10))throw new $(f,t,`${f.prim}: sapling memo size mismatch: ${u[0].args[0].int} != ${u[1].args[0].int}`);return ur(n,Pe.PtJakarta)?[v({prim:"option",args:[{prim:"pair",args:[{prim:"int"},S(u[1],{t:null})]}]}),...t.slice(2)]:[v({prim:"option",args:[{prim:"pair",args:[{prim:"bytes"},{prim:"pair",args:[{prim:"int"},S(u[1],{t:null})]}]}]}),...t.slice(2)]}case"OPEN_CHEST":return s(0,["chest_key"],["chest"],["nat"]),[v({prim:"or",args:[{prim:"bytes"},{prim:"bool"}]}),...t.slice(3)];case"VIEW":{const u=s(0,null,["address"]);return _(u[0]),[v({prim:"option",args:[f.args[1]]}),...t.slice(2)]}case"MIN_BLOCK_TIME":return[v({prim:"nat"}),...t];case"EMIT":{const u=I({f:1,t:1});if(f.args){const m=s(0,null);return p(m[0],f.args[0]),[S({prim:"operation"},u),...t.slice(1)]}return[S({prim:"operation"},u),...t.slice(1)]}default:throw new Mt(f,`unexpected instruction: ${f.prim}`)}})(i);if((e==null?void 0:e.traceCallback)!==void 0){const f={op:i,in:t,out:Tr};e.traceCallback(f)}return Tr}function ue(r,t){for(const e of r)if(e.prim===t)return e;throw new Mt(r,`missing contract section: ${t}`)}function Ap(r){const t={};for(const e of r)e.prim==="view"&&(t[e.args[0].string]=e);return t}function bc(r){if(Array.isArray(r)){for(const t of r)if("prim"in t&&(t.prim==="parameter"||t.prim==="storage"||t.prim==="code"))return!0}return!1}function _i(r,t){t=t||"%default";const e=_n(r).find(n=>n[0]===t);return e!==void 0?e[1]:t==="%default"?bc(r)?ue(r,"parameter").args[0]:r:null}function Sp(r){return Array.isArray(r)||r.prim==="or"}function _n(r){if(bc(r)){const t=ue(r,"parameter"),e=_n(t.args[0]),n=yr(t);return n.f?[[n.f[0],t.args[0]],...e]:e}if(Sp(r)){const t=vn(r),e=n=>{const i=yr(t[n]);if(q(t[n])==="or"){const s=_n(t[n]);return i.f?[[i.f[0],t[n]],...s]:s}return i.f?[[i.f[0],t[n]]]:[]};return[...e(0),...e(1)]}return[]}function Ec(r,t){const e=(c,l,p,h)=>{X(c,!0),X(l);const b={prim:"pair",args:[Object.assign(Object.assign({},c),{annots:["@parameter"]}),Object.assign(Object.assign({},l),{annots:["@storage"]})]},E=ut(h,[b],Object.assign(Object.assign({},t),{contract:r}));if("failed"in E)return E;try{mc(E,[p])}catch(_){throw _ instanceof Mt?new $(h,E,_.message):_}return E},n=ue(r,"parameter").args[0],i=ue(r,"storage").args[0],s=ue(r,"code").args[0],a=e(n,i,{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},i]},s);for(const c of Object.values(Ap(r)))e(c.args[1],i,c.args[2],c.args[3]);return a}function vc(r,t,e){X(t),jt(r,t,e||null)}function Rp(r,t,e){for(const n of t)X(n);if((e==null?void 0:e.contract)!==void 0)for(const n of["parameter","storage"]){const i=ue(e.contract,n).args[0];X(i)}return ut(r,t,e||null)}function Op(r,t,e){try{return vc(r,t,e),!0}catch{return!1}}class Xi{constructor(t,e){this.contract=t,this.ctx=Object.assign({contract:t},e),this.output=Ec(t,this.ctx)}static parse(t,e){const n=new Xe(e),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new Wd("empty contract");if(dc(i))return new Xi(i,e)}static parseTypeExpression(t,e){const n=new Xe(e),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new Yd("empty type expression");if(Oe(i))return X(i),i}static parseDataExpression(t,e){const n=new Xe(e),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new Zd("empty data expression");if(Ze(i))return i;throw void 0}section(t){return ue(this.contract,t)}entryPoints(){return _n(this.contract)}entryPoint(t){return _i(this.contract,t)}assertDataValid(t,e){vc(t,e,this.ctx)}isDataValid(t,e){return Op(t,e,this.ctx)}assertParameterValid(t,e){const n=this.entryPoint(t||void 0);if(n===null)throw new Jd(t==null?void 0:t.toString());this.assertDataValid(e,n)}isParameterValid(t,e){try{return this.assertParameterValid(t,e),!0}catch{return!1}}functionType(t,e){return Rp(t,e,this.ctx)}}new Xi([{prim:"parameter",args:[{prim:"unit"}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}]);const Yo=r=>r.reduce((t,e)=>t+e.toString(16).padStart(2,"0"),""),tt=(r,t=8)=>r.toString(16).padStart(t,"0"),Qi=31;var d;(function(r){r.SECRET="secret",r.RAW="raw",r.TZ1="tz1",r.BRANCH="branch",r.ZARITH="zarith",r.PUBLIC_KEY="public_key",r.PKH="pkh",r.DELEGATE="delegate",r.SCRIPT="script",r.BALLOT_STATEMENT="ballotStmt",r.PROPOSAL="proposal",r.PROPOSAL_ARR="proposalArr",r.INT32="int32",r.INT16="int16",r.PARAMETERS="parameters",r.ADDRESS="address",r.SMART_CONTRACT_ADDRESS="smart_contract_address",r.SMART_ROLLUP_ADDRESS="smart_rollup_address",r.SMART_ROLLUP_COMMITMENT_HASH="smart_rollup_commitment_hash",r.VALUE="value",r.PADDED_BYTES="padded_bytes",r.SMART_ROLLUP_MESSAGE="smart_rollup_message",r.MANAGER="manager",r.BLOCK_PAYLOAD_HASH="blockPayloadHash",r.ENTRYPOINT="entrypoint",r.OPERATION="operation",r.OP_ACTIVATE_ACCOUNT="activate_account",r.OP_DELEGATION="delegation",r.OP_TRANSACTION="transaction",r.OP_ORIGINATION="origination",r.OP_BALLOT="ballot",r.OP_ENDORSEMENT="endorsement",r.OP_SEED_NONCE_REVELATION="seed_nonce_revelation",r.OP_REVEAL="reveal",r.OP_PROPOSALS="proposals",r.OP_REGISTER_GLOBAL_CONSTANT="register_global_constant",r.OP_TRANSFER_TICKET="transfer_ticket",r.OP_TX_ROLLUP_ORIGINATION="tx_rollup_origination",r.OP_TX_ROLLUP_SUBMIT_BATCH="tx_rollup_submit_batch",r.BURN_LIMIT="burn_limit",r.TX_ROLLUP_ORIGINATION_PARAM="tx_rollup_origination_param",r.TX_ROLLUP_ID="tx_rollup_id",r.TX_ROLLUP_BATCH_CONTENT="tx_rollup_batch_content",r.OP_INCREASE_PAID_STORAGE="increase_paid_storage",r.OP_UPDATE_CONSENSUS_KEY="update_consensus_key",r.OP_DRAIN_DELEGATE="drain_delegate",r.DEPOSITS_LIMIT="deposits_limit",r.OP_SET_DEPOSITS_LIMIT="set_deposits_limit",r.OP_SMART_ROLLUP_ORIGINATE="smart_rollup_originate",r.PVM_KIND="pvm_kind",r.OP_SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",r.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message"})(d||(d={}));const Kt={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0a":"True","0b":"Unit","0c":"PACK","0d":"UNPACK","0e":"BLAKE2B","0f":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1a":"CONCAT","1b":"CONS","1c":"CREATE_ACCOUNT","1d":"CREATE_CONTRACT","1e":"IMPLICIT_ACCOUNT","1f":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2a":"GT","2b":"HASH_KEY","2c":"IF","2d":"IF_CONS","2e":"IF_LEFT","2f":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3a":"MUL","3b":"NEG","3c":"NEQ","3d":"NIL","3e":"NONE","3f":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4a":"STEPS_TO_QUOTA","4b":"SUB","4c":"SWAP","4d":"TRANSFER_TOKENS","4e":"SET_DELEGATE","4f":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5a":"contract","5b":"int","5c":"key","5d":"key_hash","5e":"lambda","5f":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6a":"mutez","6b":"timestamp","6c":"unit","6d":"operation","6e":"address","6f":"SLICE",70:"DIG",71:"DUG",72:"EMPTY_BIG_MAP",73:"APPLY",74:"chain_id",75:"CHAIN_ID",76:"LEVEL",77:"SELF_ADDRESS",78:"never",79:"NEVER","7a":"UNPAIR","7b":"VOTING_POWER","7c":"TOTAL_VOTING_POWER","7d":"KECCAK","7e":"SHA3","7f":"PAIRING_CHECK",80:"bls12_381_g1",81:"bls12_381_g2",82:"bls12_381_fr",83:"sapling_state",84:"sapling_transaction_deprecated",85:"SAPLING_EMPTY_STATE",86:"SAPLING_VERIFY_UPDATE",87:"ticket",88:"TICKET_DEPRECATED",89:"READ_TICKET","8a":"SPLIT_TICKET","8b":"JOIN_TICKETS","8c":"GET_AND_UPDATE","8d":"chest","8e":"chest_key","8f":"OPEN_CHEST",90:"VIEW",91:"view",92:"constant",93:"SUB_MUTEZ",94:"tx_rollup_l2_address",95:"MIN_BLOCK_TIME",96:"sapling_transaction",97:"EMIT",98:"Lambda_rec",99:"LAMBDA_REC","9a":"TICKET","9b":"BYTES","9c":"NAT"},Pp=(()=>{const r={};return Object.keys(Kt).forEach(t=>{r[Kt[t]]=t}),r})(),wi={4:"activate_account",107:"reveal",110:"delegation",108:"transaction",109:"origination",6:"ballot",21:"endorsement",1:"seed_nonce_revelation",5:"proposals",111:"register_global_constant",150:"tx_rollup_origination",151:"tx_rollup_submit_batch",158:"transfer_ticket",112:"set_deposits_limit",113:"increase_paid_storage",114:"update_consensus_key",9:"drain_delegate",200:"smart_rollup_originate",201:"smart_rollup_add_messages",206:"smart_rollup_execute_outbox_message"},Zo=(()=>{const r={};return Object.keys(wi).forEach(t=>{const e=typeof t=="string"?parseInt(t,10):t;r[wi[e]]=tt(e,2)}),r})(),wn={"00":"default","01":"root","02":"do","03":"set_delegate","04":"remove_delegate","05":"deposit"},Jo=(()=>{const r={};return Object.keys(wn).forEach(t=>{r[wn[t]]=t}),r})();class Xo extends $t{constructor(t,e){super(),this.operation=t,this.name="InvalidOperationSchemaError",this.message="Invalid operation content recevied",e&&(this.message+=` ${e}.`)}}class _c extends $t{constructor(t){super(),this.entrypoint=t,this.name="OversizedEntryPointError",this.message=`Invalid entrypoint length "${t.length}", maximum length is "${Qi}".`}}class Tp extends $t{constructor(t){super(),this.ballotValue=t,this.name="InvalidBallotValueError",this.message=`Invalid ballot value "${t}" expecting one of the following: "yay", "nay", "pass".`}}class Ip extends $t{constructor(t){super(),this.ballotValue=t,this.name="DecodeBallotValueError",this.message=`Invalid ballot value "${t}", cannot be decoded.`}}class Np extends $t{constructor(t){super(),this.value=t,this.name="UnexpectedMichelsonValueError",this.message=`Invalid Michelson value "${t}", unalbe to encode.`}}class wc extends $t{constructor(t){super(),this.message=t,this.name="OperationDecodingError"}}class xp extends $t{constructor(t){super(),this.message=t,this.name="OperationEncodingError"}}class Lp extends $t{constructor(t){super(),this.op=t,this.name="UnsupportedOperationError",this.message=`Unsupported operation "${t}", can submit an issue on our github for feature request.`}}class Cp extends $t{constructor(t){super(),this.pvm=t,this.name="UnsupportedPvmKindError",this.message=`Invalid Pvm kind "${t}" expecting either "arith" or "wasm_2_0_0".`}}class Mp extends $t{constructor(t){super(),this.pvm=t,this.name="DecodePvmKindError",this.message=`Invalid Pvm kind "${t}", cannot be decoded.`}}class Ac extends $t{constructor(t,e){super(),this.address=t,this.name="InvalidSmartRollupAddress",this.message=`Invalid smart rollup address "${t}"`,e&&(this.message+=` ${e}.`)}}class Sc extends $t{constructor(t,e){super(),this.hash=t,this.name="InvalidSmartRollupCommitmentHashError",this.message=`Invalid smart rollup commitment hash "${t}"`,e&&(this.message+=` ${e}.`)}}class Ut{constructor(t,e=0){this.arr=t,this.offset=e}static fromHexString(t){const e=t.toLowerCase();if(/^(([a-f]|\d){2})*$/.test(e)){const n=new Uint8Array((e.match(/([a-z]|\d){2}/g)||[]).map(i=>parseInt(i,16)));return new Ut(n)}else throw new da(e)}consume(t){const e=this.arr.subarray(this.offset,this.offset+t);return this.offset+=t,e}get(t){return this.arr[this.offset+t]}length(){return this.arr.length-this.offset}slice(t,e){return new Ut(this.arr.slice(t,e))}}const Dp=r=>"prim"in r,kp=r=>"bytes"in r&&typeof r.bytes=="string",Bp=r=>"string"in r&&typeof r.string=="string",Hp=r=>"int"in r&&typeof r.int=="string",$p=r=>{const t=Ke(r.code),e=Ke(r.storage);return`${tt(t.length/2,8)}${t}${tt(e.length/2,8)}${e}`},jp=r=>{const t=kt(r),e=kt(r);return{code:Fe(new Ut(t)),storage:Fe(new Ut(e))}},Ke=r=>{if(Array.isArray(r)){const t=r.map(n=>Ke(n)).join(""),e=t.length/2;return`02${tt(e)}${t}`}else{if(Dp(r))return Wp(r);if(kp(r))return Up(r);if(Bp(r))return Kp(r);if(Hp(r))return zp(r)}throw new Np(JSON.stringify(r))},Fe=r=>{const t=r.consume(1);switch(t[0]){case 10:return Gp(r);case 1:return Fp(r);case 0:return qp(r);case 2:{const e=new Ut(kt(r)),n=[];for(;e.length()>0;)n.push(Fe(e));return n}default:return Yp(r,t)}},kt=(r,t=4)=>{const e=r.consume(t),n=parseInt(Buffer.from(e).toString("hex"),16);return r.consume(n)},Vp=(r,t=4)=>{const e=[];let n=r;for(;n.length();){const i=n.consume(t),s=parseInt(Buffer.from(i).toString("hex"),16);e.push(n.consume(s)),n=n.slice(s+t)}return e},Up=r=>{if(!/^([A-Fa-f0-9]{2})*$/.test(r.bytes))throw new da(r.bytes);const t=r.bytes.length/2;return`0a${tt(t)}${r.bytes}`},Gp=r=>{const t=kt(r);return{bytes:Buffer.from(t).toString("hex")}},Kp=r=>{const t=Buffer.from(r.string,"utf8").toString("hex"),e=t.length/2;return`01${tt(e)}${t}`},Fp=r=>{const t=kt(r);return{string:Buffer.from(t).toString("utf8")}},zp=({int:r})=>{const t=new P(r,10),e=t.toString(2)[0]==="-"?"1":"0",n=t.toString(2).replace(/-/g,""),i=n.length<=6?6:(n.length-6)%7?n.length+7-(n.length-6)%7:n.length,o=n.padStart(i,"0").match(/\d{6,7}/g).reverse();return o[0]=e+o[0],`00${o.map((c,l)=>parseInt((l===o.length-1?"0":"1")+c,2).toString(16).padStart(2,"0")).join("")}`},qp=r=>{let t=r.consume(1)[0];const e=[],n=128;for(;t&n;)e.push(t),t=r.consume(1)[0];e.push(t);const i=!!(64&e[0]);e[0]=e[0]&127;const s=e.map((a,c)=>a.toString(2).slice(c===0?-6:-7).padStart(c===0?6:7,"0")).reverse();let o=new P(s.join(""),2);return i&&(o=o.times(-1)),{int:o.toFixed()}},Wp=r=>{const t=+Array.isArray(r.annots),e=Array.isArray(r.args)?r.args.length:0,n=tt(Math.min(2*e+t+3,9),2),i=Pp[r.prim];let s=(r.args||[]).map(a=>Ke(a)).join("");const o=Array.isArray(r.annots)?Xp(r.annots):"";return(r.prim==="LAMBDA"||r.prim==="LAMBDA_REC")&&e&&(s=tt(s.length/2)+s+tt(0)),(r.prim==="pair"||r.prim==="Pair")&&e>2&&(s=o===""?tt(s.length/2)+s+tt(0):tt(s.length/2)+s),r.prim==="view"&&r.args&&(s=tt(s.length/2)+s+tt(0)),`${n}${i}${s}${o}`},Yp=(r,t)=>{const e=(t[0]-3)%2===1;let n=Math.floor((t[0]-3)/2);const i=r.consume(1)[0].toString(16).padStart(2,"0"),s={prim:Kt[i]};if((Kt[i]==="LAMBDA"||Kt[i]==="LAMBDA_REC")&&r.consume(4),Kt[i]==="view")return n!=0?Zp(r,s):s;let o,a;(Kt[i]==="pair"||Kt[i]==="Pair")&&n>2&&(o=Jp(r),n=0,a=Qo(r));const c=new Array(n).fill(0).map(()=>Fe(r));return(Kt[i]==="LAMBDA"||Kt[i]==="LAMBDA_REC")&&r.consume(4),o?s.args=o:c.length&&(s.args=c),a&&a[0]!==""?s.annots=a:e&&(s.annots=Qo(r)),s},Zp=(r,t)=>(r.consume(4),t.args=new Array(4).fill(0).map(()=>Fe(r)),r.consume(4),t),Jp=r=>{const t=new Ut(kt(r)),e=[];for(;t.length()>0;)e.push(Fe(t));return e},Xp=r=>{const t=r.map(n=>Buffer.from(n,"utf8").toString("hex")).join("20"),e=t.length/2;return`${tt(e)}${t}`},Qo=r=>{const t=r.consume(4),e=parseInt(Buffer.from(t).toString("hex"),16),n=r.consume(e);return Buffer.from(n).toString("hex").split("20").map(s=>Buffer.from(s,"hex").toString("utf8"))},yt=r=>t=>Xc(Buffer.from(la(t,Ni[r]))),_t=r=>t=>{const e=t.consume(Qc[r]);return tu(e,Ni[r])},Qp=_t(A.TZ1),tf=_t(A.B),ts=r=>{const t=r.consume(1);if(t[0]===0)return _t(A.TZ1)(r);if(t[0]===1)return _t(A.TZ2)(r);if(t[0]===2)return _t(A.TZ3)(r)},ef=yt(A.B),rf=yt(A.TZ1),ta=r=>r?"ff":"00",Rc=r=>yt(A.P)(r),Oc=r=>_t(A.P)(r),nf=r=>{const t=[];for(r.consume(4);r.length()>0;)t.push(Oc(r));return t},sf=r=>tt(32*r.length)+r.map(t=>Rc(t)).join(""),of=r=>{switch(r){case"yay":return"00";case"nay":return"01";case"pass":return"02";default:throw new Tp(r)}},af=r=>{const t=r.consume(1);switch(t[0]){case 0:return"yay";case 1:return"nay";case 2:return"pass";default:throw new Ip(t[0].toString())}},cf=r=>{switch(r){case"arith":return"00";case"wasm_2_0_0":return"01";default:throw new Cp(r)}},uf=r=>{const t=r.consume(1);switch(t[0]){case 0:return"arith";case 1:return"wasm_2_0_0";default:throw new Mp(t[0].toString())}},lf=r=>r?ta(!0)+es(r):ta(!1),hf=r=>{const t=parseInt(String(r),10),e=[];for(let n=0;n<4;n++){const i=(4-(n+1))*8;e.push((t&255<<i)>>i)}return Buffer.from(e).toString("hex")},df=r=>{const t=r.consume(4);let e=0;for(let n=0;n<t.length;n++)e=e|t[n]<<(t.length-(n+1))*8;return e},pf=r=>{const t=parseInt(String(r),10),e=[];for(let n=0;n<2;n++){const i=(2-(n+1))*8;e.push((t&255<<i)>>i)}return Buffer.from(e).toString("hex")},ff=r=>{const t=r.consume(2);let e=0;for(let n=0;n<t.length;n++)e=e|t[n]<<(t.length-(n+1))*8;return e},gf=r=>r.consume(1)[0]===255,mf=r=>{if(gf(r))return ts(r)},es=r=>{switch(r.substring(0,3)){case A.TZ1:return"00"+yt(A.TZ1)(r);case A.TZ2:return"01"+yt(A.TZ2)(r);case A.TZ3:return"02"+yt(A.TZ3)(r);case A.TZ4:return"03"+yt(A.TZ4)(r);default:throw new Li(r,M(O.NO_PREFIX_MATCHED)+` expecting one for the following "${A.TZ1}", "${A.TZ2}", "${A.TZ3}" or "${A.TZ4}".`)}},yf=r=>{switch(r.substring(0,4)){case A.EDPK:return"00"+yt(A.EDPK)(r);case A.SPPK:return"01"+yt(A.SPPK)(r);case A.P2PK:return"02"+yt(A.P2PK)(r);default:throw new pa(r,M(O.NO_PREFIX_MATCHED)+` expecting one of the following '${A.EDPK}', '${A.SPPK}', '${A.P2PK}' or '${A.BLPK}'.`)}},bf=r=>{switch(r.substring(0,3)){case A.TZ1:case A.TZ2:case A.TZ3:case A.TZ4:return"00"+es(r);case A.KT1:return"01"+yt(A.KT1)(r)+"00";default:throw new W(r,M(O.NO_PREFIX_MATCHED)+` expecting one of the following prefix '${A.TZ1}', ${A.TZ2}', '${A.TZ3}', '${A.TZ4}' or '${A.KT1}'.`)}},Ef=r=>{if(r.substring(0,3)!==A.SR1)throw new Ac(r,M(O.NO_PREFIX_MATCHED)+` expecting prefix '${A.SR1}'.`);return yt(A.SR1)(r)},vf=r=>{if(r.substring(0,3)===A.KT1)return"01"+yt(A.KT1)(r)+"00";throw new Qe(r,M(O.NO_PREFIX_MATCHED)+` expecting prefix '${A.KT1}'.`)},_f=r=>{switch(r.consume(1)[0]){case 0:return _t(A.EDPK)(r);case 1:return _t(A.SPPK)(r);case 2:return _t(A.P2PK)(r);default:throw new pa(r.toString(),M(O.NO_PREFIX_MATCHED))}},wf=r=>{if(r.substring(0,4)===A.SRC1)return yt(A.SRC1)(r);throw new Sc(r,M(O.NO_PREFIX_MATCHED)+` expecting prefix '${A.SRC1}'`)},Af=r=>{switch(r.consume(1)[0]){case 0:return ts(r);case 1:{const e=_t(A.KT1)(r);return r.consume(1),e}default:throw new W(r.toString(),": Unable to decode.")}},Sf=r=>{const t=_t(A.SR1)(r);if(t.substring(0,3)!==A.SR1)throw new Ac(t,M(O.NO_PREFIX_MATCHED)+` expecting prefix '${A.SR1}'.`);return t},Rf=r=>{if(r.consume(1)[0]===1){const e=_t(A.KT1)(r);return r.consume(1),e}throw new Qe(r.toString(),M(O.NO_PREFIX_MATCHED))},Of=r=>{const t=_t(A.SRC1)(r);if(t.substring(0,4)!==A.SRC1)throw new Sc(t,M(O.NO_PREFIX_MATCHED)+` expecting prefix '${A.SRC1}'`);return t},rs=r=>{const t=[];let e=new P(r,10);if(e.isNaN())throw new TypeError(`Invalid zarith number ${r}`);for(;;)if(e.lt(128)){e.lt(16)&&t.push("0"),t.push(e.toString(16));break}else{let n=e.mod(128);e=e.minus(n),e=e.dividedBy(128),n=n.plus(128),t.push(n.toString(16))}return t.join("")},ns=r=>{let t=0;for(;t<r.length()&&r.get(t)&128;)t+=1;let e=new P(0);for(let n=t;n>=0;n-=1){const i=r.get(n)&127;e=e.multipliedBy(128),e=e.plus(i)}return r.consume(t+1),new P(e).toString()},Pf=r=>{const t=tt(r.consume(1)[0],2);if(t in wn)return wn[t];{const e=kt(r,1),n=Buffer.from(e).toString("utf8");if(n.length>Qi)throw new _c(n);return n}},Tf=r=>{if(r.consume(1)[0]!==0){const e=Pf(r),n=kt(r),i=Fe(new Ut(n));return{entrypoint:e,value:i}}},If=r=>{if(r in Jo)return`${Jo[r]}`;if(r.length>Qi)throw new _c(r);return`ff${Ke({string:r}).slice(8)}`},Nf=r=>{if(!r||r.entrypoint==="default"&&"prim"in r.value&&r.value.prim==="Unit")return"00";const t=If(r.entrypoint),e=Ke(r.value),n=(e.length/2).toString(16).padStart(8,"0");return`ff${t}${n}${e}`},xf=r=>{const t=Ke(r);return`${tt(t.length/2)}${t}`},Lf=r=>{const t=kt(r);return Fe(new Ut(t))},Cf=yt(A.VH),Mf=_t(A.VH),Df=r=>`${Ke({string:r}).slice(2)}`,kf=r=>{const t=kt(r);return Buffer.from(t).toString("utf8")},Bf=r=>"",Hf=r=>({}),$f=yt(A.TXR1),jf=_t(A.TXR1),Vf=r=>`${tt(r.length/2)}${r}`,Uf=r=>{const t=kt(r);return Buffer.from(t).toString("hex")},Gf=r=>r?`ff${rs(r)}`:"00",Kf=r=>{const t=r.consume(1);if(Buffer.from(t).toString("hex")!=="00")return ns(r)},Ff=r=>r?`ff${rs(r)}`:"00",zf=r=>{const t=r.consume(1);if(Buffer.from(t).toString("hex")!=="00")return ns(r)},qf=(r,t=8)=>`${tt(r.length/2,t)}${r}`,Wf=r=>{const t=kt(r);return Buffer.from(t).toString("hex")},Yf=r=>{const t=r.reduce((e,n)=>e+`${tt(n.length/2)}${n}`,"");return`${tt(t.length/2)}${t}`},Zf=r=>{const t=kt(r);return Vp(new Ut(t)).map(n=>Buffer.from(n).toString("hex"))},Pc={branch:d.BRANCH,contents:[d.OPERATION]},is={pkh:d.TZ1,secret:d.SECRET},ss={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,public_key:d.PUBLIC_KEY},os={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,delegate:d.DELEGATE},as={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,amount:d.ZARITH,destination:d.ADDRESS,parameters:d.PARAMETERS},cs={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,balance:d.ZARITH,delegate:d.DELEGATE,script:d.SCRIPT},us={source:d.PKH,period:d.INT32,proposal:d.PROPOSAL,ballot:d.BALLOT_STATEMENT},ls={slot:d.INT16,level:d.INT32,round:d.INT32,block_payload_hash:d.BLOCK_PAYLOAD_HASH},hs={level:d.INT32,nonce:d.RAW},ds={source:d.PKH,period:d.INT32,proposals:d.PROPOSAL_ARR},ps={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,value:d.VALUE},fs={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,ticket_contents:d.VALUE,ticket_ty:d.VALUE,ticket_ticketer:d.ADDRESS,ticket_amount:d.ZARITH,destination:d.ADDRESS,entrypoint:d.ENTRYPOINT},gs={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,tx_rollup_origination:d.TX_ROLLUP_ORIGINATION_PARAM},ms={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,rollup:d.TX_ROLLUP_ID,content:d.TX_ROLLUP_BATCH_CONTENT,burn_limit:d.BURN_LIMIT},ys={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,amount:d.ZARITH,destination:d.SMART_CONTRACT_ADDRESS},bs={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,pk:d.PUBLIC_KEY},Es={consensus_key:d.PKH,delegate:d.PKH,destination:d.PKH},vs={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,limit:d.DEPOSITS_LIMIT},_s={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,pvm_kind:d.PVM_KIND,kernel:d.PADDED_BYTES,origination_proof:d.PADDED_BYTES,parameters_ty:d.VALUE},ws={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,message:d.SMART_ROLLUP_MESSAGE},As={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,rollup:d.SMART_ROLLUP_ADDRESS,cemented_commitment:d.SMART_ROLLUP_COMMITMENT_HASH,output_proof:d.PADDED_BYTES},Jf=r=>t=>{if(!(t.kind in r)||!(t.kind in Zo))throw new Ge(t.kind);return Zo[t.kind]+r[t.kind](t)},Xf=r=>t=>{const e=t.consume(1),n=wi[e[0]];if(n===void 0)throw new Lp(e[0].toString());const i=r[n](t);if(typeof i!="object")throw new wc("Invalid operation, cannot be decoded.");return Object.assign({kind:n},i)},nt=r=>t=>e=>Object.keys(t).reduce((i,s)=>{const o=t[s];if(e&&Array.isArray(o)){const a=r[o[0]],c=e[s];if(!Array.isArray(c))throw new xp(`Invalid operation value "${JSON.stringify(c)}" of key "${s}, expected value to be Array.`);return i+c.reduce((l,p)=>l+a(p),"")}else{const a=r[o];return i+a(e[s])}},""),it=r=>t=>e=>Object.keys(t).reduce((i,s)=>{const o=t[s];if(Array.isArray(o)){const a=r[o[0]],c=[],l=e.length();for(;e.length()>0;)if(c.push(a(e)),l===e.length())throw new wc("Unable to decode value");return Object.assign(Object.assign({},i),{[s]:c})}else{const a=r[o],c=a(e);return typeof c<"u"?Object.assign(Object.assign({},i),{[s]:c}):Object.assign({},i)}},{}),k={[d.SECRET]:r=>Yo(r.consume(20)),[d.RAW]:r=>Yo(r.consume(32)),[d.TZ1]:Qp,[d.BRANCH]:tf,[d.ZARITH]:ns,[d.PUBLIC_KEY]:_f,[d.PKH]:ts,[d.DELEGATE]:mf,[d.INT32]:df,[d.SCRIPT]:jp,[d.BALLOT_STATEMENT]:af,[d.PROPOSAL]:Oc,[d.PROPOSAL_ARR]:nf,[d.PARAMETERS]:Tf,[d.ADDRESS]:Af,[d.SMART_ROLLUP_ADDRESS]:Sf,[d.SMART_CONTRACT_ADDRESS]:Rf,[d.SMART_ROLLUP_COMMITMENT_HASH]:Of,[d.VALUE]:Lf,[d.INT16]:ff,[d.BLOCK_PAYLOAD_HASH]:Mf,[d.ENTRYPOINT]:kf,[d.TX_ROLLUP_ORIGINATION_PARAM]:Hf,[d.TX_ROLLUP_ID]:jf,[d.TX_ROLLUP_BATCH_CONTENT]:Uf,[d.BURN_LIMIT]:Kf,[d.DEPOSITS_LIMIT]:zf,[d.PVM_KIND]:uf,[d.PADDED_BYTES]:Wf,[d.SMART_ROLLUP_MESSAGE]:Zf};k[d.OPERATION]=Xf(k);k[d.OP_ACTIVATE_ACCOUNT]=r=>it(k)(is)(r);k[d.OP_DELEGATION]=r=>it(k)(os)(r);k[d.OP_TRANSACTION]=r=>it(k)(as)(r);k[d.OP_ORIGINATION]=r=>it(k)(cs)(r);k[d.OP_BALLOT]=r=>it(k)(us)(r);k[d.OP_ENDORSEMENT]=r=>it(k)(ls)(r);k[d.OP_SEED_NONCE_REVELATION]=r=>it(k)(hs)(r);k[d.OP_PROPOSALS]=r=>it(k)(ds)(r);k[d.OP_REVEAL]=r=>it(k)(ss)(r);k[d.OP_REGISTER_GLOBAL_CONSTANT]=r=>it(k)(ps)(r);k[d.OP_TRANSFER_TICKET]=r=>it(k)(fs)(r);k[d.OP_TX_ROLLUP_ORIGINATION]=r=>it(k)(gs)(r);k[d.OP_TX_ROLLUP_SUBMIT_BATCH]=r=>it(k)(ms)(r);k[d.OP_INCREASE_PAID_STORAGE]=r=>it(k)(ys)(r);k[d.OP_UPDATE_CONSENSUS_KEY]=r=>it(k)(bs)(r);k[d.OP_DRAIN_DELEGATE]=r=>it(k)(Es)(r);k[d.OP_SMART_ROLLUP_ORIGINATE]=r=>it(k)(_s)(r);k[d.OP_SMART_ROLLUP_ADD_MESSAGES]=r=>it(k)(ws)(r);k[d.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=r=>it(k)(As)(r);k[d.MANAGER]=it(k)(Pc);k[d.OP_SET_DEPOSITS_LIMIT]=r=>it(k)(vs)(r);const B={[d.SECRET]:r=>r,[d.RAW]:r=>r,[d.TZ1]:rf,[d.BRANCH]:ef,[d.ZARITH]:rs,[d.PUBLIC_KEY]:yf,[d.PKH]:es,[d.DELEGATE]:lf,[d.SCRIPT]:$p,[d.BALLOT_STATEMENT]:of,[d.PROPOSAL]:Rc,[d.PROPOSAL_ARR]:sf,[d.INT32]:hf,[d.PARAMETERS]:Nf,[d.ADDRESS]:bf,[d.SMART_ROLLUP_ADDRESS]:Ef,[d.SMART_CONTRACT_ADDRESS]:vf,[d.SMART_ROLLUP_COMMITMENT_HASH]:wf,[d.VALUE]:xf,[d.INT16]:pf,[d.BLOCK_PAYLOAD_HASH]:Cf,[d.ENTRYPOINT]:Df,[d.TX_ROLLUP_ORIGINATION_PARAM]:Bf,[d.TX_ROLLUP_ID]:$f,[d.TX_ROLLUP_BATCH_CONTENT]:Vf,[d.BURN_LIMIT]:Gf,[d.DEPOSITS_LIMIT]:Ff,[d.PVM_KIND]:cf,[d.PADDED_BYTES]:qf,[d.SMART_ROLLUP_MESSAGE]:Yf};B[d.OPERATION]=Jf(B);B[d.OP_ACTIVATE_ACCOUNT]=r=>nt(B)(is)(r);B[d.OP_DELEGATION]=r=>nt(B)(os)(r);B[d.OP_TRANSACTION]=r=>nt(B)(as)(r);B[d.OP_ORIGINATION]=r=>nt(B)(cs)(r);B[d.OP_BALLOT]=r=>nt(B)(us)(r);B[d.OP_ENDORSEMENT]=r=>nt(B)(ls)(r);B[d.OP_SEED_NONCE_REVELATION]=r=>nt(B)(hs)(r);B[d.OP_PROPOSALS]=r=>nt(B)(ds)(r);B[d.OP_REVEAL]=r=>nt(B)(ss)(r);B[d.OP_REGISTER_GLOBAL_CONSTANT]=r=>nt(B)(ps)(r);B[d.OP_TRANSFER_TICKET]=r=>nt(B)(fs)(r);B[d.OP_TX_ROLLUP_ORIGINATION]=r=>nt(B)(gs)(r);B[d.OP_TX_ROLLUP_SUBMIT_BATCH]=r=>nt(B)(ms)(r);B[d.OP_INCREASE_PAID_STORAGE]=r=>nt(B)(ys)(r);B[d.OP_UPDATE_CONSENSUS_KEY]=r=>nt(B)(bs)(r);B[d.OP_DRAIN_DELEGATE]=r=>nt(B)(Es)(r);B[d.OP_SMART_ROLLUP_ORIGINATE]=r=>nt(B)(_s)(r);B[d.OP_SMART_ROLLUP_ADD_MESSAGES]=r=>nt(B)(ws)(r);B[d.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=r=>nt(B)(As)(r);B[d.MANAGER]=nt(B)(Pc);B[d.OP_SET_DEPOSITS_LIMIT]=r=>nt(B)(vs)(r);const Tc={activate_account:is,reveal:ss,delegation:os,transaction:as,origination:cs,ballot:us,endorsement:ls,seed_nonce_revelation:hs,proposals:ds,register_global_constant:ps,transfer_ticket:fs,tx_rollup_origination:gs,tx_rollup_submit_batch:ms,increase_paid_storage:ys,update_consensus_key:bs,drain_delegate:Es,set_deposits_limit:vs,smart_rollup_originate:_s,smart_rollup_add_messages:ws,smart_rollup_execute_outbox_message:As},Qf=(r,t)=>t.filter(e=>!r.includes(e)),tg=(r,t)=>r.filter(e=>e!==t),eg=r=>Object.keys(Tc).includes(r),rg=r=>{const t=r.kind,e=Object.keys(r),n=tg(e,"kind"),i=Object.keys(Tc[t]);return Qf(n,i)};var Ai;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(Ai||(Ai={}));const ng=Ai.PtMumbai2;function ig(r,t){return{encoder:B[r],decoder:e=>{const n=Ut.fromHexString(e);return k[r](n)}}}class Ic{constructor(t=ng){this.protocolHash=t,this.codec=ig(d.MANAGER,this.protocolHash)}forge(t){const e=eu(t.branch);if(e!==O.VALID)throw new ru(t.branch,M(e));for(const i of t.contents){if(!eg(i.kind))throw new Ge(i.kind);const s=rg(i);if(s.length===1){if(i.kind==="delegation"&&s[0]==="delegate")continue;if(i.kind==="origination"&&s[0]==="delegate")continue;if(i.kind==="transaction"&&s[0]==="parameters")continue;if(i.kind==="set_deposits_limit"&&s[0]==="limit")continue;if(i.kind==="tx_rollup_submit_batch"&&s[0]==="burn_limit")continue;throw new Xo(i,`missing properties "${s.join(", ")}"`)}else if(s.length>1)throw new Xo(i,`missing properties "${s.join(", ")}"`)}const n=this.codec.encoder(t).toLowerCase();return Promise.resolve(n)}parse(t){return Promise.resolve(this.codec.decoder(t))}}const Lm=new Ic;function gt(r,t){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(e[n[i]]=r[n[i]]);return e}function g(r,t,e,n){function i(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(p){try{l(n.next(p))}catch(h){o(h)}}function c(p){try{l(n.throw(p))}catch(h){o(h)}}function l(p){p.done?s(p.value):i(p.value).then(a,c)}l((n=n.apply(r,t||[])).next())})}function Xr(r,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(r):n?n.value:t.get(r)}function lt(r,t,e,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?r!==t||!i:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,e):i?i.value=e:t.set(r,e),e}function sg(r,t){const e=JSON.parse(r.body);if(e[0]&&e[0].kind&&e[0].msg){const n=JSON.stringify({kind:e[0].kind,id:e[0].id,msg:e[0].msg.replace(t,"")});return new wr(`Http error response: (${r.status}) ${n}`,r.status,r.statusText,n,r.url)}else return r}class og{constructor(t){this.context=t}inject(t){return g(this,void 0,void 0,function*(){let e;try{e=yield this.context.rpc.injectOperation(t)}catch(n){const i=". You may want to use --replace to provide adequate fee and replace it";throw n instanceof wr&&n.message.includes(i)?sg(n,i):n}return e})}}class Qr extends Error{constructor(){super("No signer has been configured. Please configure one by calling setProvider({signer}) on your TezosToolkit instance."),this.name="UnconfiguredSignerError"}}class Si{publicKey(){return g(this,void 0,void 0,function*(){throw new Qr})}publicKeyHash(){return g(this,void 0,void 0,function*(){throw new Qr})}secretKey(){return g(this,void 0,void 0,function*(){throw new Qr})}sign(t,e){return g(this,void 0,void 0,function*(){throw new Qr})}}function Nc(r){return new Q(t=>(r.on("data",e=>{t.next(e)}),r.on("error",e=>{t.error(e)}),r.on("close",()=>{t.complete()}),()=>{r.close()}))}var ce;(function(r){r[r.DELEGATION=10600]="DELEGATION",r[r.ORIGINATION=10600]="ORIGINATION",r[r.TRANSFER=10600]="TRANSFER",r[r.REVEAL_TZ1=2e3]="REVEAL_TZ1",r[r.REVEAL_TZ2=2e3]="REVEAL_TZ2",r[r.REVEAL_TZ3=2e3]="REVEAL_TZ3",r[r.REVEAL_TZ4=2e3]="REVEAL_TZ4"})(ce||(ce={}));var Ie;(function(r){r[r.DELEGATION=1257]="DELEGATION",r[r.ORIGINATION=1e4]="ORIGINATION",r[r.TRANSFER=1e4]="TRANSFER",r[r.REVEAL=374]="REVEAL"})(Ie||(Ie={}));var Ne;(function(r){r[r.DELEGATION=0]="DELEGATION",r[r.ORIGINATION=257]="ORIGINATION",r[r.TRANSFER=257]="TRANSFER",r[r.REVEAL=0]="REVEAL"})(Ne||(Ne={}));const ag=250;var st;(function(r){r.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(st||(st={}));st.Pt24m4xi,st.PsBABY5H,st.PsBabyM1,st.PsCARTHA,st.PsDELPH1,st.PtEdo2Zk,st.PsFLorena,st.PtGRANADs,st.PtHangz2,st.PsiThaCa,st.Psithaca2,st.PtJakart2,st.PtKathman,st.PtLimaPtL,st.PtMumbai2,st.PtNairobi,st.ProtoALpha;var ea;(function(r){r.MAINNET="NetXdQprcVkpaWU",r.CARTHAGENET="NetXjD3HPJJjmcd",r.DELPHINET="NetXm8tYqnMWky1",r.EDONET="NetXSgo1ZT2DRUG",r.FLORENCENET="NetXxkAx4woPLyu",r.GRANADANET="NetXz969SFaFn8k",r.HANGZHOUNET="NetXZSsxBpMQeAT",r.ITHACANET="NetXbhmtAbMukLc",r.ITHACANET2="NetXnHfVqm9iesp",r.JAKARTANET2="NetXLH1uAxK7CCh",r.KATHMANDUNET="NetXazhm4yetmff",r.LIMANET="NetXizpkH94bocH",r.MUMBAINET="NetXQw6nWSnrJ5t",r.MUMBAINET2="NetXgbcrNtXD2yA",r.NAIROBINET="NetXyuzvDo2Ugzb"})(ea||(ea={}));const Ri=r=>Math.round(cg(r)*11/10),cg=r=>{switch(r.substring(0,3)){case"tz1":return ce.REVEAL_TZ1;case"tz2":return ce.REVEAL_TZ2;case"tz3":return ce.REVEAL_TZ3;case"tz4":return ce.REVEAL_TZ4;default:throw new Error(`Cannot estimate reveal gas limit for ${r}`)}};class xc extends Error{constructor(t,e,n){super(`${t} Received ${n.length} arguments while expecting one of the following signatures (${JSON.stringify(e)})`),this.smartContractMethodName=t,this.sigs=e,this.args=n,this.name="Invalid parameters error"}}class ug extends Error{constructor(t){super(`Since Babylon delegation source can no longer be a contract address ${t}. Please use the smart contract abstraction to set your delegate.`),this.source=t,this.name="Invalid delegation source error"}}class An extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="InvalidCodeParameter"}}class Lc extends Error{constructor(t,e){super(t),this.message=t,this.data=e,this.name="InvalidInitParameter"}}class lg extends Error{constructor(t,e,n,i){super(t),this.message=t,this.viewName=e,this.failWith=n,this.originalError=i,this.name="ViewSimulationError"}}const hg=r=>{if(dg(r.body)){const t=JSON.parse(r.body);if(Array.isArray(t)&&"with"in t[t.length-1])return t[t.length-1].with}},dg=r=>{try{JSON.parse(r)}catch{return!1}return!0};class ra extends Error{constructor(t){super(`${t} Please configure the context of the view execution in the executeView method.`),this.info=t,this.name="InvalidViewSimulationContext"}}class pg extends Error{constructor(t){super(t),this.message=t,this.name="RevealOperationError"}}class fg extends Error{constructor(t){super(t),this.message=t,this.name="OriginationParameterError"}}class gg extends Error{constructor(t){super(t),this.message=t,this.name="IntegerError"}}const mg=({pkh:r,secret:t})=>g(void 0,void 0,void 0,function*(){return{kind:y.ACTIVATION,pkh:r,secret:t}}),Ss=({code:r,init:t,balance:e="0",delegate:n,storage:i,fee:s=Ie.ORIGINATION,gasLimit:o=ce.ORIGINATION,storageLimit:a=Ne.ORIGINATION,mutez:c=!1})=>g(void 0,void 0,void 0,function*(){if(i!==void 0&&t!==void 0)throw new fg("Storage and Init cannot be set a the same time. Please either use storage or init but not both.");if(!Array.isArray(r))throw new An("Wrong code parameter type, expected an array",r);let l;if(i!==void 0){const b=r.find(_=>"prim"in _&&_.prim==="storage");if((b==null?void 0:b.args)===void 0)throw new An("The storage section is missing from the script",r);l=new Lt(b.args[0]).Encode(i)}else if(t!==void 0&&typeof t=="object")l=t;else throw new Lc("Wrong init parameter type, expected JSON Michelson",t);const p={code:r,storage:l};if(isNaN(Number(e)))throw new gg(`Unexpected Invalid Integer ${e}`);const h={kind:y.ORIGINATION,fee:s,gas_limit:o,storage_limit:a,balance:c?e.toString():Ci("tz","mutez",e).toString(),script:p};return n&&(h.delegate=n),h}),Rs=({to:r,amount:t,parameter:e,fee:n=Ie.TRANSFER,gasLimit:i=ce.TRANSFER,storageLimit:s=Ne.TRANSFER,mutez:o=!1})=>g(void 0,void 0,void 0,function*(){return{kind:y.TRANSACTION,fee:n,gas_limit:i,storage_limit:s,amount:o?t.toString():Ci("tz","mutez",t).toString(),destination:r,parameters:e}}),Os=({delegate:r,source:t,fee:e=Ie.DELEGATION,gasLimit:n=ce.DELEGATION,storageLimit:i=Ne.DELEGATION})=>g(void 0,void 0,void 0,function*(){return{kind:y.DELEGATION,source:t,fee:e,gas_limit:n,storage_limit:i,delegate:r}}),yg=({fee:r=Ie.DELEGATION,gasLimit:t=ce.DELEGATION,storageLimit:e=Ne.DELEGATION},n)=>g(void 0,void 0,void 0,function*(){return{kind:y.DELEGATION,fee:r,gas_limit:t,storage_limit:e,delegate:n}}),ui=({fee:r=Ie.REVEAL,gasLimit:t=void 0,storageLimit:e=Ne.REVEAL},n,i)=>g(void 0,void 0,void 0,function*(){return{kind:y.REVEAL,fee:r,public_key:i,source:n,gas_limit:t??Ri(n),storage_limit:e}}),Ps=({value:r,source:t,fee:e,gasLimit:n,storageLimit:i})=>g(void 0,void 0,void 0,function*(){return{kind:y.REGISTER_GLOBAL_CONSTANT,value:r,fee:e,gas_limit:n,storage_limit:i,source:t}}),Ts=({ticketContents:r,ticketTy:t,ticketTicketer:e,ticketAmount:n,destination:i,entrypoint:s,source:o,fee:a,gasLimit:c,storageLimit:l})=>g(void 0,void 0,void 0,function*(){return{kind:y.TRANSFER_TICKET,fee:a,gas_limit:c,storage_limit:l,source:o,ticket_contents:r,ticket_ty:t,ticket_ticketer:e,ticket_amount:n,destination:i,entrypoint:s}}),Is=({source:r,fee:t,gasLimit:e,storageLimit:n,amount:i,destination:s})=>g(void 0,void 0,void 0,function*(){return{kind:y.INCREASE_PAID_STORAGE,source:r,fee:t,gas_limit:e,storage_limit:n,amount:i,destination:s}}),bg=({consensus_key:r,delegate:t,destination:e})=>g(void 0,void 0,void 0,function*(){return{kind:y.DRAIN_DELEGATE,consensus_key:r,delegate:t,destination:e}}),Eg=({source:r,proposal:t,ballot:e})=>g(void 0,void 0,void 0,function*(){return{kind:y.BALLOT,source:r,proposal:t,ballot:e}}),vg=({source:r,proposals:t})=>g(void 0,void 0,void 0,function*(){return{kind:y.PROPOSALS,source:r,proposals:t}}),_g=({source:r,fee:t,gasLimit:e,storageLimit:n,pk:i})=>g(void 0,void 0,void 0,function*(){return{kind:y.UPDATE_CONSENSUS_KEY,source:r,fee:t,gas_limit:e,storage_limit:n,pk:i}}),Ns=({source:r,fee:t,gasLimit:e,storageLimit:n,message:i})=>g(void 0,void 0,void 0,function*(){return{kind:y.SMART_ROLLUP_ADD_MESSAGES,source:r,fee:t,gas_limit:e,storage_limit:n,message:i}}),xs=({source:r,fee:t,gasLimit:e,storageLimit:n,pvmKind:i,kernel:s,originationProof:o,parametersType:a})=>g(void 0,void 0,void 0,function*(){return{kind:y.SMART_ROLLUP_ORIGINATE,source:r,fee:t,gas_limit:e,storage_limit:n,pvm_kind:i,kernel:s,origination_proof:o,parameters_ty:a}}),tn=(r,t)=>Object.assign(Object.assign({},r),{kind:t}),na=(r,t)=>{if(Array.isArray(r)){const e=r.find(n=>n.kind===t);if(e&&wg(e,t))return e}},wg=(r,t)=>r.kind===t,Oi=r=>["transaction","delegation","origination","reveal","register_global_constant","increase_paid_storage","tx_rollup_origination","tx_rollup_submit_batch","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate"].indexOf(r.kind)!==-1,Cc=r=>["transaction","delegation","origination","register_global_constant","increase_paid_storage","tx_rollup_origination","tx_rollup_submit_batch","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate"].indexOf(r.kind)!==-1,Ls=r=>"metadata"in r,Rr=r=>Ls(r)&&"operation_result"in r.metadata,Ag=r=>Ls(r)&&"internal_operation_results"in r.metadata,Sg=r=>"with"in r;class Mc extends Error{constructor(t,e){super(),this.errors=t,this.errorDetails=e,this.name="TezosOperationError";const n=t[t.length-1];this.id=n.id,this.kind=n.kind,this.message=`(${this.kind}) ${this.id}`,Sg(n)&&(n.with.string?this.message=n.with.string:n.with.int?this.message=n.with.int:this.message=JSON.stringify(n.with))}}class Rg extends Error{constructor(t){super("Preapply returned an unexpected result"),this.result=t,this.name="TezosPreapplyFailureError"}}const le=r=>{const t=Array.isArray(r)?r:[r],e=[];for(let n=0;n<t.length;n++)for(let i=0;i<t[n].contents.length;i++){const s=t[n].contents[i];Rr(s)&&(e.push(Object.assign({fee:s.fee},s.metadata.operation_result)),Array.isArray(s.metadata.internal_operation_results)&&s.metadata.internal_operation_results.forEach(o=>e.push(o.result)))}return e},_r=(r,t="failed")=>{const e=Array.isArray(r)?r:[r];let n=[];for(let i=0;i<e.length;i++)for(let s=0;s<e[i].contents.length;s++){const o=e[i].contents[s];if(Ls(o)&&(Rr(o)&&o.metadata.operation_result.status===t&&(n=n.concat(o.metadata.operation_result.errors||[])),Ag(o)&&Array.isArray(o.metadata.internal_operation_results)))for(const a of o.metadata.internal_operation_results)"result"in a&&a.result.status===t&&(n=n.concat(a.result.errors||[]))}return n};class Og extends Error{constructor(t){super(t),this.message=t,this.name="OriginationOperationError"}}class li extends Error{constructor(t){super(t),this.message=t,this.name="InvalidEstimateValueError"}}class Dc extends Error{constructor(t){super(t),this.message=t,this.name="InvalidConfirmationCountError"}}class Pg extends Error{constructor(t){super(t),this.message=t,this.name="ConfirmationUndefinedError"}}class Tg extends Error{constructor(t){super(t),this.message=t,this.name="InvalidFilterExpressionError"}}class en extends Error{constructor(t){super(t),this.message=t,this.name="RPCResponseError"}}class Ig extends Error{constructor(){super("Unable to retrieve public key from signer. If you are using a wallet, make sure your account is revealed"),this.name="PublicKeyNotFoundError"}}class wt{constructor(t,e,n,i){if(this.hash=t,this.raw=e,this.results=n,this.context=i,this._pollingConfig$=new kr(1),this.currentHead$=this._pollingConfig$.pipe(ae(s=>new In(s).pipe(Wa(s.timeout*1e3,Ki(new Error("Confirmation polling timed out"))))),ae(()=>Ka(()=>Nc(this.context.stream.subscribeBlock("head"))).pipe(ae(s=>{var o,a;const c=(a=(o=this.lastHead)===null||o===void 0?void 0:o.header.level)!==null&&a!==void 0?a:s.header.level-1;return zi(c+1,s.header.level-c-1).pipe(Gr(l=>this.context.readProvider.getBlock(l)),za(s))}),yn(s=>this.lastHead=s))),No({refCount:!0})),this.confirmed$=this.currentHead$.pipe(tr(s=>{for(let o=3;o>=0;o--)s.operations[o].forEach(a=>{a.hash===this.hash&&(this._foundAt=s.header.level)});if(s.header.level-this._foundAt>=0)return this._foundAt}),mn(s=>s!==void 0),Ae(),No()),this._foundAt=Number.POSITIVE_INFINITY,ga(this.hash)!==O.VALID)throw new ma(this.hash);this.confirmed$.pipe(Ae(),qi(()=>Ar(Ba))).subscribe()}get includedInBlock(){return this._foundAt}get revealOperation(){return Array.isArray(this.results)&&this.results.find(t=>t.kind==="reveal")}get revealStatus(){return this.revealOperation?this.revealOperation.metadata.operation_result.status:"unknown"}get status(){return this.results.map(t=>Rr(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}confirmation(t,e){return g(this,void 0,void 0,function*(){if(typeof t<"u"&&t<1)throw new Dc("Confirmation count must be at least 1");const{defaultConfirmationCount:n,confirmationPollingTimeoutSecond:i}=this.context.config;this._pollingConfig$.next({timeout:e||i});const s=t!==void 0?t:n;return new Promise((o,a)=>{this.confirmed$.pipe(ae(()=>this.currentHead$),mn(c=>c.header.level-this._foundAt>=s-1),Ae()).subscribe(c=>{o(this._foundAt+(s-1))},a)})})}}class Ng extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}sumProp(t,e){return t.reduce((n,i)=>e in i?Number(i[e])+n:n,0)}getOriginatedContractAddresses(){const t=this.results.filter(n=>n.kind==="origination");let e=[];for(const n of t)n.metadata.operation_result.originated_contracts&&(e=[...e,...n.metadata.operation_result.originated_contracts]);return e}get status(){return this.results.filter(t=>Hc.indexOf(t.kind)!==-1).map(t=>Rr(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}get fee(){return this.sumProp(this.params,"fee")}get gasLimit(){return this.sumProp(this.params,"gas_limit")}get storageLimit(){return this.sumProp(this.params,"storage_limit")}get consumedGas(){return P.config({DECIMAL_PLACES:0,ROUNDING_MODE:P.ROUND_UP}),new P(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(le({contents:this.results}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(le({contents:this.results}),"paid_storage_size_diff"))}get errors(){return _r({contents:this.results})}}class Kr{constructor(t){this.context=t}get rpc(){return this.context.rpc}get signer(){return this.context.signer}forge({opOb:{branch:t,contents:e,protocol:n},counter:i}){return g(this,void 0,void 0,function*(){return{opbytes:yield this.context.forger.forge({branch:t,contents:e}),opOb:{branch:t,contents:e,protocol:n},counter:i}})}estimate(t,e){var{fee:n,gasLimit:i,storageLimit:s}=t,o=gt(t,["fee","gasLimit","storageLimit"]);return g(this,void 0,void 0,function*(){let a=n,c=i,l=s;if(a&&a%1!==0)throw new li(`Fee value must not be a decimal: ${a}`);if(c&&c%1!==0)throw new li(`Gas Limit value must not be a decimal: ${c}`);if(l&&l%1!==0)throw new li(`Storage Limit value must not be a decimal: ${l}`);if(n===void 0||i===void 0||s===void 0){const p=yield e(Object.assign({fee:n,gasLimit:i,storageLimit:s},o));a??(a=p.suggestedFeeMutez),c??(c=p.gasLimit),l??(l=p.storageLimit)}return{fee:a,gasLimit:c,storageLimit:l}})}getRPCOp(t){return g(this,void 0,void 0,function*(){switch(t.kind){case y.TRANSACTION:return Rs(Object.assign({},t));case y.ORIGINATION:return Ss(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case y.DELEGATION:return Os(Object.assign({},t));case y.REGISTER_GLOBAL_CONSTANT:return Ps(Object.assign({},t));case y.INCREASE_PAID_STORAGE:return Is(Object.assign({},t));case y.TRANSFER_TICKET:return Ts(Object.assign({},t));case y.SMART_ROLLUP_ADD_MESSAGES:return Ns(Object.assign({},t));case y.SMART_ROLLUP_ORIGINATE:return xs(Object.assign({},t));default:throw new Ge(t.kind)}})}simulate(t){return g(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.runOperation(t),op:t,context:this.context.clone()}})}isRevealOpNeeded(t,e){return g(this,void 0,void 0,function*(){return!(!(yield this.isAccountRevealRequired(e))||!this.isRevealRequiredForOpType(t))})}isAccountRevealRequired(t){return g(this,void 0,void 0,function*(){return!(yield this.context.readProvider.isAccountRevealed(t,"head"))})}isRevealRequiredForOpType(t){let e=!1;for(const n of t)Cc(n)&&(e=!0);return e}signAndInject(t){return g(this,void 0,void 0,function*(){const e=yield this.signer.sign(t.opbytes,new Uint8Array([3]));t.opbytes=e.sbytes,t.opOb.signature=e.prefixSig;const n=[],i=yield this.rpc.preapplyOperations([t.opOb]);if(!Array.isArray(i))throw new Rg(i);for(let o=0;o<i.length;o++)for(let a=0;a<i[o].contents.length;a++)n.push(i[o].contents[a]);const s=_r(i);if(s.length)throw new Mc(s,"Error occurred during validation simulation of operation");return{hash:yield this.context.injector.inject(t.opbytes),forgedBytes:t,opResponse:n,context:this.context.clone()}})}}class xg{constructor(t,e){this.walletProvider=t,this.context=e,this.operations=[]}withTransfer(t){const e=F(t.to);if(e!==O.VALID)throw new W(t.to,M(e));return this.operations.push(Object.assign({kind:y.TRANSACTION},t)),this}withContractCall(t,e={}){return this.withTransfer(t.toTransferParams(e))}withDelegation(t){var e;const n=F((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&n!==O.VALID)throw new W(t.delegate,M(n));return this.operations.push(Object.assign({kind:y.DELEGATION},t)),this}withOrigination(t){return this.operations.push(Object.assign({kind:y.ORIGINATION},t)),this}withIncreasePaidStorage(t){const e=F(t.destination);if(e!==O.VALID)throw new W(t.destination,M(e));return this.operations.push(Object.assign({kind:y.INCREASE_PAID_STORAGE},t)),this}mapOperation(t){return g(this,void 0,void 0,function*(){switch(t.kind){case y.TRANSACTION:return this.walletProvider.mapTransferParamsToWalletParams(()=>g(this,void 0,void 0,function*(){return t}));case y.ORIGINATION:return this.walletProvider.mapOriginateParamsToWalletParams(()=>g(this,void 0,void 0,function*(){return this.context.parser.prepareCodeOrigination(Object.assign({},t))}));case y.DELEGATION:return this.walletProvider.mapDelegateParamsToWalletParams(()=>g(this,void 0,void 0,function*(){return t}));case y.INCREASE_PAID_STORAGE:return this.walletProvider.mapIncreasePaidStorageWalletParams(()=>g(this,void 0,void 0,function*(){return t}));default:throw new Ge(JSON.stringify(t.kind))}})}with(t){for(const e of t)switch(e.kind){case y.TRANSACTION:this.withTransfer(e);break;case y.ORIGINATION:this.withOrigination(e);break;case y.DELEGATION:this.withDelegation(e);break;case y.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;default:throw new Ge(JSON.stringify(e.kind))}return this}send(){return g(this,void 0,void 0,function*(){const t=[];for(const n of this.operations)t.push(yield this.mapOperation(n));const e=yield this.walletProvider.sendOperations(t);return this.context.operationFactory.createBatchOperation(e)})}}class Mn{constructor(t){this.context=t,this.walletCommand=e=>({send:e})}get walletProvider(){return this.context.walletProvider}pkh({forceRefetch:t}={}){return g(this,void 0,void 0,function*(){return(!this._pkh||t)&&(this._pkh=yield this.walletProvider.getPKH()),this._pkh})}originate(t){return this.walletCommand(()=>g(this,void 0,void 0,function*(){const e=yield this.walletProvider.mapOriginateParamsToWalletParams(()=>this.context.parser.prepareCodeOrigination(Object.assign({},t))),n=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createOriginationOperation(n)}))}setDelegate(t){var e;const n=F((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&n!==O.VALID)throw new W(t.delegate,M(n));return this.walletCommand(()=>g(this,void 0,void 0,function*(){const i=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>g(this,void 0,void 0,function*(){return t})),s=yield this.walletProvider.sendOperations([i]);return this.context.operationFactory.createDelegationOperation(s)}))}registerDelegate(){return this.walletCommand(()=>g(this,void 0,void 0,function*(){const t=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>g(this,void 0,void 0,function*(){return{delegate:yield this.pkh()}})),e=yield this.walletProvider.sendOperations([t]);return this.context.operationFactory.createDelegationOperation(e)}))}transfer(t){const e=F(t.to);if(e!==O.VALID)throw new W(t.to,M(e));return this.walletCommand(()=>g(this,void 0,void 0,function*(){const n=yield this.walletProvider.mapTransferParamsToWalletParams(()=>g(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([n]);return this.context.operationFactory.createTransactionOperation(i)}))}increasePaidStorage(t){const e=F(t.destination);if(e!==O.VALID)throw new W(t.destination,M(e));return this.walletCommand(()=>g(this,void 0,void 0,function*(){const n=yield this.walletProvider.mapIncreasePaidStorageWalletParams(()=>g(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([n]);return this.context.operationFactory.createIncreasePaidStorageOperation(i)}))}batch(t){const e=new xg(this.walletProvider,this.context);return Array.isArray(t)&&e.with(t),e}at(t,e=n=>n){return g(this,void 0,void 0,function*(){const n=hr(t);if(n!==O.VALID)throw new Qe(t,M(n));const i=this.context.withExtensions().rpc,s=this.context.withExtensions().readProvider,o=yield s.getScript(t,"head"),a=yield s.getEntrypoints(t),c=new Bc(t,o,this,this.context.contract,a,i,s);return e(c,this.context)})}}const Lg=(r,{ALLOCATION_BURN:t,ORIGINATION_BURN:e}={ALLOCATION_BURN:257,ORIGINATION_BURN:257})=>{P.config({DECIMAL_PLACES:0,ROUNDING_MODE:P.ROUND_UP});const n=le({contents:r});let i=new P(0),s=new P(0),o=new P(0),a=new P(0),c=new P(0),l=new P(0);return n.forEach(p=>{o=o.plus(p.fee||0),a=a.plus(Array.isArray(p.originated_contracts)?p.originated_contracts.length*e:0),c=c.plus("allocated_destination_contract"in p?t:0),i=i.plus(p.consumed_milligas||0),l=l.plus("paid_storage_size_diff"in p&&Number(p.paid_storage_size_diff)||0)}),s=s.plus(c).plus(a).plus(l),{totalFee:o,totalMilliGas:i,totalGas:i.dividedBy(1e3),totalStorage:s,totalAllocationBurn:c,totalOriginationBurn:a,totalPaidStorageDiff:l,totalStorageBurn:new P(s.multipliedBy(ag))}},Cg=60;class Or{constructor(t,e,n){if(this.opHash=t,this.context=e,this._newHead$=n,this._operationResult=new kr(1),this._includedInBlock=new kr(1),this._included=!1,this.newHead$=this._newHead$.pipe(ae(i=>{var s,o;const a=(o=(s=this.lastHead)===null||s===void 0?void 0:s.header.level)!==null&&o!==void 0?o:i.header.level-1;return zi(a+1,i.header.level-a-1).pipe(Gr(c=>this.context.readProvider.getBlock(c)),za(i))}),yn(i=>this.lastHead=i),mi(1),Mr()),this.confirmed$=this.newHead$.pipe(tr(i=>{for(const s of i.operations)for(const o of s)if(o.hash===this.opHash)return this._included=!0,this._includedInBlock.next(i),this._operationResult.next(o.contents),i}),mn(i=>typeof i<"u"),Ae(),mi(1),Mr()),ga(this.opHash)!==O.VALID)throw new ma(this.opHash);this.confirmed$.pipe(Ae(),qi(()=>Ar(void 0))).subscribe()}operationResults(){return g(this,void 0,void 0,function*(){return this._operationResult.pipe(Ae()).toPromise()})}receipt(){return g(this,void 0,void 0,function*(){return Lg(yield this.operationResults())})}getCurrentConfirmation(){return g(this,void 0,void 0,function*(){return this._included?Oo([this._includedInBlock,rr(this.context.readProvider.getBlock("head"))]).pipe(tr(([t,e])=>e.header.level-t.header.level+1),Ae()).toPromise():0})}isInCurrentBranch(t="head"){return g(this,void 0,void 0,function*(){if(!this._included)return!0;const e=yield this.context.readProvider.getBlockLevel(t),n=yield this._includedInBlock.pipe(Ae()).toPromise(),i=e-n.header.level;if(i<=0)return!0;const s=Math.min(n.header.level+i,n.header.level+Cg);return new Set(yield this.context.readProvider.getLiveBlocks(s)).has(n.hash)})}confirmationObservable(t){if(typeof t<"u"&&t<1)throw new Dc("Confirmation count must be at least 1");const{defaultConfirmationCount:e}=this.context.config,n=t!==void 0?t:e;if(n===void 0)throw new Pg("Default confirmation count can not be undefined!");return Oo([this._includedInBlock,this.newHead$]).pipe(Fa(([,i],[,s])=>i.hash===s.hash),tr(([i,s])=>({block:s,expectedConfirmation:n,currentConfirmation:s.header.level-i.header.level+1,completed:s.header.level-i.header.level>=n-1,isInCurrentBranch:()=>this.isInCurrentBranch(s.hash)})),Vh(({completed:i})=>!i,!0))}confirmation(t){return this.confirmationObservable(t).toPromise()}}class Mg extends Or{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}revealOperation(){return g(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===y.REVEAL)})}transactionOperation(){return g(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===y.TRANSACTION)})}status(){return g(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.transactionOperation();return t?t.metadata.operation_result.status:"unknown"})}}class Dg extends Or{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}originationOperation(){return g(this,void 0,void 0,function*(){const t=yield this.operationResults();return na(t,y.ORIGINATION)})}revealOperation(){return g(this,void 0,void 0,function*(){const t=yield this.operationResults();return na(t,y.REVEAL)})}status(){return g(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.originationOperation();return t?t.metadata.operation_result.status:"unknown"})}contract(){return g(this,void 0,void 0,function*(){const t=yield this.originationOperation(),e=((t==null?void 0:t.metadata.operation_result.originated_contracts)||[])[0];return this.context.wallet.at(e)})}}class kg extends Or{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}revealOperation(){return g(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===y.REVEAL)})}delegationOperation(){return g(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===y.DELEGATION)})}status(){return g(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.delegationOperation();return t?t.metadata.operation_result.status:"unknown"})}}class kc{constructor(t){this.context=t}getPKH(){return g(this,void 0,void 0,function*(){return this.context.signer.publicKeyHash()})}mapTransferParamsToWalletParams(t){return g(this,void 0,void 0,function*(){return tn(yield t(),y.TRANSACTION)})}mapOriginateParamsToWalletParams(t){return g(this,void 0,void 0,function*(){return tn(yield t(),y.ORIGINATION)})}mapDelegateParamsToWalletParams(t){return g(this,void 0,void 0,function*(){return tn(yield t(),y.DELEGATION)})}mapIncreasePaidStorageWalletParams(t){return g(this,void 0,void 0,function*(){return tn(yield t(),y.INCREASE_PAID_STORAGE)})}sendOperations(t){return g(this,void 0,void 0,function*(){return(yield this.context.batch.batch(t).send()).hash})}}class Bg{constructor(t,e,n,i,s="unit",o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=n,this.name=i,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}getSignature(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}send(t={}){return this.provider instanceof Mn?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:n,source:i,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:i,gasLimit:e,storageLimit:n,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:lr,value:this.isAnonymous?this.parameterSchema.EncodeObject({[this.name]:this.args}):this.parameterSchema.EncodeObject(this.args)}}}}class Hg{constructor(t,e,n,i,s,o=!0,a=!1){this.provider=t,this.address=e,this.parameterSchema=n,this.name=i,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}validateArgs(t,e,n){const i=e.ExtractSignatures();if(!i.find(s=>s.length===t.length))throw new xc(n,i,t)}get schema(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}getSignature(){if(this.isAnonymous){const t=this.parameterSchema.ExtractSignatures().find(e=>e[0]===this.name);if(t)return t.shift(),t}else{const t=this.parameterSchema.ExtractSignatures();return t.length==1?t[0]:t}}send(t={}){return this.provider instanceof Mn?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:e,storageLimit:n,source:i,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:i,gasLimit:e,storageLimit:n,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:lr,value:this.isAnonymous?this.parameterSchema.Encode(this.name,...this.args):this.parameterSchema.Encode(...this.args)}}}}class $g{constructor(t,e,n,i,s,o="Unit"){this._rpc=t,this._readProvider=e,this._contractAddress=n,this._smartContractViewSchema=i,this._contractStorageType=s,this._args=o}getSignature(){return{parameter:this._smartContractViewSchema.extractArgsSchema(),result:this._smartContractViewSchema.extractResultSchema()}}executeView(t){return g(this,void 0,void 0,function*(){this.verifyContextExecution(t);const e=yield this._readProvider.getChainId(),n=this.transformArgsToMichelson(),i={contract:this._contractAddress,view:this._smartContractViewSchema.viewName,input:n,chain_id:e,source:t.viewCaller};return t.source&&(i.payer=t.source),this.executeViewAndDecodeResult(i)})}verifyContextExecution(t){if(t.source&&F(t.source)!==O.VALID)throw new ra(`The source account who initialized the view execution is invalid: ${t.source}.`);if(!t.viewCaller||F(t.viewCaller)!==O.VALID)throw new ra(`The contract which is the caller of view is invalid: ${t.viewCaller}.`)}transformArgsToMichelson(){try{return this._smartContractViewSchema.encodeViewArgs(this._args)}catch(t){throw new iu(this._smartContractViewSchema.viewName,this.getSignature(),this._args,t)}}adaptViewCodeToContext(t,e,n){const i={BALANCE:[{prim:"PUSH",args:[{prim:"mutez"},{int:n}]}],SENDER:[{prim:"PUSH",args:[{prim:"address"},{string:e}]}],SELF_ADDRESS:[{prim:"PUSH",args:[{prim:"address"},{string:this._contractAddress}]}],AMOUNT:[{prim:"PUSH",args:[{prim:"mutez"},{int:"0"}]}]};return t.forEach((s,o)=>{s.prim in i&&(t[o]=Object(i)[s.prim]),s.args&&s.args.length!==0?this.adaptViewCodeToContext(s.args,e,n):Array.isArray(s)&&this.adaptViewCodeToContext(s,e,n)}),t}executeViewAndDecodeResult(t){return g(this,void 0,void 0,function*(){let e;try{e=(yield this._rpc.runScriptView(t)).data}catch(n){const i=hg(n);throw i?new lg(`The simulation of the on-chain view named ${this._smartContractViewSchema.viewName} failed with: ${JSON.stringify(i)}`,this._smartContractViewSchema.viewName,i,n):n}return this._smartContractViewSchema.decodeViewResult(e)})}}class jg{constructor(t,e){this.provider=t,this.contractAddress=e}createContractMethodFlatParams(t,e,n,i=!0,s=!1){return new Hg(this.provider,this.contractAddress,t,e,n,i,s)}createContractMethodObjectParam(t,e,n,i=!0,s=!1){return new Bg(this.provider,this.contractAddress,t,e,n,i,s)}createContractViewObjectParam(t,e,n,i,s){return new $g(t,e,this.contractAddress,n,i,s)}}const lr="default";class Vg{constructor(t,e,n,i,s,o,a){this.currentContract=t,this.name=e,this.callbackParametersSchema=n,this.parameterSchema=i,this.args=s,this.rpc=o,this.readProvider=a}read(t){return g(this,void 0,void 0,function*(){const e=ha(t??"");if(hr(t??"")==O.VALID)throw new fa("Since version 12, the lambda view no longer depends on a lambda contract. The read method no longer accepts a contract address as a parameter.");if(t&&e!==O.VALID)throw new su(t,M(e));const n=this.parameterSchema.Encode(...this.args),i=yield this.rpc.runView({contract:this.currentContract.address,entrypoint:this.name,input:n,chain_id:t||(yield this.readProvider.getChainId())});return this.callbackParametersSchema.Execute(i.data)})}}const Ug=(r,t,e)=>{const n=t.ExtractSignatures();if(!n.find(i=>i.length===r.length))throw new xc(e,n,r)},Gg=r=>{let t=!1;if("prim"in r&&r.prim==="pair"&&r.args){const e=r.args[r.args.length-1];"prim"in e&&e.prim==="contract"&&(t=!0)}return t};class Bc{constructor(t,e,n,i,s,o,a){this.address=t,this.script=e,this.storageProvider=i,this.entrypoints=s,this.rpc=o,this.readProvider=a,this.methods={},this.methodsObject={},this.views={},this.contractViews={},this.contractMethodFactory=new jg(n,t),this.schema=Lt.fromRPCResponse({script:this.script}),this.parameterSchema=cr.fromRPCResponse({script:this.script}),this.viewSchema=Yi.fromRPCResponse({script:this.script}),this.viewSchema.length!==0&&this._initializeOnChainViews(this,o,this.readProvider,this.viewSchema),this.eventSchema=Le.fromRPCResponse({script:this.script}),this._initializeMethods(this,this.entrypoints.entrypoints,this.rpc,this.readProvider)}_initializeMethods(t,e,n,i){const s=this.parameterSchema,o=Object.keys(e);if(s.isMultipleEntryPoint)o.forEach(c=>{const l=new cr(e[c]);if(this.methods[c]=function(...p){return t.contractMethodFactory.createContractMethodFlatParams(l,c,p)},this.methodsObject[c]=function(p){return t.contractMethodFactory.createContractMethodObjectParam(l,c,p)},Gg(e[c])){const p=function(...h){const b=e[c].args[0],E=new cr(b),_=e[c].args[1].args[0],L=new cr(_);return Ug(h,E,c),new Vg(t,c,L,E,h,n,i)};this.views[c]=p}}),Object.keys(s.ExtractSchema()).filter(c=>Object.keys(e).indexOf(c)===-1).forEach(c=>{this.methods[c]=function(...l){return t.contractMethodFactory.createContractMethodFlatParams(s,c,l,!1,!0)},this.methodsObject[c]=function(l){return t.contractMethodFactory.createContractMethodObjectParam(s,c,l,!1,!0)}});else{const a=this.parameterSchema;this.methods[lr]=function(...c){return t.contractMethodFactory.createContractMethodFlatParams(a,lr,c,!1)},this.methodsObject[lr]=function(c){return t.contractMethodFactory.createContractMethodObjectParam(a,lr,c,!1)}}}_initializeOnChainViews(t,e,n,i){const s=this.schema.val;i.forEach(o=>{this.contractViews[o.viewName]=function(a){return t.contractMethodFactory.createContractViewObjectParam(e,n,o,s,a)}})}storage(){return this.storageProvider.getStorage(this.address,this.schema)}bigMap(t){return this.storageProvider.getBigMapKey(this.address,t,this.schema)}}class Kg{constructor(t,e){this.id=t,this.provider=e}getSaplingDiff(t){return g(this,void 0,void 0,function*(){return this.provider.getSaplingDiffByID(this.id.toString(),t)})}getId(){return this.id.toString()}}const rn=100,Fg=1,zg=.1,ia=100;class pt{constructor(t,e,n,i,s=rn){this._milligasLimit=t,this._storageLimit=e,this.opSize=n,this.minimalFeePerStorageByteMutez=i,this.baseFeeMutez=s}get burnFeeMutez(){return this.roundUp(Number(this.storageLimit)*Number(this.minimalFeePerStorageByteMutez))}get storageLimit(){const t=Math.max(Number(this._storageLimit),0);return t>0?t:0}get gasLimit(){return this.roundUp(Number(this._milligasLimit)/1e3+ia)}get operationFeeMutez(){return(Number(this._milligasLimit)/1e3+ia)*zg+Number(this.opSize)*Fg}roundUp(t){return Math.ceil(Number(t))}get minimalFeeMutez(){return this.roundUp(rn+this.operationFeeMutez)}get suggestedFeeMutez(){return this.roundUp(this.operationFeeMutez+rn*2)}get usingBaseFeeMutez(){return Math.max(Number(this.baseFeeMutez),rn)+this.roundUp(this.operationFeeMutez)}get totalCost(){return this.minimalFeeMutez+this.burnFeeMutez}get consumedMilligas(){return Number(this._milligasLimit)}static createEstimateInstanceFromProperties(t){let e=0,n=0,i=0,s=0,o;return t.forEach(a=>{e+=a.milligasLimit,n+=a.storageLimit,i+=a.opSize,s=Math.max(a.minimalFeePerStorageByteMutez,s),a.baseFeeMutez&&(o=o?o+a.baseFeeMutez:a.baseFeeMutez)}),new pt(e,n,i,s,o)}static createArrayEstimateInstancesFromProperties(t){return t.map(e=>new pt(e.milligasLimit,e.storageLimit,e.opSize,e.minimalFeePerStorageByteMutez,e.baseFeeMutez))}}class Pi extends Error{constructor(){super("Unable to estimate the reveal operation, the public key is unknown"),this.name="Reveal Estimate Error"}}const qg="edsigtkpiSSschcaCt9pUVrpNPf7TTcgvgDEDD6NCEHMy8NNQJCGnMfLZzYoQj74yLjo9wx6MPVV29CvVzgi7qEcEUok3k7AuMg";class Wg extends Kr{constructor(){super(...arguments),this.ALLOCATION_STORAGE=257,this.ORIGINATION_STORAGE=257,this.OP_SIZE_REVEAL=128,this.prepare=new Fr(this.context)}getKeys(){return g(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{publicKeyHash:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}getEstimationPropertiesFromOperationContent(t,e,n){const i=le({contents:[t]});let s=0,o=0;return i.forEach(a=>{o+="originated_contracts"in a&&typeof a.originated_contracts<"u"?a.originated_contracts.length*this.ORIGINATION_STORAGE:0,o+="allocated_destination_contract"in a?this.ALLOCATION_STORAGE:0,s+=Number(a.consumed_milligas)||0,o+="paid_storage_size_diff"in a&&Number(a.paid_storage_size_diff)||0,o+="storage_size"in a&&"global_address"in a&&Number(a.storage_size)||0,o+="genesis_commitment_hash"in a?Number(a.size):0}),Oi(t)?{milligasLimit:s||0,storageLimit:Number(o||0),opSize:e,minimalFeePerStorageByteMutez:n.toNumber()}:{milligasLimit:0,storageLimit:0,opSize:e,minimalFeePerStorageByteMutez:n.toNumber(),baseFeeMutez:0}}calculateEstimates(t,e){return g(this,void 0,void 0,function*(){const{opbytes:n,opOb:{branch:i,contents:s}}=yield this.forge(t),o={operation:{branch:i,contents:s,signature:qg},chain_id:yield this.context.readProvider.getChainId()},{opResponse:a}=yield this.simulate(o),{cost_per_byte:c}=e,l=[..._r(a,"backtracked"),..._r(a)];if(l.length)throw new Mc(l,"Error occurred during estimation");let p=1;return Array.isArray(t.opOb.contents)&&t.opOb.contents.length>1&&(p=a.contents[0].kind==="reveal"?t.opOb.contents.length-1:t.opOb.contents.length),a.contents.map(h=>this.getEstimationPropertiesFromOperationContent(h,h.kind==="reveal"?this.OP_SIZE_REVEAL/2:n.length/2/p,c))})}originate(t){return g(this,void 0,void 0,function*(){const e=yield this.prepare.originate(t),n=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.calculateEstimates(e,n);return e.opOb.contents[0].kind==="reveal"&&i.shift(),pt.createEstimateInstanceFromProperties(i)})}transfer(t){var e,{fee:n,storageLimit:i,gasLimit:s}=t,o=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const a=F(o.to);if(a!==O.VALID)throw new W(o.to,M(a));const c=F((e=o.source)!==null&&e!==void 0?e:"");if(o.source&&c!==O.VALID)throw new W(o.source,M(c));if(o.amount<0)throw new Lr(o.amount.toString());const l=yield this.prepare.transaction(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),p=yield this.context.readProvider.getProtocolConstants("head"),h=yield this.calculateEstimates(l,p);return l.opOb.contents[0].kind==="reveal"&&h.shift(),pt.createEstimateInstanceFromProperties(h)})}transferTicket(t){var e,{fee:n,storageLimit:i,gasLimit:s}=t,o=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const a=F(o.destination);if(a!==O.VALID)throw new W(o.destination,M(a));const c=F((e=o.source)!==null&&e!==void 0?e:"");if(o.source&&c!==O.VALID)throw new W(o.source,M(c));const l=yield this.context.readProvider.getProtocolConstants("head"),p=yield this.prepare.transferTicket(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),h=yield this.calculateEstimates(p,l);return p.opOb.contents[0].kind==="reveal"&&h.shift(),pt.createEstimateInstanceFromProperties(h)})}setDelegate(t){var e,{fee:n,gasLimit:i,storageLimit:s}=t,o=gt(t,["fee","gasLimit","storageLimit"]);return g(this,void 0,void 0,function*(){const a=F(o.source);if(o.source&&a!==O.VALID)throw new W(o.source,M(a));const c=F((e=o.delegate)!==null&&e!==void 0?e:"");if(o.delegate&&c!==O.VALID)throw new W(o.delegate,M(c));const l=yield this.prepare.delegation(Object.assign({fee:n,storageLimit:s,gasLimit:i},o)),p=yield this.context.readProvider.getProtocolConstants("head"),h=yield this.calculateEstimates(l,p);return l.opOb.contents[0].kind==="reveal"&&h.shift(),pt.createEstimateInstanceFromProperties(h)})}batch(t){return g(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.batch(t),i=yield this.calculateEstimates(n,e);return pt.createArrayEstimateInstancesFromProperties(i)})}registerDelegate(t,e){var{fee:n,storageLimit:i,gasLimit:s}=t,o=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const a=(yield this.getKeys()).publicKeyHash,c=yield this.context.readProvider.getProtocolConstants("head"),l=e||a,p=yield this.prepare.registerDelegate(Object.assign({fee:n,storageLimit:i,gasLimit:s},o),l),h=yield this.calculateEstimates(p,c);return p.opOb.contents[0].kind==="reveal"&&h.shift(),pt.createEstimateInstanceFromProperties(h)})}reveal(t){return g(this,void 0,void 0,function*(){const{publicKeyHash:e,publicKey:n}=yield this.getKeys();if(!n)throw new Pi;if(yield this.isAccountRevealRequired(e)){const i=yield this.context.readProvider.getProtocolConstants("head"),s=t?yield this.prepare.reveal(t):yield this.prepare.reveal({}),o=yield this.calculateEstimates(s,i);return pt.createEstimateInstanceFromProperties(o)}})}registerGlobalConstant(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const o=yield this.prepare.registerGlobalConstant(Object.assign({fee:e,storageLimit:n,gasLimit:i},s)),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.calculateEstimates(o,a);return o.opOb.contents[0].kind==="reveal"&&c.shift(),pt.createEstimateInstanceFromProperties(c)})}increasePaidStorage(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){if(s.amount<0)throw new Lr(s.amount.toString());const o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.prepare.increasePaidStorage(Object.assign({fee:e,storageLimit:n,gasLimit:i},s)),c=yield this.calculateEstimates(a,o);return a.opOb.contents[0].kind==="reveal"&&c.shift(),pt.createEstimateInstanceFromProperties(c)})}updateConsensusKey(t){return g(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.updateConsensusKey(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),pt.createEstimateInstanceFromProperties(i)})}smartRollupAddMessages(t){return g(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.smartRollupAddMessages(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),pt.createEstimateInstanceFromProperties(i)})}smartRollupOriginate(t){return g(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.smartRollupOriginate(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),pt.createEstimateInstanceFromProperties(i)})}contractCall(t){return g(this,void 0,void 0,function*(){const e=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.contractCall(t),i=yield this.calculateEstimates(n,e);return n.opOb.contents[0].kind==="reveal"&&i.shift(),pt.createEstimateInstanceFromProperties(i)})}}var J;const At=(r,t)=>{var e,n,i;return{fee:(e=r.fee)!==null&&e!==void 0?e:t.fee,gasLimit:(n=r.gasLimit)!==null&&n!==void 0?n:t.gasLimit,storageLimit:(i=r.storageLimit)!==null&&i!==void 0?i:t.storageLimit}};class Fr extends Kr{constructor(t){super(t),this.context=t,J.set(this,void 0),lt(this,J,{})}getBlockHash(){return g(this,void 0,void 0,function*(){return this.context.readProvider.getBlockHash("head~2")})}getProtocolHash(){return g(this,void 0,void 0,function*(){return this.context.readProvider.getNextProtocol("head")})}getHeadCounter(t){var e;return g(this,void 0,void 0,function*(){return(e=this.context.readProvider.getCounter(t,"head"))!==null&&e!==void 0?e:"0"})}adjustGasForBatchOperation(t,e,n){return P.min(e,t.div(n+1))}getAccountLimits(t,e,n){return g(this,void 0,void 0,function*(){const i=yield this.context.readProvider.getBalance(t,"head"),{hard_gas_limit_per_operation:s,hard_gas_limit_per_block:o,hard_storage_limit_per_operation:a,cost_per_byte:c}=e;return{fee:0,gasLimit:n?Math.floor(this.adjustGasForBatchOperation(o,s,n).toNumber()):s.toNumber(),storageLimit:Math.floor(P.min(i.dividedBy(c),a).toNumber())}})}getFee(t,e,n){return(!Xr(this,J)[e]||Xr(this,J)[e]<n)&&(Xr(this,J)[e]=n),{counter:`${++Xr(this,J)[e]}`,fee:typeof t.fee>"u"?"0":`${t.fee}`,gas_limit:typeof t.gas_limit>"u"?"0":`${t.gas_limit}`,storage_limit:typeof t.storage_limit>"u"?"0":`${t.storage_limit}`}}getSource(t,e,n){return{source:typeof t.source>"u"?n||e:t.source}}addRevealOperationIfNeeded(t,e){return g(this,void 0,void 0,function*(){if(Cc(t)){const n=[t],{publicKey:i,pkh:s}=yield this.getKeys();if(yield this.isAccountRevealRequired(e)){if(!i)throw new Pi;return n.unshift(yield ui({fee:Ie.REVEAL,storageLimit:Ne.REVEAL,gasLimit:Ri(s)},e,i)),n}}return t})}getKeys(){return g(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{pkh:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}convertIntoArray(t){return Array.isArray(t)?[...t]:[t]}constructOpContents(t,e,n,i,s){return t.map(o=>{switch(o.kind){case y.ACTIVATION:case y.DRAIN_DELEGATE:return Object.assign({},o);case y.ORIGINATION:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{balance:typeof o.balance<"u"?`${o.balance}`:"0"}),this.getSource(o,n,i)),this.getFee(o,n,e));case y.TRANSACTION:{const a=Object.assign(Object.assign(Object.assign(Object.assign({},o),{amount:typeof o.amount<"u"?`${o.amount}`:"0"}),this.getSource(o,n,i)),this.getFee(o,n,e));if(a.source.toLowerCase().startsWith("kt1"))throw new fa(`KT1 addresses are not supported as source since ${st.PsBabyM1}`);return a}case y.REVEAL:case y.DELEGATION:case y.REGISTER_GLOBAL_CONSTANT:case y.UPDATE_CONSENSUS_KEY:case y.SMART_ROLLUP_ADD_MESSAGES:case y.SMART_ROLLUP_ORIGINATE:return Object.assign(Object.assign(Object.assign({},o),this.getSource(o,n,i)),this.getFee(o,n,e));case y.TRANSFER_TICKET:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{ticket_amount:`${o.ticket_amount}`}),this.getSource(o,n,i)),this.getFee(o,n,e));case y.INCREASE_PAID_STORAGE:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{amount:`${o.amount}`}),this.getSource(o,n,i)),this.getFee(o,n,e));case y.BALLOT:if(s===void 0)throw new en("Failed to get the current voting period index");return Object.assign(Object.assign({},o),{period:s==null?void 0:s.voting_period.index});case y.PROPOSALS:if(s===void 0)throw new en("Failed to get the current voting period index");return Object.assign(Object.assign({},o),{period:s==null?void 0:s.voting_period.index});default:throw new Ge(o.kind)}})}activate({pkh:t,secret:e}){return g(this,void 0,void 0,function*(){const n=yield mg({pkh:t,secret:e}),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();lt(this,J,{});const a=parseInt(yield this.getHeadCounter(t),10),c=this.constructOpContents(i,a,t);return{opOb:{branch:s,contents:c,protocol:o},counter:a}})}reveal({fee:t,gasLimit:e,storageLimit:n}){return g(this,void 0,void 0,function*(){const{pkh:i,publicKey:s}=yield this.getKeys();if(!s)throw new Ig;const o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.getAccountLimits(i,o),c=At({fee:t,storageLimit:n,gasLimit:e},a),l=yield ui({fee:c.fee,gasLimit:c.gasLimit,storageLimit:c.storageLimit},i,s),p=this.convertIntoArray(l),h=yield this.getBlockHash(),b=yield this.getProtocolHash();lt(this,J,{});const E=parseInt(yield this.getHeadCounter(i),10),_=this.constructOpContents(p,E,i);return{opOb:{branch:h,contents:_,protocol:b},counter:E}})}originate(t,e){var{fee:n,storageLimit:i,gasLimit:s}=t,o=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const{pkh:a}=yield this.getKeys(),c=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.getAccountLimits(a,c),p=yield Ss(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},o),At({fee:n,storageLimit:i,gasLimit:s},l)))),h=yield this.addRevealOperationIfNeeded(p,a),b=this.convertIntoArray(h),E=yield this.getBlockHash(),_=yield this.getProtocolHash();lt(this,J,{});const L=parseInt(yield this.getHeadCounter(a),10),I=this.constructOpContents(b,L,a,e);return{opOb:{branch:E,contents:I,protocol:_},counter:L}})}transaction(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield Rs(Object.assign(Object.assign({},s),At({fee:e,storageLimit:n,gasLimit:i},c))),p=yield this.addRevealOperationIfNeeded(l,o),h=this.convertIntoArray(p),b=yield this.getBlockHash(),E=yield this.getProtocolHash();lt(this,J,{});const _=parseInt(yield this.getHeadCounter(o),10),L=this.constructOpContents(h,_,o,s.source);return{opOb:{branch:b,contents:L,protocol:E},counter:_}})}delegation(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield Os(Object.assign(Object.assign({},s),At({fee:e,storageLimit:n,gasLimit:i},c))),p=yield this.addRevealOperationIfNeeded(l,o),h=this.convertIntoArray(p),b=yield this.getBlockHash(),E=yield this.getProtocolHash();lt(this,J,{});const _=parseInt(yield this.getHeadCounter(o),10),L=this.constructOpContents(h,_,o,s.source);return{opOb:{branch:b,contents:L,protocol:E},counter:_}})}registerDelegate({fee:t,storageLimit:e,gasLimit:n},i){return g(this,void 0,void 0,function*(){const{pkh:s}=yield this.getKeys(),o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.getAccountLimits(s,o),c=At({fee:t,storageLimit:e,gasLimit:n},a),l=yield yg({fee:c.fee,storageLimit:c.storageLimit,gasLimit:c.gasLimit},s),p=yield this.addRevealOperationIfNeeded(l,s),h=this.convertIntoArray(p),b=yield this.getBlockHash(),E=yield this.getProtocolHash();lt(this,J,{});const _=parseInt(yield this.getHeadCounter(s),10),L=this.constructOpContents(h,_,s,i);return{opOb:{branch:b,contents:L,protocol:E},counter:_}})}registerGlobalConstant(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield Ps(Object.assign(Object.assign({},s),At({fee:e,storageLimit:n,gasLimit:i},c))),p=yield this.addRevealOperationIfNeeded(l,o),h=this.convertIntoArray(p),b=yield this.getBlockHash(),E=yield this.getProtocolHash();lt(this,J,{});const _=parseInt(yield this.getHeadCounter(o),10),L=this.constructOpContents(h,_,o,s.source);return{opOb:{branch:b,contents:L,protocol:E},counter:_}})}updateConsensusKey(t,e){var{fee:n,storageLimit:i,gasLimit:s}=t,o=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const{pkh:a}=yield this.getKeys(),c=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.getAccountLimits(a,c),p=yield _g(Object.assign(Object.assign({},o),At({fee:n,storageLimit:i,gasLimit:s},l))),h=yield this.addRevealOperationIfNeeded(p,a),b=this.convertIntoArray(h),E=yield this.getBlockHash(),_=yield this.getProtocolHash();lt(this,J,{});const L=parseInt(yield this.getHeadCounter(a),10),I=this.constructOpContents(b,L,a,e);return{opOb:{branch:E,contents:I,protocol:_},counter:L}})}increasePaidStorage(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield Is(Object.assign(Object.assign({},s),At({fee:e,storageLimit:n,gasLimit:i},c))),p=yield this.addRevealOperationIfNeeded(l,o),h=this.convertIntoArray(p),b=yield this.getBlockHash(),E=yield this.getProtocolHash();lt(this,J,{});const _=parseInt(yield this.getHeadCounter(o),10),L=this.constructOpContents(h,_,o,s.source);return{opOb:{branch:b,contents:L,protocol:E},counter:_}})}ballot(t){return g(this,void 0,void 0,function*(){const{pkh:e}=yield this.getKeys(),n=yield Eg(Object.assign({},t)),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();lt(this,J,{});const a=parseInt(yield this.getHeadCounter(e),10);let c;try{c=yield this.rpc.getCurrentPeriod()}catch{throw new en("Failed to get the current voting period index")}const l=this.constructOpContents(i,a,e,void 0,c);return{opOb:{branch:s,contents:l,protocol:o},counter:a}})}proposals(t){return g(this,void 0,void 0,function*(){const{pkh:e}=yield this.getKeys(),n=yield vg(Object.assign({},t)),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();lt(this,J,{});const a=parseInt(yield this.getHeadCounter(e),10);let c;try{c=yield this.rpc.getCurrentPeriod()}catch{throw new en("Failed to get the current voting period index")}const l=this.constructOpContents(i,a,e,void 0,c);return{opOb:{branch:s,contents:l,protocol:o},counter:a}})}drainDelegate(t,e){return g(this,void 0,void 0,function*(){const{pkh:n}=yield this.getKeys(),i=yield bg(Object.assign({},t)),s=this.convertIntoArray(i),o=yield this.getBlockHash(),a=yield this.getProtocolHash();lt(this,J,{});const c=parseInt(yield this.getHeadCounter(n),10),l=this.constructOpContents(s,c,n,e);return{opOb:{branch:o,contents:l,protocol:a},counter:c}})}transferTicket(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield Ts(Object.assign(Object.assign({},s),At({fee:e,storageLimit:n,gasLimit:i},c))),p=yield this.addRevealOperationIfNeeded(l,o),h=this.convertIntoArray(p),b=yield this.getBlockHash(),E=yield this.getProtocolHash();lt(this,J,{});const _=parseInt(yield this.getHeadCounter(o),10),L=this.constructOpContents(h,_,o,s.source);return{opOb:{branch:b,contents:L,protocol:E},counter:_}})}smartRollupAddMessages(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getAccountLimits(o,a),l=yield Ns(Object.assign(Object.assign({},s),At({fee:e,storageLimit:n,gasLimit:i},c))),p=yield this.addRevealOperationIfNeeded(l,o),h=this.convertIntoArray(p),b=yield this.getBlockHash(),E=yield this.getProtocolHash();lt(this,J,{});const _=parseInt(yield this.getHeadCounter(o),10),L=this.constructOpContents(h,_,o,s.source);return{opOb:{branch:b,contents:L,protocol:E},counter:_}})}smartRollupOriginate(t){var{fee:e,storageLimit:n,gasLimit:i}=t,s=gt(t,["fee","storageLimit","gasLimit"]);return g(this,void 0,void 0,function*(){const{pkh:o}=yield this.getKeys(),a=yield this.rpc.getOriginationProof({kind:s.pvmKind,kernel:s.kernel}),c=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.getAccountLimits(o,c),p=yield xs(Object.assign(Object.assign(Object.assign({},At({fee:e,storageLimit:n,gasLimit:i},l)),s),{originationProof:a})),h=yield this.addRevealOperationIfNeeded(p,o),b=this.convertIntoArray(h),E=yield this.getBlockHash(),_=yield this.getProtocolHash();lt(this,J,{});const L=parseInt(yield this.getHeadCounter(o),10),I=this.constructOpContents(b,L,o,s.source);return{opOb:{branch:E,contents:I,protocol:_},counter:L}})}batch(t,e){return g(this,void 0,void 0,function*(){const{pkh:n,publicKey:i}=yield this.getKeys(),s=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getAccountLimits(n,s,t.length),a=yield this.isRevealOpNeeded(t,n),c=[];if(e)for(const E of t)if(Oi(E)){const _=e.shift(),L=At(E,{fee:_.suggestedFeeMutez,storageLimit:_.storageLimit,gasLimit:_.gasLimit});c.push(yield this.getRPCOp(Object.assign(Object.assign({},E),L)))}else c.push(Object.assign({},E));else for(const E of t)if(Oi(E)){const _=At(E,o);c.push(yield this.getRPCOp(Object.assign(Object.assign({},E),_)))}else c.push(Object.assign({},E));if(a){if(!i)throw new Pi;c.unshift(yield ui({fee:Ie.REVEAL,storageLimit:Ne.REVEAL,gasLimit:Ri(n)},n,i))}const l=yield this.getBlockHash(),p=yield this.getProtocolHash();lt(this,J,{});const h=parseInt(yield this.getHeadCounter(n),10),b=this.constructOpContents(c,h,n);return{opOb:{branch:l,contents:b,protocol:p},counter:h}})}contractCall(t){var e,n,i;return g(this,void 0,void 0,function*(){const s=yield this.getBlockHash(),o=yield this.getProtocolHash(),{pkh:a}=yield this.getKeys();lt(this,J,{});const c=parseInt(yield this.getHeadCounter(a),10),l=t.toTransferParams(),p=yield this.context.readProvider.getProtocolConstants("head"),h=yield this.getAccountLimits(a,p),b=At({fee:l.fee,storageLimit:l.storageLimit,gasLimit:l.gasLimit},h),E={kind:y.TRANSACTION,fee:(e=l.fee)!==null&&e!==void 0?e:b.fee,gas_limit:(n=l.gasLimit)!==null&&n!==void 0?n:b.gasLimit,storage_limit:(i=l.storageLimit)!==null&&i!==void 0?i:b.storageLimit,amount:String(l.amount),destination:l.to,parameters:l.parameter},_=yield this.addRevealOperationIfNeeded(E,a),L=this.convertIntoArray(_),I=this.constructOpContents(L,c,a);return{opOb:{branch:s,contents:I,protocol:o},counter:c}})}toPreapply(t){return g(this,void 0,void 0,function*(){const{opOb:{contents:e,branch:n,protocol:i}}=t,s=this.toForge(t),o=yield this.context.forger.forge(s),a=yield this.context.signer.sign(o,new Uint8Array([3]));return[{contents:e,branch:n,protocol:i,signature:a.prefixSig}]})}toForge({opOb:{contents:t,branch:e}}){return{branch:e,contents:t}}}J=new WeakMap;const Hc=[y.ACTIVATION,y.ORIGINATION,y.TRANSACTION,y.DELEGATION];class $c extends Kr{constructor(t,e){super(t),this.estimator=e,this.operations=[],this.prepare=new Fr(this.context)}withTransfer(t){const e=F(t.to);if(t.amount<0)throw new Lr(t.amount.toString());if(e!==O.VALID)throw new W(t.to,M(e));return this.operations.push(Object.assign({kind:y.TRANSACTION},t)),this}withTransferTicket(t){const e=F(t.destination);if(e!==O.VALID)throw new W(t.destination,M(e));return this.operations.push(Object.assign({kind:y.TRANSFER_TICKET},t)),this}withContractCall(t,e={}){return this.withTransfer(t.toTransferParams(e))}withDelegation(t){var e;const n=F(t.source);if(t.source&&n!==O.VALID)throw new W(t.source,M(n));const i=F((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&i!==O.VALID)throw new W(t.delegate,M(i));return this.operations.push(Object.assign({kind:y.DELEGATION},t)),this}withActivation({pkh:t,secret:e}){const n=xi(t);if(n!==O.VALID)throw new Li(t,M(n));return this.operations.push({kind:y.ACTIVATION,pkh:t,secret:e}),this}withOrigination(t){return this.operations.push(Object.assign({kind:y.ORIGINATION},t)),this}withRegisterGlobalConstant(t){return this.operations.push(Object.assign({kind:y.REGISTER_GLOBAL_CONSTANT},t)),this}withIncreasePaidStorage(t){return this.operations.push(Object.assign({kind:y.INCREASE_PAID_STORAGE},t)),this}withSmartRollupAddMessages(t){return this.operations.push(Object.assign({kind:y.SMART_ROLLUP_ADD_MESSAGES},t)),this}withSmartRollupOriginate(t){return this.operations.push(Object.assign({kind:y.SMART_ROLLUP_ORIGINATE},t)),this}getRPCOp(t){return g(this,void 0,void 0,function*(){switch(t.kind){case y.TRANSACTION:return Rs(Object.assign({},t));case y.ORIGINATION:return Ss(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case y.DELEGATION:return Os(Object.assign({},t));case y.REGISTER_GLOBAL_CONSTANT:return Ps(Object.assign({},t));case y.INCREASE_PAID_STORAGE:return Is(Object.assign({},t));case y.TRANSFER_TICKET:return Ts(Object.assign({},t));case y.SMART_ROLLUP_ADD_MESSAGES:return Ns(Object.assign({},t));case y.SMART_ROLLUP_ORIGINATE:return xs(Object.assign({},t));default:throw new Ge(JSON.stringify(t.kind))}})}with(t){for(const e of t)switch(e.kind){case y.TRANSACTION:this.withTransfer(e);break;case y.ORIGINATION:this.withOrigination(e);break;case y.DELEGATION:this.withDelegation(e);break;case y.ACTIVATION:this.withActivation(e);break;case y.REGISTER_GLOBAL_CONSTANT:this.withRegisterGlobalConstant(e);break;case y.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;case y.TRANSFER_TICKET:this.withTransferTicket(e);break;case y.SMART_ROLLUP_ADD_MESSAGES:this.withSmartRollupAddMessages(e);break;case y.SMART_ROLLUP_ORIGINATE:this.withSmartRollupOriginate(e);break;default:throw new Ge(JSON.stringify(e.kind))}return this}send(t){return g(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=t&&t.source||e,i=yield this.estimator.batch(this.operations);i.length!==this.operations.length&&i.shift();const s=yield this.prepare.batch(this.operations,i),o=yield this.forge(s),{hash:a,context:c,forgedBytes:l,opResponse:p}=yield this.signAndInject(o);return new Ng(a,s.opOb.contents,n,l,p,c)})}}class Yg{constructor(t,e){this.context=t,this.estimator=e}batch(t){const e=new $c(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}class Zg extends Or{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e,this.getOriginatedContractAddresses=()=>g(this,void 0,void 0,function*(){const s=(yield this.operationResults()).filter(a=>a.kind==="origination");let o=[];for(const a of s)a.metadata.operation_result.originated_contracts&&(o=[...o,...a.metadata.operation_result.originated_contracts]);return o})}revealOperation(){return g(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===y.REVEAL)})}status(){return g(this,void 0,void 0,function*(){return this._included?(yield this.operationResults()).filter(e=>Hc.indexOf(e.kind)!==-1).map(e=>Rr(e)?e.metadata.operation_result.status:"unknown")[0]||"unknown":"pending"})}}class Jg extends Or{constructor(t,e,n){super(t,e,n),this.opHash=t,this.context=e}revealOperation(){return g(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===y.REVEAL)})}increasePaidStorageOperation(){return g(this,void 0,void 0,function*(){return(yield this.operationResults()).find(e=>e.kind===y.INCREASE_PAID_STORAGE)})}status(){return g(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.increasePaidStorageOperation();return t?t.metadata.operation_result.status:"unknown"})}}function Xg(r){return function(e){return new In(null).pipe(Wa(r,Ki(new Error("Confirmation polling timed out"))),xn(()=>e))}}const Qg=(r,t,e)=>r.pipe(Xg(t.config.confirmationPollingTimeoutSecond*1e3),mi(1),Mr());class tm{constructor(t){this.context=t,this.sharedHeadObs=Ka(()=>Nc(this.context.stream.subscribeBlock("head")))}createNewHeadObservable(){return g(this,void 0,void 0,function*(){return Qg(this.sharedHeadObs,this.context)})}createPastBlockWalker(t,e=1){return rr(this.context.readProvider.getBlock(t)).pipe(ae(n=>e===1?Ar(n):zi(n.header.level,e-1).pipe(Dh(n),Gr(i=>g(this,void 0,void 0,function*(){return this.context.readProvider.getBlock(typeof i=="number"?i:i.header.level)})))))}createHeadObservableFromConfig({blockIdentifier:t}){return g(this,void 0,void 0,function*(){const e=[];return t&&e.push(this.createPastBlockWalker(t)),e.push(yield this.createNewHeadObservable()),gn(...e)})}createOperation(t,e={}){return g(this,void 0,void 0,function*(){return new Or(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createBatchOperation(t,e={}){return g(this,void 0,void 0,function*(){return new Zg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createTransactionOperation(t,e={}){return g(this,void 0,void 0,function*(){return new Mg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createDelegationOperation(t,e={}){return g(this,void 0,void 0,function*(){return new kg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createOriginationOperation(t,e={}){return g(this,void 0,void 0,function*(){return new Dg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}createIncreasePaidStorageOperation(t,e={}){return g(this,void 0,void 0,function*(){return new Jg(t,this.context.clone(),yield this.createHeadObservableFromConfig(e))})}}class em extends Kr{constructor(t){super(t),this.prepare=new Fr(this.context)}getBalance(t){return g(this,void 0,void 0,function*(){const e=F(t);if(e!==O.VALID)throw new W(t,M(e));return this.context.readProvider.getBalance(t,"head")})}getDelegate(t){return g(this,void 0,void 0,function*(){const e=F(t);if(e!==O.VALID)throw new W(t,M(e));return this.context.readProvider.getDelegate(t,"head")})}activate(t,e){return g(this,void 0,void 0,function*(){const n=xi(t);if(n!==O.VALID)throw new Li(t,M(n));const i=yield this.prepare.activate({pkh:t,secret:e}),s=yield this.forge(i),o=`${s.opbytes}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`;return new wt(yield this.rpc.injectOperation(o),Object.assign(Object.assign({},s),{opbytes:o}),[],this.context.clone())})}}class sa extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="delegation"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get delegate(){return this.params.delegate}get isRegisterOperation(){return this.delegate===this.source}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return P.config({DECIMAL_PLACES:0,ROUNDING_MODE:P.ROUND_UP}),this.consumedMilliGas?new P(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class rm extends wt{constructor(t,e,n,i,s,o){super(t,n,i,s),this.params=e,this.contractProvider=o;const a=this.operationResults&&this.operationResults.originated_contracts;Array.isArray(a)&&(this.contractAddress=a[0])}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="origination"),e=t&&Rr(t)&&t.metadata.operation_result;return e||void 0}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return P.config({DECIMAL_PLACES:0,ROUNDING_MODE:P.ROUND_UP}),this.consumedMilliGas?new P(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get storageDiff(){const t=this.operationResults&&this.operationResults.paid_storage_size_diff;return t||void 0}get storageSize(){const t=this.operationResults&&this.operationResults.storage_size;return t||void 0}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}contract(t,e){return g(this,void 0,void 0,function*(){if(!this.contractAddress)throw new Og("No contract was originated in this operation");return yield this.confirmation(t,e),this.contractProvider.at(this.contractAddress)})}}class nm extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n,this.globalConstantHash=this.operationResults&&this.operationResults.global_address}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="register_global_constant"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get registeredExpression(){return this.params.value}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedGas(){return P.config({DECIMAL_PLACES:0,ROUNDING_MODE:P.ROUND_UP}),this.consumedMilliGas?new P(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class im extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="reveal");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get publicKey(){return this.params.public_key}sumProp(t,e){return t.reduce((n,i)=>e in i?Number(i[e])+n:n,0)}get consumedGas(){return P.config({DECIMAL_PLACES:0,ROUNDING_MODE:P.ROUND_UP}),new P(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(le({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(le({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(le({contents:this.operationResults}),"storage_size"))}get errors(){return _r({contents:this.operationResults})}}class sm extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(e=>e.kind==="transaction");return t?[t]:[]}get status(){const e=this.operationResults[0];return e?e.metadata.operation_result.status:"unknown"}get amount(){return new P(this.params.amount)}get destination(){return this.params.destination}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}sumProp(t,e){return t.reduce((n,i)=>e in i?Number(i[e])+n:n,0)}get consumedGas(){return P.config({DECIMAL_PLACES:0,ROUNDING_MODE:P.ROUND_UP}),new P(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(le({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(le({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(le({contents:this.operationResults}),"storage_size"))}get errors(){return _r({contents:this.operationResults})}}class om{constructor(t,e,n){this.id=t,this.schema=e,this.provider=n}get(t,e){return g(this,void 0,void 0,function*(){try{return yield this.provider.getBigMapKeyByID(this.id.toString(),t,this.schema,e)}catch(n){if(n instanceof wr&&n.status===Cr.NOT_FOUND)return;throw n}})}getMultipleValues(t,e,n=5){return g(this,void 0,void 0,function*(){return this.provider.getBigMapKeysByID(this.id.toString(),t,this.schema,e,n)})}toJSON(){return this.id.toString()}toString(){return this.id.toString()}}const oa=r=>({big_map:(t,e)=>{if(!t||!("int"in t)||t.int===void 0)return{};{const n=new Lt(e);return new om(new P(t.int),n,r)}},sapling_state:t=>!t||!("int"in t)||t.int===void 0?{}:new Kg(new P(t.int),r)});class am extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const e=Array.isArray(this.results)&&this.results.find(n=>n.kind==="ballot");return e||void 0}get period(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.period}get proposal(){return this.params.proposal}get ballot(){return this.params.ballot}}class cm extends wt{constructor(t,e,n,i,s){super(t,n,i,s),this.params=e}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="drain_delegate"),e=t&&t.metadata&&t.metadata.balance_updates;return e||void 0}get consensusKey(){return this.params.consensus_key}get delegate(){return this.params.delegate}get destination(){return this.params.destination}}class um extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind===y.TRANSFER_TICKET),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return P.config({DECIMAL_PLACES:0,ROUNDING_MODE:P.ROUND_UP}),this.consumedMilliGas?new P(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class lm extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="increase_paid_storage"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get amount(){return this.params.amount}get destination(){return this.params.destination}}class hm extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const e=Array.isArray(this.results)&&this.results.find(n=>n.kind==="proposals");return e||void 0}get proposals(){return this.params.proposals}get period(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.period}}class dm extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="update_consensus_key"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get pk(){return this.params.pk}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class pm extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="smart_rollup_add_messages"),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get message(){return this.params.message}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class fm extends wt{constructor(t,e,n,i,s,o){super(t,i,s,o),this.params=e,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind===y.SMART_ROLLUP_ORIGINATE),e=t&&t.metadata&&t.metadata.operation_result;return e||void 0}get status(){var t,e;return(e=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&e!==void 0?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get pvmKind(){return this.params.pvm_kind}get kernel(){return this.params.kernel}get originationProof(){return this.params.origination_proof}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class gm extends Kr{constructor(t,e){super(t),this.estimator=e,this.contractProviderTypeSymbol=Symbol.for("taquito-contract-provider-type-symbol"),this.prepare=new Fr(this.context)}getStorage(t,e){return g(this,void 0,void 0,function*(){const n=hr(t);if(n!==O.VALID)throw new Qe(t,M(n));const i=yield this.context.readProvider.getScript(t,"head");e||(e=i);let s;return Lt.isSchema(e)?s=e:s=Lt.fromRPCResponse({script:e}),s.Execute(i.storage,oa(this))})}getBigMapKey(t,e,n){return g(this,void 0,void 0,function*(){const i=hr(t);if(i!==O.VALID)throw new Qe(t,M(i));n||(n=(yield this.rpc.getContract(t)).script);let s;Lt.isSchema(n)?s=n:s=Lt.fromRPCResponse({script:n});const o=s.EncodeBigMapKey(e),a=yield this.rpc.getBigMapKey(t,o);return s.ExecuteOnBigMapValue(a)})}getBigMapKeyByID(t,e,n,i){return g(this,void 0,void 0,function*(){const{key:s,type:o}=n.EncodeBigMapKey(e),{packed:a}=yield this.context.packer.packData({data:s,type:o}),c=nu(a),l=i?yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},i):yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},"head");return n.ExecuteOnBigMapValue(l,oa(this))})}getBigMapKeysByID(t,e,n,i,s=5){return g(this,void 0,void 0,function*(){const o=yield this.getBlockForRequest(e,i),a=new xt;let c=0,l=[];for(;c<e.length;){const h=e.slice(c,c+s).map(b=>this.getBigMapValueOrUndefined(b,t,n,o));l=[...l,...yield Promise.all(h)],c+=s}for(let p=0;p<l.length;p++)a.set(e[p],l[p]);return a})}getBlockForRequest(t,e){return g(this,void 0,void 0,function*(){return t.length===1||typeof e<"u"?e:yield this.context.readProvider.getBlockLevel("head")})}getBigMapValueOrUndefined(t,e,n,i){return g(this,void 0,void 0,function*(){try{return yield this.getBigMapKeyByID(e,t,n,i)}catch(s){if(s instanceof wr&&s.status===Cr.NOT_FOUND)return;throw s}})}getSaplingDiffByID(t,e){return g(this,void 0,void 0,function*(){return e?yield this.context.readProvider.getSaplingDiffById({id:t.toString()},e):yield this.context.readProvider.getSaplingDiffById({id:t.toString()},"head")})}originate(t){return g(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.originate.bind(this.estimator)),n=yield this.prepare.originate(Object.assign(Object.assign({},t),e)),i=n.opOb.contents.find(p=>p.kind===y.ORIGINATION),s=yield this.forge(n),{hash:o,context:a,forgedBytes:c,opResponse:l}=yield this.signAndInject(s);return new rm(o,i,c,l,a,this)})}setDelegate(t){var e;return g(this,void 0,void 0,function*(){const n=F(t.source);if(t.source&&n!==O.VALID)throw new W(t.source,M(n));const i=F((e=t.delegate)!==null&&e!==void 0?e:"");if(t.delegate&&i!==O.VALID)throw new W(t.delegate,M(i));if(/kt1/i.test(t.source))throw new ug(t.source);const s=yield this.signer.publicKeyHash(),o=t.source||s,a=yield this.estimate(t,this.estimator.setDelegate.bind(this.estimator)),c=yield this.prepare.delegation(Object.assign(Object.assign({},t),a)),l=c.opOb.contents.find(L=>L.kind===y.DELEGATION),p=yield this.forge(c),{hash:h,context:b,forgedBytes:E,opResponse:_}=yield this.signAndInject(p);return new sa(h,l,o,E,_,b)})}registerDelegate(t){return g(this,void 0,void 0,function*(){const e=yield this.estimate(t,this.estimator.registerDelegate.bind(this.estimator)),n=yield this.signer.publicKeyHash(),i=yield this.prepare.registerDelegate(Object.assign(Object.assign({},t),e)),s=i.opOb.contents.find(h=>h.kind===y.DELEGATION),o=yield this.forge(i),{hash:a,context:c,forgedBytes:l,opResponse:p}=yield this.signAndInject(o);return new sa(a,s,n,l,p,c)})}transfer(t){var e;return g(this,void 0,void 0,function*(){const n=F(t.to);if(n!==O.VALID)throw new W(t.to,M(n));const i=F((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&i!==O.VALID)throw new W(t.source,M(i));if(t.amount<0)throw new Lr(t.amount.toString());const s=yield this.signer.publicKeyHash(),o=yield this.estimate(t,this.estimator.transfer.bind(this.estimator)),a=t.source||s,c=yield this.prepare.transaction(Object.assign(Object.assign({},t),o)),l=c.opOb.contents.find(L=>L.kind===y.TRANSACTION),p=yield this.forge(c),{hash:h,context:b,forgedBytes:E,opResponse:_}=yield this.signAndInject(p);return new sm(h,l,a,E,_,b)})}transferTicket(t){var e,n;return g(this,void 0,void 0,function*(){const i=F(t.destination);if(i!==O.VALID)throw new W(t.destination,M(i));const s=F((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&s!==O.VALID)throw new W(t.source,M(s));const o=yield this.signer.publicKeyHash(),a=(n=t.source)!==null&&n!==void 0?n:o,c=yield this.estimate(t,this.estimator.transferTicket.bind(this.estimator)),l=yield this.prepare.transferTicket(Object.assign(Object.assign({},t),c)),p=l.opOb.contents.find(I=>I.kind===y.TRANSFER_TICKET),h=yield this.forge(l),{hash:b,context:E,forgedBytes:_,opResponse:L}=yield this.signAndInject(h);return new um(b,p,a,_,L,E)})}reveal(t){return g(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimator.reveal(t);if(n){const i=yield this.estimate(t,()=>g(this,void 0,void 0,function*(){return n})),s=yield this.prepare.reveal(Object.assign(Object.assign({},t),i)),o=s.opOb.contents.find(b=>b.kind===y.REVEAL),a=yield this.forge(s),{hash:c,context:l,forgedBytes:p,opResponse:h}=yield this.signAndInject(a);return new im(c,o,e,p,h,l)}else throw new pg(`The publicKeyHash '${e}' has already been revealed.`)})}registerGlobalConstant(t){return g(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.registerGlobalConstant.bind(this.estimator)),i=yield this.prepare.registerGlobalConstant(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(h=>h.kind===y.REGISTER_GLOBAL_CONSTANT),o=yield this.forge(i),{hash:a,context:c,forgedBytes:l,opResponse:p}=yield this.signAndInject(o);return new nm(a,s,e,l,p,c)})}increasePaidStorage(t){return g(this,void 0,void 0,function*(){if(t.amount<0)throw new Lr(t.amount.toString());const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.increasePaidStorage.bind(this.estimator)),i=yield this.prepare.increasePaidStorage(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(h=>h.kind===y.INCREASE_PAID_STORAGE),o=yield this.forge(i),{hash:a,context:c,forgedBytes:l,opResponse:p}=yield this.signAndInject(o);return new lm(a,s,e,l,p,c)})}drainDelegate(t){return g(this,void 0,void 0,function*(){const e=yield this.prepare.drainDelegate(t),n=e.opOb.contents.find(l=>l.kind===y.DRAIN_DELEGATE),i=yield this.forge(e),{hash:s,context:o,forgedBytes:a,opResponse:c}=yield this.signAndInject(i);return new cm(s,n,a,c,o)})}ballot(t){var e,n;return g(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),s=F((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&s!==O.VALID)throw new W(t.source,M(s));const o=(n=t.source)!==null&&n!==void 0?n:i,a=yield this.prepare.ballot(Object.assign(Object.assign({},t),{source:o})),c=a.opOb.contents.find(_=>_.kind===y.BALLOT),l=yield this.forge(a),{hash:p,context:h,forgedBytes:b,opResponse:E}=yield this.signAndInject(l);return new am(p,c,i,b,E,h)})}proposals(t){var e,n;return g(this,void 0,void 0,function*(){const i=yield this.signer.publicKeyHash(),s=F((e=t.source)!==null&&e!==void 0?e:"");if(t.source&&s!==O.VALID)throw new W(t.source,M(s));const o=(n=t.source)!==null&&n!==void 0?n:i,a=yield this.prepare.proposals(Object.assign(Object.assign({},t),{source:o})),c=a.opOb.contents.find(_=>_.kind===y.PROPOSALS),l=yield this.forge(a),{hash:p,context:h,forgedBytes:b,opResponse:E}=yield this.signAndInject(l);return new hm(p,c,i,b,E,h)})}updateConsensusKey(t){return g(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.updateConsensusKey.bind(this.estimator)),i=yield this.prepare.updateConsensusKey(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(h=>h.kind===y.UPDATE_CONSENSUS_KEY),o=yield this.forge(i),{hash:a,context:c,forgedBytes:l,opResponse:p}=yield this.signAndInject(o);return new dm(a,s,e,l,p,c)})}smartRollupAddMessages(t){return g(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.smartRollupAddMessages.bind(this.estimator)),i=yield this.prepare.smartRollupAddMessages(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(h=>h.kind===y.SMART_ROLLUP_ADD_MESSAGES),o=yield this.forge(i),{hash:a,context:c,forgedBytes:l,opResponse:p}=yield this.signAndInject(o);return new pm(a,s,e,l,p,c)})}smartRollupOriginate(t){return g(this,void 0,void 0,function*(){const e=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.smartRollupOriginate.bind(this.estimator)),i=yield this.rpc.getOriginationProof({kind:t.pvmKind,kernel:t.kernel}),s=Object.assign(Object.assign({},t),{originationProof:i}),o=yield this.prepare.smartRollupOriginate(Object.assign(Object.assign({},s),n)),a=o.opOb.contents.find(E=>E.kind===y.SMART_ROLLUP_ORIGINATE),c=yield this.forge(o),{hash:l,context:p,forgedBytes:h,opResponse:b}=yield this.signAndInject(c);return new fm(l,a,e,h,b,p)})}at(t,e=n=>n){return g(this,void 0,void 0,function*(){const n=hr(t);if(n!==O.VALID)throw new Qe(t,M(n));const i=this.context.withExtensions().rpc,s=this.context.withExtensions().readProvider,o=yield s.getScript(t,"head"),a=yield s.getEntrypoints(t),c=new Bc(t,o,this,this,a,i,s);return e(c,this.context)})}batch(t){const e=new $c(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}}class jc{constructor(t){this.context=t}getNextProto(){return g(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}parseScript(t){return g(this,void 0,void 0,function*(){return new Xe({protocol:yield this.getNextProto()}).parseScript(t)})}parseMichelineExpression(t){return g(this,void 0,void 0,function*(){return new Xe({protocol:yield this.getNextProto()}).parseMichelineExpression(t)})}parseJSON(t){return g(this,void 0,void 0,function*(){return new Xe({protocol:yield this.getNextProto()}).parseJSON(t)})}prepareCodeOrigination(t){return g(this,void 0,void 0,function*(){const e=t;if(e.code=yield this.formatCodeParam(t.code),t.init)e.init=yield this.formatInitParam(t.init);else if(t.storage){const n=e.code.find(o=>"prim"in o&&o.prim==="storage");if(!(n!=null&&n.args))throw new An("The storage section is missing from the script",t.code);const i=new Lt(n.args[0]),s=yield this.findGlobalConstantsHashAndValue(i);if(Object.keys(s).length!==0){const a=new Xe({expandGlobalConstant:s}).parseJSON(n.args[0]),c=new Lt(a);e.init=c.Encode(t.storage)}else e.init=i.Encode(t.storage);delete e.storage}return e})}formatCodeParam(t){return g(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const n=yield this.parseScript(t);if(n===null)throw new An("Invalid code parameter",t);e=n}else{const n=yield this.parseJSON(t),i=["parameter","storage","code"];e=n.sort((s,o)=>i.indexOf(s.prim)-i.indexOf(o.prim))}return e})}formatInitParam(t){return g(this,void 0,void 0,function*(){let e;if(typeof t=="string"){const n=yield this.parseMichelineExpression(t);if(n===null)throw new Lc("Invalid init parameter",t);e=n}else e=yield this.parseJSON(t);return e})}findGlobalConstantsHashAndValue(t){return g(this,void 0,void 0,function*(){const e=t.findToken("constant"),n={};if(e.length!==0)for(const i of e){const s=i.tokenVal.args;if(s){const o=s[0];if(o.string){const a=o.string,c=yield this.context.globalConstantsProvider.getGlobalConstantByHash(a);Object.assign(n,{[a]:c})}}}return n})}}class Vc{constructor(t){this.context=t}packData(t){return g(this,void 0,void 0,function*(){return this.context.rpc.packData(t)})}}class mm extends Error{constructor(){super("No globalThis constants provider has been configured. Please configure one by calling setGlobalConstantsProvider({globalConstantsProvider}) on your TezosToolkit instance."),this.name="UnconfiguredGlobalConstantsProviderError"}}class Uc{getGlobalConstantByHash(t){return g(this,void 0,void 0,function*(){throw new mm})}}class Gc{constructor(t){this.rpc=t}getBalance(t,e){return g(this,void 0,void 0,function*(){return this.rpc.getBalance(t,{block:String(e)})})}getDelegate(t,e){return g(this,void 0,void 0,function*(){return this.rpc.getDelegate(t,{block:String(e)})})}getNextProtocol(t){return g(this,void 0,void 0,function*(){return(yield this.rpc.getProtocols({block:String(t)})).next_protocol})}getProtocolConstants(t){return g(this,void 0,void 0,function*(){const{time_between_blocks:e,minimal_block_delay:n,hard_gas_limit_per_operation:i,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:c,smart_rollup_origination_size:l}=yield this.rpc.getConstants({block:String(t)});return{time_between_blocks:e,minimal_block_delay:n,hard_gas_limit_per_operation:i,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,tx_rollup_origination_size:c,smart_rollup_origination_size:l}})}getScript(t,e){return g(this,void 0,void 0,function*(){const{script:n}=yield this.rpc.getContract(t,{block:String(e)});return n})}getStorage(t,e){return g(this,void 0,void 0,function*(){return this.rpc.getStorage(t,{block:String(e)})})}getBlockHash(t){return g(this,void 0,void 0,function*(){const{hash:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBlockLevel(t){return g(this,void 0,void 0,function*(){const{level:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getCounter(t,e){return g(this,void 0,void 0,function*(){const{counter:n}=yield this.rpc.getContract(t,{block:String(e)});return n||"0"})}getBlockTimestamp(t){return g(this,void 0,void 0,function*(){const{timestamp:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBigMapValue(t,e){return g(this,void 0,void 0,function*(){return this.rpc.getBigMapExpr(t.id,t.expr,{block:String(e)})})}getSaplingDiffById(t,e){return g(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffById(t.id,{block:String(e)})})}getSaplingDiffByContract(t,e){return g(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffByContract(t,{block:String(e)})})}getEntrypoints(t){return g(this,void 0,void 0,function*(){return this.rpc.getEntrypoints(t)})}getChainId(){return g(this,void 0,void 0,function*(){return this.rpc.getChainId()})}isAccountRevealed(t,e){return g(this,void 0,void 0,function*(){const n=yield this.rpc.getManagerKey(t,{block:String(e)});return n&&typeof n=="object"?!!n.key:!!n})}getBlock(t){return g(this,void 0,void 0,function*(){return this.rpc.getBlock({block:String(t)})})}getLiveBlocks(t){return this.rpc.getLiveBlocks({block:String(t)})}}const ym=(r,t)=>r.hash===t.opHash,bm=(r,t)=>{switch(r.kind){case"endorsement":return"metadata"in r&&r.metadata.delegate===t.source;case"activate_account":return"metadata"in r&&r.pkh===t.source;default:return"source"in r&&r.source===t.source}},Em=(r,t)=>"kind"in r&&r.kind===t.kind,vm=(r,t)=>{switch(r.kind){case"delegation":return r.delegate===t.destination;case"origination":if("metadata"in r&&"operation_result"in r.metadata&&"originated_contracts"in r.metadata.operation_result&&Array.isArray(r.metadata.operation_result.originated_contracts))return r.metadata.operation_result.originated_contracts.some(e=>e===t.destination);break;case"transaction":return r.destination===t.destination;default:return!1}},_m=(r,t,e,n)=>!(r.kind!=="event"||e&&r.tag!==e||t&&r.source!==t||n&&r.result.status!=="applied"),wm=(r,t)=>"opHash"in t?ym(r,t):"source"in t?bm(r,t):"kind"in t?Em(r,t):"destination"in t?vm(r,t):!1,Am=(r,t)=>{if(Array.isArray(t.and))return t.and.every(e=>Ti(r,e));if(Array.isArray(t.or))return t.or.some(e=>Ti(r,e));throw new Tg("Filter expression must contain either and/or property")},Ti=(r,t)=>{const e=[];return Array.isArray(t)?e.push(...t):e.push(t),e.every(n=>"and"in n||"or"in n?Am(r,n):wm(r,n))};class aa extends Error{constructor(t){super(t),this.message=t,this.name="UnsupportedEventError"}}class nn{constructor(t,e=!1,n=qa()){this.shouldRetry=e,this.operatorFunction=n,this.errorListeners=[],this.messageListeners=[],this.closeListeners=[],this.completed$=new gr,t.pipe(Hh(this.completed$),yn(i=>{this.call(this.messageListeners,i)},i=>{this.call(this.errorListeners,i)},()=>{this.call(this.closeListeners)}),this.shouldRetry?n:yn(),qi(()=>ch)).subscribe()}call(t,e){for(const n of t)try{n(e)}catch(i){console.error(i)}}remove(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}on(t,e){switch(t){case"data":this.messageListeners.push(e);break;case"error":this.errorListeners.push(e);break;case"close":this.closeListeners.push(e);break;default:throw new aa(`Trying to register on an unsupported event: ${t}`)}}off(t,e){switch(t){case"data":this.remove(this.messageListeners,e);break;case"error":this.remove(this.errorListeners,e);break;case"close":this.remove(this.closeListeners,e);break;default:throw new aa(`Trying to unregister on an unsupported event: ${t}`)}}close(){this.completed$.next()}}const Sm={shouldObservableSubscriptionRetry:!1,observableSubscriptionRetryFunction:qa()},Rm=r=>rr(r.rpc.getBlock()).pipe(Ae()),Om=r=>Gr(t=>new Q(e=>{for(const n of t.operations)for(const i of n)for(const s of i.contents)Ti(Object.assign({hash:i.hash},s),r)&&e.next(Object.assign({hash:i.hash},s));e.complete()})),Pm=r=>Gr(t=>new Q(e=>{for(const n of t.operations)for(const i of n)for(const s of i.contents){const a=s.metadata.internal_operation_results;if(a)for(const c of a)_m(c,r==null?void 0:r.address,r==null?void 0:r.tag,r==null?void 0:r.excludeFailedOperations)&&e.next(Object.assign({opHash:i.hash,blockHash:t.hash,level:t.header.level},c))}e.complete()}));class Ii{constructor(t,e={}){this.context=t,this._config$=new In(Object.assign(Object.assign({},Sm),e)),this.timer$=this._config$.pipe(Io("pollingIntervalMilliseconds"),ae(n=>n?To(0,n):rr(this.getConfirmationPollingInterval()).pipe(ae(i=>To(0,i))))),this.newBlock$=this.timer$.pipe(ae(()=>Rm(this.context)),_h("hash"),xh(),Mr())}get config(){return this._config$.getValue()}getConfirmationPollingInterval(){return g(this,void 0,void 0,function*(){if(!this.config.pollingIntervalMilliseconds)try{const n=yield this.context.readProvider.getProtocolConstants("head"),s=(n.minimal_block_delay?n.minimal_block_delay.multipliedBy(1e3):n.time_between_blocks?n.time_between_blocks[0].multipliedBy(1e3):new P(5e3)).dividedBy(3);this.config.pollingIntervalMilliseconds=s.toNumber()===0?1e3:s.toNumber()}catch{return 5e3}return this.config.pollingIntervalMilliseconds})}subscribeBlock(t){return new nn(this.newBlock$,this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribe(t){return new nn(this.newBlock$.pipe(Io("hash")),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeOperation(t){return new nn(this.newBlock$.pipe(Om(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeEvent(t){return new nn(this.newBlock$.pipe(Pm(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}}class Kc{constructor(t){this.context=t}getNextProto(){return g(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}forge({branch:t,contents:e}){return g(this,void 0,void 0,function*(){return new Ic(yield this.getNextProto()).forge({branch:t,contents:e})})}}const Tm={defaultConfirmationCount:1,confirmationPollingTimeoutSecond:180};class Sn{constructor(t,e=new Si,n,i=new In(Object.assign({},Tm)),s,o,a,c,l,p,h,b){this._rpc=t,this._signer=e,this._proto=n,this._config=i,this.providerDecorator=[],this.tz=new em(this),this.estimate=new Wg(this),this.contract=new gm(this,this.estimate),this.prepare=new Fr(this),this.batch=new Yg(this,this.estimate),this.wallet=new Mn(this),this.withExtensions=()=>{let E=this.clone();return this.providerDecorator.forEach(_=>{E=_(E)}),E},typeof this._rpc=="string"?this._rpcClient=new an(this._rpc):this._rpcClient=this._rpc,this._forger=s||new Kc(this),this._injector=o||new og(this),this.operationFactory=new tm(this),this._walletProvider=c||new kc(this),this._parser=l||new jc(this),this._packer=a||new Vc(this),this._globalConstantsProvider=p||new Uc,this._readProvider=h||new Gc(this._rpcClient),this._stream=b||new Ii(this)}get config(){return this._config.getValue()}set config(t){this._config.next(Object.assign({},t))}setPartialConfig(t){this._config.next(Object.assign(Object.assign({},this._config.getValue()),t))}get rpc(){return this._rpcClient}set rpc(t){this._rpcClient=t}get injector(){return this._injector}set injector(t){this._injector=t}get forger(){return this._forger}set forger(t){this._forger=t}get signer(){return this._signer}set signer(t){this._signer=t}get walletProvider(){return this._walletProvider}set walletProvider(t){this._walletProvider=t}set proto(t){this._proto=t}get proto(){return this._proto}get parser(){return this._parser}set parser(t){this._parser=t}get packer(){return this._packer}set packer(t){this._packer=t}get globalConstantsProvider(){return this._globalConstantsProvider}set globalConstantsProvider(t){this._globalConstantsProvider=t}get readProvider(){return this._readProvider}set readProvider(t){this._readProvider=t}get stream(){return this._stream}set stream(t){this._stream=t}isAnyProtocolActive(t=[]){return g(this,void 0,void 0,function*(){if(this._proto)return t.includes(this._proto);{const e=yield this.readProvider.getNextProtocol("head");return t.includes(e)}})}isAnySignerConfigured(){return!(this.signer instanceof Si)}clone(){return new Sn(this.rpc,this.signer,this.proto,this._config,this.forger,this._injector,this.packer,this._walletProvider,this._parser,this._globalConstantsProvider,this._readProvider,this._stream)}registerProviderDecorator(t){this.providerDecorator.push(t)}}const Im={commitHash:"b357541c90c2168d48216d62a07de5dd3baab9a0",version:"17.0.0"};class Cm{constructor(t){this.context=t}forge({branch:t,contents:e}){return this.context.rpc.forgeOperations({branch:t,contents:e})}}class Mm{packData(t){return g(this,void 0,void 0,function*(){const{bytes:e}=bp(t.data,t.type);return{packed:e}})}}class Dm{constructor(t){this._rpc=t,this._options={},this.format=Ci,typeof this._rpc=="string"?this._rpcClient=new an(this._rpc):this._rpcClient=this._rpc,this._context=new Sn(t),this._wallet=new Mn(this._context),this.setProvider({rpc:this._rpcClient}),this.batch=this._context.batch.batch.bind(this._context.batch)}setProvider({rpc:t,stream:e,signer:n,protocol:i,config:s,forger:o,wallet:a,packer:c,globalConstantsProvider:l,readProvider:p,parserProvider:h}){this.setRpcProvider(t),this.setStreamProvider(e),this.setSignerProvider(n),this.setForgerProvider(o),this.setWalletProvider(a),this.setPackerProvider(c),this.setGlobalConstantsProvider(l),this.setReadProvider(p),this.setParserProvider(h),this._context.proto=i,s&&this._context.setPartialConfig(s)}setSignerProvider(t){!this._options.signer&&typeof t>"u"?(this._context.signer=new Si,this._options.signer=t):typeof t<"u"&&(this._context.signer=t,this._options.signer=t)}setRpcProvider(t){typeof t=="string"?this._rpcClient=new an(t):t===void 0||(this._rpcClient=t),this._options.rpc=this._rpcClient,this._context.rpc=this._rpcClient}setForgerProvider(t){if(typeof t<"u")this._options.forger=t,this._context.forger=t;else if(this._options.forger===void 0){const e=this.getFactory(Kc)();this._options.forger=e,this._context.forger=e}}setStreamProvider(t){if(typeof t=="string"){const e=new Ii(new Sn(new an(t)));this._options.stream=e,this._context.stream=e}else if(typeof t<"u")this._options.stream=t,this._context.stream=t;else if(this._options.stream===void 0){const e=this.getFactory(Ii)();this._options.stream=e,this._context.stream=e}}setWalletProvider(t){if(!this._options.wallet&&typeof t>"u"){const e=this.getFactory(kc)();this._options.wallet=e,this._context.walletProvider=e}else typeof t<"u"&&(this._options.wallet=t,this._context.walletProvider=t)}setPackerProvider(t){if(!this._options.packer&&typeof t>"u"){const e=this.getFactory(Vc)();this._context.packer=e,this._options.packer=e}else typeof t<"u"&&(this._context.packer=t,this._options.packer=t)}setGlobalConstantsProvider(t){if(!this._options.globalConstantsProvider&&typeof t>"u"){const e=new Uc;this._context.globalConstantsProvider=e,this._options.globalConstantsProvider=e}else typeof t<"u"&&(this._context.globalConstantsProvider=t,this._options.globalConstantsProvider=t)}setReadProvider(t){const e=t||new Gc(this._context.rpc);this._options.readProvider=e,this._context.readProvider=e}setParserProvider(t){if(!this._options.parserProvider&&typeof t>"u"){const e=new jc(this._context);this._context.parser=e,this._options.parserProvider=e}else typeof t<"u"&&(this._context.parser=t,this._options.parserProvider=t)}get tz(){return this._context.tz}get contract(){return this._context.contract}get prepare(){return this._context.prepare}get wallet(){return this._wallet}get operation(){return this._context.operationFactory}get estimate(){return this._context.estimate}get stream(){return this._context.stream}get rpc(){return this._context.rpc}get signer(){return this._context.signer}get globalConstants(){return this._context.globalConstantsProvider}addExtension(t){Array.isArray(t)?t.forEach(e=>e.configureContext(this._context)):t.configureContext(this._context)}getFactory(t){return(...e)=>new t(this._context,...e)}getVersionInfo(){return Im}}export{Ie as D,pt as E,gl as H,Mm as M,y as O,Cm as R,Cr as S,Dm as T,wr as a,ce as b,Ne as c,Rs as d,Is as e,Ss as f,Os as g,Lt as h,Lm as l};
