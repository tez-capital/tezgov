const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CKMI08DK.js","./Bv5Dzk5n.js"])))=>i.map(i=>d[i]);
import{_ as Ao}from"./Bho5j6Xg.js";import{r as Bn,N as gn,v as K,V as T,A as F,C as Mr,D as rr,B as I,E as cl,F as ul,g as ll,T as at,y as Ea,G as rn,H as Gi,J as So,K as fs,L as Po,M as hl,a as dl,O as pl,Q as Ki,R as Ro,b as gs,S as ji,W as fl,X as _a,Y as gl,i as q,Z as ml,_ as yl,$ as je,a0 as R,d as ms,a1 as El,a2 as zt,I as Xn,a3 as Qn,a4 as ys,a5 as _l,a6 as bl,f as L,e as Ot,a7 as Fi,l as vl,j as ba,c as kt,a8 as Al,a9 as va,aa as Aa,ab as Sa,ac as Be,ad as or,ae as ar,af as Pa,ag as ti,ah as Es,x as ei,ai as Sl,aj as Br,ak as Ra,al as nn,am as Pl,P as Oi}from"./CKMI08DK.js";var vn={exports:{}},Oo;function Rl(){return Oo||(Oo=1,function(e,t){var r=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof Bn<"u")return Bn;throw new Error("unable to locate global object")},n=r();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response}(vn,vn.exports)),vn.exports}function Oa(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(g){o(g)}}function c(l){try{u(n.throw(l))}catch(g){o(g)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})}class Ol extends gn{constructor(t,r,n){super(),this.method=t,this.url=r,this.cause=n,this.name="HttpRequestFailed",this.message=`${t} ${r} ${String(n)}`}}class Pr extends gn{constructor(t,r,n,i,s){super(),this.message=t,this.status=r,this.statusText=n,this.body=i,this.url=s,this.name="HttpResponseError"}}class wl extends gn{constructor(t,r){super(),this.timeout=t,this.url=r,this.name="HttpTimeoutError",this.message=`HTTP request timeout of ${t}ms exceeded`}}var an;(function(e){e[e.CONTINUE=100]="CONTINUE",e[e.SWITCHING_PROTOCOLS=101]="SWITCHING_PROTOCOLS",e[e.PROCESSING=102]="PROCESSING",e[e.OK=200]="OK",e[e.CREATED=201]="CREATED",e[e.ACCEPTED=202]="ACCEPTED",e[e.NON_AUTHORITATIVE_INFORMATION=203]="NON_AUTHORITATIVE_INFORMATION",e[e.NO_CONTENT=204]="NO_CONTENT",e[e.RESET_CONTENT=205]="RESET_CONTENT",e[e.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",e[e.MULTI_STATUS=207]="MULTI_STATUS",e[e.ALREADY_REPORTED=208]="ALREADY_REPORTED",e[e.IM_USED=226]="IM_USED",e[e.MULTIPLE_CHOICES=300]="MULTIPLE_CHOICES",e[e.MOVED_PERMANENTLY=301]="MOVED_PERMANENTLY",e[e.FOUND=302]="FOUND",e[e.SEE_OTHER=303]="SEE_OTHER",e[e.NOT_MODIFIED=304]="NOT_MODIFIED",e[e.USE_PROXY=305]="USE_PROXY",e[e.SWITCH_PROXY=306]="SWITCH_PROXY",e[e.TEMPORARY_REDIRECT=307]="TEMPORARY_REDIRECT",e[e.PERMANENT_REDIRECT=308]="PERMANENT_REDIRECT",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",e[e.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",e[e.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",e[e.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",e[e.CONFLICT=409]="CONFLICT",e[e.GONE=410]="GONE",e[e.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",e[e.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",e[e.PAYLOAD_TOO_LARGE=413]="PAYLOAD_TOO_LARGE",e[e.URI_TOO_LONG=414]="URI_TOO_LONG",e[e.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",e[e.RANGE_NOT_SATISFIABLE=416]="RANGE_NOT_SATISFIABLE",e[e.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",e[e.I_AM_A_TEAPOT=418]="I_AM_A_TEAPOT",e[e.MISDIRECTED_REQUEST=421]="MISDIRECTED_REQUEST",e[e.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",e[e.LOCKED=423]="LOCKED",e[e.FAILED_DEPENDENCY=424]="FAILED_DEPENDENCY",e[e.UPGRADE_REQUIRED=426]="UPGRADE_REQUIRED",e[e.PRECONDITION_REQUIRED=428]="PRECONDITION_REQUIRED",e[e.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",e[e.REQUEST_HEADER_FIELDS_TOO_LARGE=431]="REQUEST_HEADER_FIELDS_TOO_LARGE",e[e.UNAVAILABLE_FOR_LEGAL_REASONS=451]="UNAVAILABLE_FOR_LEGAL_REASONS",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",e[e.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",e[e.BAD_GATEWAY=502]="BAD_GATEWAY",e[e.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",e[e.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",e[e.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED",e[e.VARIANT_ALSO_NEGOTIATES=506]="VARIANT_ALSO_NEGOTIATES",e[e.INSUFFICIENT_STORAGE=507]="INSUFFICIENT_STORAGE",e[e.LOOP_DETECTED=508]="LOOP_DETECTED",e[e.NOT_EXTENDED=510]="NOT_EXTENDED",e[e.NETWORK_AUTHENTICATION_REQUIRED=511]="NETWORK_AUTHENTICATION_REQUIRED"})(an||(an={}));var wi;let wa=globalThis?.fetch,Vi;const Ta=typeof process<"u"&&!!(!((wi=process==null?void 0:process.versions)===null||wi===void 0)&&wi.node);Ta&&(wa=Rl(),Number(process.versions.node.split(".")[0])>=19&&(Vi=e=>Oa(void 0,void 0,void 0,function*(){const{Agent:t}=yield Ao(()=>import("./CKMI08DK.js").then(n=>n.as),__vite__mapDeps([0,1]),import.meta.url),{Agent:r}=yield Ao(()=>import("./CKMI08DK.js").then(n=>n.as),__vite__mapDeps([0,1]),import.meta.url);return e.startsWith("https")?new t({keepAlive:!1}):new r({keepAlive:!1})})));class Tl{constructor(t=3e4){this.timeout=t}serialize(t){if(!t)return"";const r=[];for(const i in t)if(t.hasOwnProperty(i)&&typeof t[i]<"u"){const s=typeof t[i].toJSON=="function"?t[i].toJSON():t[i];if(s===null){r.push(encodeURIComponent(i));continue}if(Array.isArray(s)){s.forEach(o=>{r.push(encodeURIComponent(i)+"="+encodeURIComponent(o))});continue}r.push(encodeURIComponent(i)+"="+encodeURIComponent(s))}const n=r.join("&");return n?`?${n}`:""}createRequest(t,r){return Oa(this,arguments,void 0,function*({url:n,method:i,timeout:s=this.timeout,query:o,headers:a={},json:c=!0},u){const l=n+this.serialize(o);a["Content-Type"]||(a["Content-Type"]="application/json");const g=new AbortController,E=setTimeout(()=>g.abort(),s);try{const y=yield wa(l,Object.assign({keepalive:!1,method:i,headers:a,body:JSON.stringify(u),signal:g.signal},Ta&&Vi?{agent:yield Vi(l)}:{}));if(typeof y>"u")throw new Error("Response is undefined");if(y.status>=400){const v=yield y.text();throw new Pr(`Http error response: (${y.status}) ${v}`,y.status,y.statusText,v,l)}return c?y.json():y.text()}catch(y){throw y instanceof Error&&y.name==="AbortError"?new wl(s,l):y instanceof Pr?y:new Ol(String(i),l,y)}finally{clearTimeout(E)}})}}function Jr(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function x(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(g){o(g)}}function c(l){try{u(n.throw(l))}catch(g){o(g)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})}const Il="main",M={block:"head"};var wo;(function(e){e.GET_BAKING_RIGHTS="getBakingRights",e.GET_BALLOTS="getBallots",e.GET_BALLOT_LIST="getBallotList",e.GET_BIG_MAP_KEY="getBigMapKey",e.GET_BIG_MAP_EXPR="getBigMapExpr",e.GET_BLOCK_HASH="getBlockHash",e.GET_BLOCK="getBlock",e.GET_BLOCK_HEADER="getBlockHeader",e.GET_BLOCK_METADATA="getBlockMetadata",e.GET_BALANCE="getBalance",e.GET_SPENDABLE="getSpendable",e.GET_BALANCE_AND_FROZEN_BONDS="getBalanceAndFrozenBonds",e.GET_SPENDABLE_AND_FROZEN_BONDS="getSpendableAndFrozenBonds",e.GET_FULL_BALANCE="getFullBalance",e.GET_STAKED_BALANCE="getStakedBalance",e.GET_UNSTAKED_FINALIZABLE_BALANCE="getUnstakedFinalizableBalance",e.GET_UNSTAKED_FROZEN_BALANCE="getUnstakedFrozenBalance",e.GET_UNSTAKE_REQUESTS="getUnstakeRequests",e.GET_CHAIN_ID="getChainId",e.GET_CONSTANTS="getConstants",e.GET_CONTRACT="getContract",e.GET_CURRENT_PERIOD="getCurrentPeriod",e.GET_CURRENT_PROPOSAL="getCurrentProposal",e.GET_CURRENT_QUORUM="getCurrentQuorum",e.GET_DELEGATE="getDelegate",e.GET_ALL_DELEGATES="getAllDelegates",e.GET_DELEGATES="getDelegates",e.GET_VOTING_INFO="getVotingInfo",e.GET_ATTESTATION_RIGHTS="getAttestationRights",e.GET_ENTRYPOINTS="getEntrypoints",e.GET_LIVE_BLOCKS="getLiveBlocks",e.GET_MANAGER_KEY="getManagerKey",e.GET_NORMALIZED_SCRIPT="getNormalizedScript",e.GET_PROPOSALS="getProposals",e.GET_PROTOCOLS="getProtocols",e.GET_SAPLING_DIFF_BY_CONTRACT="getSaplingDiffByContract",e.GET_PROTOCOL_ACTIVATIONS="getProtocolActivations",e.GET_SAPLING_DIFF_BY_ID="getSaplingDiffById",e.GET_SCRIPT="getScript",e.GET_STORAGE="getStorage",e.GET_SUCCESSOR_PERIOD="getSuccessorPeriod",e.GET_VOTES_LISTINGS="getVotesListings",e.PACK_DATA="packData",e.GET_STORAGE_USED_SPACE="getStorageUsedSpace",e.GET_STORAGE_PAID_SPACE="getStoragePaidSpace",e.GET_TICKET_BALANCE="getTicketBalance",e.GET_ALL_TICKET_BALANCES="getAllTicketBalances",e.GET_ADAPTIVE_ISSUANCE_LAUNCH_CYCLE="getAdaptiveIssuanceLaunchCycle",e.GET_PENDING_OPERATIONS="getPendingOperations"})(wo||(wo={}));function mr(e,t){const r=Array.isArray(e);typeof t>"u"&&(t=Object.keys(e));const n=r?[]:{};return t.forEach(i=>{const s=e[i];let o;if(!(typeof s>"u")){if(Array.isArray(s)){o=mr(s),n[i]=o;return}o=new I(s),n[i]=o}}),n}var To;(function(e){e.TOO_LARGE="too large"})(To||(To={}));var Io;(function(e){e.ACTIVATION="activation",e.ATTESTATION="attestation",e.ATTESTATIONS_AGGREGATE="attestations_aggregate",e.ATTESTATION_WITH_DAL="attestation_with_dal",e.ATTESTING_REWARDS="attesting rewards",e.BAKING_BONUSES="baking bonuses",e.BAKING_REWARDS="baking rewards",e.BALLOT="ballot",e.BLOCK_FEES="block fees",e.BONDS="bonds",e.BOOTSTRAP="bootstrap",e.BURNED="burned",e.COMMITMENT="commitment",e.DAL_ATTESTING_REWARDS="dal attesting rewards",e.DAL_ENTRAPMENT_EVIDENCE="dal_entrapment_evidence",e.DAL_PUBLISH_COMMITMENT="dal_publish_commitment",e.DELEGATE_DENOMINATOR="delegate_denominator",e.DELEGATION="delegation",e.DELEGATOR_NUMERATOR="delegator_numerator",e.DEPOSITS="deposits",e.DOUBLE_ATTESTATION_EVIDENCE="double_attestation_evidence",e.DOUBLE_BAKING_EVIDENCE="double_baking_evidence",e.DOUBLE_ENDORSEMENT_EVIDENCE="double_endorsement_evidence",e.DOUBLE_PREATTESTATION_EVIDENCE="double_preattestation_evidence",e.DOUBLE_PREENDORSEMENT_EVIDENCE="double_preendorsement_evidence",e.DRAIN_DELEGATE="drain_delegate",e.ENDORSEMENT="endorsement",e.ENDORSEMENT_WITH_DAL="endorsement_with_dal",e.EVENT="event",e.FAILING_NOOP="failing_noop",e.INCREASE_PAID_STORAGE="increase_paid_storage",e.INVOICE="invoice",e.LOST_ATTESTING_REWARDS="lost attesting rewards",e.LOST_DAL_ATTESTING_REWARDS="lost dal attesting rewards",e.MINTED="minted",e.NONCE_REVELATION_REWARDS="nonce revelation rewards",e.ORIGINATION="origination",e.PREATTESTATION="preattestation",e.PREATTESTATIONS_AGGREGATE="preattestations_aggregate",e.PREENDORSEMENT="preendorsement",e.PROPOSALS="proposals",e.PUNISHMENTS="punishments",e.REGISTER_GLOBAL_CONSTANT="register_global_constant",e.REVEAL="reveal",e.SEED_NONCE_REVELATION="seed_nonce_revelation",e.SET_DEPOSITS_LIMIT="set_deposits_limit",e.SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",e.SMART_ROLLUP_CEMENT="smart_rollup_cement",e.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message",e.SMART_ROLLUP_ORIGINATE="smart_rollup_originate",e.SMART_ROLLUP_PUBLISH="smart_rollup_publish",e.SMART_ROLLUP_RECOVER_BOND="smart_rollup_recover_bond",e.SMART_ROLLUP_REFUTATION_PUNISHMENTS="smart_rollup_refutation_punishments",e.SMART_ROLLUP_REFUTATION_REWARDS="smart_rollup_refutation_rewards",e.SMART_ROLLUP_REFUTE="smart_rollup_refute",e.SMART_ROLLUP_TIMEOUT="smart_rollup_timeout",e.STORAGE_FEES="storage fees",e.SUBSIDY="subsidy",e.TICKET_UPDATES="ticket_updates",e.TRANSACTION="transaction",e.TRANSFER_TICKET="transfer_ticket",e.UNSTAKED_DEPOSITS="unstaked_deposits",e.UPDATE_COMPANION_KEY="update_companion_key",e.UPDATE_CONSENSUS_KEY="update_consensus_key",e.VDF_REVELATION="vdf_revelation"})(Io||(Io={}));var Lo;(function(e){e.WASM2="wasm_2_0_0",e.ARITH="arith",e.RISCV="riscv"})(Lo||(Lo={}));var No;(function(e){e.START="start",e.MOVE="move"})(No||(No={}));var xo;(function(e){e.INBOX_PROOF="inbox_proof",e.REVEAL_PROOF="reveal_proof",e.FIRST_INPUT="first_input"})(xo||(xo={}));var ko;(function(e){e.RAW_DATA_PROOF="raw_data_proof",e.METADATA_PROOF="metadata_proof",e.DAL_PAGE_PROOF="dal_page_proof",e.DAL_PARAMETERS_PROOF="dal_parameters_proof"})(ko||(ko={}));var Mo;(function(e){e.ONGOING="ongoing",e.ENDED="ended"})(Mo||(Mo={}));var Ho;(function(e){e.LOSER="loser",e.DRAW="draw"})(Ho||(Ho={}));var Do;(function(e){e.CONFLICT_RESOLVED="conflict_resolved",e.TIMEOUT="timeout"})(Do||(Do={}));var _;(function(e){e.ORIGINATION="origination",e.DELEGATION="delegation",e.REVEAL="reveal",e.TRANSACTION="transaction",e.ACTIVATION="activate_account",e.ATTESTATION="attestation",e.ENDORSEMENT="endorsement",e.PREATTESTATION="preattestation",e.PREENDORSEMENT="preendorsement",e.SET_DEPOSITS_LIMIT="set_deposits_limit",e.DOUBLE_PREATTESTATION_EVIDENCE="double_preattestation_evidence",e.DOUBLE_PREENDORSEMENT_EVIDENCE="double_preendorsement_evidence",e.ATTESTATION_WITH_DAL="attestation_with_dal",e.ENDORSEMENT_WITH_DAL="endorsement_with_dal",e.SEED_NONCE_REVELATION="seed_nonce_revelation",e.DOUBLE_ATTESTATION_EVIDENCE="double_attestation_evidence",e.DOUBLE_ENDORSEMENT_EVIDENCE="double_endorsement_evidence",e.DOUBLE_BAKING_EVIDENCE="double_baking_evidence",e.PROPOSALS="proposals",e.BALLOT="ballot",e.FAILING_NOOP="failing_noop",e.REGISTER_GLOBAL_CONSTANT="register_global_constant",e.TRANSFER_TICKET="transfer_ticket",e.INCREASE_PAID_STORAGE="increase_paid_storage",e.UPDATE_CONSENSUS_KEY="update_consensus_key",e.DRAIN_DELEGATE="drain_delegate",e.VDF_REVELATION="vdf_revelation",e.EVENT="event",e.TICKET_UPDATES="ticket_updates",e.SMART_ROLLUP_ORIGINATE="smart_rollup_originate",e.SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",e.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message",e.SMART_ROLLUP_PUBLISH="smart_rollup_publish",e.SMART_ROLLUP_CEMENT="smart_rollup_cement",e.SMART_ROLLUP_RECOVER_BOND="smart_rollup_recover_bond",e.SMART_ROLLUP_REFUTE="smart_rollup_refute",e.SMART_ROLLUP_TIMEOUT="smart_rollup_timeout",e.DAL_PUBLISH_COMMITMENT="dal_publish_commitment",e.DAL_ENTRAPMENT_EVIDENCE="dal_entrapment_evidence",e.PREATTESTATIONS_AGGREGATE="preattestations_aggregate",e.ATTESTATIONS_AGGREGATE="attestations_aggregate",e.UPDATE_COMPANION_KEY="update_companion_key",e.DOUBLE_CONSENSUS_OPERATION_EVIDENCE="double_consensus_operation_evidence"})(_||(_={}));class xn{constructor(t,r=Il,n=new Tl){this.url=t,this.chain=r,this.httpBackend=n}createURL(t){let r=this.url;for(;r.endsWith("/");)r=r.slice(0,-1);return`${r}${t}`}validateAddress(t){const r=K(t);if(r!==T.VALID)throw new F(t,r)}validateContract(t){const r=Mr(t);if(r!==T.VALID)throw new rr(t,r)}getBlockHash(){return x(this,arguments,void 0,function*({block:t}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/hash`),method:"GET"})})}getLiveBlocks(){return x(this,arguments,void 0,function*({block:t}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/live_blocks`),method:"GET"})})}getBalance(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/balance`),method:"GET"});return new I(i)})}getSpendable(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/spendable`),method:"GET"});return new I(i)})}getBalanceAndFrozenBonds(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/balance_and_frozen_bonds`),method:"GET"});return new I(i)})}getSpendableAndFrozenBonds(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/spendable_and_frozen_bonds`),method:"GET"});return new I(i)})}getFullBalance(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/full_balance`),method:"GET"});return new I(i)})}getStakedBalance(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/staked_balance`),method:"GET"});return new I(i)})}getUnstakedFinalizableBalance(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/unstaked_finalizable_balance`),method:"GET"});return new I(i)})}getUnstakedFrozenBalance(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/unstaked_frozen_balance`),method:"GET"});return new I(i)})}getUnstakeRequests(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/unstake_requests`),method:"GET"});return i===null?null:{finalizable:i.finalizable.map(s=>{var{amount:o}=s,a=Jr(s,["amount"]);const c=mr({amount:o},["amount"]);return Object.assign(Object.assign({},a),{amount:c.amount})}),unfinalizable:{delegate:i.unfinalizable.delegate,requests:i.unfinalizable.requests.map(({amount:s,cycle:o})=>{const a=mr({amount:s},["amount"]);return{cycle:o,amount:a.amount}})}}})}getStorage(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.validateContract(r),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/storage`),method:"GET"})})}getScript(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.validateContract(r),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/script`),method:"GET"})})}getNormalizedScript(t){return x(this,arguments,void 0,function*(r,n={unparsing_mode:"Readable"},{block:i}=M){return this.validateContract(r),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${i}/context/contracts/${r}/script/normalized`),method:"POST"},n)})}getContract(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}`),method:"GET"});return Object.assign(Object.assign({},i),{balance:new I(i.balance)})})}getManagerKey(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.validateAddress(r),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/manager_key`),method:"GET"})})}getDelegate(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);let i;try{i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/delegate`),method:"GET"})}catch(s){if(s instanceof Pr&&s.status===an.NOT_FOUND)i=null;else throw s}return i})}getBigMapKey(t,r){return x(this,arguments,void 0,function*(n,i,{block:s}=M){return this.validateAddress(n),this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${s}/context/contracts/${n}/big_map_get`),method:"POST"},i)})}getBigMapExpr(t,r){return x(this,arguments,void 0,function*(n,i,{block:s}=M){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${s}/context/big_maps/${n}/${i}`),method:"GET"})})}getAllDelegates(){return x(this,arguments,void 0,function*(t={},{block:r}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${r}/context/delegates`),method:"GET",query:t})})}getDelegates(t){return x(this,arguments,void 0,function*(r,{block:n}=M){this.validateAddress(r);const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/delegates/${r}`),method:"GET"}),s=mr(i,["balance","full_balance","current_frozen_deposits","frozen_deposits","frozen_balance","frozen_deposits_limit","staking_balance","delegated_balance","voting_power","total_delegated_stake","staking_denominator"]);return i.frozen_balance_by_cycle?Object.assign(Object.assign(Object.assign({},i),s),{frozen_balance_by_cycle:i.frozen_balance_by_cycle.map(o=>{var{deposit:a,deposits:c,fees:u,rewards:l}=o,g=Jr(o,["deposit","deposits","fees","rewards"]);const E=mr({deposit:a,deposits:c,fees:u,rewards:l},["deposit","deposits","fees","rewards"]);return Object.assign(Object.assign({},g),{deposit:E.deposit,deposits:E.deposits,fees:E.fees,rewards:E.rewards})})}):Object.assign(Object.assign({},i),s)})}getVotingInfo(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.validateAddress(r),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/delegates/${r}/voting_info`),method:"GET"})})}getConstants(){return x(this,arguments,void 0,function*({block:t}=M){const r=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/context/constants`),method:"GET"}),n=mr(r,["time_between_blocks","hard_gas_limit_per_operation","hard_gas_limit_per_block","proof_of_work_threshold","tokens_per_roll","seed_nonce_revelation_tip","block_security_deposit","endorsement_security_deposit","block_reward","endorsement_reward","cost_per_byte","hard_storage_limit_per_operation","test_chain_duration","baking_reward_per_endorsement","delay_per_missing_endorsement","minimal_block_delay","liquidity_baking_subsidy","cache_layout","baking_reward_fixed_portion","baking_reward_bonus_per_slot","endorsing_reward_per_slot","double_baking_punishment","delay_increment_per_round","tx_rollup_commitment_bond","vdf_difficulty","sc_rollup_stake_amount","minimal_stake"]);return Object.assign(Object.assign({},r),n)})}getBlock(){return x(this,arguments,void 0,function*({block:t,version:r}=M){const n={url:this.createURL(`/chains/${this.chain}/blocks/${t}`),method:"GET"};return r!==void 0&&(n.query={version:r}),yield this.httpBackend.createRequest(n)})}getBlockHeader(){return x(this,arguments,void 0,function*({block:t}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/header`),method:"GET"})})}getBlockMetadata(){return x(this,arguments,void 0,function*({block:t,version:r}=M){const n={url:this.createURL(`/chains/${this.chain}/blocks/${t}/metadata`),method:"GET"};return r!==void 0&&(n.query={version:r}),yield this.httpBackend.createRequest(n)})}getBakingRights(){return x(this,arguments,void 0,function*(t={},{block:r}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${r}/helpers/baking_rights`),method:"GET",query:t})})}getAttestationRights(){return x(this,arguments,void 0,function*(t={},{block:r}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${r}/helpers/attestation_rights`),method:"GET",query:t})})}getBallotList(){return x(this,arguments,void 0,function*({block:t}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballot_list`),method:"GET"})})}getBallots(){return x(this,arguments,void 0,function*({block:t}=M){const r=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/ballots`),method:"GET"});return mr(r,["yay","nay","pass"])})}getCurrentProposal(){return x(this,arguments,void 0,function*({block:t}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_proposal`),method:"GET"})})}getCurrentQuorum(){return x(this,arguments,void 0,function*({block:t}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_quorum`),method:"GET"})})}getVotesListings(){return x(this,arguments,void 0,function*({block:t}=M){const r=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/listings`),method:"GET"});return r.map(n=>(n.voting_power&&(n.voting_power=new I(n.voting_power)),n)),r})}getProposals(){return x(this,arguments,void 0,function*({block:t}=M){const r=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/proposals`),method:"GET"});return r.map(n=>n[1]=new I(n[1])),r})}forgeOperations(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/helpers/forge/operations`),method:"POST"},r)})}injectOperation(t){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL("/injection/operation"),method:"POST"},t)})}preapplyOperations(t){return x(this,arguments,void 0,function*(r,{block:n,version:i}=M){const s={url:this.createURL(`/chains/${this.chain}/blocks/${n}/helpers/preapply/operations`),method:"POST"};return i!==void 0&&(s.query={version:i}),yield this.httpBackend.createRequest(s,r)})}getEntrypoints(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.validateContract(r),yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/entrypoints`),method:"GET"})})}runOperation(t){return x(this,arguments,void 0,function*(r,{block:n,version:i}=M){const s={url:this.createURL(`/chains/${this.chain}/blocks/${n}/helpers/scripts/run_operation`),method:"POST"};return i!==void 0&&(s.query={version:i}),yield this.httpBackend.createRequest(s,r)})}simulateOperation(t){return x(this,arguments,void 0,function*(r,{block:n,version:i}=M){const s={url:this.createURL(`/chains/${this.chain}/blocks/${n}/helpers/scripts/simulate_operation`),method:"POST"};return i!==void 0&&(s.query={version:i}),yield this.httpBackend.createRequest(s,r)})}runCode(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/helpers/scripts/run_code`),method:"POST"},r)})}runScriptView(t,r){return x(this,void 0,void 0,function*(){var{unparsing_mode:n="Readable"}=t,i=Jr(t,["unparsing_mode"]),s=r===void 0?M:r,o=s.block;return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${o}/helpers/scripts/run_script_view`),method:"POST"},Object.assign({unparsing_mode:n},i))})}runView(t,r){return x(this,void 0,void 0,function*(){var{unparsing_mode:n="Readable"}=t,i=Jr(t,["unparsing_mode"]),s=r===void 0?M:r,o=s.block;return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${o}/helpers/scripts/run_view`),method:"POST"},Object.assign({unparsing_mode:n},i))})}getChainId(){return x(this,void 0,void 0,function*(){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/chain_id`),method:"GET"})})}packData(t){return x(this,arguments,void 0,function*(r,{block:n}=M){const i=yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/helpers/scripts/pack_data`),method:"POST"},r),{gas:s}=i,o=Jr(i,["gas"]);let a=s;const c=new I(s||"");return c.isNaN()||(a=c),Object.assign({gas:a},o)})}getRpcUrl(){return this.url}getCurrentPeriod(){return x(this,arguments,void 0,function*({block:t}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/current_period`),method:"GET"})})}getSuccessorPeriod(){return x(this,arguments,void 0,function*({block:t}=M){return yield this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/votes/successor_period`),method:"GET"})})}getSaplingDiffById(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/sapling/${r}/get_diff`),method:"GET"})})}getSaplingDiffByContract(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/single_sapling_get_diff`),method:"GET"})})}getProtocols(){return x(this,arguments,void 0,function*({block:t}=M){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/protocols`),method:"GET"})})}getProtocolActivations(){return x(this,arguments,void 0,function*(t=""){if(t){const r=cl(t);if(r!==T.VALID)throw new ul(t,r)}return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/protocols/${t}`),method:"GET"})})}getStorageUsedSpace(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/storage/used_space`),method:"GET"})})}getStoragePaidSpace(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/storage/paid_space`),method:"GET"})})}getTicketBalance(t,r){return x(this,arguments,void 0,function*(n,i,{block:s}=M){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${s}/context/contracts/${n}/ticket_balance`),method:"POST"},i)})}getAllTicketBalances(t){return x(this,arguments,void 0,function*(r,{block:n}=M){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${n}/context/contracts/${r}/all_ticket_balances`),method:"GET"})})}getAdaptiveIssuanceLaunchCycle(){return x(this,arguments,void 0,function*({block:t}=M){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/blocks/${t}/context/adaptive_issuance_launch_cycle`),method:"GET"})})}getPendingOperations(){return x(this,arguments,void 0,function*(t={}){return this.httpBackend.createRequest({url:this.createURL(`/chains/${this.chain}/mempool/pending_operations`),method:"GET",query:t})})}}var Zi=function(e,t){return Zi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},Zi(e,t)};function Se(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Zi(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Ll(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(g){o(g)}}function c(l){try{u(n.throw(l))}catch(g){o(g)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})}function Ia(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function $r(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Rr(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function Or(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}function Hr(e){return this instanceof Hr?(this.v=e,this):new Hr(e)}function Nl(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(y){return function(v){return Promise.resolve(v).then(y,g)}}function a(y,v){n[y]&&(i[y]=function(P){return new Promise(function(O,S){s.push([y,P,O,S])>1||c(y,P)})},v&&(i[y]=v(i[y])))}function c(y,v){try{u(n[y](v))}catch(P){E(s[0][3],P)}}function u(y){y.value instanceof Hr?Promise.resolve(y.value.v).then(l,g):E(s[0][2],y)}function l(y){c("next",y)}function g(y){c("throw",y)}function E(y,v){y(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function xl(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof $r=="function"?$r(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=e[s]&&function(o){return new Promise(function(a,c){o=e[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function ht(e){return typeof e=="function"}function ri(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var Ti=ri(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function $n(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var mn=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=$r(o),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(P){t={error:P}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else o.remove(this);var l=this.initialTeardown;if(ht(l))try{l()}catch(P){s=P instanceof Ti?P.errors:[P]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var E=$r(g),y=E.next();!y.done;y=E.next()){var v=y.value;try{Co(v)}catch(P){s=s??[],P instanceof Ti?s=Or(Or([],Rr(s)),Rr(P.errors)):s.push(P)}}}catch(P){n={error:P}}finally{try{y&&!y.done&&(i=E.return)&&i.call(E)}finally{if(n)throw n.error}}}if(s)throw new Ti(s)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Co(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&$n(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&$n(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),La=mn.EMPTY;function Na(e){return e instanceof mn||e&&"closed"in e&&ht(e.remove)&&ht(e.add)&&ht(e.unsubscribe)}function Co(e){ht(e)?e():e.unsubscribe()}var kl={Promise:void 0},Ml={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,Or([e,t],Rr(r)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function xa(e){Ml.setTimeout(function(){throw e})}function Un(){}function kn(e){e()}var _s=function(e){Se(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Na(r)&&r.add(n)):n.destination=Cl,n}return t.create=function(r,n,i){return new cn(r,n,i)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(mn),Hl=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){An(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){An(n)}else An(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){An(r)}},e}(),cn=function(e){Se(t,e);function t(r,n,i){var s=e.call(this)||this,o;return ht(r)||!r?o={next:r??void 0,error:n??void 0,complete:i??void 0}:o=r,s.destination=new Hl(o),s}return t}(_s);function An(e){xa(e)}function Dl(e){throw e}var Cl={closed:!0,next:Un,error:Dl,complete:Un},bs=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function dr(e){return e}function Bl(e){return e.length===0?dr:e.length===1?e[0]:function(r){return e.reduce(function(n,i){return i(n)},r)}}var _t=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var i=this,s=Ul(t)?t:new cn(t,r,n);return kn(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=Bo(r),new r(function(i,s){var o=new cn({next:function(a){try{t(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});n.subscribe(o)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[bs]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Bl(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=Bo(t),new t(function(n,i){var s;r.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},e.create=function(t){return new e(t)},e}();function Bo(e){var t;return(t=e??kl.Promise)!==null&&t!==void 0?t:Promise}function $l(e){return e&&ht(e.next)&&ht(e.error)&&ht(e.complete)}function Ul(e){return e&&e instanceof _s||$l(e)&&Na(e)}function Gl(e){return ht(e?.lift)}function It(e){return function(t){if(Gl(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Pt(e,t,r,n,i){return new Kl(e,t,r,n,i)}var Kl=function(e){Se(t,e);function t(r,n,i,s,o,a){var c=e.call(this,r)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=n?function(u){try{n(u)}catch(l){r.error(l)}}:e.prototype._next,c._error=s?function(u){try{s(u)}catch(l){r.error(l)}finally{this.unsubscribe()}}:e.prototype._error,c._complete=i?function(){try{i()}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._complete,c}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(_s),jl=ri(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),yn=function(e){Se(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new $o(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new jl},t.prototype.next=function(r){var n=this;kn(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=$r(n.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(r)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},t.prototype.error=function(r){var n=this;kn(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},t.prototype.complete=function(){var r=this;kn(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?La:(this.currentObservers=null,a.push(r),new mn(function(){n.currentObservers=null,$n(a,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,s=n.thrownError,o=n.isStopped;i?r.error(s):o&&r.complete()},t.prototype.asObservable=function(){var r=new _t;return r.source=this,r},t.create=function(r,n){return new $o(r,n)},t}(_t),$o=function(e){Se(t,e);function t(r,n){var i=e.call(this)||this;return i.destination=r,i.source=n,i}return t.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},t.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:La},t}(yn),ni=function(e){Se(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,i=r.thrownError,s=r._value;if(n)throw i;return this._throwIfClosed(),s},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(yn),vs={now:function(){return(vs.delegate||Date).now()},delegate:void 0},Er=function(e){Se(t,e);function t(r,n,i){r===void 0&&(r=1/0),n===void 0&&(n=1/0),i===void 0&&(i=vs);var s=e.call(this)||this;return s._bufferSize=r,s._windowTime=n,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=n===1/0,s._bufferSize=Math.max(1,r),s._windowTime=Math.max(1,n),s}return t.prototype.next=function(r){var n=this,i=n.isStopped,s=n._buffer,o=n._infiniteTimeWindow,a=n._timestampProvider,c=n._windowTime;i||(s.push(r),!o&&s.push(a.now()+c)),this._trimBuffer(),e.prototype.next.call(this,r)},t.prototype._subscribe=function(r){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(r),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!r.closed;c+=s?1:2)r.next(a[c]);return this._checkFinalizedStatuses(r),n},t.prototype._trimBuffer=function(){var r=this,n=r._bufferSize,i=r._timestampProvider,s=r._buffer,o=r._infiniteTimeWindow,a=(o?1:2)*n;if(n<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),u=0,l=1;l<s.length&&s[l]<=c;l+=2)u=l;u&&s.splice(0,u+1)}},t}(yn),Fl=function(e){Se(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(mn),Uo={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setInterval.apply(void 0,Or([e,t],Rr(r)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},Vl=function(e){Se(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.scheduler=r,i.work=n,i.pending=!1,i}return t.prototype.schedule=function(r,n){var i;if(n===void 0&&(n=0),this.closed)return this;this.state=r;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,n)),this.pending=!0,this.delay=n,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,n),this},t.prototype.requestAsyncId=function(r,n,i){return i===void 0&&(i=0),Uo.setInterval(r.flush.bind(r,this),i)},t.prototype.recycleAsyncId=function(r,n,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return n;n!=null&&Uo.clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(r,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var i=!1,s;try{this.work(r)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},t.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,i=r.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,$n(s,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Fl),Go=function(){function e(t,r){r===void 0&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,t).schedule(n,r)},e.now=vs.now,e}(),Zl=function(e){Se(t,e);function t(r,n){n===void 0&&(n=Go.now);var i=e.call(this,r,n)||this;return i.actions=[],i._active=!1,i}return t.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var i;this._active=!0;do if(i=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,i){for(;r=n.shift();)r.unsubscribe();throw i}},t}(Go),ka=new Zl(Vl),zl=ka,As=new _t(function(e){return e.complete()});function Ma(e){return e&&ht(e.schedule)}function Ha(e){return e[e.length-1]}function Wl(e){return ht(Ha(e))?e.pop():void 0}function ii(e){return Ma(Ha(e))?e.pop():void 0}var Da=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Ca(e){return ht(e?.then)}function Ba(e){return ht(e[bs])}function $a(e){return Symbol.asyncIterator&&ht(e?.[Symbol.asyncIterator])}function Ua(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Jl(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ga=Jl();function Ka(e){return ht(e?.[Ga])}function ja(e){return Nl(this,arguments,function(){var r,n,i,s;return Ia(this,function(o){switch(o.label){case 0:r=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Hr(r.read())];case 3:return n=o.sent(),i=n.value,s=n.done,s?[4,Hr(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Hr(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function Fa(e){return ht(e?.getReader)}function Wt(e){if(e instanceof _t)return e;if(e!=null){if(Ba(e))return ql(e);if(Da(e))return Yl(e);if(Ca(e))return Xl(e);if($a(e))return Va(e);if(Ka(e))return Ql(e);if(Fa(e))return th(e)}throw Ua(e)}function ql(e){return new _t(function(t){var r=e[bs]();if(ht(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Yl(e){return new _t(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function Xl(e){return new _t(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,xa)})}function Ql(e){return new _t(function(t){var r,n;try{for(var i=$r(e),s=i.next();!s.done;s=i.next()){var o=s.value;if(t.next(o),t.closed)return}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}t.complete()})}function Va(e){return new _t(function(t){eh(e,t).catch(function(r){return t.error(r)})})}function th(e){return Va(ja(e))}function eh(e,t){var r,n,i,s;return Ll(this,void 0,void 0,function(){var o,a;return Ia(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=xl(e),c.label=1;case 1:return[4,r.next()];case 2:if(n=c.sent(),!!n.done)return[3,4];if(o=n.value,t.next(o),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(s=r.return)?[4,s.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function Ke(e,t,r,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var s=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!i)return s}function Za(e,t){return t===void 0&&(t=0),It(function(r,n){r.subscribe(Pt(n,function(i){return Ke(n,e,function(){return n.next(i)},t)},function(){return Ke(n,e,function(){return n.complete()},t)},function(i){return Ke(n,e,function(){return n.error(i)},t)}))})}function za(e,t){return t===void 0&&(t=0),It(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function rh(e,t){return Wt(e).pipe(za(t),Za(t))}function nh(e,t){return Wt(e).pipe(za(t),Za(t))}function ih(e,t){return new _t(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function sh(e,t){return new _t(function(r){var n;return Ke(r,t,function(){n=e[Ga](),Ke(r,t,function(){var i,s,o;try{i=n.next(),s=i.value,o=i.done}catch(a){r.error(a);return}o?r.complete():r.next(s)},0,!0)}),function(){return ht(n?.return)&&n.return()}})}function Wa(e,t){if(!e)throw new Error("Iterable cannot be null");return new _t(function(r){Ke(r,t,function(){var n=e[Symbol.asyncIterator]();Ke(r,t,function(){n.next().then(function(i){i.done?r.complete():r.next(i.value)})},0,!0)})})}function oh(e,t){return Wa(ja(e),t)}function ah(e,t){if(e!=null){if(Ba(e))return rh(e,t);if(Da(e))return ih(e,t);if(Ca(e))return nh(e,t);if($a(e))return Wa(e,t);if(Ka(e))return sh(e,t);if(Fa(e))return oh(e,t)}throw Ua(e)}function pr(e,t){return t?ah(e,t):Wt(e)}function si(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=ii(e);return pr(e,r)}function Ja(e,t){var r=ht(e)?e:function(){return e},n=function(i){return i.error(r())};return new _t(n)}var qa=ri(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function Ya(e){return e instanceof Date&&!isNaN(e)}var ch=ri(function(e){return function(r){r===void 0&&(r=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=r}});function Xa(e,t){var r=Ya(e)?{first:e}:typeof e=="number"?{each:e}:e,n=r.first,i=r.each,s=r.with,o=s===void 0?uh:s,a=r.scheduler,c=a===void 0?ka:a,u=r.meta,l=u===void 0?null:u;if(n==null&&i==null)throw new TypeError("No timeout provided.");return It(function(g,E){var y,v,P=null,O=0,S=function(A){v=Ke(E,c,function(){try{y.unsubscribe(),Wt(o({meta:l,lastValue:P,seen:O})).subscribe(E)}catch(Z){E.error(Z)}},A)};y=g.subscribe(Pt(E,function(A){v?.unsubscribe(),O++,E.next(P=A),i>0&&S(i)},void 0,void 0,function(){v?.closed||v?.unsubscribe(),P=null})),!O&&S(n!=null?typeof n=="number"?n:+n-c.now():i)})}function uh(e){throw new ch(e)}function nr(e,t){return It(function(r,n){var i=0;r.subscribe(Pt(n,function(s){n.next(e.call(t,s,i++))}))})}var lh=Array.isArray;function hh(e,t){return lh(t)?e.apply(void 0,Or([],Rr(t))):e(t)}function dh(e){return nr(function(t){return hh(e,t)})}var ph=Array.isArray,fh=Object.getPrototypeOf,gh=Object.prototype,mh=Object.keys;function yh(e){if(e.length===1){var t=e[0];if(ph(t))return{args:t,keys:null};if(Eh(t)){var r=mh(t);return{args:r.map(function(n){return t[n]}),keys:r}}}return{args:e,keys:null}}function Eh(e){return e&&typeof e=="object"&&fh(e)===gh}function _h(e,t){return e.reduce(function(r,n,i){return r[n]=t[i],r},{})}function Ko(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=ii(e),n=Wl(e),i=yh(e),s=i.args,o=i.keys;if(s.length===0)return pr([],r);var a=new _t(bh(s,r,o?function(c){return _h(o,c)}:dr));return n?a.pipe(dh(n)):a}function bh(e,t,r){return r===void 0&&(r=dr),function(n){jo(t,function(){for(var i=e.length,s=new Array(i),o=i,a=i,c=function(l){jo(t,function(){var g=pr(e[l],t),E=!1;g.subscribe(Pt(n,function(y){s[l]=y,E||(E=!0,a--),a||n.next(r(s.slice()))},function(){--o||n.complete()}))},n)},u=0;u<i;u++)c(u)},n)}}function jo(e,t,r){e?Ke(r,e,t):t()}function vh(e,t,r,n,i,s,o,a){var c=[],u=0,l=0,g=!1,E=function(){g&&!c.length&&!u&&t.complete()},y=function(P){return u<n?v(P):c.push(P)},v=function(P){u++;var O=!1;Wt(r(P,l++)).subscribe(Pt(t,function(S){t.next(S)},function(){O=!0},void 0,function(){if(O)try{u--;for(var S=function(){var A=c.shift();o||v(A)};c.length&&u<n;)S();E()}catch(A){t.error(A)}}))};return e.subscribe(Pt(t,y,function(){g=!0,E()})),function(){}}function un(e,t,r){return r===void 0&&(r=1/0),ht(t)?un(function(n,i){return nr(function(s,o){return t(n,s,i,o)})(Wt(e(n,i)))},r):(typeof t=="number"&&(r=t),It(function(n,i){return vh(n,i,e,r)}))}function Ah(e){return un(dr,e)}function Sh(){return Ah(1)}function Gn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Sh()(pr(e,ii(e)))}function Qa(e){return new _t(function(t){Wt(e()).subscribe(t)})}function zi(e,t,r){e===void 0&&(e=0),r===void 0&&(r=zl);var n=-1;return t!=null&&(Ma(t)?r=t:n=t),new _t(function(i){var s=Ya(e)?+e-r.now():e;s<0&&(s=0);var o=0;return r.schedule(function(){i.closed||(i.next(o++),0<=n?this.schedule(void 0,n):i.complete())},s)})}var Ph=new _t(Un);function Wi(e,t){return It(function(r,n){var i=0;r.subscribe(Pt(n,function(s){return e.call(t,s,i++)&&n.next(s)}))})}function Ss(e,t,r){if(t==null&&(t=e,e=0),t<=0)return As;var n=t+e;return new _t(function(i){for(var s=e;s<n&&!i.closed;)i.next(s++);i.complete()})}function oi(e){return It(function(t,r){var n=null,i=!1,s;n=t.subscribe(Pt(r,void 0,void 0,function(o){s=Wt(e(o,oi(e)(t))),n?(n.unsubscribe(),n=null,s.subscribe(r)):i=!0})),i&&(n.unsubscribe(),n=null,s.subscribe(r))})}function En(e,t){return ht(t)?un(e,t,1):un(e,1)}function Rh(e){return It(function(t,r){var n=!1;t.subscribe(Pt(r,function(i){n=!0,r.next(i)},function(){n||r.next(e),r.complete()}))})}function Oh(e){return e<=0?function(){return As}:It(function(t,r){var n=0;t.subscribe(Pt(r,function(i){++n<=e&&(r.next(i),e<=n&&r.complete())}))})}function tc(e,t){return t===void 0&&(t=dr),e=e??wh,It(function(r,n){var i,s=!0;r.subscribe(Pt(n,function(o){var a=t(o);(s||!e(i,a))&&(s=!1,i=a,n.next(o))}))})}function wh(e,t){return e===t}function Th(e,t){return tc(function(r,n){return r[e]===n[e]})}function Ih(e){return e===void 0&&(e=Lh),It(function(t,r){var n=!1;t.subscribe(Pt(r,function(i){n=!0,r.next(i)},function(){return n?r.complete():r.error(e())}))})}function Lh(){return new qa}function ec(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(r){return Gn(r,si.apply(void 0,Or([],Rr(e))))}}function Me(e,t){var r=arguments.length>=2;return function(n){return n.pipe(dr,Oh(1),r?Rh(t):Ih(function(){return new qa}))}}function rc(e){e===void 0&&(e=1/0);var t;e&&typeof e=="object"?t=e:t={count:e};var r=t.count,n=r===void 0?1/0:r,i=t.delay,s=t.resetOnSuccess,o=s===void 0?!1:s;return n<=0?dr:It(function(a,c){var u=0,l,g=function(){var E=!1;l=a.subscribe(Pt(c,function(y){o&&(u=0),c.next(y)},void 0,function(y){if(u++<n){var v=function(){l?(l.unsubscribe(),l=null,g()):E=!0};if(i!=null){var P=typeof i=="number"?zi(i):Wt(i(y,u)),O=Pt(c,function(){O.unsubscribe(),v()},function(){c.complete()});P.subscribe(O)}else v()}else c.error(y)})),E&&(l.unsubscribe(),l=null,g())};g()})}function ln(e){e===void 0&&(e={});var t=e.connector,r=t===void 0?function(){return new yn}:t,n=e.resetOnError,i=n===void 0?!0:n,s=e.resetOnComplete,o=s===void 0?!0:s,a=e.resetOnRefCountZero,c=a===void 0?!0:a;return function(u){var l,g,E,y=0,v=!1,P=!1,O=function(){g?.unsubscribe(),g=void 0},S=function(){O(),l=E=void 0,v=P=!1},A=function(){var Z=l;S(),Z?.unsubscribe()};return It(function(Z,nt){y++,!P&&!v&&O();var Nt=E=E??r();nt.add(function(){y--,y===0&&!P&&!v&&(g=Ii(A,c))}),Nt.subscribe(nt),!l&&y>0&&(l=new cn({next:function(X){return Nt.next(X)},error:function(X){P=!0,O(),g=Ii(S,i,X),Nt.error(X)},complete:function(){v=!0,O(),g=Ii(S,o),Nt.complete()}}),Wt(Z).subscribe(l))})(u)}}function Ii(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(t===!0){e();return}if(t!==!1){var i=new cn({next:function(){i.unsubscribe(),e()}});return Wt(t.apply(void 0,Or([],Rr(r)))).subscribe(i)}}function Fo(e,t,r){var n,i,s,o,a=!1;return e&&typeof e=="object"?(n=e.bufferSize,o=n===void 0?1/0:n,i=e.windowTime,t=i===void 0?1/0:i,s=e.refCount,a=s===void 0?!1:s,r=e.scheduler):o=e??1/0,ln({connector:function(){return new Er(o,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function Nh(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=ii(e);return It(function(n,i){(r?Gn(e,n,r):Gn(e,n)).subscribe(i)})}function $e(e,t){return It(function(r,n){var i=null,s=0,o=!1,a=function(){return o&&!i&&n.complete()};r.subscribe(Pt(n,function(c){i?.unsubscribe();var u=0,l=s++;Wt(e(c,l)).subscribe(i=Pt(n,function(g){return n.next(t?t(c,g,l,u++):g)},function(){i=null,a()}))},function(){o=!0,a()}))})}function xh(e){return It(function(t,r){Wt(e).subscribe(Pt(r,function(){return r.complete()},Un)),!r.closed&&t.subscribe(r)})}function kh(e,t){return It(function(r,n){var i=0;r.subscribe(Pt(n,function(s){var o=e(s,i++);(o||t)&&n.next(s),!o&&n.complete()}))})}function Kn(e,t,r){var n=ht(e)||t||r?{next:e,error:t,complete:r}:e;return n?It(function(i,s){var o;(o=n.subscribe)===null||o===void 0||o.call(n);var a=!0;i.subscribe(Pt(s,function(c){var u;(u=n.next)===null||u===void 0||u.call(n,c),s.next(c)},function(){var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),s.complete()},function(c){var u;a=!1,(u=n.error)===null||u===void 0||u.call(n,c),s.error(c)},function(){var c,u;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(u=n.finalize)===null||u===void 0||u.call(n)}))}):dr}var Li,Vo;function Mh(){return Vo||(Vo=1,Li=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var r=typeof t.cycles=="boolean"?t.cycles:!1,n=t.cmp&&function(s){return function(o){return function(a,c){var u={key:a,value:o[a]},l={key:c,value:o[c]};return s(u,l)}}}(t.cmp),i=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,c;if(Array.isArray(o)){for(c="[",a=0;a<o.length;a++)a&&(c+=","),c+=s(o[a])||"null";return c+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=i.push(o)-1,l=Object.keys(o).sort(n&&n(o));for(c="",a=0;a<l.length;a++){var g=l[a],E=s(o[g]);E&&(c&&(c+=","),c+=JSON.stringify(g)+":"+E)}return i.splice(u,1),"{"+c+"}"}}(e)}),Li}var Hh=Mh();const Dh=ll(Hh);var nc;class qr extends at{constructor(t,r){super(),this.mapType=t,this.reason=r,this.message=`The map type '${JSON.stringify(t)}' is invalid. Reason: ${r}.`,this.name="InvalidMapTypeError"}}const ic=Symbol.for("taquito-michelson-map-type-symbol");function Ch(e){if(!("prim"in e))throw new qr(e,"Missing 'prim' field");if(!["map","big_map"].includes(e.prim))throw new qr(e,"The prim field should be 'map' or 'big_map'");if(!("args"in e))throw new qr(e,"Missing 'args' field");if(!Array.isArray(e.args))throw new qr(e,"The 'args' field should be an array");if(e.args.length!==2)throw new qr(e,"The 'args' field should have 2 elements")}class Zo extends at{constructor(t,r,n,i){super(),this.value=t,this.type=r,this.reason=i,this.name="MapTypecheckError",this.message=`The ${n} provided: ${JSON.stringify(t)} is not compatible with the expected michelson type: ${JSON.stringify(r)}. Reason: ${JSON.stringify(i)}.`,this.name="MapTypecheckError"}}class Gt{static isMichelsonMap(t){return t&&t[ic]===!0}constructor(t){this.valueMap=new Map,this.keyMap=new Map,this[nc]=!0,t&&this.setType(t)}setType(t){Ch(t),this.keySchema=new Zt(t.args[0]),this.valueSchema=new Zt(t.args[1])}removeType(){this.keySchema=void 0,this.valueSchema=void 0}static fromLiteral(t,r){const n=new Gt(r);return Object.keys(t).forEach(i=>{n.set(i,t[i])}),n}typecheckKey(t){this.keySchema&&this.keySchema.Typecheck(t)}typecheckValue(t){this.valueSchema&&this.valueSchema.Typecheck(t)}assertTypecheckValue(t){try{this.typecheckValue(t)}catch(r){throw new Zo(t,this.valueSchema,"value",r)}}assertTypecheckKey(t){try{this.typecheckKey(t)}catch(r){throw new Zo(t,this.keySchema,"key",r)}}serializeDeterministically(t){return Dh(t)}*keys(){for(const[t]of this.entries())yield t}*values(){for(const[,t]of this.entries())yield t}*entries(){for(const t of this.valueMap.keys())yield[this.keyMap.get(t),this.valueMap.get(t)]}get(t){this.assertTypecheckKey(t);const r=this.serializeDeterministically(t);return this.valueMap.get(r)}set(t,r){this.assertTypecheckKey(t),this.assertTypecheckValue(r);const n=this.serializeDeterministically(t);this.keyMap.set(n,t),this.valueMap.set(n,r)}delete(t){this.assertTypecheckKey(t),this.keyMap.delete(this.serializeDeterministically(t)),this.valueMap.delete(this.serializeDeterministically(t))}has(t){this.assertTypecheckKey(t);const r=this.serializeDeterministically(t);return this.keyMap.has(r)&&this.valueMap.has(r)}clear(){this.keyMap.clear(),this.valueMap.clear()}get size(){return this.keyMap.size}forEach(t){for(const[r,n]of this.entries())t(n,r,this)}}nc=ic;class rt extends at{constructor(t,r,n){super(),this.value=t,this.token=r,this.name="TokenValidationError";const i=this.token.annot(),s=i?`[${i}] `:"";this.message=`${s}${n}`}}class st{static get fieldNumberingStrategy(){return st._fieldNumberingStrategy}static set fieldNumberingStrategy(t){st._fieldNumberingStrategy=t}constructor(t,r,n,i){this.val=t,this.idx=r,this.fac=n,this.parentTokenType=i,this.createToken=this.fac}typeWithoutAnnotations(){const t=n=>{if(typeof n=="object"){if(Array.isArray(n))return n.map(o=>t(o));const i=n;return i.args?{prim:i.prim,args:i.args.map(s=>t(s))}:{prim:i.prim}}return n};return(n=>n.args?{prim:n.prim,args:n.args.map(i=>t(i))}:{prim:n.prim})(this.val)}annot(){return(Array.isArray(this.val.annots)&&this.val.annots.length>0?this.val.annots[0]:String(this.idx)).replace(/(%|:)(_Liq_entry_)?/,"")}hasAnnotations(){return Array.isArray(this.val.annots)&&this.val.annots.length}get tokenVal(){return this.val}ExtractSignature(){return[[this.ExtractSchema()]]}}st._fieldNumberingStrategy="Latest";class yt extends st{compare(t,r){return t<r?-1:t>r?1:0}}class zo extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="BigMapValidationError"}}class Vt extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}ExtractSchema(){return{big_map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:Vt.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}validate(t){if(!Gt.isMichelsonMap(t))throw new zo(t,this,`Value ${JSON.stringify(t)} is not a MichelsonMap`)}objLitToMichelsonMap(t){return t instanceof Gt?t:typeof t=="object"?Object.keys(t).length===0?new Gt:Gt.fromLiteral(t):t}Encode(t){const r=this.objLitToMichelsonMap(t.pop());return this.validate(r),Array.from(r.keys()).sort((n,i)=>this.KeySchema.compare(n,i)).map(n=>({prim:"Elt",args:[this.KeySchema.EncodeObject(n),this.ValueSchema.EncodeObject(r.get(n))]}))}EncodeObject(t,r){const n=this.objLitToMichelsonMap(t);return this.validate(n),r&&r[Vt.prim]?r[Vt.prim](n,this.val):Array.from(n.keys()).sort((i,s)=>this.KeySchema.compare(i,s)).map(i=>({prim:"Elt",args:[this.KeySchema.EncodeObject(i),this.ValueSchema.EncodeObject(n.get(i))]}))}Execute(t,r){if(r&&r[Vt.prim])return r[Vt.prim](t,this.val);if(Array.isArray(t)){const n=new Gt(this.val);return t.forEach(i=>{n.set(this.KeySchema.ToKey(i.args[0]),this.ValueSchema.Execute(i.args[1]))}),n}else{if("int"in t)return t.int;throw new zo(t,this,`Big map is expecting either an array (Athens) or an object with an int property (Babylon). Got ${JSON.stringify(t)}`)}}findAndReturnTokens(t,r){return Vt.prim===t&&r.push(this),this.KeySchema.findAndReturnTokens(t,r),this.ValueSchema.findAndReturnTokens(t,r),r}}Vt.prim="big_map";class Wo extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="OrValidationError"}}class J extends yt{constructor(t,r,n,i){super(t,r,n,i),this.val=t,this.idx=r,this.fac=n,this.parentTokenType=i}Encode(t){const r=t[t.length-1],n=this.createToken(this.val.args[0],this.getIdxForChildren(),"Or");let i=1;n instanceof J&&(i=Object.keys(n.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.getIdxForChildren()+i,"Or");if(String(n.annot())===String(r)&&!(n instanceof J))return t.pop(),{prim:"Left",args:[n.Encode(t)]};if(String(s.annot())===String(r)&&!(s instanceof J))return t.pop(),{prim:"Right",args:[s.Encode(t)]};if(n instanceof J){const o=n.Encode(t);if(o)return{prim:"Left",args:[o]}}if(s instanceof J){const o=s.Encode(t);if(o)return{prim:"Right",args:[o]}}return null}ExtractSignature(){const t=this.createToken(this.val.args[0],this.getIdxForChildren(),"Or");let r=1;t instanceof J&&(r=Object.keys(t.ExtractSchema()).length);const n=this.createToken(this.val.args[1],this.getIdxForChildren()+r,"Or"),i=[];if(t instanceof J)i.push(...t.ExtractSignature());else for(const s of t.ExtractSignature())i.push([t.annot(),...s]);if(n instanceof J)i.push(...n.ExtractSignature());else for(const s of n.ExtractSignature())i.push([n.annot(),...s]);return i}EncodeObject(t,r){this.validateJavascriptObject(t);const n=Object.keys(t)[0],i=this.createToken(this.val.args[0],this.getIdxForChildren(),"Or");let s=1;i instanceof J&&(s=Object.keys(i.ExtractSchema()).length);const o=this.createToken(this.val.args[1],this.getIdxForChildren()+s,"Or");if(String(i.annot())===String(n)&&!(i instanceof J))return{prim:"Left",args:[i.EncodeObject(t[n],r)]};if(String(o.annot())===String(n)&&!(o instanceof J))return{prim:"Right",args:[o.EncodeObject(t[n],r)]};if(i instanceof J){const a=i.EncodeObject(t,r);if(a)return{prim:"Left",args:[a]}}if(o instanceof J){const a=o.EncodeObject(t,r);if(a)return{prim:"Right",args:[a]}}return null}validateJavascriptObject(t){if(typeof t!="object"||Array.isArray(t)||t===null||Object.keys(t).length!==1)throw new Wo(t,this,`EncodeObject expects an object with a single key but got: ${JSON.stringify(t)}`)}Execute(t,r){const n=this.createToken(this.val.args[0],this.getIdxForChildren(),"Or");let i=1;n instanceof J&&(i=Object.keys(n.ExtractSchema()).length);const s=this.createToken(this.val.args[1],this.getIdxForChildren()+i,"Or");if(t.prim==="Right")return s instanceof J?s.Execute(t.args[0],r):{[s.annot()]:s.Execute(t.args[0],r)};if(t.prim==="Left")return n instanceof J?n.Execute(t.args[0],r):{[n.annot()]:n.Execute(t.args[0],r)};throw new Wo(t,this,`Was expecting Left or Right prim but got: ${JSON.stringify(t.prim)}`)}traversal(t,r,n){const i=this.createToken(this.val.args[0],this.getIdxForChildren(),"Or");let s=1,o;i instanceof J?(o=t(i),s=Object.keys(i.ExtractSchema()).length):o={[i.annot()]:t(i)};const a=this.createToken(this.val.args[1],this.getIdxForChildren()+s,"Or");let c;return a instanceof J?c=r(a):c={[a.annot()]:r(a)},n(o,c)}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema(),(t,r)=>Object.assign(Object.assign({},t),r))}generateSchema(){return{__michelsonType:J.prim,schema:this.traversal(t=>t instanceof J?t.generateSchema().schema:t.generateSchema(),t=>t instanceof J?t.generateSchema().schema:t.generateSchema(),(t,r)=>Object.assign(Object.assign({},t),r))}}findToken(t){const r=this.createToken(this.val.args[0],this.getIdxForChildren(),"Or");let n=1;r instanceof J&&(n=Object.keys(r.ExtractSchema()).length);const i=this.createToken(this.val.args[1],this.getIdxForChildren()+n,"Or");if(String(r.annot())===String(t)&&!(r instanceof J)&&r instanceof yt)return r;if(String(i.annot())===String(t)&&!(i instanceof J)&&i instanceof yt)return i;if(r instanceof J){const s=r.findToken(t);if(s)return s}if(i instanceof J){const s=i.findToken(t);if(s)return s}return null}compare(t,r){const n=Object.keys(t)[0],i=Object.keys(r)[0];if(n===i){const s=this.findToken(n);if(s instanceof yt)return s.compare(t[n],r[n])}else{const s=JSON.stringify(this.EncodeObject(t)),o=JSON.stringify(this.EncodeObject(r));return s<o?-1:1}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,r){return J.prim===t&&r.push(this),this.traversal(n=>n.findAndReturnTokens(t,r),n=>n.findAndReturnTokens(t,r),(n,i)=>Object.assign(Object.assign({},n),i)),r}getIdxForChildren(){return st.fieldNumberingStrategy==="Legacy"?this.idx:this.parentTokenType==="Or"?this.idx:0}}J.prim="or";class Bh extends at{constructor(t){super(t),this.message=t,this.name="TokenArgumentValidationError"}}class $h extends at{constructor(t,r){super(),this.val1=t,this.val2=r,this.name="TokenComparisonError",this.message=`Tokens ${JSON.stringify(t)} and ${JSON.stringify(r)} are not comparable`}}function Ji(e,t=bt.prim){if(Array.isArray(e))return Ji({prim:t,args:e},t);if(e.args===void 0)throw new Bh(`The value ${JSON.stringify(e)} is an invalid PairToken with no arguments, a pair must have two or more arguments.`);return e.args.length>2?[e.args[0],{prim:t,args:e.args.slice(1)}]:[e.args[0],e.args[1]]}class bt extends yt{constructor(t,r,n,i){super(Array.isArray(t)?{prim:bt.prim,args:t}:t.prim?t:{prim:bt.prim,args:t},r,n,i)}args(){return Ji(this.val)}tokens(){let t=0;return this.args().map(r=>{const n=this.createToken(r,this.getIdxForChildren()+t,"Pair");return n instanceof bt?t+=Object.keys(n.ExtractSchema()).length:t++,n})}Encode(t){return{prim:"Pair",args:this.tokens().map(r=>r.Encode(t))}}ExtractSignature(){const t=this.args(),r=this.createToken(t[0],this.getIdxForChildren(),"Pair");let n=1;r instanceof J&&(n=Object.keys(r.ExtractSchema()).length);const i=this.createToken(t[1],this.getIdxForChildren()+n,"Pair"),s=[];for(const o of r.ExtractSignature())for(const a of i.ExtractSignature())s.push([...o,...a]);return s}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}ToKey(t){return this.Execute(t)}EncodeObject(t,r){const[n,i]=this.tokens();let s;n instanceof bt&&!n.hasAnnotations()?s=t:s=t[n.annot()];let o;return i instanceof bt&&!i.hasAnnotations()?o=t:o=t[i.annot()],{prim:"Pair",args:[n.EncodeObject(s,r),i.EncodeObject(o,r)]}}traversal(t,r){const n=this.args(),i=this.createToken(n[0],this.getIdxForChildren(),"Pair");let s=1,o;i instanceof bt&&!i.hasAnnotations()?(o=t(i),i instanceof bt&&(s=Object.keys(i.ExtractSchema()).length)):o={[i.annot()]:t(i)};const a=this.createToken(n[1],this.getIdxForChildren()+s,"Pair");let c;return a instanceof bt&&!a.hasAnnotations()?c=r(a):c={[a.annot()]:r(a)},Object.assign(Object.assign({},o),c)}Execute(t,r){const n=Ji(t,"Pair");return this.traversal(i=>i.Execute(n[0],r),i=>i.Execute(n[1],r))}ExtractSchema(){return this.traversal(t=>t.ExtractSchema(),t=>t.ExtractSchema())}generateSchema(){return{__michelsonType:bt.prim,schema:this.traversal(t=>t instanceof bt&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema(),t=>t instanceof bt&&!t.hasAnnotations()?t.generateSchema().schema:t.generateSchema())}}compare(t,r){const[n,i]=this.tokens(),s=(o,a)=>o instanceof bt&&!o.hasAnnotations()?a:a[o.annot()];if(n instanceof yt&&i instanceof yt){const o=n.compare(s(n,t),s(n,r));return o===0?i.compare(s(i,t),s(i,r)):o}throw new $h(t,r)}findAndReturnTokens(t,r){return bt.prim===t&&r.push(this),this.tokens().map(n=>n.findAndReturnTokens(t,r)),r}getIdxForChildren(){return st.fieldNumberingStrategy==="Legacy"?this.idx:this.parentTokenType==="Pair"?this.idx:0}}bt.prim="pair";class Jo extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="NatValidationError"}}class ie extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){return new I(t[Object.keys(t)[0]])}Encode(t){const r=t.pop();return this.validate(r),{int:new I(r).toFixed()}}validate(t){const r=new I(t);if(r.isNaN())throw new Jo(t,this,`Value is not a number: ${JSON.stringify(t)}`);if(r.isNegative())throw new Jo(t,this,`Value cannot be negative: ${JSON.stringify(t)}`)}EncodeObject(t,r){return this.validate(t),r&&r[ie.prim]?r[ie.prim](t):{int:new I(t).toFixed()}}ExtractSchema(){return ie.prim}generateSchema(){return{__michelsonType:ie.prim,schema:ie.prim}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:ie.prim}}}ToKey({int:t}){return new I(t)}compare(t,r){const n=Number(t),i=Number(r);return n===i?0:n<i?-1:1}findAndReturnTokens(t,r){return ie.prim===t&&r.push(this),r}}ie.prim="nat";class se extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return se.prim}generateSchema(){return{__michelsonType:se.prim,schema:se.prim}}Encode(t){return{string:t.pop()}}EncodeObject(t,r){return r&&r[se.prim]?r[se.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:se.prim}}}findAndReturnTokens(t,r){return se.prim===t&&r.push(this),r}}se.prim="string";class Sn extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="AddressValidationError"}}class Oe extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}ToBigMapKey(t){return{key:{bytes:rn(t)},type:{prim:"bytes"}}}validate(t){if(typeof t!="string")throw new Sn(t,this,"Type error");if(K(t)!==T.VALID)throw new Sn(t,this,`Address is not valid: ${JSON.stringify(t)}`)}Encode(t){const r=t.pop();return this.validate(r),{string:r}}EncodeObject(t,r){return this.validate(t),r&&r[Oe.prim]?r[Oe.prim](t):{string:t}}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Sn(t,this,`cannot be missing both string and bytes: ${JSON.stringify(t)}`);return Gi(t.bytes)}ExtractSchema(){return Oe.prim}generateSchema(){return{__michelsonType:Oe.prim,schema:Oe.prim}}ToKey({bytes:t,string:r}){if(r)return r;if(!t)throw new Sn({bytes:t,string:r},this,`cannot be missing both string and bytes ${JSON.stringify({string:r,bytes:t})}`);return Gi(t)}compare(t,r){const[n,i]=So(t),[s,o]=So(r),a=i||"",c=o||"",u=rn(n,"array"),l=rn(s,"array"),g=fs(u,l);return g===0?a<c?-1:a>c?1:0:g}findAndReturnTokens(t,r){return Oe.prim===t&&r.push(this),r}}Oe.prim="address";class Uh extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="MapValidationError"}}class er extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}get ValueSchema(){return this.createToken(this.val.args[1],0)}get KeySchema(){return this.createToken(this.val.args[0],0)}validate(t){if(!Gt.isMichelsonMap(t))throw new Uh(t,this,`Value ${JSON.stringify(t)} is not a valid MichelsonMap`)}Execute(t,r){const n=new Gt(this.val);return t.forEach(i=>{n.set(this.KeySchema.ToKey(i.args[0]),this.ValueSchema.Execute(i.args[1],r))}),n}objLitToMichelsonMap(t){return t instanceof Gt?t:typeof t=="object"?Object.keys(t).length===0?new Gt:Gt.fromLiteral(t):t}Encode(t){const r=this.objLitToMichelsonMap(t.pop());return this.validate(r),Array.from(r.keys()).sort((n,i)=>this.KeySchema.compare(n,i)).map(n=>({prim:"Elt",args:[this.KeySchema.EncodeObject(n),this.ValueSchema.EncodeObject(r.get(n))]}))}EncodeObject(t,r){const n=this.objLitToMichelsonMap(t);return this.validate(n),r&&r[er.prim]?r[er.prim](n):Array.from(n.keys()).sort((i,s)=>this.KeySchema.compare(i,s)).map(i=>({prim:"Elt",args:[this.KeySchema.EncodeObject(i),this.ValueSchema.EncodeObject(n.get(i))]}))}ExtractSchema(){return{map:{key:this.KeySchema.ExtractSchema(),value:this.ValueSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:er.prim,schema:{key:this.KeySchema.generateSchema(),value:this.ValueSchema.generateSchema()}}}findAndReturnTokens(t,r){return er.prim===t&&r.push(this),this.KeySchema.findAndReturnTokens(t,r),this.ValueSchema.findAndReturnTokens(t,r),r}}er.prim="map";class oe extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){return String(t.prim).toLowerCase()==="true"}Encode(t){return{prim:t.pop()?"True":"False"}}EncodeObject(t,r){return r&&r[oe.prim]?r[oe.prim](t):{prim:t?"True":"False"}}ExtractSchema(){return oe.prim}generateSchema(){return{__michelsonType:oe.prim,schema:oe.prim}}ToBigMapKey(t){return{key:this.EncodeObject(t),type:{prim:oe.prim}}}ToKey(t){return this.EncodeObject(t)}compare(t,r){return t&&r||!t&&!r?0:t?1:-1}findAndReturnTokens(t,r){return oe.prim===t&&r.push(this),r}}oe.prim="bool";class Ni extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="ContractValidationError"}}class Kt extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}validate(t){if(typeof t!="string")throw new Ni(t,this,"Type error");if(K(t)!==T.VALID)throw new Ni(t,this,`Value ${JSON.stringify(t)} is not a valid contract address.`);return null}Execute(t){if(t.string)return t.string;if(!t.bytes)throw new Ni(t,this,`Value ${JSON.stringify(t)} is not a valid contract address. must contain bytes or string.`);return Gi(t.bytes)}Encode(t){const r=t.pop();return this.validate(r),{string:r}}EncodeObject(t,r){return this.validate(t),r&&r[Kt.prim]?r[Kt.prim](t):{string:t}}ExtractSchema(){return Kt.prim}generateSchema(){const t=this.createToken(this.val.args[0],0);return{__michelsonType:Kt.prim,schema:{parameter:this.val.args[0]?t.generateSchema():{}}}}findAndReturnTokens(t,r){return Kt.prim===t&&r.push(this),r}}Kt.prim="contract";class Gh extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="ListValidationError"}}class Je extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}get valueSchema(){return this.createToken(this.val.args[0],this.idx)}validate(t){if(!Array.isArray(t))throw new Gh(t,this,`Value ${JSON.stringify(t)} is not a valid array`)}Encode(t){const r=t.pop();this.validate(r);const n=this.createToken(this.val.args[0],0);return r.reduce((i,s)=>[...i,n.EncodeObject(s)],[])}Execute(t,r){const n=this.createToken(this.val.args[0],0);return this.validate(t),t.reduce((i,s)=>[...i,n.Execute(s,r)],[])}EncodeObject(t,r){const n=this.createToken(this.val.args[0],0);return this.validate(t),r&&r[Je.prim]?r[Je.prim](t):t.reduce((i,s)=>[...i,n.EncodeObject(s)],[])}ExtractSchema(){return{[Je.prim]:this.valueSchema.ExtractSchema()}}generateSchema(){return{__michelsonType:Je.prim,schema:this.valueSchema.generateSchema()}}findAndReturnTokens(t,r){return Je.prim===t&&r.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,r),r}}Je.prim="list";class Kh extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="MutezValidationError"}}class ae extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){return new I(t[Object.keys(t)[0]])}ExtractSchema(){return ae.prim}generateSchema(){return{__michelsonType:ae.prim,schema:ae.prim}}validate(t){if(new I(t).isNaN())throw new Kh(t,this,`Value is not a number: ${t}`)}Encode(t){const r=t.pop();return this.validate(r),{int:String(r).toString()}}EncodeObject(t,r){return this.validate(t),r&&r[ae.prim]?r[ae.prim](t):{int:String(t).toString()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:ae.prim}}}ToKey({int:t}){return t}compare(t,r){const n=Number(t),i=Number(r);return n===i?0:n<i?-1:1}findAndReturnTokens(t,r){return ae.prim===t&&r.push(this),r}}ae.prim="mutez";class jh extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="BytesValidationError"}}class ce extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}ToBigMapKey(t){return{key:{bytes:t},type:{prim:ce.prim}}}validate(t){if(!(typeof t=="string"&&/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0))throw new jh(t,this,`Invalid bytes: ${t}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let r=t.pop();return r=Po(this.convertUint8ArrayToHexString(r)),this.validate(r),{bytes:String(r).toString()}}EncodeObject(t,r){return t=this.convertUint8ArrayToHexString(t),typeof t=="string"&&(t=Po(t)),this.validate(t),r&&r[ce.prim]?r[ce.prim](t):{bytes:String(t).toString()}}Execute(t){return t.bytes}ExtractSchema(){return ce.prim}generateSchema(){return{__michelsonType:ce.prim,schema:ce.prim}}ToKey({bytes:t,string:r}){return r||t}findAndReturnTokens(t,r){return ce.prim===t&&r.push(this),r}}ce.prim="bytes";class Ur extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}subToken(){return this.createToken(this.val.args[0],this.idx)}schema(){return this.createToken(this.val.args[0],0)}annot(){return Array.isArray(this.val.annots)?super.annot():this.createToken(this.val.args[0],this.idx).annot()}Encode(t){const r=t;return r==null?{prim:"None"}:Array.isArray(r)&&(r[r.length-1]===void 0||r[r.length-1]===null)?(r.pop(),{prim:"None"}):{prim:"Some",args:[this.schema().Encode(t)]}}EncodeObject(t,r){let n=t;return n==null?{prim:"None"}:(n=typeof n=="object"&&"Some"in n?n.Some:n,{prim:"Some",args:[this.schema().EncodeObject(n,r)]})}Execute(t,r){return t.prim==="None"?null:{Some:this.schema().Execute(t.args[0],r)}}ExtractSchema(){return{Some:this.schema().ExtractSchema()}}generateSchema(){return{__michelsonType:Ur.prim,schema:this.schema().generateSchema()}}ExtractSignature(){return[...this.schema().ExtractSignature()]}get KeySchema(){return this.schema()}compare(t,r){if(t){if(!r)return 1}else return-1;return this.KeySchema.compare(t,r)}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:this.EncodeObject(t),type:this.typeWithoutAnnotations()}}findAndReturnTokens(t,r){return Ur.prim===t&&r.push(this),this.subToken().findAndReturnTokens(t,r),r}}Ur.prim="option";class ue extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){if(t.string&&/^\d+$/.test(t.string))return new Date(Number(t.string)*1e3).toISOString();if(t.string)return new Date(t.string).toISOString();if(t.int)return new Date(Number(t.int)*1e3).toISOString()}Encode(t){const r=t.pop();return typeof r=="number"?{int:String(r)}:{string:r}}EncodeObject(t,r){return r&&r[ue.prim]?r[ue.prim](t):typeof t=="number"?{int:String(t)}:{string:t}}ExtractSchema(){return ue.prim}generateSchema(){return{__michelsonType:ue.prim,schema:ue.prim}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:ue.prim}}}findAndReturnTokens(t,r){return ue.prim===t&&r.push(this),r}}ue.prim="timestamp";class Fh extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="IntValidationError"}}class Ht extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){return new I(t[Object.keys(t)[0]])}ExtractSchema(){return Ht.prim}generateSchema(){return{__michelsonType:Ht.prim,schema:Ht.prim}}validate(t){if(new I(t).isNaN())throw new Fh(t,this,`Value is not a number: ${JSON.stringify(t)}`)}Encode(t){const r=t.pop();return this.validate(r),{int:new I(r).toFixed()}}EncodeObject(t,r){return this.validate(t),r&&r[Ht.prim]?r[Ht.prim](t):{int:new I(t).toFixed()}}ToBigMapKey(t){return{key:{int:String(t)},type:{prim:Ht.prim}}}ToKey({int:t}){return t}compare(t,r){const n=Number(t),i=Number(r);return n===i?0:n<i?-1:1}findAndReturnTokens(t,r){return Ht.prim===t&&r.push(this),r}}Ht.prim="int";class le extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Encode(t){return t.pop(),{prim:"Unit"}}EncodeObject(t,r){return r&&r[le.prim]?r[le.prim](t):{prim:"Unit"}}Execute(t){return Yi}ExtractSchema(){return le.prim}generateSchema(){return{__michelsonType:le.prim,schema:le.prim}}compare(t,r){return 0}ToKey(t){return Yi}ToBigMapKey(t){return{key:{prim:"Unit"},type:{prim:le.prim}}}findAndReturnTokens(t,r){return le.prim===t&&r.push(this),r}}le.prim="unit";const Vh=new pl.ec("p256");class Zh extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="KeyValidationError"}}class he extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){return t.string?t.string:hl(t.bytes)}validate(t){if(dl(t)!==T.VALID)throw new Zh(t,this,"Key is not valid")}Encode(t){const r=t.pop();return this.validate(r),{string:r}}EncodeObject(t,r){return this.validate(t),r&&r[he.prim]?r[he.prim](t):{string:t}}ExtractSchema(){return he.prim}generateSchema(){return{__michelsonType:he.prim,schema:he.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:he.prim}}}decompressP256PublicKey(t){const r=Array.from(t),s=Vh.keyFromPublic(r).getPublic().encode("array",!1);return Buffer.concat([new Uint8Array([2]),new Uint8Array(s)])}compare(t,r){const n=Ki(t,"array"),i=Ki(r,"array");let s,o;return n[0]===2?s=this.decompressP256PublicKey(n.slice(1)):s=n,i[0]===2?o=this.decompressP256PublicKey(i.slice(1)):o=i,fs(s,o)}findAndReturnTokens(t,r){return he.prim===t&&r.push(this),r}}he.prim="key";class zh extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="KeyHashValidationError"}}class de extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){return t.string?t.string:Ro(t.bytes)}validate(t){if(gs(t)!==T.VALID)throw new zh(t,this,`KeyHash is not valid: ${JSON.stringify(t)}`)}Encode(t){const r=t.pop();return this.validate(r),{string:r}}EncodeObject(t,r){return this.validate(t),r&&r[de.prim]?r[de.prim](t):{string:t}}ExtractSchema(){return de.prim}generateSchema(){return{__michelsonType:de.prim,schema:de.prim}}ToKey({string:t,bytes:r}){return t||Ro(r)}ToBigMapKey(t){return{key:{string:t},type:{prim:de.prim}}}compare(t,r){const n=ji(t,"array"),i=ji(r,"array");return fs(n,i)}findAndReturnTokens(t,r){return de.prim===t&&r.push(this),r}}de.prim="key_hash";class Wh extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="SignatureValidationError"}}class pe extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){return t.string?t.string:t.bytes}validate(t){if(fl(t)!==T.VALID)throw new Wh(t,this,"Signature is not valid")}Encode(t){const r=t.pop();return this.validate(r),{string:r}}EncodeObject(t,r){return this.validate(t),r&&r[pe.prim]?r[pe.prim](t):{string:t}}ExtractSchema(){return pe.prim}generateSchema(){return{__michelsonType:pe.prim,schema:pe.prim}}ToKey(t){return this.Execute(t)}ToBigMapKey(t){return{key:{string:t},type:{prim:pe.prim}}}findAndReturnTokens(t,r){return pe.prim===t&&r.push(this),r}}pe.prim="signature";class qe extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}get paramSchema(){return this.createToken(this.val.args[0],this.idx)}get returnSchema(){return this.createToken(this.val.args[1],this.idx+1)}Execute(t){return t.string?t.string:t}Encode(t){return t.pop()}EncodeObject(t,r){return r&&r[qe.prim]?r[qe.prim](t):t}ExtractSchema(){return{[qe.prim]:{parameters:this.paramSchema.ExtractSchema(),returns:this.returnSchema.ExtractSchema()}}}generateSchema(){return{__michelsonType:qe.prim,schema:{parameters:this.paramSchema.generateSchema(),returns:this.returnSchema.generateSchema()}}}findAndReturnTokens(t,r){return qe.prim===t&&r.push(this),this.createToken(this.val.args[0],this.idx).findAndReturnTokens(t,r),this.createToken(this.val.args[1],this.idx).findAndReturnTokens(t,r),r}}qe.prim="lambda";class we extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){return t.string}Encode(...t){return{string:t.pop()}}EncodeObject(t,r){return r&&r[we.prim]?r[we.prim](t):{string:t}}ExtractSchema(){return we.prim}generateSchema(){return{__michelsonType:we.prim,schema:we.prim}}findAndReturnTokens(t,r){return we.prim===t&&r.push(this),r}}we.prim="operation";class Jh extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="SetValidationError"}}class Ye extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}get KeySchema(){return this.createToken(this.val.args[0],0)}validate(t){if(!Array.isArray(t))throw new Jh(t,this,`Value ${JSON.stringify(t)} is not an array`)}Encode(t){const r=t.pop();return this.validate(r),r.sort((n,i)=>this.KeySchema.compare(n,i)).reduce((n,i)=>[...n,this.KeySchema.EncodeObject(i)],[])}Execute(t,r){return t.reduce((n,i)=>[...n,this.KeySchema.Execute(i,r)],[])}EncodeObject(t,r){return this.validate(t),r&&r[Ye.prim]?r[Ye.prim](t):t.sort((n,i)=>this.KeySchema.compare(n,i)).reduce((n,i)=>[...n,this.KeySchema.EncodeObject(i)],[])}ExtractSchema(){return Ye.prim}generateSchema(){return{__michelsonType:Ye.prim,schema:this.KeySchema.generateSchema()}}findAndReturnTokens(t,r){return Ye.prim===t&&r.push(this),this.KeySchema.findAndReturnTokens(t,r),r}}Ye.prim="set";class qh extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="ChainIDValidationError"}}class fe extends yt{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}validate(t){if(_a(t)!==T.VALID)throw new qh(t,this,`Value ${JSON.stringify(t)} is not a valid ChainID`)}Execute(t){return t[Object.keys(t)[0]]}ExtractSchema(){return fe.prim}generateSchema(){return{__michelsonType:fe.prim,schema:fe.prim}}Encode(t){const r=t.pop();return this.validate(r),{string:r}}EncodeObject(t,r){return this.validate(t),r&&r[fe.prim]?r[fe.prim](t):{string:t}}ToKey({string:t}){return t}ToBigMapKey(t){return{key:{string:t},type:{prim:fe.prim}}}findAndReturnTokens(t,r){return fe.prim===t&&r.push(this),r}}fe.prim="chain_id";class qo extends at{constructor(){super(),this.name="TicketEncodeError",this.message="Tickets cannot be sent to the blockchain; they are created on-chain"}}const Yh={prim:"contract"},Xh={prim:"int"};class ye extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new qo}EncodeObject(t,r){if(r&&r[ye.prim])return r[ye.prim](t,this.val);throw new qo}Execute(t,r){if(r&&r[ye.prim])return r[ye.prim](t,this.val);const n=this.createToken(Yh,this.idx),i=this.valueToken,s=this.createToken(Xh,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:n.Execute(t.args[0],r),value:i.Execute(t.args[1].args[0],r),amount:s.Execute(t.args[1].args[1],r)}:{ticketer:n.Execute(t.args[0],r),value:i.Execute(t.args[1],r),amount:s.Execute(t.args[2],r)}}ExtractSchema(){return{ticketer:Kt.prim,value:this.valueToken.ExtractSchema(),amount:Ht.prim}}generateSchema(){return{__michelsonType:ye.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:Kt.prim,schema:Kt.prim},amount:{__michelsonType:Ht.prim,schema:Ht.prim}}}}findAndReturnTokens(t,r){return ye.prim===t&&r.push(this),this.valueToken.findAndReturnTokens(t,r),r}}ye.prim="ticket";class Yo extends at{constructor(){super(),this.name="TicketDeprecatedEncodeError",this.message="Ticket_deprecated cannot be sent to the blockchain; they are created on-chain"}}const Qh={prim:"contract"},td={prim:"int"};class Ee extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}get valueToken(){return this.createToken(this.val.args[0],this.idx)}Encode(t){throw new Yo}EncodeObject(t,r){if(r&&r[Ee.prim])return r[Ee.prim](t,this.val);throw new Yo}Execute(t,r){if(r&&r[Ee.prim])return r[Ee.prim](t,this.val);const n=this.createToken(Qh,this.idx),i=this.valueToken,s=this.createToken(td,this.idx);return t.args[2]===void 0&&t.args[1].args!==void 0?{ticketer:n.Execute(t.args[0],r),value:i.Execute(t.args[1].args[0],r),amount:s.Execute(t.args[1].args[1],r)}:{ticketer:n.Execute(t.args[0],r),value:i.Execute(t.args[1],r),amount:s.Execute(t.args[2],r)}}ExtractSchema(){return{ticketer:Kt.prim,value:this.valueToken.ExtractSchema(),amount:Ht.prim}}generateSchema(){return{__michelsonType:Ee.prim,schema:{value:this.valueToken.generateSchema(),ticketer:{__michelsonType:Kt.prim,schema:Kt.prim},amount:{__michelsonType:Ht.prim,schema:Ht.prim}}}}findAndReturnTokens(t,r){return Ee.prim===t&&r.push(this),this.valueToken.findAndReturnTokens(t,r),r}}Ee.prim="ticket_deprecated";class xi extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="NeverTokenError"}}class Te extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Encode(t){const r=t.pop();throw new xi(r,this,`Assigning a value to the type never is forbidden. Trying to assign ${JSON.stringify(r)}.`)}EncodeObject(t,r){if(r&&r[Te.prim])return r[Te.prim](t);throw new xi(t,this,`Assigning a value to the type never is forbidden. Trying to assign ${JSON.stringify(t)}.`)}Execute(t){throw new xi(t,this,`There is no literal value for the type never. Trying to execute ${JSON.stringify(t)}.`)}ExtractSchema(){return Te.prim}generateSchema(){return{__michelsonType:Te.prim,schema:Te.prim}}findAndReturnTokens(t,r){return Te.prim===t&&r.push(this),r}}Te.prim="never";class ki extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="SaplingStateValidationError"}}class ge extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}isValid(t){return typeof t=="object"&&Object.keys(t).length===0}Execute(t,r){if(r&&r[ge.prim])return r[ge.prim](t,this.val);if("int"in t)return t.int;throw new ki(t,this,`Sapling state is expecting an object with an int property. Got ${JSON.stringify(t)}`)}Encode(t){const r=t.pop();if(this.isValid(r))return[];throw new ki(r,this,`Invalid sapling_state. Received: ${JSON.stringify(r)} while expecting: {}`)}EncodeObject(t,r){if(r&&r[ge.prim])return r[ge.prim](t);if(this.isValid(t))return[];throw new ki(t,this,`Invalid sapling_state. Received: ${JSON.stringify(t)} while expecting: {}`)}ExtractSchema(){return{[ge.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:ge.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,r){return ge.prim===t&&r.push(this),r}}ge.prim="sapling_state";class Xo extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="SaplingTransactionValidationError"}}class Xe extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){throw new Xo(t,this,`There is no literal value for the sapling_transaction type. Got: ${JSON.stringify(t)}.`)}validateBytes(t){const r=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(r&&r[2].length%2===0)return r[2];throw new Xo(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let r=t.pop();return r=this.validateBytes(this.convertUint8ArrayToHexString(r)),{bytes:String(r).toString()}}EncodeObject(t,r){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),r&&r[Xe.prim]?r[Xe.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[Xe.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:Xe.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,r){return Xe.prim===t&&r.push(this),r}}Xe.prim="sapling_transaction";class Qo extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="SaplingTransactionDeprecatedValidationError"}}class Qe extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t){throw new Qo(t,this,`There is no literal value for the sapling_transaction_deprecated type. Got: ${JSON.stringify(t)}.`)}validateBytes(t){const r=/^(0x|0X)?([0-9a-fA-F]*$)/.exec(t);if(r&&r[2].length%2===0)return r[2];throw new Qo(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let r=t.pop();return r=this.validateBytes(this.convertUint8ArrayToHexString(r)),{bytes:String(r).toString()}}EncodeObject(t,r){return t=this.validateBytes(this.convertUint8ArrayToHexString(t)),r&&r[Qe.prim]?r[Qe.prim](t):{bytes:String(t).toString()}}ExtractSchema(){return{[Qe.prim]:{"memo-size":Number(this.val.args[0].int)}}}generateSchema(){return{__michelsonType:Qe.prim,schema:{memoSize:this.val.args[0].int}}}findAndReturnTokens(t,r){return Qe.prim===t&&r.push(this),r}}Qe.prim="sapling_transaction_deprecated";class ed extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="Bls12381frValidationError"}}class Ie extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}validate(t){if(!(/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0))throw new ed(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let r=t.pop();return typeof r=="number"?{int:r.toString()}:(r=this.convertUint8ArrayToHexString(r),this.validate(r),{bytes:r})}EncodeObject(t,r){return r&&r[Ie.prim]?r[Ie.prim](t):typeof t=="number"?{int:t.toString()}:(t=this.convertUint8ArrayToHexString(t),this.validate(t),{bytes:t})}Execute(t){return t.bytes}ExtractSchema(){return Ie.prim}generateSchema(){return{__michelsonType:Ie.prim,schema:Ie.prim}}findAndReturnTokens(t,r){return Ie.prim===t&&r.push(this),r}}Ie.prim="bls12_381_fr";class rd extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="Bls12381g1ValidationError"}}class Le extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}validate(t){if(!(/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0))throw new rd(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let r=t.pop();return r=this.convertUint8ArrayToHexString(r),this.validate(r),{bytes:r}}EncodeObject(t,r){return t=this.convertUint8ArrayToHexString(t),this.validate(t),r&&r[Le.prim]?r[Le.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Le.prim}generateSchema(){return{__michelsonType:Le.prim,schema:Le.prim}}findAndReturnTokens(t,r){return Le.prim===t&&r.push(this),r}}Le.prim="bls12_381_g1";class nd extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="Bls12381g2ValidationError"}}class Ne extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}validate(t){if(!(/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0))throw new nd(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let r=t.pop();return r=this.convertUint8ArrayToHexString(r),this.validate(r),{bytes:r}}EncodeObject(t,r){return t=this.convertUint8ArrayToHexString(t),this.validate(t),r&&r[Ne.prim]?r[Ne.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return Ne.prim}generateSchema(){return{__michelsonType:Ne.prim,schema:Ne.prim}}findAndReturnTokens(t,r){return Ne.prim===t&&r.push(this),r}}Ne.prim="bls12_381_g2";class id extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="ChestValidationError"}}class xe extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}validate(t){if(!(/^[0-9a-fA-F]*$/.test(t)&&t.length%2==0))throw new id(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let r=t.pop();return r=this.convertUint8ArrayToHexString(r),this.validate(r),{bytes:r}}EncodeObject(t,r){return t=this.convertUint8ArrayToHexString(t),this.validate(t),r&&r[xe.prim]?r[xe.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return xe.prim}generateSchema(){return{__michelsonType:xe.prim,schema:xe.prim}}findAndReturnTokens(t,r){return xe.prim===t&&r.push(this),r}}xe.prim="chest";class sd extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="ChestKeyValidationError"}}class ke extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}validate(t){if(!(/^[0-9a-fA-F]*$/.test(t)&&t.length%2===0))throw new sd(t,this,`Invalid bytes: ${JSON.stringify(t)}`)}convertUint8ArrayToHexString(t){return t.constructor===Uint8Array?Buffer.from(t).toString("hex"):t}Encode(t){let r=t.pop();return r=this.convertUint8ArrayToHexString(r),this.validate(r),{bytes:r}}EncodeObject(t,r){return t=this.convertUint8ArrayToHexString(t),this.validate(t),r&&r[ke.prim]?r[ke.prim](t):{bytes:t}}Execute(t){return t.bytes}ExtractSchema(){return ke.prim}generateSchema(){return{__michelsonType:ke.prim,schema:ke.prim}}findAndReturnTokens(t,r){return ke.prim===t&&r.push(this),r}}ke.prim="chest_key";class ta extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="GlobalConstantEncodingError"}}class od extends rt{constructor(t,r,n){super(t,r,n),this.value=t,this.token=r,this.name="GlobalConstantDecodingError"}}class me extends st{constructor(t,r,n){super(t,r,n),this.val=t,this.idx=r,this.fac=n}Execute(t,r){if(r&&r[me.prim])return r[me.prim](t,this.val);throw new od(t,this,`Unable to decode a value represented by a global constants. Please provide an expanded script to the Michelson-Encoder or semantics for the decoding. The following global constant hash was encountered: ${this.val.args[0].string}.`)}Encode(t){throw new ta(t,this,`Unable to encode a script containing global constants. Please provide an expanded script to the Michelson-Encoder. The following global constant hash was encountered: ${this.val.args[0].string}.`)}EncodeObject(t,r){if(r&&r[me.prim])return r[me.prim](t);throw new ta(t,this,`Unable to encode a script containing global constants. Please provide an expanded script to the Michelson-Encoder. The following global constant hash was encountered: ${this.val.args[0].string}.`)}ExtractSchema(){return me.prim}generateSchema(){return{__michelsonType:me.prim,schema:{hash:this.val.args[0].string}}}findAndReturnTokens(t,r){return me.prim===t&&r.push(this),r}}me.prim="constant";const ad=[bt,ie,se,Vt,Oe,er,oe,J,Kt,Je,ae,ce,Ur,ue,Ht,le,he,de,pe,qe,we,Ye,fe,ye,Ee,Te,ge,Xe,Qe,Ie,Le,Ne,xe,ke,me];class cd extends at{constructor(t,r){super(t),this.message=t,this.data=r,this.name="Invalid token error"}}function wr(e,t,r){if(Array.isArray(e))return new bt(e,t,wr,r);const n=ad.find(i=>i.prim===e.prim);if(!n)throw new cd(`Malformed data: ${JSON.stringify(e)}. Expected a value with a valid prim property`,e);return new n(e,t,wr,r)}class qi extends Ea{constructor(t,r,n,i){super(t,r,n,i),this.viewName=t,this.sigs=r,this.args=n,this.cause=i,this.name="ParameterEncodingError",this.message=`Could not encode parameter ${JSON.stringify(n)} received for name "${t}" expecting one of the following signatures ${JSON.stringify(r)}`}}class Mi extends at{constructor(t,r){super(),this.script=t,this.reason=r,this.name="InvalidScriptError";let n="Invalid on-chain view found in the following script.";r&&(n+=` Reason: ${r}.`),n+=`Script: ${JSON.stringify(t)}`,this.message=n}}class He extends at{constructor(t,r){super(),this.script=t,this.reason=r,this.name="InvalidRpcResponseError";let n="Invalid RPC response passed as argument(s).";r&&(n+=` Reason: ${r}.`),n+=` Received: ${JSON.stringify(t)}`,this.message=n}}class Pn extends at{constructor(t){super(t),this.message=t,this.name="InvalidBigMapSchemaError"}}class ud extends at{constructor(t,r){super(t),this.message=t,this.value=r,this.name="InvalidBigMapDiffError"}}class ld extends at{constructor(t,r,n,i){super(),this.details=r,this.schema=n,this.value=i,this.name="BigMapEncodingError",this.message=`Unable to encode the big map ${t}. Schema is: ${JSON.stringify(n)}. The ${t} is: ${JSON.stringify(i)}. Error details: ${r}`}}class hd extends at{constructor(t,r,n,i,s){super(),this.details=r,this.schema=n,this.value=i,this.semantics=s,this.name="StorageEncodingError",this.message=`Unable to encode ${t}. The schema is: ${JSON.stringify(n)}, the value is: ${JSON.stringify(i)}.${s?`And the semantic is: ${JSON.stringify(s)}`:""}. Error details: ${r}`}}class dd extends at{constructor(t){super(t),this.message=t,this.name="MissingArgumentError"}}var sc;const oc=Symbol.for("taquito-schema-type-symbol");function hn(e,t=bt.prim){var r,n;if(Array.isArray(e))return hn({prim:t,args:e},t);const i=e;return i.prim===t&&i.args&&i.args.length>2?Object.assign(Object.assign({},i),{args:[(r=i.args)===null||r===void 0?void 0:r[0],{prim:t,args:(n=i.args)===null||n===void 0?void 0:n.slice(1)}]}):i}function Ps(e,t){if(e===void 0||t===void 0)return e===t;const r=hn(e),n=hn(t);return r.prim===n.prim&&(r.args===void 0&&n.args===void 0||r.args!==void 0&&n.args!==void 0&&r.args.length===n.args.length&&r.args.every((i,s)=>{var o,a;return Ps(i,(a=(o=n.args)===null||o===void 0?void 0:o[s])!==null&&a!==void 0?a:{})}))&&(r.annots===void 0&&n.annots===void 0||r.annots!==void 0&&n.annots!==void 0&&r.annots.length===n.annots.length&&r.annots.every((i,s)=>{var o;return i===((o=n.annots)===null||o===void 0?void 0:o[s])}))}class Zt{static isSchema(t){return t&&t[oc]===!0}static fromRPCResponse(t){if(!t)throw new He(t,"the RPC response is empty");if(!t.script)throw new He(t,"the RPC response has no script");if(!Array.isArray(t.script.code))throw new He(t,"The response.script.code should be an array");let r=t.script.code;for(;r.length===1&&Array.isArray(r[0]);)r=r[0];const n=r.find(i=>"prim"in i&&i.prim==="storage");if(!n||!Array.isArray(n.args))throw new He(t,'The response.script.code has an element of type {prim: "storage"}, but its args is not an array');return new Zt(n.args[0])}isExpressionExtended(t){return"prim"in t&&Array.isArray(t.args)}constructor(t){if(this.val=t,this[sc]=!0,this.root=wr(t,0),this.root instanceof Vt)this.bigMap=this.root;else if(this.isExpressionExtended(t)&&t.prim==="pair"){const r=t.args[0];this.isExpressionExtended(r)&&r.prim==="big_map"&&(this.bigMap=new Vt(r,0,wr))}}removeTopLevelAnnotation(t){return(this.root instanceof bt||this.root instanceof J)&&this.root.hasAnnotations()&&typeof t=="object"&&Object.keys(t).length===1?t[Object.keys(t)[0]]:t}Execute(t,r){const n=this.root.Execute(t,r);return this.removeTopLevelAnnotation(n)}Typecheck(t){this.root instanceof Vt&&Number.isInteger(Number(t))||this.root instanceof ye&&t.ticketer&&t.value&&t.amount||this.root instanceof Ee&&t.ticketer&&t.value&&t.amount||this.root instanceof er&&this.root.ValueSchema instanceof Vt||this.root.EncodeObject(t)}ExecuteOnBigMapDiff(t,r){if(!this.bigMap)throw new Pn("Big map schema is undefined");if(!Array.isArray(t))throw new ud(`Big map diff must be an array, got: ${JSON.stringify(t)}`,t);const n=t.map(({key:i,value:s})=>({args:[i,s]}));return this.bigMap.Execute(n,r)}ExecuteOnBigMapValue(t,r){if(!this.bigMap)throw new Pn("Big map schema is undefined");return this.bigMap.ValueSchema.Execute(t,r)}EncodeBigMapKey(t){if(!this.bigMap)throw new Pn("Big map schema is undefined");try{return this.bigMap.KeySchema.ToBigMapKey(t)}catch(r){throw new ld("key",r,this.bigMap.KeySchema,t)}}Encode(t,r){try{return this.root.EncodeObject(t,r)}catch(n){throw n instanceof rt?n:new hd("storage object",n,this.root,t,r)}}ExtractSchema(){return this.removeTopLevelAnnotation(this.root.ExtractSchema())}generateSchema(){return this.removeTopLevelAnnotation(this.root.generateSchema())}ComputeState(t,r){if(!this.bigMap)throw new Pn("Big map schema is undefined");const n=t.reduce((i,s)=>Object.assign(Object.assign({},i),this.ExecuteOnBigMapDiff(s.contents[0].metadata.operation_result.big_map_diff)),{});return Object.assign(Object.assign({},this.Execute(r)),{[this.bigMap.annot()]:n})}FindFirstInTopLevelPair(t,r){return this.findValue(this.root.val,t,r)}findValue(t,r,n){if(Ps(n,t))return r;if(Array.isArray(t)||t.prim==="pair"){const i=hn(t),s=hn(r,"Pair");if(i.args===void 0||s.args===void 0)throw new dd("Tokens have no arguments");if(i.args[0])return this.findValue(i.args[0],s.args[0],n)||this.findValue(i.args[1],s.args[1],n)}}findToken(t){const r=[];return this.root.findAndReturnTokens(t,r)}}sc=oc;class xr{static fromRPCResponse(t){if(!t)throw new He(t,"the RPC response is empty");if(!t.script)throw new He(t,"the RPC response has no script");if(!Array.isArray(t.script.code))throw new He(t,"The response.script.code should be an array");const r=t.script.code.find(n=>"prim"in n&&n.prim==="parameter");if(!r)throw new He(t,'The response.script.code should have an element of type {prim: "parameter"}');if(!Array.isArray(r.args))throw new He(t,'The response.script.code has an element of type {prim: "parameter"}, but its args is not an array');return new xr(r.args[0])}get isMultipleEntryPoint(){return this.root instanceof J||this.root instanceof Ur&&this.root.subToken()instanceof J}get hasAnnotation(){return this.isMultipleEntryPoint?Object.keys(this.ExtractSchema())[0]!=="0":!0}constructor(t){this.root=wr(t,0)}Execute(t,r){return this.root.Execute(t,r)}Encode(...t){try{return this.root.Encode(t.reverse())}catch(r){throw r instanceof rt?r:new qi("Unable to encode parameter",this.root,t,r)}}EncodeObject(t,r){try{return this.root.EncodeObject(t,r)}catch(n){throw n instanceof rt?n:new qi("Unable to encode parameter object",this.root,t,n)}}ExtractSchema(){return this.root.ExtractSchema()}generateSchema(){return this.root.generateSchema()}ExtractSignatures(){return this.root.ExtractSignature()}}class Rs{static fromRPCResponse(t){const r=[],n=t&&t.script&&Array.isArray(t.script.code)&&t.script.code.filter(i=>i.prim==="view");return n&&n.forEach(i=>{r.push(new Rs(i.args))}),r}constructor(t){if(!t)throw new Mi(t,"the args are not defined");if(t.length!==4)throw new Mi(t,"there should be exactly 4 arguments");if(!("string"in t[0])||!t[0].string)throw new Mi(t,"The first argument should be a string, representing the view name. It should be in the form: { string: 'viewName' }");this.viewName=t[0].string,this.viewArgsType=t[1],this.viewReturnType=t[2],this.instructions=t[3],this.rootArgsType=wr(this.viewArgsType,0),this.rootReturnType=wr(this.viewReturnType,0)}encodeViewArgs(t){try{return this.rootArgsType.EncodeObject(t)}catch(r){throw new qi(this.viewName,void 0,t,r)}}decodeViewResult(t,r){return this.rootReturnType.Execute(t,r)}extractArgsSchema(){return this.rootArgsType.ExtractSchema()}extractResultSchema(){return this.rootReturnType.ExtractSchema()}}class Ze{constructor(t,r){this.tag=t,this.type=r}static fromMichelineValue(t){var r,n;return new Ze((r=t.annots)===null||r===void 0?void 0:r[0],(n=t.args)===null||n===void 0?void 0:n[0])}static fromRPCResponse(t){const r=[];return t.script.code.forEach(n=>{!("prim"in n)||n.prim!=="code"||!("args"in n)||!n.args||r.push(...Ze.extractEventsRecursively(n.args))}),Ze.removeDuplicates(r)}static removeDuplicates(t){const r=[];return t.forEach(n=>{r.findIndex(s=>s.tag===n.tag&&Ps(s.type,n.type))===-1&&r.push(n)}),r}static extractEventsRecursively(t){return Array.isArray(t)?t.flatMap(r=>Ze.extractEventsRecursively(r)):"prim"in t?t.prim==="EMIT"?[Ze.fromMichelineValue(t)]:!("args"in t)||!t.args?[]:t.args.flatMap(r=>Ze.extractEventsRecursively(r)):[]}}const Yi=Symbol(),Ct=Symbol("source_reference");class Yr extends at{constructor(t,r,n){super(),this.src=t,this.idx=r,this.message=n,this.name="ScanError"}}var Bt;(function(e){e[e.Comment=0]="Comment",e[e.Number=1]="Number",e[e.String=2]="String",e[e.Bytes=3]="Bytes",e[e.Ident=4]="Ident"})(Bt||(Bt={}));const pd=new RegExp("\\s"),fd=new RegExp("[:@%_A-Za-z]"),gd=new RegExp("[@%_\\.A-Za-z0-9]"),ea=new RegExp("[0-9]"),md=new RegExp("[0-9a-fA-F]");function*Hi(e,t=!1){let r=0;for(;r<e.length;){for(;r<e.length&&pd.test(e[r]);)r++;if(r===e.length)return;const n=e[r],i=r;if(fd.test(n)){for(r++;r<e.length&&gd.test(e[r]);)r++;yield{t:Bt.Ident,v:e.slice(i,r),first:i,last:r}}else if(e.length-r>1&&e.substring(r,r+2)==="0x"){for(r+=2;r<e.length&&md.test(e[r]);)r++;if((r-i&1)!==0)throw new Yr(e,r,"Bytes literal length is expected to be power of two");yield{t:Bt.Bytes,v:e.slice(i,r),first:i,last:r}}else if(ea.test(n)||n==="-"){n==="-"&&r++;const s=r;for(;r<e.length&&ea.test(e[r]);)r++;if(s===r)throw new Yr(e,r,"Number literal is too short");yield{t:Bt.Number,v:e.slice(i,r),first:i,last:r}}else if(n==='"'){r++;let s=!1;for(;r<e.length&&(s||e[r]!=='"');r++)!s&&e[r]==="\\"?s=!0:s=!1;if(r===e.length)throw new Yr(e,r,"Unterminated string literal");r++,yield{t:Bt.String,v:e.slice(i,r),first:i,last:r}}else if(n==="#"){for(r++;r<e.length&&e[r]!==`
`;)r++;t&&(yield{t:Bt.Comment,v:e.slice(i,r),first:i,last:r})}else if(e.length-r>1&&e.substring(r,r+2)==="/*"){for(r+=2;r<e.length&&!(e.length-r>1&&e.substring(r,r+2)==="*/");)r++;if(r===e.length)throw new Yr(e,r,"Unterminated C style comment");r+=2,t&&(yield{t:Bt.Comment,v:e.slice(i,r),first:i,last:r})}else if(n==="("||n===")"||n==="{"||n==="}"||n===";")r++,yield{t:n,v:n,first:i,last:r};else throw new Yr(e,r,`Invalid character at offset ${r}: \`${n}'`)}}const Rn=Symbol("ref_contract");var Ue;(function(e){e.Ps9mPmXa="Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P",e.PtCJ7pwo="PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY",e.PsYLVpVv="PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt",e.PsddFKi3="PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP",e.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",e.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",e.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",e.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",e.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",e.PtEdoTez="PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq",e.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",e.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",e.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",e.PtHangzH="PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r",e.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",e.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",e.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",e.PtJakarta="PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw",e.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",e.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",e.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",e.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",e.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",e.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",e.ProxfordY="ProxfordYmVfjWnRcgjWH36fW6PArwqykTFzotUxRs6gmTcZDuH",e.PtParisBx="PtParisBxoLz5gzMmn3d9WBQNoPSZakgnkMC2VNuQ3KXfUtUQeZ",e.PsParisCZ="PsParisCZo7KAh1Z1smVd9ZMZ1HHn5gkzbM94V3PLCpknFWhUAi",e.PsQuebecn="PsQuebecnLByd3JwTiGadoG4nGWi3HYiLXUjkibeFV8dCFeVMUg",e.PsRiotuma="PsRiotumaAMotcRoDWW1bysEhQy2n1M5fy8JgRp8jjRfHGmfeA7",e.PtSeouLou="PtSeouLouXkxhg39oWzjxDWaCydNfR3RxCUrNe4Q9Ro8BTehcbh",e.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(Ue||(Ue={}));const ac=Ue.PtSeouLou,ra={Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P:0,PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY:1,PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt:2,PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP:3,Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd:4,PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU:5,PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS:5,PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb:6,PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo:7,PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq:8,PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA:8,PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i:9,PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV:10,PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r:11,PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx:11,PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP:12,Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A:12,PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw:13,PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY:13,PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg:14,PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW:15,PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc:16,PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1:16,PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf:17,ProxfordYmVfjWnRcgjWH36fW6PArwqykTFzotUxRs6gmTcZDuH:19,PtParisBxoLz5gzMmn3d9WBQNoPSZakgnkMC2VNuQ3KXfUtUQeZ:20,PsParisCZo7KAh1Z1smVd9ZMZ1HHn5gkzbM94V3PLCpknFWhUAi:20,PsQuebecnLByd3JwTiGadoG4nGWi3HYiLXUjkibeFV8dCFeVMUg:21,PsRiotumaAMotcRoDWW1bysEhQy2n1M5fy8JgRp8jjRfHGmfeA7:22,PtSeouLouXkxhg39oWzjxDWaCydNfR3RxCUrNe4Q9Ro8BTehcbh:23,ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK:23};function kr(e,t){return ra[e]<ra[t]}class te extends at{constructor(t,r){super(),this.prim=t,this.message=r,this.name="MacroError"}}function ct(e,t){var r,n;if(t===0&&e.args===void 0||((r=e.args)===null||r===void 0?void 0:r.length)===t)return!0;throw new te(e,`macro ${e.prim} expects ${t} arguments, was given ${(n=e.args)===null||n===void 0?void 0:n.length}`)}function Xr(e){if(e.annots===void 0)return!0;throw new te(e,`unexpected annotation on macro ${e.prim}: ${e.annots}`)}function na(e,t){if("int"in t)return!0;throw new te(e,`macro ${e.prim} expects int argument`)}function sn(e,t,r,n){let i=0,s=0;const o=[null,null];let a;if(i===t.length)throw new te(e,`unexpected end: ${e.prim}`);let c=t[i++];switch(c){case"P":{const{r:l,n:g,an:E}=sn(e,t.slice(i),r.slice(s),n);a=l,i+=g,s+=E;break}case"A":s!==r.length&&(o[0]=r[s++]);break;default:throw new te(e,`${e.prim}: unexpected character: ${c}`)}let u;if(i===t.length)throw new te(e,`unexpected end: ${e.prim}`);switch(c=t[i++],c){case"P":{const{r:l,n:g,an:E}=sn(e,t.slice(i),r.slice(s),n);u=l.map(([y,v])=>[y+1,v]),i+=g,s+=E;break}case"I":s!==r.length&&(o[1]=r[s++]);break;default:throw new te(e,`${e.prim}: unexpected character: ${c}`)}return{r:n(a,u,[0,o]),n:i,an:s}}function jn(e,t,r,n){const i=t[0];switch(i){case"A":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CAR",annots:["@%%"]},jn(e,t.slice(1),[],n)]]},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%@","%@",...r]}]:n.a;case"D":return t.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CDR",annots:["@%%"]},jn(e,t.slice(1),[],n)]]},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%@",...r]}]:n.d;default:throw new te(e,`${e.prim}: unexpected character: ${i}`)}}function yd(e,t){let r=e.length;for(;r>0&&e[r-1]===t;)r--;return e.slice(0,r)}function Di(e){const t=[],r=[];if(e!==void 0)for(const n of e)(n.length!==0&&n[0]==="%"?t:r).push(n);return{fields:t,rest:r}}function vt({prim:e,annots:t,args:r}){return Object.assign(Object.assign({prim:e},t&&{annots:t}),r&&{args:r})}const Ed=/^P[PAI]{3,}R$/,_d=/^UNP[PAI]{2,}R$/,bd=/^C[AD]{2,}R$/,vd=/^SET_C[AD]+R$/,Ad=/^MAP_C[AD]+R$/,Sd=/^DI{2,}P$/,Pd=/^DU+P$/;function Rd(e,t){const r=t?.protocol||ac;function n(i){return i!==void 0?[{prim:"RENAME",annots:i}]:[]}switch(e.prim){case"CMPEQ":case"CMPNEQ":case"CMPLT":case"CMPGT":case"CMPLE":case"CMPGE":if(ct(e,0))return[{prim:"COMPARE"},vt({prim:e.prim.slice(3),annots:e.annots})];break;case"IFEQ":case"IFNEQ":case"IFLT":case"IFGT":case"IFLE":case"IFGE":if(ct(e,2))return[{prim:e.prim.slice(2)},vt({prim:"IF",annots:e.annots,args:e.args})];break;case"IFCMPEQ":case"IFCMPNEQ":case"IFCMPLT":case"IFCMPGT":case"IFCMPLE":case"IFCMPGE":if(ct(e,2))return[{prim:"COMPARE"},{prim:e.prim.slice(5)},vt({prim:"IF",annots:e.annots,args:e.args})];break;case"FAIL":if(ct(e,0)&&Xr(e))return[{prim:"UNIT"},{prim:"FAILWITH"}];break;case"ASSERT":if(ct(e,0)&&Xr(e))return[{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_EQ":case"ASSERT_NEQ":case"ASSERT_LT":case"ASSERT_GT":case"ASSERT_LE":case"ASSERT_GE":if(ct(e,0)&&Xr(e))return[{prim:e.prim.slice(7)},{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_CMPEQ":case"ASSERT_CMPNEQ":case"ASSERT_CMPLT":case"ASSERT_CMPGT":case"ASSERT_CMPLE":case"ASSERT_CMPGE":if(ct(e,0)&&Xr(e))return[[{prim:"COMPARE"},{prim:e.prim.slice(10)}],{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_NONE":if(ct(e,0)&&Xr(e))return[{prim:"IF_NONE",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_SOME":if(ct(e,0))return[{prim:"IF_NONE",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],n(e.annots)]}];break;case"ASSERT_LEFT":if(ct(e,0))return[{prim:"IF_LEFT",args:[n(e.annots),[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_RIGHT":if(ct(e,0))return[{prim:"IF_LEFT",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],n(e.annots)]}];break;case"IF_SOME":if(ct(e,2))return[vt({prim:"IF_NONE",annots:e.annots,args:[e.args[1],e.args[0]]})];break;case"IF_RIGHT":if(ct(e,2))return[vt({prim:"IF_LEFT",annots:e.annots,args:[e.args[1],e.args[0]]})];break;case"CAR":case"CDR":if(e.args!==void 0){if(ct(e,1)&&na(e,e.args[0])){const i=parseInt(e.args[0].int,10);return vt({prim:"GET",args:[{int:e.prim==="CAR"?String(i*2+1):String(i*2)}],annots:e.annots})}}else return e}if(Ed.test(e.prim)&&ct(e,0)){const{fields:i,rest:s}=Di(e.annots),{r:o}=sn(e,e.prim.slice(1),i,(a,c,u)=>[...a||[],...c||[],u]);return o.map(([a,c],u)=>{const l=[...yd(c,null).map(E=>E===null?"%":E),...a===0&&u===o.length-1?s:[]],g=vt({prim:"PAIR",annots:l.length!==0?l:void 0});return a===0?g:{prim:"DIP",args:a===1?[[g]]:[{int:String(a)},[g]]}})}if(_d.test(e.prim))if(kr(r,Ue.PtEdo2Zk)&&ct(e,0)){const{r:i}=sn(e,e.prim.slice(3),e.annots||[],(s,o,a)=>[a,...o||[],...s||[]]);return i.map(([s,o])=>{const a=[{prim:"DUP"},vt({prim:"CAR",annots:o[0]!==null?[o[0]]:void 0}),{prim:"DIP",args:[[vt({prim:"CDR",annots:o[1]!==null?[o[1]]:void 0})]]}];return s===0?a:{prim:"DIP",args:s===1?[[a]]:[{int:String(s)},[a]]}})}else{if(e.prim==="UNPAIR")return e;if(ct(e,0)){const{r:i}=sn(e,e.prim.slice(3),[],(s,o,a)=>[a,...o||[],...s||[]]);return i.map(([s])=>{const o=vt({prim:"UNPAIR"});return s===0?o:{prim:"DIP",args:s===1?[[o]]:[{int:String(s)},[o]]}})}}if(bd.test(e.prim)&&ct(e,0)){const i=[...e.prim.slice(1,e.prim.length-1)];return i.map((s,o)=>{const a=o===i.length-1?e.annots:void 0;switch(s){case"A":return vt({prim:"CAR",annots:a});case"D":return vt({prim:"CDR",annots:a});default:throw new te(e,`unexpected character: ${s}`)}})}if(vd.test(e.prim)&&ct(e,0)){const{fields:i,rest:s}=Di(e.annots);if(i.length>1)throw new te(e,`unexpected annotation on macro ${e.prim}: ${i}`);const o=i.length!==0?{a:[{prim:"DUP"},{prim:"CAR",annots:i},{prim:"DROP"},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:[i[0],"%@"]}],d:[{prim:"DUP"},{prim:"CDR",annots:i},{prim:"DROP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",i[0]]}]}:{a:[{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%","%@"]}],d:[{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%"]}]};return jn(e,e.prim.slice(5,e.prim.length-1),s,o)}if(Ad.test(e.prim)&&ct(e,1)){const{fields:i}=Di(e.annots);if(i.length>1)throw new te(e,`unexpected annotation on macro ${e.prim}: ${i}`);const s={a:[{prim:"DUP"},{prim:"CDR",annots:["@%%"]},{prim:"DIP",args:[[vt({prim:"CAR",annots:i.length!==0?["@"+i[0].slice(1)]:void 0}),e.args[0]]]},{prim:"SWAP"},{prim:"PAIR",annots:[i.length!==0?i[0]:"%","%@"]}],d:[{prim:"DUP"},vt({prim:"CDR",annots:i.length!==0?["@"+i[0].slice(1)]:void 0}),e.args[0],{prim:"SWAP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",i.length!==0?i[0]:"%"]}]};return jn(e,e.prim.slice(5,e.prim.length-1),[],s)}if(Sd.test(e.prim)&&ct(e,1)){let i=0;for(;e.prim[1+i]==="I";)i++;return vt({prim:"DIP",args:[{int:String(i)},e.args[0]]})}if(Pd.test(e.prim)){let i=0;for(;e.prim[1+i]==="U";)i++;if(kr(r,Ue.PtEdo2Zk)){if(i===1){if(e.args===void 0)return e;ct(e,1)&&na(e,e.args[0])&&(i=parseInt(e.args[0].int,10))}else ct(e,0);return i===1?[vt({prim:"DUP",annots:e.annots})]:i===2?[{prim:"DIP",args:[[vt({prim:"DUP",annots:e.annots})]]},{prim:"SWAP"}]:[{prim:"DIP",args:[{int:String(i-1)},[vt({prim:"DUP",annots:e.annots})]]},{prim:"DIG",args:[{int:String(i)}]}]}else{if(i===1)return e;if(ct(e,0))return vt({prim:"DUP",args:[{int:String(i)}],annots:e.annots})}}return e}function Od(e,t){return e.args!==void 0&&e.args.length===1&&"string"in e.args[0]&&e.args[0].string in t?t[e.args[0].string]:e}class Mn extends at{constructor(t,r){super(),this.token=t,this.message=r,this.name="MichelineParseError"}}class Fe extends at{constructor(t,r){super(),this.node=t,this.message=r,this.name="JSONParseError"}}const Ci=new Mn(null,"Unexpected EOF");function ia(e){return e.t===Bt.Ident&&(e.v[0]==="@"||e.v[0]==="%"||e.v[0]===":")}const wd=new RegExp("^-?[0-9]+$"),Td=new RegExp("^([0-9a-fA-F]{2})*$");class _r{constructor(t){this.opt=t}expand(t){var r,n,i;if(((r=this.opt)===null||r===void 0?void 0:r.expandGlobalConstant)!==void 0&&t.prim==="constant"){const s=Od(t,this.opt.expandGlobalConstant);return s!==t&&(s[Ct]=Object.assign(Object.assign({},t[Ct]||{first:0,last:0}),{globalConstant:t})),s}if(((n=this.opt)===null||n===void 0?void 0:n.expandMacros)===void 0||!((i=this.opt)===null||i===void 0)&&i.expandMacros){const s=Rd(t,this.opt);return s!==t&&(s[Ct]=Object.assign(Object.assign({},t[Ct]||{first:0,last:0}),{macro:t})),s}else return t}parseListExpr(t,r){var n;const i={first:r.first,last:r.last},s=r.t==="(";let o;if(s){if(o=t.next(),o.done)throw Ci;i.last=o.value.last}else o={value:r};if(o.value.t!==Bt.Ident)throw new Mn(o.value,`not an identifier: ${o.value.v}`);const a={prim:o.value.v,[Ct]:i};for(;;){const c=t.next();if(c.done){if(s)throw Ci;break}else if(c.value.t===")"){if(!s)throw new Mn(c.value,"unexpected closing bracket");i.last=c.value.last;break}else if(ia(c.value))a.annots=a.annots||[],a.annots.push(c.value.v),i.last=c.value.last;else{a.args=a.args||[];const u=this.parseExpr(t,c.value);i.last=((n=u[Ct])===null||n===void 0?void 0:n.last)||i.last,a.args.push(u)}}return this.expand(a)}parseArgs(t,r){var n;const i={first:r.first,last:r.last},s={prim:r.v,[Ct]:i};for(;;){const o=t.next();if(o.done||o.value.t==="}"||o.value.t===";")return[s,o];if(ia(o.value))i.last=o.value.last,s.annots=s.annots||[],s.annots.push(o.value.v);else{const a=this.parseExpr(t,o.value);i.last=((n=a[Ct])===null||n===void 0?void 0:n.last)||i.last,s.args=s.args||[],s.args.push(a)}}}parseSequenceExpr(t,r){var n,i;const s={first:r.first,last:r.last},o=[];o[Ct]=s;const a=r.t==="{";let c=r.t==="{"?null:{value:r};for(;;){if(c===null&&(c=t.next(),c.done||(s.last=c.value.last)),c.done){if(a)throw Ci;return o}if(c.value.t==="}"){if(a)return o;throw new Mn(c.value,"unexpected closing bracket")}else if(c.value.t===Bt.Ident){const[u,l]=this.parseArgs(t,c.value);s.last=((n=u[Ct])===null||n===void 0?void 0:n.last)||s.last,o.push(this.expand(u)),c=l}else{const u=this.parseExpr(t,c.value);s.last=((i=u[Ct])===null||i===void 0?void 0:i.last)||s.last,o.push(u),c=null}c===null&&(c=t.next(),c.done||(s.last=c.value.last)),!c.done&&c.value.t===";"&&(c=null)}}parseExpr(t,r){switch(r.t){case Bt.Ident:return this.expand({prim:r.v,[Ct]:{first:r.first,last:r.last}});case Bt.Number:return{int:r.v,[Ct]:{first:r.first,last:r.last}};case Bt.String:return{string:JSON.parse(r.v),[Ct]:{first:r.first,last:r.last}};case Bt.Bytes:return{bytes:r.v.slice(2),[Ct]:{first:r.first,last:r.last}};case"{":return this.parseSequenceExpr(t,r);default:return this.parseListExpr(t,r)}}parseSequence(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const r=Hi(t),n=r.next();return n.done?null:this.parseSequenceExpr(r,n.value)}parseList(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const r=Hi(t),n=r.next();return n.done?null:this.parseListExpr(r,n.value)}parseMichelineExpression(t){if(typeof t!="string")throw new TypeError(`string type was expected, got ${typeof t} instead`);const r=Hi(t),n=r.next();return n.done?null:this.parseExpr(r,n.value)}parseScript(t){return this.parseSequence(t)}parseData(t){return this.parseList(t)}parseJSON(t){if(typeof t!="object")throw new TypeError(`object type was expected, got ${typeof t} instead`);if(Array.isArray(t)){const r=[];for(const n of t){if(n===null||typeof n!="object")throw new Fe(n,`unexpected sequence element: ${n}`);r.push(this.parseJSON(n))}return r}else if("prim"in t){const r=t;if(typeof r.prim=="string"&&(r.annots===void 0||Array.isArray(r.annots))&&(r.args===void 0||Array.isArray(r.args))){const n={prim:r.prim};if(r.annots!==void 0){for(const i of r.annots)if(typeof i!="string")throw new Fe(i,`string expected: ${i}`);n.annots=r.annots}if(r.args!==void 0){n.args=[];for(const i of r.args){if(i===null||typeof i!="object")throw new Fe(i,`unexpected argument: ${i}`);n.args.push(this.parseJSON(i))}}return this.expand(n)}throw new Fe(t,`malformed prim expression: ${t}`)}else if("string"in t){if(typeof t.string=="string")return{string:t.string};throw new Fe(t,`malformed string literal: ${t}`)}else if("int"in t){if(typeof t.int=="string"&&wd.test(t.int))return{int:t.int};throw new Fe(t,`malformed int literal: ${t}`)}else if("bytes"in t){if(typeof t.bytes=="string"&&Td.test(t.bytes))return{bytes:t.bytes};throw new Fe(t,`malformed bytes literal: ${t}`)}else throw new Fe(t,`unexpected object: ${t}`)}}const Id=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Ld=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];class Xi extends at{constructor(t){super(),this.message=t,this.name="Base58DecodingError"}}function sa(e){const t=(e.length+9)%64,r=t===0?0:64-t;if(e.length>268435455)throw new gl("",`: Invalid length ${e.length} is too big -- SHA-256.`);const n=e.length<<3,i=[...e,128,...new Array(r).fill(0),0,0,0,0,n>>24&255,n>>16&255,n>>8&255,n&255];function s(l,g){return l>>>g|l<<32-g}const o=[...Id],a=new Array(64),c=new Array(8);for(let l=0;l<i.length;l+=64){let g=l,E=0;for(;E<16;)a[E]=i[g]<<24|i[g+1]<<16|i[g+2]<<8|i[g+3],g+=4,E++;for(;E<64;){const y=s(a[E-15],7)^s(a[E-15],18)^a[E-15]>>>3,v=s(a[E-2],17)^s(a[E-2],19)^a[E-2]>>>10;a[E]=(v|0)+a[E-7]+y+a[E-16]|0,E++}for(let y=0;y<8;y++)c[y]=o[y];for(let y=0;y<64;y++){const v=s(c[0],2)^s(c[0],13)^s(c[0],22),P=s(c[4],6)^s(c[4],11)^s(c[4],25),O=c[7]+P+(c[4]&c[5]^~c[4]&c[6])+Ld[y]+a[y]|0,S=v+(c[0]&c[1]^c[0]&c[2]^c[1]&c[2])|0;c[7]=c[6],c[6]=c[5],c[5]=c[4],c[4]=c[3]+O|0,c[3]=c[2],c[2]=c[1],c[1]=c[0],c[0]=O+S|0}for(let y=0;y<8;y++)o[y]=o[y]+c[y]|0}const u=[];for(const l of o)u.push(l>>24&255),u.push(l>>16&255),u.push(l>>8&255),u.push(l&255);return u}const Bi=[0,1,2,3,4,5,6,7,8,-1,-1,-1,-1,-1,-1,-1,9,10,11,12,13,14,15,16,-1,17,18,19,20,21,-1,22,23,24,25,26,27,28,29,30,31,32,-1,-1,-1,-1,-1,-1,33,34,35,36,37,38,39,40,41,42,43,-1,44,45,46,47,48,49,50,51,52,53,54,55,56,57];function oa(e,t){const r=e.charCodeAt(t)-49;if(r>=Bi.length||Bi[r]===-1)throw new Xi(`Unexpected character at position ${t}: ${e[t]}`);return Bi[r]}function Nd(e){const t=[];let r=0;for(;r<e.length&&oa(e,r)===0;)r++;let n=r;for(;r<e.length;){let i=oa(e,r++),s=0;for(;i!==0||s<t.length;){const o=(t[s]||0)*58+i;t[s++]=o%256,i=Math.floor(o/256)}}for(;n-- >0;)t.push(0);return t.reverse()}function cc(e){const t=Nd(e);if(t.length<4)throw new Xi(`Data is too short ${t.length}`);const r=t.slice(0,t.length-4),n=t.slice(t.length-4),i=sa(sa(r));if(n[0]!==i[0]||n[1]!==i[1]||n[2]!==i[2]||n[3]!==i[3])throw new Xi("Invalid checksum");return r}class xd extends q{constructor(t){super(),this.message=t,this.name="InvalidMichelsonError"}}class kd extends q{constructor(t){super(),this.message=t,this.name="InvalidTypeExpressionError"}}class Md extends q{constructor(t){super(),this.message=t,this.name="InvalidDataExpressionError"}}class Hd extends q{constructor(t){super(),this.entrypoint=t,this.name="InvalidEntrypointError",this.message=`Contract has no entrypoint named: "${t}"`}}class Dd extends at{constructor(t){super(),this.message=t,this.name="LongIntegerError"}}class Cd extends at{constructor(t){super(),this.hexByte=t,this.name="HexParseError",this.message=`Unable to parse hex byte "${t}"`}}class ee extends at{constructor(t,r){super(),this.val=t,this.message=r,this.name="MichelsonError"}}class H extends ee{constructor(t,r,n){super(t,r),this.val=t,this.message=r,this.name="MichelsonTypeError",n!==void 0&&(this.data=n)}}class uc{append(t){let r=0;for(;t!==0||r<this.buf.length;){const n=(this.buf[r]||0)*10+t;this.buf[r++]=n%256,t=Math.floor(n/256)}}constructor(t){if(this.neg=!1,this.buf=[],t!==void 0)if(typeof t=="string")for(let r=0;r<t.length;r++){const n=t.charCodeAt(r);if(r===0&&n===45)this.neg=!0;else{if(n<48||n>57)throw new Dd(`unexpected character in integer constant "${t[r]}"`);this.append(n-48)}}else t<0?(this.neg=!0,this.append(-t)):this.append(t)}cmp(t){if(this.neg!==t.neg)return(t.neg?1:0)-(this.neg?1:0);{let r=0;if(this.buf.length!==t.buf.length)r=this.buf.length<t.buf.length?-1:1;else if(this.buf.length!==0){let n=t.buf.length-1;for(;n>=0&&this.buf[n]===t.buf[n];)n--;r=n<0?0:this.buf[n]<t.buf[n]?-1:1}return this.neg?r===0?0:-r:r}}get sign(){return this.buf.length===0?0:this.neg?-1:1}}function Dr(e){const t=[];for(let r=0;r<e.length;r+=2){const n=parseInt(e.slice(r,r+2),16);if(Number.isNaN(n))return null;t.push(n)}return t}function Qi(e){try{return new uc(e),!0}catch{return!1}}function lc(e){try{return new uc(e).sign>=0}catch{return!1}}const Bd=/^(@%|@%%|%@|[@:%]([_0-9a-zA-Z][_0-9a-zA-Z.%@]*)?)$/;function Gr(e,t){if(Array.isArray(e))return{};let r,n,i;if(e.annots!==void 0){for(const s of e.annots)if(s.length!==0){if(!Bd.test(s)||!t?.specialVar&&(s==="@%"||s==="@%%")||!t?.specialFields&&s==="%@")throw new ee(e,`${e.prim}: unexpected annotation: ${s}`);switch(s[0]){case"%":(t?.emptyFields||s.length>1)&&(r=r||[],r.push(s));break;case":":s.length>1&&(n=n||[],n.push(s));break;case"@":(t?.emptyVar||s.length>1)&&(i=i||[],i.push(s));break}}}return{f:r,t:n,v:i}}const $d={BlockHash:[32,[1,52]],OperationHash:[32,[5,116]],OperationListHash:[32,[133,233]],OperationListListHash:[32,[29,159,109]],ProtocolHash:[32,[2,170]],ContextHash:[32,[79,199]],ED25519PublicKeyHash:[20,[6,161,159]],SECP256K1PublicKeyHash:[20,[6,161,161]],P256PublicKeyHash:[20,[6,161,164]],ContractHash:[20,[2,90,121]],CryptoboxPublicKeyHash:[16,[153,103]],ED25519Seed:[32,[13,15,58,7]],ED25519PublicKey:[32,[13,15,37,217]],SECP256K1SecretKey:[32,[17,162,224,201]],P256SecretKey:[32,[16,81,238,189]],ED25519EncryptedSeed:[56,[7,90,60,179,41]],SECP256K1EncryptedSecretKey:[56,[9,237,241,174,150]],P256EncryptedSecretKey:[56,[9,48,57,115,171]],SECP256K1PublicKey:[33,[3,254,226,86]],P256PublicKey:[33,[3,178,139,127]],SECP256K1Scalar:[33,[38,248,136]],SECP256K1Element:[33,[5,92,0]],ED25519SecretKey:[64,[43,246,78,7]],ED25519Signature:[64,[9,245,205,134,18]],SECP256K1Signature:[64,[13,115,101,19,63]],P256Signature:[64,[54,240,44,52]],GenericSignature:[64,[4,130,43]],ChainID:[4,[87,82,0]],RollupAddress:[20,[1,128,120,31]]};function De(e,...t){const r=cc(e);for(const n of t){const[i,s]=$d[n];if(r.length===i+s.length){let o=0;for(;o<s.length&&r[o]===s[o];)o++;if(o===s.length)return[n,r.slice(s.length)]}}return null}function Ft(e,t){const r=t,n=Array.isArray(r)?r:r.args;return n.length===2?e==="pair"?{prim:"pair",args:n}:{prim:"Pair",args:n}:Object.assign(Object.assign({},Array.isArray(r)?{prim:e}:r),{args:[n[0],{prim:e,args:n.slice(1)}]})}function Ce(e){return Array.isArray(e)||e.prim==="pair"}function ts(e){return Array.isArray(e)||"prim"in e&&e.prim==="Pair"}const Ud=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])[T ]([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):([0-5][0-9]))$/;function hc(e){if("string"in e){if(lc(e.string))return new Date(parseInt(e.string,10));if(Ud.test(e.string)){const t=new Date(e.string);if(!Number.isNaN(t.valueOf))return t}}else if(Qi(e.int))return new Date(parseInt(e.int,10));return null}function Gd(e){const t=[];for(let r=0;r<e.length;r+=2){const n=e.slice(r,r+2),i=parseInt(n,16);if(Number.isNaN(i))throw new Cd(n);t.push(i)}return t}function Nr(e){return e.map(t=>(t>>4&15).toString(16)+(t&15).toString(16)).join("")}const Kd=31,dc={ABS:!0,ADD:!0,ADDRESS:!0,AMOUNT:!0,AND:!0,APPLY:!0,BALANCE:!0,BLAKE2B:!0,CAR:!0,CDR:!0,CHAIN_ID:!0,CHECK_SIGNATURE:!0,COMPARE:!0,CONCAT:!0,CONS:!0,EDIV:!0,EQ:!0,EXEC:!0,FAILWITH:!0,GE:!0,GET_AND_UPDATE:!0,GT:!0,HASH_KEY:!0,IMPLICIT_ACCOUNT:!0,INT:!0,ISNAT:!0,JOIN_TICKETS:!0,KECCAK:!0,LE:!0,LEVEL:!0,LSL:!0,LSR:!0,LT:!0,MEM:!0,MUL:!0,NEG:!0,NEQ:!0,NEVER:!0,NOT:!0,NOW:!0,OR:!0,PACK:!0,PAIRING_CHECK:!0,READ_TICKET:!0,SAPLING_VERIFY_UPDATE:!0,SELF:!0,SELF_ADDRESS:!0,SENDER:!0,SET_DELEGATE:!0,SHA256:!0,SHA3:!0,SHA512:!0,SIZE:!0,SLICE:!0,SOME:!0,SOURCE:!0,SPLIT_TICKET:!0,SUB:!0,SWAP:!0,TICKET:!0,TICKET_DEPRECATED:!0,TOTAL_VOTING_POWER:!0,TRANSFER_TOKENS:!0,UNIT:!0,VOTING_POWER:!0,XOR:!0,RENAME:!0,OPEN_CHEST:!0,SUB_MUTEZ:!0,MIN_BLOCK_TIME:!0,BYTES:!0,NAT:!0,IS_IMPLICIT_ACCOUNT:!0},pc=Object.assign({},dc,{CONTRACT:!0,CREATE_CONTRACT:!0,DIG:!0,DIP:!0,DROP:!0,DUG:!0,DUP:!0,EMIT:!0,EMPTY_BIG_MAP:!0,EMPTY_MAP:!0,EMPTY_SET:!0,GET:!0,IF:!0,IF_CONS:!0,IF_LEFT:!0,IF_NONE:!0,ITER:!0,LAMBDA:!0,LAMBDA_REC:!0,LEFT:!0,LOOP:!0,LOOP_LEFT:!0,MAP:!0,NIL:!0,NONE:!0,PAIR:!0,PUSH:!0,RIGHT:!0,SAPLING_EMPTY_STATE:!0,UNPACK:!0,UNPAIR:!0,UPDATE:!0,CAST:!0,VIEW:!0}),fc={unit:!0,never:!0,bool:!0,int:!0,nat:!0,string:!0,chain_id:!0,bytes:!0,mutez:!0,key_hash:!0,key:!0,signature:!0,timestamp:!0,address:!0,tx_rollup_l2_address:!0},zr=Object.assign({},fc,{or:!0,pair:!0,set:!0,big_map:!0,contract:!0,lambda:!0,list:!0,map:!0,operation:!0,option:!0,bls12_381_g1:!0,bls12_381_g2:!0,bls12_381_fr:!0,sapling_transaction:!0,sapling_transaction_deprecated:!0,sapling_state:!0,ticket:!0,chest_key:!0,chest:!0});class et extends ee{constructor(t,r){super(t,r),this.val=t,this.message=r,this.name="MichelsonValidationError"}}function Ae(e){return"prim"in e}function jd(e){return Array.isArray(e)||"prim"in e}function gc(e){if(Ae(e))return!0;throw new et(e,"prim expression expected")}function tr(e){if(Array.isArray(e))return!0;throw new et(e,"sequence expression expected")}function Mt(e){if(jd(e))return!0;throw new et(e,"prim or sequence expression expected")}function $i(e){if(e.int[0]==="-")throw new et(e,"natural number expected")}function on(e){if("int"in e)return!0;throw new et(e,"int literal expected")}function mc(e){if("string"in e)return!0;throw new et(e,"string literal expected")}function Fd(e){if("string"in e||"bytes"in e)return!0;throw new et(e,"string or bytes literal expected")}function W(e,t){var r;if(t===0&&e.args===void 0||((r=e.args)===null||r===void 0?void 0:r.length)===t)return!0;throw new et(e,`${t} arguments expected`)}function qt(e){var t,r;if(Array.isArray(e)){for(const n of e){if(!Array.isArray(n)&&!Ae(n))throw new et(e,"sequence or prim expected");qt(n)}return!0}if(gc(e)){if(Object.prototype.hasOwnProperty.call(dc,e.prim))return W(e,0),!0;switch(e.prim){case"DROP":case"PAIR":case"UNPAIR":case"DUP":case"UPDATE":case"GET":e.args!==void 0&&W(e,1)&&on(e.args[0])&&$i(e.args[0]);break;case"DIG":case"DUG":case"SAPLING_EMPTY_STATE":W(e,1)&&on(e.args[0])&&$i(e.args[0]);break;case"NONE":case"LEFT":case"RIGHT":case"NIL":case"CAST":W(e,1)&&_e(e.args[0]);break;case"UNPACK":W(e,1)&&Os(e.args[0]);break;case"CONTRACT":W(e,1)&&ai(e.args[0]);break;case"IF_NONE":case"IF_LEFT":case"IF_CONS":case"IF":W(e,2)&&(tr(e.args[0])&&qt(e.args[0]),tr(e.args[1])&&qt(e.args[1]));break;case"MAP":case"ITER":case"LOOP":case"LOOP_LEFT":W(e,1)&&qt(e.args[0]);break;case"CREATE_CONTRACT":W(e,1)&&Ec(e.args[0]);break;case"DIP":if(((t=e.args)===null||t===void 0?void 0:t.length)===2)on(e.args[0])&&$i(e.args[0]),tr(e.args[1])&&qt(e.args[1]);else if(((r=e.args)===null||r===void 0?void 0:r.length)===1)tr(e.args[0])&&qt(e.args[0]);else throw new et(e,"1 or 2 arguments expected");break;case"PUSH":W(e,2)&&(Kr(e.args[0]),ze(e.args[1]));break;case"EMPTY_SET":W(e,1)&&Ge(e.args[0]);break;case"EMPTY_MAP":W(e,2)&&(Ge(e.args[0]),_e(e.args[1]));break;case"EMPTY_BIG_MAP":W(e,2)&&(Ge(e.args[0]),ci(e.args[1]));break;case"LAMBDA_REC":case"LAMBDA":W(e,3)&&(_e(e.args[0]),_e(e.args[1]),tr(e.args[2])&&qt(e.args[2]));break;case"VIEW":W(e,2)&&(mc(e.args[0])&&yc(e.args[0]),_e(e.args[1])&&Kr(e.args[1]));break;case"EMIT":e.args&&e.args.length>0?W(e,1):W(e,0);break;default:throw new et(e,"instruction expected")}}return!0}function Ge(e){if(Mt(e)){if(Array.isArray(e)||e.prim==="pair"||e.prim==="or"||e.prim==="option")Tr(e,t=>Ge(t));else if(!Object.prototype.hasOwnProperty.call(fc,e.prim))throw new et(e,`${e.prim}: type is not comparable`)}return!0}function Os(e){if(Mt(e)&&Ae(e)){if(!Object.prototype.hasOwnProperty.call(zr,e.prim)||e.prim==="big_map"||e.prim==="operation"||e.prim==="sapling_state"||e.prim==="ticket")throw new et(e,`${e.prim}: type can't be used inside PACK/UNPACK instructions`);Tr(e,t=>Os(t))}return!0}function Kr(e){if(Mt(e)&&Ae(e)){if(!Object.prototype.hasOwnProperty.call(zr,e.prim)||e.prim==="big_map"||e.prim==="operation"||e.prim==="sapling_state"||e.prim==="ticket"||e.prim==="contract")throw new et(e,`${e.prim}: type can't be pushed`);Tr(e,t=>Kr(t))}return!0}function ws(e){if(Mt(e)&&Ae(e)){if(!Object.prototype.hasOwnProperty.call(zr,e.prim)||e.prim==="operation"||e.prim==="contract")throw new et(e,`${e.prim}: type can't be used as part of a storage`);Tr(e,t=>ws(t))}return!0}function ai(e){if(Mt(e)&&Ae(e)){if(!Object.prototype.hasOwnProperty.call(zr,e.prim)||e.prim==="operation")throw new et(e,`${e.prim}: type can't be used as part of a parameter`);Tr(e,t=>ai(t))}return!0}function ci(e){if(Mt(e)&&Ae(e)){if(!Object.prototype.hasOwnProperty.call(zr,e.prim)||e.prim==="big_map"||e.prim==="operation"||e.prim==="sapling_state")throw new et(e,`${e.prim}: type can't be used inside a big_map`);Tr(e,t=>ci(t))}return!0}const Vd=new RegExp("^[a-zA-Z0-9_.%@]*$");function yc(e){if(e.string.length>Kd)throw new et(e,`view name too long: ${e.string}`);if(!Vd.test(e.string))throw new et(e,`invalid character(s) in view name: ${e.string}`)}function _e(e){if(Mt(e)&&Ae(e)){if(!Object.prototype.hasOwnProperty.call(zr,e.prim))throw new et(e,"type expected");Tr(e,t=>_e(t))}return!0}function Tr(e,t){if(Array.isArray(e)||e.prim==="pair"){const r=Array.isArray(e)?e:e.args;if(r===void 0||r.length<2)throw new et(e,"at least 2 arguments expected");return r.forEach(n=>{Mt(n)&&t(n)}),!0}switch(e.prim){case"option":case"list":W(e,1)&&Mt(e.args[0])&&t(e.args[0]);break;case"contract":W(e,1)&&ai(e.args[0]);break;case"or":W(e,2)&&Mt(e.args[0])&&Mt(e.args[1])&&(t(e.args[0]),t(e.args[1]));break;case"lambda":W(e,2)&&(_e(e.args[0]),_e(e.args[1]));break;case"set":W(e,1)&&Ge(e.args[0]);break;case"map":W(e,2)&&Mt(e.args[0])&&Mt(e.args[1])&&(Ge(e.args[0]),t(e.args[1]));break;case"big_map":W(e,2)&&Mt(e.args[0])&&Mt(e.args[1])&&(Ge(e.args[0]),ci(e.args[1]),t(e.args[1]));break;case"ticket":W(e,1)&&Mt(e.args[0])&&Ge(e.args[0]);break;case"sapling_state":case"sapling_transaction":W(e,1)&&on(e.args[0]);break;default:W(e,0)}return!0}function ze(e){if("int"in e||"string"in e||"bytes"in e)return!0;if(Array.isArray(e)){let t=0;for(const r of e)Ae(r)&&r.prim==="Elt"?(W(r,2)&&(ze(r.args[0]),ze(r.args[1])),t++):ze(r);if(t!==0&&t!==e.length)throw new et(e,"data entries and map elements can't be intermixed");return!0}if(Ae(e))switch(e.prim){case"Unit":case"True":case"False":case"None":W(e,0);break;case"Pair":if(e.args===void 0||e.args.length<2)throw new et(e,"at least 2 arguments expected");for(const t of e.args)ze(t);break;case"Left":case"Right":case"Some":W(e,1)&&ze(e.args[0]);break;case"Lambda_rec":e.args&&qt(e.args);break;case"Ticket":W(e,4)&&(Fd(e.args[0]),_e(e.args[1]),ze(e.args[2]),on(e.args[3]));break;default:if(Object.prototype.hasOwnProperty.call(pc,e.prim))qt(e);else throw new et(e,"data entry or instruction expected")}else throw new et(e,"data entry expected");return!0}function Ec(e){if(tr(e)){const t={},r={};for(const n of e)if(gc(n)){if(n.prim!=="view"){if(n.prim in t)throw new et(e,`duplicate contract section: ${n.prim}`);t[n.prim]=!0}switch(n.prim){case"code":W(n,1)&&tr(n.args[0])&&qt(n.args[0]);break;case"parameter":if(W(n,1)&&ai(n.args[0]),n.annots)throw new et(n,"Annotation must be part of the parameter type");break;case"storage":W(n,1)&&ws(n.args[0]);break;case"view":if(W(n,4)){if(mc(n.args[0])){const i=n.args[0];if(i.string in r)throw new et(e,`duplicate view name: ${i.string}`);r[i.string]=!0,yc(i)}Kr(n.args[1]),Kr(n.args[2]),tr(n.args[3])&&qt(n.args[3])}break;default:throw new et(e,`unexpected contract section: ${n.prim}`)}}}return!0}function _c(e){return Object.prototype.hasOwnProperty.call(pc,e.prim)}function es(e){if(!Array.isArray(e))return!1;for(const t of e)if("prim"in t){if(_c(t))throw new ee(e,`Instruction outside of a lambda: ${JSON.stringify(e)}`);if(t.prim==="Elt")throw new ee(e,`Elt item outside of a map literal: ${JSON.stringify(e)}`)}return!0}function Zd(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}const zd=["parameter","storage","code","False","Elt","Left","None","Pair","Right","Some","True","Unit","PACK","UNPACK","BLAKE2B","SHA256","SHA512","ABS","ADD","AMOUNT","AND","BALANCE","CAR","CDR","CHECK_SIGNATURE","COMPARE","CONCAT","CONS","CREATE_ACCOUNT","CREATE_CONTRACT","IMPLICIT_ACCOUNT","DIP","DROP","DUP","EDIV","EMPTY_MAP","EMPTY_SET","EQ","EXEC","FAILWITH","GE","GET","GT","HASH_KEY","IF","IF_CONS","IF_LEFT","IF_NONE","INT","LAMBDA","LE","LEFT","LOOP","LSL","LSR","LT","MAP","MEM","MUL","NEG","NEQ","NIL","NONE","NOT","NOW","OR","PAIR","PUSH","RIGHT","SIZE","SOME","SOURCE","SENDER","SELF","STEPS_TO_QUOTA","SUB","SWAP","TRANSFER_TOKENS","SET_DELEGATE","UNIT","UPDATE","XOR","ITER","LOOP_LEFT","ADDRESS","CONTRACT","ISNAT","CAST","RENAME","bool","contract","int","key","key_hash","lambda","list","map","big_map","nat","option","or","pair","set","signature","string","bytes","mutez","timestamp","unit","operation","address","SLICE","DIG","DUG","EMPTY_BIG_MAP","APPLY","chain_id","CHAIN_ID","LEVEL","SELF_ADDRESS","never","NEVER","UNPAIR","VOTING_POWER","TOTAL_VOTING_POWER","KECCAK","SHA3","PAIRING_CHECK","bls12_381_g1","bls12_381_g2","bls12_381_fr","sapling_state","sapling_transaction_deprecated","SAPLING_EMPTY_STATE","SAPLING_VERIFY_UPDATE","ticket","TICKET_DEPRECATED","READ_TICKET","SPLIT_TICKET","JOIN_TICKETS","GET_AND_UPDATE","chest","chest_key","OPEN_CHEST","VIEW","view","constant","SUB_MUTEZ","tx_rollup_l2_address","MIN_BLOCK_TIME","sapling_transaction","EMIT","Lambda_rec","LAMBDA_REC","TICKET","BYTES","NAT","Ticket","IS_IMPLICIT_ACCOUNT"],Wd=Object.assign({},...zd.map((e,t)=>({[e]:t})));var We;(function(e){e[e.Int=0]="Int",e[e.String=1]="String",e[e.Sequence=2]="Sequence",e[e.Prim0=3]="Prim0",e[e.Prim0Annot=4]="Prim0Annot",e[e.Prim1=5]="Prim1",e[e.Prim1Annot=6]="Prim1Annot",e[e.Prim2=7]="Prim2",e[e.Prim2Annot=8]="Prim2Annot",e[e.Prim=9]="Prim",e[e.Bytes=10]="Bytes"})(We||(We={}));class Cr{constructor(){this.buffer=[]}get length(){return this.buffer.length}writeBytes(t){this.buffer.push(...t.map(r=>r&255))}writeUint8(t){const r=t|0;this.buffer.push(r&255)}writeUint16(t){const r=t|0;this.buffer.push(r>>8&255),this.buffer.push(r&255)}writeUint32(t){const r=t|0;this.buffer.push(r>>24&255),this.buffer.push(r>>16&255),this.buffer.push(r>>8&255),this.buffer.push(r&255)}writeInt8(t){this.writeUint8(t)}writeInt16(t){this.writeUint16(t)}writeInt32(t){this.writeUint32(t)}}const Ve=new Error("bounds out of range");class jr{constructor(t,r=0,n=t.length){this.buffer=t,this.idx=r,this.cap=n}get length(){return this.cap-this.idx}readBytes(t){if(this.cap-this.idx<t)throw Ve;const r=this.buffer.slice(this.idx,this.idx+t);return this.idx+=t,r}reader(t){if(this.cap-this.idx<t)throw Ve;const r=new jr(this.buffer,this.idx,this.idx+t);return this.idx+=t,r}copy(){return new jr(this.buffer,this.idx,this.cap)}readUint8(){if(this.cap-this.idx<1)throw Ve;return this.buffer[this.idx++]>>>0}readUint16(){if(this.cap-this.idx<2)throw Ve;const t=this.buffer[this.idx++],r=this.buffer[this.idx++];return(t<<8|r)>>>0}readUint32(){if(this.cap-this.idx<4)throw Ve;const t=this.buffer[this.idx++],r=this.buffer[this.idx++],n=this.buffer[this.idx++],i=this.buffer[this.idx++];return(t<<24|r<<16|n<<8|i)>>>0}readInt8(){if(this.cap-this.idx<1)throw Ve;return this.buffer[this.idx++]<<24>>24}readInt16(){if(this.cap-this.idx<2)throw Ve;const t=this.buffer[this.idx++],r=this.buffer[this.idx++];return(t<<8|r)<<16>>16}readInt32(){if(this.cap-this.idx<4)throw Ve;const t=this.buffer[this.idx++],r=this.buffer[this.idx++],n=this.buffer[this.idx++],i=this.buffer[this.idx++];return t<<24|r<<16|n<<8|i}}var Fr;(function(e){e[e.Implicit=0]="Implicit",e[e.Originated=1]="Originated"})(Fr||(Fr={}));var ir;(function(e){e[e.ED25519=0]="ED25519",e[e.SECP256K1=1]="SECP256K1",e[e.P256=2]="P256"})(ir||(ir={}));function bc(e){let t;const r=e.readUint8();switch(r){case ir.ED25519:t="ED25519PublicKeyHash";break;case ir.SECP256K1:t="SECP256K1PublicKeyHash";break;case ir.P256:t="P256PublicKeyHash";break;default:throw new Error(`unknown public key hash tag: ${r}`)}return{type:t,hash:e.readBytes(20)}}function Jd(e){let t;const r=e.readUint8();switch(r){case Fr.Implicit:t=bc(e);break;case Fr.Originated:t={type:"ContractHash",hash:e.readBytes(20)},e.readBytes(1);break;default:throw new Error(`unknown address tag: ${r}`)}if(e.length!==0){const n=new TextDecoder;t.entryPoint=n.decode(new Uint8Array(e.readBytes(e.length)))}return t}function vc(e,t){let r;switch(e.type){case"ED25519PublicKeyHash":r=ir.ED25519;break;case"SECP256K1PublicKeyHash":r=ir.SECP256K1;break;case"P256PublicKeyHash":r=ir.P256;break;default:throw new Error(`unexpected address type: ${e.type}`)}t.writeUint8(r),t.writeBytes(Array.from(e.hash))}function qd(e,t){if(e.type==="ContractHash"?(t.writeUint8(Fr.Originated),t.writeBytes(Array.from(e.hash)),t.writeUint8(0)):(t.writeUint8(Fr.Implicit),vc(e,t)),e.entryPoint!==void 0&&e.entryPoint!==""&&e.entryPoint!=="default"){const n=new TextEncoder().encode(e.entryPoint);t.writeBytes(Array.from(n))}}var sr;(function(e){e[e.ED25519=0]="ED25519",e[e.SECP256K1=1]="SECP256K1",e[e.P256=2]="P256"})(sr||(sr={}));function Yd(e){let t,r;const n=e.readUint8();switch(n){case sr.ED25519:r="ED25519PublicKey",t=32;break;case sr.SECP256K1:r="SECP256K1PublicKey",t=33;break;case sr.P256:r="P256PublicKey",t=33;break;default:throw new Error(`unknown public key tag: ${n}`)}return{type:r,publicKey:e.readBytes(t)}}function Xd(e,t){let r;switch(e.type){case"ED25519PublicKey":r=sr.ED25519;break;case"SECP256K1PublicKey":r=sr.SECP256K1;break;case"P256PublicKey":r=sr.P256;break;default:throw new Error(`unexpected public key type: ${e.type}`)}t.writeUint8(r),t.writeBytes(Array.from(e.publicKey))}function Hn(e,t,r){var n,i;const[s,o]=r(e);if(Array.isArray(s)){const u=new Cr;for(const l of s){const g=o.next();if(g.done)throw new Error("REPORT ME: iterator is done");Hn(l,u,g.value)}t.writeUint8(We.Sequence),t.writeUint32(u.length),t.writeBytes(u.buffer);return}if("string"in s){const l=new TextEncoder().encode(s.string);t.writeUint8(We.String),t.writeUint32(l.length),t.writeBytes(Array.from(l));return}if("int"in s){t.writeUint8(We.Int);let u=BigInt(s.int);const l=u<0;l&&(u=-u);let g=0;do{const E=BigInt(g===0?6:7);let y=u&(BigInt(1)<<E)-BigInt(1);u>>=E,u&&(y|=BigInt(128)),g===0&&l&&(y|=BigInt(64)),t.writeUint8(Number(y)),g++}while(u);return}if("bytes"in s){const u=Gd(s.bytes);t.writeUint8(We.Bytes),t.writeUint32(u.length),t.writeBytes(u);return}const a=Wd[s.prim];if(a===void 0)throw new TypeError(`Can't encode primary: ${s.prim}`);const c=(((n=s.args)===null||n===void 0?void 0:n.length)||0)<3?We.Prim0+(((i=s.args)===null||i===void 0?void 0:i.length)||0)*2+(s.annots===void 0||s.annots.length===0?0:1):We.Prim;if(t.writeUint8(c),t.writeUint8(a),s.args!==void 0)if(s.args.length<3)for(const u of s.args){const l=o.next();if(l.done)throw new Error("REPORT ME: iterator is done");Hn(u,t,l.value)}else{const u=new Cr;for(const l of s.args){const g=o.next();if(g.done)throw new Error("REPORT ME: iterator is done");Hn(l,u,g.value)}t.writeUint32(u.length),t.writeBytes(u.buffer)}if(s.annots!==void 0&&s.annots.length!==0){const l=new TextEncoder().encode(s.annots.join(" "));t.writeUint32(l.length),t.writeBytes(Array.from(l))}else s.args!==void 0&&s.args.length>=3&&t.writeUint32(0)}const Qd=e=>"prim"in e&&(e.prim==="Left"||e.prim==="Right"),tp=e=>"prim"in e&&(e.prim==="Some"||e.prim==="None"),yr=e=>{if(Ce(e))return t=>{if(!ts(t))throw new H(e,`pair expected: ${JSON.stringify(t)}`,t);es(t);const r=Ft("pair",e);return[Ft("Pair",t),function*(){for(const i of r.args)yield yr(i)}()]};switch(e.prim){case"or":return t=>{if(!Qd(t))throw new H(e,`or expected: ${JSON.stringify(t)}`,t);return[t,function*(){yield yr(e.args[t.prim==="Left"?0:1])}()]};case"option":return t=>{if(!tp(t))throw new H(e,`option expected: ${JSON.stringify(t)}`,t);return[t,function*(){t.prim==="Some"&&(yield yr(e.args[0]))}()]};case"list":case"set":return t=>{if(!Array.isArray(t))throw new H(e,`${e.prim} expected: ${JSON.stringify(t)}`,t);return[t,function*(){for(const r of t)yield yr(e.args[0])}()]};case"map":return t=>{if(!Array.isArray(t))throw new H(e,`map expected: ${JSON.stringify(t)}`,t);return[t,function*(){for(const r of t)yield n=>{if(!("prim"in n)||n.prim!=="Elt")throw new H(e,`map element expected: ${JSON.stringify(n)}`,n);return[n,function*(){for(const i of e.args)yield yr(i)}()]}}()]};case"chain_id":return t=>{if(!("bytes"in t)&&!("string"in t))throw new H(e,`chain id expected: ${JSON.stringify(t)}`,t);let r;if("string"in t){const n=De(t.string,"ChainID");if(n===null)throw new H(e,`chain id base58 expected: ${t.string}`,t);r={bytes:Nr(n[1])}}else r=t;return[r,[][Symbol.iterator]()]};case"signature":return t=>{if(!("bytes"in t)&&!("string"in t))throw new H(e,`signature expected: ${JSON.stringify(t)}`,t);let r;if("string"in t){const n=De(t.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature");if(n===null)throw new H(e,`signature base58 expected: ${t.string}`,t);r={bytes:Nr(n[1])}}else r=t;return[r,[][Symbol.iterator]()]};case"key_hash":return t=>{if(!("bytes"in t)&&!("string"in t))throw new H(e,`key hash expected: ${JSON.stringify(t)}`,t);let r;if("string"in t){const n=De(t.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash");if(n===null)throw new H(e,`key hash base58 expected: ${t.string}`,t);const i=new Cr;vc({type:n[0],hash:n[1]},i),r={bytes:Nr(i.buffer)}}else r=t;return[r,[][Symbol.iterator]()]};case"key":return t=>{if(!("bytes"in t)&&!("string"in t))throw new H(e,`public key expected: ${JSON.stringify(t)}`,t);let r;if("string"in t){const n=De(t.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey");if(n===null)throw new H(e,`public key base58 expected: ${t.string}`,t);const i=new Cr;Xd({type:n[0],publicKey:n[1]},i),r={bytes:Nr(i.buffer)}}else r=t;return[r,[][Symbol.iterator]()]};case"address":return t=>{if(!("bytes"in t)&&!("string"in t))throw new H(e,`address expected: ${JSON.stringify(t)}`,t);let r;if("string"in t){const n=t.string.split("%"),i=De(n[0],"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash");if(i===null)throw new H(e,`address base58 expected: ${t.string}`,t);const s=new Cr;qd({type:i[0],hash:i[1],entryPoint:n.length>1?n[1]:void 0},s),r={bytes:Nr(s.buffer)}}else r=t;return[r,[][Symbol.iterator]()]};case"timestamp":return t=>{if(!("string"in t)&&!("int"in t))throw new H(e,`timestamp expected: ${JSON.stringify(t)}`,t);let r;if("string"in t){const n=hc(t);if(n===null)throw new H(e,`can't parse date: ${t.string}`,t);r={int:String(Math.floor(n.getTime()/1e3))}}else r=t;return[r,[][Symbol.iterator]()]};default:return Fn}},ep=e=>"prim"in e&&e.prim==="PUSH",Fn=e=>ep(e)?(qt(e),[e,function*(){yield Fn,yield yr(e.args[0])}()]):[e,function*(){for(;;)yield Fn}()];function rp(e,t){const r=new Cr;return r.writeUint8(5),Hn(e,r,t!==void 0?yr(t):Fn),r.buffer}function np(e,t){return{bytes:Nr(rp(e,t))}}function ip(e){const t=Dr(e.bytes);if(t===null)throw new Error(`can't parse bytes: "${e.bytes}"`);const r=new jr(new Uint8Array(t));return Jd(r)}function sp(e){const t=Dr(e.bytes);if(t===null)throw new Error(`can't parse bytes: "${e.bytes}"`);const r=new jr(new Uint8Array(t));return bc(r)}function op(e){const t=Dr(e.bytes);if(t===null)throw new Error(`can't parse bytes: "${e.bytes}"`);const r=new jr(new Uint8Array(t));return Yd(r)}class V extends ee{constructor(t,r,n){super(t,n),this.val=t,this.stackState=r,this.message=n,this.name="MichelsonInstructionError"}}function tt(e){return Array.isArray(e)?"pair":e.prim}function Vn(e){return"prim"in e?e.args:e}function Yt(e,t,r=!1){if(tt(e)!==tt(t))throw new H(e,`types mismatch: ${tt(e)} != ${tt(t)}`,void 0);const n=[Gr(e),Gr(t)];if(n[0].t&&n[1].t&&n[0].t[0]!==n[1].t[0])throw new H(e,`${tt(e)}: type names mismatch: ${n[0].t[0]} != ${n[1].t[0]}`,void 0);if(r&&n[0].f&&n[1].f&&n[0].f[0]!==n[1].f[0])throw new H(e,`${tt(e)}: field names mismatch: ${n[0].f[0]} != ${n[1].f}`,void 0);if(Ce(e)){const i=Ft("pair",e),s=Ft("pair",t);Yt(i.args[0],s.args[0],!0),Yt(i.args[1],s.args[1],!0);return}switch(e.prim){case"option":case"list":case"contract":case"set":case"ticket":Yt(e.args[0],t.args[0]);break;case"or":Yt(e.args[0],t.args[0],!0),Yt(e.args[1],t.args[1],!0);break;case"lambda":case"map":case"big_map":Yt(e.args[0],t.args[0]),Yt(e.args[1],t.args[1]);break;case"sapling_state":case"sapling_transaction":if(parseInt(e.args[0].int,10)!==parseInt(t.args[0].int,10))throw new H(e,`${tt(e)}: type argument mismatch: ${e.args[0].int} != ${t.args[0].int}`,void 0)}}function Ac(e,t){if(e.length!==t.length)throw new H(e,`stack length mismatch: ${e.length} != ${t.length}`,void 0);for(let r=0;r<e.length;r++)Yt(e[r],t[r])}function it(e,t=!1){var r,n,i;if(!Array.isArray(e)){const s=Gr(e);if((((r=s.t)===null||r===void 0?void 0:r.length)||0)>1)throw new H(e,`${e.prim}: at most one type annotation allowed: ${e.annots}`,void 0);if(t){if((((n=s.f)===null||n===void 0?void 0:n.length)||0)>1)throw new H(e,`${e.prim}: at most one field annotation allowed: ${e.annots}`,void 0)}else if((((i=s.f)===null||i===void 0?void 0:i.length)||0)>0)throw new H(e,`${e.prim}: field annotations aren't allowed: ${e.annots}`,void 0)}if(Ce(e)){const s=Vn(e);for(const o of s)it(o,!0);return}switch(e.prim){case"option":case"list":case"contract":case"set":it(e.args[0]);break;case"or":for(const s of e.args)it(s,!0);break;case"lambda":case"map":case"big_map":it(e.args[0]),it(e.args[1])}}function Sc(e){if(!Array.isArray(e))return!1;for(const t of e)if(!(Array.isArray(t)&&Sc(t)||"prim"in t&&_c(t)))return!1;return!0}function Ut(e,t,r){if(Ce(t)){if(ts(e)){es(e);const n=Ft("Pair",e),i=Ft("pair",t);Ut(n.args[0],i.args[0],r),Ut(n.args[1],i.args[1],r);return}throw new H(t,`pair expected: ${JSON.stringify(e)}`,e)}switch(t.prim){case"int":if("int"in e&&Qi(e.int))return;throw new H(t,`integer value expected: ${JSON.stringify(e)}`,e);case"nat":case"mutez":if("int"in e&&lc(e.int))return;throw new H(t,`natural value expected: ${JSON.stringify(e)}`,e);case"string":if("string"in e)return;throw new H(t,`string value expected: ${JSON.stringify(e)}`,e);case"bytes":case"bls12_381_g1":case"bls12_381_g2":if("bytes"in e&&Dr(e.bytes)!==null)return;throw new H(t,`bytes value expected: ${JSON.stringify(e)}`,e);case"bool":if("prim"in e&&(e.prim==="True"||e.prim==="False"))return;throw new H(t,`boolean value expected: ${JSON.stringify(e)}`,e);case"key_hash":if("string"in e&&De(e.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash")!==null)return;if("bytes"in e)try{sp(e);return}catch{}throw new H(t,`key hash expected: ${JSON.stringify(e)}`,e);case"timestamp":if(("string"in e||"int"in e)&&hc(e)!==null)return;throw new H(t,`timestamp expected: ${JSON.stringify(e)}`,e);case"address":if("string"in e){let n=e.string;const i=e.string.indexOf("%");if(i>=0&&(n=e.string.slice(0,i)),De(n,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash","RollupAddress")!==null)return}else if("bytes"in e)try{ip(e);return}catch{}throw new H(t,`address expected: ${JSON.stringify(e)}`,e);case"key":if("string"in e&&De(e.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey")!==null)return;if("bytes"in e)try{op(e);return}catch{}throw new H(t,`public key expected: ${JSON.stringify(e)}`,e);case"unit":if("prim"in e&&e.prim==="Unit")return;throw new H(t,`unit value expected: ${JSON.stringify(e)}`,e);case"signature":if("bytes"in e||"string"in e&&De(e.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature")!==null)return;throw new H(t,`signature expected: ${JSON.stringify(e)}`,e);case"chain_id":if(("bytes"in e||"string"in e)&&("string"in e?cc(e.string):Dr(e.bytes))!==null)return;throw new H(t,`chain id expected: ${JSON.stringify(e)}`,e);case"option":if("prim"in e){if(e.prim==="None")return;if(e.prim==="Some"){Ut(e.args[0],t.args[0],r);return}}throw new H(t,`option expected: ${JSON.stringify(e)}`,e);case"list":case"set":if(es(e)){for(const n of e)Ut(n,t.args[0],r);return}throw new H(t,`${t.prim} expected: ${JSON.stringify(e)}`,e);case"or":if("prim"in e){if(e.prim==="Left"){Ut(e.args[0],t.args[0],r);return}else if(e.prim==="Right"){Ut(e.args[0],t.args[1],r);return}}throw new H(t,`union (or) expected: ${JSON.stringify(e)}`,e);case"lambda":if(Sc(e)){const n=St(e,[t.args[0]],r);if("failed"in n)throw new H(t,`function is failed with error type: ${n.failed}`,e);if(n.length!==1)throw new H(t,"function must return a value",e);Yt(t.args[1],n[0]);return}throw new H(t,`function expected: ${JSON.stringify(e)}`,e);case"map":case"big_map":if(Array.isArray(e)){for(const n of e){if(!("prim"in n)||n.prim!=="Elt")throw new H(t,`map elements expected: ${JSON.stringify(e)}`,e);Ut(n.args[0],t.args[0],r),Ut(n.args[1],t.args[1],r)}return}throw new H(t,`${t.prim} expected: ${JSON.stringify(e)}`,e);case"bls12_381_fr":if("int"in e&&Qi(e.int)||"bytes"in e&&Dr(e.bytes)!==null)return;throw new H(t,`BLS12-381 element expected: ${JSON.stringify(e)}`,e);case"sapling_state":if(Array.isArray(e))return;throw new H(t,`sapling state expected: ${JSON.stringify(e)}`,e);case"ticket":if("prim"in e&&e.prim==="Ticket"){Ut(e.args[0],{prim:"address"},r),hp(e.args[1],t.args[0]),Ut(e.args[2],t.args[0],r),Ut(e.args[3],{prim:"nat"},r);return}else if(ts(e)){Ut(e,{prim:"pair",args:[{prim:"address"},t.args[0],{prim:"nat"}]},r);return}throw new H(t,`ticket expected: ${JSON.stringify(e)}`,e);default:throw new H(t,`type ${tt(t)} don't have Michelson literal representation`,e)}}function ap(e,t,r){let n=t,i=t,s=0;for(const o of e){const a=St(o,i,r);if(n=a,"failed"in a)break;i=a,s++}if("failed"in n&&n.level==0&&(!("prim"in n.failed)||n.failed.prim!=="never")&&s!==e.length-1)throw new V(e,n,"FAIL must appear in a tail position");if(r?.traceCallback!==void 0){const o={op:e,in:t,out:n};r.traceCallback(o)}return"failed"in n?{failed:n.failed,level:n.level+1}:n}function St(e,t,r){const n=r?.protocol||ac;if(Array.isArray(e))return ap(e,t,r);const i=e;function s(m,...k){if(t.length<k.length+m)throw new V(i,t,`${i.prim}: stack must have at least ${k.length} element(s)`);let $=m;for(const z of k){if(z!==null&&z.length!==0){let j=0;for(;j<z.length&&z[j]!==tt(t[$]);)j++;if(j===z.length)throw new V(i,t,`${i.prim}: stack type mismatch: [${$}] expected to be ${z}, got ${tt(t[$])} instead`)}$++}return t.slice(m,k.length+m)}function o(m){return(...k)=>{try{return m(...k)}catch($){throw $ instanceof ee?new V(i,t,$.message):$}}}function a(m){return k=>{try{return m(k)}catch($){throw $ instanceof ee?new V(i,t,$.message):$}}}const c=o(Gr),u=o(Ac),l=o(Yt),g=a(Ge),E=a(Os),y=a(ws),v=a(Kr),P=a(ci);function O(m,k){const $=c(i,Object.assign(Object.assign({},k),{emptyFields:m.f!==void 0&&m.f>1,emptyVar:m.v!==void 0&&m.v>1})),z=(j,xt,h)=>{if(j&&j.length>(xt||0))throw new V(i,t,`${i.prim}: at most ${xt||0} ${h} annotations allowed`)};return z($.f,m.f,"field"),z($.t,m.t,"type"),z($.v,m.v,"variable"),$}function S(m,k){const $=m,z=Array.isArray($)?{prim:"pair",args:$}:$,j=c(z),xt=k.v!==void 0||k.t!==void 0||k.f!==void 0?[...(k.v===null?j.v:k.v)||[],...(k.t===null?j.t:k.t)||[],...(k.f===null?j.f:k.f)||[]]:void 0,h=Zd(z,["annots"]);return Object.assign(Object.assign({},h),xt&&xt.length!==0&&{annots:xt})}function A(m,k){const $=O({v:1});return S(m,{v:$.v!==void 0?$.v:k!==void 0?[k]:null,t:null})}function Z(m,k,$,z,j){var xt,h,b,w;const N=(xt=c(k).f)===null||xt===void 0?void 0:xt[0],jt=(h=$.f)===null||h===void 0?void 0:h[z];if(jt!==void 0&&jt!=="%"&&N!==void 0&&jt!==N)throw new V(i,t,`${i.prim}: field names doesn't match: ${jt} !== ${N}`);const Dt=(b=$.v)===null||b===void 0?void 0:b[z],Jt=(w=c(m).v)===null||w===void 0?void 0:w[0];return S(k,{t:null,v:Dt?Dt==="@%"?N?["@"+N.slice(1)]:void 0:Dt==="@%%"?Jt?["@"+Jt.slice(1)+"."+(N?N.slice(1):j)]:N?["@"+N.slice(1)]:void 0:[Dt]:null})}function nt(m,k,$=k){const z=Ft("pair",m);if($===1)return[z.args[0]];if($===2)return z.args;const j=z.args[1];if(Ce(j))return[z.args[0],...nt(j,k,$-1)];throw new V(i,t,`${i.prim}: at least ${k} fields are expected`)}function Nt(m,k,$=k){if($===0)return m;const z=Ft("pair",m);if($===1)return z.args[0];const j=z.args[1];if(Ce(j))return Nt(j,k,$-2);if($===2)return j;throw new V(i,t,`${i.prim}: at least ${k+1} fields are expected`)}function X(m,k,$,z=$){if(z===0)return k;const j=Ft("pair",m);if(z===1)return Object.assign(Object.assign({},j),{args:[k,j.args[1]]});const xt=j.args[1];if(Ce(xt))return Object.assign(Object.assign({},j),{args:[j.args[0],X(xt,k,$,z-2)]});if(z===2)return Object.assign(Object.assign({},j),{args:[j.args[0],k]});throw new V(i,t,`${i.prim}: at least ${$+1} fields are expected`)}const Y=(m,k)=>["@"+(m.v?m.v[0].slice(1)+".":"")+k];function Pe(m,k){return"failed"in m||"failed"in k?"failed"in m?k:m:(u(m,k),m)}const gr=(m=>{var k,$,z,j,xt;switch(m.prim){case"DUP":{const h=m.args?parseInt(m.args[0].int,10):1;if(h===0)throw new V(m,t,"DUP 0 is forbidden");const b=s(h-1,null)[0];if(tt(b)==="ticket")throw new V(m,t,"ticket can't be DUPed");return[b,...t]}case"SWAP":{const h=s(0,null,null);return O({}),[h[1],h[0],...t.slice(2)]}case"SOME":return[S({prim:"option",args:[s(0,null)[0]]},O({t:1,v:1})),...t.slice(1)];case"UNIT":return[S({prim:"unit"},O({v:1,t:1})),...t];case"PAIR":{const h=m.args?parseInt(m.args[0].int,10):2;if(h<2)throw new V(m,t,`PAIR ${h} is forbidden`);const b=s(0,...new Array(h).fill(null)),w=O({f:h,t:1,v:1},{specialFields:!0}),N=Dt=>{const Jt=Dt.lastIndexOf(".");return Dt.slice(Jt>0?Jt+1:1)},jt=b.map((Dt,Jt)=>{var Ri;const vo=c(Dt),al=w.f&&w.f.length>Jt&&w.f[Jt]!=="%"?w.f[Jt]==="%@"?vo.v?["%"+N(((Ri=vo.v)===null||Ri===void 0?void 0:Ri[0])||"")]:void 0:[w.f[Jt]]:void 0;return S(Dt,{v:null,t:null,f:al})});return[S({prim:"pair",args:jt},{t:w.t,v:w.v}),...t.slice(h)]}case"UNPAIR":{const h=m.args?parseInt(m.args[0].int,10):2;if(h<2)throw new V(m,t,`UNPAIR ${h} is forbidden`);const b=s(0,["pair"])[0],w=O({f:2,v:2},{specialVar:!0});return[...nt(b,h).map((jt,Dt)=>Z(b,jt,w,Dt,Dt===0?"car":"cdr")),...t.slice(1)]}case"CAR":case"CDR":{const h=Ft("pair",s(0,["pair"])[0]),b=h.args[m.prim==="CAR"?0:1],w=O({f:1,v:1},{specialVar:!0});return[Z(h,b,w,0,m.prim.toLocaleLowerCase()),...t.slice(1)]}case"CONS":{const h=s(0,null,["list"]);return l(h[0],h[1].args[0]),[A({prim:"list",args:[h[1].args[0]]}),...t.slice(2)]}case"SIZE":return s(0,["string","list","set","map","bytes"]),[A({prim:"nat"}),...t.slice(1)];case"MEM":{const h=s(0,null,["set","map","big_map"]);return g(h[0]),l(h[0],h[1].args[0]),[A({prim:"bool"}),...t.slice(2)]}case"GET":if(m.args){const h=parseInt(m.args[0].int,10),b=s(0,["pair"])[0];return[A(Nt(b,h)),...t.slice(1)]}else{const h=s(0,null,["map","big_map"]);return g(h[0]),l(h[0],h[1].args[0]),[A({prim:"option",args:[h[1].args[1]]}),...t.slice(2)]}case"UPDATE":if(m.args){const h=parseInt(m.args[0].int,10),b=s(0,null,["pair"]);return[A(X(b[1],b[0],h)),...t.slice(2)]}else{const h=s(0,null,["bool","option"]);if(g(h[0]),h[1].prim==="bool"){const w=s(2,["set"]);return l(h[0],w[0].args[0]),[A({prim:"set",args:[S(h[0],{t:null})]}),...t.slice(3)]}const b=s(2,["map","big_map"]);return l(h[0],b[0].args[0]),b[0].prim==="map"?[A({prim:"map",args:[S(h[0],{t:null}),S(h[1].args[0],{t:null})]}),...t.slice(3)]:(P(h[1].args[0]),[A({prim:"big_map",args:[S(h[0],{t:null}),S(h[1].args[0],{t:null})]}),...t.slice(3)])}case"GET_AND_UPDATE":{const h=O({v:2}),b=s(0,null,["option"],["map","big_map"]);g(b[0]),l(b[0],b[2].args[0]),l(b[1].args[0],b[2].args[1]);const w=(k=h.v)===null||k===void 0?void 0:k.map(N=>N!=="@"?[N]:void 0);return b[2].prim==="map"?[S({prim:"option",args:[b[2].args[1]]},{v:w?.[0]}),S({prim:"map",args:[S(b[0],{t:null}),S(b[1].args[0],{t:null})]},{v:w?.[1]}),...t.slice(3)]:(P(b[1].args[0]),[S({prim:"option",args:[b[2].args[1]]},{v:w?.[0]}),S({prim:"big_map",args:[S(b[0],{t:null}),S(b[1].args[0],{t:null})]},{v:w?.[1]}),...t.slice(3)])}case"EXEC":{const h=s(0,null,["lambda"]);return l(h[0],h[1].args[0]),[A(h[1].args[1]),...t.slice(2)]}case"APPLY":{const h=s(0,null,["lambda"]);if(y(h[0]),v(h[0]),!Ce(h[1].args[0]))throw new V(m,t,`${m.prim}: function's argument must be a pair: ${tt(h[1].args[0])}`);const b=h[1].args[0];return l(h[0],Vn(b)[0]),[A({prim:"lambda",args:[Vn(b)[1],h[1].args[1]]}),...t.slice(2)]}case"FAILWITH":{const h=s(0,null)[0];return kr(n,Ue.PtEdo2Zk)||E(h),{failed:h,level:0}}case"NEVER":return s(0,["never"]),{failed:{prim:"never"},level:0};case"RENAME":return[A(s(0,null)[0]),...t.slice(1)];case"CONCAT":{const h=s(0,["string","list","bytes"]);if(h[0].prim==="list"){if(tt(h[0].args[0])!=="string"&&tt(h[0].args[0])!=="bytes")throw new V(m,t,`${m.prim}: can't concatenate list of ${tt(h[0].args[0])}'s`);return[A(h[0].args[0]),...t.slice(1)]}const b=s(1,["string","bytes"]);if(h[0].prim!==b[0].prim)throw new V(m,t,`${m.prim}: can't concatenate ${h[0].prim} with ${b[0].prim}`);return[A(b[0]),...t.slice(2)]}case"SLICE":return[A({prim:"option",args:[s(0,["nat"],["nat"],["string","bytes"])[2]]},"@slice"),...t.slice(3)];case"PACK":{const h=s(0,null)[0];return E(h),[A({prim:"bytes"},"@packed"),...t.slice(1)]}case"ADD":{const h=s(0,["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(h[0].prim==="nat"&&h[1].prim==="int"||h[0].prim==="int"&&h[1].prim==="nat")return[A({prim:"int"}),...t.slice(2)];if(h[0].prim==="int"&&h[1].prim==="timestamp"||h[0].prim==="timestamp"&&h[1].prim==="int")return[A({prim:"timestamp"}),...t.slice(2)];if((h[0].prim==="int"||h[0].prim==="nat"||h[0].prim==="mutez"||h[0].prim==="bls12_381_g1"||h[0].prim==="bls12_381_g2"||h[0].prim==="bls12_381_fr")&&h[0].prim===h[1].prim)return[A(h[0]),...t.slice(2)];throw new V(m,t,`${m.prim}: can't add ${h[0].prim} to ${h[1].prim}`)}case"SUB":{const h=kr(n,Ue.PsiThaCa)?s(0,["nat","int","timestamp","mutez"],["nat","int","timestamp","mutez"]):s(0,["nat","int","timestamp"],["nat","int","timestamp"]);if((h[0].prim==="nat"||h[0].prim==="int")&&(h[1].prim==="nat"||h[1].prim==="int")||h[0].prim==="timestamp"&&h[1].prim==="timestamp")return[A({prim:"int"}),...t.slice(2)];if(h[0].prim==="timestamp"&&h[1].prim==="int")return[A({prim:"timestamp"}),...t.slice(2)];if(h[0].prim==="mutez"&&h[1].prim==="mutez")return[A({prim:"mutez"}),...t.slice(2)];throw new V(m,t,`${m.prim}: can't subtract ${h[0].prim} from ${h[1].prim}`)}case"SUB_MUTEZ":return s(0,["mutez"],["mutez"]),[A({prim:"option",args:[{prim:"mutez"}]}),...t.slice(2)];case"MUL":{const h=s(0,["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if(h[0].prim==="nat"&&h[1].prim==="int"||h[0].prim==="int"&&h[1].prim==="nat")return[A({prim:"int"}),...t.slice(2)];if(h[0].prim==="nat"&&h[1].prim==="mutez"||h[0].prim==="mutez"&&h[1].prim==="nat")return[A({prim:"mutez"}),...t.slice(2)];if((h[0].prim==="bls12_381_g1"||h[0].prim==="bls12_381_g2"||h[0].prim==="bls12_381_fr")&&h[1].prim==="bls12_381_fr"||(h[0].prim==="nat"||h[0].prim==="int")&&h[0].prim===h[1].prim)return[A(h[0]),...t.slice(2)];if((h[0].prim==="nat"||h[0].prim==="int")&&h[1].prim==="bls12_381_fr"||(h[1].prim==="nat"||h[1].prim==="int")&&h[0].prim==="bls12_381_fr")return[A({prim:"bls12_381_fr"}),...t.slice(2)];throw new V(m,t,`${m.prim}: can't multiply ${h[0].prim} by ${h[1].prim}`)}case"EDIV":{const h=(w,N)=>({prim:"option",args:[{prim:"pair",args:[{prim:w},{prim:N}]}]}),b=s(0,["nat","int","mutez"],["nat","int","mutez"]);if(b[0].prim==="nat"&&b[1].prim==="nat")return[A(h("nat","nat")),...t.slice(2)];if((b[0].prim==="nat"||b[0].prim==="int")&&(b[1].prim==="nat"||b[1].prim==="int"))return[A(h("int","nat")),...t.slice(2)];if(b[0].prim==="mutez"&&b[1].prim==="nat")return[A(h("mutez","mutez")),...t.slice(2)];if(b[0].prim==="mutez"&&b[1].prim==="mutez")return[A(h("nat","mutez")),...t.slice(2)];throw new V(m,t,`${m.prim}: can't euclideally divide ${b[0].prim} by ${b[1].prim}`)}case"ABS":return s(0,["int"]),[A({prim:"nat"}),...t.slice(1)];case"ISNAT":return s(0,["int"]),[A({prim:"option",args:[{prim:"nat"}]}),...t.slice(1)];case"INT":return s(0,["nat","bls12_381_fr","bytes"]),[A({prim:"int"}),...t.slice(1)];case"BYTES":return s(0,["nat","int"]),[A({prim:"bytes"}),...t.slice(1)];case"NAT":return s(0,["bytes"]),[A({prim:"nat"}),...t.slice(1)];case"NEG":{const h=s(0,["nat","int","bls12_381_g1","bls12_381_g2","bls12_381_fr"])[0];return h.prim==="nat"||h.prim==="int"?[A({prim:"int"}),...t.slice(1)]:[A(h),...t.slice(1)]}case"LSL":case"LSR":return s(0,["nat","bytes"],["nat","bytes"]),[A({prim:"nat"}),...t.slice(2)];case"OR":case"XOR":{const h=s(0,["nat","bytes","bool"],["nat","bytes","bool"]);if(h[0].prim!==h[1].prim)throw new V(m,t,`${m.prim}: both arguments must be of the same type: ${h[0].prim}, ${h[1].prim}`);return[A(h[1]),...t.slice(2)]}case"AND":{const h=s(0,["nat","bytes","bool","int"],["nat","bytes","bool"]);if((h[0].prim!=="int"||h[1].prim!=="nat")&&h[0].prim!==h[1].prim)throw new V(m,t,`${m.prim}: both arguments must be of the same type: ${h[0].prim}, ${h[1].prim}`);return[A(h[1]),...t.slice(2)]}case"NOT":return s(0,["nat","bytes","bool","int"])[0].prim==="bool"?[A({prim:"bool"}),...t.slice(1)]:[A({prim:"int"}),...t.slice(1)];case"COMPARE":{const h=s(0,null,null);return g(h[0]),g(h[1]),[A({prim:"int"}),...t.slice(2)]}case"EQ":case"NEQ":case"LT":case"GT":case"LE":case"GE":return s(0,["int"]),[A({prim:"bool"}),...t.slice(1)];case"SELF":{if(r?.contract===void 0)throw new V(m,t,`${m.prim}: contract required`);const h=O({f:1,v:1}),b=rs(r.contract,($=h.f)===null||$===void 0?void 0:$[0]);if(b===null)throw new V(m,t,`${m.prim}: contract has no entrypoint ${b}`);return[S({prim:"contract",args:[b]},{v:h.v?h.v:["@self"]}),...t]}case"TRANSFER_TOKENS":{const h=s(0,null,["mutez"],["contract"]);return l(h[0],h[2].args[0]),[A({prim:"operation"}),...t.slice(3)]}case"SET_DELEGATE":{const h=s(0,["option"])[0];if(tt(h.args[0])!=="key_hash")throw new V(m,t,`${m.prim}: key hash expected: ${tt(h.args[0])}`);return[A({prim:"operation"}),...t.slice(1)]}case"IMPLICIT_ACCOUNT":return s(0,["key_hash"]),[A({prim:"contract",args:[{prim:"unit"}]}),...t.slice(1)];case"NOW":return[A({prim:"timestamp"},"@now"),...t];case"AMOUNT":return[A({prim:"mutez"},"@amount"),...t];case"BALANCE":return[A({prim:"mutez"},"@balance"),...t];case"CHECK_SIGNATURE":return s(0,["key"],["signature"],["bytes"]),[A({prim:"bool"}),...t.slice(3)];case"BLAKE2B":case"SHA256":case"SHA512":case"KECCAK":case"SHA3":return s(0,["bytes"]),[A({prim:"bytes"}),...t.slice(1)];case"HASH_KEY":return s(0,["key"]),[A({prim:"key_hash"}),...t.slice(1)];case"SOURCE":return[A({prim:"address"},"@source"),...t];case"SENDER":return[A({prim:"address"},"@sender"),...t];case"ADDRESS":{const h=s(0,["contract"])[0],b=O({v:1});return[S({prim:"address",[Rn]:h},{v:b.v?b.v:Y(c(h),"address")}),...t.slice(1)]}case"SELF_ADDRESS":{const h={prim:"address"};return r?.contract!==void 0&&(h[Rn]={prim:"contract",args:[be(r.contract,"parameter").args[0]]}),[A(h,"@address"),...t]}case"CHAIN_ID":return[A({prim:"chain_id"}),...t];case"DROP":{O({});const h=m.args!==void 0?parseInt(m.args[0].int,10):1;return s(h-1,null),t.slice(h)}case"DIG":{O({});const h=parseInt(m.args[0].int,10);return[s(h,null)[0],...t.slice(0,h),...t.slice(h+1)]}case"DUG":{O({});const h=parseInt(m.args[0].int,10);return[...t.slice(1,h+1),s(0,null)[0],...t.slice(h+1)]}case"NONE":return it(m.args[0]),[S({prim:"option",args:[m.args[0]]},O({t:1,v:1})),...t];case"LEFT":case"RIGHT":{const h=s(0,null)[0],b=O({f:2,t:1,v:1},{specialFields:!0}),w=c(h),N=[S(h,{t:null,v:null,f:b.f&&b.f.length>0&&b.f[0]!=="%"?b.f[0]==="%@"?w.v?["%"+w.v[0].slice(1)]:void 0:b.f:void 0}),S(m.args[0],{t:null,f:b.f&&b.f.length>1&&b.f[1]!=="%"?b.f:void 0})];return[S({prim:"or",args:m.prim==="LEFT"?N:[N[1],N[0]]},{t:b.t,v:b.v}),...t.slice(1)]}case"NIL":return it(m.args[0]),[S({prim:"list",args:[m.args[0]]},O({t:1,v:1})),...t];case"UNPACK":return s(0,["bytes"]),it(m.args[0]),[A({prim:"option",args:[m.args[0]]},"@unpacked"),...t.slice(1)];case"CONTRACT":{const h=s(0,["address"])[0];it(m.args[0]);const b=O({v:1,f:1}),w=h[Rn];if(w!==void 0){const N=rs(w,(z=b.f)===null||z===void 0?void 0:z[0]);if(N===null)throw new V(m,t,`${m.prim}: contract has no entrypoint ${N}`);l(N,m.args[0])}return[S({prim:"option",args:[{prim:"contract",args:[m.args[0]]}]},{v:b.v?b.v:Y(c(h),"contract")}),...t.slice(1)]}case"CAST":{O({});const h=s(0,null)[0];return it(m.args[0]),l(m.args[0],h),[m.args[0],...t.slice(1)]}case"IF_NONE":{O({});const h=s(0,["option"])[0],b=t.slice(1),w=St(m.args[0],b,r),N=St(m.args[1],[S(h.args[0],{t:null,v:Y(c(h),"some")}),...b],r);return Pe(w,N)}case"IF_LEFT":{O({});const h=s(0,["or"])[0],b=c(h),w=c(h.args[0]),N=c(h.args[1]),jt=t.slice(1),Dt=St(m.args[0],[S(h.args[0],{t:null,v:Y(b,w.f?w.f[0].slice(1):"left")}),...jt],r),Jt=St(m.args[1],[S(h.args[1],{t:null,v:Y(b,N.f?N.f[0].slice(1):"right")}),...jt],r);return Pe(Dt,Jt)}case"IF_CONS":{O({});const h=s(0,["list"])[0],b=c(h),w=t.slice(1),N=St(m.args[0],[S(h.args[0],{t:null,v:Y(b,"hd")}),S(h,{t:null,v:Y(b,"tl")}),...w],r),jt=St(m.args[1],w,r);return Pe(N,jt)}case"IF":{O({}),s(0,["bool"]);const h=t.slice(1),b=St(m.args[0],h,r),w=St(m.args[1],h,r);return Pe(b,w)}case"MAP":{const h=s(0,["list","map","option"])[0],b=t.slice(1),w=h.prim==="map"?{prim:"pair",args:h.args}:h.args[0],N=St(m.args[0],[S(w,{t:null,v:Y(c(h),"elt")}),...b],r);if("failed"in N){if(!("prim"in N.failed)||N.failed.prim!=="never")throw new V(m,t,`${m.prim}: FAIL is not allowed in MAP`);return{failed:N.failed,level:N.level+1}}if(N.length<1)throw new V(m,t,`${m.prim}: function must return a value`);return u(N.slice(1),b),h.prim==="list"?[A({prim:"list",args:[N[0]]}),...b]:h.prim==="map"?[A({prim:"map",args:[h.args[0],N[0]]}),...b]:[A({prim:"option",args:[N[0]]}),...b]}case"ITER":{O({});const h=s(0,["set","list","map"])[0],b=t.slice(1),w=h.prim==="map"?{prim:"pair",args:h.args}:h.args[0],N=St(m.args[0],[S(w,{t:null,v:Y(c(h),"elt")}),...b],r);return"failed"in N?{failed:N.failed,level:N.level+1}:(u(N,b),b)}case"LOOP":{O({}),s(0,["bool"]);const h=t.slice(1),b=St(m.args[0],h,r);return"failed"in b?{failed:b.failed,level:b.level+1}:(u(b,[{prim:"bool"},...h]),h)}case"LOOP_LEFT":{O({});const h=s(0,["or"])[0],b=t.slice(1),w=St(m.args[0],[S(h.args[0],{t:null,v:Y(c(h),"left")}),...b],r);return"failed"in w?{failed:w.failed,level:w.level+1}:(u(w,[h,...b]),[S(h.args[1],{t:null,v:O({v:1}).v}),...b])}case"DIP":{O({});const h=m.args.length===2?parseInt(m.args[0].int,10):1;s(h-1,null);const b=t.slice(0,h),w=t.slice(h),N=m.args.length===2?St(m.args[1],w,r):St(m.args[0],w,r);return"failed"in N?{failed:N.failed,level:N.level+1}:[...b,...N]}case"CREATE_CONTRACT":{const h=O({v:2}),b=s(0,["option"],["mutez"],null);if(tt(b[0].args[0])!=="key_hash")throw new V(m,t,`${m.prim}: key hash expected: ${tt(b[0].args[0])}`);y(b[2])&&(Rc(m.args[0]),Yt(be(m.args[0],"storage").args[0],b[2]));const w=(j=h.v)===null||j===void 0?void 0:j.map(N=>N!=="@"?[N]:void 0);return[S({prim:"operation"},{v:w?.[0]}),S({prim:"address",[Rn]:{prim:"contract",args:[be(m.args[0],"parameter").args[0]]}},{v:w?.[1]}),...t.slice(3)]}case"PUSH":return it(m.args[0]),Ut(m.args[1],m.args[0],Object.assign(Object.assign({},r),{contract:void 0})),[A(m.args[0]),...t];case"EMPTY_SET":return it(m.args[0]),g(m.args[0]),[S({prim:"set",args:m.args},O({t:1,v:1})),...t];case"EMPTY_MAP":return it(m.args[0]),g(m.args[0]),it(m.args[1]),[S({prim:"map",args:m.args},O({t:1,v:1})),...t];case"EMPTY_BIG_MAP":return it(m.args[0]),g(m.args[0]),it(m.args[1]),P(m.args[0]),[S({prim:"big_map",args:m.args},O({t:1,v:1})),...t];case"LAMBDA_REC":case"LAMBDA":{it(m.args[0]),it(m.args[1]);const h=[m.args[0]];m.prim==="LAMBDA_REC"&&h.push({prim:"lambda",args:[m.args[0],m.args[1]]});const b=St(m.args[2],h,Object.assign(Object.assign({},r),{contract:void 0}));if("failed"in b)return{failed:b.failed,level:b.level+1};if(b.length!==1)throw new V(m,t,`${m.prim}: function must return a value`);return l(m.args[1],b[0]),[A({prim:"lambda",args:[m.args[0],m.args[1]]}),...t]}case"LEVEL":return[A({prim:"nat"},"@level"),...t];case"TOTAL_VOTING_POWER":return[A({prim:"nat"}),...t];case"VOTING_POWER":return s(0,["key_hash"]),[A({prim:"nat"}),...t.slice(1)];case"TICKET":{const h=s(0,null,["nat"])[0];return g(h),kr(n,Ue.PtLimaPtL)?[S({prim:"ticket",args:[h]},O({t:1,v:1})),...t.slice(2)]:[A({prim:"option",args:[S({prim:"ticket",args:[h]},O({t:1,v:1}))]}),...t.slice(2)]}case"JOIN_TICKETS":{const h=Ft("pair",s(0,["pair"])[0]);if(tt(h.args[0])!=="ticket")throw new V(m,t,`${m.prim}: ticket expected: ${tt(h.args[0])}`);return l(h.args[0],h.args[1]),[A({prim:"option",args:[S(h.args[0],{t:null})]}),...t.slice(1)]}case"SPLIT_TICKET":{const h=s(0,["ticket"],["pair"]),b=Ft("pair",h[1]);if(tt(b.args[0])!=="nat")throw new V(m,t,`${m.prim}: nat expected: ${tt(b.args[0])}`);return l(b.args[0],b.args[1]),[A({prim:"option",args:[{prim:"pair",args:[S(h[0],{t:null}),S(h[0],{t:null})]}]}),...t.slice(2)]}case"READ_TICKET":{const h=O({v:2}),b=s(0,["ticket"])[0],w=(xt=h.v)===null||xt===void 0?void 0:xt.map(N=>N!=="@"?[N]:void 0);return[S({prim:"pair",args:[{prim:"address"},S(b.args[0],{t:null}),{prim:"nat"}]},{v:w?.[0]}),S(b,{v:w?.[1],t:null}),...t.slice(1)]}case"PAIRING_CHECK":{const h=s(0,["list"])[0].args[0];if(!Ce(h))throw new V(m,t,`${m.prim}: pair expected: ${tt(h)}`);const b=Ft("pair",h);if(tt(b.args[0])!=="bls12_381_g1")throw new V(m,t,`${m.prim}: bls12_381_g1 expected: ${tt(b.args[0])}`);if(tt(b.args[1])!=="bls12_381_g2")throw new V(m,t,`${m.prim}: bls12_381_g2 expected: ${tt(b.args[1])}`);return[A({prim:"bool"}),...t.slice(1)]}case"SAPLING_EMPTY_STATE":return[S({prim:"sapling_state",args:[m.args[0]]},O({v:1,t:1})),...t];case"SAPLING_VERIFY_UPDATE":{const h=s(0,["sapling_transaction"],["sapling_state"]);if(parseInt(h[0].args[0].int,10)!==parseInt(h[1].args[0].int,10))throw new V(m,t,`${m.prim}: sapling memo size mismatch: ${h[0].args[0].int} != ${h[1].args[0].int}`);return kr(n,Ue.PtJakarta)?[A({prim:"option",args:[{prim:"pair",args:[{prim:"int"},S(h[1],{t:null})]}]}),...t.slice(2)]:[A({prim:"option",args:[{prim:"pair",args:[{prim:"bytes"},{prim:"pair",args:[{prim:"int"},S(h[1],{t:null})]}]}]}),...t.slice(2)]}case"OPEN_CHEST":return s(0,["chest_key"],["chest"],["nat"]),[A({prim:"or",args:[{prim:"bytes"},{prim:"bool"}]}),...t.slice(3)];case"VIEW":{const h=s(0,null,["address"]);return v(h[0]),[A({prim:"option",args:[m.args[1]]}),...t.slice(2)]}case"MIN_BLOCK_TIME":return[A({prim:"nat"}),...t];case"EMIT":{const h=O({f:1,t:1});if(m.args){const b=s(0,null);return l(b[0],m.args[0]),[S({prim:"operation"},h),...t.slice(1)]}return[S({prim:"operation"},h),...t.slice(1)]}case"IS_IMPLICIT_ACCOUNT":return s(0,["address"]),[A({prim:"option",args:[{prim:"key_hash"}]}),...t.slice(1)];default:throw new ee(m,`unexpected instruction: ${m.prim}`)}})(i);if(r?.traceCallback!==void 0){const m={op:i,in:t,out:gr};r.traceCallback(m)}return gr}function be(e,t){for(const r of e)if(r.prim===t)return r;throw new ee(e,`missing contract section: ${t}`)}function cp(e){const t={};for(const r of e)r.prim==="view"&&(t[r.args[0].string]=r);return t}function Pc(e){if(Array.isArray(e)){for(const t of e)if("prim"in t&&(t.prim==="parameter"||t.prim==="storage"||t.prim==="code"))return!0}return!1}function rs(e,t){t=t||"%default";const r=Zn(e).find(n=>n[0]===t);return r!==void 0?r[1]:t==="%default"?Pc(e)?be(e,"parameter").args[0]:e:null}function up(e){return Array.isArray(e)||e.prim==="or"}function Zn(e){if(Pc(e)){const t=be(e,"parameter"),r=Zn(t.args[0]),n=Gr(t);return n.f?[[n.f[0],t.args[0]],...r]:r}if(up(e)){const t=Vn(e),r=n=>{const i=Gr(t[n]);if(tt(t[n])==="or"){const s=Zn(t[n]);return i.f?[[i.f[0],t[n]],...s]:s}return i.f?[[i.f[0],t[n]]]:[]};return[...r(0),...r(1)]}return[]}function Rc(e,t){const r=(c,u,l,g)=>{it(c,!0),it(u);const E={prim:"pair",args:[Object.assign(Object.assign({},c),{annots:["@parameter"]}),Object.assign(Object.assign({},u),{annots:["@storage"]})]},y=St(g,[E],Object.assign(Object.assign({},t),{contract:e}));if("failed"in y)return y;try{Ac(y,[l])}catch(v){throw v instanceof ee?new V(g,y,v.message):v}return y},n=be(e,"parameter").args[0],i=be(e,"storage").args[0],s=be(e,"code").args[0],a=r(n,i,{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},i]},s);for(const c of Object.values(cp(e)))r(c.args[1],i,c.args[2],c.args[3]);return a}function Oc(e,t,r){it(t),Ut(e,t,r||null)}function lp(e,t,r){for(const n of t)it(n);if(r?.contract!==void 0)for(const n of["parameter","storage"]){const i=be(r.contract,n).args[0];it(i)}return St(e,t,r||null)}function hp(e,t,r=!1){if(Array.isArray(e)){for(const n of e)it(n);for(const n of t)it(n)}else it(e),it(t);Yt(e,t,r)}function dp(e,t,r){try{return Oc(e,t,r),!0}catch{return!1}}class Ts{constructor(t,r){this.contract=t,this.ctx=Object.assign({contract:t},r),this.output=Rc(t,this.ctx)}static parse(t,r){const n=new _r(r),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new xd("empty Michelson");if(Ec(i))return new Ts(i,r)}static parseTypeExpression(t,r){const n=new _r(r),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new kd("empty type expression");if(_e(i))return it(i),i}static parseDataExpression(t,r){const n=new _r(r),i=typeof t=="string"?n.parseScript(t):n.parseJSON(t);if(i===null)throw new Md("empty data expression");if(ze(i))return i;throw void 0}section(t){return be(this.contract,t)}entryPoints(){return Zn(this.contract)}entryPoint(t){return rs(this.contract,t)}assertDataValid(t,r){Oc(t,r,this.ctx)}isDataValid(t,r){return dp(t,r,this.ctx)}assertParameterValid(t,r){const n=this.entryPoint(t||void 0);if(n===null)throw new Hd(t?.toString());this.assertDataValid(r,n)}isParameterValid(t,r){try{return this.assertParameterValid(t,r),!0}catch{return!1}}functionType(t,r){return lp(t,r,this.ctx)}}new Ts([{prim:"parameter",args:[{prim:"unit"}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}]);var Ui={},aa;function pp(){return aa||(aa=1,function(e){function t(S,A){var Z;return S instanceof Buffer?Z=S:Z=Buffer.from(S.buffer,S.byteOffset,S.byteLength),Z.toString(A)}var r=function(S){return Buffer.from(S)};function n(S){for(var A=0,Z=Math.min(256*256,S.length+1),nt=new Uint16Array(Z),Nt=[],X=0;;){var Y=A<S.length;if(!Y||X>=Z-1){var Pe=nt.subarray(0,X),gr=Pe;if(Nt.push(String.fromCharCode.apply(null,gr)),!Y)return Nt.join("");S=S.subarray(A),A=0,X=0}var m=S[A++];if((m&128)===0)nt[X++]=m;else if((m&224)===192){var k=S[A++]&63;nt[X++]=(m&31)<<6|k}else if((m&240)===224){var k=S[A++]&63,$=S[A++]&63;nt[X++]=(m&31)<<12|k<<6|$}else if((m&248)===240){var k=S[A++]&63,$=S[A++]&63,z=S[A++]&63,j=(m&7)<<18|k<<12|$<<6|z;j>65535&&(j-=65536,nt[X++]=j>>>10&1023|55296,j=56320|j&1023),nt[X++]=j}}}function i(S){for(var A=0,Z=S.length,nt=0,Nt=Math.max(32,Z+(Z>>>1)+7),X=new Uint8Array(Nt>>>3<<3);A<Z;){var Y=S.charCodeAt(A++);if(Y>=55296&&Y<=56319){if(A<Z){var Pe=S.charCodeAt(A);(Pe&64512)===56320&&(++A,Y=((Y&1023)<<10)+(Pe&1023)+65536)}if(Y>=55296&&Y<=56319)continue}if(nt+4>X.length){Nt+=8,Nt*=1+A/S.length*2,Nt=Nt>>>3<<3;var gr=new Uint8Array(Nt);gr.set(X),X=gr}if((Y&4294967168)===0){X[nt++]=Y;continue}else if((Y&4294965248)===0)X[nt++]=Y>>>6&31|192;else if((Y&4294901760)===0)X[nt++]=Y>>>12&15|224,X[nt++]=Y>>>6&63|128;else if((Y&4292870144)===0)X[nt++]=Y>>>18&7|240,X[nt++]=Y>>>12&63|128,X[nt++]=Y>>>6&63|128;else continue;X[nt++]=Y&63|128}return X.slice?X.slice(0,nt):X.subarray(0,nt)}var s="Failed to ",o=function(S,A,Z){if(S)throw new Error("".concat(s).concat(A,": the '").concat(Z,"' option is unsupported."))},a=typeof Buffer=="function"&&Buffer.from,c=a?r:i;function u(){this.encoding="utf-8"}u.prototype.encode=function(S,A){return o(A&&A.stream,"encode","stream"),c(S)};function l(S){var A;try{var Z=new Blob([S],{type:"text/plain;charset=UTF-8"});A=URL.createObjectURL(Z);var nt=new XMLHttpRequest;return nt.open("GET",A,!1),nt.send(),nt.responseText}finally{A&&URL.revokeObjectURL(A)}}var g=!a&&typeof Blob=="function"&&typeof URL=="function"&&typeof URL.createObjectURL=="function",E=["utf-8","utf8","unicode-1-1-utf-8"],y=n;a?y=t:g&&(y=function(S){try{return l(S)}catch{return n(S)}});var v="construct 'TextDecoder'",P="".concat(s," ").concat(v,": the ");function O(S,A){o(A&&A.fatal,v,"fatal"),S=S||"utf-8";var Z;if(a?Z=Buffer.isEncoding(S):Z=E.indexOf(S.toLowerCase())!==-1,!Z)throw new RangeError("".concat(P," encoding label provided ('").concat(S,"') is invalid."));this.encoding=S,this.fatal=!1,this.ignoreBOM=!1}O.prototype.decode=function(S,A){o(A&&A.stream,"decode","stream");var Z;return S instanceof Uint8Array?Z=S:S.buffer instanceof ArrayBuffer?Z=new Uint8Array(S.buffer):Z=new Uint8Array(S),y(Z,this.encoding)},e.TextEncoder=e.TextEncoder||u,e.TextDecoder=e.TextDecoder||O}(typeof window<"u"?window:typeof Bn<"u"?Bn:Ui)),Ui}pp();const Vr=e=>e.reduce((t,r)=>t+r.toString(16).padStart(2,"0"),""),D=(e,t=8)=>e.toString(16).padStart(t,"0"),Is=31;var d;(function(e){e.SECRET="secret",e.RAW="raw",e.TZ1="tz1",e.BRANCH="branch",e.ZARITH="zarith",e.PUBLIC_KEY="public_key",e.PKH="pkh",e.PKH_ARR="pkhArr",e.DELEGATE="delegate",e.SCRIPT="script",e.BALLOT_STATEMENT="ballotStmt",e.PROPOSAL="proposal",e.PROPOSAL_ARR="proposalArr",e.INT32="int32",e.INT16="int16",e.PARAMETERS="parameters",e.ADDRESS="address",e.SMART_CONTRACT_ADDRESS="smart_contract_address",e.SMART_ROLLUP_ADDRESS="smart_rollup_address",e.SMART_ROLLUP_COMMITMENT_HASH="smart_rollup_commitment_hash",e.VALUE="value",e.PADDED_BYTES="padded_bytes",e.SMART_ROLLUP_MESSAGE="smart_rollup_message",e.MANAGER="manager",e.BLOCK_PAYLOAD_HASH="blockPayloadHash",e.ENTRYPOINT="entrypoint",e.OPERATION="operation",e.OP_ACTIVATE_ACCOUNT="activate_account",e.OP_DELEGATION="delegation",e.OP_TRANSACTION="transaction",e.OP_ORIGINATION="origination",e.OP_BALLOT="ballot",e.OP_FAILING_NOOP="failing_noop",e.OP_ATTESTATION="attestation",e.OP_ATTESTATION_WITH_DAL="attestation_with_dal",e.OP_SEED_NONCE_REVELATION="seed_nonce_revelation",e.OP_REVEAL="reveal",e.OP_PROPOSALS="proposals",e.OP_REGISTER_GLOBAL_CONSTANT="register_global_constant",e.OP_TRANSFER_TICKET="transfer_ticket",e.BURN_LIMIT="burn_limit",e.OP_INCREASE_PAID_STORAGE="increase_paid_storage",e.OP_UPDATE_CONSENSUS_KEY="update_consensus_key",e.OP_UPDATE_COMPANION_KEY="update_companion_key",e.SIGNATURE_PROOF="signature_proof",e.OP_DRAIN_DELEGATE="drain_delegate",e.DEPOSITS_LIMIT="deposits_limit",e.OP_SET_DEPOSITS_LIMIT="set_deposits_limit",e.OP_SMART_ROLLUP_ORIGINATE="smart_rollup_originate",e.PVM_KIND="pvm_kind",e.OP_SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",e.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message",e.OP_DAL_PUBLISH_COMMITMENT="dal_publish_commitment",e.SLOT_HEADER="slot_header"})(d||(d={}));const re={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0a":"True","0b":"Unit","0c":"PACK","0d":"UNPACK","0e":"BLAKE2B","0f":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1a":"CONCAT","1b":"CONS","1c":"CREATE_ACCOUNT","1d":"CREATE_CONTRACT","1e":"IMPLICIT_ACCOUNT","1f":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2a":"GT","2b":"HASH_KEY","2c":"IF","2d":"IF_CONS","2e":"IF_LEFT","2f":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3a":"MUL","3b":"NEG","3c":"NEQ","3d":"NIL","3e":"NONE","3f":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4a":"STEPS_TO_QUOTA","4b":"SUB","4c":"SWAP","4d":"TRANSFER_TOKENS","4e":"SET_DELEGATE","4f":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5a":"contract","5b":"int","5c":"key","5d":"key_hash","5e":"lambda","5f":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6a":"mutez","6b":"timestamp","6c":"unit","6d":"operation","6e":"address","6f":"SLICE",70:"DIG",71:"DUG",72:"EMPTY_BIG_MAP",73:"APPLY",74:"chain_id",75:"CHAIN_ID",76:"LEVEL",77:"SELF_ADDRESS",78:"never",79:"NEVER","7a":"UNPAIR","7b":"VOTING_POWER","7c":"TOTAL_VOTING_POWER","7d":"KECCAK","7e":"SHA3","7f":"PAIRING_CHECK",80:"bls12_381_g1",81:"bls12_381_g2",82:"bls12_381_fr",83:"sapling_state",84:"sapling_transaction_deprecated",85:"SAPLING_EMPTY_STATE",86:"SAPLING_VERIFY_UPDATE",87:"ticket",88:"TICKET_DEPRECATED",89:"READ_TICKET","8a":"SPLIT_TICKET","8b":"JOIN_TICKETS","8c":"GET_AND_UPDATE","8d":"chest","8e":"chest_key","8f":"OPEN_CHEST",90:"VIEW",91:"view",92:"constant",93:"SUB_MUTEZ",94:"tx_rollup_l2_address",95:"MIN_BLOCK_TIME",96:"sapling_transaction",97:"EMIT",98:"Lambda_rec",99:"LAMBDA_REC","9a":"TICKET","9b":"BYTES","9c":"NAT","9d":"Ticket","9e":"IS_IMPLICIT_ACCOUNT"},fp=(()=>{const e={};return Object.keys(re).forEach(t=>{e[re[t]]=t}),e})(),ns={4:"activate_account",107:"reveal",110:"delegation",108:"transaction",109:"origination",6:"ballot",21:"attestation",23:"attestation_with_dal",1:"seed_nonce_revelation",5:"proposals",111:"register_global_constant",158:"transfer_ticket",112:"set_deposits_limit",113:"increase_paid_storage",114:"update_consensus_key",115:"update_companion_key",9:"drain_delegate",200:"smart_rollup_originate",201:"smart_rollup_add_messages",206:"smart_rollup_execute_outbox_message",230:"dal_publish_commitment",17:"failing_noop"},ca=(()=>{const e={};return Object.keys(ns).forEach(t=>{const r=typeof t=="string"?parseInt(t,10):t;e[ns[r]]=D(r,2)}),e})(),zn={"00":"default","01":"root","02":"do","03":"set_delegate","04":"remove_delegate","05":"deposit","06":"stake","07":"unstake","08":"finalize_unstake","09":"set_delegate_parameters"},ua=(()=>{const e={};return Object.keys(zn).forEach(t=>{e[zn[t]]=t}),e})();class la extends q{constructor(t,r){super(),this.operation=t,this.errorDetail=r,this.name="InvalidOperationSchemaError",this.message="Invalid operation content recevied",r&&(this.message+=` ${r}.`)}}class ui extends q{constructor(t){super(),this.entrypoint=t,this.name="OversizedEntryPointError",this.message=`Invalid entrypoint length "${t.length}", maximum length is "${Is}".`}}class wc extends q{constructor(t){super(),this.ballotValue=t,this.name="InvalidBallotValueError",this.message=`Invalid ballot value "${t}" expecting one of the following: "yay", "nay", "pass".`}}class Tc extends q{constructor(t){super(),this.ballotValue=t,this.name="DecodeBallotValueError",this.message=`Invalid ballot value "${t}", cannot be decoded.`}}class Ic extends q{constructor(t){super(),this.value=t,this.name="UnexpectedMichelsonValueError",this.message=`Invalid Michelson value "${t}", unalbe to encode.`}}class li extends q{constructor(t){super(),this.message=t,this.name="OperationDecodingError"}}class Lc extends q{constructor(t){super(),this.message=t,this.name="OperationEncodingError"}}class Nc extends q{constructor(t){super(),this.op=t,this.name="UnsupportedOperationError",this.message=`Unsupported operation "${t}", can submit an issue on our github for feature request.`}}class xc extends q{constructor(t){super(),this.pvm=t,this.name="UnsupportedPvmKindError",this.message=`Invalid Pvm kind "${t}" expecting either "arith" or "wasm_2_0_0".`}}class kc extends q{constructor(t){super(),this.pvm=t,this.name="DecodePvmKindError",this.message=`Invalid Pvm kind "${t}", cannot be decoded.`}}class Ls extends q{constructor(t,r){super(),this.address=t,this.errorDetail=r,this.name="InvalidSmartRollupAddress",this.message=`Invalid smart rollup address "${t}"`,r&&(this.message+=` ${r}.`)}}class Ns extends q{constructor(t,r){super(),this.hash=t,this.errorDetail=r,this.name="InvalidSmartRollupCommitmentHashError",this.message=`Invalid smart rollup commitment hash "${t}"`,r&&(this.message+=` ${r}.`)}}class xs extends q{constructor(t,r){super(),this.commitment=t,this.errorDetail=r,this.name="InvalidDalCommitmentError",this.message=`Invalid dal commitment "${t}"`,r&&(this.message+=` ${r}.`)}}class Rt{static fromHexString(t){const r=t.toLowerCase();if(/^(([a-f]|\d){2})*$/.test(r)){const n=new Uint8Array((r.match(/([a-z]|\d){2}/g)||[]).map(i=>parseInt(i,16)));return new Rt(n)}else throw new ys(r)}constructor(t,r=0){this.arr=t,this.offset=r}consume(t){const r=this.arr.subarray(this.offset,this.offset+t);return this.offset+=t,r}get(t){return this.arr[this.offset+t]}length(){return this.arr.length-this.offset}slice(t,r){return new Rt(this.arr.slice(t,r))}}const gp=e=>"prim"in e,mp=e=>"bytes"in e&&typeof e.bytes=="string",yp=e=>"string"in e&&typeof e.string=="string",Ep=e=>"int"in e&&typeof e.int=="string",_p=e=>{const t=cr(e.code),r=cr(e.storage);return`${D(t.length/2,8)}${t}${D(r.length/2,8)}${r}`},bp=e=>{const t=Xt(e),r=Xt(e);return{code:ur(new Rt(t)),storage:ur(new Rt(r))}},cr=e=>{if(Array.isArray(e)){const t=e.map(n=>cr(n)).join(""),r=t.length/2;return`02${D(r)}${t}`}else{if(gp(e))return Tp(e);if(mp(e))return Ap(e);if(yp(e))return Pp(e);if(Ep(e))return Op(e)}throw new Ic(JSON.stringify(e))},ur=e=>{const t=e.consume(1);switch(t[0]){case 10:return Sp(e);case 1:return Rp(e);case 0:return wp(e);case 2:{const r=new Rt(Xt(e)),n=[];for(;r.length()>0;)n.push(ur(r));return n}default:return Ip(e,t)}},Xt=(e,t=4)=>{const r=e.consume(t),n=parseInt(Buffer.from(r).toString("hex"),16);return e.consume(n)},vp=(e,t=4)=>{const r=[];let n=e;for(;n.length();){const i=n.consume(t),s=parseInt(Buffer.from(i).toString("hex"),16);r.push(n.consume(s)),n=n.slice(s+t)}return r},Ap=e=>{if(!/^([A-Fa-f0-9]{2})*$/.test(e.bytes))throw new ys(e.bytes);const t=e.bytes.length/2;return`0a${D(t)}${e.bytes}`},Sp=e=>{const t=Xt(e);return{bytes:Buffer.from(t).toString("hex")}},Pp=e=>{const t=Buffer.from(e.string,"utf8").toString("hex"),r=t.length/2;return`01${D(r)}${t}`},Rp=e=>{const t=Xt(e);return{string:Buffer.from(t).toString("utf8")}},Op=({int:e})=>{const t=new I(e,10),r=t.toString(2)[0]==="-"?"1":"0",n=t.toString(2).replace(/-/g,""),i=n.length<=6?6:(n.length-6)%7?n.length+7-(n.length-6)%7:n.length,o=n.padStart(i,"0").match(/\d{6,7}/g).reverse();return o[0]=r+o[0],`00${o.map((c,u)=>parseInt((u===o.length-1?"0":"1")+c,2).toString(16).padStart(2,"0")).join("")}`},wp=e=>{let t=e.consume(1)[0];const r=[],n=128;for(;t&n;)r.push(t),t=e.consume(1)[0];r.push(t);const i=!!(64&r[0]);r[0]=r[0]&127;const s=r.map((a,c)=>a.toString(2).slice(c===0?-6:-7).padStart(c===0?6:7,"0")).reverse();let o=new I(s.join(""),2);return i&&(o=o.times(-1)),{int:o.toFixed()}},Tp=e=>{const t=+Array.isArray(e.annots),r=Array.isArray(e.args)?e.args.length:0,n=D(Math.min(2*r+t+3,9),2),i=fp[e.prim];let s=(e.args||[]).map(a=>cr(a)).join("");const o=Array.isArray(e.annots)?xp(e.annots):"";return(e.prim==="LAMBDA"||e.prim==="LAMBDA_REC")&&r&&(s=D(s.length/2)+s+D(0)),(e.prim==="pair"||e.prim==="Pair")&&r>2&&(s=o===""?D(s.length/2)+s+D(0):D(s.length/2)+s),e.prim==="view"&&e.args&&(s=D(s.length/2)+s+D(0)),`${n}${i}${s}${o}`},Ip=(e,t)=>{const r=(t[0]-3)%2===1;let n=Math.floor((t[0]-3)/2);const i=e.consume(1)[0].toString(16).padStart(2,"0"),s={prim:re[i]};if((re[i]==="LAMBDA"||re[i]==="LAMBDA_REC")&&e.consume(4),re[i]==="view")return n!=0?Lp(e,s):s;let o,a;(re[i]==="pair"||re[i]==="Pair")&&n>2&&(o=Np(e),n=0,a=ha(e));const c=new Array(n).fill(0).map(()=>ur(e));return(re[i]==="LAMBDA"||re[i]==="LAMBDA_REC")&&e.consume(4),o?s.args=o:c.length&&(s.args=c),a&&a[0]!==""?s.annots=a:r&&(s.annots=ha(e)),s},Lp=(e,t)=>(e.consume(4),t.args=new Array(4).fill(0).map(()=>ur(e)),e.consume(4),t),Np=e=>{const t=new Rt(Xt(e)),r=[];for(;t.length()>0;)r.push(ur(t));return r},xp=e=>{const t=e.map(n=>Buffer.from(n,"utf8").toString("hex")).join("20"),r=t.length/2;return`${D(r)}${t}`},ha=e=>{const t=e.consume(4),r=parseInt(Buffer.from(t).toString("hex"),16),n=e.consume(r);return Buffer.from(n).toString("hex").split("20").map(s=>Buffer.from(s,"hex").toString("utf8"))},Ir=e=>t=>{const[r]=Ot(t,[e]);return ms(r)},wt=e=>t=>{const r=t.consume(Fi[e]);return vl(r,e)},kp=wt(L.Ed25519PublicKeyHash),Mp=wt(L.BlockHash),hi=e=>{const t=e.consume(1);if(t[0]===0)return wt(L.Ed25519PublicKeyHash)(e);if(t[0]===1)return wt(L.Secp256k1PublicKeyHash)(e);if(t[0]===2)return wt(L.P256PublicKeyHash)(e);if(t[0]===3)return wt(L.BLS12_381PublicKeyHash)(e)},Hp=e=>{if(!ks(e))return;const t=[];for(e.consume(4);e.length()>0;)t.push(hi(e));return t},Dp=Ir(L.BlockHash),Cp=Ir(L.Ed25519PublicKeyHash),Ar=e=>e?"ff":"00",Mc=e=>Ir(L.ProtocolHash)(e),Hc=e=>wt(L.ProtocolHash)(e),Bp=e=>{const t=[];for(e.consume(4);e.length()>0;)t.push(Hc(e));return t},$p=e=>D(32*e.length)+e.map(t=>Mc(t)).join(""),Up=e=>{switch(e){case"yay":return"00";case"nay":return"01";case"pass":return"02";default:throw new wc(e)}},Gp=e=>{const t=e.consume(1);switch(t[0]){case 0:return"yay";case 1:return"nay";case 2:return"pass";default:throw new Tc(t[0].toString())}},Kp=e=>{switch(e){case"arith":return"00";case"wasm_2_0_0":return"01";case"riscv":return"02";default:throw new xc(e)}},jp=e=>{const t=e.consume(1);switch(t[0]){case 0:return"arith";case 1:return"wasm_2_0_0";case 2:return"riscv";default:throw new kc(t[0].toString())}},Fp=e=>e?Ar(!0)+Ms(e):Ar(!1),Vp=e=>{const t=parseInt(String(e),10),r=[];for(let n=0;n<4;n++){const i=(4-(n+1))*8;r.push((t&255<<i)>>i)}return Buffer.from(r).toString("hex")},Zp=e=>{const t=e.consume(4);let r=0;for(let n=0;n<t.length;n++)r=r|t[n]<<(t.length-(n+1))*8;return r},zp=e=>{const t=parseInt(String(e),10),r=[];for(let n=0;n<2;n++){const i=(2-(n+1))*8;r.push((t&255<<i)>>i)}return Buffer.from(r).toString("hex")},Wp=e=>{const t=e.consume(2);let r=0;for(let n=0;n<t.length;n++)r=r|t[n]<<(t.length-(n+1))*8;return r},ks=e=>e.consume(1)[0]===255,Jp=e=>{if(ks(e))return hi(e)},Ms=e=>{try{return ji(e)}catch(t){throw new Xn(e,t instanceof q?t.result:void 0)}},qp=e=>{if(!e)return Ar(!1);if(e.length===0)return Ar(!0)+D(0);const t=e.reduce((r,n)=>r+Ms(n),"");return Ar(!0)+D(t.length/2)+t},Yp=e=>{try{return Ki(e)}catch(t){throw new Qn(e,t instanceof q?t.result:void 0)}},Xp=e=>rn(e),Qp=e=>{try{return Ir(L.SmartRollupHash)(e)}catch(t){throw t instanceof q?new Ls(e):t}},tf=e=>rn(e),ef=e=>{switch(e.consume(1)[0]){case 0:return wt(L.Ed25519PublicKey)(e);case 1:return wt(L.Secp256k1PublicKey)(e);case 2:return wt(L.P256PublicKey)(e);case 3:return wt(L.BLS12_381PublicKey)(e);default:throw new Qn(void 0,T.NO_PREFIX_MATCHED)}},rf=e=>{try{return Ir(L.SmartRollupCommitmentHash)(e)}catch(t){throw t instanceof q?new Ns(e):t}},nf=e=>{switch(e.consume(1)[0]){case 0:return hi(e);case 1:{const r=wt(L.ContractHash)(e);return e.consume(1),r}default:throw new F(e.toString(),": Unable to decode.")}},sf=e=>wt(L.SmartRollupHash)(e),of=e=>{if(e.consume(1)[0]===1){const r=wt(L.ContractHash)(e);return e.consume(1),r}throw new rr(e.toString(),T.NO_PREFIX_MATCHED)},af=e=>wt(L.SmartRollupCommitmentHash)(e),Hs=e=>{const t=[];let r=new I(e,10);if(r.isNaN())throw new TypeError(`Invalid zarith number ${e}`);for(;;)if(r.lt(128)){r.lt(16)&&t.push("0"),t.push(r.toString(16));break}else{let n=r.mod(128);r=r.minus(n),r=r.dividedBy(128),n=n.plus(128),t.push(n.toString(16))}return t.join("")},Ds=e=>{let t=0;for(;t<e.length()&&(e.get(t)&128)!==0;)t+=1;let r=new I(0);for(let n=t;n>=0;n-=1){const i=e.get(n)&127;r=r.multipliedBy(128),r=r.plus(i)}return e.consume(t+1),new I(r).toString()},cf=e=>{const t=D(e.consume(1)[0],2);if(t in zn)return zn[t];{const r=Xt(e,1),n=Buffer.from(r).toString("utf8");if(n.length>Is)throw new ui(n);return n}},uf=e=>{if(e.consume(1)[0]!==0){const r=cf(e),n=Xt(e),i=ur(new Rt(n));return{entrypoint:r,value:i}}},lf=e=>{if(e in ua)return`${ua[e]}`;if(e.length>Is)throw new ui(e);return`ff${cr({string:e}).slice(8)}`},hf=e=>{if(!e||e.entrypoint==="default"&&"prim"in e.value&&e.value.prim==="Unit")return"00";const t=lf(e.entrypoint),r=cr(e.value),n=D(r.length/2);return`ff${t}${n}${r}`},df=e=>{const t=cr(e);return`${D(t.length/2)}${t}`},pf=e=>{const t=Xt(e);return ur(new Rt(t))},ff=Ir(L.ValueHash),gf=wt(L.ValueHash),mf=e=>`${cr({string:e}).slice(2)}`,yf=e=>{const t=Xt(e);return Buffer.from(t).toString("utf8")},Ef=e=>e?`ff${Hs(e)}`:"00",_f=e=>{const t=e.consume(1);if(Buffer.from(t).toString("hex")!=="00")return Ds(e)},bf=e=>e?`ff${Hs(e)}`:"00",vf=e=>{const t=e.consume(1);if(Buffer.from(t).toString("hex")!=="00")return Ds(e)},Af=e=>{try{const[t,r]=Ot(e,Al);if(r===L.BLS12_381Signature)return Dc(ms(t));throw new kt("we only support encoding of BLSIG signatures from protocol Seoul")}catch(t){throw t instanceof q?new ba(e,t.result):t}},Sf=e=>{if(e.consume(4),e.length().toString()==="96")return wt(L.BLS12_381Signature)(e);throw new kt("we only support decoding of BLSIG signatures")},Pf=e=>e?Ar(!0)+Af(e):Ar(!1),Rf=e=>{if(ks(e))return Sf(e)},Dc=(e,t=8)=>`${D(e.length/2,t)}${e}`,Of=e=>{const t=Xt(e);return Buffer.from(t).toString("hex")},wf=e=>{const t=e.reduce((r,n)=>r+`${D(n.length/2)}${n}`,"");return`${D(t.length/2)}${t}`},Tf=e=>{const t=Xt(e);return vp(new Rt(t)).map(n=>Buffer.from(n).toString("hex"))},If=e=>{try{return Ir(L.SlotHeader)(e)}catch(t){throw t instanceof q?new xs(e):t}},Lf=e=>wt(L.SlotHeader)(e),Nf=e=>D(e.slot_index,2)+If(e.commitment)+e.commitment_proof,xf=e=>{const t=e.consume(1);return{slot_index:Number(t[0].toString(10)),commitment:Lf(e),commitment_proof:Vr(e.consume(96))}},Cc={branch:d.BRANCH,contents:[d.OPERATION]},Cs={pkh:d.TZ1,secret:d.SECRET},Bs={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,public_key:d.PUBLIC_KEY,proof:d.SIGNATURE_PROOF},$s={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,delegate:d.DELEGATE},Us={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,amount:d.ZARITH,destination:d.ADDRESS,parameters:d.PARAMETERS},Gs={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,balance:d.ZARITH,delegate:d.DELEGATE,script:d.SCRIPT},Ks={source:d.PKH,period:d.INT32,proposal:d.PROPOSAL,ballot:d.BALLOT_STATEMENT},js={slot:d.INT16,level:d.INT32,round:d.INT32,block_payload_hash:d.BLOCK_PAYLOAD_HASH},Fs={slot:d.INT16,level:d.INT32,round:d.INT32,block_payload_hash:d.BLOCK_PAYLOAD_HASH,dal_attestation:d.ZARITH},Vs={level:d.INT32,nonce:d.RAW},Zs={source:d.PKH,period:d.INT32,proposals:d.PROPOSAL_ARR},zs={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,value:d.VALUE},Ws={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,ticket_contents:d.VALUE,ticket_ty:d.VALUE,ticket_ticketer:d.ADDRESS,ticket_amount:d.ZARITH,destination:d.ADDRESS,entrypoint:d.ENTRYPOINT},Js={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,amount:d.ZARITH,destination:d.SMART_CONTRACT_ADDRESS},qs={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,pk:d.PUBLIC_KEY,proof:d.SIGNATURE_PROOF},Ys={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,pk:d.PUBLIC_KEY,proof:d.SIGNATURE_PROOF},Xs={consensus_key:d.PKH,delegate:d.PKH,destination:d.PKH},Qs={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,limit:d.DEPOSITS_LIMIT},to={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,pvm_kind:d.PVM_KIND,kernel:d.PADDED_BYTES,parameters_ty:d.VALUE,whitelist:d.PKH_ARR},eo={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,message:d.SMART_ROLLUP_MESSAGE},ro={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,rollup:d.SMART_ROLLUP_ADDRESS,cemented_commitment:d.SMART_ROLLUP_COMMITMENT_HASH,output_proof:d.PADDED_BYTES},no={source:d.PKH,fee:d.ZARITH,counter:d.ZARITH,gas_limit:d.ZARITH,storage_limit:d.ZARITH,slot_header:d.SLOT_HEADER},io={arbitrary:d.PADDED_BYTES},kf=e=>t=>{if(!(t.kind in e)||!(t.kind in ca))throw new je(t.kind);return ca[t.kind]+e[t.kind](t)},Mf=e=>t=>{const r=t.consume(1),n=ns[r[0]];if(n===void 0)throw new Nc(r[0].toString());const i=e[n](t);if(typeof i!="object")throw new li("Invalid operation, cannot be decoded.");return Object.assign({kind:n},i)},dt=e=>t=>r=>Object.keys(t).reduce((i,s)=>{const o=t[s];if(r&&Array.isArray(o)){const a=e[o[0]],c=r[s];if(!Array.isArray(c))throw new Lc(`Invalid operation value "${JSON.stringify(c)}" of key "${s}, expected value to be Array.`);return i+c.reduce((u,l)=>u+a(l),"")}else{const a=e[o];return i+a(r[s])}},""),pt=e=>t=>r=>Object.keys(t).reduce((i,s)=>{const o=t[s];if(Array.isArray(o)){const a=e[o[0]],c=[],u=r.length();for(;r.length()>0;)if(c.push(a(r)),u===r.length())throw new li("Unable to decode value");return Object.assign(Object.assign({},i),{[s]:c})}else{const a=e[o],c=a(r);return typeof c<"u"?Object.assign(Object.assign({},i),{[s]:c}):Object.assign({},i)}},{}),C={[d.SECRET]:e=>Vr(e.consume(20)),[d.RAW]:e=>Vr(e.consume(32)),[d.TZ1]:kp,[d.BRANCH]:Mp,[d.ZARITH]:Ds,[d.PUBLIC_KEY]:ef,[d.PKH]:hi,[d.PKH_ARR]:Hp,[d.DELEGATE]:Jp,[d.INT32]:Zp,[d.SCRIPT]:bp,[d.BALLOT_STATEMENT]:Gp,[d.PROPOSAL]:Hc,[d.PROPOSAL_ARR]:Bp,[d.PARAMETERS]:uf,[d.ADDRESS]:nf,[d.SMART_ROLLUP_ADDRESS]:sf,[d.SMART_CONTRACT_ADDRESS]:of,[d.SMART_ROLLUP_COMMITMENT_HASH]:af,[d.VALUE]:pf,[d.INT16]:Wp,[d.BLOCK_PAYLOAD_HASH]:gf,[d.ENTRYPOINT]:yf,[d.BURN_LIMIT]:_f,[d.DEPOSITS_LIMIT]:vf,[d.SIGNATURE_PROOF]:Rf,[d.PVM_KIND]:jp,[d.PADDED_BYTES]:Of,[d.SMART_ROLLUP_MESSAGE]:Tf,[d.SLOT_HEADER]:xf};C[d.OPERATION]=Mf(C);C[d.OP_ACTIVATE_ACCOUNT]=e=>pt(C)(Cs)(e);C[d.OP_FAILING_NOOP]=e=>pt(C)(io)(e);C[d.OP_DELEGATION]=e=>pt(C)($s)(e);C[d.OP_TRANSACTION]=e=>pt(C)(Us)(e);C[d.OP_ORIGINATION]=e=>pt(C)(Gs)(e);C[d.OP_BALLOT]=e=>pt(C)(Ks)(e);C[d.OP_ATTESTATION]=e=>pt(C)(js)(e);C[d.OP_ATTESTATION_WITH_DAL]=e=>pt(C)(Fs)(e);C[d.OP_SEED_NONCE_REVELATION]=e=>pt(C)(Vs)(e);C[d.OP_PROPOSALS]=e=>pt(C)(Zs)(e);C[d.OP_REVEAL]=e=>pt(C)(Bs)(e);C[d.OP_REGISTER_GLOBAL_CONSTANT]=e=>pt(C)(zs)(e);C[d.OP_TRANSFER_TICKET]=e=>pt(C)(Ws)(e);C[d.OP_INCREASE_PAID_STORAGE]=e=>pt(C)(Js)(e);C[d.OP_UPDATE_CONSENSUS_KEY]=e=>pt(C)(qs)(e);C[d.OP_UPDATE_COMPANION_KEY]=e=>pt(C)(Ys)(e);C[d.OP_DRAIN_DELEGATE]=e=>pt(C)(Xs)(e);C[d.OP_SMART_ROLLUP_ORIGINATE]=e=>pt(C)(to)(e);C[d.OP_SMART_ROLLUP_ADD_MESSAGES]=e=>pt(C)(eo)(e);C[d.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=e=>pt(C)(ro)(e);C[d.OP_DAL_PUBLISH_COMMITMENT]=e=>pt(C)(no)(e);C[d.MANAGER]=pt(C)(Cc);C[d.OP_SET_DEPOSITS_LIMIT]=e=>pt(C)(Qs)(e);const Bc=31;var f;(function(e){e.SECRET="secret",e.RAW="raw",e.TZ1="tz1",e.BRANCH="branch",e.ZARITH="zarith",e.PUBLIC_KEY="public_key",e.PKH="pkh",e.PKH_ARR="pkhArr",e.DELEGATE="delegate",e.SCRIPT="script",e.BALLOT_STATEMENT="ballotStmt",e.PROPOSAL="proposal",e.PROPOSAL_ARR="proposalArr",e.INT32="int32",e.INT16="int16",e.PARAMETERS="parameters",e.ADDRESS="address",e.SMART_CONTRACT_ADDRESS="smart_contract_address",e.SMART_ROLLUP_ADDRESS="smart_rollup_address",e.SMART_ROLLUP_COMMITMENT_HASH="smart_rollup_commitment_hash",e.VALUE="value",e.PADDED_BYTES="padded_bytes",e.SMART_ROLLUP_MESSAGE="smart_rollup_message",e.MANAGER="manager",e.BLOCK_PAYLOAD_HASH="blockPayloadHash",e.ENTRYPOINT="entrypoint",e.OPERATION="operation",e.OP_ACTIVATE_ACCOUNT="activate_account",e.OP_DELEGATION="delegation",e.OP_TRANSACTION="transaction",e.OP_ORIGINATION="origination",e.OP_BALLOT="ballot",e.OP_FAILING_NOOP="failing_noop",e.OP_ATTESTATION="attestation",e.OP_ATTESTATION_WITH_DAL="attestation_with_dal",e.OP_SEED_NONCE_REVELATION="seed_nonce_revelation",e.OP_REVEAL="reveal",e.OP_PROPOSALS="proposals",e.OP_REGISTER_GLOBAL_CONSTANT="register_global_constant",e.OP_TRANSFER_TICKET="transfer_ticket",e.BURN_LIMIT="burn_limit",e.OP_INCREASE_PAID_STORAGE="increase_paid_storage",e.OP_UPDATE_CONSENSUS_KEY="update_consensus_key",e.SIGNATURE_PROOF="signature_proof",e.OP_DRAIN_DELEGATE="drain_delegate",e.DEPOSITS_LIMIT="deposits_limit",e.OP_SET_DEPOSITS_LIMIT="set_deposits_limit",e.OP_SMART_ROLLUP_ORIGINATE="smart_rollup_originate",e.PVM_KIND="pvm_kind",e.OP_SMART_ROLLUP_ADD_MESSAGES="smart_rollup_add_messages",e.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE="smart_rollup_execute_outbox_message",e.OP_DAL_PUBLISH_COMMITMENT="dal_publish_commitment",e.SLOT_HEADER="slot_header"})(f||(f={}));const ne={"00":"parameter","01":"storage","02":"code","03":"False","04":"Elt","05":"Left","06":"None","07":"Pair","08":"Right","09":"Some","0a":"True","0b":"Unit","0c":"PACK","0d":"UNPACK","0e":"BLAKE2B","0f":"SHA256",10:"SHA512",11:"ABS",12:"ADD",13:"AMOUNT",14:"AND",15:"BALANCE",16:"CAR",17:"CDR",18:"CHECK_SIGNATURE",19:"COMPARE","1a":"CONCAT","1b":"CONS","1c":"CREATE_ACCOUNT","1d":"CREATE_CONTRACT","1e":"IMPLICIT_ACCOUNT","1f":"DIP",20:"DROP",21:"DUP",22:"EDIV",23:"EMPTY_MAP",24:"EMPTY_SET",25:"EQ",26:"EXEC",27:"FAILWITH",28:"GE",29:"GET","2a":"GT","2b":"HASH_KEY","2c":"IF","2d":"IF_CONS","2e":"IF_LEFT","2f":"IF_NONE",30:"INT",31:"LAMBDA",32:"LE",33:"LEFT",34:"LOOP",35:"LSL",36:"LSR",37:"LT",38:"MAP",39:"MEM","3a":"MUL","3b":"NEG","3c":"NEQ","3d":"NIL","3e":"NONE","3f":"NOT",40:"NOW",41:"OR",42:"PAIR",43:"PUSH",44:"RIGHT",45:"SIZE",46:"SOME",47:"SOURCE",48:"SENDER",49:"SELF","4a":"STEPS_TO_QUOTA","4b":"SUB","4c":"SWAP","4d":"TRANSFER_TOKENS","4e":"SET_DELEGATE","4f":"UNIT",50:"UPDATE",51:"XOR",52:"ITER",53:"LOOP_LEFT",54:"ADDRESS",55:"CONTRACT",56:"ISNAT",57:"CAST",58:"RENAME",59:"bool","5a":"contract","5b":"int","5c":"key","5d":"key_hash","5e":"lambda","5f":"list",60:"map",61:"big_map",62:"nat",63:"option",64:"or",65:"pair",66:"set",67:"signature",68:"string",69:"bytes","6a":"mutez","6b":"timestamp","6c":"unit","6d":"operation","6e":"address","6f":"SLICE",70:"DIG",71:"DUG",72:"EMPTY_BIG_MAP",73:"APPLY",74:"chain_id",75:"CHAIN_ID",76:"LEVEL",77:"SELF_ADDRESS",78:"never",79:"NEVER","7a":"UNPAIR","7b":"VOTING_POWER","7c":"TOTAL_VOTING_POWER","7d":"KECCAK","7e":"SHA3","7f":"PAIRING_CHECK",80:"bls12_381_g1",81:"bls12_381_g2",82:"bls12_381_fr",83:"sapling_state",84:"sapling_transaction_deprecated",85:"SAPLING_EMPTY_STATE",86:"SAPLING_VERIFY_UPDATE",87:"ticket",88:"TICKET_DEPRECATED",89:"READ_TICKET","8a":"SPLIT_TICKET","8b":"JOIN_TICKETS","8c":"GET_AND_UPDATE","8d":"chest","8e":"chest_key","8f":"OPEN_CHEST",90:"VIEW",91:"view",92:"constant",93:"SUB_MUTEZ",94:"tx_rollup_l2_address",95:"MIN_BLOCK_TIME",96:"sapling_transaction",97:"EMIT",98:"Lambda_rec",99:"LAMBDA_REC","9a":"TICKET","9b":"BYTES","9c":"NAT","9d":"Ticket"},Hf=(()=>{const e={};return Object.keys(ne).forEach(t=>{e[ne[t]]=t}),e})(),is={4:"activate_account",107:"reveal",110:"delegation",108:"transaction",109:"origination",6:"ballot",21:"attestation",23:"attestation_with_dal",1:"seed_nonce_revelation",5:"proposals",111:"register_global_constant",158:"transfer_ticket",112:"set_deposits_limit",113:"increase_paid_storage",114:"update_consensus_key",9:"drain_delegate",200:"smart_rollup_originate",201:"smart_rollup_add_messages",206:"smart_rollup_execute_outbox_message",230:"dal_publish_commitment",17:"failing_noop"},da=(()=>{const e={};return Object.keys(is).forEach(t=>{const r=typeof t=="string"?parseInt(t,10):t;e[is[r]]=D(r,2)}),e})(),Wn={"00":"default","01":"root","02":"do","03":"set_delegate","04":"remove_delegate","05":"deposit","06":"stake","07":"unstake","08":"finalize_unstake","09":"set_delegate_parameters"},pa=(()=>{const e={};return Object.keys(Wn).forEach(t=>{e[Wn[t]]=t}),e})(),Df=e=>"prim"in e,Cf=e=>"bytes"in e&&typeof e.bytes=="string",Bf=e=>"string"in e&&typeof e.string=="string",$f=e=>"int"in e&&typeof e.int=="string",Uf=e=>{const t=lr(e.code),r=lr(e.storage);return`${D(t.length/2,8)}${t}${D(r.length/2,8)}${r}`},Gf=e=>{const t=Qt(e),r=Qt(e);return{code:hr(new Rt(t)),storage:hr(new Rt(r))}},lr=e=>{if(Array.isArray(e)){const t=e.map(n=>lr(n)).join(""),r=t.length/2;return`02${D(r)}${t}`}else{if(Df(e))return Jf(e);if(Cf(e))return jf(e);if(Bf(e))return Vf(e);if($f(e))return zf(e)}throw new Ic(JSON.stringify(e))},hr=e=>{const t=e.consume(1);switch(t[0]){case 10:return Ff(e);case 1:return Zf(e);case 0:return Wf(e);case 2:{const r=new Rt(Qt(e)),n=[];for(;r.length()>0;)n.push(hr(r));return n}default:return qf(e,t)}},Qt=(e,t=4)=>{const r=e.consume(t),n=parseInt(Buffer.from(r).toString("hex"),16);return e.consume(n)},Kf=(e,t=4)=>{const r=[];let n=e;for(;n.length();){const i=n.consume(t),s=parseInt(Buffer.from(i).toString("hex"),16);r.push(n.consume(s)),n=n.slice(s+t)}return r},jf=e=>{if(!/^([A-Fa-f0-9]{2})*$/.test(e.bytes))throw new ys(e.bytes);const t=e.bytes.length/2;return`0a${D(t)}${e.bytes}`},Ff=e=>{const t=Qt(e);return{bytes:Buffer.from(t).toString("hex")}},Vf=e=>{const t=Buffer.from(e.string,"utf8").toString("hex"),r=t.length/2;return`01${D(r)}${t}`},Zf=e=>{const t=Qt(e);return{string:Buffer.from(t).toString("utf8")}},zf=({int:e})=>{const t=new I(e,10),r=t.toString(2)[0]==="-"?"1":"0",n=t.toString(2).replace(/-/g,""),i=n.length<=6?6:(n.length-6)%7?n.length+7-(n.length-6)%7:n.length,o=n.padStart(i,"0").match(/\d{6,7}/g).reverse();return o[0]=r+o[0],`00${o.map((c,u)=>parseInt((u===o.length-1?"0":"1")+c,2).toString(16).padStart(2,"0")).join("")}`},Wf=e=>{let t=e.consume(1)[0];const r=[],n=128;for(;t&n;)r.push(t),t=e.consume(1)[0];r.push(t);const i=!!(64&r[0]);r[0]=r[0]&127;const s=r.map((a,c)=>a.toString(2).slice(c===0?-6:-7).padStart(c===0?6:7,"0")).reverse();let o=new I(s.join(""),2);return i&&(o=o.times(-1)),{int:o.toFixed()}},Jf=e=>{const t=+Array.isArray(e.annots),r=Array.isArray(e.args)?e.args.length:0,n=D(Math.min(2*r+t+3,9),2),i=Hf[e.prim];let s=(e.args||[]).map(a=>lr(a)).join("");const o=Array.isArray(e.annots)?Qf(e.annots):"";return(e.prim==="LAMBDA"||e.prim==="LAMBDA_REC")&&r&&(s=D(s.length/2)+s+D(0)),(e.prim==="pair"||e.prim==="Pair")&&r>2&&(s=o===""?D(s.length/2)+s+D(0):D(s.length/2)+s),e.prim==="view"&&e.args&&(s=D(s.length/2)+s+D(0)),`${n}${i}${s}${o}`},qf=(e,t)=>{const r=(t[0]-3)%2===1;let n=Math.floor((t[0]-3)/2);const i=e.consume(1)[0].toString(16).padStart(2,"0"),s={prim:ne[i]};if((ne[i]==="LAMBDA"||ne[i]==="LAMBDA_REC")&&e.consume(4),ne[i]==="view")return n!=0?Yf(e,s):s;let o,a;(ne[i]==="pair"||ne[i]==="Pair")&&n>2&&(o=Xf(e),n=0,a=fa(e));const c=new Array(n).fill(0).map(()=>hr(e));return(ne[i]==="LAMBDA"||ne[i]==="LAMBDA_REC")&&e.consume(4),o?s.args=o:c.length&&(s.args=c),a&&a[0]!==""?s.annots=a:r&&(s.annots=fa(e)),s},Yf=(e,t)=>(e.consume(4),t.args=new Array(4).fill(0).map(()=>hr(e)),e.consume(4),t),Xf=e=>{const t=new Rt(Qt(e)),r=[];for(;t.length()>0;)r.push(hr(t));return r},Qf=e=>{const t=e.map(n=>Buffer.from(n,"utf8").toString("hex")).join("20"),r=t.length/2;return`${D(r)}${t}`},fa=e=>{const t=e.consume(4),r=parseInt(Buffer.from(t).toString("hex"),16),n=e.consume(r);return Buffer.from(n).toString("hex").split("20").map(s=>Buffer.from(s,"hex").toString("utf8"))},Et=e=>t=>ms(Buffer.from(El(t,va[e]))),Tt=e=>t=>{const r=t.consume(_l[e]);return bl(r,va[e])},tg=Tt(R.TZ1),eg=Tt(R.B),di=e=>{const t=e.consume(1);if(t[0]===0)return Tt(R.TZ1)(e);if(t[0]===1)return Tt(R.TZ2)(e);if(t[0]===2)return Tt(R.TZ3)(e);if(t[0]===3)return Tt(R.TZ4)(e)},rg=e=>{if(!so(e))return;const t=[];for(e.consume(4);e.length()>0;)t.push(di(e));return t},ng=Et(R.B),ig=Et(R.TZ1),Sr=e=>e?"ff":"00",$c=e=>Et(R.P)(e),Uc=e=>Tt(R.P)(e),sg=e=>{const t=[];for(e.consume(4);e.length()>0;)t.push(Uc(e));return t},og=e=>D(32*e.length)+e.map(t=>$c(t)).join(""),ag=e=>{switch(e){case"yay":return"00";case"nay":return"01";case"pass":return"02";default:throw new wc(e)}},cg=e=>{const t=e.consume(1);switch(t[0]){case 0:return"yay";case 1:return"nay";case 2:return"pass";default:throw new Tc(t[0].toString())}},ug=e=>{switch(e){case"arith":return"00";case"wasm_2_0_0":return"01";case"riscv":return"02";default:throw new xc(e)}},lg=e=>{const t=e.consume(1);switch(t[0]){case 0:return"arith";case 1:return"wasm_2_0_0";case 2:return"riscv";default:throw new kc(t[0].toString())}},hg=e=>e?Sr(!0)+pi(e):Sr(!1),dg=e=>{const t=parseInt(String(e),10),r=[];for(let n=0;n<4;n++){const i=(4-(n+1))*8;r.push((t&255<<i)>>i)}return Buffer.from(r).toString("hex")},pg=e=>{const t=e.consume(4);let r=0;for(let n=0;n<t.length;n++)r=r|t[n]<<(t.length-(n+1))*8;return r},fg=e=>{const t=parseInt(String(e),10),r=[];for(let n=0;n<2;n++){const i=(2-(n+1))*8;r.push((t&255<<i)>>i)}return Buffer.from(r).toString("hex")},gg=e=>{const t=e.consume(2);let r=0;for(let n=0;n<t.length;n++)r=r|t[n]<<(t.length-(n+1))*8;return r},so=e=>e.consume(1)[0]===255,mg=e=>{if(so(e))return di(e)},pi=e=>{switch(e.substring(0,3)){case R.TZ1:return"00"+Et(R.TZ1)(e);case R.TZ2:return"01"+Et(R.TZ2)(e);case R.TZ3:return"02"+Et(R.TZ3)(e);case R.TZ4:return"03"+Et(R.TZ4)(e);default:throw new Xn(e,zt(T.NO_PREFIX_MATCHED)+` expecting one for the following "${R.TZ1}", "${R.TZ2}", "${R.TZ3}" or "${R.TZ4}".`)}},yg=e=>{if(!e)return Sr(!1);if(e.length===0)return Sr(!0)+D(0);const t=e.reduce((r,n)=>r+pi(n),"");return Sr(!0)+D(t.length/2)+t},Eg=e=>{switch(e.substring(0,4)){case R.EDPK:return"00"+Et(R.EDPK)(e);case R.SPPK:return"01"+Et(R.SPPK)(e);case R.P2PK:return"02"+Et(R.P2PK)(e);case R.BLPK:return"03"+Et(R.BLPK)(e);default:throw new Qn(e,zt(T.NO_PREFIX_MATCHED)+` expecting one of the following '${R.EDPK}', '${R.SPPK}', '${R.P2PK}' or '${R.BLPK}'.`)}},_g=e=>{switch(e.substring(0,3)){case R.TZ1:case R.TZ2:case R.TZ3:case R.TZ4:return"00"+pi(e);case R.KT1:return"01"+Et(R.KT1)(e)+"00";default:throw new F(e,zt(T.NO_PREFIX_MATCHED)+` expecting one of the following prefix '${R.TZ1}', ${R.TZ2}', '${R.TZ3}', '${R.TZ4}' or '${R.KT1}'.`)}},bg=e=>{if(e.substring(0,3)!==R.SR1)throw new Ls(e,zt(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.SR1}'.`);return Et(R.SR1)(e)},vg=e=>{if(e.substring(0,3)===R.KT1)return"01"+Et(R.KT1)(e)+"00";throw new rr(e,zt(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.KT1}'.`)},Ag=e=>{switch(e.consume(1)[0]){case 0:return Tt(R.EDPK)(e);case 1:return Tt(R.SPPK)(e);case 2:return Tt(R.P2PK)(e);case 3:return Tt(R.BLPK)(e);default:throw new Qn(e.toString(),zt(T.NO_PREFIX_MATCHED))}},Sg=e=>{if(e.substring(0,4)===R.SRC1)return Et(R.SRC1)(e);throw new Ns(e,zt(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.SRC1}'`)},Pg=e=>{switch(e.consume(1)[0]){case 0:return di(e);case 1:{const r=Tt(R.KT1)(e);return e.consume(1),r}default:throw new F(e.toString(),": Unable to decode.")}},Rg=e=>{const t=Tt(R.SR1)(e);if(t.substring(0,3)!==R.SR1)throw new Ls(t,zt(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.SR1}'.`);return t},Og=e=>{if(e.consume(1)[0]===1){const r=Tt(R.KT1)(e);return e.consume(1),r}throw new rr(e.toString(),zt(T.NO_PREFIX_MATCHED))},wg=e=>{const t=Tt(R.SRC1)(e);if(t.substring(0,4)!==R.SRC1)throw new Ns(t,zt(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.SRC1}'`);return t},oo=e=>{const t=[];let r=new I(e,10);if(r.isNaN())throw new TypeError(`Invalid zarith number ${e}`);for(;;)if(r.lt(128)){r.lt(16)&&t.push("0"),t.push(r.toString(16));break}else{let n=r.mod(128);r=r.minus(n),r=r.dividedBy(128),n=n.plus(128),t.push(n.toString(16))}return t.join("")},ao=e=>{let t=0;for(;t<e.length()&&(e.get(t)&128)!==0;)t+=1;let r=new I(0);for(let n=t;n>=0;n-=1){const i=e.get(n)&127;r=r.multipliedBy(128),r=r.plus(i)}return e.consume(t+1),new I(r).toString()},Tg=e=>{const t=D(e.consume(1)[0],2);if(t in Wn)return Wn[t];{const r=Qt(e,1),n=Buffer.from(r).toString("utf8");if(n.length>Bc)throw new ui(n);return n}},Ig=e=>{if(e.consume(1)[0]!==0){const r=Tg(e),n=Qt(e),i=hr(new Rt(n));return{entrypoint:r,value:i}}},Lg=e=>{if(e in pa)return`${pa[e]}`;if(e.length>Bc)throw new ui(e);return`ff${lr({string:e}).slice(8)}`},Ng=e=>{if(!e||e.entrypoint==="default"&&"prim"in e.value&&e.value.prim==="Unit")return"00";const t=Lg(e.entrypoint),r=lr(e.value),n=D(r.length/2);return`ff${t}${n}${r}`},xg=e=>{const t=lr(e);return`${D(t.length/2)}${t}`},kg=e=>{const t=Qt(e);return hr(new Rt(t))},Mg=Et(R.VH),Hg=Tt(R.VH),Dg=e=>`${lr({string:e}).slice(2)}`,Cg=e=>{const t=Qt(e);return Buffer.from(t).toString("utf8")},Bg=e=>e?`ff${oo(e)}`:"00",$g=e=>{const t=e.consume(1);if(Buffer.from(t).toString("hex")!=="00")return ao(e)},Ug=e=>e?`ff${oo(e)}`:"00",Gg=e=>{const t=e.consume(1);if(Buffer.from(t).toString("hex")!=="00")return ao(e)},Kg=e=>{switch(e.substring(0,5)){case R.EDSIG:return Qr(Et(R.EDSIG)(e));case R.SPSIG:return Qr(Et(R.SPSIG)(e));case R.P2SIG:return Qr(Et(R.P2SIG)(e));case R.BLSIG:return Qr(Et(R.BLSIG)(e));default:throw new ba(e,zt(T.NO_PREFIX_MATCHED)+` expecting one of the following '${R.EDSIG}', '${R.SPSIG}', '${R.P2SIG}' or '${R.BLSIG}'.`)}},jg=e=>{if(e.consume(4),e.length().toString()==="96")return Tt(R.BLSIG)(e);throw new kt("currently we only support decoding of BLSIG signatures")},Fg=e=>e?Sr(!0)+Kg(e):Sr(!1),Vg=e=>{if(so(e))return jg(e)},Qr=(e,t=8)=>`${D(e.length/2,t)}${e}`,Zg=e=>{const t=Qt(e);return Buffer.from(t).toString("hex")},zg=e=>{const t=e.reduce((r,n)=>r+`${D(n.length/2)}${n}`,"");return`${D(t.length/2)}${t}`},Wg=e=>{const t=Qt(e);return Kf(new Rt(t)).map(n=>Buffer.from(n).toString("hex"))},Jg=e=>{if(e.substring(0,2)===R.SH)return Et(R.SH)(e);throw new xs(e,zt(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.SH}'`)},qg=e=>{const t=Tt(R.SH)(e);if(t.substring(0,2)!==R.SH)throw new xs(t,zt(T.NO_PREFIX_MATCHED)+` expecting prefix '${R.SH}'`);return t},Yg=e=>D(e.slot_index,2)+Jg(e.commitment)+e.commitment_proof,Xg=e=>{const t=e.consume(1);return{slot_index:Number(t[0].toString(10)),commitment:qg(e),commitment_proof:Vr(e.consume(96))}},Gc={branch:f.BRANCH,contents:[f.OPERATION]},Kc={pkh:f.TZ1,secret:f.SECRET},jc={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,public_key:f.PUBLIC_KEY},Fc={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,delegate:f.DELEGATE},Vc={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,amount:f.ZARITH,destination:f.ADDRESS,parameters:f.PARAMETERS},Zc={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,balance:f.ZARITH,delegate:f.DELEGATE,script:f.SCRIPT},zc={source:f.PKH,period:f.INT32,proposal:f.PROPOSAL,ballot:f.BALLOT_STATEMENT},Wc={slot:f.INT16,level:f.INT32,round:f.INT32,block_payload_hash:f.BLOCK_PAYLOAD_HASH},Jc={slot:f.INT16,level:f.INT32,round:f.INT32,block_payload_hash:f.BLOCK_PAYLOAD_HASH,dal_attestation:f.ZARITH},qc={level:f.INT32,nonce:f.RAW},Yc={source:f.PKH,period:f.INT32,proposals:f.PROPOSAL_ARR},Xc={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,value:f.VALUE},Qc={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,ticket_contents:f.VALUE,ticket_ty:f.VALUE,ticket_ticketer:f.ADDRESS,ticket_amount:f.ZARITH,destination:f.ADDRESS,entrypoint:f.ENTRYPOINT},tu={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,amount:f.ZARITH,destination:f.SMART_CONTRACT_ADDRESS},eu={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,pk:f.PUBLIC_KEY,proof:f.SIGNATURE_PROOF},ru={consensus_key:f.PKH,delegate:f.PKH,destination:f.PKH},nu={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,limit:f.DEPOSITS_LIMIT},iu={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,pvm_kind:f.PVM_KIND,kernel:f.PADDED_BYTES,parameters_ty:f.VALUE,whitelist:f.PKH_ARR},su={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,message:f.SMART_ROLLUP_MESSAGE},ou={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,rollup:f.SMART_ROLLUP_ADDRESS,cemented_commitment:f.SMART_ROLLUP_COMMITMENT_HASH,output_proof:f.PADDED_BYTES},au={source:f.PKH,fee:f.ZARITH,counter:f.ZARITH,gas_limit:f.ZARITH,storage_limit:f.ZARITH,slot_header:f.SLOT_HEADER},cu={arbitrary:f.PADDED_BYTES},Qg=e=>t=>{if(!(t.kind in e)||!(t.kind in da))throw new je(t.kind);return da[t.kind]+e[t.kind](t)},tm=e=>t=>{const r=t.consume(1),n=is[r[0]];if(n===void 0)throw new Nc(r[0].toString());const i=e[n](t);if(typeof i!="object")throw new li("Invalid operation, cannot be decoded.");return Object.assign({kind:n},i)},gt=e=>t=>r=>Object.keys(t).reduce((i,s)=>{const o=t[s];if(r&&Array.isArray(o)){const a=e[o[0]],c=r[s];if(!Array.isArray(c))throw new Lc(`Invalid operation value "${JSON.stringify(c)}" of key "${s}, expected value to be Array.`);return i+c.reduce((u,l)=>u+a(l),"")}else{const a=e[o];return i+a(r[s])}},""),mt=e=>t=>r=>Object.keys(t).reduce((i,s)=>{const o=t[s];if(Array.isArray(o)){const a=e[o[0]],c=[],u=r.length();for(;r.length()>0;)if(c.push(a(r)),u===r.length())throw new li("Unable to decode value");return Object.assign(Object.assign({},i),{[s]:c})}else{const a=e[o],c=a(r);return typeof c<"u"?Object.assign(Object.assign({},i),{[s]:c}):Object.assign({},i)}},{}),U={[f.SECRET]:e=>Vr(e.consume(20)),[f.RAW]:e=>Vr(e.consume(32)),[f.TZ1]:tg,[f.BRANCH]:eg,[f.ZARITH]:ao,[f.PUBLIC_KEY]:Ag,[f.PKH]:di,[f.PKH_ARR]:rg,[f.DELEGATE]:mg,[f.INT32]:pg,[f.SCRIPT]:Gf,[f.BALLOT_STATEMENT]:cg,[f.PROPOSAL]:Uc,[f.PROPOSAL_ARR]:sg,[f.PARAMETERS]:Ig,[f.ADDRESS]:Pg,[f.SMART_ROLLUP_ADDRESS]:Rg,[f.SMART_CONTRACT_ADDRESS]:Og,[f.SMART_ROLLUP_COMMITMENT_HASH]:wg,[f.VALUE]:kg,[f.INT16]:gg,[f.BLOCK_PAYLOAD_HASH]:Hg,[f.ENTRYPOINT]:Cg,[f.BURN_LIMIT]:$g,[f.DEPOSITS_LIMIT]:Gg,[f.SIGNATURE_PROOF]:Vg,[f.PVM_KIND]:lg,[f.PADDED_BYTES]:Zg,[f.SMART_ROLLUP_MESSAGE]:Wg,[f.SLOT_HEADER]:Xg};U[f.OPERATION]=tm(U);U[f.OP_ACTIVATE_ACCOUNT]=e=>mt(U)(Kc)(e);U[f.OP_FAILING_NOOP]=e=>mt(U)(cu)(e);U[f.OP_DELEGATION]=e=>mt(U)(Fc)(e);U[f.OP_TRANSACTION]=e=>mt(U)(Vc)(e);U[f.OP_ORIGINATION]=e=>mt(U)(Zc)(e);U[f.OP_BALLOT]=e=>mt(U)(zc)(e);U[f.OP_ATTESTATION]=e=>mt(U)(Wc)(e);U[f.OP_ATTESTATION_WITH_DAL]=e=>mt(U)(Jc)(e);U[f.OP_SEED_NONCE_REVELATION]=e=>mt(U)(qc)(e);U[f.OP_PROPOSALS]=e=>mt(U)(Yc)(e);U[f.OP_REVEAL]=e=>mt(U)(jc)(e);U[f.OP_REGISTER_GLOBAL_CONSTANT]=e=>mt(U)(Xc)(e);U[f.OP_TRANSFER_TICKET]=e=>mt(U)(Qc)(e);U[f.OP_INCREASE_PAID_STORAGE]=e=>mt(U)(tu)(e);U[f.OP_UPDATE_CONSENSUS_KEY]=e=>mt(U)(eu)(e);U[f.OP_DRAIN_DELEGATE]=e=>mt(U)(ru)(e);U[f.OP_SMART_ROLLUP_ORIGINATE]=e=>mt(U)(iu)(e);U[f.OP_SMART_ROLLUP_ADD_MESSAGES]=e=>mt(U)(su)(e);U[f.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=e=>mt(U)(ou)(e);U[f.OP_DAL_PUBLISH_COMMITMENT]=e=>mt(U)(au)(e);U[f.MANAGER]=mt(U)(Gc);U[f.OP_SET_DEPOSITS_LIMIT]=e=>mt(U)(nu)(e);const B={[d.SECRET]:e=>e,[d.RAW]:e=>e,[d.TZ1]:Cp,[d.BRANCH]:Dp,[d.ZARITH]:Hs,[d.PUBLIC_KEY]:Yp,[d.PKH]:Ms,[d.PKH_ARR]:qp,[d.DELEGATE]:Fp,[d.SCRIPT]:_p,[d.BALLOT_STATEMENT]:Up,[d.PROPOSAL]:Mc,[d.PROPOSAL_ARR]:$p,[d.INT32]:Vp,[d.PARAMETERS]:hf,[d.ADDRESS]:Xp,[d.SMART_ROLLUP_ADDRESS]:Qp,[d.SMART_CONTRACT_ADDRESS]:tf,[d.SMART_ROLLUP_COMMITMENT_HASH]:rf,[d.VALUE]:df,[d.INT16]:zp,[d.BLOCK_PAYLOAD_HASH]:ff,[d.ENTRYPOINT]:mf,[d.BURN_LIMIT]:Ef,[d.DEPOSITS_LIMIT]:bf,[d.SIGNATURE_PROOF]:Pf,[d.PVM_KIND]:Kp,[d.PADDED_BYTES]:Dc,[d.SMART_ROLLUP_MESSAGE]:wf,[d.SLOT_HEADER]:Nf};B[d.OPERATION]=kf(B);B[d.OP_ACTIVATE_ACCOUNT]=e=>dt(B)(Cs)(e);B[d.OP_DELEGATION]=e=>dt(B)($s)(e);B[d.OP_TRANSACTION]=e=>dt(B)(Us)(e);B[d.OP_ORIGINATION]=e=>dt(B)(Gs)(e);B[d.OP_BALLOT]=e=>dt(B)(Ks)(e);B[d.OP_ATTESTATION]=e=>dt(B)(js)(e);B[d.OP_ATTESTATION_WITH_DAL]=e=>dt(B)(Fs)(e);B[d.OP_SEED_NONCE_REVELATION]=e=>dt(B)(Vs)(e);B[d.OP_PROPOSALS]=e=>dt(B)(Zs)(e);B[d.OP_REVEAL]=e=>dt(B)(Bs)(e);B[d.OP_REGISTER_GLOBAL_CONSTANT]=e=>dt(B)(zs)(e);B[d.OP_TRANSFER_TICKET]=e=>dt(B)(Ws)(e);B[d.OP_INCREASE_PAID_STORAGE]=e=>dt(B)(Js)(e);B[d.OP_UPDATE_CONSENSUS_KEY]=e=>dt(B)(qs)(e);B[d.OP_UPDATE_COMPANION_KEY]=e=>dt(B)(Ys)(e);B[d.OP_DRAIN_DELEGATE]=e=>dt(B)(Xs)(e);B[d.OP_SMART_ROLLUP_ORIGINATE]=e=>dt(B)(to)(e);B[d.OP_SMART_ROLLUP_ADD_MESSAGES]=e=>dt(B)(eo)(e);B[d.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=e=>dt(B)(ro)(e);B[d.OP_DAL_PUBLISH_COMMITMENT]=e=>dt(B)(no)(e);B[d.MANAGER]=dt(B)(Cc);B[d.OP_SET_DEPOSITS_LIMIT]=e=>dt(B)(Qs)(e);B[d.OP_FAILING_NOOP]=e=>dt(B)(io)(e);const G={[f.SECRET]:e=>e,[f.RAW]:e=>e,[f.TZ1]:ig,[f.BRANCH]:ng,[f.ZARITH]:oo,[f.PUBLIC_KEY]:Eg,[f.PKH]:pi,[f.PKH_ARR]:yg,[f.DELEGATE]:hg,[f.SCRIPT]:Uf,[f.BALLOT_STATEMENT]:ag,[f.PROPOSAL]:$c,[f.PROPOSAL_ARR]:og,[f.INT32]:dg,[f.PARAMETERS]:Ng,[f.ADDRESS]:_g,[f.SMART_ROLLUP_ADDRESS]:bg,[f.SMART_CONTRACT_ADDRESS]:vg,[f.SMART_ROLLUP_COMMITMENT_HASH]:Sg,[f.VALUE]:xg,[f.INT16]:fg,[f.BLOCK_PAYLOAD_HASH]:Mg,[f.ENTRYPOINT]:Dg,[f.BURN_LIMIT]:Bg,[f.DEPOSITS_LIMIT]:Ug,[f.SIGNATURE_PROOF]:Fg,[f.PVM_KIND]:ug,[f.PADDED_BYTES]:Qr,[f.SMART_ROLLUP_MESSAGE]:zg,[f.SLOT_HEADER]:Yg};G[f.OPERATION]=Qg(G);G[f.OP_ACTIVATE_ACCOUNT]=e=>gt(G)(Kc)(e);G[f.OP_DELEGATION]=e=>gt(G)(Fc)(e);G[f.OP_TRANSACTION]=e=>gt(G)(Vc)(e);G[f.OP_ORIGINATION]=e=>gt(G)(Zc)(e);G[f.OP_BALLOT]=e=>gt(G)(zc)(e);G[f.OP_ATTESTATION]=e=>gt(G)(Wc)(e);G[f.OP_ATTESTATION_WITH_DAL]=e=>gt(G)(Jc)(e);G[f.OP_SEED_NONCE_REVELATION]=e=>gt(G)(qc)(e);G[f.OP_PROPOSALS]=e=>gt(G)(Yc)(e);G[f.OP_REVEAL]=e=>gt(G)(jc)(e);G[f.OP_REGISTER_GLOBAL_CONSTANT]=e=>gt(G)(Xc)(e);G[f.OP_TRANSFER_TICKET]=e=>gt(G)(Qc)(e);G[f.OP_INCREASE_PAID_STORAGE]=e=>gt(G)(tu)(e);G[f.OP_UPDATE_CONSENSUS_KEY]=e=>gt(G)(eu)(e);G[f.OP_DRAIN_DELEGATE]=e=>gt(G)(ru)(e);G[f.OP_SMART_ROLLUP_ORIGINATE]=e=>gt(G)(iu)(e);G[f.OP_SMART_ROLLUP_ADD_MESSAGES]=e=>gt(G)(su)(e);G[f.OP_SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE]=e=>gt(G)(ou)(e);G[f.OP_DAL_PUBLISH_COMMITMENT]=e=>gt(G)(au)(e);G[f.MANAGER]=gt(G)(Gc);G[f.OP_SET_DEPOSITS_LIMIT]=e=>gt(G)(nu)(e);G[f.OP_FAILING_NOOP]=e=>gt(G)(cu)(e);const uu={activate_account:Cs,reveal:Bs,delegation:$s,transaction:Us,origination:Gs,ballot:Ks,attestation:js,attestation_with_dal:Fs,seed_nonce_revelation:Vs,proposals:Zs,register_global_constant:zs,transfer_ticket:Ws,increase_paid_storage:Js,update_consensus_key:qs,update_companion_key:Ys,drain_delegate:Xs,set_deposits_limit:Qs,smart_rollup_originate:to,smart_rollup_add_messages:eo,smart_rollup_execute_outbox_message:ro,dal_publish_commitment:no,failing_noop:io},em=(e,t)=>t.filter(r=>!e.includes(r)),rm=(e,t)=>e.filter(r=>r!==t),nm=e=>Object.keys(uu).includes(e),im=e=>{const t=e.kind,r=Object.keys(e),n=rm(r,"kind"),i=Object.keys(uu[t]);return em(n,i)};var dn;(function(e){e.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",e.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",e.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",e.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",e.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",e.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",e.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",e.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",e.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",e.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",e.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",e.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",e.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",e.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",e.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",e.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",e.ProxfordY="ProxfordYmVfjWnRcgjWH36fW6PArwqykTFzotUxRs6gmTcZDuH",e.PtParisBx="PtParisBxoLz5gzMmn3d9WBQNoPSZakgnkMC2VNuQ3KXfUtUQeZ",e.PsParisCZ="PsParisCZo7KAh1Z1smVd9ZMZ1HHn5gkzbM94V3PLCpknFWhUAi",e.PsQuebecn="PsQuebecnLByd3JwTiGadoG4nGWi3HYiLXUjkibeFV8dCFeVMUg",e.PsRiotuma="PsRiotumaAMotcRoDWW1bysEhQy2n1M5fy8JgRp8jjRfHGmfeA7",e.PtSeouLou="PtSeouLouXkxhg39oWzjxDWaCydNfR3RxCUrNe4Q9Ro8BTehcbh",e.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(dn||(dn={}));const ga={Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd:4,PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU:5,PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS:5,PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb:6,PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo:7,PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA:8,PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i:9,PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV:10,PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx:11,Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A:12,PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY:13,PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg:14,PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW:15,PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc:16,PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1:16,PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf:17,ProxfordYmVfjWnRcgjWH36fW6PArwqykTFzotUxRs6gmTcZDuH:19,PtParisBxoLz5gzMmn3d9WBQNoPSZakgnkMC2VNuQ3KXfUtUQeZ:20,PsParisCZo7KAh1Z1smVd9ZMZ1HHn5gkzbM94V3PLCpknFWhUAi:20,PsQuebecnLByd3JwTiGadoG4nGWi3HYiLXUjkibeFV8dCFeVMUg:21,PsRiotumaAMotcRoDWW1bysEhQy2n1M5fy8JgRp8jjRfHGmfeA7:22,PtSeouLouXkxhg39oWzjxDWaCydNfR3RxCUrNe4Q9Ro8BTehcbh:23,ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK:23};function sm(e,t){return ga[e]<ga[t]}typeof globalThis.TextEncoder>"u"&&(globalThis.TextEncoder=TextEncoder);typeof globalThis.TextDecoder>"u"&&(globalThis.TextDecoder=TextDecoder);const om=dn.PtSeouLou;function am(e,t){return t===dn.PsRiotuma||sm(t,dn.PsRiotuma)?{encoder:G[e],decoder:r=>{const n=Rt.fromHexString(r);return U[e](n)}}:{encoder:B[e],decoder:r=>{const n=Rt.fromHexString(r);return C[e](n)}}}class lu{constructor(t=om){this.protocolHash=t,this.codec=am(d.MANAGER,this.protocolHash)}forge(t){const r=ml(t.branch);if(r!==T.VALID)throw new yl(t.branch,r);for(const i of t.contents){if(!nm(i.kind))throw new je(i.kind);const s=im(i);if(s.length===1){if(i.kind==="delegation"&&s[0]==="delegate")continue;if(i.kind==="origination"&&s[0]==="delegate")continue;if(i.kind==="transaction"&&s[0]==="parameters")continue;if(i.kind==="set_deposits_limit"&&s[0]==="limit")continue;if(i.kind==="smart_rollup_originate"&&s[0]==="whitelist")continue;if(i.kind==="update_consensus_key"&&s[0]==="proof")continue;if(i.kind==="update_companion_key"&&s[0]==="proof")continue;if(i.kind==="reveal"&&s[0]==="proof")continue;throw new la(i,`missing properties "${s.join(", ")}"`)}else if(s.length>1)throw new la(i,`missing properties "${s.join(", ")}"`)}const n=this.codec.encoder(t).toLowerCase();return Promise.resolve(n)}parse(t){return Promise.resolve(this.codec.decoder(t))}}const g0=new lu;function ut(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function p(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(g){o(g)}}function c(l){try{u(n.throw(l))}catch(g){o(g)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(e,t||[])).next())})}function On(e,t,r,n){if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function lt(e,t,r,n,i){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,r),r}function cm(e,t){const r=JSON.parse(e.body);if(r[0]&&r[0].kind&&r[0].msg){const n=JSON.stringify({kind:r[0].kind,id:r[0].id,msg:r[0].msg.replace(t,"")});return new Pr(`Http error response: (${e.status}) ${n}`,e.status,e.statusText,n,e.url)}else return e}class co{constructor(t){this.context=t}inject(t){return p(this,void 0,void 0,function*(){let r;try{r=yield this.context.rpc.injectOperation(t)}catch(n){const i=". You may want to use --replace to provide adequate fee and replace it";throw n instanceof Pr&&n.message.includes(i)?cm(n,i):n}return r})}}class wn extends ei{constructor(){super(),this.name="UnconfiguredSignerError",this.message="No signer has been configured. Please configure one by calling setProvider({signer}) on your TezosToolkit instance."}}class ss{publicKey(){return p(this,void 0,void 0,function*(){throw new wn})}publicKeyHash(){return p(this,void 0,void 0,function*(){throw new wn})}secretKey(){return p(this,void 0,void 0,function*(){throw new wn})}sign(t,r){return p(this,void 0,void 0,function*(){throw new wn})}}function hu(e){return new _t(t=>(e.on("data",r=>{t.next(r)}),e.on("error",r=>{t.error(r)}),e.on("close",()=>{t.complete()}),()=>{e.close()}))}const um={DELEGATION:10600,ORIGINATION:10600,TRANSFER:10600,REVEAL_TZ1:1e3,REVEAL_TZ2:1e3,REVEAL_TZ3:2e3,REVEAL_TZ4:2e3},lm={DELEGATION:1257,ORIGINATION:1e4,TRANSFER:1e4,REVEAL:374},hm={DELEGATION:0,ORIGINATION:257,TRANSFER:257,REVEAL:0},Tn={TZ1:171,TZ2:157,TZ3:447,TZ4:3252},In={TZ1:278,TZ2:277,TZ3:306,TZ4:736},os=0,dm=257,du=250;var ot;(function(e){e.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",e.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",e.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",e.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",e.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",e.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",e.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",e.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",e.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",e.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",e.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",e.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",e.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",e.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",e.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",e.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",e.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",e.ProxfordY="ProxfordYmVfjWnRcgjWH36fW6PArwqykTFzotUxRs6gmTcZDuH",e.PtParisBx="PtParisBxoLz5gzMmn3d9WBQNoPSZakgnkMC2VNuQ3KXfUtUQeZ",e.PsParisCZ="PsParisCZo7KAh1Z1smVd9ZMZ1HHn5gkzbM94V3PLCpknFWhUAi",e.PsQuebecn="PsQuebecnLByd3JwTiGadoG4nGWi3HYiLXUjkibeFV8dCFeVMUg",e.PsRiotuma="PsRiotumaAMotcRoDWW1bysEhQy2n1M5fy8JgRp8jjRfHGmfeA7",e.PtSeouLou="PtSeouLouXkxhg39oWzjxDWaCydNfR3RxCUrNe4Q9Ro8BTehcbh",e.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK"})(ot||(ot={}));const pm={"004":[ot.Pt24m4xi],"005":[ot.PsBABY5H,ot.PsBabyM1],"006":[ot.PsCARTHA],"007":[ot.PsDELPH1],"008":[ot.PtEdo2Zk],"009":[ot.PsFLorena],"010":[ot.PtGRANADs],"011":[ot.PtHangz2],"012":[ot.PsiThaCa,ot.Psithaca2],"013":[ot.PtJakart2],"014":[ot.PtKathman],"015":[ot.PtLimaPtL],"016":[ot.PtMumbai2],"017":[ot.PtNairobi],"019":[ot.ProxfordY],"020":[ot.PtParisBx,ot.PsParisCZ],"021":[ot.PsQuebecn],"022":[ot.PsRiotuma],"023":[ot.PtSeouLou],"024":[ot.ProtoALpha]};var as;(function(e){e.MAINNET="NetXdQprcVkpaWU",e.GHOSTNET="NetXnHfVqm9iesp",e.SHADOWNET="NetXsqzbfFenSTS",e.CARTHAGENET="NetXjD3HPJJjmcd",e.DELPHINET="NetXm8tYqnMWky1",e.EDONET="NetXSgo1ZT2DRUG",e.FLORENCENET="NetXxkAx4woPLyu",e.GRANADANET="NetXz969SFaFn8k",e.HANGZHOUNET="NetXZSsxBpMQeAT",e.ITHACANET="NetXbhmtAbMukLc",e.JAKARTANET2="NetXLH1uAxK7CCh",e.KATHMANDUNET="NetXazhm4yetmff",e.LIMANET="NetXizpkH94bocH",e.MUMBAINET="NetXQw6nWSnrJ5t",e.MUMBAINET2="NetXgbcrNtXD2yA",e.NAIROBINET="NetXyuzvDo2Ugzb",e.OXFORDNET2="NetXxWsskGahzQB",e.PARISBNET="NetXo8SqH1c38SS",e.PARISCNET="NetXXWAHLEvre9b",e.QUEBECNET="NetXuTeGinLEqxp",e.RIONET="NetXPdgaoabtBth",e.SEOULNET="NetXd56aBs1aeW3"})(as||(as={}));const Jn=e=>Math.round(fm(e)*37/10),fm=e=>{switch(e.substring(0,3)){case"tz1":return Tn.TZ1;case"tz2":return Tn.TZ2;case"tz3":return Tn.TZ3;case"tz4":return Tn.TZ4;default:throw new Error(`Cannot estimate reveal gas limit for ${e}`)}},cs=e=>Math.round(pu(e)*12/10),pu=e=>{switch(e.substring(0,3)){case"tz1":return In.TZ1;case"tz2":return In.TZ2;case"tz3":return In.TZ3;case"tz4":return In.TZ4*1.7;default:throw new Error(`Cannot estimate reveal fee for ${e}`)}};class uo extends q{constructor(t,r,n){super(),this.smartContractMethodName=t,this.sigs=r,this.invalidParams=n,this.name="InvalidParameterError",this.message=`${t} Received ${n.length} arguments while expecting one of the following signatures (${JSON.stringify(r)})`}}class fu extends q{constructor(t){super(),this.source=t,this.name="InvalidDelegationSource",this.message=`Since Babylon delegation source can no longer be a contract address ${t}. Please use the smart contract abstraction to set your delegate.`}}class pn extends q{constructor(t,r){super(),this.message=t,this.data=r,this.name="InvalidCodeParameter"}}class lo extends q{constructor(t,r){super(),this.message=t,this.data=r,this.name="InvalidInitParameter"}}class gu extends ti{constructor(t,r,n,i){super(),this.message=t,this.viewName=r,this.failWith=n,this.cause=i,this.name="ViewSimulationError"}}const mu=e=>{if(gm(e.body)){const t=JSON.parse(e.body);if(Array.isArray(t)&&"with"in t[t.length-1])return t[t.length-1].with}},gm=e=>{try{JSON.parse(e)}catch{return!1}return!0};class us extends q{constructor(t){super(),this.info=t,this.name="InvalidViewSimulationContext",this.message=`${t} Please configure the context of the view execution in the executeView method.`}}class yu extends ti{constructor(t){super(),this.message=t,this.name="RevealOperationError"}}class Eu extends q{constructor(t){super(),this.message=t,this.name}}class _u extends q{constructor(t){super(),this.message=t,this.name="InvalidBalanceError"}}const bu=e=>p(void 0,[e],void 0,function*({pkh:t,secret:r}){return{kind:_.ACTIVATION,pkh:t,secret:r}}),fi=e=>p(void 0,[e],void 0,function*({code:t,init:r,balance:n="0",delegate:i,storage:s,fee:o,gasLimit:a,storageLimit:c,mutez:u=!1}){if(s!==void 0&&r!==void 0)throw new Eu("Storage and Init cannot be set a the same time. Please either use storage or init but not both.");if(!Array.isArray(t))throw new pn("Wrong code parameter type, expected an array",t);let l;if(s!==void 0){const y=t.find(P=>"prim"in P&&P.prim==="storage");if(y?.args===void 0)throw new pn("The storage section is missing from the script",t);l=new Zt(y.args[0]).Encode(s)}else if(r!==void 0&&typeof r=="object")l=r;else throw new lo("Wrong init parameter type, expected JSON Michelson",r);const g={code:t,storage:l};if(isNaN(Number(n)))throw new _u(`Invalid Balance "${n}", cannot be converted to a number`);const E={kind:_.ORIGINATION,fee:o,gas_limit:a,storage_limit:c,balance:u?n.toString():Es("tz","mutez",n).toString(),script:g};return i&&(E.delegate=i),E}),br=e=>p(void 0,[e],void 0,function*({to:t,amount:r,parameter:n,fee:i,gasLimit:s,storageLimit:o,mutez:a=!1}){return{kind:_.TRANSACTION,fee:i,gas_limit:s,storage_limit:o,amount:a?r.toString():Es("tz","mutez",r).toString(),destination:t,parameters:n}}),gi=e=>p(void 0,[e],void 0,function*({delegate:t,source:r,fee:n,gasLimit:i,storageLimit:s}){return{kind:_.DELEGATION,source:r,fee:n,gas_limit:i,storage_limit:s,delegate:t}}),vu=(e,t)=>p(void 0,[e,t],void 0,function*({fee:r,gasLimit:n,storageLimit:i},s){return{kind:_.DELEGATION,fee:r,gas_limit:n,storage_limit:i,delegate:s}}),Dn=(e,t,r)=>p(void 0,[e,t,r],void 0,function*({fee:n,gasLimit:i,storageLimit:s,proof:o},a,c){return{kind:_.REVEAL,fee:n,public_key:c,source:a,gas_limit:i??Jn(a),storage_limit:s,proof:o}}),mi=e=>p(void 0,[e],void 0,function*({value:t,source:r,fee:n,gasLimit:i,storageLimit:s}){return{kind:_.REGISTER_GLOBAL_CONSTANT,value:t,fee:n,gas_limit:i,storage_limit:s,source:r}}),yi=e=>p(void 0,[e],void 0,function*({ticketContents:t,ticketTy:r,ticketTicketer:n,ticketAmount:i,destination:s,entrypoint:o,source:a,fee:c,gasLimit:u,storageLimit:l}){return{kind:_.TRANSFER_TICKET,fee:c,gas_limit:u,storage_limit:l,source:a,ticket_contents:t,ticket_ty:r,ticket_ticketer:n,ticket_amount:i,destination:s,entrypoint:o}}),Ei=e=>p(void 0,[e],void 0,function*({source:t,fee:r,gasLimit:n,storageLimit:i,amount:s,destination:o}){return{kind:_.INCREASE_PAID_STORAGE,source:t,fee:r,gas_limit:n,storage_limit:i,amount:s,destination:o}}),Au=e=>p(void 0,[e],void 0,function*({consensus_key:t,delegate:r,destination:n}){return{kind:_.DRAIN_DELEGATE,consensus_key:t,delegate:r,destination:n}}),Su=e=>p(void 0,[e],void 0,function*({source:t,proposal:r,ballot:n}){return{kind:_.BALLOT,source:t,proposal:r,ballot:n}}),Pu=e=>p(void 0,[e],void 0,function*({source:t,proposals:r}){return{kind:_.PROPOSALS,source:t,proposals:r}}),_i=e=>p(void 0,[e],void 0,function*({source:t,fee:r,gasLimit:n,storageLimit:i,pk:s,proof:o}){return{kind:_.UPDATE_CONSENSUS_KEY,source:t,fee:r,gas_limit:n,storage_limit:i,pk:s,proof:o}}),bi=e=>p(void 0,[e],void 0,function*({source:t,fee:r,gasLimit:n,storageLimit:i,pk:s,proof:o}){return{kind:_.UPDATE_COMPANION_KEY,source:t,fee:r,gas_limit:n,storage_limit:i,pk:s,proof:o}}),vi=e=>p(void 0,[e],void 0,function*({source:t,fee:r,gasLimit:n,storageLimit:i,message:s}){return{kind:_.SMART_ROLLUP_ADD_MESSAGES,source:t,fee:r,gas_limit:n,storage_limit:i,message:s}}),Ai=e=>p(void 0,[e],void 0,function*({source:t,fee:r,gasLimit:n,storageLimit:i,pvmKind:s,kernel:o,parametersType:a}){return{kind:_.SMART_ROLLUP_ORIGINATE,source:t,fee:r,gas_limit:n,storage_limit:i,pvm_kind:s,kernel:o,parameters_ty:a}}),Si=e=>p(void 0,[e],void 0,function*({source:t,fee:r,gasLimit:n,storageLimit:i,rollup:s,cementedCommitment:o,outputProof:a}){return{kind:_.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE,source:t,fee:r,gas_limit:n,storage_limit:i,rollup:s,cemented_commitment:o,output_proof:a}}),Re=(e,t)=>Object.assign(Object.assign({},e),{kind:t}),ls=(e,t)=>{if(Array.isArray(e)){const r=e.find(n=>n.kind===t);if(r&&Ru(r,t))return r}},Ru=(e,t)=>e.kind===t,Ou=e=>{var t;return e.kind===_.TRANSACTION&&(!((t=e.destination)===null||t===void 0)&&t.startsWith("KT1"))?!0:["origination","register_global_constant","transfer_ticket","update_consensus_key","update_companion_key","smart_rollup_add_messages","smart_rollup_originate"].indexOf(e.kind)!==-1},qn=e=>["transaction","delegation","origination","reveal","register_global_constant","increase_paid_storage","transfer_ticket","update_consensus_key","update_companion_key","smart_rollup_add_messages","smart_rollup_originate","smart_rollup_execute_outbox_message"].indexOf(e.kind)!==-1,ho=e=>["transaction","delegation","origination","register_global_constant","increase_paid_storage","transfer_ticket","update_consensus_key","update_companion_key","smart_rollup_add_messages","smart_rollup_originate","smart_rollup_execute_outbox_message"].indexOf(e.kind)!==-1,mm=e=>["transaction","delegation","origination","reveal","ballot"].indexOf(e.kind)!==-1,Pi=e=>"metadata"in e,Lr=e=>Pi(e)&&"operation_result"in e.metadata,wu=e=>Pi(e)&&"internal_operation_results"in e.metadata,ym=e=>"with"in e;class po extends ti{constructor(t,r,n){super(),this.errors=t,this.errorDetails=r,this.operationsWithResults=n,this.name="TezosOperationError",this.lastError=t[t.length-1],this.message=`(${this.kind}) ${this.id}`,ym(this.lastError)&&(this.lastError.with.string?this.message=this.lastError.with.string:this.lastError.with.int?this.message=this.lastError.with.int:this.message=JSON.stringify(this.lastError.with))}get id(){return this.lastError.id}get kind(){return this.lastError.kind}}class Tu extends Error{constructor(t){super(),this.result=t,this.name="TezosPreapplyFailureError",this.message="Preapply returned an unexpected result"}}const ve=e=>{const t=Array.isArray(e)?e:[e],r=[];for(let n=0;n<t.length;n++)for(let i=0;i<t[n].contents.length;i++){const s=t[n].contents[i];Lr(s)&&"fee"in s&&(r.push(Object.assign({fee:s.fee},s.metadata.operation_result)),Array.isArray(s.metadata.internal_operation_results)&&s.metadata.internal_operation_results.forEach(o=>r.push(o.result)))}return r},Zr=(e,t="failed")=>{const r=Array.isArray(e)?e:[e];let n=[];for(let i=0;i<r.length;i++)for(let s=0;s<r[i].contents.length;s++){const o=r[i].contents[s];if(Pi(o)&&(Lr(o)&&o.metadata.operation_result.status===t&&(n=n.concat(o.metadata.operation_result.errors||[])),wu(o)&&Array.isArray(o.metadata.internal_operation_results)))for(const a of o.metadata.internal_operation_results)"result"in a&&a.result.status===t&&(n=n.concat(a.result.errors||[]))}return n};class Em extends at{constructor(t){super(),this.message=t,this.name="OriginationOperationError"}}class Cn extends q{constructor(t){super(),this.message=t,this.name="InvalidEstimateValueError"}}class Iu extends q{constructor(t){super(),this.invalidConfirmations=t,this.name="InvalidConfirmationCountError",this.message=`Invalid confirmation count ${t} expecting at least 1`}}class Lu extends gn{constructor(t){super(),this.message=t,this.name="ConfirmationTimeoutError"}}class Ln extends ti{constructor(t,r){super(),this.message=t,this.cause=r,this.name="RPCResponseError"}}class Lt{get includedInBlock(){return this._foundAt}constructor(t,r,n,i){if(this.hash=t,this.raw=r,this.results=n,this.context=i,this._pollingConfig$=new Er(1),this.currentHead$=this._pollingConfig$.pipe($e(s=>new ni(s).pipe(Xa({each:s.timeout*1e3,with:()=>Ja(()=>new Lu("Confirmation polling timed out"))}))),$e(()=>Qa(()=>hu(this.context.stream.subscribeBlock("head"))).pipe($e(s=>{var o,a;const c=(a=(o=this.lastHead)===null||o===void 0?void 0:o.header.level)!==null&&a!==void 0?a:s.header.level-1;return Ss(c+1,s.header.level-c-1).pipe(En(u=>this.context.readProvider.getBlock(u)),ec(s))}),Kn(s=>this.lastHead=s))),Fo({refCount:!0})),this.confirmed$=this.currentHead$.pipe(nr(s=>{for(let o=3;o>=0;o--)s.operations[o].forEach(a=>{a.hash===this.hash&&(this._foundAt=s.header.level)});if(s.header.level-this._foundAt>=0)return this._foundAt}),Wi(s=>s!==void 0),Me(),Fo()),this._foundAt=Number.POSITIVE_INFINITY,Aa(this.hash)!==T.VALID)throw new Sa(this.hash);this.confirmed$.pipe(Me(),oi(()=>si(As))).subscribe()}get revealOperation(){return Array.isArray(this.results)&&this.results.find(t=>t.kind==="reveal")}get revealStatus(){return this.revealOperation?this.revealOperation.metadata.operation_result.status:"unknown"}get status(){return this.results.map(t=>Lr(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}confirmation(t,r){return p(this,void 0,void 0,function*(){if(typeof t<"u"&&t<1)throw new Iu(t);const{defaultConfirmationCount:n,confirmationPollingTimeoutSecond:i}=this.context.config;this._pollingConfig$.next({timeout:r||i});const s=t!==void 0?t:n;return new Promise((o,a)=>{this.confirmed$.pipe($e(()=>this.currentHead$),Wi(c=>c.header.level-this._foundAt>=s-1),Me()).subscribe({error:c=>a(c),complete:()=>o(this._foundAt+(s-1))})})})}}class Nu extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}sumProp(t,r){return t.reduce((n,i)=>r in i?Number(i[r])+n:n,0)}getOriginatedContractAddresses(){const t=this.results.filter(n=>n.kind==="origination");let r=[];for(const n of t)n.metadata.operation_result.originated_contracts&&(r=[...r,...n.metadata.operation_result.originated_contracts]);return r}get status(){return this.results.filter(t=>Ku.indexOf(t.kind)!==-1).map(t=>Lr(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}get fee(){return this.sumProp(this.params,"fee")}get gasLimit(){return this.sumProp(this.params,"gas_limit")}get storageLimit(){return this.sumProp(this.params,"storage_limit")}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),new I(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(ve({contents:this.results}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(ve({contents:this.results}),"paid_storage_size_diff"))}get errors(){return Zr({contents:this.results})}}class _n{get rpc(){return this.context.rpc}get signer(){return this.context.signer}constructor(t){this.context=t}forge(t){return p(this,arguments,void 0,function*({opOb:{branch:r,contents:n,protocol:i},counter:s}){return{opbytes:yield this.context.forger.forge({branch:r,contents:n}),opOb:{branch:r,contents:n,protocol:i},counter:s}})}estimate(t,r){return p(this,void 0,void 0,function*(){var{fee:n,gasLimit:i,storageLimit:s}=t,o=ut(t,["fee","gasLimit","storageLimit"]);let a=n,c=i,u=s;if(a&&a%1!==0)throw new Cn(`Fee value must not be a decimal: ${a}`);if(c&&c%1!==0)throw new Cn(`Gas Limit value must not be a decimal: ${c}`);if(u&&u%1!==0)throw new Cn(`Storage Limit value must not be a decimal: ${u}`);if(n===void 0||i===void 0||s===void 0){const l=yield r(Object.assign({fee:n,gasLimit:i,storageLimit:s},o));a??(a=l.suggestedFeeMutez),c??(c=l.gasLimit),u??(u=l.storageLimit)}return{fee:a,gasLimit:c,storageLimit:u}})}getRPCOp(t){return p(this,void 0,void 0,function*(){switch(t.kind){case _.TRANSACTION:return br(Object.assign({},t));case _.ORIGINATION:return fi(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case _.DELEGATION:return gi(Object.assign({},t));case _.REGISTER_GLOBAL_CONSTANT:return mi(Object.assign({},t));case _.INCREASE_PAID_STORAGE:return Ei(Object.assign({},t));case _.UPDATE_CONSENSUS_KEY:return _i(Object.assign({},t));case _.UPDATE_COMPANION_KEY:return bi(Object.assign({},t));case _.TRANSFER_TICKET:return yi(Object.assign({},t));case _.SMART_ROLLUP_ADD_MESSAGES:return vi(Object.assign({},t));case _.SMART_ROLLUP_ORIGINATE:return Ai(Object.assign({},t));case _.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE:return Si(Object.assign({},t));default:throw new je(t.kind)}})}runOperation(t){return p(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.runOperation(t),op:t,context:this.context.clone()}})}simulate(t){return p(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.simulateOperation(t),op:t,context:this.context.clone()}})}isRevealOpNeeded(t,r){return p(this,void 0,void 0,function*(){return!(!(yield this.isAccountRevealRequired(r))||!this.isRevealRequiredForOpType(t))})}isAccountRevealRequired(t){return p(this,void 0,void 0,function*(){return!(yield this.context.readProvider.isAccountRevealed(t,"head"))})}isRevealRequiredForOpType(t){let r=!1;for(const n of t)ho(n)&&(r=!0);return r}signAndInject(t){return p(this,void 0,void 0,function*(){const r=yield this.signer.sign(t.opbytes,new Uint8Array([3]));t.opbytes=r.sbytes,t.opOb.signature=r.prefixSig;const n=[],i=yield this.rpc.preapplyOperations([t.opOb]);if(!Array.isArray(i))throw new Tu(i);for(let o=0;o<i.length;o++)for(let a=0;a<i[o].contents.length;a++)n.push(i[o].contents[a]);const s=Zr(i);if(s.length)throw new po(s,"Error occurred during validation simulation of operation",n);return{hash:yield this.context.injector.inject(t.opbytes),forgedBytes:t,opResponse:n,context:this.context.clone()}})}}class xu{constructor(t,r){this.walletProvider=t,this.context=r,this.operations=[]}withTransfer(t){const r=K(t.to);if(r!==T.VALID)throw new F(t.to,r);return this.operations.push(Object.assign({kind:_.TRANSACTION},t)),this}withContractCall(t,r={}){return this.withTransfer(t.toTransferParams(r))}withDelegation(t){var r;const n=K((r=t.delegate)!==null&&r!==void 0?r:"");if(t.delegate&&n!==T.VALID)throw new F(t.delegate,n);return this.operations.push(Object.assign({kind:_.DELEGATION},t)),this}withOrigination(t){return this.operations.push(Object.assign({kind:_.ORIGINATION},t)),this}withIncreasePaidStorage(t){const r=K(t.destination);if(r!==T.VALID)throw new F(t.destination,r);return this.operations.push(Object.assign({kind:_.INCREASE_PAID_STORAGE},t)),this}withTransferTicket(t){const r=K(t.destination);if(r!==T.VALID)throw new F(t.destination,r);return this.operations.push(Object.assign({kind:_.TRANSFER_TICKET},t)),this}mapOperation(t){return p(this,void 0,void 0,function*(){switch(t.kind){case _.TRANSACTION:return this.walletProvider.mapTransferParamsToWalletParams(()=>p(this,void 0,void 0,function*(){return t}));case _.ORIGINATION:return this.walletProvider.mapOriginateParamsToWalletParams(()=>p(this,void 0,void 0,function*(){return this.context.parser.prepareCodeOrigination(Object.assign({},t))}));case _.DELEGATION:return this.walletProvider.mapDelegateParamsToWalletParams(()=>p(this,void 0,void 0,function*(){return t}));case _.INCREASE_PAID_STORAGE:return this.walletProvider.mapIncreasePaidStorageWalletParams(()=>p(this,void 0,void 0,function*(){return t}));default:throw new je(JSON.stringify(t.kind))}})}with(t){for(const r of t)switch(r.kind){case _.TRANSACTION:this.withTransfer(r);break;case _.ORIGINATION:this.withOrigination(r);break;case _.DELEGATION:this.withDelegation(r);break;case _.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(r);break;default:throw new je(JSON.stringify(r.kind))}return this}send(){return p(this,void 0,void 0,function*(){const t=[];for(const n of this.operations)t.push(yield this.mapOperation(n));const r=yield this.walletProvider.sendOperations(t);return this.context.operationFactory.createBatchOperation(r)})}}class bn{constructor(t){this.context=t,this.walletCommand=r=>({send:r})}get walletProvider(){return this.context.walletProvider}pkh(){return p(this,arguments,void 0,function*({forceRefetch:t}={}){return(!this._pkh||t)&&(this._pkh=yield this.walletProvider.getPKH()),this._pkh})}pk(){return p(this,arguments,void 0,function*({forceRefetch:t}={}){return(!this._pk||t)&&(this._pk=yield this.walletProvider.getPK()),this._pk})}originate(t){return this.walletCommand(()=>p(this,void 0,void 0,function*(){const r=yield this.walletProvider.mapOriginateParamsToWalletParams(()=>this.context.parser.prepareCodeOrigination(Object.assign({},t))),n=yield this.walletProvider.sendOperations([r]);return this.context.operationFactory.createOriginationOperation(n)}))}setDelegate(t){var r;const n=K((r=t.delegate)!==null&&r!==void 0?r:"");if(t.delegate&&n!==T.VALID)throw new F(t.delegate,n);return this.walletCommand(()=>p(this,void 0,void 0,function*(){const i=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>p(this,void 0,void 0,function*(){return t})),s=yield this.walletProvider.sendOperations([i]);return this.context.operationFactory.createDelegationOperation(s)}))}signFailingNoop(t){return p(this,void 0,void 0,function*(){const r={kind:_.FAILING_NOOP,arbitrary:t.arbitrary},n=yield this.context.readProvider.getBlockHash(t.basedOnBlock),i=yield this.context.forger.forge({branch:n,contents:[r]});return{signature:yield this.walletProvider.sign(i,Uint8Array.from([3])),bytes:i,signedContent:{branch:n,contents:[{kind:_.FAILING_NOOP,arbitrary:t.arbitrary}]}}})}registerDelegate(){return this.walletCommand(()=>p(this,void 0,void 0,function*(){const t=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>p(this,void 0,void 0,function*(){return{delegate:yield this.pkh()}})),r=yield this.walletProvider.sendOperations([t]);return this.context.operationFactory.createDelegationOperation(r)}))}transfer(t){const r=K(t.to);if(r!==T.VALID)throw new F(t.to,r);return this.walletCommand(()=>p(this,void 0,void 0,function*(){const n=yield this.walletProvider.mapTransferParamsToWalletParams(()=>p(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([n]);return this.context.operationFactory.createTransactionOperation(i)}))}transferTicket(t){const r=K(t.destination);if(r!==T.VALID)throw new F(t.destination,r);return this.walletCommand(()=>p(this,void 0,void 0,function*(){const n=yield this.walletProvider.mapTransferTicketParamsToWalletParams(()=>p(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([n]);return this.context.operationFactory.createTransferTicketOperation(i)}))}stake(t){return this.walletCommand(()=>p(this,void 0,void 0,function*(){const r=yield this.walletProvider.mapStakeParamsToWalletParams(()=>p(this,void 0,void 0,function*(){const i=yield this.pkh();if(t.to||(t.to=i),t.to!==i)throw new Br(t.to);return t.parameter={entrypoint:"stake",value:{prim:"Unit"}},t})),n=yield this.walletProvider.sendOperations([r]);return this.context.operationFactory.createTransactionOperation(n)}))}unstake(t){return this.walletCommand(()=>p(this,void 0,void 0,function*(){const r=yield this.walletProvider.mapUnstakeParamsToWalletParams(()=>p(this,void 0,void 0,function*(){const i=yield this.pkh();if(t.to||(t.to=i),t.to!==i)throw new Br(t.to);return t.parameter={entrypoint:"unstake",value:{prim:"Unit"}},t})),n=yield this.walletProvider.sendOperations([r]);return yield this.context.operationFactory.createTransactionOperation(n)}))}finalizeUnstake(t){return this.walletCommand(()=>p(this,void 0,void 0,function*(){const r=yield this.walletProvider.mapFinalizeUnstakeParamsToWalletParams(()=>p(this,void 0,void 0,function*(){const i=yield this.pkh();if(t.to||(t.to=i),t.amount||(t.amount=0),t.amount!==0)throw new Ra("Amount must be 0 to finalize unstake.");return t.parameter={entrypoint:"finalize_unstake",value:{prim:"Unit"}},t})),n=yield this.walletProvider.sendOperations([r]);return yield this.context.operationFactory.createTransactionOperation(n)}))}increasePaidStorage(t){const r=K(t.destination);if(r!==T.VALID)throw new F(t.destination,r);return this.walletCommand(()=>p(this,void 0,void 0,function*(){const n=yield this.walletProvider.mapIncreasePaidStorageWalletParams(()=>p(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([n]);return this.context.operationFactory.createIncreasePaidStorageOperation(i)}))}batch(t){const r=new xu(this.walletProvider,this.context);return Array.isArray(t)&&r.with(t),r}at(t){return p(this,arguments,void 0,function*(r,n=i=>i){const i=Mr(r);if(i!==T.VALID)throw new rr(r,i);const s=this.context.withExtensions().rpc,o=this.context.withExtensions().readProvider,a=yield o.getScript(r,"head"),c=yield o.getEntrypoints(r),u=new go(r,a,this,this.context.contract,c,s,o);return n(u,this.context)})}getPK(){return p(this,void 0,void 0,function*(){return yield this.pk()})}}const _m=(e,{ALLOCATION_BURN:t,ORIGINATION_BURN:r}={ALLOCATION_BURN:257,ORIGINATION_BURN:257})=>{I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP});const n=ve({contents:e});let i=new I(0),s=new I(0),o=new I(0),a=new I(0),c=new I(0),u=new I(0);return n.forEach(l=>{o=o.plus(l.fee||0),a=a.plus(Array.isArray(l.originated_contracts)?l.originated_contracts.length*r:0),c=c.plus("allocated_destination_contract"in l?t:0),i=i.plus(l.consumed_milligas||0),u=u.plus("paid_storage_size_diff"in l&&Number(l.paid_storage_size_diff)||0)}),s=s.plus(c).plus(a).plus(u),{totalFee:o,totalMilliGas:i,totalGas:i.dividedBy(1e3),totalStorage:s,totalAllocationBurn:c,totalOriginationBurn:a,totalPaidStorageDiff:u,totalStorageBurn:new I(s.multipliedBy(du))}};class bm extends ei{constructor(){super(),this.name="ConfirmationUndefinedError",this.message="Default confirmation count can not be undefined"}}class $t extends gn{constructor(t){super(),this.message=t,this.name="ObservableError"}}const vm=60;class fr{operationResults(){return p(this,void 0,void 0,function*(){return this._operationResult.pipe(Me()).toPromise()})}receipt(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(!t)throw new $t("Unable to get operation results");return _m(t)})}constructor(t,r,n){if(this.opHash=t,this.context=r,this._newHead$=n,this._operationResult=new Er(1),this._includedInBlock=new Er(1),this._included=!1,this.newHead$=this._newHead$.pipe($e(i=>{var s,o;const a=(o=(s=this.lastHead)===null||s===void 0?void 0:s.header.level)!==null&&o!==void 0?o:i.header.level-1;return Ss(a+1,i.header.level-a-1).pipe(En(c=>this.context.readProvider.getBlock(c)),ec(i))}),Kn(i=>this.lastHead=i),ln({connector:()=>new Er(1),resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0})),this.confirmed$=this.newHead$.pipe(nr(i=>{for(const s of i.operations)for(const o of s)if(o.hash===this.opHash)return this._included=!0,this._includedInBlock.next(i),this._operationResult.next(o.contents),i}),Wi(i=>typeof i<"u"),Me(),ln({connector:()=>new Er(1),resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0})),Aa(this.opHash)!==T.VALID)throw new Sa(this.opHash);this.confirmed$.pipe(Me(),oi(()=>si(void 0))).subscribe()}getCurrentConfirmation(){return p(this,void 0,void 0,function*(){return this._included?Ko([this._includedInBlock,pr(this.context.readProvider.getBlock("head"))]).pipe(nr(([t,r])=>r.header.level-t.header.level+1),Me()).toPromise():0})}isInCurrentBranch(){return p(this,arguments,void 0,function*(t="head"){if(!this._included)return!0;const r=yield this.context.readProvider.getBlockLevel(t),n=yield this._includedInBlock.pipe(Me()).toPromise();if(!n)throw new $t("Inclusion block is undefined");const i=r-n.header.level;if(i<=0)return!0;const s=Math.min(n.header.level+i,n.header.level+vm);return new Set(yield this.context.readProvider.getLiveBlocks(s)).has(n.hash)})}confirmationObservable(t){if(typeof t<"u"&&t<1)throw new Iu(t);const{defaultConfirmationCount:r}=this.context.config,n=t!==void 0?t:r;if(n===void 0)throw new bm;return Ko([this._includedInBlock,this.newHead$]).pipe(tc(([,i],[,s])=>i.hash===s.hash),nr(([i,s])=>({block:s,expectedConfirmation:n,currentConfirmation:s.header.level-i.header.level+1,completed:s.header.level-i.header.level>=n-1,isInCurrentBranch:()=>this.isInCurrentBranch(s.hash)})),kh(({completed:i})=>!i,!0))}confirmation(t){return this.confirmationObservable(t).toPromise()}}class ku extends fr{constructor(t,r,n){super(t,r,n),this.opHash=t,this.context=r}revealOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(!t)throw new $t("operationResult returned undefined");return t.find(r=>r.kind===_.REVEAL)})}transactionOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(!t)throw new $t("operationResult returned undefined");return t.find(r=>r.kind===_.TRANSACTION)})}status(){return p(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.transactionOperation();return t?t.metadata.operation_result.status:"unknown"})}}class Mu extends fr{constructor(t,r,n){super(t,r,n),this.opHash=t,this.context=r}originationOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return ls(t,_.ORIGINATION);throw new $t("Unable to fetch operation result")})}revealOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return ls(t,_.REVEAL);throw new $t("Unable to fetch operation result")})}status(){return p(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.originationOperation();return t?t.metadata.operation_result.status:"unknown"})}contract(){return p(this,void 0,void 0,function*(){const t=yield this.originationOperation(),r=(t?.metadata.operation_result.originated_contracts||[])[0];return this.context.wallet.at(r)})}}class Hu extends fr{constructor(t,r,n){super(t,r,n),this.opHash=t,this.context=r}revealOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return t.find(r=>r.kind===_.REVEAL);throw new $t("Unable to fetch operation result")})}delegationOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return t.find(r=>r.kind===_.DELEGATION);throw new $t("Unable to fetch operation result")})}status(){return p(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.delegationOperation();return t?t.metadata.operation_result.status:"unknown"})}}class Du extends fr{constructor(t,r,n){super(t,r,n),this.opHash=t,this.context=r}revealOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(!t)throw new $t("operationResult returned undefined");return t.find(r=>r.kind===_.REVEAL)})}transferTicketOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(!t)throw new $t("operationResult returned undefined");return t.find(r=>r.kind===_.TRANSFER_TICKET)})}status(){return p(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.transferTicketOperation();return t?t.metadata.operation_result.status:"unknown"})}}class fo{constructor(t){this.context=t}getPKH(){return p(this,void 0,void 0,function*(){return this.context.signer.publicKeyHash()})}getPK(){return p(this,void 0,void 0,function*(){return this.context.signer.publicKey()})}mapTransferParamsToWalletParams(t){return p(this,void 0,void 0,function*(){return Re(yield t(),_.TRANSACTION)})}mapStakeParamsToWalletParams(t){return p(this,void 0,void 0,function*(){return Re(yield t(),_.TRANSACTION)})}mapUnstakeParamsToWalletParams(t){return p(this,void 0,void 0,function*(){return Re(yield t(),_.TRANSACTION)})}mapFinalizeUnstakeParamsToWalletParams(t){return p(this,void 0,void 0,function*(){return Re(yield t(),_.TRANSACTION)})}mapOriginateParamsToWalletParams(t){return p(this,void 0,void 0,function*(){return Re(yield t(),_.ORIGINATION)})}mapDelegateParamsToWalletParams(t){return p(this,void 0,void 0,function*(){return Re(yield t(),_.DELEGATION)})}mapIncreasePaidStorageWalletParams(t){return p(this,void 0,void 0,function*(){return Re(yield t(),_.INCREASE_PAID_STORAGE)})}mapTransferTicketParamsToWalletParams(t){return p(this,void 0,void 0,function*(){return Re(yield t(),_.TRANSFER_TICKET)})}sendOperations(t){return p(this,void 0,void 0,function*(){return(yield this.context.batch.batch(t).send()).hash})}sign(t,r){return p(this,void 0,void 0,function*(){const{prefixSig:n}=yield this.context.signer.sign(t,r);return n})}}class Cu{constructor(t,r,n,i,s="unit",o=!0,a=!1){this.provider=t,this.address=r,this.parameterSchema=n,this.name=i,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}getSignature(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}send(t={}){return this.provider instanceof bn?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:r,storageLimit:n,source:i,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:i,gasLimit:r,storageLimit:n,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:vr,value:this.isAnonymous?this.parameterSchema.EncodeObject({[this.name]:this.args}):this.parameterSchema.EncodeObject(this.args)}}}}class Bu{constructor(t,r,n,i,s,o=!0,a=!1){this.provider=t,this.address=r,this.parameterSchema=n,this.name=i,this.args=s,this.isMultipleEntrypoint=o,this.isAnonymous=a}validateArgs(t,r,n){const i=r.ExtractSignatures();if(!i.find(s=>s.length===t.length))throw new uo(n,i,t)}get schema(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}getSignature(){if(this.isAnonymous){const t=this.parameterSchema.ExtractSignatures().find(r=>r[0]===this.name);if(t)return t.shift(),t}else{const t=this.parameterSchema.ExtractSignatures();return t.length==1?t[0]:t}}send(t={}){return this.provider instanceof bn?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams({fee:t,gasLimit:r,storageLimit:n,source:i,amount:s=0,mutez:o=!1}={}){return{to:this.address,amount:s,fee:t,mutez:o,source:i,gasLimit:r,storageLimit:n,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:vr,value:this.isAnonymous?this.parameterSchema.Encode(this.name,...this.args):this.parameterSchema.Encode(...this.args)}}}}class Am{constructor(t,r,n,i,s,o="Unit"){this._rpc=t,this._readProvider=r,this._contractAddress=n,this._smartContractViewSchema=i,this._contractStorageType=s,this._args=o}getSignature(){return{parameter:this._smartContractViewSchema.extractArgsSchema(),result:this._smartContractViewSchema.extractResultSchema()}}executeView(t){return p(this,void 0,void 0,function*(){this.verifyContextExecution(t);const r=yield this._readProvider.getChainId(),n=this.transformArgsToMichelson(),i={contract:this._contractAddress,view:this._smartContractViewSchema.viewName,input:n,chain_id:r,source:t.viewCaller};return t.source&&(i.payer=t.source),this.executeViewAndDecodeResult(i)})}verifyContextExecution(t){if(t.source&&K(t.source)!==T.VALID)throw new us(`The source account who initialized the view execution is invalid: ${t.source}.`);if(!t.viewCaller||K(t.viewCaller)!==T.VALID)throw new us(`The contract which is the caller of view is invalid: ${t.viewCaller}.`)}transformArgsToMichelson(){try{return this._smartContractViewSchema.encodeViewArgs(this._args)}catch(t){throw new Ea(this._smartContractViewSchema.viewName,this.getSignature(),this._args,t)}}adaptViewCodeToContext(t,r,n){const i={BALANCE:[{prim:"PUSH",args:[{prim:"mutez"},{int:n}]}],SENDER:[{prim:"PUSH",args:[{prim:"address"},{string:r}]}],SELF_ADDRESS:[{prim:"PUSH",args:[{prim:"address"},{string:this._contractAddress}]}],AMOUNT:[{prim:"PUSH",args:[{prim:"mutez"},{int:"0"}]}]};return t.forEach((s,o)=>{s.prim in i&&(t[o]=Object(i)[s.prim]),s.args&&s.args.length!==0?this.adaptViewCodeToContext(s.args,r,n):Array.isArray(s)&&this.adaptViewCodeToContext(s,r,n)}),t}executeViewAndDecodeResult(t){return p(this,void 0,void 0,function*(){let r;try{r=(yield this._rpc.runScriptView(t)).data}catch(n){const i=mu(n);throw i?new gu(`The simulation of the on-chain view named ${this._smartContractViewSchema.viewName} failed with: ${JSON.stringify(i)}`,this._smartContractViewSchema.viewName,i,n):n}return this._smartContractViewSchema.decodeViewResult(r)})}}class Sm{constructor(t,r){this.provider=t,this.contractAddress=r}createContractMethodFlatParams(t,r,n,i=!0,s=!1){return new Bu(this.provider,this.contractAddress,t,r,n,i,s)}createContractMethodObjectParam(t,r,n,i=!0,s=!1){return new Cu(this.provider,this.contractAddress,t,r,n,i,s)}createContractViewObjectParam(t,r,n,i,s){return new Am(t,r,this.contractAddress,n,i,s)}}const vr="default";class $u{constructor(t,r,n,i,s,o,a){this.currentContract=t,this.name=r,this.callbackParametersSchema=n,this.parameterSchema=i,this.args=s,this.rpc=o,this.readProvider=a}read(t){return p(this,void 0,void 0,function*(){const r=_a(t??"");if(Mr(t??"")==T.VALID)throw new Pa("Since version 12, the lambda view no longer depends on a lambda contract. The read method no longer accepts a contract address as a parameter.");if(t&&r!==T.VALID)throw new Pl(t,r);const n=this.parameterSchema.Encode(...this.args),i=yield this.rpc.runView({contract:this.currentContract.address,entrypoint:this.name,input:n,chain_id:t||(yield this.readProvider.getChainId())});return this.callbackParametersSchema.Execute(i.data)})}}const Pm=(e,t,r)=>{const n=t.ExtractSignatures();if(!n.find(i=>i.length===e.length))throw new uo(r,n,e)},Rm=e=>{let t=!1;if("prim"in e&&e.prim==="pair"&&e.args){const r=e.args[e.args.length-1];"prim"in r&&r.prim==="contract"&&(t=!0)}return t};class go{constructor(t,r,n,i,s,o,a){this.address=t,this.script=r,this.storageProvider=i,this.entrypoints=s,this.rpc=o,this.readProvider=a,this.methods={},this.methodsObject={},this.views={},this.contractViews={},this.contractMethodFactory=new Sm(n,t),this.schema=Zt.fromRPCResponse({script:this.script}),this.parameterSchema=xr.fromRPCResponse({script:this.script}),this.viewSchema=Rs.fromRPCResponse({script:this.script}),this.viewSchema.length!==0&&this._initializeOnChainViews(this,o,this.readProvider,this.viewSchema),this.eventSchema=Ze.fromRPCResponse({script:this.script}),this._initializeMethods(this,this.entrypoints.entrypoints,this.rpc,this.readProvider)}_initializeMethods(t,r,n,i){const s=this.parameterSchema,o=Object.keys(r);if(s.isMultipleEntryPoint)o.forEach(c=>{const u=new xr(r[c]);if(this.methods[c]=function(...l){return t.contractMethodFactory.createContractMethodFlatParams(u,c,l)},this.methodsObject[c]=function(l){return t.contractMethodFactory.createContractMethodObjectParam(u,c,l)},Rm(r[c])){const l=function(...g){const E=r[c].args[0],y=new xr(E),v=r[c].args[1].args[0],P=new xr(v);return Pm(g,y,c),new $u(t,c,P,y,g,n,i)};this.views[c]=l}}),Object.keys(s.ExtractSchema()).filter(c=>Object.keys(r).indexOf(c)===-1).forEach(c=>{this.methods[c]=function(...u){return t.contractMethodFactory.createContractMethodFlatParams(s,c,u,!1,!0)},this.methodsObject[c]=function(u){return t.contractMethodFactory.createContractMethodObjectParam(s,c,u,!1,!0)}});else{const a=this.parameterSchema;this.methods[vr]=function(...c){return t.contractMethodFactory.createContractMethodFlatParams(a,vr,c,!1)},this.methodsObject[vr]=function(c){return t.contractMethodFactory.createContractMethodObjectParam(a,vr,c,!1)}}}_initializeOnChainViews(t,r,n,i){const s=this.schema.val;i.forEach(o=>{this.contractViews[o.viewName]=function(a){return t.contractMethodFactory.createContractViewObjectParam(r,n,o,s,a)}})}storage(){return this.storageProvider.getStorage(this.address,this.schema)}bigMap(t){return this.storageProvider.getBigMapKey(this.address,t,this.schema)}}const Om=e=>[{prim:"DROP"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PUSH",args:[{prim:"key_hash"},{string:e}]},{prim:"SOME"},{prim:"SET_DELEGATE"},{prim:"CONS"}],wm=(e,t)=>[{prim:"DROP"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PUSH",args:[{prim:"key_hash"},{string:e}]},{prim:"IMPLICIT_ACCOUNT"},{prim:"PUSH",args:[{prim:"mutez"},{int:`${t}`}]},{prim:"UNIT"},{prim:"TRANSFER_TOKENS"},{prim:"CONS"}],Tm=()=>[{prim:"DROP"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"NONE",args:[{prim:"key_hash"}]},{prim:"SET_DELEGATE"},{prim:"CONS"}],Im=(e,t)=>[{prim:"DROP"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PUSH",args:[{prim:"address"},{string:e}]},{prim:"CONTRACT",args:[{prim:"unit"}]},{prim:"IF_NONE",args:[[{prim:"UNIT"},{prim:"FAILWITH"}],[]]},{prim:"PUSH",args:[{prim:"mutez"},{int:`${t}`}]},{prim:"UNIT"},{prim:"TRANSFER_TOKENS"},{prim:"CONS"}],Lm={setDelegate:Om,removeDelegate:Tm,transferImplicit:wm,transferToContract:Im},Nm=[{prim:"parameter",args:[{prim:"lambda",args:[{prim:"unit"},{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},{prim:"unit"}]}]}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"UNIT"},{prim:"EXEC"}]]}],xm="Unit",km={code:Nm,storage:xm};function Mm(e,t){return(r,n)=>t(e(r,n),n)}class Uu{constructor(t,r){this.id=t,this.provider=r}getSaplingDiff(t){return p(this,void 0,void 0,function*(){return this.provider.getSaplingDiffByID(this.id.toString(),t)})}getId(){return this.id.toString()}}class Gu{constructor(t,r,n){this.id=t,this.schema=r,this.provider=n}get(t,r){return p(this,void 0,void 0,function*(){try{return yield this.provider.getBigMapKeyByID(this.id.toString(),t,this.schema,r)}catch(n){if(n instanceof Pr&&n.status===an.NOT_FOUND)return;throw n}})}getMultipleValues(t,r){return p(this,arguments,void 0,function*(n,i,s=5){return this.provider.getBigMapKeysByID(this.id.toString(),n,this.schema,i,s)})}toJSON(){return this.id.toString()}toString(){return this.id.toString()}}const hs=e=>({big_map:(t,r)=>{if(!t||!("int"in t)||t.int===void 0)return{};{const n=new Zt(r);return new Gu(new I(t.int),n,e)}},sapling_state:t=>!t||!("int"in t)||t.int===void 0?{}:new Uu(new I(t.int),e)});var Q;const At=(e,t)=>{var r,n,i;return{fee:(r=e.fee)!==null&&r!==void 0?r:t.fee,gasLimit:(n=e.gasLimit)!==null&&n!==void 0?n:t.gasLimit,storageLimit:(i=e.storageLimit)!==null&&i!==void 0?i:t.storageLimit}};class Wr extends _n{constructor(t){super(t),this.context=t,Q.set(this,void 0),lt(this,Q,{})}getBlockHash(t){return p(this,void 0,void 0,function*(){return this.context.readProvider.getBlockHash(t??"head~2")})}getProtocolHash(){return p(this,void 0,void 0,function*(){return this.context.readProvider.getNextProtocol("head")})}getHeadCounter(t){return p(this,void 0,void 0,function*(){var r;return(r=this.context.readProvider.getCounter(t,"head"))!==null&&r!==void 0?r:"0"})}adjustGasForBatchOperation(t,r,n){return I.min(r,t.div(n+1))}getOperationLimits(t,r){return p(this,void 0,void 0,function*(){const{hard_gas_limit_per_operation:n,hard_gas_limit_per_block:i,hard_storage_limit_per_operation:s}=t;return{fee:0,gasLimit:r?Math.floor(this.adjustGasForBatchOperation(i,n,r).toNumber()):n.toNumber(),storageLimit:s.toNumber()}})}getFee(t,r,n){return(!On(this,Q,"f")[r]||On(this,Q,"f")[r]<n)&&(On(this,Q,"f")[r]=n),{counter:`${++On(this,Q,"f")[r]}`,fee:typeof t.fee>"u"?"0":`${t.fee}`,gas_limit:typeof t.gas_limit>"u"?"0":`${t.gas_limit}`,storage_limit:typeof t.storage_limit>"u"?"0":`${t.storage_limit}`}}getSource(t,r,n){return{source:typeof t.source>"u"?n||r:t.source}}addRevealOperationIfNeeded(t,r){return p(this,void 0,void 0,function*(){if(ho(t)){const n=[t],{publicKey:i,pkh:s}=yield this.getKeys();if(yield this.isAccountRevealRequired(r)){if(!i)throw new Oi(s);const[,o]=Ot(s,nn);return n.unshift(yield Dn({fee:cs(s),storageLimit:os,gasLimit:Jn(s),proof:o===L.BLS12_381PublicKeyHash?(yield this.signer.provePossession()).prefixSig:void 0},r,i)),n}}return t})}getKeys(){return p(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{pkh:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():yield this.context.walletProvider.getPK()}})}convertIntoArray(t){return Array.isArray(t)?[...t]:[t]}constructOpContents(t,r,n,i,s){return t.map(o=>{switch(o.kind){case _.ACTIVATION:case _.DRAIN_DELEGATE:return Object.assign({},o);case _.ORIGINATION:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{balance:typeof o.balance<"u"?`${o.balance}`:"0"}),this.getSource(o,n,i)),this.getFee(o,n,r));case _.TRANSACTION:{const a=Object.assign(Object.assign(Object.assign(Object.assign({},o),{amount:typeof o.amount<"u"?`${o.amount}`:"0"}),this.getSource(o,n,i)),this.getFee(o,n,r));if(a.source.toLowerCase().startsWith("kt1"))throw new Pa(`KT1 addresses are not supported as source since ${ot.PsBabyM1}`);return a}case _.REVEAL:case _.DELEGATION:case _.REGISTER_GLOBAL_CONSTANT:case _.UPDATE_CONSENSUS_KEY:case _.UPDATE_COMPANION_KEY:case _.SMART_ROLLUP_ADD_MESSAGES:case _.SMART_ROLLUP_ORIGINATE:case _.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE:return Object.assign(Object.assign(Object.assign({},o),this.getSource(o,n,i)),this.getFee(o,n,r));case _.TRANSFER_TICKET:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{ticket_amount:`${o.ticket_amount}`}),this.getSource(o,n,i)),this.getFee(o,n,r));case _.INCREASE_PAID_STORAGE:return Object.assign(Object.assign(Object.assign(Object.assign({},o),{amount:`${o.amount}`}),this.getSource(o,n,i)),this.getFee(o,n,r));case _.BALLOT:if(s===void 0)throw new Ln("Failed to get the current voting period index");return Object.assign(Object.assign({},o),{period:s?.voting_period.index});case _.PROPOSALS:if(s===void 0)throw new Ln("Failed to get the current voting period index");return Object.assign(Object.assign({},o),{period:s?.voting_period.index});default:throw new je(o.kind)}})}activate(t){return p(this,arguments,void 0,function*({pkh:r,secret:n}){const i=yield bu({pkh:r,secret:n}),s=this.convertIntoArray(i),o=yield this.getBlockHash(),a=yield this.getProtocolHash();lt(this,Q,{});const c=parseInt(yield this.getHeadCounter(r),10),u=this.constructOpContents(s,c,r);return{opOb:{branch:o,contents:u,protocol:a},counter:c}})}reveal(t){return p(this,arguments,void 0,function*({fee:r,gasLimit:n,storageLimit:i,proof:s}){const{pkh:o,publicKey:a}=yield this.getKeys();if(!a)throw new Oi(o);const[,c]=Ot(o,nn);if(c===L.BLS12_381PublicKeyHash)if(s)Ot(s,[L.BLS12_381Signature]);else{const{prefixSig:A}=yield this.signer.provePossession();s=A}else if(s)throw new kt("Proof field is only allowed to reveal a bls account ");const u=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.getOperationLimits(u),g=At({fee:r,storageLimit:i,gasLimit:n},l),E=yield Dn({fee:g.fee,gasLimit:g.gasLimit,storageLimit:g.storageLimit,proof:s},o,a),y=this.convertIntoArray(E),v=yield this.getBlockHash(),P=yield this.getProtocolHash();lt(this,Q,{});const O=parseInt(yield this.getHeadCounter(o),10),S=this.constructOpContents(y,O,o);return{opOb:{branch:v,contents:S,protocol:P},counter:O}})}originate(t,r){return p(this,void 0,void 0,function*(){var{fee:n,storageLimit:i,gasLimit:s}=t,o=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:a}=yield this.getKeys(),c=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getOperationLimits(c),l=yield fi(yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},o),At({fee:n,storageLimit:i,gasLimit:s},u)))),g=yield this.addRevealOperationIfNeeded(l,a),E=this.convertIntoArray(g),y=yield this.getBlockHash(),v=yield this.getProtocolHash();lt(this,Q,{});const P=parseInt(yield this.getHeadCounter(a),10),O=this.constructOpContents(E,P,a,r);return{opOb:{branch:y,contents:O,protocol:v},counter:P}})}transaction(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getOperationLimits(a),u=yield br(Object.assign(Object.assign({},s),At({fee:r,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),g=this.convertIntoArray(l),E=yield this.getBlockHash(),y=yield this.getProtocolHash();lt(this,Q,{});const v=parseInt(yield this.getHeadCounter(o),10),P=this.constructOpContents(g,v,o,s.source);return{opOb:{branch:E,contents:P,protocol:y},counter:v}})}stake(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getOperationLimits(a),u=yield br(Object.assign(Object.assign(Object.assign(Object.assign({},s),{to:o}),At({fee:r,storageLimit:n,gasLimit:i},c)),{parameter:{entrypoint:"stake",value:{prim:"Unit"}}})),l=yield this.addRevealOperationIfNeeded(u,o),g=this.convertIntoArray(l),E=yield this.getBlockHash(),y=yield this.getProtocolHash();lt(this,Q,{});const v=parseInt(yield this.getHeadCounter(o),10),P=this.constructOpContents(g,v,o,s.source);return{opOb:{branch:E,contents:P,protocol:y},counter:v}})}unstake(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getOperationLimits(a),u=yield br(Object.assign(Object.assign(Object.assign(Object.assign({},s),{to:o}),At({fee:r,storageLimit:n,gasLimit:i},c)),{parameter:{entrypoint:"unstake",value:{prim:"Unit"}}})),l=yield this.addRevealOperationIfNeeded(u,o),g=this.convertIntoArray(l),E=yield this.getBlockHash(),y=yield this.getProtocolHash();lt(this,Q,{});const v=parseInt(yield this.getHeadCounter(o),10),P=this.constructOpContents(g,v,o,s.source);return{opOb:{branch:E,contents:P,protocol:y},counter:v}})}finalizeUnstake(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i,to:s}=t,o=ut(t,["fee","storageLimit","gasLimit","to"]);const{pkh:a}=yield this.getKeys(),c=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getOperationLimits(c),l=yield br(Object.assign(Object.assign(Object.assign(Object.assign({},o),{to:s||a,amount:0}),At({fee:r,storageLimit:n,gasLimit:i},u)),{parameter:{entrypoint:"finalize_unstake",value:{prim:"Unit"}}})),g=yield this.addRevealOperationIfNeeded(l,a),E=this.convertIntoArray(g),y=yield this.getBlockHash(),v=yield this.getProtocolHash();lt(this,Q,{});const P=parseInt(yield this.getHeadCounter(a),10),O=this.constructOpContents(E,P,a,o.source);return{opOb:{branch:y,contents:O,protocol:v},counter:P}})}delegation(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getOperationLimits(a),u=yield gi(Object.assign(Object.assign({},s),At({fee:r,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),g=this.convertIntoArray(l),E=yield this.getBlockHash(),y=yield this.getProtocolHash();lt(this,Q,{});const v=parseInt(yield this.getHeadCounter(o),10),P=this.constructOpContents(g,v,o,s.source);return{opOb:{branch:E,contents:P,protocol:y},counter:v}})}registerDelegate(t,r){return p(this,arguments,void 0,function*({fee:n,storageLimit:i,gasLimit:s},o){const{pkh:a}=yield this.getKeys(),c=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getOperationLimits(c),l=At({fee:n,storageLimit:i,gasLimit:s},u),g=yield vu({fee:l.fee,storageLimit:l.storageLimit,gasLimit:l.gasLimit},a),E=yield this.addRevealOperationIfNeeded(g,a),y=this.convertIntoArray(E),v=yield this.getBlockHash(),P=yield this.getProtocolHash();lt(this,Q,{});const O=parseInt(yield this.getHeadCounter(a),10),S=this.constructOpContents(y,O,a,o);return{opOb:{branch:v,contents:S,protocol:P},counter:O}})}registerGlobalConstant(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getOperationLimits(a),u=yield mi(Object.assign(Object.assign({},s),At({fee:r,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),g=this.convertIntoArray(l),E=yield this.getBlockHash(),y=yield this.getProtocolHash();lt(this,Q,{});const v=parseInt(yield this.getHeadCounter(o),10),P=this.constructOpContents(g,v,o,s.source);return{opOb:{branch:E,contents:P,protocol:y},counter:v}})}updateConsensusKey(t,r){return p(this,void 0,void 0,function*(){var{fee:n,storageLimit:i,gasLimit:s}=t,o=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:a}=yield this.getKeys(),[,c]=Ot(o.pk,or);if(c===L.BLS12_381PublicKey){if(!o.proof)throw new ar("Proof is required to set a bls account as consensus key ")}else if(o.proof)throw new kt("Proof field is only allowed for a bls account as consensus key");const u=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.getOperationLimits(u),g=yield _i(Object.assign(Object.assign({},o),At({fee:n,storageLimit:i,gasLimit:s},l))),E=yield this.addRevealOperationIfNeeded(g,a),y=this.convertIntoArray(E),v=yield this.getBlockHash(),P=yield this.getProtocolHash();lt(this,Q,{});const O=parseInt(yield this.getHeadCounter(a),10),S=this.constructOpContents(y,O,a,r);return{opOb:{branch:v,contents:S,protocol:P},counter:O}})}updateCompanionKey(t,r){return p(this,void 0,void 0,function*(){var{fee:n,storageLimit:i,gasLimit:s}=t,o=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:a}=yield this.getKeys(),[,c]=Ot(o.pk,or);if(c!==L.BLS12_381PublicKey)throw new kt("companion key must be a bls account");if(!o.proof)throw new ar("Proof is required to set a bls account as companion key ");const u=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.getOperationLimits(u),g=yield bi(Object.assign(Object.assign({},o),At({fee:n,storageLimit:i,gasLimit:s},l))),E=yield this.addRevealOperationIfNeeded(g,a),y=this.convertIntoArray(E),v=yield this.getBlockHash(),P=yield this.getProtocolHash();lt(this,Q,{});const O=parseInt(yield this.getHeadCounter(a),10),S=this.constructOpContents(y,O,a,r);return{opOb:{branch:v,contents:S,protocol:P},counter:O}})}increasePaidStorage(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getOperationLimits(a),u=yield Ei(Object.assign(Object.assign({},s),At({fee:r,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),g=this.convertIntoArray(l),E=yield this.getBlockHash(),y=yield this.getProtocolHash();lt(this,Q,{});const v=parseInt(yield this.getHeadCounter(o),10),P=this.constructOpContents(g,v,o,s.source);return{opOb:{branch:E,contents:P,protocol:y},counter:v}})}ballot(t){return p(this,void 0,void 0,function*(){const{pkh:r}=yield this.getKeys(),n=yield Su(Object.assign({},t)),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();lt(this,Q,{});const a=parseInt(yield this.getHeadCounter(r),10);let c;try{c=yield this.rpc.getCurrentPeriod()}catch{throw new Ln("Failed to get the current voting period index")}const u=this.constructOpContents(i,a,r,void 0,c);return{opOb:{branch:s,contents:u,protocol:o},counter:a}})}proposals(t){return p(this,void 0,void 0,function*(){const{pkh:r}=yield this.getKeys(),n=yield Pu(Object.assign({},t)),i=this.convertIntoArray(n),s=yield this.getBlockHash(),o=yield this.getProtocolHash();lt(this,Q,{});const a=parseInt(yield this.getHeadCounter(r),10);let c;try{c=yield this.rpc.getCurrentPeriod()}catch{throw new Ln("Failed to get the current voting period index")}const u=this.constructOpContents(i,a,r,void 0,c);return{opOb:{branch:s,contents:u,protocol:o},counter:a}})}drainDelegate(t,r){return p(this,void 0,void 0,function*(){const{pkh:n}=yield this.getKeys(),i=yield Au(Object.assign({},t)),s=this.convertIntoArray(i),o=yield this.getBlockHash(),a=yield this.getProtocolHash();lt(this,Q,{});const c=parseInt(yield this.getHeadCounter(n),10),u=this.constructOpContents(s,c,n,r);return{opOb:{branch:o,contents:u,protocol:a},counter:c}})}transferTicket(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getOperationLimits(a),u=yield yi(Object.assign(Object.assign({},s),At({fee:r,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),g=this.convertIntoArray(l),E=yield this.getBlockHash(),y=yield this.getProtocolHash();lt(this,Q,{});const v=parseInt(yield this.getHeadCounter(o),10),P=this.constructOpContents(g,v,o,s.source);return{opOb:{branch:E,contents:P,protocol:y},counter:v}})}smartRollupAddMessages(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getOperationLimits(a),u=yield vi(Object.assign(Object.assign({},s),At({fee:r,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),g=this.convertIntoArray(l),E=yield this.getBlockHash(),y=yield this.getProtocolHash();lt(this,Q,{});const v=parseInt(yield this.getHeadCounter(o),10),P=this.constructOpContents(g,v,o,s.source);return{opOb:{branch:E,contents:P,protocol:y},counter:v}})}smartRollupOriginate(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getOperationLimits(a),u=yield Ai(Object.assign(Object.assign({},At({fee:r,storageLimit:n,gasLimit:i},c)),s)),l=yield this.addRevealOperationIfNeeded(u,o),g=this.convertIntoArray(l),E=yield this.getBlockHash(),y=yield this.getProtocolHash();lt(this,Q,{});const v=parseInt(yield this.getHeadCounter(o),10),P=this.constructOpContents(g,v,o,s.source);return{opOb:{branch:E,contents:P,protocol:y},counter:v}})}smartRollupExecuteOutboxMessage(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const{pkh:o}=yield this.getKeys(),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.getOperationLimits(a),u=yield Si(Object.assign(Object.assign({},s),At({fee:r,storageLimit:n,gasLimit:i},c))),l=yield this.addRevealOperationIfNeeded(u,o),g=this.convertIntoArray(l),E=yield this.getBlockHash(),y=yield this.getProtocolHash();lt(this,Q,{});const v=parseInt(yield this.getHeadCounter(o),10),P=this.constructOpContents(g,v,o,s.source);return{opOb:{branch:E,contents:P,protocol:y},counter:v}})}batch(t,r){return p(this,void 0,void 0,function*(){const{pkh:n,publicKey:i}=yield this.getKeys(),s=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getOperationLimits(s,t.length),a=yield this.isRevealOpNeeded(t,n),c=[];if(r)for(const y of t)if(qn(y)){const v=r.shift(),P=At(y,{fee:v.suggestedFeeMutez,storageLimit:v.storageLimit,gasLimit:v.gasLimit});c.push(yield this.getRPCOp(Object.assign(Object.assign({},y),P)))}else c.push(Object.assign({},y));else for(const y of t)if(qn(y)){const v=At(y,o);c.push(yield this.getRPCOp(Object.assign(Object.assign({},y),v)))}else c.push(Object.assign({},y));if(a){if(!i)throw new Oi(n);const[,y]=Ot(n,nn);c.unshift(yield Dn({fee:cs(n),storageLimit:os,gasLimit:Jn(n),proof:y===L.BLS12_381PublicKeyHash?(yield this.signer.provePossession()).prefixSig:void 0},n,i))}const u=yield this.getBlockHash(),l=yield this.getProtocolHash();lt(this,Q,{});const g=parseInt(yield this.getHeadCounter(n),10),E=this.constructOpContents(c,g,n);return{opOb:{branch:u,contents:E,protocol:l},counter:g}})}contractCall(t){return p(this,void 0,void 0,function*(){var r,n,i;const s=yield this.getBlockHash(),o=yield this.getProtocolHash(),{pkh:a}=yield this.getKeys();lt(this,Q,{});const c=parseInt(yield this.getHeadCounter(a),10),u=t.toTransferParams(),l=yield this.context.readProvider.getProtocolConstants("head"),g=yield this.getOperationLimits(l),E=At({fee:u.fee,storageLimit:u.storageLimit,gasLimit:u.gasLimit},g),y={kind:_.TRANSACTION,fee:(r=u.fee)!==null&&r!==void 0?r:E.fee,gas_limit:(n=u.gasLimit)!==null&&n!==void 0?n:E.gasLimit,storage_limit:(i=u.storageLimit)!==null&&i!==void 0?i:E.storageLimit,amount:String(u.amount),destination:u.to,parameters:u.parameter},v=yield this.addRevealOperationIfNeeded(y,a),P=this.convertIntoArray(v),O=this.constructOpContents(P,c,a);return{opOb:{branch:s,contents:O,protocol:o},counter:c}})}toPreapply(t){return p(this,void 0,void 0,function*(){const{opOb:{contents:r,branch:n,protocol:i}}=t,s=this.toForge(t),o=yield this.context.forger.forge(s),a=yield this.context.signer.sign(o,new Uint8Array([3]));return[{contents:r,branch:n,protocol:i,signature:a.prefixSig}]})}toForge({opOb:{contents:t,branch:r}}){return{branch:r,contents:t}}}Q=new WeakMap;const Ku=[_.ACTIVATION,_.ORIGINATION,_.TRANSACTION,_.DELEGATION];class mo extends _n{constructor(t,r){super(t),this.estimator=r,this.operations=[],this.prepare=new Wr(this.context)}withTransfer(t){const r=K(t.to);if(t.amount<0)throw new Be(t.amount.toString());if(r!==T.VALID)throw new F(t.to,r);return this.operations.push(Object.assign({kind:_.TRANSACTION},t)),this}withTransferTicket(t){const r=K(t.destination);if(r!==T.VALID)throw new F(t.destination,r);return this.operations.push(Object.assign({kind:_.TRANSFER_TICKET},t)),this}withContractCall(t,r={}){return this.withTransfer(t.toTransferParams(r))}withDelegation(t){var r;const n=K(t.source);if(t.source&&n!==T.VALID)throw new F(t.source,n);const i=K((r=t.delegate)!==null&&r!==void 0?r:"");if(t.delegate&&i!==T.VALID)throw new F(t.delegate,i);return this.operations.push(Object.assign({kind:_.DELEGATION},t)),this}withActivation({pkh:t,secret:r}){const n=gs(t);if(n!==T.VALID)throw new Xn(t,n);return this.operations.push({kind:_.ACTIVATION,pkh:t,secret:r}),this}withOrigination(t){return this.operations.push(Object.assign({kind:_.ORIGINATION},t)),this}withRegisterGlobalConstant(t){return this.operations.push(Object.assign({kind:_.REGISTER_GLOBAL_CONSTANT},t)),this}withIncreasePaidStorage(t){return this.operations.push(Object.assign({kind:_.INCREASE_PAID_STORAGE},t)),this}withUpdateConsensusKey(t){const[,r]=Ot(t.pk,or);if(r===L.BLS12_381PublicKey){if(!t.proof)throw new ar("Proof is required to set a bls account as consensus key ")}else if(t.proof)throw new kt("Proof field is only allowed for a bls account as consensus key");return this.operations.push(Object.assign({kind:_.UPDATE_CONSENSUS_KEY},t)),this}withUpdateCompanionKey(t){const[,r]=Ot(t.pk,or);if(r!==L.BLS12_381PublicKey)throw new kt("companion key must be a bls account");if(!t.proof)throw new ar("Proof is required to set a bls account as companion key ");return this.operations.push(Object.assign({kind:_.UPDATE_COMPANION_KEY},t)),this}withSmartRollupAddMessages(t){return this.operations.push(Object.assign({kind:_.SMART_ROLLUP_ADD_MESSAGES},t)),this}withSmartRollupOriginate(t){return this.operations.push(Object.assign({kind:_.SMART_ROLLUP_ORIGINATE},t)),this}withSmartRollupExecuteOutboxMessage(t){return this.operations.push(Object.assign({kind:_.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE},t)),this}getRPCOp(t){return p(this,void 0,void 0,function*(){switch(t.kind){case _.TRANSACTION:return br(Object.assign({},t));case _.ORIGINATION:return fi(yield this.context.parser.prepareCodeOrigination(Object.assign({},t)));case _.DELEGATION:return gi(Object.assign({},t));case _.REGISTER_GLOBAL_CONSTANT:return mi(Object.assign({},t));case _.INCREASE_PAID_STORAGE:return Ei(Object.assign({},t));case _.UPDATE_CONSENSUS_KEY:return _i(Object.assign({},t));case _.UPDATE_COMPANION_KEY:return bi(Object.assign({},t));case _.TRANSFER_TICKET:return yi(Object.assign({},t));case _.SMART_ROLLUP_ADD_MESSAGES:return vi(Object.assign({},t));case _.SMART_ROLLUP_ORIGINATE:return Ai(Object.assign({},t));case _.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE:return Si(Object.assign({},t));default:throw new je(JSON.stringify(t.kind))}})}with(t){for(const r of t)switch(r.kind){case _.TRANSACTION:this.withTransfer(r);break;case _.ORIGINATION:this.withOrigination(r);break;case _.DELEGATION:this.withDelegation(r);break;case _.ACTIVATION:this.withActivation(r);break;case _.REGISTER_GLOBAL_CONSTANT:this.withRegisterGlobalConstant(r);break;case _.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(r);break;case _.TRANSFER_TICKET:this.withTransferTicket(r);break;case _.SMART_ROLLUP_ADD_MESSAGES:this.withSmartRollupAddMessages(r);break;case _.SMART_ROLLUP_ORIGINATE:this.withSmartRollupOriginate(r);break;case _.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE:this.withSmartRollupExecuteOutboxMessage(r);break;default:throw new je(JSON.stringify(r.kind))}return this}send(t){return p(this,void 0,void 0,function*(){const r=yield this.signer.publicKeyHash(),n=t&&t.source||r,i=yield this.estimator.batch(this.operations);i.length!==this.operations.length&&i.shift();const s=yield this.prepare.batch(this.operations,i),o=yield this.forge(s),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new Nu(a,s.opOb.contents,n,u,l,c)})}}class Hm{constructor(t,r){this.context=t,this.estimator=r}batch(t){const r=new mo(this.context,this.estimator);return Array.isArray(t)&&r.with(t),r}}class Dm extends fr{constructor(t,r,n){super(t,r,n),this.opHash=t,this.context=r,this.getOriginatedContractAddresses=()=>p(this,void 0,void 0,function*(){const i=yield this.operationResults();if(i){const s=i.filter(a=>a.kind==="origination");let o=[];for(const a of s)a.metadata.operation_result.originated_contracts&&(o=[...o,...a.metadata.operation_result.originated_contracts]);return o}else throw new $t("Unable to fetch operation results")})}revealOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return t.find(r=>r.kind===_.REVEAL);throw new $t("Unable to fetch operation results")})}status(){return p(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.operationResults();if(t)return t.filter(r=>Ku.indexOf(r.kind)!==-1).map(r=>Lr(r)?r.metadata.operation_result.status:"unknown")[0]||"unknown";throw new $t("Unable to fetch operation results")})}}class Cm extends fr{constructor(t,r,n){super(t,r,n),this.opHash=t,this.context=r}revealOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return t.find(r=>r.kind===_.REVEAL);throw new $t("Unable to fetch operation result")})}increasePaidStorageOperation(){return p(this,void 0,void 0,function*(){const t=yield this.operationResults();if(t)return t.find(r=>r.kind===_.INCREASE_PAID_STORAGE);throw new $t("Unable to fetch operation result")})}status(){return p(this,void 0,void 0,function*(){if(!this._included)return"pending";const t=yield this.increasePaidStorageOperation();return t?t.metadata.operation_result.status:"unknown"})}}function Bm(e){return function(r){return new ni(null).pipe(Xa({each:e,with:()=>Ja(()=>new Lu("Confirmation polling timed out"))}),un(()=>r))}}const $m=(e,t,r)=>e.pipe(Bm(t.config.confirmationPollingTimeoutSecond*1e3),ln({connector:()=>new Er(1),resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0}));class Um{constructor(t){this.context=t,this.sharedHeadObs=Qa(()=>hu(this.context.stream.subscribeBlock("head")))}createNewHeadObservable(){return p(this,void 0,void 0,function*(){return $m(this.sharedHeadObs,this.context)})}createPastBlockWalker(t,r=1){return pr(this.context.readProvider.getBlock(t)).pipe($e(n=>r===1?si(n):Ss(n.header.level,r-1).pipe(Nh(n),En(i=>p(this,void 0,void 0,function*(){return this.context.readProvider.getBlock(typeof i=="number"?i:i.header.level)})))))}createHeadObservableFromConfig(t){return p(this,arguments,void 0,function*({blockIdentifier:r}){const n=[];return r&&n.push(this.createPastBlockWalker(r)),n.push(yield this.createNewHeadObservable()),Gn(...n)})}createOperation(t){return p(this,arguments,void 0,function*(r,n={}){return new fr(r,this.context.clone(),yield this.createHeadObservableFromConfig(n))})}createBatchOperation(t){return p(this,arguments,void 0,function*(r,n={}){return new Dm(r,this.context.clone(),yield this.createHeadObservableFromConfig(n))})}createTransactionOperation(t){return p(this,arguments,void 0,function*(r,n={}){return new ku(r,this.context.clone(),yield this.createHeadObservableFromConfig(n))})}createTransferTicketOperation(t){return p(this,arguments,void 0,function*(r,n={}){return new Du(r,this.context.clone(),yield this.createHeadObservableFromConfig(n))})}createDelegationOperation(t){return p(this,arguments,void 0,function*(r,n={}){return new Hu(r,this.context.clone(),yield this.createHeadObservableFromConfig(n))})}createOriginationOperation(t){return p(this,arguments,void 0,function*(r,n={}){return new Mu(r,this.context.clone(),yield this.createHeadObservableFromConfig(n))})}createIncreasePaidStorageOperation(t){return p(this,arguments,void 0,function*(r,n={}){return new Cm(r,this.context.clone(),yield this.createHeadObservableFromConfig(n))})}}class Gm extends _n{constructor(t){super(t),this.prepare=new Wr(this.context)}getBalance(t){return p(this,void 0,void 0,function*(){const r=K(t);if(r!==T.VALID)throw new F(t,r);return this.context.readProvider.getBalance(t,"head")})}getSpendable(t){return p(this,void 0,void 0,function*(){const r=K(t);if(r!==T.VALID)throw new F(t,r);return this.context.readProvider.getSpendable(t,"head")})}getDelegate(t){return p(this,void 0,void 0,function*(){const r=K(t);if(r!==T.VALID)throw new F(t,r);return this.context.readProvider.getDelegate(t,"head")})}activate(t,r){return p(this,void 0,void 0,function*(){const n=gs(t);if(n!==T.VALID)throw new Xn(t,n);const i=yield this.prepare.activate({pkh:t,secret:r}),s=yield this.forge(i),o=`${s.opbytes}00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`;return new Lt(yield this.rpc.injectOperation(o),Object.assign(Object.assign({},s),{opbytes:o}),[],this.context.clone())})}}const Nn=100,Km=1,jm=.1;class ft{constructor(t,r,n,i,s=Nn){this._milligasLimit=t,this._storageLimit=r,this.opSize=n,this.minimalFeePerStorageByteMutez=i,this.baseFeeMutez=s}get burnFeeMutez(){return this.roundUp(Number(this.storageLimit)*Number(this.minimalFeePerStorageByteMutez))}get storageLimit(){return Math.max(Number(this._storageLimit),0)}get gasLimit(){return this.roundUp(Number(this._milligasLimit)/1e3)}get operationFeeMutez(){return this.gasLimit*jm+Number(this.opSize)*Km}roundUp(t){return Math.ceil(Number(t))}get minimalFeeMutez(){return this.roundUp(this.operationFeeMutez+Nn)}get suggestedFeeMutez(){return this.roundUp(this.operationFeeMutez+Nn*1.2)}get usingBaseFeeMutez(){return Math.max(Number(this.baseFeeMutez),Nn)+this.roundUp(this.operationFeeMutez)}get totalCost(){return this.minimalFeeMutez+this.burnFeeMutez}get consumedMilligas(){return Number(this._milligasLimit)}static createEstimateInstanceFromProperties(t){let r=0,n=0,i=0,s=0,o;return t.forEach(a=>{r+=a.milligasLimit,n+=a.storageLimit,i+=a.opSize,s=Math.max(a.minimalFeePerStorageByteMutez,s),a.baseFeeMutez&&(o=o?o+a.baseFeeMutez:a.baseFeeMutez)}),new ft(r,n,i,s,o)}static createArrayEstimateInstancesFromProperties(t){return t.map(r=>new ft(r.milligasLimit,r.storageLimit,r.opSize,r.minimalFeePerStorageByteMutez,r.baseFeeMutez))}}class ju extends at{constructor(){super(),this.name="RevealEstimateError",this.message="Public key is unknown, unable to estimate the reveal operation in Wallet API."}}const Fm="edsigtkpiSSschcaCt9pUVrpNPf7TTcgvgDEDD6NCEHMy8NNQJCGnMfLZzYoQj74yLjo9wx6MPVV29CvVzgi7qEcEUok3k7AuMg";class Fu extends _n{constructor(){super(...arguments),this.REVEAL_LENGTH=324,this.REVEAL_LENGTH_TZ4=622,this.MILLIGAS_BUFFER=100*1e3,this.STORAGE_BUFFER=20,this.prepare=new Wr(this.context)}getKeys(){return p(this,void 0,void 0,function*(){const t=this.context.isAnySignerConfigured();return{publicKeyHash:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():yield this.context.walletProvider.getPK()}})}getEstimationPropertiesFromOperationContent(t,r,n,i){const s=ve({contents:[t]});let o=0,a=0;return s.forEach(c=>{o+=Number(c.consumed_milligas)||0,a+="allocated_destination_contract"in c?i:0,a+="originated_contracts"in c&&Array.isArray(c.originated_contracts)?c.originated_contracts.length*i:0,a+="storage_size"in c&&"global_address"in c&&Number(c.storage_size)||0,a+="paid_storage_size_diff"in c&&Number(c.paid_storage_size_diff)||0,a+="genesis_commitment_hash"in c&&Number(c.size)||0}),qn(t)?{milligasLimit:Ou(t)?o+Number(this.MILLIGAS_BUFFER):o,storageLimit:a>0?a+this.STORAGE_BUFFER:0,opSize:r,minimalFeePerStorageByteMutez:n.toNumber()}:{milligasLimit:0,storageLimit:0,opSize:r,minimalFeePerStorageByteMutez:n.toNumber(),baseFeeMutez:0}}calculateEstimates(t,r){return p(this,void 0,void 0,function*(){const{opbytes:n,opOb:{branch:i,contents:s}}=yield this.forge(t),o={operation:{branch:i,contents:s,signature:Fm},chain_id:yield this.context.readProvider.getChainId()},{opResponse:a}=yield this.simulate(o),{cost_per_byte:c,origination_size:u}=r,l=[...Zr(a,"backtracked"),...Zr(a)];if(l.length)throw new po(l,"Error occurred during estimation",a.contents);let g=1;return Array.isArray(t.opOb.contents)&&t.opOb.contents.length>1&&(g=a.contents[0].kind==="reveal"?t.opOb.contents.length-1:t.opOb.contents.length),a.contents.map(E=>{const y=E;y.source=y.source||"";let v,P;return y.source.startsWith(L.BLS12_381PublicKeyHash)?(v=this.REVEAL_LENGTH_TZ4/2,P=(n.length/2+Fi[L.BLS12_381Signature])/g):(v=this.REVEAL_LENGTH/2,P=(n.length/2+Fi[L.Ed25519Signature])/g),this.getEstimationPropertiesFromOperationContent(E,E.kind==="reveal"?v:P,c,u??257)})})}originate(t){return p(this,void 0,void 0,function*(){const r=yield this.prepare.originate(t),n=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.calculateEstimates(r,n);if(r.opOb.contents[0].kind==="reveal"){const s=r.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;i.shift(),i[0].opSize-=s}return ft.createEstimateInstanceFromProperties(i)})}transfer(t){return p(this,void 0,void 0,function*(){var r,{fee:n,storageLimit:i,gasLimit:s}=t,o=ut(t,["fee","storageLimit","gasLimit"]);const a=K(o.to);if(a!==T.VALID)throw new F(o.to,a);const c=K((r=o.source)!==null&&r!==void 0?r:"");if(o.source&&c!==T.VALID)throw new F(o.source,c);if(o.amount<0)throw new Be(o.amount.toString());const u=yield this.prepare.transaction(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),l=yield this.context.readProvider.getProtocolConstants("head"),g=yield this.calculateEstimates(u,l);if(u.opOb.contents[0].kind==="reveal"){const E=u.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;g.shift(),g[0].opSize-=E}return ft.createEstimateInstanceFromProperties(g)})}stake(t){return p(this,void 0,void 0,function*(){var r,{fee:n,storageLimit:i,gasLimit:s}=t,o=ut(t,["fee","storageLimit","gasLimit"]);const a=K((r=o.source)!==null&&r!==void 0?r:"");if(o.source&&a!==T.VALID)throw new F(o.source,a);if(o.to||(o.to=o.source),o.to&&o.to!==o.source)throw new Br(o.to);if(o.amount<0)throw new Be(o.amount.toString());const c=yield this.prepare.stake(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),u=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.calculateEstimates(c,u);if(c.opOb.contents[0].kind==="reveal"){l.shift();const g=c.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;l[0].opSize-=g}return ft.createEstimateInstanceFromProperties(l)})}unstake(t){return p(this,void 0,void 0,function*(){var r,{fee:n,storageLimit:i,gasLimit:s}=t,o=ut(t,["fee","storageLimit","gasLimit"]);const a=K((r=o.source)!==null&&r!==void 0?r:"");if(o.source&&a!==T.VALID)throw new F(o.source,a);if(o.to||(o.to=o.source),o.to&&o.to!==o.source)throw new Br(o.to);if(o.amount<0)throw new Be(o.amount.toString());const c=yield this.prepare.unstake(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),u=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.calculateEstimates(c,u);if(c.opOb.contents[0].kind==="reveal"){l.shift();const g=c.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;l[0].opSize-=g}return ft.createEstimateInstanceFromProperties(l)})}finalizeUnstake(t){return p(this,void 0,void 0,function*(){var r,{fee:n,storageLimit:i,gasLimit:s}=t,o=ut(t,["fee","storageLimit","gasLimit"]);const a=K((r=o.source)!==null&&r!==void 0?r:"");if(o.source&&a!==T.VALID)throw new F(o.source,a);if(o.to||(o.to=o.source),o.amount||(o.amount=0),o.amount!==void 0&&o.amount!==0)throw new Error("Amount must be 0 for finalize_unstake operation");const c=yield this.prepare.finalizeUnstake(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),u=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.calculateEstimates(c,u);if(c.opOb.contents[0].kind==="reveal"){l.shift();const g=c.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;l[0].opSize-=g}return ft.createEstimateInstanceFromProperties(l)})}transferTicket(t){return p(this,void 0,void 0,function*(){var r,{fee:n,storageLimit:i,gasLimit:s}=t,o=ut(t,["fee","storageLimit","gasLimit"]);const a=K(o.destination);if(a!==T.VALID)throw new F(o.destination,a);const c=K((r=o.source)!==null&&r!==void 0?r:"");if(o.source&&c!==T.VALID)throw new F(o.source,c);const u=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.prepare.transferTicket(Object.assign({fee:n,storageLimit:i,gasLimit:s},o)),g=yield this.calculateEstimates(l,u);if(l.opOb.contents[0].kind==="reveal"){g.shift();const E=l.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;g[0].opSize-=E}return ft.createEstimateInstanceFromProperties(g)})}setDelegate(t){return p(this,void 0,void 0,function*(){var r,{fee:n,gasLimit:i,storageLimit:s}=t,o=ut(t,["fee","gasLimit","storageLimit"]);const a=K(o.source);if(o.source&&a!==T.VALID)throw new F(o.source,a);const c=K((r=o.delegate)!==null&&r!==void 0?r:"");if(o.delegate&&c!==T.VALID)throw new F(o.delegate,c);const u=yield this.prepare.delegation(Object.assign({fee:n,storageLimit:s,gasLimit:i},o)),l=yield this.context.readProvider.getProtocolConstants("head"),g=yield this.calculateEstimates(u,l);if(u.opOb.contents[0].kind==="reveal"){g.shift();const E=u.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;g[0].opSize-=E}return ft.createEstimateInstanceFromProperties(g)})}batch(t){return p(this,void 0,void 0,function*(){const r=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.batch(t),i=yield this.calculateEstimates(n,r);return ft.createArrayEstimateInstancesFromProperties(i)})}registerDelegate(t,r){return p(this,void 0,void 0,function*(){var{fee:n,storageLimit:i,gasLimit:s}=t,o=ut(t,["fee","storageLimit","gasLimit"]);const a=(yield this.getKeys()).publicKeyHash,c=yield this.context.readProvider.getProtocolConstants("head"),u=r||a,l=yield this.prepare.registerDelegate(Object.assign({fee:n,storageLimit:i,gasLimit:s},o),u),g=yield this.calculateEstimates(l,c);if(l.opOb.contents[0].kind==="reveal"){g.shift();const E=l.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;g[0].opSize-=E}return ft.createEstimateInstanceFromProperties(g)})}reveal(t){return p(this,void 0,void 0,function*(){const{publicKeyHash:r,publicKey:n}=yield this.getKeys();if(!n)throw new ju;if(yield this.isAccountRevealRequired(r)){const[,i]=Ot(r,nn);if(i===L.BLS12_381PublicKeyHash)if(t&&t.proof)Ot(t.proof,[L.BLS12_381Signature]);else{const{prefixSig:c}=yield this.signer.provePossession();t=Object.assign(Object.assign({},t),{proof:c})}else if(t&&t.proof)throw new kt("Proof field is only allowed to reveal a bls account ");const s=yield this.context.readProvider.getProtocolConstants("head"),o=t?yield this.prepare.reveal(t):yield this.prepare.reveal({}),a=yield this.calculateEstimates(o,s);return ft.createEstimateInstanceFromProperties(a)}})}registerGlobalConstant(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);const o=yield this.prepare.registerGlobalConstant(Object.assign({fee:r,storageLimit:n,gasLimit:i},s)),a=yield this.context.readProvider.getProtocolConstants("head"),c=yield this.calculateEstimates(o,a);if(o.opOb.contents[0].kind==="reveal"){c.shift();const u=o.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;c[0].opSize-=u}return ft.createEstimateInstanceFromProperties(c)})}increasePaidStorage(t){return p(this,void 0,void 0,function*(){var{fee:r,storageLimit:n,gasLimit:i}=t,s=ut(t,["fee","storageLimit","gasLimit"]);if(s.amount<0)throw new Be(s.amount.toString());const o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.prepare.increasePaidStorage(Object.assign({fee:r,storageLimit:n,gasLimit:i},s)),c=yield this.calculateEstimates(a,o);if(a.opOb.contents[0].kind==="reveal"){c.shift();const u=a.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;c[0].opSize-=u}return ft.createEstimateInstanceFromProperties(c)})}updateConsensusKey(t){return p(this,void 0,void 0,function*(){const[,r]=Ot(t.pk,or);if(r===L.BLS12_381PublicKey){if(!t.proof)throw new ar("Proof is required to set a bls account as consensus key ")}else if(t.proof)throw new kt("Proof field is only allowed for a bls account as consensus key");const n=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.prepare.updateConsensusKey(t),s=yield this.calculateEstimates(i,n);if(i.opOb.contents[0].kind==="reveal"){s.shift();const o=i.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;s[0].opSize-=o}return ft.createEstimateInstanceFromProperties(s)})}updateCompanionKey(t){return p(this,void 0,void 0,function*(){const[,r]=Ot(t.pk,or);if(r!==L.BLS12_381PublicKey)throw new kt("companion key must be a bls account");if(!t.proof)throw new ar("Proof is required to set a bls account as companion key ");const n=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.prepare.updateCompanionKey(t),s=yield this.calculateEstimates(i,n);if(i.opOb.contents[0].kind==="reveal"){s.shift();const o=i.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;s[0].opSize-=o}return ft.createEstimateInstanceFromProperties(s)})}smartRollupAddMessages(t){return p(this,void 0,void 0,function*(){const r=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.smartRollupAddMessages(t),i=yield this.calculateEstimates(n,r);if(n.opOb.contents[0].kind==="reveal"){i.shift();const s=n.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;i[0].opSize-=s}return ft.createEstimateInstanceFromProperties(i)})}smartRollupOriginate(t){return p(this,void 0,void 0,function*(){const r=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.smartRollupOriginate(t),i=yield this.calculateEstimates(n,r);if(n.opOb.contents[0].kind==="reveal"){i.shift();const s=n.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;i[0].opSize-=s}return ft.createEstimateInstanceFromProperties(i)})}smartRollupExecuteOutboxMessage(t){return p(this,void 0,void 0,function*(){const r=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.smartRollupExecuteOutboxMessage(t),i=yield this.calculateEstimates(n,r);return n.opOb.contents[0].kind==="reveal"&&i.shift(),ft.createEstimateInstanceFromProperties(i)})}contractCall(t){return p(this,void 0,void 0,function*(){const r=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.contractCall(t),i=yield this.calculateEstimates(n,r);if(n.opOb.contents[0].kind==="reveal"){i.shift();const s=n.opOb.contents[0].source.startsWith(L.BLS12_381PublicKeyHash)?this.REVEAL_LENGTH_TZ4/2:this.REVEAL_LENGTH/2;i[0].opSize-=s}return ft.createEstimateInstanceFromProperties(i)})}}class ds extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="delegation"),r=t&&t.metadata&&t.metadata.operation_result;return r||void 0}get status(){var t,r;return(r=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&r!==void 0?r:"unknown"}get delegate(){return this.params.delegate}get isRegisterOperation(){return this.delegate===this.source}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),this.consumedMilliGas?new I(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Vu extends Lt{constructor(t,r,n,i,s,o){super(t,n,i,s),this.params=r,this.contractProvider=o;const a=this.operationResults&&this.operationResults.originated_contracts;Array.isArray(a)&&(this.contractAddress=a[0])}get status(){var t,r;return(r=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&r!==void 0?r:"unknown"}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="origination"),r=t&&Lr(t)&&t.metadata.operation_result;return r||void 0}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),this.consumedMilliGas?new I(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get storageDiff(){const t=this.operationResults&&this.operationResults.paid_storage_size_diff;return t||void 0}get storageSize(){const t=this.operationResults&&this.operationResults.storage_size;return t||void 0}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}contract(t,r){return p(this,void 0,void 0,function*(){if(!this.contractAddress)throw new Em("No contract was originated in this operation");return yield this.confirmation(t,r),this.contractProvider.at(this.contractAddress)})}}class Zu extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n,this.globalConstantHash=this.operationResults&&this.operationResults.global_address}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="register_global_constant"),r=t&&t.metadata&&t.metadata.operation_result;return r||void 0}get status(){var t,r;return(r=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&r!==void 0?r:"unknown"}get registeredExpression(){return this.params.value}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),this.consumedMilliGas?new I(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class zu extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(r=>r.kind==="reveal");return t?[t]:[]}get status(){const r=this.operationResults[0];return r?r.metadata.operation_result.status:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get publicKey(){return this.params.public_key}get proof(){if(this.params.proof)return this.params.proof;throw new kt("Only BLS key has proof")}sumProp(t,r){return t.reduce((n,i)=>r in i?Number(i[r])+n:n,0)}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),new I(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(ve({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(ve({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(ve({contents:this.operationResults}),"storage_size"))}get errors(){return Zr({contents:this.operationResults})}}class tn extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(r=>r.kind==="transaction");return t?[t]:[]}get status(){const r=this.operationResults[0];return r?r.metadata.operation_result.status:"unknown"}get amount(){return new I(this.params.amount)}get destination(){return this.params.destination}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}sumProp(t,r){return t.reduce((n,i)=>r in i?Number(i[r])+n:n,0)}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),new I(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(ve({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(ve({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(ve({contents:this.operationResults}),"storage_size"))}get errors(){return Zr({contents:this.operationResults})}}class Wu extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="increase_paid_storage"),r=t&&t.metadata&&t.metadata.operation_result;return r||void 0}get status(){var t,r;return(r=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&r!==void 0?r:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get amount(){return this.params.amount}get destination(){return this.params.destination}}class Ju extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="update_consensus_key"),r=t&&t.metadata&&t.metadata.operation_result;return r||void 0}get status(){var t,r;return(r=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&r!==void 0?r:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get pk(){return this.params.pk}get proof(){if(this.params.proof)return this.params.proof;throw new kt("Only updating consensus key to a BLS account has proof")}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class qu extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="update_companion_key"),r=t&&t.metadata&&t.metadata.operation_result;return r||void 0}get status(){var t,r;return(r=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&r!==void 0?r:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get pk(){return this.params.pk}get proof(){if(this.params.proof)return this.params.proof;throw new kt("Only updating companion key to a BLS account has proof")}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Yu extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="smart_rollup_add_messages"),r=t&&t.metadata&&t.metadata.operation_result;return r||void 0}get status(){var t,r;return(r=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&r!==void 0?r:"unknown"}get message(){return this.params.message}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Xu extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind===_.SMART_ROLLUP_ORIGINATE),r=t&&t.metadata&&t.metadata.operation_result;return r||void 0}get status(){var t,r;return(r=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&r!==void 0?r:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get pvmKind(){return this.params.pvm_kind}get kernel(){return this.params.kernel}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Qu extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const r=Array.isArray(this.results)&&this.results.find(n=>n.kind==="ballot");return r||void 0}get period(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.period}get proposal(){return this.params.proposal}get ballot(){return this.params.ballot}}class tl extends Lt{constructor(t,r,n,i,s){super(t,n,i,s),this.params=r}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind==="drain_delegate"),r=t&&t.metadata&&t.metadata.balance_updates;return r||void 0}get consensusKey(){return this.params.consensus_key}get delegate(){return this.params.delegate}get destination(){return this.params.destination}}class el extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const r=Array.isArray(this.results)&&this.results.find(n=>n.kind==="proposals");return r||void 0}get proposals(){return this.params.proposals}get period(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.period}}class rl extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind===_.TRANSFER_TICKET),r=t&&t.metadata&&t.metadata.operation_result;return r||void 0}get status(){var t,r;return(r=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&r!==void 0?r:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return I.config({DECIMAL_PLACES:0,ROUNDING_MODE:I.ROUND_UP}),this.consumedMilliGas?new I(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}}class Vm extends Lt{constructor(t,r,n,i,s,o){super(t,i,s,o),this.params=r,this.source=n}get operationResults(){const t=Array.isArray(this.results)&&this.results.find(n=>n.kind===_.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE),r=t&&t.metadata&&t.metadata.operation_result;return r||void 0}get status(){var t,r;return(r=(t=this.operationResults)===null||t===void 0?void 0:t.status)!==null&&r!==void 0?r:"unknown"}get rollup(){return this.params.rollup}get cementedCommitment(){return this.params.cemented_commitment}get outputProof(){return this.params.output_proof}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.consumed_milligas}get errors(){var t;return(t=this.operationResults)===null||t===void 0?void 0:t.errors}}class Zm extends _n{constructor(t,r){super(t),this.estimator=r,this.contractProviderTypeSymbol=Symbol.for("taquito-contract-provider-type-symbol"),this.prepare=new Wr(this.context)}getStorage(t,r){return p(this,void 0,void 0,function*(){const n=Mr(t);if(n!==T.VALID)throw new rr(t,n);const i=yield this.context.readProvider.getScript(t,"head");r||(r=i);let s;return Zt.isSchema(r)?s=r:s=Zt.fromRPCResponse({script:r}),s.Execute(i.storage,hs(this))})}getBigMapKey(t,r,n){return p(this,void 0,void 0,function*(){const i=Mr(t);if(i!==T.VALID)throw new rr(t,i);n||(n=(yield this.rpc.getContract(t)).script);let s;Zt.isSchema(n)?s=n:s=Zt.fromRPCResponse({script:n});const o=s.EncodeBigMapKey(r),a=yield this.rpc.getBigMapKey(t,o);return s.ExecuteOnBigMapValue(a)})}getBigMapKeyByID(t,r,n,i){return p(this,void 0,void 0,function*(){const{key:s,type:o}=n.EncodeBigMapKey(r),{packed:a}=yield this.context.packer.packData({data:s,type:o}),c=Sl(a),u=i?yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},i):yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:c},"head");return n.ExecuteOnBigMapValue(u,hs(this))})}getBigMapKeysByID(t,r,n,i){return p(this,arguments,void 0,function*(s,o,a,c,u=5){const l=yield this.getBlockForRequest(o,c),g=new Gt;let E=0,y=[];for(;E<o.length;){const P=o.slice(E,E+u).map(O=>this.getBigMapValueOrUndefined(O,s,a,l));y=[...y,...yield Promise.all(P)],E+=u}for(let v=0;v<y.length;v++)g.set(o[v],y[v]);return g})}getBlockForRequest(t,r){return p(this,void 0,void 0,function*(){return t.length===1||typeof r<"u"?r:yield this.context.readProvider.getBlockLevel("head")})}getBigMapValueOrUndefined(t,r,n,i){return p(this,void 0,void 0,function*(){try{return yield this.getBigMapKeyByID(r,t,n,i)}catch(s){if(s instanceof Pr&&s.status===an.NOT_FOUND)return;throw s}})}getSaplingDiffByID(t,r){return p(this,void 0,void 0,function*(){return r?yield this.context.readProvider.getSaplingDiffById({id:t.toString()},r):yield this.context.readProvider.getSaplingDiffById({id:t.toString()},"head")})}originate(t){return p(this,void 0,void 0,function*(){const r=yield this.estimate(t,this.estimator.originate.bind(this.estimator)),n=yield this.prepare.originate(Object.assign(Object.assign({},t),r)),i=n.opOb.contents.find(l=>l.kind===_.ORIGINATION),s=yield this.forge(n),{hash:o,context:a,forgedBytes:c,opResponse:u}=yield this.signAndInject(s);return new Vu(o,i,c,u,a,this)})}setDelegate(t){return p(this,void 0,void 0,function*(){var r;const n=K(t.source);if(t.source&&n!==T.VALID)throw new F(t.source,n);const i=K((r=t.delegate)!==null&&r!==void 0?r:"");if(t.delegate&&i!==T.VALID)throw new F(t.delegate,i);if(/^kt1/i.test(t.source))throw new fu(t.source);const s=yield this.signer.publicKeyHash(),o=t.source||s,a=yield this.estimate(t,this.estimator.setDelegate.bind(this.estimator)),c=yield this.prepare.delegation(Object.assign(Object.assign({},t),a)),u=c.opOb.contents.find(P=>P.kind===_.DELEGATION),l=yield this.forge(c),{hash:g,context:E,forgedBytes:y,opResponse:v}=yield this.signAndInject(l);return new ds(g,u,o,y,v,E)})}registerDelegate(t){return p(this,void 0,void 0,function*(){const r=yield this.estimate(t,this.estimator.registerDelegate.bind(this.estimator)),n=yield this.signer.publicKeyHash(),i=yield this.prepare.registerDelegate(Object.assign(Object.assign({},t),r)),s=i.opOb.contents.find(g=>g.kind===_.DELEGATION),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new ds(a,s,n,u,l,c)})}transfer(t){return p(this,void 0,void 0,function*(){var r;const n=K(t.to);if(n!==T.VALID)throw new F(t.to,n);const i=K((r=t.source)!==null&&r!==void 0?r:"");if(t.source&&i!==T.VALID)throw new F(t.source,i);if(t.amount<0)throw new Be(t.amount.toString());const s=yield this.signer.publicKeyHash(),o=yield this.estimate(t,this.estimator.transfer.bind(this.estimator)),a=t.source||s,c=yield this.prepare.transaction(Object.assign(Object.assign({},t),o)),u=c.opOb.contents.find(P=>P.kind===_.TRANSACTION),l=yield this.forge(c),{hash:g,context:E,forgedBytes:y,opResponse:v}=yield this.signAndInject(l);return new tn(g,u,a,y,v,E)})}stake(t){return p(this,void 0,void 0,function*(){var r;const n=K((r=t.source)!==null&&r!==void 0?r:"");if(t.source&&n!==T.VALID)throw new F(t.source,n);if(t.to||(t.to=t.source),t.to&&t.to!==t.source)throw new Br(t.to);if(t.amount<0)throw new Be(t.amount.toString());const i=yield this.signer.publicKeyHash(),s=yield this.estimate(t,this.estimator.stake.bind(this.estimator)),o=t.source||i,a=yield this.prepare.stake(Object.assign(Object.assign({},t),s)),c=a.opOb.contents.find(v=>v.kind===_.TRANSACTION),u=yield this.forge(a),{hash:l,context:g,forgedBytes:E,opResponse:y}=yield this.signAndInject(u);return new tn(l,c,o,E,y,g)})}unstake(t){return p(this,void 0,void 0,function*(){var r;const n=K((r=t.source)!==null&&r!==void 0?r:"");if(t.source&&n!==T.VALID)throw new F(t.source,n);if(t.to||(t.to=t.source),t.to&&t.to!==t.source)throw new Br(t.to);if(t.amount<0)throw new Be(t.amount.toString());const i=yield this.signer.publicKeyHash(),s=yield this.estimate(t,this.estimator.unstake.bind(this.estimator)),o=t.source||i,a=yield this.prepare.unstake(Object.assign(Object.assign({},t),s)),c=a.opOb.contents.find(v=>v.kind===_.TRANSACTION),u=yield this.forge(a),{hash:l,context:g,forgedBytes:E,opResponse:y}=yield this.signAndInject(u);return new tn(l,c,o,E,y,g)})}finalizeUnstake(t){return p(this,void 0,void 0,function*(){var r;const n=K((r=t.source)!==null&&r!==void 0?r:"");if(t.source&&n!==T.VALID)throw new F(t.source,n);if(t.to||(t.to=t.source),t.amount||(t.amount=0),t.amount!==void 0&&t.amount>0)throw new Ra("Amount must be 0 to finalize unstake.");const i=yield this.signer.publicKeyHash(),s=yield this.estimate(t,this.estimator.finalizeUnstake.bind(this.estimator)),o=t.source||i,a=yield this.prepare.finalizeUnstake(Object.assign(Object.assign({},t),s)),c=a.opOb.contents.find(v=>v.kind===_.TRANSACTION),u=yield this.forge(a),{hash:l,context:g,forgedBytes:E,opResponse:y}=yield this.signAndInject(u);return new tn(l,c,o,E,y,g)})}transferTicket(t){return p(this,void 0,void 0,function*(){var r,n;const i=K(t.destination);if(i!==T.VALID)throw new F(t.destination,i);const s=K((r=t.source)!==null&&r!==void 0?r:"");if(t.source&&s!==T.VALID)throw new F(t.source,s);const o=yield this.signer.publicKeyHash(),a=(n=t.source)!==null&&n!==void 0?n:o,c=yield this.estimate(t,this.estimator.transferTicket.bind(this.estimator)),u=yield this.prepare.transferTicket(Object.assign(Object.assign({},t),c)),l=u.opOb.contents.find(O=>O.kind===_.TRANSFER_TICKET),g=yield this.forge(u),{hash:E,context:y,forgedBytes:v,opResponse:P}=yield this.signAndInject(g);return new rl(E,l,a,v,P,y)})}reveal(t){return p(this,void 0,void 0,function*(){const r=yield this.signer.publicKeyHash(),[,n]=Ot(r,nn);if(n===L.BLS12_381PublicKeyHash)if(t.proof)Ot(t.proof,[L.BLS12_381Signature]);else{const{prefixSig:s}=yield this.signer.provePossession();t.proof=s}else if(t.proof)throw new kt("Proof field is only allowed to reveal a bls account ");const i=yield this.estimator.reveal(t);if(i){const s=yield this.estimate(t,()=>p(this,void 0,void 0,function*(){return i})),o=yield this.prepare.reveal(Object.assign(Object.assign({},t),s)),a=o.opOb.contents.find(y=>y.kind===_.REVEAL),c=yield this.forge(o),{hash:u,context:l,forgedBytes:g,opResponse:E}=yield this.signAndInject(c);return new zu(u,a,r,g,E,l)}else throw new yu(`The publicKeyHash '${r}' has already been revealed.`)})}registerGlobalConstant(t){return p(this,void 0,void 0,function*(){const r=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.registerGlobalConstant.bind(this.estimator)),i=yield this.prepare.registerGlobalConstant(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(g=>g.kind===_.REGISTER_GLOBAL_CONSTANT),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new Zu(a,s,r,u,l,c)})}increasePaidStorage(t){return p(this,void 0,void 0,function*(){if(t.amount<0)throw new Be(t.amount.toString());const r=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.increasePaidStorage.bind(this.estimator)),i=yield this.prepare.increasePaidStorage(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(g=>g.kind===_.INCREASE_PAID_STORAGE),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new Wu(a,s,r,u,l,c)})}drainDelegate(t){return p(this,void 0,void 0,function*(){const r=yield this.prepare.drainDelegate(t),n=r.opOb.contents.find(u=>u.kind===_.DRAIN_DELEGATE),i=yield this.forge(r),{hash:s,context:o,forgedBytes:a,opResponse:c}=yield this.signAndInject(i);return new tl(s,n,a,c,o)})}ballot(t){return p(this,void 0,void 0,function*(){var r,n;const i=yield this.signer.publicKeyHash(),s=K((r=t.source)!==null&&r!==void 0?r:"");if(t.source&&s!==T.VALID)throw new F(t.source,s);const o=(n=t.source)!==null&&n!==void 0?n:i,a=yield this.prepare.ballot(Object.assign(Object.assign({},t),{source:o})),c=a.opOb.contents.find(v=>v.kind===_.BALLOT),u=yield this.forge(a),{hash:l,context:g,forgedBytes:E,opResponse:y}=yield this.signAndInject(u);return new Qu(l,c,i,E,y,g)})}proposals(t){return p(this,void 0,void 0,function*(){var r,n;const i=yield this.signer.publicKeyHash(),s=K((r=t.source)!==null&&r!==void 0?r:"");if(t.source&&s!==T.VALID)throw new F(t.source,s);const o=(n=t.source)!==null&&n!==void 0?n:i,a=yield this.prepare.proposals(Object.assign(Object.assign({},t),{source:o})),c=a.opOb.contents.find(v=>v.kind===_.PROPOSALS),u=yield this.forge(a),{hash:l,context:g,forgedBytes:E,opResponse:y}=yield this.signAndInject(u);return new el(l,c,i,E,y,g)})}updateConsensusKey(t){return p(this,void 0,void 0,function*(){const r=yield this.signer.publicKeyHash(),[,n]=Ot(t.pk,or);if(n===L.BLS12_381PublicKey){if(!t.proof)throw new ar("Proof is required to set a bls account as consensus key ")}else if(t.proof)throw new kt("Proof field is only allowed for a bls account as consensus key");const i=yield this.estimate(t,this.estimator.updateConsensusKey.bind(this.estimator)),s=yield this.prepare.updateConsensusKey(Object.assign(Object.assign({},t),i)),o=s.opOb.contents.find(E=>E.kind===_.UPDATE_CONSENSUS_KEY),a=yield this.forge(s),{hash:c,context:u,forgedBytes:l,opResponse:g}=yield this.signAndInject(a);return new Ju(c,o,r,l,g,u)})}updateCompanionKey(t){return p(this,void 0,void 0,function*(){const r=yield this.signer.publicKeyHash(),[,n]=Ot(t.pk,or);if(n!==L.BLS12_381PublicKey)throw new kt("Proof field is only allowed for a bls account as companion key");if(!t.proof)throw new ar("Proof is required to set a bls account as companion key ");const i=yield this.estimate(t,this.estimator.updateCompanionKey.bind(this.estimator)),s=yield this.prepare.updateCompanionKey(Object.assign(Object.assign({},t),i)),o=s.opOb.contents.find(E=>E.kind===_.UPDATE_COMPANION_KEY),a=yield this.forge(s),{hash:c,context:u,forgedBytes:l,opResponse:g}=yield this.signAndInject(a);return new qu(c,o,r,l,g,u)})}smartRollupAddMessages(t){return p(this,void 0,void 0,function*(){const r=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.smartRollupAddMessages.bind(this.estimator)),i=yield this.prepare.smartRollupAddMessages(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(g=>g.kind===_.SMART_ROLLUP_ADD_MESSAGES),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new Yu(a,s,r,u,l,c)})}smartRollupOriginate(t){return p(this,void 0,void 0,function*(){const r=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.smartRollupOriginate.bind(this.estimator)),i=yield this.prepare.smartRollupOriginate(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(g=>g.kind===_.SMART_ROLLUP_ORIGINATE),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new Xu(a,s,r,u,l,c)})}smartRollupExecuteOutboxMessage(t){return p(this,void 0,void 0,function*(){const r=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.smartRollupExecuteOutboxMessage.bind(this.estimator)),i=yield this.prepare.smartRollupExecuteOutboxMessage(Object.assign(Object.assign({},t),n)),s=i.opOb.contents.find(g=>g.kind===_.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE),o=yield this.forge(i),{hash:a,context:c,forgedBytes:u,opResponse:l}=yield this.signAndInject(o);return new Vm(a,s,r,u,l,c)})}failingNoop(t){return p(this,void 0,void 0,function*(){const r={kind:_.FAILING_NOOP,arbitrary:t.arbitrary},n=yield this.context.readProvider.getBlockHash(t.basedOnBlock),i=yield this.context.forger.forge({branch:n,contents:[r]}),{prefixSig:s}=yield this.signer.sign(i,new Uint8Array([3]));return{signature:s,bytes:i,signedContent:{branch:n,contents:[{kind:_.FAILING_NOOP,arbitrary:t.arbitrary}]}}})}at(t){return p(this,arguments,void 0,function*(r,n=i=>i){const i=Mr(r);if(i!==T.VALID)throw new rr(r,i);const s=this.context.withExtensions().rpc,o=this.context.withExtensions().readProvider,a=yield o.getScript(r,"head"),c=yield o.getEntrypoints(r),u=new go(r,a,this,this,c,s,o);return n(u,this.context)})}batch(t){const r=new mo(this.context,this.estimator);return Array.isArray(t)&&r.with(t),r}}class yo{constructor(t){this.context=t}getNextProto(){return p(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}parseScript(t){return p(this,void 0,void 0,function*(){return new _r({protocol:yield this.getNextProto()}).parseScript(t)})}parseMichelineExpression(t){return p(this,void 0,void 0,function*(){return new _r({protocol:yield this.getNextProto()}).parseMichelineExpression(t)})}parseJSON(t){return p(this,void 0,void 0,function*(){return new _r({protocol:yield this.getNextProto()}).parseJSON(t)})}prepareCodeOrigination(t){return p(this,void 0,void 0,function*(){const r=t;if(r.code=yield this.formatCodeParam(t.code),t.init)r.init=yield this.formatInitParam(t.init);else if(t.storage){const n=r.code.find(o=>"prim"in o&&o.prim==="storage");if(!n?.args)throw new pn("The storage section is missing from the script",t.code);const i=new Zt(n.args[0]),s=yield this.findGlobalConstantsHashAndValue(i);if(Object.keys(s).length!==0){const a=new _r({expandGlobalConstant:s}).parseJSON(n.args[0]),c=new Zt(a);r.init=c.Encode(t.storage)}else r.init=i.Encode(t.storage);delete r.storage}return r})}formatCodeParam(t){return p(this,void 0,void 0,function*(){let r;if(typeof t=="string"){const n=yield this.parseScript(t);if(n===null)throw new pn("Unable to parse",t);r=n}else{const n=yield this.parseJSON(t),i=["parameter","storage","code"];r=n.sort((s,o)=>i.indexOf(s.prim)-i.indexOf(o.prim))}return r})}formatInitParam(t){return p(this,void 0,void 0,function*(){let r;if(typeof t=="string"){const n=yield this.parseMichelineExpression(t);if(n===null)throw new lo("Invalid init parameter",t);r=n}else r=yield this.parseJSON(t);return r})}findGlobalConstantsHashAndValue(t){return p(this,void 0,void 0,function*(){const r=t.findToken("constant"),n={};if(r.length!==0)for(const i of r){const s=i.tokenVal.args;if(s){const o=s[0];if(o.string){const a=o.string,c=yield this.context.globalConstantsProvider.getGlobalConstantByHash(a);Object.assign(n,{[a]:c})}}}return n})}}class Eo{constructor(t){this.context=t}packData(t){return p(this,void 0,void 0,function*(){return this.context.rpc.packData(t)})}}class nl extends at{constructor(t){super(),this.hash=t,this.name="GlobalConstantNotFound",this.message=`Please load the value associated with the constant ${t} using the loadGlobalConstant method of the DefaultGlobalConstantsProvider.`}}class il extends ei{constructor(){super(),this.name="UnconfiguredGlobalConstantsProviderError",this.message="No global constants provider has been configured. Please configure one by calling setGlobalConstantsProvider({globalConstantsProvider}) on your TezosToolkit instance."}}class sl{getGlobalConstantByHash(t){return p(this,void 0,void 0,function*(){throw new il})}}class _o{constructor(t){this.rpc=t}getBalance(t,r){return p(this,void 0,void 0,function*(){return this.rpc.getBalance(t,{block:String(r)})})}getSpendable(t,r){return p(this,void 0,void 0,function*(){return this.rpc.getSpendable(t,{block:String(r)})})}getDelegate(t,r){return p(this,void 0,void 0,function*(){return this.rpc.getDelegate(t,{block:String(r)})})}getNextProtocol(t){return p(this,void 0,void 0,function*(){return(yield this.rpc.getProtocols({block:String(t)})).next_protocol})}getProtocolConstants(t){return p(this,void 0,void 0,function*(){const{time_between_blocks:r,minimal_block_delay:n,hard_gas_limit_per_operation:i,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,smart_rollup_origination_size:c}=yield this.rpc.getConstants({block:String(t)});return{time_between_blocks:r,minimal_block_delay:n,hard_gas_limit_per_operation:i,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:o,cost_per_byte:a,smart_rollup_origination_size:c}})}getScript(t,r){return p(this,void 0,void 0,function*(){const{script:n}=yield this.rpc.getContract(t,{block:String(r)});return n})}getStorage(t,r){return p(this,void 0,void 0,function*(){return this.rpc.getStorage(t,{block:String(r)})})}getBlockHash(t){return p(this,void 0,void 0,function*(){const{hash:r}=yield this.rpc.getBlockHeader({block:String(t)});return r})}getBlockLevel(t){return p(this,void 0,void 0,function*(){const{level:r}=yield this.rpc.getBlockHeader({block:String(t)});return r})}getCounter(t,r){return p(this,void 0,void 0,function*(){const{counter:n}=yield this.rpc.getContract(t,{block:String(r)});return n||"0"})}getBlockTimestamp(t){return p(this,void 0,void 0,function*(){const{timestamp:r}=yield this.rpc.getBlockHeader({block:String(t)});return r})}getBigMapValue(t,r){return p(this,void 0,void 0,function*(){return this.rpc.getBigMapExpr(t.id,t.expr,{block:String(r)})})}getSaplingDiffById(t,r){return p(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffById(t.id,{block:String(r)})})}getSaplingDiffByContract(t,r){return p(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffByContract(t,{block:String(r)})})}getEntrypoints(t){return p(this,void 0,void 0,function*(){return this.rpc.getEntrypoints(t)})}getChainId(){return p(this,void 0,void 0,function*(){return this.rpc.getChainId()})}isAccountRevealed(t,r){return p(this,void 0,void 0,function*(){const n=yield this.rpc.getManagerKey(t,{block:String(r)});return n&&typeof n=="object"?!!n.key:!!n})}getBlock(t){return p(this,void 0,void 0,function*(){return this.rpc.getBlock({block:String(t)})})}getLiveBlocks(t){return this.rpc.getLiveBlocks({block:String(t)})}getAdaptiveIssuanceLaunchCycle(t){return this.rpc.getAdaptiveIssuanceLaunchCycle({block:String(t)})}}class ma extends q{constructor(t){super(),this.type=t,this.name="UnsupportedEventError",this.message=`Unsupported event type "${t}" expecting one of the "data", "error", or "close".`}}class zm extends q{constructor(t){super(),this.invalidExpression=t,this.name="InvalidFilterExpressionError",this.message="Invalid filter expression expecting the object to contain either and/or property"}}const Wm=(e,t)=>e.hash===t.opHash,Jm=(e,t)=>{switch(e.kind){case"attestation":return"metadata"in e&&e.metadata.delegate===t.source;case"activate_account":return"metadata"in e&&e.pkh===t.source;default:return"source"in e&&e.source===t.source}},qm=(e,t)=>"kind"in e&&e.kind===t.kind,Ym=(e,t)=>{switch(e.kind){case"delegation":return e.delegate===t.destination;case"origination":if("metadata"in e&&"operation_result"in e.metadata&&"originated_contracts"in e.metadata.operation_result&&Array.isArray(e.metadata.operation_result.originated_contracts))return e.metadata.operation_result.originated_contracts.some(r=>r===t.destination);break;case"transaction":return e.destination===t.destination;default:return!1}},Xm=(e,t,r,n)=>!(e.kind!=="event"||r&&e.tag!==r||t&&e.source!==t||n&&e.result.status!=="applied"),Qm=(e,t)=>"opHash"in t?Wm(e,t):"source"in t?Jm(e,t):"kind"in t?qm(e,t):"destination"in t?Ym(e,t):!1,t0=(e,t)=>{if(Array.isArray(t.and))return t.and.every(r=>ps(e,r));if(Array.isArray(t.or))return t.or.some(r=>ps(e,r));throw new zm(t)},ps=(e,t)=>{const r=[];return Array.isArray(t)?r.push(...t):r.push(t),r.every(n=>"and"in n||"or"in n?t0(e,n):Qm(e,n))};class en{constructor(t,r=!1,n=rc()){this.shouldRetry=r,this.operatorFunction=n,this.errorListeners=[],this.messageListeners=[],this.closeListeners=[],this.completed$=new yn,t.pipe(xh(this.completed$),Kn(i=>{this.call(this.messageListeners,i)},i=>{this.call(this.errorListeners,i)},()=>{this.call(this.closeListeners)}),this.shouldRetry?n:Kn(),oi(()=>Ph)).subscribe()}call(t,r){for(const n of t)try{n(r)}catch(i){console.error(i)}}remove(t,r){const n=t.indexOf(r);n!==-1&&t.splice(n,1)}on(t,r){switch(t){case"data":this.messageListeners.push(r);break;case"error":this.errorListeners.push(r);break;case"close":this.closeListeners.push(r);break;default:throw new ma(t)}}off(t,r){switch(t){case"data":this.remove(this.messageListeners,r);break;case"error":this.remove(this.errorListeners,r);break;case"close":this.remove(this.closeListeners,r);break;default:throw new ma(t)}}close(){this.completed$.next()}}const e0={shouldObservableSubscriptionRetry:!1,observableSubscriptionRetryFunction:rc()},r0=e=>pr(e.rpc.getBlock()).pipe(Me()),n0=e=>En(t=>new _t(r=>{for(const n of t.operations)for(const i of n)for(const s of i.contents)ps(Object.assign({hash:i.hash},s),e)&&r.next(Object.assign({hash:i.hash},s));r.complete()})),i0=e=>En(t=>new _t(r=>{for(const n of t.operations)for(const i of n)for(const s of i.contents){const a=s.metadata.internal_operation_results;if(a)for(const c of a)Xm(c,e?.address,e?.tag,e?.excludeFailedOperations)&&r.next(Object.assign({opHash:i.hash,blockHash:t.hash,level:t.header.level},c))}r.complete()}));class Yn{constructor(t,r={}){this.context=t,this._config$=new ni(Object.assign(Object.assign({},e0),r)),this.timer$=this._config$.pipe(nr(n=>n?.pollingIntervalMilliseconds),$e(n=>n?zi(0,n):pr(this.getConfirmationPollingInterval()).pipe($e(i=>zi(0,i))))),this.newBlock$=this.timer$.pipe($e(()=>r0(this.context)),Th("hash"),ln({resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0}))}get config(){return this._config$.getValue()}getConfirmationPollingInterval(){return p(this,void 0,void 0,function*(){if(!this.config.pollingIntervalMilliseconds)try{const n=yield this.context.readProvider.getProtocolConstants("head"),s=(n.minimal_block_delay?n.minimal_block_delay.multipliedBy(1e3):new I(5e3)).dividedBy(3);this.config.pollingIntervalMilliseconds=s.toNumber()===0?1e3:s.toNumber()}catch{return 5e3}return this.config.pollingIntervalMilliseconds})}subscribeBlock(t){return new en(this.newBlock$,this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribe(t){return new en(this.newBlock$.pipe(nr(r=>r?.hash)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeOperation(t){return new en(this.newBlock$.pipe(n0(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeEvent(t){return new en(this.newBlock$.pipe(i0(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}}class bo{constructor(t){this.context=t}getNextProto(){return p(this,void 0,void 0,function*(){if(!this.context.proto){const t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}forge(t){return p(this,arguments,void 0,function*({branch:r,contents:n}){return new lu(yield this.getNextProto()).forge({branch:r,contents:n})})}}const ol={defaultConfirmationCount:1,confirmationPollingTimeoutSecond:180};class fn{constructor(t,r=new ss,n,i=new ni(Object.assign({},ol)),s,o,a,c,u,l,g,E){this._rpc=t,this._signer=r,this._proto=n,this._config=i,this.providerDecorator=[],this.tz=new Gm(this),this.estimate=new Fu(this),this.contract=new Zm(this,this.estimate),this.prepare=new Wr(this),this.batch=new Hm(this,this.estimate),this.wallet=new bn(this),this.withExtensions=()=>{let y=this.clone();return this.providerDecorator.forEach(v=>{y=v(y)}),y},typeof this._rpc=="string"?this._rpcClient=new xn(this._rpc):this._rpcClient=this._rpc,this._forger=s||new bo(this),this._injector=o||new co(this),this.operationFactory=new Um(this),this._walletProvider=c||new fo(this),this._parser=u||new yo(this),this._packer=a||new Eo(this),this._globalConstantsProvider=l||new sl,this._readProvider=g||new _o(this._rpcClient),this._stream=E||new Yn(this)}get config(){return this._config.getValue()}set config(t){this._config.next(Object.assign({},t))}setPartialConfig(t){this._config.next(Object.assign(Object.assign({},this._config.getValue()),t))}get rpc(){return this._rpcClient}set rpc(t){this._rpcClient=t}get injector(){return this._injector}set injector(t){this._injector=t}get forger(){return this._forger}set forger(t){this._forger=t}get signer(){return this._signer}set signer(t){this._signer=t}get walletProvider(){return this._walletProvider}set walletProvider(t){this._walletProvider=t}set proto(t){this._proto=t}get proto(){return this._proto}get parser(){return this._parser}set parser(t){this._parser=t}get packer(){return this._packer}set packer(t){this._packer=t}get globalConstantsProvider(){return this._globalConstantsProvider}set globalConstantsProvider(t){this._globalConstantsProvider=t}get readProvider(){return this._readProvider}set readProvider(t){this._readProvider=t}get stream(){return this._stream}set stream(t){this._stream=t}isAnyProtocolActive(){return p(this,arguments,void 0,function*(t=[]){if(this._proto)return t.includes(this._proto);{const r=yield this.readProvider.getNextProtocol("head");return t.includes(r)}})}isAnySignerConfigured(){return!(this.signer instanceof ss)}clone(){return new fn(this.rpc,this.signer,this.proto,this._config,this.forger,this._injector,this.packer,this._walletProvider,this._parser,this._globalConstantsProvider,this._readProvider,this._stream)}registerProviderDecorator(t){this.providerDecorator.push(t)}}const s0={commitHash:"20b6624f217ec85f28023ca02b2d3b73777a8df9",version:"23.0.2"};class o0 extends at{constructor(t){super(),this.results=t,this.name="ForgingMismatchError",this.message="Forging mismatch error"}}class ya extends ei{constructor(){super(),this.name="UnspecifiedForgerError",this.message="No forger has been configured. Please configure new CompositeForger([rpcForger, localForger]) with your TezosToolkit instance."}}class a0{constructor(t){if(this.forgers=t,t.length===0)throw new ya}forge(t){return p(this,arguments,void 0,function*({branch:r,contents:n}){const i=yield Promise.all(this.forgers.map(o=>o.forge({branch:r,contents:n})));if(i.length===0)throw new ya;let s=i.pop();for(;i.length;){const o=i.pop();if(o!==s)throw new o0([s,o]);s=o}return s})}}class c0{constructor(t){this.context=t}forge({branch:t,contents:r}){return this.context.rpc.forgeOperations({branch:t,contents:r})}}class u0{prepareCodeOrigination(t){return p(this,void 0,void 0,function*(){return t})}}class l0{packData(t){return p(this,void 0,void 0,function*(){const{bytes:r}=np(t.data,t.type);return{packed:r}})}}class h0{constructor(){this._globalConstantsLibrary={}}loadGlobalConstant(t){for(const r in t)Object.assign(this._globalConstantsLibrary,{[r]:t[r]})}getGlobalConstantByHash(t){return p(this,void 0,void 0,function*(){const r=this._globalConstantsLibrary[t];if(!r)throw new nl(t);return r})}}class d0{constructor(t){this._rpc=t,this._options={},this.format=Es,typeof this._rpc=="string"?this._rpcClient=new xn(this._rpc):this._rpcClient=this._rpc,this._context=new fn(t),this._wallet=new bn(this._context),this.setProvider({rpc:this._rpcClient}),this.batch=this._context.batch.batch.bind(this._context.batch)}setProvider({rpc:t,stream:r,signer:n,protocol:i,config:s,forger:o,wallet:a,packer:c,globalConstantsProvider:u,readProvider:l,parserProvider:g,injectorProvider:E}){this.setRpcProvider(t),this.setStreamProvider(r),this.setSignerProvider(n),this.setForgerProvider(o),this.setWalletProvider(a),this.setPackerProvider(c),this.setGlobalConstantsProvider(u),this.setReadProvider(l),this.setParserProvider(g),this.setInjectorProvider(E),this._context.proto=i,s&&this._context.setPartialConfig(s)}setSignerProvider(t){!this._options.signer&&typeof t>"u"?(this._context.signer=new ss,this._options.signer=t):typeof t<"u"&&(this._context.signer=t,this._options.signer=t)}setRpcProvider(t){typeof t=="string"?this._rpcClient=new xn(t):t===void 0||(this._rpcClient=t),this._options.rpc=this._rpcClient,this._context.rpc=this._rpcClient}setForgerProvider(t){if(typeof t<"u")this._options.forger=t,this._context.forger=t;else if(this._options.forger===void 0){const r=this.getFactory(bo)();this._options.forger=r,this._context.forger=r}}setStreamProvider(t){if(typeof t=="string"){const r=new Yn(new fn(new xn(t)));this._options.stream=r,this._context.stream=r}else if(typeof t<"u")this._options.stream=t,this._context.stream=t;else if(this._options.stream===void 0){const r=this.getFactory(Yn)();this._options.stream=r,this._context.stream=r}}setWalletProvider(t){if(!this._options.wallet&&typeof t>"u"){const r=this.getFactory(fo)();this._options.wallet=r,this._context.walletProvider=r}else typeof t<"u"&&(this._options.wallet=t,this._context.walletProvider=t)}setPackerProvider(t){if(!this._options.packer&&typeof t>"u"){const r=this.getFactory(Eo)();this._context.packer=r,this._options.packer=r}else typeof t<"u"&&(this._context.packer=t,this._options.packer=t)}setGlobalConstantsProvider(t){if(!this._options.globalConstantsProvider&&typeof t>"u"){const r=new sl;this._context.globalConstantsProvider=r,this._options.globalConstantsProvider=r}else typeof t<"u"&&(this._context.globalConstantsProvider=t,this._options.globalConstantsProvider=t)}setReadProvider(t){const r=t||new _o(this._context.rpc);this._options.readProvider=r,this._context.readProvider=r}setParserProvider(t){if(!this._options.parserProvider&&typeof t>"u"){const r=new yo(this._context);this._context.parser=r,this._options.parserProvider=r}else typeof t<"u"&&(this._context.parser=t,this._options.parserProvider=t)}setInjectorProvider(t){if(!this._options.injectorProvider&&typeof t>"u"){const r=new co(this._context);this._context.injector=r,this._options.injectorProvider=r}else typeof t<"u"&&(this._context.injector=t,this._options.injectorProvider=t)}setFieldNumberingStrategy(t){st.fieldNumberingStrategy=t}get tz(){return this._context.tz}get contract(){return this._context.contract}get prepare(){return this._context.prepare}get wallet(){return this._wallet}get operation(){return this._context.operationFactory}get estimate(){return this._context.estimate}get stream(){return this._context.stream}get rpc(){return this._context.rpc}get signer(){return this._context.signer}get globalConstants(){return this._context.globalConstantsProvider}addExtension(t){Array.isArray(t)?t.forEach(r=>r.configureContext(this._context)):t.configureContext(this._context)}getFactory(t){return(...r)=>new t(this._context,...r)}getVersionInfo(){return s0}}const m0=Object.freeze(Object.defineProperty({__proto__:null,BallotOperation:Qu,BatchOperation:Nu,BigMapAbstraction:Gu,COST_PER_BYTE:du,get ChainIds(){return as},CompositeForger:a0,Context:fn,ContractAbstraction:go,ContractMethod:Bu,ContractMethodObject:Cu,ContractView:$u,DEFAULT_FEE:lm,DEFAULT_GAS_LIMIT:um,DEFAULT_SMART_CONTRACT_METHOD_NAME:vr,DEFAULT_STORAGE_LIMIT:hm,DefaultGlobalConstantsProvider:h0,DelegateOperation:ds,DelegationWalletOperation:Hu,DrainDelegateOperation:tl,Estimate:ft,GlobalConstantNotFound:nl,IncreasePaidStorageOperation:Wu,InvalidBalanceError:_u,InvalidCodeParameter:pn,InvalidDelegationSource:fu,InvalidEstimateValueError:Cn,InvalidInitParameter:lo,InvalidParameterError:uo,InvalidViewSimulationContext:us,LegacyWalletProvider:fo,MANAGER_LAMBDA:Lm,MichelCodecPacker:l0,MichelCodecParser:yo,MichelsonMap:Gt,NoopParser:u0,ORIGINATION_SIZE:dm,ObservableSubscription:en,get OpKind(){return _},Operation:Lt,OperationBatch:mo,OriginationOperation:Vu,OriginationParameterError:Eu,OriginationWalletOperation:Mu,PollingSubscribeProvider:Yn,PrepareProvider:Wr,ProposalsOperation:el,get Protocols(){return ot},REVEAL_STORAGE_LIMIT:os,RPCEstimateProvider:Fu,RegisterGlobalConstantOperation:Zu,RevealEstimateError:ju,RevealOperation:zu,RevealOperationError:yu,RpcForger:c0,RpcInjector:co,RpcPacker:Eo,RpcReadAdapter:_o,SaplingStateAbstraction:Uu,SmartRollupAddMessagesOperation:Yu,SmartRollupOriginateOperation:Xu,TaquitoLocalForger:bo,TezosOperationError:po,TezosPreapplyFailureError:Tu,TezosToolkit:d0,Token:st,TransactionOperation:tn,TransactionWalletOperation:ku,TransferTicketOperation:rl,TransferTicketWalletOperation:Du,UnconfiguredGlobalConstantsProviderError:il,UnitValue:Yi,UpdateCompanionKeyOperation:qu,UpdateConsensusKeyOperation:Ju,VIEW_LAMBDA:km,ViewSimulationError:gu,Wallet:bn,WalletOperation:fr,WalletOperationBatch:xu,attachKind:Re,compose:Mm,createActivationOperation:bu,createBallotOperation:Su,createDrainDelegateOperation:Au,createIncreasePaidStorageOperation:Ei,createOriginationOperation:fi,createProposalsOperation:Pu,createRegisterDelegateOperation:vu,createRegisterGlobalConstantOperation:mi,createRevealOperation:Dn,createSetDelegateOperation:gi,createSmartRollupAddMessagesOperation:vi,createSmartRollupExecuteOutboxMessageOperation:Si,createSmartRollupOriginateOperation:Ai,createTransferOperation:br,createTransferTicketOperation:yi,createUpdateCompanionKeyOperation:bi,createUpdateConsensusKeyOperation:_i,defaultConfigConfirmation:ol,findWithKind:ls,getRevealFee:cs,getRevealFeeInternal:pu,getRevealGasLimit:Jn,hasMetadata:Pi,hasMetadataWithInternalOperationResult:wu,hasMetadataWithResult:Lr,isKind:Ru,isOpRequireReveal:ho,isOpWithFee:qn,isOpWithGasBuffer:Ou,isSourceOp:mm,protocols:pm,smartContractAbstractionSemantic:hs,validateAndExtractFailwith:mu},Symbol.toStringTag,{value:"Module"}));export{Gu as B,Tl as H,_ as O,xr as P,an as S,gu as V,Pr as a,yi as b,br as c,Ei as d,fi as e,gi as f,Zt as g,Yn as h,g0 as l,m0 as t,mu as v};
