var Nr=Object.defineProperty;var Sr=(r,n,e)=>n in r?Nr(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e;var T=(r,n,e)=>Sr(r,typeof n!="symbol"?n+"":n,e);import{aX as Lr,aY as Or,aZ as ft,a_ as Tr,a$ as $r}from"./DULBIB-T.js";import{D as Ar,c as wr}from"./6hAC8Zkd.js";const Cr={},hr=(r,n)=>{Cr[r]=n},te=r=>{class n extends Error{constructor(i,l,o){super(i||r,o);T(this,"cause");if(Object.setPrototypeOf(this,n.prototype),this.name=r,l)for(const u in l)this[u]=l[u];if(o&&xr(o)&&"cause"in o&&!this.cause){const u=o.cause;this.cause=u,"stack"in u&&(this.stack=this.stack+`
CAUSE: `+u.stack)}}}return n};function xr(r){return typeof r=="object"}const _r=te("DisconnectedDevice"),Pr=te("DisconnectedDeviceDuringOperation"),ht=te("TransportOpenUserCancelled"),Dr=te("TransportRaceCondition");var Et;(function(r){r.Unknown="Unknown",r.LocationServicesDisabled="LocationServicesDisabled",r.LocationServicesUnauthorized="LocationServicesUnauthorized",r.BluetoothScanStartFailed="BluetoothScanStartFailed"})(Et||(Et={}));class k extends Error{constructor(e,s){const i="TransportError";super(e||i);T(this,"id");this.name=i,this.message=e,this.stack=new Error(e).stack,this.id=s}}hr("TransportError",r=>new k(r.message,r.id));const H={ACCESS_CONDITION_NOT_FULFILLED:38916,ALGORITHM_NOT_SUPPORTED:38020,CLA_NOT_SUPPORTED:28160,CODE_BLOCKED:38976,CODE_NOT_INITIALIZED:38914,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,CONDITIONS_OF_USE_NOT_SATISFIED:27013,CONTRADICTION_INVALIDATION:38928,CONTRADICTION_SECRET_CODE_STATUS:38920,DEVICE_IN_RECOVERY_MODE:26159,CUSTOM_IMAGE_EMPTY:26158,FILE_ALREADY_EXISTS:27273,FILE_NOT_FOUND:37892,GP_AUTH_FAILED:25344,HALTED:28586,INCONSISTENT_FILE:37896,INCORRECT_DATA:27264,INCORRECT_LENGTH:26368,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,DEVICE_NOT_ONBOARDED:27911,DEVICE_NOT_ONBOARDED_2:26129,INVALID_KCV:38021,INVALID_OFFSET:37890,LICENSING:28482,LOCKED_DEVICE:21781,MAX_VALUE_REACHED:38992,MEMORY_PROBLEM:37440,MISSING_CRITICAL_PARAMETER:26624,NO_EF_SELECTED:37888,NOT_ENOUGH_MEMORY_SPACE:27268,OK:36864,PIN_REMAINING_ATTEMPTS:25536,REFERENCED_DATA_NOT_FOUND:27272,SECURITY_STATUS_NOT_SATISFIED:27010,TECHNICAL_PROBLEM:28416,UNKNOWN_APDU:27906,USER_REFUSED_ON_DEVICE:21761,NOT_ENOUGH_SPACE:20738,APP_NOT_FOUND_OR_INVALID_CONTEXT:20771,INVALID_APP_NAME_LENGTH:26378,GEN_AES_KEY_FAILED:21529,INTERNAL_CRYPTO_OPERATION_FAILED:21530,INTERNAL_COMPUTE_AES_CMAC_FAILED:21531,ENCRYPT_APP_STORAGE_FAILED:21532,INVALID_BACKUP_STATE:26178,PIN_NOT_SET:21762,INVALID_BACKUP_LENGTH:26419,INVALID_RESTORE_STATE:26179,INVALID_CHUNK_LENGTH:26420,INVALID_BACKUP_HEADER:26698,TRUSTCHAIN_WRONG_SEED:45063};function yr(r){switch(r){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received";case 21781:return"Locked device"}if(28416<=r&&r<=28671)return"Internal error, please report"}class z extends Error{constructor(e,{canBeMappedToChildError:s=!0}={}){const i=Object.keys(H).find(a=>H[a]===e)||"UNKNOWN_ERROR",l=yr(e)||i,o=e.toString(16),u=`Ledger device: ${l} (0x${o})`;super(u);T(this,"statusCode");T(this,"statusText");if(this.name="TransportStatusError",this.statusCode=e,this.statusText=i,Object.setPrototypeOf(this,z.prototype),s&&e===H.LOCKED_DEVICE)return new nt(u)}}class nt extends z{constructor(n){super(H.LOCKED_DEVICE,{canBeMappedToChildError:!1}),n&&(this.message=n),this.name="LockedDeviceError",Object.setPrototypeOf(this,nt.prototype)}}hr("TransportStatusError",r=>new z(r.statusCode));let Er=0;const V=[],dt=(r,n,e)=>{const s={type:r,id:String(++Er),date:new Date};n&&(s.message=n),dr(s)},Ur=({type:r,message:n,data:e,context:s})=>{const i={type:r,id:String(++Er),date:new Date};n&&(i.message=n),e&&(i.data=e),s&&(i.context=s),dr(i)};class Z{constructor(n,e){T(this,"type");T(this,"context");this.type=n,this.context=e}trace(n,e){Ur({type:this.type,message:n,data:e,context:this.context})}getContext(){return this.context}setContext(n){this.context=n}updateContext(n){this.context={...this.context,...n}}getType(){return this.type}setType(n){this.type=n}withType(n){return new Z(n,this.context)}withContext(n){return new Z(this.type,n)}withUpdatedContext(n){return new Z(this.type,{...this.context,...n})}}const qr=r=>(V.push(r),()=>{const n=V.indexOf(r);n!==-1&&(V[n]=V[V.length-1],V.pop())});function dr(r){for(let n=0;n<V.length;n++)try{V[n](r)}catch(e){console.error(e)}}typeof window<"u"&&(window.__ledgerLogsListen=qr);const br="transport";class X{constructor({context:n,logType:e}={}){T(this,"exchangeTimeout",3e4);T(this,"unresponsiveTimeout",15e3);T(this,"deviceModel",null);T(this,"tracer");T(this,"_events",new Lr);T(this,"send",async(n,e,s,i,l=Buffer.alloc(0),o=[H.OK],{abortTimeoutMs:u}={})=>{const a=this.tracer.withUpdatedContext({function:"send"});if(l.length>=256)throw a.trace("data.length exceeded 256 bytes limit",{dataLength:l.length}),new k("data.length exceed 256 bytes limit. Got: "+l.length,"DataLengthTooBig");a.trace("Starting an exchange",{abortTimeoutMs:u});const c=await this.exchange(Buffer.concat([Buffer.from([n,e,s,i]),Buffer.from([l.length]),l]),{abortTimeoutMs:u});a.trace("Received response from exchange");const t=c.readUInt16BE(c.length-2);if(!o.some(f=>f===t))throw new z(t);return c});T(this,"exchangeBusyPromise");T(this,"_appAPIlock",null);this.tracer=new Z(e??br,n)}exchange(n,{abortTimeoutMs:e}={}){throw new Error("exchange not implemented")}exchangeBulk(n,e){let s=!1;const i=()=>{s=!0};return(async()=>{if(!s)for(const o of n){const u=await this.exchange(o);if(s)return;const a=u.readUInt16BE(u.length-2);if(a!==H.OK)throw new z(a);e.next(u)}})().then(()=>!s&&e.complete(),o=>!s&&e.error(o)),{unsubscribe:i}}setScrambleKey(n){}close(){return Promise.resolve()}on(n,e){this._events.on(n,e)}off(n,e){this._events.removeListener(n,e)}emit(n,...e){this._events.emit(n,...e)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(n){this.exchangeTimeout=n}setExchangeUnresponsiveTimeout(n){this.unresponsiveTimeout=n}static create(n=3e3,e){return new Promise((s,i)=>{let l=!1;const o=this.listen({next:a=>{l=!0,o&&o.unsubscribe(),u&&clearTimeout(u),this.open(a.descriptor,n).then(s,i)},error:a=>{u&&clearTimeout(u),i(a)},complete:()=>{u&&clearTimeout(u),l||i(new k(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=e?setTimeout(()=>{o.unsubscribe(),i(new k(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},e):null})}async exchangeAtomicImpl(n){const e=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw e.trace("Atomic exchange is already busy"),new Dr("An action was already pending on the Ledger device. Please deny or reconnect.");let s;const i=new Promise(u=>{s=u});this.exchangeBusyPromise=i;let l=!1;const o=setTimeout(()=>{e.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),l=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const u=await n();return l&&(e.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),u}finally{e.trace("Finalize, clearing busy guard"),clearTimeout(o),s&&s(),this.exchangeBusyPromise=null}}decorateAppAPIMethods(n,e,s){for(const i of e)n[i]=this.decorateAppAPIMethod(i,n[i],n,s)}decorateAppAPIMethod(n,e,s,i){return async(...l)=>{const{_appAPIlock:o}=this;if(o)return Promise.reject(new k("Ledger Device is busy (lock "+o+")","TransportLocked"));try{return this._appAPIlock=n,this.setScrambleKey(i),await e.apply(s,l)}finally{this._appAPIlock=null}}}setTraceContext(n){this.tracer=this.tracer.withContext(n)}updateTraceContext(n){this.tracer.updateContext(n)}getTraceContext(){return this.tracer.getContext()}}T(X,"isSupported"),T(X,"list"),T(X,"listen"),T(X,"open"),T(X,"ErrorMessage_ListenTimeout","No Ledger device found (timeout)"),T(X,"ErrorMessage_NoDeviceFound","No Ledger device found");const pt=5;function Fr(r){const n=Buffer.alloc(2);return n.writeUInt16BE(r,0),n}const Gr={data:Buffer.alloc(0),dataLength:0,sequence:0},Mr=(r,n)=>({makeBlocks(e){let s=Buffer.concat([Fr(e.length),e]);const i=n-5,l=Math.ceil(s.length/i);s=Buffer.concat([s,Buffer.alloc(l*i-s.length+1).fill(0)]);const o=[];for(let u=0;u<l;u++){const a=Buffer.alloc(5);a.writeUInt16BE(r,0),a.writeUInt8(pt,2),a.writeUInt16BE(u,3);const c=s.slice(u*i,(u+1)*i);o.push(Buffer.concat([a,c]))}return o},reduceResponse(e,s){let{data:i,dataLength:l,sequence:o}=e||Gr;if(s.readUInt16BE(0)!==r)throw new k("Invalid channel","InvalidChannel");if(s.readUInt8(2)!==pt)throw new k("Invalid tag","InvalidTag");if(s.readUInt16BE(3)!==o)throw new k("Invalid sequence","InvalidSequence");e||(l=s.readUInt16BE(5)),o++;const u=s.slice(e?5:7);return i=Buffer.concat([i,u]),i.length>l&&(i=i.slice(0,l)),{data:i,dataLength:l,sequence:o}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}});var Q={exports:{}},fe,mt;function re(){if(mt)return fe;mt=1;const r="2.0.0",n=256,e=Number.MAX_SAFE_INTEGER||9007199254740991,s=16,i=n-6;return fe={MAX_LENGTH:n,MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:i,MAX_SAFE_INTEGER:e,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:r,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},fe}var he,Rt;function se(){if(Rt)return he;Rt=1;var r={};return he=typeof process=="object"&&r&&r.NODE_DEBUG&&/\bsemver\b/i.test(r.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},he}var It;function J(){return It||(It=1,function(r,n){const{MAX_SAFE_COMPONENT_LENGTH:e,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:i}=re(),l=se();n=r.exports={};const o=n.re=[],u=n.safeRe=[],a=n.src=[],c=n.safeSrc=[],t=n.t={};let f=0;const h="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",i],[h,s]],$=O=>{for(const[w,U]of m)O=O.split(`${w}*`).join(`${w}{0,${U}}`).split(`${w}+`).join(`${w}{1,${U}}`);return O},d=(O,w,U)=>{const C=$(w),q=f++;l(O,q,w),t[O]=q,a[q]=w,c[q]=C,o[q]=new RegExp(w,U?"g":void 0),u[q]=new RegExp(C,U?"g":void 0)};d("NUMERICIDENTIFIER","0|[1-9]\\d*"),d("NUMERICIDENTIFIERLOOSE","\\d+"),d("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),d("MAINVERSION",`(${a[t.NUMERICIDENTIFIER]})\\.(${a[t.NUMERICIDENTIFIER]})\\.(${a[t.NUMERICIDENTIFIER]})`),d("MAINVERSIONLOOSE",`(${a[t.NUMERICIDENTIFIERLOOSE]})\\.(${a[t.NUMERICIDENTIFIERLOOSE]})\\.(${a[t.NUMERICIDENTIFIERLOOSE]})`),d("PRERELEASEIDENTIFIER",`(?:${a[t.NONNUMERICIDENTIFIER]}|${a[t.NUMERICIDENTIFIER]})`),d("PRERELEASEIDENTIFIERLOOSE",`(?:${a[t.NONNUMERICIDENTIFIER]}|${a[t.NUMERICIDENTIFIERLOOSE]})`),d("PRERELEASE",`(?:-(${a[t.PRERELEASEIDENTIFIER]}(?:\\.${a[t.PRERELEASEIDENTIFIER]})*))`),d("PRERELEASELOOSE",`(?:-?(${a[t.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${a[t.PRERELEASEIDENTIFIERLOOSE]})*))`),d("BUILDIDENTIFIER",`${h}+`),d("BUILD",`(?:\\+(${a[t.BUILDIDENTIFIER]}(?:\\.${a[t.BUILDIDENTIFIER]})*))`),d("FULLPLAIN",`v?${a[t.MAINVERSION]}${a[t.PRERELEASE]}?${a[t.BUILD]}?`),d("FULL",`^${a[t.FULLPLAIN]}$`),d("LOOSEPLAIN",`[v=\\s]*${a[t.MAINVERSIONLOOSE]}${a[t.PRERELEASELOOSE]}?${a[t.BUILD]}?`),d("LOOSE",`^${a[t.LOOSEPLAIN]}$`),d("GTLT","((?:<|>)?=?)"),d("XRANGEIDENTIFIERLOOSE",`${a[t.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),d("XRANGEIDENTIFIER",`${a[t.NUMERICIDENTIFIER]}|x|X|\\*`),d("XRANGEPLAIN",`[v=\\s]*(${a[t.XRANGEIDENTIFIER]})(?:\\.(${a[t.XRANGEIDENTIFIER]})(?:\\.(${a[t.XRANGEIDENTIFIER]})(?:${a[t.PRERELEASE]})?${a[t.BUILD]}?)?)?`),d("XRANGEPLAINLOOSE",`[v=\\s]*(${a[t.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[t.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[t.XRANGEIDENTIFIERLOOSE]})(?:${a[t.PRERELEASELOOSE]})?${a[t.BUILD]}?)?)?`),d("XRANGE",`^${a[t.GTLT]}\\s*${a[t.XRANGEPLAIN]}$`),d("XRANGELOOSE",`^${a[t.GTLT]}\\s*${a[t.XRANGEPLAINLOOSE]}$`),d("COERCEPLAIN",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?`),d("COERCE",`${a[t.COERCEPLAIN]}(?:$|[^\\d])`),d("COERCEFULL",a[t.COERCEPLAIN]+`(?:${a[t.PRERELEASE]})?(?:${a[t.BUILD]})?(?:$|[^\\d])`),d("COERCERTL",a[t.COERCE],!0),d("COERCERTLFULL",a[t.COERCEFULL],!0),d("LONETILDE","(?:~>?)"),d("TILDETRIM",`(\\s*)${a[t.LONETILDE]}\\s+`,!0),n.tildeTrimReplace="$1~",d("TILDE",`^${a[t.LONETILDE]}${a[t.XRANGEPLAIN]}$`),d("TILDELOOSE",`^${a[t.LONETILDE]}${a[t.XRANGEPLAINLOOSE]}$`),d("LONECARET","(?:\\^)"),d("CARETTRIM",`(\\s*)${a[t.LONECARET]}\\s+`,!0),n.caretTrimReplace="$1^",d("CARET",`^${a[t.LONECARET]}${a[t.XRANGEPLAIN]}$`),d("CARETLOOSE",`^${a[t.LONECARET]}${a[t.XRANGEPLAINLOOSE]}$`),d("COMPARATORLOOSE",`^${a[t.GTLT]}\\s*(${a[t.LOOSEPLAIN]})$|^$`),d("COMPARATOR",`^${a[t.GTLT]}\\s*(${a[t.FULLPLAIN]})$|^$`),d("COMPARATORTRIM",`(\\s*)${a[t.GTLT]}\\s*(${a[t.LOOSEPLAIN]}|${a[t.XRANGEPLAIN]})`,!0),n.comparatorTrimReplace="$1$2$3",d("HYPHENRANGE",`^\\s*(${a[t.XRANGEPLAIN]})\\s+-\\s+(${a[t.XRANGEPLAIN]})\\s*$`),d("HYPHENRANGELOOSE",`^\\s*(${a[t.XRANGEPLAINLOOSE]})\\s+-\\s+(${a[t.XRANGEPLAINLOOSE]})\\s*$`),d("STAR","(<|>)?=?\\s*\\*"),d("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),d("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Q,Q.exports)),Q.exports}var Ee,vt;function it(){if(vt)return Ee;vt=1;const r=Object.freeze({loose:!0}),n=Object.freeze({});return Ee=s=>s?typeof s!="object"?r:s:n,Ee}var de,gt;function pr(){if(gt)return de;gt=1;const r=/^[0-9]+$/,n=(s,i)=>{const l=r.test(s),o=r.test(i);return l&&o&&(s=+s,i=+i),s===i?0:l&&!o?-1:o&&!l?1:s<i?-1:1};return de={compareIdentifiers:n,rcompareIdentifiers:(s,i)=>n(i,s)},de}var pe,Nt;function F(){if(Nt)return pe;Nt=1;const r=se(),{MAX_LENGTH:n,MAX_SAFE_INTEGER:e}=re(),{safeRe:s,t:i}=J(),l=it(),{compareIdentifiers:o}=pr();class u{constructor(c,t){if(t=l(t),c instanceof u){if(c.loose===!!t.loose&&c.includePrerelease===!!t.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>n)throw new TypeError(`version is longer than ${n} characters`);r("SemVer",c,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const f=c.trim().match(t.loose?s[i.LOOSE]:s[i.FULL]);if(!f)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>e||this.major<0)throw new TypeError("Invalid major version");if(this.minor>e||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>e||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const m=+h;if(m>=0&&m<e)return m}return h}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(r("SemVer.compare",this.version,this.options,c),!(c instanceof u)){if(typeof c=="string"&&c===this.version)return 0;c=new u(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof u||(c=new u(c,this.options)),o(this.major,c.major)||o(this.minor,c.minor)||o(this.patch,c.patch)}comparePre(c){if(c instanceof u||(c=new u(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let t=0;do{const f=this.prerelease[t],h=c.prerelease[t];if(r("prerelease compare",t,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return o(f,h)}while(++t)}compareBuild(c){c instanceof u||(c=new u(c,this.options));let t=0;do{const f=this.build[t],h=c.build[t];if(r("build compare",t,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return o(f,h)}while(++t)}inc(c,t,f){if(c.startsWith("pre")){if(!t&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(t){const h=`-${t}`.match(this.options.loose?s[i.PRERELEASELOOSE]:s[i.PRERELEASE]);if(!h||h[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,f),this.inc("pre",t,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,f),this.inc("pre",t,f);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(f)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let m=this.prerelease.length;for(;--m>=0;)typeof this.prerelease[m]=="number"&&(this.prerelease[m]++,m=-2);if(m===-1){if(t===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(t){let m=[t,h];f===!1&&(m=[t]),o(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=m):this.prerelease=m}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return pe=u,pe}var me,St;function Y(){if(St)return me;St=1;const r=F();return me=(e,s,i=!1)=>{if(e instanceof r)return e;try{return new r(e,s)}catch(l){if(!i)return null;throw l}},me}var Re,Lt;function Br(){if(Lt)return Re;Lt=1;const r=Y();return Re=(e,s)=>{const i=r(e,s);return i?i.version:null},Re}var Ie,Ot;function kr(){if(Ot)return Ie;Ot=1;const r=Y();return Ie=(e,s)=>{const i=r(e.trim().replace(/^[=v]+/,""),s);return i?i.version:null},Ie}var ve,Tt;function Vr(){if(Tt)return ve;Tt=1;const r=F();return ve=(e,s,i,l,o)=>{typeof i=="string"&&(o=l,l=i,i=void 0);try{return new r(e instanceof r?e.version:e,i).inc(s,l,o).version}catch{return null}},ve}var ge,$t;function jr(){if($t)return ge;$t=1;const r=Y();return ge=(e,s)=>{const i=r(e,null,!0),l=r(s,null,!0),o=i.compare(l);if(o===0)return null;const u=o>0,a=u?i:l,c=u?l:i,t=!!a.prerelease.length;if(!!c.prerelease.length&&!t){if(!c.patch&&!c.minor)return"major";if(c.compareMain(a)===0)return c.minor&&!c.patch?"minor":"patch"}const h=t?"pre":"";return i.major!==l.major?h+"major":i.minor!==l.minor?h+"minor":i.patch!==l.patch?h+"patch":"prerelease"},ge}var Ne,At;function Xr(){if(At)return Ne;At=1;const r=F();return Ne=(e,s)=>new r(e,s).major,Ne}var Se,wt;function Hr(){if(wt)return Se;wt=1;const r=F();return Se=(e,s)=>new r(e,s).minor,Se}var Le,Ct;function zr(){if(Ct)return Le;Ct=1;const r=F();return Le=(e,s)=>new r(e,s).patch,Le}var Oe,xt;function Yr(){if(xt)return Oe;xt=1;const r=Y();return Oe=(e,s)=>{const i=r(e,s);return i&&i.prerelease.length?i.prerelease:null},Oe}var Te,_t;function M(){if(_t)return Te;_t=1;const r=F();return Te=(e,s,i)=>new r(e,i).compare(new r(s,i)),Te}var $e,Pt;function Kr(){if(Pt)return $e;Pt=1;const r=M();return $e=(e,s,i)=>r(s,e,i),$e}var Ae,Dt;function Wr(){if(Dt)return Ae;Dt=1;const r=M();return Ae=(e,s)=>r(e,s,!0),Ae}var we,yt;function at(){if(yt)return we;yt=1;const r=F();return we=(e,s,i)=>{const l=new r(e,i),o=new r(s,i);return l.compare(o)||l.compareBuild(o)},we}var Ce,Ut;function Zr(){if(Ut)return Ce;Ut=1;const r=at();return Ce=(e,s)=>e.sort((i,l)=>r(i,l,s)),Ce}var xe,qt;function Jr(){if(qt)return xe;qt=1;const r=at();return xe=(e,s)=>e.sort((i,l)=>r(l,i,s)),xe}var _e,bt;function ne(){if(bt)return _e;bt=1;const r=M();return _e=(e,s,i)=>r(e,s,i)>0,_e}var Pe,Ft;function ot(){if(Ft)return Pe;Ft=1;const r=M();return Pe=(e,s,i)=>r(e,s,i)<0,Pe}var De,Gt;function mr(){if(Gt)return De;Gt=1;const r=M();return De=(e,s,i)=>r(e,s,i)===0,De}var ye,Mt;function Rr(){if(Mt)return ye;Mt=1;const r=M();return ye=(e,s,i)=>r(e,s,i)!==0,ye}var Ue,Bt;function ct(){if(Bt)return Ue;Bt=1;const r=M();return Ue=(e,s,i)=>r(e,s,i)>=0,Ue}var qe,kt;function ut(){if(kt)return qe;kt=1;const r=M();return qe=(e,s,i)=>r(e,s,i)<=0,qe}var be,Vt;function Ir(){if(Vt)return be;Vt=1;const r=mr(),n=Rr(),e=ne(),s=ct(),i=ot(),l=ut();return be=(u,a,c,t)=>{switch(a){case"===":return typeof u=="object"&&(u=u.version),typeof c=="object"&&(c=c.version),u===c;case"!==":return typeof u=="object"&&(u=u.version),typeof c=="object"&&(c=c.version),u!==c;case"":case"=":case"==":return r(u,c,t);case"!=":return n(u,c,t);case">":return e(u,c,t);case">=":return s(u,c,t);case"<":return i(u,c,t);case"<=":return l(u,c,t);default:throw new TypeError(`Invalid operator: ${a}`)}},be}var Fe,jt;function Qr(){if(jt)return Fe;jt=1;const r=F(),n=Y(),{safeRe:e,t:s}=J();return Fe=(l,o)=>{if(l instanceof r)return l;if(typeof l=="number"&&(l=String(l)),typeof l!="string")return null;o=o||{};let u=null;if(!o.rtl)u=l.match(o.includePrerelease?e[s.COERCEFULL]:e[s.COERCE]);else{const m=o.includePrerelease?e[s.COERCERTLFULL]:e[s.COERCERTL];let $;for(;($=m.exec(l))&&(!u||u.index+u[0].length!==l.length);)(!u||$.index+$[0].length!==u.index+u[0].length)&&(u=$),m.lastIndex=$.index+$[1].length+$[2].length;m.lastIndex=-1}if(u===null)return null;const a=u[2],c=u[3]||"0",t=u[4]||"0",f=o.includePrerelease&&u[5]?`-${u[5]}`:"",h=o.includePrerelease&&u[6]?`+${u[6]}`:"";return n(`${a}.${c}.${t}${f}${h}`,o)},Fe}var Ge,Xt;function es(){if(Xt)return Ge;Xt=1;class r{constructor(){this.max=1e3,this.map=new Map}get(e){const s=this.map.get(e);if(s!==void 0)return this.map.delete(e),this.map.set(e,s),s}delete(e){return this.map.delete(e)}set(e,s){if(!this.delete(e)&&s!==void 0){if(this.map.size>=this.max){const l=this.map.keys().next().value;this.delete(l)}this.map.set(e,s)}return this}}return Ge=r,Ge}var Me,Ht;function B(){if(Ht)return Me;Ht=1;const r=/\s+/g;class n{constructor(E,v){if(v=i(v),E instanceof n)return E.loose===!!v.loose&&E.includePrerelease===!!v.includePrerelease?E:new n(E.raw,v);if(E instanceof l)return this.raw=E.value,this.set=[[E]],this.formatted=void 0,this;if(this.options=v,this.loose=!!v.loose,this.includePrerelease=!!v.includePrerelease,this.raw=E.trim().replace(r," "),this.set=this.raw.split("||").map(R=>this.parseRange(R.trim())).filter(R=>R.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const R=this.set[0];if(this.set=this.set.filter(g=>!d(g[0])),this.set.length===0)this.set=[R];else if(this.set.length>1){for(const g of this.set)if(g.length===1&&O(g[0])){this.set=[g];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let E=0;E<this.set.length;E++){E>0&&(this.formatted+="||");const v=this.set[E];for(let R=0;R<v.length;R++)R>0&&(this.formatted+=" "),this.formatted+=v[R].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(E){const R=((this.options.includePrerelease&&m)|(this.options.loose&&$))+":"+E,g=s.get(R);if(g)return g;const I=this.options.loose,N=I?a[c.HYPHENRANGELOOSE]:a[c.HYPHENRANGE];E=E.replace(N,ue(this.options.includePrerelease)),o("hyphen replace",E),E=E.replace(a[c.COMPARATORTRIM],t),o("comparator trim",E),E=E.replace(a[c.TILDETRIM],f),o("tilde trim",E),E=E.replace(a[c.CARETTRIM],h),o("caret trim",E);let A=E.split(" ").map(P=>U(P,this.options)).join(" ").split(/\s+/).map(P=>ce(P,this.options));I&&(A=A.filter(P=>(o("loose invalid filter",P,this.options),!!P.match(a[c.COMPARATORLOOSE])))),o("range list",A);const L=new Map,x=A.map(P=>new l(P,this.options));for(const P of x){if(d(P))return[P];L.set(P.value,P)}L.size>1&&L.has("")&&L.delete("");const b=[...L.values()];return s.set(R,b),b}intersects(E,v){if(!(E instanceof n))throw new TypeError("a Range is required");return this.set.some(R=>w(R,v)&&E.set.some(g=>w(g,v)&&R.every(I=>g.every(N=>I.intersects(N,v)))))}test(E){if(!E)return!1;if(typeof E=="string")try{E=new u(E,this.options)}catch{return!1}for(let v=0;v<this.set.length;v++)if(le(this.set[v],E,this.options))return!0;return!1}}Me=n;const e=es(),s=new e,i=it(),l=ie(),o=se(),u=F(),{safeRe:a,t:c,comparatorTrimReplace:t,tildeTrimReplace:f,caretTrimReplace:h}=J(),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:$}=re(),d=p=>p.value==="<0.0.0-0",O=p=>p.value==="",w=(p,E)=>{let v=!0;const R=p.slice();let g=R.pop();for(;v&&R.length;)v=R.every(I=>g.intersects(I,E)),g=R.pop();return v},U=(p,E)=>(o("comp",p,E),p=_(p,E),o("caret",p),p=q(p,E),o("tildes",p),p=S(p,E),o("xrange",p),p=oe(p,E),o("stars",p),p),C=p=>!p||p.toLowerCase()==="x"||p==="*",q=(p,E)=>p.trim().split(/\s+/).map(v=>G(v,E)).join(" "),G=(p,E)=>{const v=E.loose?a[c.TILDELOOSE]:a[c.TILDE];return p.replace(v,(R,g,I,N,A)=>{o("tilde",p,R,g,I,N,A);let L;return C(g)?L="":C(I)?L=`>=${g}.0.0 <${+g+1}.0.0-0`:C(N)?L=`>=${g}.${I}.0 <${g}.${+I+1}.0-0`:A?(o("replaceTilde pr",A),L=`>=${g}.${I}.${N}-${A} <${g}.${+I+1}.0-0`):L=`>=${g}.${I}.${N} <${g}.${+I+1}.0-0`,o("tilde return",L),L})},_=(p,E)=>p.trim().split(/\s+/).map(v=>y(v,E)).join(" "),y=(p,E)=>{o("caret",p,E);const v=E.loose?a[c.CARETLOOSE]:a[c.CARET],R=E.includePrerelease?"-0":"";return p.replace(v,(g,I,N,A,L)=>{o("caret",p,g,I,N,A,L);let x;return C(I)?x="":C(N)?x=`>=${I}.0.0${R} <${+I+1}.0.0-0`:C(A)?I==="0"?x=`>=${I}.${N}.0${R} <${I}.${+N+1}.0-0`:x=`>=${I}.${N}.0${R} <${+I+1}.0.0-0`:L?(o("replaceCaret pr",L),I==="0"?N==="0"?x=`>=${I}.${N}.${A}-${L} <${I}.${N}.${+A+1}-0`:x=`>=${I}.${N}.${A}-${L} <${I}.${+N+1}.0-0`:x=`>=${I}.${N}.${A}-${L} <${+I+1}.0.0-0`):(o("no pr"),I==="0"?N==="0"?x=`>=${I}.${N}.${A}${R} <${I}.${N}.${+A+1}-0`:x=`>=${I}.${N}.${A}${R} <${I}.${+N+1}.0-0`:x=`>=${I}.${N}.${A} <${+I+1}.0.0-0`),o("caret return",x),x})},S=(p,E)=>(o("replaceXRanges",p,E),p.split(/\s+/).map(v=>K(v,E)).join(" ")),K=(p,E)=>{p=p.trim();const v=E.loose?a[c.XRANGELOOSE]:a[c.XRANGE];return p.replace(v,(R,g,I,N,A,L)=>{o("xRange",p,R,g,I,N,A,L);const x=C(I),b=x||C(N),P=b||C(A),W=P;return g==="="&&W&&(g=""),L=E.includePrerelease?"-0":"",x?g===">"||g==="<"?R="<0.0.0-0":R="*":g&&W?(b&&(N=0),A=0,g===">"?(g=">=",b?(I=+I+1,N=0,A=0):(N=+N+1,A=0)):g==="<="&&(g="<",b?I=+I+1:N=+N+1),g==="<"&&(L="-0"),R=`${g+I}.${N}.${A}${L}`):b?R=`>=${I}.0.0${L} <${+I+1}.0.0-0`:P&&(R=`>=${I}.${N}.0${L} <${I}.${+N+1}.0-0`),o("xRange return",R),R})},oe=(p,E)=>(o("replaceStars",p,E),p.trim().replace(a[c.STAR],"")),ce=(p,E)=>(o("replaceGTE0",p,E),p.trim().replace(a[E.includePrerelease?c.GTE0PRE:c.GTE0],"")),ue=p=>(E,v,R,g,I,N,A,L,x,b,P,W)=>(C(R)?v="":C(g)?v=`>=${R}.0.0${p?"-0":""}`:C(I)?v=`>=${R}.${g}.0${p?"-0":""}`:N?v=`>=${v}`:v=`>=${v}${p?"-0":""}`,C(x)?L="":C(b)?L=`<${+x+1}.0.0-0`:C(P)?L=`<${x}.${+b+1}.0-0`:W?L=`<=${x}.${b}.${P}-${W}`:p?L=`<${x}.${b}.${+P+1}-0`:L=`<=${L}`,`${v} ${L}`.trim()),le=(p,E,v)=>{for(let R=0;R<p.length;R++)if(!p[R].test(E))return!1;if(E.prerelease.length&&!v.includePrerelease){for(let R=0;R<p.length;R++)if(o(p[R].semver),p[R].semver!==l.ANY&&p[R].semver.prerelease.length>0){const g=p[R].semver;if(g.major===E.major&&g.minor===E.minor&&g.patch===E.patch)return!0}return!1}return!0};return Me}var Be,zt;function ie(){if(zt)return Be;zt=1;const r=Symbol("SemVer ANY");class n{static get ANY(){return r}constructor(t,f){if(f=e(f),t instanceof n){if(t.loose===!!f.loose)return t;t=t.value}t=t.trim().split(/\s+/).join(" "),o("comparator",t,f),this.options=f,this.loose=!!f.loose,this.parse(t),this.semver===r?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(t){const f=this.options.loose?s[i.COMPARATORLOOSE]:s[i.COMPARATOR],h=t.match(f);if(!h)throw new TypeError(`Invalid comparator: ${t}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new u(h[2],this.options.loose):this.semver=r}toString(){return this.value}test(t){if(o("Comparator.test",t,this.options.loose),this.semver===r||t===r)return!0;if(typeof t=="string")try{t=new u(t,this.options)}catch{return!1}return l(t,this.operator,this.semver,this.options)}intersects(t,f){if(!(t instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new a(t.value,f).test(this.value):t.operator===""?t.value===""?!0:new a(this.value,f).test(t.semver):(f=e(f),f.includePrerelease&&(this.value==="<0.0.0-0"||t.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||t.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&t.operator.startsWith(">")||this.operator.startsWith("<")&&t.operator.startsWith("<")||this.semver.version===t.semver.version&&this.operator.includes("=")&&t.operator.includes("=")||l(this.semver,"<",t.semver,f)&&this.operator.startsWith(">")&&t.operator.startsWith("<")||l(this.semver,">",t.semver,f)&&this.operator.startsWith("<")&&t.operator.startsWith(">")))}}Be=n;const e=it(),{safeRe:s,t:i}=J(),l=Ir(),o=se(),u=F(),a=B();return Be}var ke,Yt;function ae(){if(Yt)return ke;Yt=1;const r=B();return ke=(e,s,i)=>{try{s=new r(s,i)}catch{return!1}return s.test(e)},ke}var Ve,Kt;function ts(){if(Kt)return Ve;Kt=1;const r=B();return Ve=(e,s)=>new r(e,s).set.map(i=>i.map(l=>l.value).join(" ").trim().split(" ")),Ve}var je,Wt;function rs(){if(Wt)return je;Wt=1;const r=F(),n=B();return je=(s,i,l)=>{let o=null,u=null,a=null;try{a=new n(i,l)}catch{return null}return s.forEach(c=>{a.test(c)&&(!o||u.compare(c)===-1)&&(o=c,u=new r(o,l))}),o},je}var Xe,Zt;function ss(){if(Zt)return Xe;Zt=1;const r=F(),n=B();return Xe=(s,i,l)=>{let o=null,u=null,a=null;try{a=new n(i,l)}catch{return null}return s.forEach(c=>{a.test(c)&&(!o||u.compare(c)===1)&&(o=c,u=new r(o,l))}),o},Xe}var He,Jt;function ns(){if(Jt)return He;Jt=1;const r=F(),n=B(),e=ne();return He=(i,l)=>{i=new n(i,l);let o=new r("0.0.0");if(i.test(o)||(o=new r("0.0.0-0"),i.test(o)))return o;o=null;for(let u=0;u<i.set.length;++u){const a=i.set[u];let c=null;a.forEach(t=>{const f=new r(t.semver.version);switch(t.operator){case">":f.prerelease.length===0?f.patch++:f.prerelease.push(0),f.raw=f.format();case"":case">=":(!c||e(f,c))&&(c=f);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${t.operator}`)}}),c&&(!o||e(o,c))&&(o=c)}return o&&i.test(o)?o:null},He}var ze,Qt;function is(){if(Qt)return ze;Qt=1;const r=B();return ze=(e,s)=>{try{return new r(e,s).range||"*"}catch{return null}},ze}var Ye,er;function lt(){if(er)return Ye;er=1;const r=F(),n=ie(),{ANY:e}=n,s=B(),i=ae(),l=ne(),o=ot(),u=ut(),a=ct();return Ye=(t,f,h,m)=>{t=new r(t,m),f=new s(f,m);let $,d,O,w,U;switch(h){case">":$=l,d=u,O=o,w=">",U=">=";break;case"<":$=o,d=a,O=l,w="<",U="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(i(t,f,m))return!1;for(let C=0;C<f.set.length;++C){const q=f.set[C];let G=null,_=null;if(q.forEach(y=>{y.semver===e&&(y=new n(">=0.0.0")),G=G||y,_=_||y,$(y.semver,G.semver,m)?G=y:O(y.semver,_.semver,m)&&(_=y)}),G.operator===w||G.operator===U||(!_.operator||_.operator===w)&&d(t,_.semver))return!1;if(_.operator===U&&O(t,_.semver))return!1}return!0},Ye}var Ke,tr;function as(){if(tr)return Ke;tr=1;const r=lt();return Ke=(e,s,i)=>r(e,s,">",i),Ke}var We,rr;function os(){if(rr)return We;rr=1;const r=lt();return We=(e,s,i)=>r(e,s,"<",i),We}var Ze,sr;function cs(){if(sr)return Ze;sr=1;const r=B();return Ze=(e,s,i)=>(e=new r(e,i),s=new r(s,i),e.intersects(s,i)),Ze}var Je,nr;function us(){if(nr)return Je;nr=1;const r=ae(),n=M();return Je=(e,s,i)=>{const l=[];let o=null,u=null;const a=e.sort((h,m)=>n(h,m,i));for(const h of a)r(h,s,i)?(u=h,o||(o=h)):(u&&l.push([o,u]),u=null,o=null);o&&l.push([o,null]);const c=[];for(const[h,m]of l)h===m?c.push(h):!m&&h===a[0]?c.push("*"):m?h===a[0]?c.push(`<=${m}`):c.push(`${h} - ${m}`):c.push(`>=${h}`);const t=c.join(" || "),f=typeof s.raw=="string"?s.raw:String(s);return t.length<f.length?t:s},Je}var Qe,ir;function ls(){if(ir)return Qe;ir=1;const r=B(),n=ie(),{ANY:e}=n,s=ae(),i=M(),l=(f,h,m={})=>{if(f===h)return!0;f=new r(f,m),h=new r(h,m);let $=!1;e:for(const d of f.set){for(const O of h.set){const w=a(d,O,m);if($=$||w!==null,w)continue e}if($)return!1}return!0},o=[new n(">=0.0.0-0")],u=[new n(">=0.0.0")],a=(f,h,m)=>{if(f===h)return!0;if(f.length===1&&f[0].semver===e){if(h.length===1&&h[0].semver===e)return!0;m.includePrerelease?f=o:f=u}if(h.length===1&&h[0].semver===e){if(m.includePrerelease)return!0;h=u}const $=new Set;let d,O;for(const S of f)S.operator===">"||S.operator===">="?d=c(d,S,m):S.operator==="<"||S.operator==="<="?O=t(O,S,m):$.add(S.semver);if($.size>1)return null;let w;if(d&&O){if(w=i(d.semver,O.semver,m),w>0)return null;if(w===0&&(d.operator!==">="||O.operator!=="<="))return null}for(const S of $){if(d&&!s(S,String(d),m)||O&&!s(S,String(O),m))return null;for(const K of h)if(!s(S,String(K),m))return!1;return!0}let U,C,q,G,_=O&&!m.includePrerelease&&O.semver.prerelease.length?O.semver:!1,y=d&&!m.includePrerelease&&d.semver.prerelease.length?d.semver:!1;_&&_.prerelease.length===1&&O.operator==="<"&&_.prerelease[0]===0&&(_=!1);for(const S of h){if(G=G||S.operator===">"||S.operator===">=",q=q||S.operator==="<"||S.operator==="<=",d){if(y&&S.semver.prerelease&&S.semver.prerelease.length&&S.semver.major===y.major&&S.semver.minor===y.minor&&S.semver.patch===y.patch&&(y=!1),S.operator===">"||S.operator===">="){if(U=c(d,S,m),U===S&&U!==d)return!1}else if(d.operator===">="&&!s(d.semver,String(S),m))return!1}if(O){if(_&&S.semver.prerelease&&S.semver.prerelease.length&&S.semver.major===_.major&&S.semver.minor===_.minor&&S.semver.patch===_.patch&&(_=!1),S.operator==="<"||S.operator==="<="){if(C=t(O,S,m),C===S&&C!==O)return!1}else if(O.operator==="<="&&!s(O.semver,String(S),m))return!1}if(!S.operator&&(O||d)&&w!==0)return!1}return!(d&&q&&!O&&w!==0||O&&G&&!d&&w!==0||y||_)},c=(f,h,m)=>{if(!f)return h;const $=i(f.semver,h.semver,m);return $>0?f:$<0||h.operator===">"&&f.operator===">="?h:f},t=(f,h,m)=>{if(!f)return h;const $=i(f.semver,h.semver,m);return $<0?f:$>0||h.operator==="<"&&f.operator==="<="?h:f};return Qe=l,Qe}var et,ar;function fs(){if(ar)return et;ar=1;const r=J(),n=re(),e=F(),s=pr(),i=Y(),l=Br(),o=kr(),u=Vr(),a=jr(),c=Xr(),t=Hr(),f=zr(),h=Yr(),m=M(),$=Kr(),d=Wr(),O=at(),w=Zr(),U=Jr(),C=ne(),q=ot(),G=mr(),_=Rr(),y=ct(),S=ut(),K=Ir(),oe=Qr(),ce=ie(),ue=B(),le=ae(),p=ts(),E=rs(),v=ss(),R=ns(),g=is(),I=lt(),N=as(),A=os(),L=cs(),x=us(),b=ls();return et={parse:i,valid:l,clean:o,inc:u,diff:a,major:c,minor:t,patch:f,prerelease:h,compare:m,rcompare:$,compareLoose:d,compareBuild:O,sort:w,rsort:U,gt:C,lt:q,eq:G,neq:_,gte:y,lte:S,cmp:K,coerce:oe,Comparator:ce,Range:ue,satisfies:le,toComparators:p,maxSatisfying:E,minSatisfying:v,minVersion:R,validRange:g,outside:I,gtr:N,ltr:A,intersects:L,simplifyRange:x,subset:b,SemVer:e,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers},et}var hs=fs();const or=Or(hs);var D;(function(r){r.blue="blue",r.nanoS="nanoS",r.nanoSP="nanoSP",r.nanoX="nanoX",r.stax="stax",r.europa="europa"})(D||(D={}));const tt={[D.blue]:{id:D.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:r=>4*1024},[D.nanoS]:{id:D.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:r=>or.lt(or.coerce(r)??"","2.0.0")?4*1024:2*1024},[D.nanoX]:{id:D.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:r=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[D.nanoSP]:{id:D.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:r=>32},[D.stax]:{id:D.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1533*1024,masks:[857735168],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[D.europa]:{id:D.europa,productName:"Ledger Flex",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1533*1024,masks:[858783744],getBlockSize:r=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}};D.blue,D.nanoS,D.nanoSP,D.nanoX,D.stax,D.europa;const cr=Object.values(tt),vr=11415,ur=r=>{const n=cr.find(i=>i.legacyUsbProductId===r);if(n)return n;const e=r>>8;return cr.find(i=>i.productIdMM===e)},Es=[],lr={};for(const r in tt){const n=tt[r],{bluetoothSpec:e}=n;if(e)for(let s=0;s<e.length;s++){const i=e[s];Es.push(i.serviceUuid),lr[i.serviceUuid]=lr[i.serviceUuid.replace(/-/g,"")]={deviceModel:n,...i}}}const ds=[{vendorId:vr}],ps=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),ee=()=>{const{hid:r}=navigator;if(!r)throw new k("navigator.hid is not supported","HIDNotSupported");return r};async function gr(){const r=await ee().requestDevice({filters:ds});return Array.isArray(r)?r:[r]}async function rt(){return(await ee().getDevices()).filter(n=>n.vendorId===vr)}async function ms(){const r=await rt();return r.length>0?r[0]:(await gr())[0]}const j=class j extends X{constructor(e){super();T(this,"device");T(this,"deviceModel");T(this,"channel",Math.floor(Math.random()*65535));T(this,"packetSize",64);T(this,"inputs",[]);T(this,"inputCallback");T(this,"read",()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(e=>{this.inputCallback=e}));T(this,"onInputReport",e=>{const s=Buffer.from(e.data.buffer);this.inputCallback?(this.inputCallback(s),this.inputCallback=null):this.inputs.push(s)});T(this,"_disconnectEmitted",!1);T(this,"_emitDisconnect",e=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",e))});T(this,"exchange",async e=>await this.exchangeAtomicImpl(async()=>{const{channel:i,packetSize:l}=this;dt("apdu","=> "+e.toString("hex"));const o=Mr(i,l),u=o.makeBlocks(e);for(let t=0;t<u.length;t++)await this.device.sendReport(0,u[t]);let a,c;for(;!(a=o.getReducedResult(c));)try{const t=await this.read();c=o.reduceResponse(c,t)}catch(t){if(t instanceof k&&t.id==="InvalidChannel")continue;throw t}return dt("apdu","<= "+a.toString("hex")),a}).catch(i=>{throw i&&i.message&&i.message.includes("write")?(this._emitDisconnect(i),new Pr(i.message)):i}));this.device=e,this.deviceModel=typeof e.productId=="number"?ur(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static async request(){const[e]=await gr();return j.open(e)}static async openConnected(){const e=await rt();return e.length===0?null:j.open(e[0])}static async open(e){await e.open();const s=new j(e),i=l=>{e===l.device&&(ee().removeEventListener("disconnect",i),s._emitDisconnect(new _r))};return ee().addEventListener("disconnect",i),s}async close(){await this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),await this.device.close()}setScrambleKey(){}};T(j,"isSupported",ps),T(j,"list",rt),T(j,"listen",e=>{let s=!1;ms().then(l=>{if(!l)e.error(new ht("Access denied to use Ledger device"));else if(!s){const o=typeof l.productId=="number"?ur(l.productId):void 0;e.next({type:"add",descriptor:l,deviceModel:o}),e.complete()}},l=>{e.error(new ht(l.message))});function i(){s=!0}return{unsubscribe:i}});let st=j;const fr=3e5,gs=async(r,n={derivationType:Ar.ED25519})=>{const e=await Promise.race([st.create(),ft(fr)]);try{const s=await Tr(r),{accountId:i,tezos:l,isActivated:o}=await Promise.race([await wr(s,e,n),ft(fr)]),u={id:i,isActivated:o,type:"ledger",network:r.id.toString(),explorer:s.explorer,rpc:s.rpc,balance:0n,stakedBalance:0n,fullBalance:0n,finalizableBalance:0n},a=l;return a.signOperation=async f=>({signature:(await l.signer.sign(f,new Uint8Array([3]))).sbytes.slice(f.length)}),{...await $r(u,a),logout:async()=>{e.close()}}}catch(s){throw e.close(),s}};export{gs as createLedgerSession};
