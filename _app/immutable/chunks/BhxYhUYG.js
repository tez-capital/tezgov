var Nr=Object.defineProperty;var Sr=(t,n,e)=>n in t?Nr(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var O=(t,n,e)=>Sr(t,typeof n!="symbol"?n+"":n,e);import{aU as Lr,aV as Tr,aW as Or,aX as $r}from"./B5Sin98T.js";import{D as Ar,c as wr}from"./DyrZIIsD.js";const Cr={},hr=(t,n)=>{Cr[t]=n},te=t=>{class n extends Error{constructor(i,l,o){super(i||t,o);O(this,"cause");if(Object.setPrototypeOf(this,n.prototype),this.name=t,l)for(const u in l)this[u]=l[u];if(o&&xr(o)&&"cause"in o&&!this.cause){const u=o.cause;this.cause=u,"stack"in u&&(this.stack=this.stack+`
CAUSE: `+u.stack)}}}return n};function xr(t){return typeof t=="object"}const _r=te("DisconnectedDevice"),Pr=te("DisconnectedDeviceDuringOperation"),ft=te("TransportOpenUserCancelled"),Dr=te("TransportRaceCondition");var ht;(function(t){t.Unknown="Unknown",t.LocationServicesDisabled="LocationServicesDisabled",t.LocationServicesUnauthorized="LocationServicesUnauthorized",t.BluetoothScanStartFailed="BluetoothScanStartFailed"})(ht||(ht={}));class k extends Error{constructor(e,s){const i="TransportError";super(e||i);O(this,"id");this.name=i,this.message=e,this.stack=new Error(e).stack,this.id=s}}hr("TransportError",t=>new k(t.message,t.id));const H={ACCESS_CONDITION_NOT_FULFILLED:38916,ALGORITHM_NOT_SUPPORTED:38020,CLA_NOT_SUPPORTED:28160,CODE_BLOCKED:38976,CODE_NOT_INITIALIZED:38914,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,CONDITIONS_OF_USE_NOT_SATISFIED:27013,CONTRADICTION_INVALIDATION:38928,CONTRADICTION_SECRET_CODE_STATUS:38920,DEVICE_IN_RECOVERY_MODE:26159,CUSTOM_IMAGE_EMPTY:26158,FILE_ALREADY_EXISTS:27273,FILE_NOT_FOUND:37892,GP_AUTH_FAILED:25344,HALTED:28586,INCONSISTENT_FILE:37896,INCORRECT_DATA:27264,INCORRECT_LENGTH:26368,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,DEVICE_NOT_ONBOARDED:27911,DEVICE_NOT_ONBOARDED_2:26129,INVALID_KCV:38021,INVALID_OFFSET:37890,LICENSING:28482,LOCKED_DEVICE:21781,MAX_VALUE_REACHED:38992,MEMORY_PROBLEM:37440,MISSING_CRITICAL_PARAMETER:26624,NO_EF_SELECTED:37888,NOT_ENOUGH_MEMORY_SPACE:27268,OK:36864,PIN_REMAINING_ATTEMPTS:25536,REFERENCED_DATA_NOT_FOUND:27272,SECURITY_STATUS_NOT_SATISFIED:27010,TECHNICAL_PROBLEM:28416,UNKNOWN_APDU:27906,USER_REFUSED_ON_DEVICE:21761,NOT_ENOUGH_SPACE:20738,APP_NOT_FOUND_OR_INVALID_CONTEXT:20771,INVALID_APP_NAME_LENGTH:26378,GEN_AES_KEY_FAILED:21529,INTERNAL_CRYPTO_OPERATION_FAILED:21530,INTERNAL_COMPUTE_AES_CMAC_FAILED:21531,ENCRYPT_APP_STORAGE_FAILED:21532,INVALID_BACKUP_STATE:26178,PIN_NOT_SET:21762,INVALID_BACKUP_LENGTH:26419,INVALID_RESTORE_STATE:26179,INVALID_CHUNK_LENGTH:26420,INVALID_BACKUP_HEADER:26698,TRUSTCHAIN_WRONG_SEED:45063};function yr(t){switch(t){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received";case 21781:return"Locked device"}if(28416<=t&&t<=28671)return"Internal error, please report"}class z extends Error{constructor(e,{canBeMappedToChildError:s=!0}={}){const i=Object.keys(H).find(a=>H[a]===e)||"UNKNOWN_ERROR",l=yr(e)||i,o=e.toString(16),u=`Ledger device: ${l} (0x${o})`;super(u);O(this,"statusCode");O(this,"statusText");if(this.name="TransportStatusError",this.statusCode=e,this.statusText=i,Object.setPrototypeOf(this,z.prototype),s&&e===H.LOCKED_DEVICE)return new nt(u)}}class nt extends z{constructor(n){super(H.LOCKED_DEVICE,{canBeMappedToChildError:!1}),n&&(this.message=n),this.name="LockedDeviceError",Object.setPrototypeOf(this,nt.prototype)}}hr("TransportStatusError",t=>new z(t.statusCode));let Er=0;const V=[],Et=(t,n,e)=>{const s={type:t,id:String(++Er),date:new Date};n&&(s.message=n),dr(s)},Ur=({type:t,message:n,data:e,context:s})=>{const i={type:t,id:String(++Er),date:new Date};n&&(i.message=n),e&&(i.data=e),s&&(i.context=s),dr(i)};class Z{constructor(n,e){O(this,"type");O(this,"context");this.type=n,this.context=e}trace(n,e){Ur({type:this.type,message:n,data:e,context:this.context})}getContext(){return this.context}setContext(n){this.context=n}updateContext(n){this.context={...this.context,...n}}getType(){return this.type}setType(n){this.type=n}withType(n){return new Z(n,this.context)}withContext(n){return new Z(this.type,n)}withUpdatedContext(n){return new Z(this.type,{...this.context,...n})}}const qr=t=>(V.push(t),()=>{const n=V.indexOf(t);n!==-1&&(V[n]=V[V.length-1],V.pop())});function dr(t){for(let n=0;n<V.length;n++)try{V[n](t)}catch(e){console.error(e)}}typeof window<"u"&&(window.__ledgerLogsListen=qr);const br="transport";class X{constructor({context:n,logType:e}={}){O(this,"exchangeTimeout",3e4);O(this,"unresponsiveTimeout",15e3);O(this,"deviceModel",null);O(this,"tracer");O(this,"_events",new Lr);O(this,"send",async(n,e,s,i,l=Buffer.alloc(0),o=[H.OK],{abortTimeoutMs:u}={})=>{const a=this.tracer.withUpdatedContext({function:"send"});if(l.length>=256)throw a.trace("data.length exceeded 256 bytes limit",{dataLength:l.length}),new k("data.length exceed 256 bytes limit. Got: "+l.length,"DataLengthTooBig");a.trace("Starting an exchange",{abortTimeoutMs:u});const c=await this.exchange(Buffer.concat([Buffer.from([n,e,s,i]),Buffer.from([l.length]),l]),{abortTimeoutMs:u});a.trace("Received response from exchange");const r=c.readUInt16BE(c.length-2);if(!o.some(f=>f===r))throw new z(r);return c});O(this,"exchangeBusyPromise");O(this,"_appAPIlock",null);this.tracer=new Z(e??br,n)}exchange(n,{abortTimeoutMs:e}={}){throw new Error("exchange not implemented")}exchangeBulk(n,e){let s=!1;const i=()=>{s=!0};return(async()=>{if(!s)for(const o of n){const u=await this.exchange(o);if(s)return;const a=u.readUInt16BE(u.length-2);if(a!==H.OK)throw new z(a);e.next(u)}})().then(()=>!s&&e.complete(),o=>!s&&e.error(o)),{unsubscribe:i}}setScrambleKey(n){}close(){return Promise.resolve()}on(n,e){this._events.on(n,e)}off(n,e){this._events.removeListener(n,e)}emit(n,...e){this._events.emit(n,...e)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(n){this.exchangeTimeout=n}setExchangeUnresponsiveTimeout(n){this.unresponsiveTimeout=n}static create(n=3e3,e){return new Promise((s,i)=>{let l=!1;const o=this.listen({next:a=>{l=!0,o&&o.unsubscribe(),u&&clearTimeout(u),this.open(a.descriptor,n).then(s,i)},error:a=>{u&&clearTimeout(u),i(a)},complete:()=>{u&&clearTimeout(u),l||i(new k(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=e?setTimeout(()=>{o.unsubscribe(),i(new k(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},e):null})}async exchangeAtomicImpl(n){const e=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw e.trace("Atomic exchange is already busy"),new Dr("An action was already pending on the Ledger device. Please deny or reconnect.");let s;const i=new Promise(u=>{s=u});this.exchangeBusyPromise=i;let l=!1;const o=setTimeout(()=>{e.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),l=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const u=await n();return l&&(e.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),u}finally{e.trace("Finalize, clearing busy guard"),clearTimeout(o),s&&s(),this.exchangeBusyPromise=null}}decorateAppAPIMethods(n,e,s){for(const i of e)n[i]=this.decorateAppAPIMethod(i,n[i],n,s)}decorateAppAPIMethod(n,e,s,i){return async(...l)=>{const{_appAPIlock:o}=this;if(o)return Promise.reject(new k("Ledger Device is busy (lock "+o+")","TransportLocked"));try{return this._appAPIlock=n,this.setScrambleKey(i),await e.apply(s,l)}finally{this._appAPIlock=null}}}setTraceContext(n){this.tracer=this.tracer.withContext(n)}updateTraceContext(n){this.tracer.updateContext(n)}getTraceContext(){return this.tracer.getContext()}}O(X,"isSupported"),O(X,"list"),O(X,"listen"),O(X,"open"),O(X,"ErrorMessage_ListenTimeout","No Ledger device found (timeout)"),O(X,"ErrorMessage_NoDeviceFound","No Ledger device found");const dt=5;function Fr(t){const n=Buffer.alloc(2);return n.writeUInt16BE(t,0),n}const Gr={data:Buffer.alloc(0),dataLength:0,sequence:0},Mr=(t,n)=>({makeBlocks(e){let s=Buffer.concat([Fr(e.length),e]);const i=n-5,l=Math.ceil(s.length/i);s=Buffer.concat([s,Buffer.alloc(l*i-s.length+1).fill(0)]);const o=[];for(let u=0;u<l;u++){const a=Buffer.alloc(5);a.writeUInt16BE(t,0),a.writeUInt8(dt,2),a.writeUInt16BE(u,3);const c=s.slice(u*i,(u+1)*i);o.push(Buffer.concat([a,c]))}return o},reduceResponse(e,s){let{data:i,dataLength:l,sequence:o}=e||Gr;if(s.readUInt16BE(0)!==t)throw new k("Invalid channel","InvalidChannel");if(s.readUInt8(2)!==dt)throw new k("Invalid tag","InvalidTag");if(s.readUInt16BE(3)!==o)throw new k("Invalid sequence","InvalidSequence");e||(l=s.readUInt16BE(5)),o++;const u=s.slice(e?5:7);return i=Buffer.concat([i,u]),i.length>l&&(i=i.slice(0,l)),{data:i,dataLength:l,sequence:o}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}});var Q={exports:{}},fe,pt;function re(){if(pt)return fe;pt=1;const t="2.0.0",n=256,e=Number.MAX_SAFE_INTEGER||9007199254740991,s=16,i=n-6;return fe={MAX_LENGTH:n,MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:i,MAX_SAFE_INTEGER:e,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:t,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},fe}var he,mt;function se(){if(mt)return he;mt=1;var t={};return he=typeof process=="object"&&t&&t.NODE_DEBUG&&/\bsemver\b/i.test(t.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},he}var Rt;function J(){return Rt||(Rt=1,function(t,n){const{MAX_SAFE_COMPONENT_LENGTH:e,MAX_SAFE_BUILD_LENGTH:s,MAX_LENGTH:i}=re(),l=se();n=t.exports={};const o=n.re=[],u=n.safeRe=[],a=n.src=[],c=n.safeSrc=[],r=n.t={};let f=0;const h="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",i],[h,s]],$=T=>{for(const[w,U]of m)T=T.split(`${w}*`).join(`${w}{0,${U}}`).split(`${w}+`).join(`${w}{1,${U}}`);return T},d=(T,w,U)=>{const C=$(w),q=f++;l(T,q,w),r[T]=q,a[q]=w,c[q]=C,o[q]=new RegExp(w,U?"g":void 0),u[q]=new RegExp(C,U?"g":void 0)};d("NUMERICIDENTIFIER","0|[1-9]\\d*"),d("NUMERICIDENTIFIERLOOSE","\\d+"),d("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),d("MAINVERSION",`(${a[r.NUMERICIDENTIFIER]})\\.(${a[r.NUMERICIDENTIFIER]})\\.(${a[r.NUMERICIDENTIFIER]})`),d("MAINVERSIONLOOSE",`(${a[r.NUMERICIDENTIFIERLOOSE]})\\.(${a[r.NUMERICIDENTIFIERLOOSE]})\\.(${a[r.NUMERICIDENTIFIERLOOSE]})`),d("PRERELEASEIDENTIFIER",`(?:${a[r.NONNUMERICIDENTIFIER]}|${a[r.NUMERICIDENTIFIER]})`),d("PRERELEASEIDENTIFIERLOOSE",`(?:${a[r.NONNUMERICIDENTIFIER]}|${a[r.NUMERICIDENTIFIERLOOSE]})`),d("PRERELEASE",`(?:-(${a[r.PRERELEASEIDENTIFIER]}(?:\\.${a[r.PRERELEASEIDENTIFIER]})*))`),d("PRERELEASELOOSE",`(?:-?(${a[r.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${a[r.PRERELEASEIDENTIFIERLOOSE]})*))`),d("BUILDIDENTIFIER",`${h}+`),d("BUILD",`(?:\\+(${a[r.BUILDIDENTIFIER]}(?:\\.${a[r.BUILDIDENTIFIER]})*))`),d("FULLPLAIN",`v?${a[r.MAINVERSION]}${a[r.PRERELEASE]}?${a[r.BUILD]}?`),d("FULL",`^${a[r.FULLPLAIN]}$`),d("LOOSEPLAIN",`[v=\\s]*${a[r.MAINVERSIONLOOSE]}${a[r.PRERELEASELOOSE]}?${a[r.BUILD]}?`),d("LOOSE",`^${a[r.LOOSEPLAIN]}$`),d("GTLT","((?:<|>)?=?)"),d("XRANGEIDENTIFIERLOOSE",`${a[r.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),d("XRANGEIDENTIFIER",`${a[r.NUMERICIDENTIFIER]}|x|X|\\*`),d("XRANGEPLAIN",`[v=\\s]*(${a[r.XRANGEIDENTIFIER]})(?:\\.(${a[r.XRANGEIDENTIFIER]})(?:\\.(${a[r.XRANGEIDENTIFIER]})(?:${a[r.PRERELEASE]})?${a[r.BUILD]}?)?)?`),d("XRANGEPLAINLOOSE",`[v=\\s]*(${a[r.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[r.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[r.XRANGEIDENTIFIERLOOSE]})(?:${a[r.PRERELEASELOOSE]})?${a[r.BUILD]}?)?)?`),d("XRANGE",`^${a[r.GTLT]}\\s*${a[r.XRANGEPLAIN]}$`),d("XRANGELOOSE",`^${a[r.GTLT]}\\s*${a[r.XRANGEPLAINLOOSE]}$`),d("COERCEPLAIN",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?`),d("COERCE",`${a[r.COERCEPLAIN]}(?:$|[^\\d])`),d("COERCEFULL",a[r.COERCEPLAIN]+`(?:${a[r.PRERELEASE]})?(?:${a[r.BUILD]})?(?:$|[^\\d])`),d("COERCERTL",a[r.COERCE],!0),d("COERCERTLFULL",a[r.COERCEFULL],!0),d("LONETILDE","(?:~>?)"),d("TILDETRIM",`(\\s*)${a[r.LONETILDE]}\\s+`,!0),n.tildeTrimReplace="$1~",d("TILDE",`^${a[r.LONETILDE]}${a[r.XRANGEPLAIN]}$`),d("TILDELOOSE",`^${a[r.LONETILDE]}${a[r.XRANGEPLAINLOOSE]}$`),d("LONECARET","(?:\\^)"),d("CARETTRIM",`(\\s*)${a[r.LONECARET]}\\s+`,!0),n.caretTrimReplace="$1^",d("CARET",`^${a[r.LONECARET]}${a[r.XRANGEPLAIN]}$`),d("CARETLOOSE",`^${a[r.LONECARET]}${a[r.XRANGEPLAINLOOSE]}$`),d("COMPARATORLOOSE",`^${a[r.GTLT]}\\s*(${a[r.LOOSEPLAIN]})$|^$`),d("COMPARATOR",`^${a[r.GTLT]}\\s*(${a[r.FULLPLAIN]})$|^$`),d("COMPARATORTRIM",`(\\s*)${a[r.GTLT]}\\s*(${a[r.LOOSEPLAIN]}|${a[r.XRANGEPLAIN]})`,!0),n.comparatorTrimReplace="$1$2$3",d("HYPHENRANGE",`^\\s*(${a[r.XRANGEPLAIN]})\\s+-\\s+(${a[r.XRANGEPLAIN]})\\s*$`),d("HYPHENRANGELOOSE",`^\\s*(${a[r.XRANGEPLAINLOOSE]})\\s+-\\s+(${a[r.XRANGEPLAINLOOSE]})\\s*$`),d("STAR","(<|>)?=?\\s*\\*"),d("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),d("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Q,Q.exports)),Q.exports}var Ee,It;function it(){if(It)return Ee;It=1;const t=Object.freeze({loose:!0}),n=Object.freeze({});return Ee=s=>s?typeof s!="object"?t:s:n,Ee}var de,vt;function pr(){if(vt)return de;vt=1;const t=/^[0-9]+$/,n=(s,i)=>{const l=t.test(s),o=t.test(i);return l&&o&&(s=+s,i=+i),s===i?0:l&&!o?-1:o&&!l?1:s<i?-1:1};return de={compareIdentifiers:n,rcompareIdentifiers:(s,i)=>n(i,s)},de}var pe,gt;function F(){if(gt)return pe;gt=1;const t=se(),{MAX_LENGTH:n,MAX_SAFE_INTEGER:e}=re(),{safeRe:s,t:i}=J(),l=it(),{compareIdentifiers:o}=pr();class u{constructor(c,r){if(r=l(r),c instanceof u){if(c.loose===!!r.loose&&c.includePrerelease===!!r.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>n)throw new TypeError(`version is longer than ${n} characters`);t("SemVer",c,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;const f=c.trim().match(r.loose?s[i.LOOSE]:s[i.FULL]);if(!f)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>e||this.major<0)throw new TypeError("Invalid major version");if(this.minor>e||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>e||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const m=+h;if(m>=0&&m<e)return m}return h}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(t("SemVer.compare",this.version,this.options,c),!(c instanceof u)){if(typeof c=="string"&&c===this.version)return 0;c=new u(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof u||(c=new u(c,this.options)),o(this.major,c.major)||o(this.minor,c.minor)||o(this.patch,c.patch)}comparePre(c){if(c instanceof u||(c=new u(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let r=0;do{const f=this.prerelease[r],h=c.prerelease[r];if(t("prerelease compare",r,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return o(f,h)}while(++r)}compareBuild(c){c instanceof u||(c=new u(c,this.options));let r=0;do{const f=this.build[r],h=c.build[r];if(t("build compare",r,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return o(f,h)}while(++r)}inc(c,r,f){if(c.startsWith("pre")){if(!r&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(r){const h=`-${r}`.match(this.options.loose?s[i.PRERELEASELOOSE]:s[i.PRERELEASE]);if(!h||h[1]!==r)throw new Error(`invalid identifier: ${r}`)}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,f),this.inc("pre",r,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,f),this.inc("pre",r,f);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(f)?1:0;if(this.prerelease.length===0)this.prerelease=[h];else{let m=this.prerelease.length;for(;--m>=0;)typeof this.prerelease[m]=="number"&&(this.prerelease[m]++,m=-2);if(m===-1){if(r===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(r){let m=[r,h];f===!1&&(m=[r]),o(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=m):this.prerelease=m}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return pe=u,pe}var me,Nt;function Y(){if(Nt)return me;Nt=1;const t=F();return me=(e,s,i=!1)=>{if(e instanceof t)return e;try{return new t(e,s)}catch(l){if(!i)return null;throw l}},me}var Re,St;function Br(){if(St)return Re;St=1;const t=Y();return Re=(e,s)=>{const i=t(e,s);return i?i.version:null},Re}var Ie,Lt;function kr(){if(Lt)return Ie;Lt=1;const t=Y();return Ie=(e,s)=>{const i=t(e.trim().replace(/^[=v]+/,""),s);return i?i.version:null},Ie}var ve,Tt;function Vr(){if(Tt)return ve;Tt=1;const t=F();return ve=(e,s,i,l,o)=>{typeof i=="string"&&(o=l,l=i,i=void 0);try{return new t(e instanceof t?e.version:e,i).inc(s,l,o).version}catch{return null}},ve}var ge,Ot;function jr(){if(Ot)return ge;Ot=1;const t=Y();return ge=(e,s)=>{const i=t(e,null,!0),l=t(s,null,!0),o=i.compare(l);if(o===0)return null;const u=o>0,a=u?i:l,c=u?l:i,r=!!a.prerelease.length;if(!!c.prerelease.length&&!r){if(!c.patch&&!c.minor)return"major";if(c.compareMain(a)===0)return c.minor&&!c.patch?"minor":"patch"}const h=r?"pre":"";return i.major!==l.major?h+"major":i.minor!==l.minor?h+"minor":i.patch!==l.patch?h+"patch":"prerelease"},ge}var Ne,$t;function Xr(){if($t)return Ne;$t=1;const t=F();return Ne=(e,s)=>new t(e,s).major,Ne}var Se,At;function Hr(){if(At)return Se;At=1;const t=F();return Se=(e,s)=>new t(e,s).minor,Se}var Le,wt;function zr(){if(wt)return Le;wt=1;const t=F();return Le=(e,s)=>new t(e,s).patch,Le}var Te,Ct;function Yr(){if(Ct)return Te;Ct=1;const t=Y();return Te=(e,s)=>{const i=t(e,s);return i&&i.prerelease.length?i.prerelease:null},Te}var Oe,xt;function M(){if(xt)return Oe;xt=1;const t=F();return Oe=(e,s,i)=>new t(e,i).compare(new t(s,i)),Oe}var $e,_t;function Kr(){if(_t)return $e;_t=1;const t=M();return $e=(e,s,i)=>t(s,e,i),$e}var Ae,Pt;function Wr(){if(Pt)return Ae;Pt=1;const t=M();return Ae=(e,s)=>t(e,s,!0),Ae}var we,Dt;function at(){if(Dt)return we;Dt=1;const t=F();return we=(e,s,i)=>{const l=new t(e,i),o=new t(s,i);return l.compare(o)||l.compareBuild(o)},we}var Ce,yt;function Zr(){if(yt)return Ce;yt=1;const t=at();return Ce=(e,s)=>e.sort((i,l)=>t(i,l,s)),Ce}var xe,Ut;function Jr(){if(Ut)return xe;Ut=1;const t=at();return xe=(e,s)=>e.sort((i,l)=>t(l,i,s)),xe}var _e,qt;function ne(){if(qt)return _e;qt=1;const t=M();return _e=(e,s,i)=>t(e,s,i)>0,_e}var Pe,bt;function ot(){if(bt)return Pe;bt=1;const t=M();return Pe=(e,s,i)=>t(e,s,i)<0,Pe}var De,Ft;function mr(){if(Ft)return De;Ft=1;const t=M();return De=(e,s,i)=>t(e,s,i)===0,De}var ye,Gt;function Rr(){if(Gt)return ye;Gt=1;const t=M();return ye=(e,s,i)=>t(e,s,i)!==0,ye}var Ue,Mt;function ct(){if(Mt)return Ue;Mt=1;const t=M();return Ue=(e,s,i)=>t(e,s,i)>=0,Ue}var qe,Bt;function ut(){if(Bt)return qe;Bt=1;const t=M();return qe=(e,s,i)=>t(e,s,i)<=0,qe}var be,kt;function Ir(){if(kt)return be;kt=1;const t=mr(),n=Rr(),e=ne(),s=ct(),i=ot(),l=ut();return be=(u,a,c,r)=>{switch(a){case"===":return typeof u=="object"&&(u=u.version),typeof c=="object"&&(c=c.version),u===c;case"!==":return typeof u=="object"&&(u=u.version),typeof c=="object"&&(c=c.version),u!==c;case"":case"=":case"==":return t(u,c,r);case"!=":return n(u,c,r);case">":return e(u,c,r);case">=":return s(u,c,r);case"<":return i(u,c,r);case"<=":return l(u,c,r);default:throw new TypeError(`Invalid operator: ${a}`)}},be}var Fe,Vt;function Qr(){if(Vt)return Fe;Vt=1;const t=F(),n=Y(),{safeRe:e,t:s}=J();return Fe=(l,o)=>{if(l instanceof t)return l;if(typeof l=="number"&&(l=String(l)),typeof l!="string")return null;o=o||{};let u=null;if(!o.rtl)u=l.match(o.includePrerelease?e[s.COERCEFULL]:e[s.COERCE]);else{const m=o.includePrerelease?e[s.COERCERTLFULL]:e[s.COERCERTL];let $;for(;($=m.exec(l))&&(!u||u.index+u[0].length!==l.length);)(!u||$.index+$[0].length!==u.index+u[0].length)&&(u=$),m.lastIndex=$.index+$[1].length+$[2].length;m.lastIndex=-1}if(u===null)return null;const a=u[2],c=u[3]||"0",r=u[4]||"0",f=o.includePrerelease&&u[5]?`-${u[5]}`:"",h=o.includePrerelease&&u[6]?`+${u[6]}`:"";return n(`${a}.${c}.${r}${f}${h}`,o)},Fe}var Ge,jt;function es(){if(jt)return Ge;jt=1;class t{constructor(){this.max=1e3,this.map=new Map}get(e){const s=this.map.get(e);if(s!==void 0)return this.map.delete(e),this.map.set(e,s),s}delete(e){return this.map.delete(e)}set(e,s){if(!this.delete(e)&&s!==void 0){if(this.map.size>=this.max){const l=this.map.keys().next().value;this.delete(l)}this.map.set(e,s)}return this}}return Ge=t,Ge}var Me,Xt;function B(){if(Xt)return Me;Xt=1;const t=/\s+/g;class n{constructor(E,v){if(v=i(v),E instanceof n)return E.loose===!!v.loose&&E.includePrerelease===!!v.includePrerelease?E:new n(E.raw,v);if(E instanceof l)return this.raw=E.value,this.set=[[E]],this.formatted=void 0,this;if(this.options=v,this.loose=!!v.loose,this.includePrerelease=!!v.includePrerelease,this.raw=E.trim().replace(t," "),this.set=this.raw.split("||").map(R=>this.parseRange(R.trim())).filter(R=>R.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const R=this.set[0];if(this.set=this.set.filter(g=>!d(g[0])),this.set.length===0)this.set=[R];else if(this.set.length>1){for(const g of this.set)if(g.length===1&&T(g[0])){this.set=[g];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let E=0;E<this.set.length;E++){E>0&&(this.formatted+="||");const v=this.set[E];for(let R=0;R<v.length;R++)R>0&&(this.formatted+=" "),this.formatted+=v[R].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(E){const R=((this.options.includePrerelease&&m)|(this.options.loose&&$))+":"+E,g=s.get(R);if(g)return g;const I=this.options.loose,N=I?a[c.HYPHENRANGELOOSE]:a[c.HYPHENRANGE];E=E.replace(N,ue(this.options.includePrerelease)),o("hyphen replace",E),E=E.replace(a[c.COMPARATORTRIM],r),o("comparator trim",E),E=E.replace(a[c.TILDETRIM],f),o("tilde trim",E),E=E.replace(a[c.CARETTRIM],h),o("caret trim",E);let A=E.split(" ").map(P=>U(P,this.options)).join(" ").split(/\s+/).map(P=>ce(P,this.options));I&&(A=A.filter(P=>(o("loose invalid filter",P,this.options),!!P.match(a[c.COMPARATORLOOSE])))),o("range list",A);const L=new Map,x=A.map(P=>new l(P,this.options));for(const P of x){if(d(P))return[P];L.set(P.value,P)}L.size>1&&L.has("")&&L.delete("");const b=[...L.values()];return s.set(R,b),b}intersects(E,v){if(!(E instanceof n))throw new TypeError("a Range is required");return this.set.some(R=>w(R,v)&&E.set.some(g=>w(g,v)&&R.every(I=>g.every(N=>I.intersects(N,v)))))}test(E){if(!E)return!1;if(typeof E=="string")try{E=new u(E,this.options)}catch{return!1}for(let v=0;v<this.set.length;v++)if(le(this.set[v],E,this.options))return!0;return!1}}Me=n;const e=es(),s=new e,i=it(),l=ie(),o=se(),u=F(),{safeRe:a,t:c,comparatorTrimReplace:r,tildeTrimReplace:f,caretTrimReplace:h}=J(),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:$}=re(),d=p=>p.value==="<0.0.0-0",T=p=>p.value==="",w=(p,E)=>{let v=!0;const R=p.slice();let g=R.pop();for(;v&&R.length;)v=R.every(I=>g.intersects(I,E)),g=R.pop();return v},U=(p,E)=>(o("comp",p,E),p=_(p,E),o("caret",p),p=q(p,E),o("tildes",p),p=S(p,E),o("xrange",p),p=oe(p,E),o("stars",p),p),C=p=>!p||p.toLowerCase()==="x"||p==="*",q=(p,E)=>p.trim().split(/\s+/).map(v=>G(v,E)).join(" "),G=(p,E)=>{const v=E.loose?a[c.TILDELOOSE]:a[c.TILDE];return p.replace(v,(R,g,I,N,A)=>{o("tilde",p,R,g,I,N,A);let L;return C(g)?L="":C(I)?L=`>=${g}.0.0 <${+g+1}.0.0-0`:C(N)?L=`>=${g}.${I}.0 <${g}.${+I+1}.0-0`:A?(o("replaceTilde pr",A),L=`>=${g}.${I}.${N}-${A} <${g}.${+I+1}.0-0`):L=`>=${g}.${I}.${N} <${g}.${+I+1}.0-0`,o("tilde return",L),L})},_=(p,E)=>p.trim().split(/\s+/).map(v=>y(v,E)).join(" "),y=(p,E)=>{o("caret",p,E);const v=E.loose?a[c.CARETLOOSE]:a[c.CARET],R=E.includePrerelease?"-0":"";return p.replace(v,(g,I,N,A,L)=>{o("caret",p,g,I,N,A,L);let x;return C(I)?x="":C(N)?x=`>=${I}.0.0${R} <${+I+1}.0.0-0`:C(A)?I==="0"?x=`>=${I}.${N}.0${R} <${I}.${+N+1}.0-0`:x=`>=${I}.${N}.0${R} <${+I+1}.0.0-0`:L?(o("replaceCaret pr",L),I==="0"?N==="0"?x=`>=${I}.${N}.${A}-${L} <${I}.${N}.${+A+1}-0`:x=`>=${I}.${N}.${A}-${L} <${I}.${+N+1}.0-0`:x=`>=${I}.${N}.${A}-${L} <${+I+1}.0.0-0`):(o("no pr"),I==="0"?N==="0"?x=`>=${I}.${N}.${A}${R} <${I}.${N}.${+A+1}-0`:x=`>=${I}.${N}.${A}${R} <${I}.${+N+1}.0-0`:x=`>=${I}.${N}.${A} <${+I+1}.0.0-0`),o("caret return",x),x})},S=(p,E)=>(o("replaceXRanges",p,E),p.split(/\s+/).map(v=>K(v,E)).join(" ")),K=(p,E)=>{p=p.trim();const v=E.loose?a[c.XRANGELOOSE]:a[c.XRANGE];return p.replace(v,(R,g,I,N,A,L)=>{o("xRange",p,R,g,I,N,A,L);const x=C(I),b=x||C(N),P=b||C(A),W=P;return g==="="&&W&&(g=""),L=E.includePrerelease?"-0":"",x?g===">"||g==="<"?R="<0.0.0-0":R="*":g&&W?(b&&(N=0),A=0,g===">"?(g=">=",b?(I=+I+1,N=0,A=0):(N=+N+1,A=0)):g==="<="&&(g="<",b?I=+I+1:N=+N+1),g==="<"&&(L="-0"),R=`${g+I}.${N}.${A}${L}`):b?R=`>=${I}.0.0${L} <${+I+1}.0.0-0`:P&&(R=`>=${I}.${N}.0${L} <${I}.${+N+1}.0-0`),o("xRange return",R),R})},oe=(p,E)=>(o("replaceStars",p,E),p.trim().replace(a[c.STAR],"")),ce=(p,E)=>(o("replaceGTE0",p,E),p.trim().replace(a[E.includePrerelease?c.GTE0PRE:c.GTE0],"")),ue=p=>(E,v,R,g,I,N,A,L,x,b,P,W)=>(C(R)?v="":C(g)?v=`>=${R}.0.0${p?"-0":""}`:C(I)?v=`>=${R}.${g}.0${p?"-0":""}`:N?v=`>=${v}`:v=`>=${v}${p?"-0":""}`,C(x)?L="":C(b)?L=`<${+x+1}.0.0-0`:C(P)?L=`<${x}.${+b+1}.0-0`:W?L=`<=${x}.${b}.${P}-${W}`:p?L=`<${x}.${b}.${+P+1}-0`:L=`<=${L}`,`${v} ${L}`.trim()),le=(p,E,v)=>{for(let R=0;R<p.length;R++)if(!p[R].test(E))return!1;if(E.prerelease.length&&!v.includePrerelease){for(let R=0;R<p.length;R++)if(o(p[R].semver),p[R].semver!==l.ANY&&p[R].semver.prerelease.length>0){const g=p[R].semver;if(g.major===E.major&&g.minor===E.minor&&g.patch===E.patch)return!0}return!1}return!0};return Me}var Be,Ht;function ie(){if(Ht)return Be;Ht=1;const t=Symbol("SemVer ANY");class n{static get ANY(){return t}constructor(r,f){if(f=e(f),r instanceof n){if(r.loose===!!f.loose)return r;r=r.value}r=r.trim().split(/\s+/).join(" "),o("comparator",r,f),this.options=f,this.loose=!!f.loose,this.parse(r),this.semver===t?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(r){const f=this.options.loose?s[i.COMPARATORLOOSE]:s[i.COMPARATOR],h=r.match(f);if(!h)throw new TypeError(`Invalid comparator: ${r}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new u(h[2],this.options.loose):this.semver=t}toString(){return this.value}test(r){if(o("Comparator.test",r,this.options.loose),this.semver===t||r===t)return!0;if(typeof r=="string")try{r=new u(r,this.options)}catch{return!1}return l(r,this.operator,this.semver,this.options)}intersects(r,f){if(!(r instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new a(r.value,f).test(this.value):r.operator===""?r.value===""?!0:new a(this.value,f).test(r.semver):(f=e(f),f.includePrerelease&&(this.value==="<0.0.0-0"||r.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||r.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&r.operator.startsWith(">")||this.operator.startsWith("<")&&r.operator.startsWith("<")||this.semver.version===r.semver.version&&this.operator.includes("=")&&r.operator.includes("=")||l(this.semver,"<",r.semver,f)&&this.operator.startsWith(">")&&r.operator.startsWith("<")||l(this.semver,">",r.semver,f)&&this.operator.startsWith("<")&&r.operator.startsWith(">")))}}Be=n;const e=it(),{safeRe:s,t:i}=J(),l=Ir(),o=se(),u=F(),a=B();return Be}var ke,zt;function ae(){if(zt)return ke;zt=1;const t=B();return ke=(e,s,i)=>{try{s=new t(s,i)}catch{return!1}return s.test(e)},ke}var Ve,Yt;function ts(){if(Yt)return Ve;Yt=1;const t=B();return Ve=(e,s)=>new t(e,s).set.map(i=>i.map(l=>l.value).join(" ").trim().split(" ")),Ve}var je,Kt;function rs(){if(Kt)return je;Kt=1;const t=F(),n=B();return je=(s,i,l)=>{let o=null,u=null,a=null;try{a=new n(i,l)}catch{return null}return s.forEach(c=>{a.test(c)&&(!o||u.compare(c)===-1)&&(o=c,u=new t(o,l))}),o},je}var Xe,Wt;function ss(){if(Wt)return Xe;Wt=1;const t=F(),n=B();return Xe=(s,i,l)=>{let o=null,u=null,a=null;try{a=new n(i,l)}catch{return null}return s.forEach(c=>{a.test(c)&&(!o||u.compare(c)===1)&&(o=c,u=new t(o,l))}),o},Xe}var He,Zt;function ns(){if(Zt)return He;Zt=1;const t=F(),n=B(),e=ne();return He=(i,l)=>{i=new n(i,l);let o=new t("0.0.0");if(i.test(o)||(o=new t("0.0.0-0"),i.test(o)))return o;o=null;for(let u=0;u<i.set.length;++u){const a=i.set[u];let c=null;a.forEach(r=>{const f=new t(r.semver.version);switch(r.operator){case">":f.prerelease.length===0?f.patch++:f.prerelease.push(0),f.raw=f.format();case"":case">=":(!c||e(f,c))&&(c=f);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${r.operator}`)}}),c&&(!o||e(o,c))&&(o=c)}return o&&i.test(o)?o:null},He}var ze,Jt;function is(){if(Jt)return ze;Jt=1;const t=B();return ze=(e,s)=>{try{return new t(e,s).range||"*"}catch{return null}},ze}var Ye,Qt;function lt(){if(Qt)return Ye;Qt=1;const t=F(),n=ie(),{ANY:e}=n,s=B(),i=ae(),l=ne(),o=ot(),u=ut(),a=ct();return Ye=(r,f,h,m)=>{r=new t(r,m),f=new s(f,m);let $,d,T,w,U;switch(h){case">":$=l,d=u,T=o,w=">",U=">=";break;case"<":$=o,d=a,T=l,w="<",U="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(i(r,f,m))return!1;for(let C=0;C<f.set.length;++C){const q=f.set[C];let G=null,_=null;if(q.forEach(y=>{y.semver===e&&(y=new n(">=0.0.0")),G=G||y,_=_||y,$(y.semver,G.semver,m)?G=y:T(y.semver,_.semver,m)&&(_=y)}),G.operator===w||G.operator===U||(!_.operator||_.operator===w)&&d(r,_.semver))return!1;if(_.operator===U&&T(r,_.semver))return!1}return!0},Ye}var Ke,er;function as(){if(er)return Ke;er=1;const t=lt();return Ke=(e,s,i)=>t(e,s,">",i),Ke}var We,tr;function os(){if(tr)return We;tr=1;const t=lt();return We=(e,s,i)=>t(e,s,"<",i),We}var Ze,rr;function cs(){if(rr)return Ze;rr=1;const t=B();return Ze=(e,s,i)=>(e=new t(e,i),s=new t(s,i),e.intersects(s,i)),Ze}var Je,sr;function us(){if(sr)return Je;sr=1;const t=ae(),n=M();return Je=(e,s,i)=>{const l=[];let o=null,u=null;const a=e.sort((h,m)=>n(h,m,i));for(const h of a)t(h,s,i)?(u=h,o||(o=h)):(u&&l.push([o,u]),u=null,o=null);o&&l.push([o,null]);const c=[];for(const[h,m]of l)h===m?c.push(h):!m&&h===a[0]?c.push("*"):m?h===a[0]?c.push(`<=${m}`):c.push(`${h} - ${m}`):c.push(`>=${h}`);const r=c.join(" || "),f=typeof s.raw=="string"?s.raw:String(s);return r.length<f.length?r:s},Je}var Qe,nr;function ls(){if(nr)return Qe;nr=1;const t=B(),n=ie(),{ANY:e}=n,s=ae(),i=M(),l=(f,h,m={})=>{if(f===h)return!0;f=new t(f,m),h=new t(h,m);let $=!1;e:for(const d of f.set){for(const T of h.set){const w=a(d,T,m);if($=$||w!==null,w)continue e}if($)return!1}return!0},o=[new n(">=0.0.0-0")],u=[new n(">=0.0.0")],a=(f,h,m)=>{if(f===h)return!0;if(f.length===1&&f[0].semver===e){if(h.length===1&&h[0].semver===e)return!0;m.includePrerelease?f=o:f=u}if(h.length===1&&h[0].semver===e){if(m.includePrerelease)return!0;h=u}const $=new Set;let d,T;for(const S of f)S.operator===">"||S.operator===">="?d=c(d,S,m):S.operator==="<"||S.operator==="<="?T=r(T,S,m):$.add(S.semver);if($.size>1)return null;let w;if(d&&T){if(w=i(d.semver,T.semver,m),w>0)return null;if(w===0&&(d.operator!==">="||T.operator!=="<="))return null}for(const S of $){if(d&&!s(S,String(d),m)||T&&!s(S,String(T),m))return null;for(const K of h)if(!s(S,String(K),m))return!1;return!0}let U,C,q,G,_=T&&!m.includePrerelease&&T.semver.prerelease.length?T.semver:!1,y=d&&!m.includePrerelease&&d.semver.prerelease.length?d.semver:!1;_&&_.prerelease.length===1&&T.operator==="<"&&_.prerelease[0]===0&&(_=!1);for(const S of h){if(G=G||S.operator===">"||S.operator===">=",q=q||S.operator==="<"||S.operator==="<=",d){if(y&&S.semver.prerelease&&S.semver.prerelease.length&&S.semver.major===y.major&&S.semver.minor===y.minor&&S.semver.patch===y.patch&&(y=!1),S.operator===">"||S.operator===">="){if(U=c(d,S,m),U===S&&U!==d)return!1}else if(d.operator===">="&&!s(d.semver,String(S),m))return!1}if(T){if(_&&S.semver.prerelease&&S.semver.prerelease.length&&S.semver.major===_.major&&S.semver.minor===_.minor&&S.semver.patch===_.patch&&(_=!1),S.operator==="<"||S.operator==="<="){if(C=r(T,S,m),C===S&&C!==T)return!1}else if(T.operator==="<="&&!s(T.semver,String(S),m))return!1}if(!S.operator&&(T||d)&&w!==0)return!1}return!(d&&q&&!T&&w!==0||T&&G&&!d&&w!==0||y||_)},c=(f,h,m)=>{if(!f)return h;const $=i(f.semver,h.semver,m);return $>0?f:$<0||h.operator===">"&&f.operator===">="?h:f},r=(f,h,m)=>{if(!f)return h;const $=i(f.semver,h.semver,m);return $<0?f:$>0||h.operator==="<"&&f.operator==="<="?h:f};return Qe=l,Qe}var et,ir;function fs(){if(ir)return et;ir=1;const t=J(),n=re(),e=F(),s=pr(),i=Y(),l=Br(),o=kr(),u=Vr(),a=jr(),c=Xr(),r=Hr(),f=zr(),h=Yr(),m=M(),$=Kr(),d=Wr(),T=at(),w=Zr(),U=Jr(),C=ne(),q=ot(),G=mr(),_=Rr(),y=ct(),S=ut(),K=Ir(),oe=Qr(),ce=ie(),ue=B(),le=ae(),p=ts(),E=rs(),v=ss(),R=ns(),g=is(),I=lt(),N=as(),A=os(),L=cs(),x=us(),b=ls();return et={parse:i,valid:l,clean:o,inc:u,diff:a,major:c,minor:r,patch:f,prerelease:h,compare:m,rcompare:$,compareLoose:d,compareBuild:T,sort:w,rsort:U,gt:C,lt:q,eq:G,neq:_,gte:y,lte:S,cmp:K,coerce:oe,Comparator:ce,Range:ue,satisfies:le,toComparators:p,maxSatisfying:E,minSatisfying:v,minVersion:R,validRange:g,outside:I,gtr:N,ltr:A,intersects:L,simplifyRange:x,subset:b,SemVer:e,re:t.re,src:t.src,tokens:t.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers},et}var hs=fs();const ar=Tr(hs);var D;(function(t){t.blue="blue",t.nanoS="nanoS",t.nanoSP="nanoSP",t.nanoX="nanoX",t.stax="stax",t.europa="europa"})(D||(D={}));const tt={[D.blue]:{id:D.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:t=>4*1024},[D.nanoS]:{id:D.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:t=>ar.lt(ar.coerce(t)??"","2.0.0")?4*1024:2*1024},[D.nanoX]:{id:D.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:t=>4*1024,bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},[D.nanoSP]:{id:D.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:t=>32},[D.stax]:{id:D.stax,productName:"Ledger Stax",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:1533*1024,masks:[857735168],getBlockSize:t=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},[D.europa]:{id:D.europa,productName:"Ledger Flex",productIdMM:112,legacyUsbProductId:7,usbOnly:!1,memorySize:1533*1024,masks:[858783744],getBlockSize:t=>32,bluetoothSpec:[{serviceUuid:"13d63400-2c97-3004-0000-4c6564676572",notifyUuid:"13d63400-2c97-3004-0001-4c6564676572",writeUuid:"13d63400-2c97-3004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-3004-0003-4c6564676572"}]}};D.blue,D.nanoS,D.nanoSP,D.nanoX,D.stax,D.europa;const or=Object.values(tt),vr=11415,cr=t=>{const n=or.find(i=>i.legacyUsbProductId===t);if(n)return n;const e=t>>8;return or.find(i=>i.productIdMM===e)},Es=[],ur={};for(const t in tt){const n=tt[t],{bluetoothSpec:e}=n;if(e)for(let s=0;s<e.length;s++){const i=e[s];Es.push(i.serviceUuid),ur[i.serviceUuid]=ur[i.serviceUuid.replace(/-/g,"")]={deviceModel:n,...i}}}const ds=[{vendorId:vr}],ps=()=>Promise.resolve(!!(window.navigator&&window.navigator.hid)),ee=()=>{const{hid:t}=navigator;if(!t)throw new k("navigator.hid is not supported","HIDNotSupported");return t};async function gr(){const t=await ee().requestDevice({filters:ds});return Array.isArray(t)?t:[t]}async function rt(){return(await ee().getDevices()).filter(n=>n.vendorId===vr)}async function ms(){const t=await rt();return t.length>0?t[0]:(await gr())[0]}const j=class j extends X{constructor(e){super();O(this,"device");O(this,"deviceModel");O(this,"channel",Math.floor(Math.random()*65535));O(this,"packetSize",64);O(this,"inputs",[]);O(this,"inputCallback");O(this,"read",()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise(e=>{this.inputCallback=e}));O(this,"onInputReport",e=>{const s=Buffer.from(e.data.buffer);this.inputCallback?(this.inputCallback(s),this.inputCallback=null):this.inputs.push(s)});O(this,"_disconnectEmitted",!1);O(this,"_emitDisconnect",e=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",e))});O(this,"exchange",async e=>await this.exchangeAtomicImpl(async()=>{const{channel:i,packetSize:l}=this;Et("apdu","=> "+e.toString("hex"));const o=Mr(i,l),u=o.makeBlocks(e);for(let r=0;r<u.length;r++)await this.device.sendReport(0,u[r]);let a,c;for(;!(a=o.getReducedResult(c));)try{const r=await this.read();c=o.reduceResponse(c,r)}catch(r){if(r instanceof k&&r.id==="InvalidChannel")continue;throw r}return Et("apdu","<= "+a.toString("hex")),a}).catch(i=>{throw i&&i.message&&i.message.includes("write")?(this._emitDisconnect(i),new Pr(i.message)):i}));this.device=e,this.deviceModel=typeof e.productId=="number"?cr(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static async request(){const[e]=await gr();return j.open(e)}static async openConnected(){const e=await rt();return e.length===0?null:j.open(e[0])}static async open(e){await e.open();const s=new j(e),i=l=>{e===l.device&&(ee().removeEventListener("disconnect",i),s._emitDisconnect(new _r))};return ee().addEventListener("disconnect",i),s}async close(){await this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),await this.device.close()}setScrambleKey(){}};O(j,"isSupported",ps),O(j,"list",rt),O(j,"listen",e=>{let s=!1;ms().then(l=>{if(!l)e.error(new ft("Access denied to use Ledger device"));else if(!s){const o=typeof l.productId=="number"?cr(l.productId):void 0;e.next({type:"add",descriptor:l,deviceModel:o}),e.complete()}},l=>{e.error(new ft(l.message))});function i(){s=!0}return{unsubscribe:i}});let st=j;const lr=t=>new Promise((n,e)=>{setTimeout(()=>{e(new Error("timed out"))},t)}),fr=3e5,gs=async(t,n={derivationType:Ar.ED25519})=>{const e=await Promise.race([st.create(),lr(fr)]);try{const s=await Or(t),{accountId:i,tezos:l,isActivated:o}=await Promise.race([await wr(s,e,n),lr(fr)]),u={id:i,isActivated:o,type:"ledger",network:t.id.toString(),explorer:s.explorer,rpc:s.rpc,balance:0n,stakedBalance:0n,fullBalance:0n,finalizableBalance:0n},a=l;return a.signOperation=async f=>({signature:(await l.signer.sign(f,new Uint8Array([3]))).sbytes.slice(f.length+1)}),{...await $r(u,a),logout:async()=>{e.close()}}}catch(s){throw e.close(),s}};export{gs as createLedgerSession};
